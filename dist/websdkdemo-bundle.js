/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/dist";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/websdkdemo.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./lib/tttwebsdk.js":
/*!**************************!*\
  !*** ./lib/tttwebsdk.js ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("(function webpackUniversalModuleDefinition(root, factory) {\n\tif(true)\n\t\tmodule.exports = factory();\n\telse {}\n})(window, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./lib/TTTRtcWeb.js\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./lib/3tmodule/iplocation.js\":\n/*!************************************!*\\\n  !*** ./lib/3tmodule/iplocation.js ***!\n  \\************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _events = __webpack_require__(/*! events */ \"./node_modules/_events@3.1.0@events/events.js\");\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/utils.js\");\n\nvar tttUtils = _interopRequireWildcard(_utils);\n\nvar _logger = __webpack_require__(/*! ../logger */ \"./lib/logger.js\");\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nvar _config = __webpack_require__(/*! ../config */ \"./lib/config.js\");\n\nvar config = _interopRequireWildcard(_config);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _logger2.default('<IPLocation>');\n\nvar specialIplocationAddress = null;\nvar iplocationPort = config.iplocationPort;\nvar mediaServerAddress = config.mediaServerAddress;\nvar PRIVATE_CLOUD = false;\n\nvar retry = __webpack_require__(/*! retry */ \"./node_modules/_retry@0.12.0@retry/index.js\");\n\n/**\r\n * Retry operation's paramters.\r\n */\nvar WS_DEFAULT_RETRY_OPTIONS = retry.operation({\n\tretries: 4,\n\tfactor: 2,\n\tminTimeout: 1 * 1000,\n\tmaxTimeout: 2 * 1000,\n\trandomize: true\n});\n\n/**\r\n * Get latest ip host service.\r\n */\n\nvar IPLocation = function (_EventEmitter) {\n\t(0, _inherits3.default)(IPLocation, _EventEmitter);\n\n\tfunction IPLocation(appId, uid, successfulCB, failedCB) {\n\t\t(0, _classCallCheck3.default)(this, IPLocation);\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (IPLocation.__proto__ || (0, _getPrototypeOf2.default)(IPLocation)).call(this));\n\n\t\tvar iploc = '';\n\t\tif (IPLocation.privateCloud) {\n\t\t\tiploc = !!specialIplocationAddress ? specialIplocationAddress.trim() : '';\n\t\t} else {\n\t\t\tiploc = config.iplocationAddress.trim();\n\t\t}\n\t\tif (iploc === '') {\n\t\t\tfailedCB('INVALID iplocation address - need set IplocationAddress');\n\n\t\t\treturn (0, _possibleConstructorReturn3.default)(_this);\n\t\t}\n\n\t\t//\n\t\t_this.appId = appId;\n\t\t_this.connectId = tttUtils.uuid();\n\t\t_this._url = 'wss://' + iploc + ':' + iplocationPort + '/iplocation/';\n\n\t\tlogger.debug('constructor: ' + _this._url);\n\n\t\t// send to iplocation server's info.\n\t\t_this._wsjson = {\n\t\t\t\"eType\": 1,\n\t\t\t\"sSEQID\": \"111111111\",\n\t\t\t\"mProtocolMsg\": {\n\t\t\t\t\"sVersion\": \"Test_4.2.0.777\",\n\t\t\t\t\"bLoadBalance\": false,\n\t\t\t\t\"bReConnect\": false,\n\t\t\t\t\"bVipUser\": false,\n\t\t\t\t\"sIDentify\": \"7B4FCDBC0914E7182B8EC357F07498F1\",\n\t\t\t\t\"sSecret\": \"c052cd055acfabc5\",\n\t\t\t\t\"sVerifyCode\": \"abcd\",\n\t\t\t\t\"sAppID\": appId,\n\t\t\t\t\"nUserID\": +uid,\n\t\t\t\t\"sClientVer\": \"web_1.0\",\n\t\t\t\t\"sConnectID\": _this.connectId,\n\t\t\t\t\"mIpAddrMsg\": {\n\t\t\t\t\t\"bFec\": false,\n\t\t\t\t\t\"sIp\": iploc,\n\t\t\t\t\t\"nPort\": 0\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// WebSocket instance.\n\t\t_this._ws = null;\n\n\t\t// Closed flag.\n\t\t_this._closed = false;\n\n\t\t// succuss & failure callbacks.\n\t\t_this._successcb = successfulCB;\n\t\t_this._failcb = failedCB;\n\n\t\t_this.reconnectTimes = 1;\n\t\t_this.firstConnectTime = Date.now();\n\t\t_this.connectedTime = 0;\n\t\t_this._hasSolve = false; // 是否已成功得到 IP location 结果\n\t\t_this._sendRetry = {\n\t\t\tretry: 5,\n\t\t\ttimer: 0\n\t\t};\n\t\t_this._setWebSocket();\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(IPLocation, [{\n\t\tkey: 'getIpLocationVar',\n\t\tvalue: function getIpLocationVar() {\n\t\t\treturn this.svcHost;\n\t\t}\n\t}, {\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tthis._closed = true;\n\t\t\tif (this._ws !== null) {\n\t\t\t\tthis._ws.close();\n\t\t\t\tthis._ws = null;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: '_setWebSocket',\n\t\tvalue: function _setWebSocket() {\n\t\t\tvar _this2 = this;\n\n\t\t\tvar operation = retry.operation(WS_DEFAULT_RETRY_OPTIONS);\n\t\t\tvar wasConnected = false;\n\n\t\t\toperation.attempt(function (currentAttempt) {\n\t\t\t\tif (_this2._closed) {\n\t\t\t\t\toperation.stop();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('_setWebSocket() connecting... [currentAttempt: ' + currentAttempt);\n\n\t\t\t\t_this2._ws = new WebSocket(_this2._url);\n\n\t\t\t\t_this2._ws.onopen = function () {\n\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\twasConnected = true;\n\t\t\t\t\t_this2.connectedTime = Date.now();\n\t\t\t\t\t_this2._ws.send((0, _stringify2.default)(_this2._wsjson));\n\t\t\t\t\t_this2._sendRetry.timer = setInterval(function () {\n\t\t\t\t\t\tif (_this2._hasSolve) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// \n\t\t\t\t\t\tif (_this2._sendRetry.retry === 0) {\n\t\t\t\t\t\t\t_this2._ws.close();\n\t\t\t\t\t\t\toperation.retry(true);\n\t\t\t\t\t\t\tclearInterval(_this2._sendRetry.timer);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t_this2._ws.send((0, _stringify2.default)(_this2._wsjson));\n\t\t\t\t\t\t--_this2._sendRetry.retry;\n\t\t\t\t\t}, 500);\n\n\t\t\t\t\tlogger.debug('WebSocket event [open]');\n\t\t\t\t};\n\n\t\t\t\t_this2._ws.onclose = function (event) {\n\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\tlogger.warn('WebSocket event [close] -- ' + (0, _stringify2.default)(event));\n\n\t\t\t\t\t// Don't retry if code is 4000 (closed by the server).\n\t\t\t\t\tif (event.code !== 4000) {\n\t\t\t\t\t\t// If it was not connected, try again.\n\t\t\t\t\t\tif (!wasConnected) {\n\t\t\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\t\t\tif (operation.retry(true)) ++_this2.reconnectTimes;\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If it was connected, start from scratch.\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\toperation.stop();\n\n\t\t\t\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\t\t\t\t_this2._setWebSocket();\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t_this2._closed = true;\n\t\t\t\t};\n\n\t\t\t\t_this2._ws.onerror = function (e) {\n\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\t/*\r\n     logger.error('WebSocket event [error]');\r\n     this._failcb(`websocket event [error]`);\r\n     \t\tthis.close();\r\n     */\n\n\t\t\t\t\tlogger.error('WebSocket event [error] - error ' + e.toString() + ' - nothing todo.');\n\t\t\t\t};\n\n\t\t\t\t_this2._ws.onmessage = function (event) {\n\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\tvar msg = JSON.parse(event.data);\n\t\t\t\t\t// \n\t\t\t\t\tif (msg.eResult !== 1) {\n\t\t\t\t\t\tvar errMsg = config.tttErrMsg.get(msg.eResult);\n\t\t\t\t\t\t// \n\t\t\t\t\t\t_this2._failcb('msg.eResult: ' + msg.eResult + ' - ' + errMsg.reason);\n\n\t\t\t\t\t\t_this2.close();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar evtobj = msg.mProtocolMsg.mIpAddrMsg;\n\t\t\t\t\t\t_this2.svcHost = {\n\t\t\t\t\t\t\tip: evtobj.sIp,\n\t\t\t\t\t\t\tdomain: evtobj.sDomain,\n\t\t\t\t\t\t\tport: evtobj.nPort\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (mediaServerAddress !== '') {\n\t\t\t\t\t\t\t_this2.svcHost = {\n\t\t\t\t\t\t\t\tip: evtobj.sIp,\n\t\t\t\t\t\t\t\tdomain: mediaServerAddress,\n\t\t\t\t\t\t\t\tport: evtobj.nPort\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!!_this2._sendRetry.timer) {\n\t\t\t\t\t\t\tclearInterval(_this2._sendRetry.timer);\n\t\t\t\t\t\t\t_this2._sendRetry.timer = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// \n\t\t\t\t\t\t_this2._hasSolve = true;\n\n\t\t\t\t\t\t_this2._successcb(_this2.svcHost, msg.mProtocolMsg.mGWIpAddrMsgList);\n\n\t\t\t\t\t\t_this2.close();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'privateCloud',\n\t\tget: function get() {\n\t\t\treturn PRIVATE_CLOUD;\n\t\t},\n\t\tset: function set(isPrivate) {\n\t\t\tPRIVATE_CLOUD = Boolean(isPrivate);\n\t\t}\n\t}], [{\n\t\tkey: 'IplocationAddress',\n\t\tset: function set(value) {\n\t\t\tlogger.debug('set IplocationAddress: ' + value);\n\n\t\t\tspecialIplocationAddress = value;\n\t\t},\n\t\tget: function get() {\n\t\t\treturn specialIplocationAddress;\n\t\t}\n\t}, {\n\t\tkey: 'IplocationPort',\n\t\tset: function set(port) {\n\t\t\tlogger.debug('set IplocationPort: ' + port);\n\n\t\t\tif (!/^[1-9][0-9]{2,4}$/.test(port)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tiplocationPort = port;\n\t\t},\n\t\tget: function get() {\n\t\t\treturn iplocationPort;\n\t\t}\n\t}, {\n\t\tkey: 'MediaServerAddress',\n\t\tset: function set(value) {\n\t\t\tmediaServerAddress = value;\n\t\t},\n\t\tget: function get() {\n\t\t\treturn mediaServerAddress;\n\t\t}\n\t}]);\n\treturn IPLocation;\n}(_events.EventEmitter);\n\nexports.default = IPLocation;\n\n/***/ }),\n\n/***/ \"./lib/TTTRtcWeb.js\":\n/*!**************************!*\\\n  !*** ./lib/TTTRtcWeb.js ***!\n  \\**************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _events = __webpack_require__(/*! events */ \"./node_modules/_events@3.1.0@events/events.js\");\n\nvar _client = __webpack_require__(/*! ./client */ \"./lib/client.js\");\n\nvar _client2 = _interopRequireDefault(_client);\n\nvar _stream = __webpack_require__(/*! ./stream */ \"./lib/stream.js\");\n\nvar _stream2 = _interopRequireDefault(_stream);\n\nvar _logger = __webpack_require__(/*! ./logger */ \"./lib/logger.js\");\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nvar _iplocation = __webpack_require__(/*! ./3tmodule/iplocation */ \"./lib/3tmodule/iplocation.js\");\n\nvar _iplocation2 = _interopRequireDefault(_iplocation);\n\nvar _mslib = __webpack_require__(/*! ./mslib */ \"./lib/mslib/index.js\");\n\nvar mediasoupClient = _interopRequireWildcard(_mslib);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar pkg = __webpack_require__(/*! ../package.json */ \"./package.json\");\n\nvar logger = new _logger2.default('<TTTRtcWeb>');\n\nglobal.g_client = null;\n\n/**\n * tttwebsdk entry\n */\n\nvar TTTRtcWeb = function (_EventEmitter) {\n\t(0, _inherits3.default)(TTTRtcWeb, _EventEmitter);\n\n\tfunction TTTRtcWeb() {\n\t\t(0, _classCallCheck3.default)(this, TTTRtcWeb);\n\n\t\t// \n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (TTTRtcWeb.__proto__ || (0, _getPrototypeOf2.default)(TTTRtcWeb)).call(this));\n\n\t\t_stream2.default.clearStreamIdMap();\n\n\t\t// \n\t\tTTTRtcWeb.listDevices(function (devices) {\n\t\t\tlogger.debug('TTTRtcWeb.listDevices - devices: ' + (0, _stringify2.default)(devices));\n\t\t}, function (err) {\n\t\t\tvar errMsg = err.name + err.message + '\\n';\n\t\t\tlogger.warn('TTTRtcWeb.listDevices error - ' + errMsg);\n\t\t});\n\n\t\t// \n\t\tglobal.g_tttRtcWeb = _this;\n\t\t_this._client = null;\n\n\t\t// Apply the devices access right\n\t\ttry {\n\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: false }).then(function (stream) {\n\t\t\t\tlogger.debug('constructor succ.');\n\t\t\t}).catch(function (e) {\n\t\t\t\tlogger.warn('constructor fail - ' + e.toString());\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tlogger.warn('constructor() fail - ' + e.toString());\n\t\t}\n\t\treturn _this;\n\t}\n\n\t/**\n  * Check browser is support webrtc.\n  * @return Returns a Boolean indicating if the current browser/device is supported by mediasoup-client.\n  */\n\n\n\t(0, _createClass3.default)(TTTRtcWeb, [{\n\t\tkey: 'checkSystemRequirements',\n\t\tvalue: function checkSystemRequirements() {\n\t\t\tvar isDeviceSupported = mediasoupClient.isDeviceSupported();\n\t\t\treturn !!RTCPeerConnection && !!navigator.mediaDevices.getUserMedia && !!isDeviceSupported;\n\t\t}\n\t}, {\n\t\tkey: 'getDevices',\n\n\n\t\t/**\n   * Enumerate all the devices of this computer. e.g.: mics, webcams, speakers.\n   * @param onSuccess\n   * @param onFailure\n   * Field\tType\tDescription\n   *  flag\tString\tBrowser/device identifier.\n   *  name\tString\tBrowser/device descriptive name (taken from User-Agent.\n   *  version\tString\tBrowser/device version.\n   *  bowser\tObject\tObject produced by the _detect() method of the bowser library.\n   */\n\t\tvalue: function getDevices(onSuccess, onFailure) {\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API getDevices() error - parameter: onSuccess invalid');\n\t\t\t\treturn; // throw new TypeError('onSuccess parameter must be a function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API getDevices() error - parameter: onFailure invalid');\n\t\t\t\treturn; // throw new TypeError('onFailure parameter must be a function.');\n\t\t\t}\n\n\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {\n\t\t\t\tlogger.error(\"enumerateDevices() not supported.\");\n\t\t\t\treturn; // throw Error('websdk - system Not supported');\n\t\t\t}\n\n\t\t\t// List cameras and microphones.\n\t\t\tnavigator.mediaDevices.enumerateDevices().then(function (devices) {\n\t\t\t\tonSuccess(devices);\n\t\t\t}).catch(function (err) {\n\t\t\t\tonFailure(err);\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Enumerate all the devices of this computer. e.g.: mics, webcams, speakers.\n   * @param onSuccess\n   * @param onFailure\n   * Field\tType\tDescription\n   *  flag\tString\tBrowser/device identifier.\n   *  name\tString\tBrowser/device descriptive name (taken from User-Agent.\n   *  version\tString\tBrowser/device version.\n   *  bowser\tObject\tObject produced by the _detect() method of the bowser library.\n   */\n\n\t}, {\n\t\tkey: 'createStream',\n\n\n\t\t/**\n   * Create stream object.\n   * @param {object} spec. \n   *  {\n   *      streamId: '',\n   *      audio: true|false,\n   *      video: true|false,\n   *      attribute: {\n   *          resolution: 'sif|vga|hd20' // ref: config.js\n   *          minFrameRate: number,\n   *          maxFrameRate: number,\n   *          idealFrameRate: number\n   *      }\n   *      screen: true|false,\n   *      cameraId: string,\n   *      microphoneId: string\n   *  }\n   */\n\t\tvalue: function createStream(spec) {\n\t\t\tif (!TTTRtcWeb.isSystemSupported()) {\n\t\t\t\tlogger.warn('createStream() - isSystemSupported not supported.');\n\t\t\t\treturn null; // throw Error('websdk - system Not supported');\n\t\t\t}\n\n\t\t\tif (!!this._client) {\n\t\t\t\tif (!this._client.isLocalStreamAllowed) {\n\t\t\t\t\tlogger.warn('createStream() - Client.isLocalStreamAllowed is false');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar stream = new _stream2.default(spec);\n\t\t\tif (!stream) return null;\n\n\t\t\treturn stream;\n\t\t}\n\n\t\t/**\n   * Create client object.\n   * @param {Object} config.\n      *  {\n      *      role: '1|2|3' //1: master, 2: vice, 3: audience\n      *  }\n   */\n\n\t}, {\n\t\tkey: 'createClient',\n\t\tvalue: function createClient(config) {\n\t\t\tif (!TTTRtcWeb.isSystemSupported()) {\n\t\t\t\tlogger.error('createClient() - isSystemSupported not supported.');\n\t\t\t\treturn null; // throw Error('websdk - system Not supported');\n\t\t\t}\n\n\t\t\t// \n\t\t\tif (!!global.g_client) {\n\t\t\t\tglobal.g_client.close();\n\t\t\t\tglobal.g_client = null;\n\t\t\t}\n\t\t\t// \n\t\t\tthis._client = new _client2.default(config);\n\t\t\tglobal.g_client = this._client;\n\n\t\t\treturn this._client;\n\t\t}\n\n\t\t/**\n   * get peerconnection stats.\n   */\n\n\t}, {\n\t\tkey: 'getStats',\n\t\tvalue: function getStats() {\n\t\t\tif (this._client == null) {\n\t\t\t\treturn {}; // throw Error('client is null, please create it before.');\n\t\t\t}\n\n\t\t\treturn this._client.getNetState();\n\t\t}\n\n\t\t/**\n   * set server urls\n  * - 设置媒体服务器地址， websdk 将直接连接该指定服务器\n  * - 要确保在 createClient 之前执行\n   * @param {*} rootUrl \n   */\n\n\t}, {\n\t\tkey: 'version',\n\n\n\t\t/**\n   * Get version of SDK 3TTech.cn\n   * @returns {string}\n   */\n\t\tget: function get() {\n\t\t\treturn pkg.version + '-' + pkg.buildDate;\n\t\t}\n\t}], [{\n\t\tkey: 'isSystemSupported',\n\t\tvalue: function isSystemSupported() {\n\t\t\tvar isDeviceSupported = mediasoupClient.isDeviceSupported();\n\t\t\treturn !!RTCPeerConnection && !!navigator.mediaDevices.getUserMedia && !!isDeviceSupported;\n\t\t}\n\t}, {\n\t\tkey: 'listDevices',\n\t\tvalue: function listDevices(onSuccess, onFailure) {\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API getDevices() error - parameter: onSuccess invalid');\n\t\t\t\treturn; // throw new TypeError('onSuccess parameter must be a function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API getDevices() error - parameter: onFailure invalid');\n\t\t\t\treturn; // throw new TypeError('onFailure parameter must be a function.');\n\t\t\t}\n\n\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {\n\t\t\t\tlogger.error(\"enumerateDevices() not supported.\");\n\t\t\t\treturn; // throw Error('websdk - system Not supported');\n\t\t\t}\n\n\t\t\t// List cameras and microphones.\n\t\t\tnavigator.mediaDevices.enumerateDevices().then(function (devices) {\n\t\t\t\tonSuccess(devices);\n\t\t\t}).catch(function (err) {\n\t\t\t\tonFailure(err);\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Set logger level.\n   * @param {string} logLevel -- 见 config.js 中 logLevel\n   */\n\n\t}, {\n\t\tkey: 'setLogLevel',\n\t\tvalue: function setLogLevel(logLevel) {\n\t\t\t_logger2.default.logLevel = logLevel;\n\t\t}\n\t}, {\n\t\tkey: 'setLogSubmit',\n\t\tvalue: function setLogSubmit(enable) {\n\t\t\t_logger2.default.logSubmit = Boolean(enable);\n\t\t}\n\n\t\t/**\n   * 是否为私有云部署 -- 要确保 在 createClient 之前执行\n   * @param {bool} isPrivate -- 是否 私有云\n   */\n\n\t}, {\n\t\tkey: 'setPrivate',\n\t\tvalue: function setPrivate(isPrivate) {\n\t\t\tif (!!global._client) // 要确保在 createClient 之前执行\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t// \n\t\t\t_logger2.default.privateCloud = isPrivate;\n\t\t\t_iplocation2.default.privateCloud = isPrivate;\n\t\t}\n\n\t\t/**\n   * Get version of SDK 3TTech.cn\n   * @returns {string}\n   */\n\n\t}, {\n\t\tkey: 'getVersion',\n\t\tvalue: function getVersion() {\n\t\t\treturn pkg.version + '-' + pkg.buildDate;\n\t\t}\n\t}, {\n\t\tkey: 'setServerUrl',\n\t\tvalue: function setServerUrl(rootUrl) {\n\t\t\tif (!!global._client) // 要确保在 createClient 之前执行\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\tif (!rootUrl || rootUrl.trim() === '') {\n\t\t\t\treturn; // throw new TypeError('rootUrl');\n\t\t\t}\n\n\t\t\t_iplocation2.default.MediaServerAddress = rootUrl.trim();\n\t\t}\n\n\t\t/**\n   * set iplocation host\n  * - 应用于 私有云部署\n  * - 要确保在 createClient 之前执行\n   * @param {string} iplocation \n   */\n\n\t}, {\n\t\tkey: 'setIpLocationAddress',\n\t\tvalue: function setIpLocationAddress(iplocation) {\n\t\t\tif (!!global._client) // 要确保在 createClient 之前执行\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\tif (!iplocation || iplocation.trim() === '') {\n\t\t\t\treturn; // throw new TypeError('iplocation');\n\t\t\t}\n\n\t\t\t_iplocation2.default.IplocationAddress = iplocation;\n\t\t}\n\n\t\t/**\n   * set iplocation port\n   * - 应用于 私有云部署\n   * - 要确保在 creatClient 之前执行\n   * @param {number} iplocation port \n   */\n\n\t}, {\n\t\tkey: 'setIpLocationPort',\n\t\tvalue: function setIpLocationPort(port) {\n\t\t\tif (!!global._client) // 要确保在 createClient 之前执行\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t_iplocation2.default.IplocationPort = port;\n\t\t}\n\n\t\t/**\n   * Dev's can leaverage this method for internal domain deployment.\n  * - 要确保在 createClient 之前执行\n   * @param {Any} conf \n   * {\n   *  urls: 'turn server addresses, \n   *  credential: 'as key word mean',\n   *  username: 'as key word mean'\n   * } \n   */\n\n\t}, {\n\t\tkey: 'setTurnConf',\n\t\tvalue: function setTurnConf(conf) {\n\t\t\tif (!!global._client) // 要确保在 createClient 之前执行\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t_client2.default.TurnConf = conf;\n\t\t}\n\t}]);\n\treturn TTTRtcWeb;\n}(_events.EventEmitter);\n\nexports.default = TTTRtcWeb;\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/_webpack@4.41.6@webpack/buildin/global.js */ \"./node_modules/_webpack@4.41.6@webpack/buildin/global.js\")))\n\n/***/ }),\n\n/***/ \"./lib/client.js\":\n/*!***********************!*\\\n  !*** ./lib/client.js ***!\n  \\***********************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/keys.js\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/regenerator/index.js\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = __webpack_require__(/*! babel-runtime/helpers/asyncToGenerator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/asyncToGenerator.js\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _logger = __webpack_require__(/*! ./logger */ \"./lib/logger.js\");\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nvar _iplocation = __webpack_require__(/*! ./3tmodule/iplocation */ \"./lib/3tmodule/iplocation.js\");\n\nvar _iplocation2 = _interopRequireDefault(_iplocation);\n\nvar _utils = __webpack_require__(/*! ./utils */ \"./lib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _stream = __webpack_require__(/*! ./stream */ \"./lib/stream.js\");\n\nvar _stream2 = _interopRequireDefault(_stream);\n\nvar _mslib = __webpack_require__(/*! ./mslib */ \"./lib/mslib/index.js\");\n\nvar mediasoupClient = _interopRequireWildcard(_mslib);\n\nvar _events = __webpack_require__(/*! events */ \"./node_modules/_events@3.1.0@events/events.js\");\n\nvar _config = __webpack_require__(/*! ./config */ \"./lib/config.js\");\n\nvar config = _interopRequireWildcard(_config);\n\nvar _protoo = __webpack_require__(/*! ./protoo */ \"./lib/protoo/index.js\");\n\nvar protooClient = _interopRequireWildcard(_protoo);\n\nvar _utils2 = __webpack_require__(/*! ./protoo/utils */ \"./lib/protoo/utils.js\");\n\nvar protooUtils = _interopRequireWildcard(_utils2);\n\nvar _stats = __webpack_require__(/*! ./stats */ \"./lib/stats.js\");\n\nvar _stats2 = _interopRequireDefault(_stats);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar getStats = __webpack_require__(/*! ./getStats */ \"./lib/getStats.js\");\n\nvar logger = new _logger2.default('<Client>');\n\n/**\n * @type {Any} TURN'sconfigure for internal domain.\n */\nvar turnConf = {};\n\nvar clientConnState = {\n\tDISCONNECTED: 'DISCONNECTED', // 连接断开。该状态表示 SDK 处于以下任一阶段：1. 调用 Client.join 加入频道前的初始化阶段；2. 调用 Client.leave 后的离开频道阶段\n\tCONNECTING: 'CONNECTING', // 正在连接中。在调用 Client.join 或者连接中断自动重连的时候为此状态。\n\tCONNECTED: 'CONNECTED',\n\tDISCONNECTING: 'DISCONNECTING' // 正在断开连接。在调用 Client.leave 的时候为此状态。\n};\n\n/*\n// Client 构造函数参数结构如下：\n{\n\taudioCodec: @type {string} -- 取值 : opus | isac -- 默认值为 isac \n\trole: @type {string} -- 取值 1 | 2 | 3\n\tdisableRtmpVideo: @type {Boolean} (可选参数)\n\trtmpUrl: @type {string} (可选参数)\n\tvideoMixerBGIUrl: @type {string} (可选参数)\n}\n\n注： role = '1|2|3'\n1: 主播; 2: 副播; 3: 观众\n\n注： disableRtmpVideo = 'true|false'\n是否仅向CDN推音频\n\n注： rtmpUrl：（可选参数）如果需要自行指定推流地址，可设置该参数\n*/\n\nvar Client = function (_EventEmitter) {\n\t(0, _inherits3.default)(Client, _EventEmitter);\n\n\tfunction Client() {\n\t\tvar spec = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\t\t(0, _classCallCheck3.default)(this, Client);\n\n\t\t// Whether we should be a spy.\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Client.__proto__ || (0, _getPrototypeOf2.default)(Client)).call(this));\n\n\t\t_this._spy = false;\n\n\t\t// Closed flag.\n\t\t_this._closed = false;\n\n\t\t// 设备列表\n\t\t_this._devices = null;\n\n\t\t// My peer name.\n\t\t_this._peerName = '';\n\n\t\t// Transport for sending.\n\t\t// The defualt sending tranport.\n\t\t_this._sendTransport = null;\n\n\t\t// Transport for receiving.\n\t\t_this._recvTransport = null;\n\n\t\t// Local multiple webcam's producers.\n\t\t// There have only two tracks(mic/audio and webcam/video) or one track binding to one stream.\n\t\t// The key is StreamID, value is producer.\n\t\t// There produces contianer consists the peer's streams.\n\t\t_this._mapWebcamProducers = new _map2.default();\n\n\t\t// Local multiple mic's producers.\n\t\t// key is streamID, value is producer.\n\t\t_this._mapMicProducers = new _map2.default();\n\n\t\t// local multiple webcam's sending transports\n\t\t// The key is streamid, value transport. \n\t\t// It's associate with map webcam producers.\n\t\t_this._mapVideoSendTransports = new _map2.default();\n\n\t\t// 仅仅用于记录\n\t\t_this._publishStreams = new _map2.default();\n\n\t\t_this._protooSessionId = '';\n\t\t_this._protoo = null;\n\n\t\t// 仅仅用于记录 -- 备查\n\t\t_this._remoteStreams = new _map2.default();\n\n\t\t// \n\t\t_this._remoteVideos = new _map2.default();\n\n\t\t_this._publishs = new _map2.default();\n\t\t// only for stat\n\t\t_this._subscribes = new _map2.default();\n\n\t\t// 当前 protooTransport 的连接状态\n\t\t_this._protooTransportStat = false;\n\n\t\t_this._room = null;\n\n\t\t// Screen, tab or even video producer.\n\t\t_this._screenProducer = null;\n\n\t\t// Screen transport.\n\t\t// NOTE: screens are special stream thus take it. \n\t\t_this._screenTransport = null;\n\n\t\t// \n\t\t_this.iceRestartTimer = null;\n\n\t\t// 仅仅用于记录\n\t\t_this._iceSendDisconnectedCnt = 0;\n\t\t_this._iceRecvDisconnectedCnt = 0;\n\n\t\t// The peers.\n\t\t// Peer's have two produce maps, one is mic_producers, anthor is webcam_producer.\n\t\t// The peers's key is peer_id, value is peer. \n\t\t_this._peers = new _map2.default();\n\n\t\t// transports stats.\n\t\t_this._stats = new _stats2.default();\n\n\t\t//Subscribes the transport to RTC stats retrieved via the stats event.\n\t\t_this._interval = 3000;\n\n\t\t// IPIP return mechine's ip.\n\t\t_this._ip = '';\n\n\t\t_this._token = '';\n\n\t\t// spec\n\t\t_this._spec = spec;\n\n\t\t// using simulcast.\n\t\t_this._useSimulcast = false;\n\n\t\t_this._tryJoin = 0;\n\t\t_this._joinTimer = null;\n\n\t\t// client conn state\n\t\t_this._connState = clientConnState.DISCONNECTED;\n\n\t\t// is joined room.\n\t\t_this._joined = false;\n\n\t\t_this._appId = '';\n\t\t_this._uid = '';\n\t\t_this._roomId = '';\n\n\t\tvar isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\t\tvar ac = !!spec.audioCodec && spec.audioCodec.trim() !== '' ? spec.audioCodec : 'isac';\n\t\t// 指定音频编码\n\t\t_this._audioCodec = isSafari ? 'opus' : ac;\n\t\t//\n\t\t_this._disableRtmpVideo = Boolean(spec.disableRtmpVideo);\n\n\t\t_this._timesOfLinkGW = 1;\n\t\t_this._linkGWTime = 0;\n\t\t_this._sendGWTime = undefined;\n\t\t_this._sendEnterTime = undefined;\n\n\t\tglobal.g_appid = '';\n\t\tglobal.g_userid = '';\n\t\tglobal.g_roomid = '';\n\t\tglobal.g_server = '';\n\n\t\t// rtmp url validate.\n\t\tif (typeof spec.rtmpUrl === 'string' && spec.rtmpUrl.trim() !== '') {\n\t\t\t/*\n   let pattern = new RegExp('^(rtmp?:\\\\/\\\\/)?' + // protocol\n   \t'((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|' + // domain name\n   \t'((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))' + // OR ip (v4) address\n   \t'(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*' + // port and path\n   \t'(\\\\?[;:&a-z\\\\d%_.~+=-]*)?' + // query string\n   \t'(\\\\#[-a-z\\\\d_]*)?$', 'i'); // fragment locator\n   if (!pattern.test(spec.rtmpUrl))\n   {\n   \tlogger.warn('API createClient() error - spec: rtmpUrl is invalide.');\n   \tthrow new TypeError('rtmp url is invalid')\n   }\n   */\n\n\t\t\t_this._valid_rtmp_url = spec.rtmpUrl.trim();\n\t\t} else {\n\t\t\t_this._valid_rtmp_url = '';\n\t\t}\n\n\t\t// \n\t\tif (typeof spec.videoMixerBGIUrl === 'string' && spec.videoMixerBGIUrl.trim() !== '') {\n\t\t\t_this._videoMixerBGIUrl = spec.videoMixerBGIUrl.trim();\n\t\t} else {\n\t\t\t_this._videoMixerBGIUrl = '';\n\t\t}\n\n\t\tif (!/^[123]$/.test(spec.role)) {\n\t\t\tlogger.warn('API createClient() error - spec: role must be set as 1: master, 2: vice 3: audience.');\n\t\t\tthrow new TypeError('role must be set as 1: master, 2: vice 3: audience');\n\t\t}\n\t\t_this._role = spec.role + '';\n\n\t\tlogger.debug('API createClient() success - ' + (0, _stringify2.default)(spec));\n\n\t\t// only for stat\n\t\t_this._statsInterval = null;\n\t\treturn _this;\n\t}\n\n\t// join room timeout period.\n\n\n\t(0, _createClass3.default)(Client, [{\n\t\tkey: '_startStatInterval',\n\n\n\t\t// \n\t\tvalue: function _startStatInterval() {\n\t\t\tvar _this2 = this;\n\n\t\t\t// only for stat\n\t\t\tthis._statsInterval = setInterval(function () {\n\t\t\t\tvar pubs = [];\n\t\t\t\t_this2._publishs.forEach(function (s, key) {\n\t\t\t\t\tpubs.push(s);\n\t\t\t\t});\n\n\t\t\t\tvar subs = [];\n\t\t\t\t_this2._subscribes.forEach(function (s, key) {\n\t\t\t\t\tsubs.push(s);\n\t\t\t\t});\n\n\t\t\t\tvar remoteVideos = [];\n\t\t\t\t_this2._remoteVideos.forEach(function (s, key) {\n\t\t\t\t\tremoteVideos.push(s);\n\t\t\t\t});\n\n\t\t\t\t// \n\t\t\t\tvar jsonMain = {\n\t\t\t\t\thost: _this2._ip,\n\t\t\t\t\tappId: _this2._appId,\n\t\t\t\t\tuserId: _this2._uid,\n\t\t\t\t\trole: _this2._role,\n\t\t\t\t\troomId: _this2._roomId,\n\t\t\t\t\tconnState: _this2._connState,\n\t\t\t\t\tjoined: _this2._joined,\n\t\t\t\t\ticeSendDisconnCnt: _this2._iceSendDisconnectedCnt,\n\t\t\t\t\ticeRecvDisconnCnt: _this2._iceRecvDisconnectedCnt,\n\t\t\t\t\tpublishs: pubs,\n\t\t\t\t\tsubscribes: subs,\n\t\t\t\t\tremoteVideos: remoteVideos\n\t\t\t\t};\n\t\t\t\tlogger.debug('<CLIENT_STAT> ' + (0, _stringify2.default)(jsonMain));\n\n\t\t\t\t// \n\t\t\t}, 15000);\n\t\t}\n\t}, {\n\t\tkey: '_stopStatInterval',\n\t\tvalue: function _stopStatInterval() {\n\t\t\tif (this._statsInterval === null) return;\n\n\t\t\tclearInterval(this._statsInterval);\n\t\t\tthis._statsInterval = null;\n\t\t}\n\t}, {\n\t\tkey: 'init',\n\n\n\t\t/**\n   * Initialize client object.\n   * @param {string} appId\n      * @param {string|number} uid\n   * @param {function} onSuccess\n   * @param {function} onFailure\n   */\n\t\tvalue: function init(appId, uid, onSuccess, onFailure) {\n\t\t\tvar _this3 = this;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API init() error - parameter: onSuccess invalid');\n\t\t\t\tthrow new TypeError('onSuccess parameter must be a function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API init() error - parameter: onFailure invalid');\n\t\t\t\tthrow new TypeError('onFailure parameter must be a function.');\n\t\t\t}\n\n\t\t\tlogger.debug('API init() appId: ' + appId + ' uid: ' + uid);\n\n\t\t\tif (!appId || ('' + appId).trim() === '') {\n\t\t\t\tlogger.warn('API init() error - parameter: appId invalid');\n\t\t\t\treturn onFailure('must be set appid');\n\t\t\t}\n\n\t\t\tif (!/^[1-9][0-9]{0,18}$/.test(uid)) {\n\t\t\t\tlogger.warn('API init() error - parameter: userId invalid');\n\t\t\t\treturn onFailure('userId must be number');\n\t\t\t}\n\n\t\t\t/*\n   if (uid > (Math.pow(2, 32) - 1))\n   {\n   \tlogger.warn('API init() error - parameter: userId is out of range.');\n   \treturn 'userId number is out of range.');\n   }\n   */\n\n\t\t\tthis._uid = '' + uid;\n\n\t\t\tglobal.g_appid = appId;\n\t\t\tglobal.g_userid = this._uid;\n\n\t\t\tthis._appId = appId;\n\t\t\tthis._stats.setAppid(appId);\n\n\t\t\t// \n\t\t\tthis._startStatInterval();\n\n\t\t\tvar msHost = _iplocation2.default.MediaServerAddress;\n\n\t\t\tif (!!msHost && msHost.trim() !== '') {\n\t\t\t\tmsHost = msHost.trim();\n\t\t\t\tthis._ip = msHost;\n\t\t\t\tthis._stats.setDomain(this._ip);\n\n\t\t\t\tlogger.debug('API init() success - server: ' + this._ip);\n\n\t\t\t\t// \n\t\t\t\tthis._watchDeviceChange();\n\n\t\t\t\treturn onSuccess();\n\t\t\t} else {\n\t\t\t\tthis._ipLocation = new _iplocation2.default(appId, +uid, function (ipRes, gwInfo) {\n\t\t\t\t\tlogger.debug('API init() iplocation success - server: ' + ipRes.domain);\n\n\t\t\t\t\t// \n\t\t\t\t\t_this3._ip = ipRes.domain;\n\n\t\t\t\t\t_this3._stats.setDomain(_this3._ip);\n\t\t\t\t\t_this3._stats.setGWInfo(gwInfo);\n\t\t\t\t\t_this3._stats.setIPlocationInfo(_this3._ipLocation);\n\n\t\t\t\t\t// \n\t\t\t\t\t_this3._watchDeviceChange();\n\n\t\t\t\t\treturn onSuccess();\n\t\t\t\t}, function (e) {\n\t\t\t\t\t// \n\t\t\t\t\t_this3._stopStatInterval();\n\n\t\t\t\t\t// \n\t\t\t\t\tlogger.warn('API init() failed - iplocation error: ' + e.toString());\n\n\t\t\t\t\treturn onFailure('iplocation error: ' + e.toString());\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// 启动监视设备拔插\n\n\t}, {\n\t\tkey: '_watchDeviceChange',\n\t\tvalue: function _watchDeviceChange() {\n\t\t\tvar _this4 = this;\n\n\t\t\t// 首先列出当前设备列表，以便当发生设备拔插时，做匹配判断\n\t\t\tif (!!navigator.mediaDevices && !!navigator.mediaDevices.enumerateDevices) {\n\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function (devices) {\n\t\t\t\t\t_this4._devices = devices;\n\n\t\t\t\t\tlogger.debug('init() -- devices: ' + (0, _stringify2.default)(_this4._devices));\n\t\t\t\t}).catch(function (err) {\n\t\t\t\t\tlogger.warn('init() enumerateDevices fail - ' + err.toString());\n\t\t\t\t});\n\n\t\t\t\t// \n\t\t\t\tnavigator.mediaDevices.ondevicechange = function (e) {\n\t\t\t\t\tlogger.debug('mediaDevices.ondevicechange - ' + e);\n\n\t\t\t\t\tlogger.debug('ondevicechange -- this._devices: ' + (0, _stringify2.default)(_this4._devices));\n\n\t\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function (devices) {\n\t\t\t\t\t\tlogger.debug('ondevicechange -- curr-devices: ' + (0, _stringify2.default)(devices));\n\n\t\t\t\t\t\t// \n\t\t\t\t\t\tvar pullDevs = [];\n\t\t\t\t\t\t_this4._devices.forEach(function (item, index) {\n\t\t\t\t\t\t\tvar hasFound = false;\n\t\t\t\t\t\t\tdevices.forEach(function (v, i) {\n\t\t\t\t\t\t\t\tif (item.deviceId == v.deviceId && item.kind == v.kind && item.label == v.label && item.groupId == v.groupId) hasFound = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\tif (!hasFound) {\n\t\t\t\t\t\t\t\tif (item.deviceId !== 'communications' && item.deviceId !== 'default') pullDevs.push(item);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// 忽略 deviceId 为 default 或者 communications 的设备\n\n\t\t\t\t\t\tvar plugDevs = [];\n\t\t\t\t\t\tdevices.forEach(function (item, index) {\n\t\t\t\t\t\t\tvar hasFound = false;\n\t\t\t\t\t\t\t_this4._devices.forEach(function (v, i) {\n\t\t\t\t\t\t\t\tif (item.deviceId == v.deviceId && item.kind == v.kind && item.label == v.label && item.groupId == v.groupId) hasFound = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\tif (!hasFound) {\n\t\t\t\t\t\t\t\tif (item.deviceId !== 'communications' && item.deviceId !== 'default') plugDevs.push(item);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// 忽略 deviceId 为 default 或者 communications 的设备\n\n\t\t\t\t\t\t// filter\n\t\t\t\t\t\tif (plugDevs.length <= 0 || pullDevs <= 0) {\n\t\t\t\t\t\t\t_this4.emit('device-hot-plug', {\n\t\t\t\t\t\t\t\tplugDevices: plugDevs,\n\t\t\t\t\t\t\t\tpullDevices: pullDevs\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// \n\t\t\t\t\t\t_this4._devices = devices;\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tlogger.warn('init() enumerateDevices fail - ' + err.toString());\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\t// \n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Join room.\n   * @param {String} token - 验证\n   * @param {string|number} roomId - \n   * @param {function} onSuccess - success call back function.\n   * @param {function} onFailure - failure call back function.\n   */\n\n\t}, {\n\t\tkey: 'join',\n\t\tvalue: function join(token, roomId, onSuccess, onFailure) {\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API join() error - parameter: onSuccess invalid');\n\t\t\t\tthrow new TypeError('onSuccess parameter must be a function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API join() error - parameter: onFailure invalid');\n\t\t\t\tthrow new TypeError('onFailure parameter must be a function.');\n\t\t\t}\n\n\t\t\tif (!/^[1-9][0-9]{0,18}$/.test(roomId)) {\n\t\t\t\tlogger.warn('API join() error - parameter: roomId invalid');\n\t\t\t\treturn onFailure('roomId must be number');\n\t\t\t}\n\n\t\t\t/*\n   if (roomId > (Math.pow(2, 32) - 1))\n   {\n   \tlogger.warn('API join() error - parameter: roomId is out of range.');\n   \treturn onFailure('roomId number is out of range');\n   }\n   */\n\n\t\t\tlogger.debug('API join() this._ip: ' + this._ip + ' - params roomId: ' + roomId + ' role: ' + this._role + ' - tryJoin: ' + this._tryJoin);\n\n\t\t\tvar peerName = this._uid;\n\n\t\t\t// turn server leaverage udp protocol.\n\t\t\tvar forceTcp = false;\n\n\t\t\t// \n\t\t\tthis._token = token;\n\n\t\t\troomId += '';\n\t\t\tthis._roomId = roomId;\n\n\t\t\t// for log\n\t\t\tglobal.g_roomid = roomId;\n\t\t\tglobal.g_server = this._ip;\n\t\t\t// \n\n\t\t\tthis._stats.setRoomId(roomId);\n\t\t\tthis._stats.setUserId(peerName);\n\t\t\tthis._stats.setRoleType(+this._role);\n\n\t\t\tvar deviceInfo = mediasoupClient.getDeviceInfo();\n\t\t\tthis._stats.setDeviceInfo(deviceInfo);\n\n\t\t\tthis._peerName = peerName;\n\t\t\tvar protooUrl = utils.getProtooUrl(peerName, roomId, this._appId, this._ip, 3443);\n\n\t\t\tthis._linkGWTime = Date.now();\n\t\t\t// protoo-client Peer instance.\n\t\t\tthis._protooSessionId = protooUtils.randomNumberGenerator();\n\t\t\tthis._protoo = new protooClient.Peer(protooUrl, this._protooSessionId);\n\t\t\tif (!this._protoo) {\n\t\t\t\tthis._innerClose();\n\n\t\t\t\t// \n\t\t\t\tlogger.warn('API join() error - new protooClient.Peer failed.');\n\t\t\t\tonFailure('fail to create protooClient.Peer');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// \n\t\t\tthis.emit('connection-state-change', {\n\t\t\t\tprevState: this._connState,\n\t\t\t\tcurState: clientConnState.CONNECTING\n\t\t\t});\n\t\t\tthis._connState = clientConnState.CONNECTING;\n\n\t\t\t/*\n   // Using default setting.\n   if (!config.privateNet)\n   {\n   \tturnConf.urls = turnConf.urls || `turn:${this._ip}:3478`;\n   \tturnConf.credential = turnConf.credential || config.clientConfig.turnServer.password;\n   \tturnConf.username = turnConf.username || config.clientConfig.turnServer.username;\n   \tturnConf.iceTransportPolicy = turnConf.iceTransportPolicy || config.clientConfig.turnServer.iceTransportPolicy;\n   }\n   else if (typeof turnConf.urls === 'undefined' || turnConf.urls === null)\n   { // using default configure if not set by dev.\n   \tturnConf.urls = `turn:${this._ip}:3478`;\n   \tturnConf.credential = config.clientConfig.turnServer.password;\n   \tturnConf.username = config.clientConfig.turnServer.username;\n   \tturnConf.iceTransportPolicy = config.clientConfig.turnServer.iceTransportPolicy;\n   }\n   */\n\t\t\tturnConf.urls = turnConf.urls || 'turn:' + this._ip + ':3478';\n\t\t\tturnConf.credential = turnConf.credential || config.clientConfig.turnServer.password;\n\t\t\tturnConf.username = turnConf.username || config.clientConfig.turnServer.username;\n\t\t\tturnConf.iceTransportPolicy = turnConf.iceTransportPolicy || config.clientConfig.turnServer.iceTransportPolicy;\n\n\t\t\t// mediasoup client Room instance.\n\t\t\tthis._room = new mediasoupClient.Room({\n\t\t\t\trequestTimeout: 30000,\n\t\t\t\ttransportOptions: {\n\t\t\t\t\tudp: !forceTcp,\n\t\t\t\t\ttcp: Boolean(forceTcp)\n\t\t\t\t},\n\t\t\t\tspy: this._spy,\n\t\t\t\ticeTransportPolicy: turnConf.iceTransportPolicy, // relay, all\n\t\t\t\tturnServers: [{\n\t\t\t\t\t'urls': turnConf.urls,\n\t\t\t\t\t'credential': turnConf.credential,\n\t\t\t\t\t'username': turnConf.username\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tthis._join({\n\t\t\t\tdisplayName: peerName,\n\t\t\t\tdevice: 'webcam'\n\t\t\t}, onSuccess, onFailure);\n\t\t}\n\t}, {\n\t\tkey: '_join',\n\t\tvalue: function _join(_ref, onSuccess, onFailure) {\n\t\t\tvar displayName = _ref.displayName,\n\t\t\t    device = _ref.device;\n\n\t\t\tvar _this5 = this;\n\n\t\t\tthis._protoo.on('open', function (e) {\n\t\t\t\t// 如果该事件并非来自于 本次 protoo \n\t\t\t\tif (e.sid !== _this5._protooSessionId) {\n\t\t\t\t\tlogger.debug('protooPeer event -- [open] - invalid protooSessionId - ignore');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\tlogger.debug('protooPeer event -- [open] - will _joinRoom...');\n\t\t\t\t_this5._stats.setWsState('open');\n\n\t\t\t\t_this5._protooTransportStat = true;\n\n\t\t\t\t_this5._sendGWTime = Date.now();\n\t\t\t\t_this5._linkGWTime = _this5._sendGWTime - _this5._linkGWTime;\n\n\t\t\t\t_this5._joinRoom({ displayName: displayName, device: device }, onSuccess, onFailure);\n\t\t\t});\n\n\t\t\tthis._protoo.on('conn-reconn', function (e) {\n\t\t\t\t// 如果该事件并非来自于 本次 protoo \n\t\t\t\tif (e.sid !== _this5._protooSessionId) {\n\t\t\t\t\tlogger.debug('protooPeer event -- [conn-reconn] - invalid protooSessionId - ignore');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('protooPeer event -- [conn-reconn]');\n\t\t\t\t_this5._stats.setWsState('open');\n\n\t\t\t\t// \n\t\t\t\t_this5._protooTransportStat = true;\n\t\t\t\t// \n\t\t\t\t_this5.emit('connection-state-change', {\n\t\t\t\t\tprevState: _this5._connState,\n\t\t\t\t\tcurState: clientConnState.CONNECTED\n\t\t\t\t});\n\t\t\t\t_this5._connState = clientConnState.CONNECTED;\n\t\t\t});\n\n\t\t\t// \n\t\t\tthis._protoo.on('conn-interrupt', function (e) {\n\t\t\t\t// 如果该事件并非来自于 本次 protoo \n\t\t\t\tif (e.sid !== _this5._protooSessionId) {\n\t\t\t\t\tlogger.debug('protooPeer event -- [conn-interrupt] - invalid protooSessionId - ignore');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('protooPeer event -- [conn-interrupt]');\n\t\t\t\t_this5._stats.setWsState('close');\n\n\t\t\t\t// \n\t\t\t\t_this5._protooTransportStat = false;\n\t\t\t});\n\n\t\t\tthis._protoo.on('reinit', function (e) {\n\t\t\t\t// 如果该事件并非来自于 本次 protoo \n\t\t\t\tif (e.sid !== _this5._protooSessionId) {\n\t\t\t\t\tlogger.debug('protooPeer event -- [reinit] - invalid protooSessionId - ignore');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('protooPeer event -- [reinit] -- Emit [reinit] to APP');\n\t\t\t\t_this5._stats.setWsState('open');\n\n\t\t\t\t// \n\t\t\t\t_this5._innerClose();\n\n\t\t\t\t_this5.emit('reinit');\n\t\t\t\t// \n\t\t\t\t_this5._protooTransportStat = true;\n\n\t\t\t\t_this5._joinRoom({ displayName: displayName, device: device }, function () {}, function () {});\n\t\t\t});\n\n\t\t\tthis._protoo.on('connecting', function (e) {\n\t\t\t\t// 如果该事件并非来自于 本次 protoo \n\t\t\t\tif (e.sid !== _this5._protooSessionId) {\n\t\t\t\t\tlogger.debug('protooPeer event -- [connecting] - invalid protooSessionId - ignore');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\t_this5.emit('connection-state-change', {\n\t\t\t\t\tprevState: _this5._connState,\n\t\t\t\t\tcurState: clientConnState.CONNECTING\n\t\t\t\t});\n\t\t\t\t_this5._connState = clientConnState.CONNECTING;\n\t\t\t});\n\n\t\t\tthis._protoo.on('close', function (e) {\n\t\t\t\t// 如果该事件并非来自于 本次 protoo \n\t\t\t\tif (e.sid !== _this5._protooSessionId) {\n\t\t\t\t\tlogger.debug('protooPeer event -- [close] - invalid protooSessionId - ignore');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t_this5._stats.setWsState('close');\n\n\t\t\t\t// \n\t\t\t\t_this5._protooTransportStat = false;\n\n\t\t\t\t// \n\t\t\t\t_this5._joined = false;\n\n\t\t\t\tif (_this5._closed) return;\n\n\t\t\t\t// \n\t\t\t\t_this5.emit('connection-state-change', {\n\t\t\t\t\tprevState: _this5._connState,\n\t\t\t\t\tcurState: clientConnState.DISCONNECTED\n\t\t\t\t});\n\t\t\t\t_this5._connState = clientConnState.DISCONNECTED;\n\n\t\t\t\tlogger.warn('API protooPeer event -- [close] -- Emit [disconnected] to APP');\n\t\t\t\t_this5.emit('disconnected');\n\n\t\t\t\t_this5.close();\n\t\t\t});\n\n\t\t\tthis._protoo.on('request', function (e, request, accept, reject) {\n\t\t\t\t// 如果该事件并非来自于 本次 protoo \n\t\t\t\tif (e.sid !== _this5._protooSessionId) {\n\t\t\t\t\tlogger.debug('protooPeer event -- [request] - invalid protooSessionId - ignore');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// logger.debug(\n\t\t\t\t//     '_handleProtooRequest() [method:%s, data:%o]',\n\t\t\t\t//     request.method, request.data);\n\t\t\t\tswitch (request.method) {\n\t\t\t\t\tcase 'mediasoup-notification':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taccept();\n\n\t\t\t\t\t\t\tvar notification = request.data;\n\n\t\t\t\t\t\t\tif (_this5._room !== null) _this5._room.receiveNotification(notification);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'display-name-changed':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taccept();\n\n\t\t\t\t\t\t\t// eslint-disable-next-line no-shadow\n\t\t\t\t\t\t\tvar _request$data = request.data,\n\t\t\t\t\t\t\t    peerName = _request$data.peerName,\n\t\t\t\t\t\t\t    _displayName = _request$data.displayName,\n\t\t\t\t\t\t\t    oldDisplayName = _request$data.oldDisplayName;\n\n\n\t\t\t\t\t\t\tif (_this5._room !== null) {\n\t\t\t\t\t\t\t\t// NOTE: Hack, we shouldn't do this, but this is just a demo.\n\t\t\t\t\t\t\t\tvar peer = _this5._room.getPeerByName(peerName);\n\n\t\t\t\t\t\t\t\tif (!peer) {\n\t\t\t\t\t\t\t\t\tlogger.warn('display-name-changed peer not found');\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tpeer.appData.displayName = _displayName;\n\t\t\t\t\t\t\t\tlogger.debug('display-name-changed displayName: ' + _displayName + ' peerName: ' + peerName);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase '3T_applySpeak':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taccept();\n\t\t\t\t\t\t\t// auto aprove(not deny) the applying.\n\t\t\t\t\t\t\t_this5._protoo.send('approveSpeak', request.data);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'active-speaker':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taccept();\n\t\t\t\t\t\t\tvar _peerName = request.data.peerName;\n\t\t\t\t\t\t\t// logger.debug('RoomActiveSpeaker', peerName);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlogger.warn('protoo.requst event -- [' + request.method + '] unknown protoo method');\n\n\t\t\t\t\t\t\treject(404, 'unknown method');\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// NOTE: Custom defined signals by server notification.\n\t\t\tthis._protoo.on('notification', function (e, notification) {\n\t\t\t\t// 如果该事件并非来自于 本次 protoo \n\t\t\t\tif (e.sid !== _this5._protooSessionId) {\n\t\t\t\t\tlogger.debug('protooPeer event -- [notification] - invalid protooSessionId - ignore');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tswitch (notification.method) {\n\t\t\t\t\tcase '3T_sessionid':\n\t\t\t\t\t\t// define by BIG-NET.\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar sessionId = notification.data.sessionId;\n\n\t\t\t\t\t\t\tlogger.debug('protooPeer event -- [notification:3T_sessionid] - ' + sessionId);\n\n\t\t\t\t\t\t\t_this5._stats.setSessionId(sessionId);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase '3T_connectid':\n\t\t\t\t\t\t// define by BIG-NET.\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar connectId = notification.data.connectId;\n\n\t\t\t\t\t\t\t_this5._stats.setConnectionId(connectId);\n\n\t\t\t\t\t\t\tlogger.debug('protooPeer event -- [notification:3T_connectid] - ' + connectId);\n\n\t\t\t\t\t\t\t_this5._joined = true;\n\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\tif (!!_this5._joinTimer) {\n\t\t\t\t\t\t\t\tclearTimeout(_this5._joinTimer);\n\t\t\t\t\t\t\t\t_this5._joinTimer = null;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t_this5.emit('connection-state-change', {\n\t\t\t\t\t\t\t\tprevState: _this5._connState,\n\t\t\t\t\t\t\t\tcurState: clientConnState.CONNECTED\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t_this5._connState = clientConnState.CONNECTED;\n\n\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_connectid] -- Emit [enter] to APP');\n\n\t\t\t\t\t\t\tonSuccess('You are join the room');\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase '3T_kickout':\n\t\t\t\t\t\t// kickout notified by svc and the leave by client ourself.\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// if (this._role == '1') {\n\t\t\t\t\t\t\t//     logger.warn('I was master in room, then cannot be kickout');\n\t\t\t\t\t\t\t// } else {\n\t\t\t\t\t\t\t//     this.emit('kickoout', notification.data);\n\t\t\t\t\t\t\t//     this.close();\n\t\t\t\t\t\t\t// }\n\n\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_kickout] - Emit [kickout] to APP - ' + (0, _stringify2.default)(notification.data));\n\n\t\t\t\t\t\t\t_this5.emit('kickout', notification.data);\n\t\t\t\t\t\t\t_this5.close();\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase '3T_CDN_URL':\n\t\t\t\t\t\t// suport CND subscribed.\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar CDN_url = notification.data.CDN_url;\n\n\n\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_CDN_URL] url: ' + CDN_url + ' - Emit [CDN_url] to APP');\n\n\t\t\t\t\t\t\t_this5.emit({ 'CDN_url': CDN_url });\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'active-speaker':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar peerName = notification.data.peerName;\n\n\t\t\t\t\t\t\t// logger.debug('RoomActiveSpeaker', peerName);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase '3T_audiencevisible':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar peerId = notification.data.peerId;\n\n\n\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_audiencevisible] peerId: ' + peerId + ' - Emit [peer-join] to APP');\n\t\t\t\t\t\t\tvar peer = _this5._peers.get(peerId);\n\t\t\t\t\t\t\tif (peer) {\n\t\t\t\t\t\t\t\t_this5.emit('peer-join', { userID: peerId, peer: peer });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase '3T_changerole':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _notification$data = notification.data,\n\t\t\t\t\t\t\t    _peerId = _notification$data.peerId,\n\t\t\t\t\t\t\t    role = _notification$data.role;\n\n\n\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_changerole] peerId: ' + _peerId + ' - role: ' + role);\n\t\t\t\t\t\t\tvar _peer = _this5._peers.get(_peerId);\n\t\t\t\t\t\t\t_peer.appData.role = role.toString();\n\t\t\t\t\t\t\tif (_peer) {\n\t\t\t\t\t\t\t\tif (_peer.appData.role === '2') {\n\t\t\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_changerole] peerId: ' + _peerId + ' role: ' + role + ' - Emit [peer-join] to APP');\n\t\t\t\t\t\t\t\t\t_this5.emit('peer-join', { userID: _peerId, peer: _peer });\n\t\t\t\t\t\t\t\t} else if (_peer.appData.role === '3') {\n\t\t\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_changerole] peerId: ' + _peerId + ' role: ' + role + ' - Emit [peer-leave] to APP');\n\t\t\t\t\t\t\t\t\t_this5.emit('peer-leave', { userID: _peerId, streams: [] });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tcase '3T_rtmpfailure':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _notification$data2 = notification.data,\n\t\t\t\t\t\t\t    roomId = _notification$data2.roomId,\n\t\t\t\t\t\t\t    url = _notification$data2.url;\n\n\n\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_rtmpfailure] url: ' + url + ' - Emit [rtmp-failure] to APP');\n\t\t\t\t\t\t\t_this5.emit('rtmp-failure', { url: url, channelId: roomId });\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tcase '3T_rtmpsuccess':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _notification$data3 = notification.data,\n\t\t\t\t\t\t\t    _roomId = _notification$data3.roomId,\n\t\t\t\t\t\t\t    _url = _notification$data3.url;\n\n\n\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_rtmpsuccess] url: ' + _url + ' - Emit [rtmp-success] to APP');\n\t\t\t\t\t\t\t_this5.emit('rtmp-success', { url: _url, channelId: _roomId });\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tcase '3T_needrefreshtoken':\n\t\t\t\t\t\t// close to expire.\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlogger.debug('API protooPeer event -- [notification:3T_needrefreshtoken] - Emit [onTokenPrivilegeWillExpire] to APP');\n\t\t\t\t\t\t\t_this5.emit('onTokenPrivilegeWillExpire');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlogger.warn('protoo.requst event -- [' + notification.method + '] unknown protoo method');\n\n\t\t\t\t\t\t\t// reject(404, 'unknown method');\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_joinRoom',\n\t\tvalue: function _joinRoom(_ref2, onSuccess, onFailure) {\n\t\t\tvar displayName = _ref2.displayName,\n\t\t\t    device = _ref2.device;\n\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('this._joinRoom() try to join room...');\n\t\t\t// NOTE: We allow rejoining (room.join()) the same mediasoup Room when Protoo\n\t\t\t// WebSocket re-connects, so we must clean existing event listeners. Otherwise\n\t\t\t// they will be called twice after the reconnection.\n\t\t\tthis._room.removeAllListeners();\n\n\t\t\tthis._room.on('close', function (originator, appData) {\n\t\t\t\tif (originator === 'remote') {\n\t\t\t\t\tlogger.warn('room event -- mediasoup Peer/Room remotely closed -- appData: ' + (0, _stringify2.default)(appData));\n\n\t\t\t\t\t_this6._stats.stopHeartBeat();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._room.on('request', function (request, callback, errback) {\n\t\t\t\t// logger.debug(`room event -- sending mediasoup [request:${request.method}]: ${JSON.stringify(request)}`);\n\t\t\t\tlogger.debug('room event -- [request:' + request.method + '] sending to mediasoup ');\n\n\t\t\t\t_this6._protoo.send('mediasoup-request', request).then(callback).catch(errback);\n\t\t\t});\n\n\t\t\tthis._room.on('notify', function (notification) {\n\t\t\t\t// logger.debug(`room event -- sending mediasoup [notification:${notification.method}]: ${JSON.stringify(notification)}`);\n\t\t\t\tlogger.debug('room event -- [notification:' + notification.method + '] sending to mediasoup');\n\n\t\t\t\tif (_this6._closed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t_this6._protoo.send('mediasoup-notification', notification).catch(function (error) {\n\t\t\t\t\tlogger.warn('Send mediasoup notification failed - ' + error.toString());\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis._room.on('newpeer', function (peer) {\n\t\t\t\tlogger.debug('room event -- [newpeer] peerName: ' + peer.name);\n\t\t\t\t_this6._peers.set(peer.name, peer);\n\t\t\t\t_this6._handlePeer(peer);\n\t\t\t});\n\n\t\t\tthis._joinTimer = setTimeout(function () {\n\t\t\t\tif (_this6._joined) {\n\t\t\t\t\tif (!!_this6._joinTimer) {\n\t\t\t\t\t\tclearTimeout(_this6._joinTimer);\n\t\t\t\t\t}\n\t\t\t\t\t_this6._joinTimer = null;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t_this6._tryJoin++;\n\t\t\t\t// \n\t\t\t\tif (+_this6._tryJoin < 3) {\n\t\t\t\t\t// \n\t\t\t\t\t_this6._innerClose();\n\n\t\t\t\t\t_this6._room = null;\n\t\t\t\t\t// \n\n\t\t\t\t\t// Close protoo Peer (wait a bit so mediasoup-client can send\n\t\t\t\t\t// the 'leaveRoom' notification).\n\t\t\t\t\tif (_this6._protoo) {\n\t\t\t\t\t\t_this6._protoo.close();\n\t\t\t\t\t\t_this6._protoo = null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// \n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t_this6.join(_this6._token, _this6._roomId, onSuccess, onFailure);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn('timeout -- join room timeout');\n\t\t\t\t\t_this6._joinTimer = null;\n\n\t\t\t\t\t_this6.close();\n\t\t\t\t\t_this6._stats.sendTimeOutLog(_this6._timesOfLinkGW, +Client.JOIN_ROOM_TIME_OUT * 3);\n\t\t\t\t\tonFailure('join room timeout');\n\t\t\t\t}\n\t\t\t}, Client.JOIN_ROOM_TIME_OUT);\n\n\t\t\tvar appData = {\n\t\t\t\tdisplayName: displayName,\n\t\t\t\tdevice: device,\n\t\t\t\trole: this._role,\n\t\t\t\taudioCodec: this._audioCodec,\n\t\t\t\ttoken: this._token || ''\n\t\t\t};\n\t\t\t// master role application data.\n\t\t\tif (this._role === '1') {\n\t\t\t\tif (this._valid_rtmp_url === '') // 如果未设置 rtmp url，则先使用内部 rtmp，以确保后续可通过 setRtmpUrl 可正常切换到用户所提供的cdn上\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._valid_rtmp_url = 'rtmp://' + this._ip + ':11936/sdk/' + this._appId + '-' + this._roomId + '-' + this._uid + '-' + utils.uuid();\n\t\t\t\t\t}\n\t\t\t\t//\n\t\t\t\tif (this._valid_rtmp_url !== '') {\n\t\t\t\t\tappData.rtmpUrl = this._valid_rtmp_url;\n\t\t\t\t\tappData.disableRtmpVideo = this._disableRtmpVideo;\n\t\t\t\t}\n\t\t\t\t// \n\t\t\t\tappData.videoMixerBGIUrl = this._videoMixerBGIUrl;\n\t\t\t}\n\n\t\t\tthis._room.join(this._peerName, appData).then(function () {\n\t\t\t\t// 首先中止 ice restart timer\n\t\t\t\t_this6._stopIceRestartTimer();\n\n\t\t\t\t// Create Transport for sending (unless we are spy).\n\t\t\t\tif (!_this6._spy) {\n\t\t\t\t\t_this6._sendTransport = _this6._room.createTransport('send', { media: 'SEND_MIC_WEBCAM' });\n\n\t\t\t\t\t_this6._sendTransport.on('close', function (originator) {\n\t\t\t\t\t\tlogger.debug('_sendTransport event -- [close] originator: ' + (0, _stringify2.default)(originator));\n\t\t\t\t\t});\n\n\t\t\t\t\t// this._sendTransport.enableStats(this._interval);\n\n\t\t\t\t\t// this._sendTransport.on('stats', (stats) => {\n\t\t\t\t\t//     this._stats.pushStats(stats);\n\t\t\t\t\t// });\n\n\t\t\t\t\t_this6._sendTransport.on('connectionstatechange', function (connectionstate) {\n\t\t\t\t\t\tlogger.debug('_sendTransport event -- [connectionstatechange] connectionstat: ' + connectionstate);\n\n\t\t\t\t\t\tif (connectionstate === 'disconnected') {\n\t\t\t\t\t\t\t// only for stat\n\t\t\t\t\t\t\t_this6._iceSendDisconnectedCnt++;\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\tlogger.debug('_sendTransport event -- [connectionstatechange:disconnected] - will restart ice after ' + Client.TIMEOUT_ICE_DISCONNECTED + 's');\n\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\t_this6._retryRestartIce(_this6._sendTransport);\n\t\t\t\t\t\t\t}, Client.TIMEOUT_ICE_DISCONNECTED);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (connectionstate === 'failed') {\n\t\t\t\t\t\t\tlogger.debug('_sendTransport event -- [connectionstatechange:failed] - will restart ice');\n\t\t\t\t\t\t\t// Can't receved failed event on the chrome 76.0.3809.87 64 bits version.\n\t\t\t\t\t\t\t_this6._retryRestartIce(_this6._sendTransport);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (connectionstate === 'connected') {\n\t\t\t\t\t\t\tlogger.debug('_sendTransport event -- [connectionstatechange:connected]');\n\t\t\t\t\t\t\t// for webrtc internals\n\t\t\t\t\t\t\tgetStats(_this6._sendTransport._handler._pc, function (result) {\n\t\t\t\t\t\t\t\t// console.log(`<STAT> _sendTransport -- ${JSON.stringify(result)}`);\n\t\t\t\t\t\t\t\t_this6._stats.setWebrtcInternalSendStats(result);\n\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\t// end for webrtc internals\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this6._stats.setSendIceState(connectionstate);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Create Transport for recipient.\n\t\t\t\t_this6._recvTransport = _this6._room.createTransport('recv', { media: 'RECV' });\n\n\t\t\t\t_this6._recvTransport.on('close', function (originator) {\n\t\t\t\t\tlogger.debug('_recvTransport event -- [close] originator: ' + (0, _stringify2.default)(originator));\n\t\t\t\t});\n\n\t\t\t\t_this6._recvTransport.on('connectionstatechange', function (connectionstate) {\n\t\t\t\t\tlogger.debug('_recvTransport event -- [connectionstatechange] connectionstate: ' + connectionstate);\n\n\t\t\t\t\tif (connectionstate === 'disconnected') {\n\t\t\t\t\t\t// only for stat\n\t\t\t\t\t\t_this6._iceRecvDisconnectedCnt++;\n\n\t\t\t\t\t\tlogger.debug('_recvTransport event -- [connectionstatechange:disconnected] - will restart ice after ' + Client.TIMEOUT_ICE_DISCONNECTED + 's');\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t_this6._retryRestartIce(_this6._recvTransport);\n\t\t\t\t\t\t}, Client.TIMEOUT_ICE_DISCONNECTED);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (connectionstate === 'failed') {\n\t\t\t\t\t\tlogger.debug('_recvTransport event -- [connectionstatechange:failed] - will restart ice');\n\t\t\t\t\t\t_this6._retryRestartIce(_this6._recvTransport);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (connectionstate === 'connected') {\n\t\t\t\t\t\tlogger.debug('_recvTransport event -- [connectionstatechange:connected]');\n\t\t\t\t\t\t// for webrtc internals\n\t\t\t\t\t\tgetStats(_this6._recvTransport._handler._pc, function (result) {\n\t\t\t\t\t\t\t_this6._stats.setWebrtcInternalRecvStats(result);\n\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t// end for webrtc internals\n\t\t\t\t\t}\n\n\t\t\t\t\t_this6._stats.setRecvIceState(connectionstate);\n\t\t\t\t});\n\n\t\t\t\t// this._recvTransport.enableStats(this._interval);\n\t\t\t\t// this._recvTransport.on('stats', (stats) => {\n\t\t\t\t//     this._stats.pushStats(stats);\n\t\t\t\t// });\n\t\t\t}).then(function () {\n\t\t\t\tif (_this6._spy) return;\n\n\t\t\t\t// Set our media capabilities.\n\t\t\t\t// this._dispatch(stateActions.setMediaCapabilities(\n\t\t\t\t// \t{\n\t\t\t\t// \t\tcanSendMic    : this._room.canSend('audio'),\n\t\t\t\t// \t\tcanSendWebcam : this._room.canSend('video')\n\t\t\t\t// \t}));\n\t\t\t}).then(function () {\n\t\t\t\tlogger.debug('_room.join() mediasoup response.');\n\n\t\t\t\t// filter anchor and vice\n\t\t\t\tvar peers = _this6._room.peers;\n\n\t\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\t\tvar _didIteratorError = false;\n\t\t\t\tvar _iteratorError = undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tfor (var _iterator = (0, _getIterator3.default)(peers), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\t\t\tvar peer = _step.value;\n\n\t\t\t\t\t\t_this6._handlePeer(peer, { notify: false });\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\t_didIteratorError = true;\n\t\t\t\t\t_iteratorError = err;\n\t\t\t\t} finally {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t\t}\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t_this6._stats.startHeartBeat();\n\n\t\t\t\t// 注：待收到 3tconnectId 时，才最终通知上层：成功加入房间\n\t\t\t}).catch(function (error) {\n\t\t\t\t// 如下代码不再执行 -- 完全由 _joinTimer 来控制\n\t\t\t\t/*\n    logger.warn(`_room.join() failed - ${error.toString()}`);\n    this.close();\n    \tthis._stats.sendFailLog(this._timesOfLinkGW, this._linkGWTime, this._sendGWTime, this._sendEnterTime, this._role, error.result || 1);\n    onFailure(`Could not join the room: ${error.toString()}`);\n    */\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Leave the joined room.\n   * @param {function} onSuccess\n   * @param {function} onFailure\n   */\n\n\t}, {\n\t\tkey: 'leave',\n\t\tvalue: function () {\n\t\t\tvar _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(onSuccess, onFailure) {\n\t\t\t\treturn _regenerator2.default.wrap(function _callee$(_context) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context.prev = _context.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\tif (!(typeof onSuccess !== 'function')) {\n\t\t\t\t\t\t\t\t\t_context.next = 3;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.error('API leave() error - parameter: onSuccess invalid');\n\t\t\t\t\t\t\t\tthrow TypeError('onSuccess is not a fucntion.');\n\n\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\tif (!(typeof onFailure !== 'function')) {\n\t\t\t\t\t\t\t\t\t_context.next = 6;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.error('API leave() error - parameter: onFailure invalid');\n\t\t\t\t\t\t\t\tthrow TypeError('onFailure is not a fucntion.');\n\n\t\t\t\t\t\t\tcase 6:\n\n\t\t\t\t\t\t\t\tif (!this._protooTransportStat) {\n\t\t\t\t\t\t\t\t\tlogger.warn('API leave() error - protooTransport broken');\n\n\t\t\t\t\t\t\t\t\t/*\n         onFailure('protooTransport is broken');\n         return;\n         */\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t/*\n         // 更新当前登录状态为 未登录\n         this._joined = false;\n         \tawait this._room.leave();\n         */\n\t\t\t\t\t\t\t\t\tthis.close();\n\n\t\t\t\t\t\t\t\t\tlogger.debug('API leave() success.');\n\t\t\t\t\t\t\t\t\t// return onSuccess();\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\tlogger.warn('API leave() error - ' + e.toString());\n\t\t\t\t\t\t\t\t\t// onFailure(e);\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\tlogger.debug('API leave() finish.');\n\n\t\t\t\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcase 8:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee, this);\n\t\t\t}));\n\n\t\t\tfunction leave(_x2, _x3) {\n\t\t\t\treturn _ref3.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn leave;\n\t\t}()\n\n\t\t/**\n   * 当前是否正在发布流\n   */\n\n\t}, {\n\t\tkey: 'publish',\n\n\n\t\t/**\n   * publish stream.\n   * @param stream wish puslished.\n   * @param {function} onSuccess success call back.\n   * @param {function} onFailure fualure call back.\n   */\n\t\tvalue: function () {\n\t\t\tvar _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4(stream, onSuccess, onFailure) {\n\t\t\t\tvar _this7 = this;\n\n\t\t\t\tvar micProducer, isVideoResume, webcamProducer, audioPublished, videoPublished;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee4$(_context4) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context4.prev = _context4.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\tif (!(typeof onSuccess !== 'function')) {\n\t\t\t\t\t\t\t\t\t_context4.next = 3;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.error('API publish() error - parameter: onSuccess invalid');\n\t\t\t\t\t\t\t\tthrow new TypeError('onSuccess parameter must be a function.');\n\n\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\tif (!(typeof onFailure !== 'function')) {\n\t\t\t\t\t\t\t\t\t_context4.next = 6;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.error('API publish() error - parameter: onFailure invalid');\n\t\t\t\t\t\t\t\tthrow new TypeError('onFailure parameter must be a function.');\n\n\t\t\t\t\t\t\tcase 6:\n\n\t\t\t\t\t\t\t\tlogger.debug('API publish() - streamId: ' + stream.getId());\n\n\t\t\t\t\t\t\t\tif (!(!stream || !stream.streamObj)) {\n\t\t\t\t\t\t\t\t\t_context4.next = 11;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API publish() error - stream is null');\n\t\t\t\t\t\t\t\tonFailure('stream param error');\n\n\t\t\t\t\t\t\t\treturn _context4.abrupt('return');\n\n\t\t\t\t\t\t\tcase 11:\n\t\t\t\t\t\t\t\tif (this._protooTransportStat) {\n\t\t\t\t\t\t\t\t\t_context4.next = 15;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API publish() error - protooTransport is broken');\n\n\t\t\t\t\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\t\t\t\t\treturn _context4.abrupt('return');\n\n\t\t\t\t\t\t\tcase 15:\n\t\t\t\t\t\t\t\tif (this._joined) {\n\t\t\t\t\t\t\t\t\t_context4.next = 19;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API publish() error - non-joined');\n\n\t\t\t\t\t\t\t\tonFailure('non-joined');\n\n\t\t\t\t\t\t\t\treturn _context4.abrupt('return');\n\n\t\t\t\t\t\t\tcase 19:\n\t\t\t\t\t\t\t\tif (!this._spy) {\n\t\t\t\t\t\t\t\t\t_context4.next = 23;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API publish() error - forbidden: user is _spy');\n\t\t\t\t\t\t\t\tonFailure('Permission denied - spy Not allowed publish');\n\t\t\t\t\t\t\t\treturn _context4.abrupt('return');\n\n\t\t\t\t\t\t\tcase 23:\n\t\t\t\t\t\t\t\tif (!(this._role === '3')) {\n\t\t\t\t\t\t\t\t\t_context4.next = 27;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API publish() error - forbidden: Audience No permission');\n\t\t\t\t\t\t\t\tonFailure('Permission denied - Audience Not allowed publish');\n\t\t\t\t\t\t\t\treturn _context4.abrupt('return');\n\n\t\t\t\t\t\t\tcase 27:\n\n\t\t\t\t\t\t\t\t// TODO : stream.userID 的赋值目前应已不需要\n\t\t\t\t\t\t\t\tstream.userID = this._uid;\n\n\t\t\t\t\t\t\t\t// 如果 producer 已存在，则执行 _resumeProducer 即可\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tmicProducer = this._mapMicProducers.get(stream._innerStreamID);\n\n\t\t\t\t\t\t\t\tif (micProducer) {\n\t\t\t\t\t\t\t\t\tthis._resumeProducer(micProducer);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tisVideoResume = false;\n\t\t\t\t\t\t\t\t// 如果 producer 已存在，则执行 _resumeProducer 即可\n\n\t\t\t\t\t\t\t\twebcamProducer = this._mapWebcamProducers.get(stream._innerStreamID);\n\n\t\t\t\t\t\t\t\tif (!webcamProducer) {\n\t\t\t\t\t\t\t\t\t_context4.next = 38;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis._resumeProducer(webcamProducer);\n\n\t\t\t\t\t\t\t\tisVideoResume = true;\n\t\t\t\t\t\t\t\t// 重新打开摄像头\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t_context4.next = 37;\n\t\t\t\t\t\t\t\treturn stream._openCamera().catch(function (e) {\n\t\t\t\t\t\t\t\t\tlogger.warn('API publish() error - ' + e.toString());\n\t\t\t\t\t\t\t\t\tisVideoResume = false;\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tcase 37:\n\n\t\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t\t// 在 非publish 状态下，曾经调用过 replaceTrack，故此处应执行一下 updateTrack\n\t\t\t\t\t\t\t\tif (stream._needUpdateVideoStreamBitrate) {\n\t\t\t\t\t\t\t\t\tthis._updateVideoTrack(stream, stream.videoTracks, stream._updateConstraints);\n\t\t\t\t\t\t\t\t\t// 要及时将 stream._needUpdateVideoStreamBitrate 重置为 false\n\t\t\t\t\t\t\t\t\tstream._needUpdateVideoStreamBitrate = false;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcase 38:\n\n\t\t\t\t\t\t\t\t// 如下先将 stream 上如下这些事件的 listener 清除 -- 随后再重新绑定\n\t\t\t\t\t\t\t\t// 通过 事件 的方式，那么在 Stream 内部将不再需要 global.g_client 的方式了\n\t\t\t\t\t\t\t\tstream.removeAllListeners('pause-video');\n\t\t\t\t\t\t\t\tstream.removeAllListeners('pause-audio');\n\t\t\t\t\t\t\t\tstream.removeAllListeners('resume-audio');\n\t\t\t\t\t\t\t\tstream.removeAllListeners('resume-video');\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tstream.on('pause-video', function (stream) {\n\t\t\t\t\t\t\t\t\t_this7.pauseWebcam(stream);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tstream.on('pause-audio', function (stream) {\n\t\t\t\t\t\t\t\t\t_this7.pauseMic(stream);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tstream.on('resume-audio', function (stream) {\n\t\t\t\t\t\t\t\t\t_this7.resumeMic(stream);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tstream.on('resume-video', function (stream) {\n\t\t\t\t\t\t\t\t\t_this7.resumeWebcam(stream);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// \n\n\t\t\t\t\t\t\t\t// 如果 producer 已存在，则直接返回\n\n\t\t\t\t\t\t\t\tif (!(webcamProducer || micProducer)) {\n\t\t\t\t\t\t\t\t\t_context4.next = 53;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.debug('API publish() success - streamId: ' + stream.innerStreamID + ' - Emit [stream-published] to APP');\n\t\t\t\t\t\t\t\tstream._published = true;\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tthis._publishs.set(stream.innerStreamID, stream.innerStreamID);\n\n\t\t\t\t\t\t\t\tthis.emit('stream-published', { stream: stream });\n\n\t\t\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t\t\t\treturn _context4.abrupt('return');\n\n\t\t\t\t\t\t\tcase 53:\n\t\t\t\t\t\t\t\tif (!(!stream.streamObj.getAudioTracks()[0] && !stream.streamObj.getVideoTracks()[0])) {\n\t\t\t\t\t\t\t\t\t_context4.next = 57;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.debug('API publish() error - audioTrack or videoTrack non-exist.');\n\t\t\t\t\t\t\t\tonFailure('no audio or video kind track');\n\t\t\t\t\t\t\t\treturn _context4.abrupt('return');\n\n\t\t\t\t\t\t\tcase 57:\n\n\t\t\t\t\t\t\t\t// 如果之前 mic 、 webcam producer 都不存在，则此处将执行完整的 producer 过程\n\n\t\t\t\t\t\t\t\taudioPublished = false;\n\t\t\t\t\t\t\t\tvideoPublished = false;\n\n\t\t\t\t\t\t\t\t// NOTE: Don't depend on this Promise to continue (so we don't do return).\n\n\t\t\t\t\t\t\t\t_promise2.default.resolve()\n\t\t\t\t\t\t\t\t// Add our mic.\n\t\t\t\t\t\t\t\t.then((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n\t\t\t\t\t\t\t\t\treturn _regenerator2.default.wrap(function _callee2$(_context2) {\n\t\t\t\t\t\t\t\t\t\twhile (1) {\n\t\t\t\t\t\t\t\t\t\t\tswitch (_context2.prev = _context2.next) {\n\t\t\t\t\t\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (_this7._room.canSend('audio')) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.next = 3;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.warn('API publish() error - audio cannot Send.');\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn _context2.abrupt('return');\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream.streamObj.getAudioTracks()[0]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.next = 6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('API publish() error - audioTrack non-exist.');\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn _context2.abrupt('return');\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 6:\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.prev = 6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.next = 9;\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn _this7._setMicProducer(stream);\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 9:\n\t\t\t\t\t\t\t\t\t\t\t\t\taudioPublished = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t_this7._stats.audioOpen = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.next = 16;\n\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 13:\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.prev = 13;\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.t0 = _context2['catch'](6);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.warn('API publish() error - ' + _context2.t0.toString());\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 16:\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn _context2.stop();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}, _callee2, _this7, [[6, 13]]);\n\t\t\t\t\t\t\t\t})))\n\t\t\t\t\t\t\t\t// Add our webcam (unless the cookie says no).\n\t\t\t\t\t\t\t\t.then((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3() {\n\t\t\t\t\t\t\t\t\treturn _regenerator2.default.wrap(function _callee3$(_context3) {\n\t\t\t\t\t\t\t\t\t\twhile (1) {\n\t\t\t\t\t\t\t\t\t\t\tswitch (_context3.prev = _context3.next) {\n\t\t\t\t\t\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (_this7._room.canSend('video')) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context3.next = 3;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.warn('API publish() error - video cannot Send.');\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn _context3.abrupt('return');\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream.streamObj.getVideoTracks()[0]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context3.next = 6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('API publish() error - videoTrack non-exist.');\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn _context3.abrupt('return');\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 6:\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context3.prev = 6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context3.next = 9;\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn _this7._setWebcamProducer(stream);\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 9:\n\t\t\t\t\t\t\t\t\t\t\t\t\tvideoPublished = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t_this7._stats.videoOpen = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context3.next = 16;\n\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 13:\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context3.prev = 13;\n\t\t\t\t\t\t\t\t\t\t\t\t\t_context3.t0 = _context3['catch'](6);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.warn('API publish() error - ' + _context3.t0.toString());\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 16:\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn _context3.stop();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}, _callee3, _this7, [[6, 13]]);\n\t\t\t\t\t\t\t\t}))).then(function () {\n\t\t\t\t\t\t\t\t\tif (audioPublished || videoPublished) {\n\t\t\t\t\t\t\t\t\t\tstream._published = true;\n\t\t\t\t\t\t\t\t\t\tlogger.debug('API publish() success - streamId: ' + stream.innerStreamID + ' - Emit [stream-published] to APP');\n\n\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\t_this7._publishs.set(stream.innerStreamID, stream.innerStreamID);\n\n\t\t\t\t\t\t\t\t\t\t_this7.emit('stream-published', { stream: stream });\n\n\t\t\t\t\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tonFailure('no audio or video to be sent');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}).catch(function (e) {\n\t\t\t\t\t\t\t\t\tlogger.warn('API publish() error - ' + e.toString());\n\t\t\t\t\t\t\t\t\tonFailure(e);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tcase 60:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context4.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee4, this);\n\t\t\t}));\n\n\t\t\tfunction publish(_x4, _x5, _x6) {\n\t\t\t\treturn _ref4.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn publish;\n\t\t}()\n\n\t\t/**\n   * Unpublish the stream. \n   * @param {Any} stream wish unpulbish.\n   * @param {Function} onSuccess\n   * @param {Function} onFailure\n  * @param {Boolean} closeDev -- 是否关闭设备\n   */\n\n\t}, {\n\t\tkey: 'unpublish',\n\t\tvalue: function unpublish(stream, onSuccess, onFailure, closeDev) {\n\t\t\t// check params.\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API unpublish() error - parameter: onSuccess invalid');\n\t\t\t\tthrow new TypeError('onSuccess parameter must be a function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API unpublish() error - parameter: onFailure invalid');\n\t\t\t\tthrow new TypeError('onFailure parameter must be a function.');\n\t\t\t}\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API unpublish() error - stream is null');\n\t\t\t\tonFailure('Param error - stream');\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API unpublish() error - protooTransport is broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// \n\t\t\tstream.removeAllListeners('pause-video');\n\t\t\tstream.removeAllListeners('pause-audio');\n\t\t\tstream.removeAllListeners('resume-audio');\n\t\t\tstream.removeAllListeners('resume-video');\n\t\t\t// \n\n\t\t\t// NOTE: Nothing to doing if not published of the stream.\n\t\t\tvar micProducer = this._mapMicProducers.get(stream._innerStreamID);\n\t\t\tif (micProducer) {\n\t\t\t\tthis._pauseProducer(micProducer);\n\t\t\t}\n\n\t\t\tvar webcamProducer = this._mapWebcamProducers.get(stream._innerStreamID);\n\t\t\tif (webcamProducer) {\n\t\t\t\tthis._pauseProducer(webcamProducer);\n\n\t\t\t\t// 同时，将关闭本地摄像头设备\n\t\t\t\tif (!!closeDev) {\n\t\t\t\t\tstream._closeCamera();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// \n\t\t\tthis._stats.audioOpen = false;\n\t\t\tthis._stats.videoOpen = false;\n\n\t\t\tstream._published = false;\n\n\t\t\t// \n\t\t\tthis._publishs.delete(stream.innerStreamID);\n\n\t\t\tlogger.debug('API unpublish() success - streamId: ' + stream.innerStreamID + ' - Emit [stream-unpublished] to APP');\n\t\t\tthis.emit('stream-unpublished', { stream: stream });\n\n\t\t\tonSuccess();\n\t\t}\n\n\t\t/**\n   * publish screen.\n  * 该函数废弃 -- 对于屏幕流，也统一采用 publish\n   * @param {object} stream \n   * @param {function} onSuccess \n   * @param {function} onFailure \n   */\n\n\t}, {\n\t\tkey: 'publishScreen',\n\t\tvalue: function publishScreen(stream, onSuccess, onFailure) {\n\t\t\tvar _this8 = this;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API publishScreen() error - parameter: onSuccess invalid');\n\t\t\t\tthrow new TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API publishScreen() error - parameter: onFailure invalid');\n\t\t\t\tthrow new TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!stream || !stream.streamObj) {\n\t\t\t\tlogger.warn('API publishScreen() error - parameter: stream is invalid');\n\t\t\t\tonFailure('Param error - stream is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API publishScreen() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._joined) {\n\t\t\t\tlogger.warn('API publishScreen() error - non-joined');\n\n\t\t\t\tonFailure('non-joined');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Don't produce if we are spy.\n\t\t\tif (this._spy) {\n\t\t\t\tlogger.warn('API publishScreen() error - user is _spy');\n\t\t\t\tonFailure('Permission denied - spy Not allowed publish');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Prohibition for audience.\n\t\t\tif (this._role === '3') {\n\t\t\t\tlogger.warn('API publishScreen() error - forbidden: Audience');\n\t\t\t\tonFailure('Permission denied - Audience Not allowed publish');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstream.userID = this._uid;\n\t\t\tif (this._screenProducer !== null) {\n\t\t\t\tthis.resumeScreen();\n\t\t\t\tlogger.debug('API publishScreen() success streamId: ' + stream.innerStreamID + ' - Emit [stream-published] to APP');\n\t\t\t\tthis.emit('screen-published', { stream: stream });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t_promise2.default.resolve()\n\t\t\t// add own screen.\n\t\t\t.then(function () {\n\t\t\t\tif (!_this8._room.canSend('video')) {\n\t\t\t\t\tlogger.warn('API publishScreen() error - video cannot Send.');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t_this8._setScreenProducer(stream).catch(function (e) {\n\t\t\t\t\tlogger.warn('API publishScreen() error - ' + e.toString() + '.');\n\t\t\t\t});\n\n\t\t\t\t// \n\t\t\t\t_this8._publishs.set(stream.innerStreamID, stream.innerStreamID);\n\n\t\t\t\tlogger.debug('API publishScreen() success - streamId: ' + stream.innerStreamID + ' - Emit [stream-published] to APP');\n\t\t\t\t_this8.emit('screen-published', { stream: stream });\n\n\t\t\t\tonSuccess();\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * unpublish screen stream.\n  * 该函数废弃 -- 对于屏幕流，也统一采用 unpublish\n   * @param {Any} stream \n   * @param {function} onSuccess \n   * @param {function} onFailure \n   */\n\n\t}, {\n\t\tkey: 'unpublishScreen',\n\t\tvalue: function unpublishScreen(stream, onSuccess, onFailure) {\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API unpublishScreen() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API unpublishScreen() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!stream || !stream.streamObj) {\n\t\t\t\tlogger.warn('API unpublishScreen() error - parameter: stream is invalid');\n\t\t\t\tonFailure('Param error - stream is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API unpublishScreen() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._screenProducer) {\n\t\t\t\t// Not pause it just mandatory close.\n\t\t\t\tthis._screenProducer.close();\n\t\t\t}\n\n\t\t\t// \n\t\t\tthis._publishs.delete(stream.innerStreamID);\n\n\t\t\tthis._screenProducer = null;\n\n\t\t\tlogger.debug('API unpublishScreen() success - streamId: ' + stream.innerStreamID + ' - Emit [stream-unpublished] to APP');\n\t\t\tthis.emit('screen-unpublished', { stream: stream });\n\n\t\t\treturn onSuccess();\n\t\t}\n\t}, {\n\t\tkey: 'subscribeAudio',\n\t\tvalue: function subscribeAudio(stream, onSuccess, onFailure) {\n\t\t\tvar _this9 = this;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API subscribeAudio() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API subscribeAudio() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API subscribeAudio() error - parameter: stream is invalid');\n\t\t\t\tonFailure('param error - stream is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API subscribeAudio() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._joined) {\n\t\t\t\tlogger.warn('API subscribeAudio() error - non-joined');\n\n\t\t\t\tonFailure('non-joined');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API subscribeAudio() - streamId: ' + stream.getId() + ' stream.userID: ' + stream.userID);\n\n\t\t\tvar peer = this._peers.get(stream.userID);\n\t\t\tif (!peer) {\n\t\t\t\tlogger.warn('API subscribeAudio() error - non-peer: ' + stream.userID);\n\t\t\t\treturn onFailure('Can not found this peer');\n\t\t\t}\n\n\t\t\tpeer.consumers.forEach(function (element) {\n\t\t\t\tif (!!element.appData && element.appData.streamID === stream.streamID) {\n\t\t\t\t\tif (element.kind === 'audio') _this9._consumerAct(stream, element, 'resume', 'audio', onSuccess);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'unsubscribeAudio',\n\t\tvalue: function unsubscribeAudio(stream, onSuccess, onFailure) {\n\t\t\tvar _this10 = this;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API unsubscribeAudio() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API unsubscribeAudio() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API unsubscribeAudio() error - parameter: stream is invalid');\n\t\t\t\tonFailure('Param error - stream is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API unsubscribeAudio() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API unsubscribeAudio() - streamId: ' + stream.getId() + ' stream.userID: ' + stream.userID);\n\n\t\t\tvar peer = this._peers.get(stream.userID);\n\t\t\tif (!peer) {\n\t\t\t\tlogger.warn('API unsubscribeAudio() error - non-peer: ' + stream.userID);\n\t\t\t\treturn onFailure('Can not found this peer');\n\t\t\t}\n\n\t\t\tpeer.consumers.forEach(function (element) {\n\t\t\t\tif (!!element.appData && element.appData.streamID === stream.streamID) {\n\t\t\t\t\tif (element.kind === 'audio') _this10._consumerAct(stream, element, 'pause', 'audio', onSuccess);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'subscribeVideo',\n\t\tvalue: function subscribeVideo(stream, onSuccess, onFailure) {\n\t\t\tvar _this11 = this;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API subscribeVideo() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API subscribeVideo() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API subscribeVideo() error - parameter: stream is invalid');\n\t\t\t\tonFailure('Param error - stream is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API subscribeVideo() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._joined) {\n\t\t\t\tlogger.warn('API subscribeVideo() error - non-joined');\n\n\t\t\t\tonFailure('non-joined');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API subscribeVideo() - streamId: ' + stream.getId() + ' stream.userID: ' + stream.userID);\n\n\t\t\tvar peer = this._peers.get(stream.userID);\n\t\t\tif (!peer) {\n\t\t\t\tlogger.warn('API subscribeVideo() error - non-peer: ' + stream.userID);\n\t\t\t\treturn onFailure('Can not found this peer');\n\t\t\t}\n\n\t\t\tpeer.consumers.forEach(function (element) {\n\t\t\t\tif (!!element.appData && element.appData.streamID === stream.streamID) {\n\t\t\t\t\tif (element.kind === 'video') _this11._consumerAct(stream, element, 'resume', 'video', onSuccess);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'unsubscribeVideo',\n\t\tvalue: function unsubscribeVideo(stream, onSuccess, onFailure) {\n\t\t\tvar _this12 = this;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API unsubscribeVideo() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API unsubscribeVideo() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API unsubscribeVideo() error - parameter: stream is invalid');\n\t\t\t\tonFailure('parameter - stream is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API unsubscribeVideo() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API unsubscribeVideo() streamId: ' + stream.getId() + ' stream.userID: ' + stream.userID);\n\n\t\t\tvar peer = this._peers.get(stream.userID);\n\t\t\tif (!peer) {\n\t\t\t\tlogger.warn('API unsubscribeVideo() error - non-peer: ' + stream.userID);\n\t\t\t\treturn onFailure('Can not found this peer');\n\t\t\t}\n\n\t\t\tpeer.consumers.forEach(function (element) {\n\t\t\t\tif (!!element.appData && element.appData.streamID === stream.streamID) {\n\t\t\t\t\tif (element.kind === 'video') _this12._consumerAct(stream, element, 'pause', 'video', onSuccess);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// \n\n\t}, {\n\t\tkey: '_consumerAct',\n\t\tvalue: function _consumerAct(stream, consumer, type, kind, onSuccess) {\n\t\t\tif (!consumer) {\n\t\t\t\tlogger.warn('API _consumerAct() error - invalid consumer');\n\t\t\t\t// throw new TypeError('consumer');\n\t\t\t}\n\n\t\t\tvar evt = { stream: stream };\n\n\t\t\tif (type === 'pause') {\n\t\t\t\tconsumer.pause();\n\t\t\t\tlogger.debug('API _consumerAct() success - streamId: ' + stream.getId() + ' - Emit [stream-' + kind + '-unsubscribed] to APP');\n\t\t\t\tonSuccess(stream);\n\n\t\t\t\tthis.emit('stream-' + kind + '-unsubscribed', evt);\n\n\t\t\t\treturn;\n\t\t\t} else if (type === 'resume') {\n\t\t\t\tconsumer.resume();\n\t\t\t\tlogger.debug('API _consumerAct() success - streamId: ' + stream.getId() + ' - Emit [stream-' + kind + '-subscribed] to APP');\n\t\t\t\tonSuccess(stream);\n\n\t\t\t\tthis.emit('stream-' + kind + '-subscribed', evt);\n\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tlogger.warn('API _consumerAct() error - invalid type - should be [resume|pause]');\n\t\t\t}\n\n\t\t\t// throw new TypeError('type');\n\t\t}\n\n\t\t/**\n   * Subscribe the stream of your purpose.\n   * @param stream\n   * @param onSuccess\n   * @param onFailure\n   */\n\n\t}, {\n\t\tkey: 'subscribe',\n\t\tvalue: function subscribe(stream, onSuccess, onFailure) {\n\t\t\tvar _this13 = this;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API subscribe() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API subscribe() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API subscribe() error - parameter: stream is invalid');\n\t\t\t\tonFailure('Param error - stream is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API subscribe() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._joined) {\n\t\t\t\tlogger.warn('API subscribe() error - non-joined');\n\n\t\t\t\tonFailure('non-joined');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar peer = this._peers.get(stream.userID);\n\t\t\tif (!peer) {\n\t\t\t\tlogger.warn('API subscribe() error - non-peer: ' + stream.userID);\n\t\t\t\treturn onFailure('Can not found this peer');\n\t\t\t}\n\n\t\t\tvar consumers = [];\n\t\t\tpeer.consumers.forEach(function (element) {\n\t\t\t\tif (element.appData.streamID === stream.streamID) {\n\t\t\t\t\tconsumers.push(element);\n\n\t\t\t\t\t// only for stat\n\t\t\t\t\t_this13._subscribes.set(stream.streamID, {\n\t\t\t\t\t\tstreamID: stream.streamID,\n\t\t\t\t\t\tstatus: 'active'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconsumers.forEach(function (value) {\n\t\t\t\tvalue.resume();\n\t\t\t});\n\n\t\t\tstream.subscribed = true;\n\n\t\t\tlogger.debug('API subscribe() success - streamId: ' + stream.getId() + ' - Emit [stream-subscribed] to APP');\n\n\t\t\tvar evt = { stream: stream };\n\t\t\tonSuccess(stream);\n\n\t\t\tthis.emit('stream-subscribed', evt);\n\t\t}\n\n\t\t/**\n   * Unsbubscribe the stream.\n   * @param {Any} stream\n   * @param {function} onSuccess\n   * @param {function} onFailure\n   */\n\n\t}, {\n\t\tkey: 'unsubscribe',\n\t\tvalue: function unsubscribe(stream, onSuccess, onFailure) {\n\t\t\tvar _this14 = this;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API unsubscribe() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API unsubscribe() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API unsubscribe() error - parameter: stream is invalid');\n\t\t\t\tonFailure('Param error - stream is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API unsubscribe() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar peer = this._peers.get(stream.userID);\n\t\t\tif (!peer) {\n\t\t\t\tlogger.warn('API unsubscribe() error - non-peer: ' + stream.userID);\n\t\t\t\treturn onFailure('Can not found this peer');\n\t\t\t}\n\n\t\t\tvar consumers = [];\n\t\t\tpeer.consumers.forEach(function (element) {\n\t\t\t\tif (element.appData.streamID === stream.streamID) {\n\t\t\t\t\tconsumers.push(element);\n\n\t\t\t\t\t// only for stat\n\t\t\t\t\t_this14._subscribes.delete(stream.streamID);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconsumers.forEach(function (value) {\n\t\t\t\tvalue.pause();\n\t\t\t});\n\n\t\t\tstream.subscribed = false;\n\n\t\t\tlogger.debug('API unsubscribe() success - streamId: ' + stream.getId() + ' - Emit [stream-unsubscribed] to APP');\n\n\t\t\tvar evt = { stream: stream };\n\t\t\tonSuccess(stream);\n\n\t\t\tthis.emit('stream-unsubscribed', evt);\n\t\t}\n\n\t\t/**\n   * Pause Mic of local stream.\n   * @param {Any} stream\n   */\n\n\t}, {\n\t\tkey: 'pauseMic',\n\t\tvalue: function pauseMic(stream, onSuccess, onFailure) {\n\t\t\tlogger.debug('API pauseMic()');\n\n\t\t\t/*\n   // TODO : 未来再做有效性检查 -- 目前需要向前兼容\n   if (typeof onSuccess !== 'function')\n   {\n   \tlogger.error('API pauseMic() error - parameter: onSuccess invalid');\n   \tthrow TypeError('onSuccess is not function.');\n   }\n   \tif (typeof onFailure !== 'function')\n   {\n   \tlogger.error('API pauseMic() error - parameter: onFailure invalid');\n   \tthrow TypeError('onFailure is not function.');\n   }\n   */\n\n\t\t\t// \n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API pauseMic() error - Param: invalid stream');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// \n\t\t\tif (!stream._published) {\n\t\t\t\tlogger.warn('API pauseMic() error - no-published');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar producer = void 0;\n\t\t\tif (!stream) {\n\t\t\t\tproducer = this._mapMicProducers.values().next().value;\n\t\t\t} else {\n\t\t\t\tproducer = this._mapMicProducers.get(stream._innerStreamID);\n\t\t\t}\n\n\t\t\tif (!producer) {\n\t\t\t\tlogger.warn('API pauseMic() error - non mic producer.');\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('non mic producer');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis._pauseProducer(producer);\n\t\t\t\tif (typeof onSuccess === 'function') {\n\t\t\t\t\tonSuccess();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Resume Mic of local stream.\n   * @param {Any} stream \n   */\n\n\t}, {\n\t\tkey: 'resumeMic',\n\t\tvalue: function resumeMic(stream, onSuccess, onFailure) {\n\t\t\tlogger.debug('API resumeMic()');\n\t\t\t/*\n   // TODO : 未来再做有效性检查 -- 目前需要向前兼容\n   if (typeof onSuccess !== 'function')\n   {\n   \tlogger.error('API resumeMic() error - parameter: onSuccess invalid');\n   \tthrow TypeError('onSuccess is not function.');\n   }\n   \tif (typeof onFailure !== 'function')\n   {\n   \tlogger.error('API resumeMic() error - parameter: onFailure invalid');\n   \tthrow TypeError('onFailure is not function.');\n   }\n   */\n\n\t\t\t// \n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API resumeMic() error - Param: invalid stream');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// \n\t\t\tif (!stream._published) {\n\t\t\t\tlogger.warn('API resumeMic() error - no-published');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar producer = void 0;\n\t\t\tif (!stream) {\n\t\t\t\tproducer = this._mapMicProducers.values().next().value;\n\t\t\t} else {\n\t\t\t\tproducer = this._mapMicProducers.get(stream._innerStreamID);\n\t\t\t}\n\n\t\t\tif (!producer) {\n\t\t\t\tlogger.warn('API resumeMic() error - non mic producer.');\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('non mic producer');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis._resumeProducer(producer);\n\t\t\t\tif (typeof onSuccess === 'function') {\n\t\t\t\t\tonSuccess();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Pause webcam of local stream.\n   * @param {Any} stream \n  * @param {Boolean} closeDev - 是否关闭摄像头设备\n   */\n\n\t}, {\n\t\tkey: 'pauseWebcam',\n\t\tvalue: function pauseWebcam(stream, closeDev, onSuccess, onFailure) {\n\t\t\tlogger.debug('API pauseWebcam()');\n\t\t\t/*\n   // TODO : 未来再做有效性检查 -- 目前需要向前兼容\n   if (typeof onSuccess !== 'function')\n   {\n   \tlogger.error('API pauseWebcam() error - parameter: onSuccess invalid');\n   \tthrow TypeError('onSuccess is not function.');\n   }\n   \tif (typeof onFailure !== 'function')\n   {\n   \tlogger.error('API pauseWebcam() error - parameter: onFailure invalid');\n   \tthrow TypeError('onFailure is not function.');\n   }\n   */\n\n\t\t\t// \n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API pauseWebcam() error - Param: invalid stream');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// \n\t\t\tif (!stream._published) {\n\t\t\t\tlogger.warn('API pauseWebcam() error - no-published');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar producer = void 0;\n\n\t\t\t// only one stream. That's will comptible with previous viersion(nul multi-stream)\n\t\t\tif (!stream) {\n\t\t\t\tproducer = this._mapWebcamProducers.values().next().value;\n\t\t\t} else {\n\t\t\t\t//multistream\n\t\t\t\tproducer = this._mapWebcamProducers.get(stream._innerStreamID);\n\t\t\t}\n\n\t\t\tif (!producer) {\n\t\t\t\tlogger.warn('API pauseWebcam() error - non webcam producer.');\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('non webcam producer');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis._pauseProducer(producer);\n\n\t\t\t\t// 同时，将关闭本地摄像头设备\n\t\t\t\tif (!!closeDev) {\n\t\t\t\t\tstream._closeCamera();\n\t\t\t\t}\n\t\t\t\tif (typeof onSuccess === 'function') {\n\t\t\t\t\tonSuccess();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Resume webcam of local stream.\n   * @param {Any} stream \n   */\n\n\t}, {\n\t\tkey: 'resumeWebcam',\n\t\tvalue: function resumeWebcam(stream, onSuccess, onFailure) {\n\t\t\tvar _this15 = this;\n\n\t\t\tlogger.debug('API resumeWebcam()');\n\t\t\t/*\n   // TODO : 未来再做有效性检查 -- 目前需要向前兼容\n   if (typeof onSuccess !== 'function')\n   {\n   \tlogger.error('API resumeWebcam() error - parameter: onSuccess invalid');\n   \tthrow TypeError('onSuccess is not function.');\n   }\n   \tif (typeof onFailure !== 'function')\n   {\n   \tlogger.error('API resumeWebcam() error - parameter: onFailure invalid');\n   \tthrow TypeError('onFailure is not function.');\n   }\n   */\n\n\t\t\t// \n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('API resumeWebcam() error - Param: invalid stream');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// \n\t\t\tif (!stream._published) {\n\t\t\t\tlogger.warn('API resumeWebcam() error - no-published');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar producer = void 0;\n\t\t\tif (!stream) {\n\t\t\t\tproducer = this._mapWebcamProducers.values().next().value;\n\t\t\t} else {\n\t\t\t\tproducer = this._mapWebcamProducers.get(stream._innerStreamID);\n\t\t\t}\n\n\t\t\tif (!producer) {\n\t\t\t\tlogger.warn('API resumeWebcam() error - non webcam producer.');\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('non webcam producer');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\t// 重新打开摄像头\n\t\t\t\t// \n\t\t\t\tstream._openCamera().then(function () {\n\t\t\t\t\tlogger.debug('API resumeWebcam() stream._openCamera()');\n\n\t\t\t\t\t_this15._resumeProducer(producer);\n\n\t\t\t\t\tif (typeof onSuccess === 'function') {\n\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (e) {\n\t\t\t\t\tlogger.warn('API resumeWebcam() stream._openCamera() error - ' + e.toString());\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * update track (only video).\n   * @param {Any} stream \n   * @param {Any} track \n  * @param {Object} constraints\n   */\n\n\t}, {\n\t\tkey: '_updateVideoTrack',\n\t\tvalue: function _updateVideoTrack(stream, track, constraints) {\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('_setVideoStreamBitrate() error - parameter [stream] is INVALID.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlogger.debug('_setVideoStreamBitrate() - streamId: ' + stream.innerStreamID);\n\n\t\t\t// Only support update video kind track now.\n\t\t\tvar producer = this._mapWebcamProducers.get(stream._innerStreamID);\n\t\t\tif (!producer) {\n\t\t\t\tlogger.debug('_setVideoStreamBitrate() error - client update track(kind video of webcam) can not found producer ' + stream.innerStreamID + '.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hard resetting track especial bandwidth.\n\t\t\tproducer.updateTrack(track, constraints, {\n\t\t\t\tidealBandwidth: stream.idealBandwidth,\n\t\t\t\tmaxBandwidth: stream.maxBandwidth,\n\t\t\t\tminBandwidth: stream.minBandwidth\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Replace track.\n   * @param {Any} stream \n   * @param {Any} track this track will cover the privous it.\n   */\n\n\t}, {\n\t\tkey: '_replaceTrack',\n\t\tvalue: function _replaceTrack(stream, track) {\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('_replaceTrack() error - parameter [stream] is INVALID.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('_replaceTrack() - stream.streamID: ' + stream.innerStreamID);\n\t\t\t// Only support update video kind track now.\n\t\t\tvar producer = this._mapWebcamProducers.get(stream._innerStreamID);\n\t\t\tif (!producer) {\n\t\t\t\tlogger.debug('_replaceTrack() error - client replace track(kind video of webcam) can not found producer ' + stream._innerStreamID + '.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t_promise2.default.resolve().then(function () {\n\t\t\t\tproducer.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t/*\n    if (stream._published)\n    {\n    \tthis._setVideoStreamBitrate(stream, track);\n    }\n    else\n    {\n    \tstream._needUpdateVideoStreamBitrate = true;\n    }\n    */\n\t\t\t}).catch(function (e) {\n\t\t\t\tlogger.warn('_replaceTrack() error - replace track failed - ' + e.toString());\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_resumeProducer',\n\t\tvalue: function _resumeProducer(producer) {\n\t\t\tif (!producer) {\n\t\t\t\tlogger.warn('_resumeProducer() error - parameter [producer] is INVALID.');\n\t\t\t\treturn; // throw new TypeError('producer');\n\t\t\t}\n\n\t\t\tproducer.resume();\n\t\t}\n\t}, {\n\t\tkey: '_pauseProducer',\n\t\tvalue: function _pauseProducer(producer) {\n\t\t\tif (!producer) {\n\t\t\t\tlogger.warn('_pauseProducer() error - parameter [producer] is INVALID.');\n\t\t\t\treturn; // throw new TypeError('producer');\n\t\t\t}\n\n\t\t\tproducer.pause();\n\t\t}\n\t}, {\n\t\tkey: 'pauseScreen',\n\t\tvalue: function pauseScreen() {\n\t\t\tlogger.debug('API pauseScreen()');\n\n\t\t\tif (this._screenProducer !== null) {\n\t\t\t\tthis._screenProducer.pause();\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'resumeScreen',\n\t\tvalue: function resumeScreen() {\n\t\t\tlogger.debug('API resumeScreen()');\n\n\t\t\tif (this._screenProducer !== null) {\n\t\t\t\tthis._screenProducer.resume();\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Renew Channel Key,\n   * TODO.\n   * @param channelKey\n   * @param onSuccess\n   * @param onFailure\n   */\n\n\t}, {\n\t\tkey: 'renewChannelKey',\n\t\tvalue: function renewChannelKey(channelKey, onSuccess, onFailure) {}\n\n\t\t/**\n   * 开启双流模式\n   * TODO.\n   */\n\n\t}, {\n\t\tkey: 'enableDualStream',\n\t\tvalue: function enableDualStream() {}\n\n\t\t/**\n   * TODO.\n   * Set video stream type.\n   * @param stream\n   * @param streamType\n   */\n\n\t}, {\n\t\tkey: 'setRemoteVideoStreamType',\n\t\tvalue: function setRemoteVideoStreamType(stream, streamType) {}\n\n\t\t/**\n   * TODO.\n   */\n\n\t}, {\n\t\tkey: 'setLowStreamParameter',\n\t\tvalue: function setLowStreamParameter() {}\n\n\t\t/**\n   * TODO.\n   * close dual stream.\n   * @param onSuccess\n   * @param onFailure\n   */\n\n\t}, {\n\t\tkey: 'disableDualStream',\n\t\tvalue: function disableDualStream(onSuccess, onFailure) {}\n\n\t\t/**\n   * set proxy server, e.g.: nginx.\n   * TODO.\n   */\n\n\t}, {\n\t\tkey: 'setProxyServer',\n\t\tvalue: function setProxyServer(domainName) {}\n\n\t\t/**\n   * 设置 AES 加密密码\n   * TODO.\n   */\n\n\t}, {\n\t\tkey: 'setEncryptionSecret',\n\t\tvalue: function setEncryptionSecret() {}\n\n\t\t/**\n   * 设置 AES 加密方案\n   * TODO.\n   */\n\n\t}, {\n\t\tkey: 'setEncryptionMode',\n\t\tvalue: function setEncryptionMode() {}\n\n\t\t/**\n   * read only property.\n   */\n\n\t}, {\n\t\tkey: 'closeStream',\n\t\tvalue: function () {\n\t\t\tvar _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5(stream) {\n\t\t\t\tvar micProducer, webcamProducer;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee5$(_context5) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context5.prev = _context5.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t_context5.next = 3;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API closeStream() error - parameter [stream] is INVALID.');\n\n\t\t\t\t\t\t\t\treturn _context5.abrupt('return');\n\n\t\t\t\t\t\t\tcase 3:\n\n\t\t\t\t\t\t\t\tlogger.debug('API closeStream() - streamId: ' + stream.getId());\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tmicProducer = this._mapMicProducers.get(stream._innerStreamID);\n\n\t\t\t\t\t\t\t\tif (!micProducer) {\n\t\t\t\t\t\t\t\t\t_context5.next = 14;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t_context5.prev = 6;\n\t\t\t\t\t\t\t\t_context5.next = 9;\n\t\t\t\t\t\t\t\treturn micProducer.close();\n\n\t\t\t\t\t\t\tcase 9:\n\t\t\t\t\t\t\t\t_context5.next = 14;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 11:\n\t\t\t\t\t\t\t\t_context5.prev = 11;\n\t\t\t\t\t\t\t\t_context5.t0 = _context5['catch'](6);\n\n\t\t\t\t\t\t\t\tlogger.warn('API closeStream() error - close micProducer error - ' + _context5.t0.toString());\n\n\t\t\t\t\t\t\tcase 14:\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\twebcamProducer = this._mapWebcamProducers.get(stream._innerStreamID);\n\n\t\t\t\t\t\t\t\tif (!webcamProducer) {\n\t\t\t\t\t\t\t\t\t_context5.next = 24;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t_context5.prev = 16;\n\t\t\t\t\t\t\t\t_context5.next = 19;\n\t\t\t\t\t\t\t\treturn webcamProducer.close();\n\n\t\t\t\t\t\t\tcase 19:\n\t\t\t\t\t\t\t\t_context5.next = 24;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 21:\n\t\t\t\t\t\t\t\t_context5.prev = 21;\n\t\t\t\t\t\t\t\t_context5.t1 = _context5['catch'](16);\n\n\t\t\t\t\t\t\t\tlogger.warn('API closeStream() error - close webcamProducer error - ' + _context5.t1.toString());\n\n\t\t\t\t\t\t\tcase 24:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context5.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee5, this, [[6, 11], [16, 21]]);\n\t\t\t}));\n\n\t\t\tfunction closeStream(_x7) {\n\t\t\t\treturn _ref7.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn closeStream;\n\t\t}()\n\t}, {\n\t\tkey: '_innerClose',\n\t\tvalue: function () {\n\t\t\tvar _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6() {\n\t\t\t\tvar notify;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee6$(_context6) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context6.prev = _context6.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t// 更新当前为 未登录\n\t\t\t\t\t\t\t\tthis._joined = false;\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tnotify = {\n\t\t\t\t\t\t\t\t\tprevState: this._connState,\n\t\t\t\t\t\t\t\t\tcurState: clientConnState.DISCONNECTED\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tlogger.debug('_innerClose() - Emit [connection-state-change] - ' + (0, _stringify2.default)(notify));\n\n\t\t\t\t\t\t\t\tthis.emit('connection-state-change', notify);\n\t\t\t\t\t\t\t\tthis._connState = clientConnState.DISCONNECTED;\n\n\t\t\t\t\t\t\t\t// Leave the mediasoup Room.\n\n\t\t\t\t\t\t\t\tif (!this._room) {\n\t\t\t\t\t\t\t\t\t_context6.next = 9;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis._room.removeAllListeners();\n\t\t\t\t\t\t\t\t_context6.next = 9;\n\t\t\t\t\t\t\t\treturn this._room.leave();\n\n\t\t\t\t\t\t\tcase 9:\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tif (!!this._joinTimer) {\n\t\t\t\t\t\t\t\t\tclearTimeout(this._joinTimer);\n\t\t\t\t\t\t\t\t\tthis._joinTimer = null;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tthis._stopStatInterval();\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tthis._remoteVideos.clear();\n\t\t\t\t\t\t\t\tthis._publishs.clear();\n\t\t\t\t\t\t\t\tthis._subscribes.clear();\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tthis._mapMicProducers.forEach(function (value, key) {\n\t\t\t\t\t\t\t\t\tvalue.close();\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tthis._mapWebcamProducers.forEach(function (value, key) {\n\t\t\t\t\t\t\t\t\tvalue.close();\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tthis._mapMicProducers.clear();\n\t\t\t\t\t\t\t\tthis._mapWebcamProducers.clear();\n\n\t\t\t\t\t\t\t\tif (this._sendTransport != null) {\n\t\t\t\t\t\t\t\t\tthis._sendTransport.close();\n\t\t\t\t\t\t\t\t\tthis._sendTransport = null;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (this._screenTransport) {\n\t\t\t\t\t\t\t\t\tthis._screenTransport.close();\n\t\t\t\t\t\t\t\t\tthis._screenTransport = null;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (this._screenProducer) {\n\t\t\t\t\t\t\t\t\tthis._screenProducer.close();\n\t\t\t\t\t\t\t\t\tthis._screenProducer = null;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis._mapVideoSendTransports.forEach(function (value, key) {\n\t\t\t\t\t\t\t\t\tvalue.close();\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tthis._mapVideoSendTransports.clear();\n\n\t\t\t\t\t\t\t\tif (this._recvTransport) {\n\t\t\t\t\t\t\t\t\tthis._recvTransport.close();\n\t\t\t\t\t\t\t\t\tthis._recvTransport = null;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis._peers.clear();\n\n\t\t\t\t\t\t\tcase 25:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context6.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee6, this);\n\t\t\t}));\n\n\t\t\tfunction _innerClose() {\n\t\t\t\treturn _ref8.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn _innerClose;\n\t\t}()\n\n\t\t/**\n   * close client.\n   */\n\n\t}, {\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._closed = true;\n\n\t\t\tlogger.debug('API close()');\n\n\t\t\t// \n\t\t\tthis._innerClose();\n\n\t\t\tthis._room = null;\n\t\t\t// \n\n\t\t\t// Close protoo Peer (wait a bit so mediasoup-client can send\n\t\t\t// the 'leaveRoom' notification).\n\t\t\tif (this._protoo) {\n\t\t\t\tthis._protoo.close();\n\t\t\t\tthis._protoo = null;\n\t\t\t}\n\n\t\t\tthis._stats.stopHeartBeat();\n\t\t\tthis.removeAllListeners();\n\n\t\t\tif (!!navigator.mediaDevices) {\n\t\t\t\t// \n\t\t\t\tnavigator.mediaDevices.ondevicechange = null;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: '_handlePeer',\n\t\tvalue: function _handlePeer(peer) {\n\t\t\tvar _this16 = this;\n\n\t\t\tvar _ref9 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n\t\t\t    _ref9$notify = _ref9.notify,\n\t\t\t    notify = _ref9$notify === undefined ? true : _ref9$notify;\n\n\t\t\tvar displayName = peer.appData.displayName;\n\n\t\t\tlogger.debug('_handlePeer() userID: ' + peer.name + ' - Emit [peer-join] to APP');\n\n\t\t\t// The peer name equal with peer.id.\n\t\t\tif (peer.appData.role.toString() !== '3') {\n\t\t\t\tthis.emit('peer-join', {\n\t\t\t\t\tuserID: peer.name,\n\t\t\t\t\tpeer: peer // for compatibility with previous version(3.0 and 3.1)\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis._peers.set(peer.name, peer);\n\n\t\t\t/*\n         logger.debug('addPeer:', {\n   \tname: peer.name,\n   \tdisplayName: displayName,\n   \tdevice: peer.appData.device,\n   \tconsumers: []\n   });\n   */\n\n\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\tvar _didIteratorError2 = false;\n\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(peer.consumers), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\tvar consumer = _step2.value;\n\n\t\t\t\t\tthis._handleConsumer(consumer);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t_iteratorError2 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpeer.on('close', function (originator) {\n\t\t\t\tlogger.debug('peer event [close] - userID: ' + peer.name + ' originator: ' + originator);\n\n\t\t\t\t_this16._peers.delete(peer.name);\n\t\t\t\tif (!_this16._closed) {\n\t\t\t\t\tlogger.debug('_handlePeer() event [close] - userID: ' + peer.name + ' - Emit [peer-leave] to APP');\n\t\t\t\t\t_this16.emit('peer-leave', { userID: peer.name, streams: peer.streams || [], peer: peer /**for compatibility previous version(3.0, 3.1) */ });\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpeer.on('newconsumer', function (consumer) {\n\t\t\t\t/*\n             logger.debug(\n                 `peer event -- [newconsumer] name:'%s', id:%s, consumer:%o]`,\n    \tpeer.name, consumer.id, consumer);\n    */\n\t\t\t\tlogger.debug('_handlePeer() peer event [newconsumer] - peer.name: ' + peer.name + ' consumer.id: ' + consumer.id);\n\n\t\t\t\t_this16._handleConsumer(consumer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_handleConsumer',\n\t\tvalue: function () {\n\t\t\tvar _ref10 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7(consumer) {\n\t\t\t\tvar _this17 = this;\n\n\t\t\t\tvar codec, consumerInfo, stream_, sid;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee7$(_context7) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context7.prev = _context7.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\tcodec = consumer.rtpParameters.codecs[0];\n\t\t\t\t\t\t\t\tconsumerInfo = {\n\t\t\t\t\t\t\t\t\tid: consumer.id,\n\t\t\t\t\t\t\t\t\tpeerName: consumer.peer.name,\n\t\t\t\t\t\t\t\t\tsource: consumer.appData.source,\n\t\t\t\t\t\t\t\t\tsupported: consumer.supported,\n\t\t\t\t\t\t\t\t\tlocallyPaused: consumer.locallyPaused,\n\t\t\t\t\t\t\t\t\tremotelyPaused: consumer.remotelyPaused,\n\t\t\t\t\t\t\t\t\ttrack: null,\n\t\t\t\t\t\t\t\t\tcodec: codec ? codec.name : null\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tlogger.debug('_handleConsumer() consumerPeerName: ' + consumer.peer.name + ' consumerInfo: ' + (0, _stringify2.default)(consumerInfo) + ' ');\n\n\t\t\t\t\t\t\t\tconsumer.on('close', function (originator) {\n\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t_this17._stats.removeStreamById('consumer_' + consumer.id);\n\t\t\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t\t\t/*\n                  logger.debug(\n                      'consumer event -- [close] [id:%s, originator:%s, consumer:%o]',\n         \tconsumer.id, originator, consumer);\n         */\n\t\t\t\t\t\t\t\t\tlogger.debug('consumer event [close] - consumer.id: ' + consumer.id + ' originator: ' + originator);\n\n\t\t\t\t\t\t\t\t\t// clearInterval(this._intervalStats);\n\n\t\t\t\t\t\t\t\t\t// TODO : remove streams \n\t\t\t\t\t\t\t\t\t// \n\n\t\t\t\t\t\t\t\t\t// There comunicated peers are sited the same server.\n\t\t\t\t\t\t\t\t\t// 'CLOSE' signal.\n\t\t\t\t\t\t\t\t\t// if (consumer.peer.stream !== null) {\n\t\t\t\t\t\t\t\t\t//     if (consumer.kind === 'video' && consumer.peer.stream !== null) {\n\t\t\t\t\t\t\t\t\t//         let tracks = consumer.peer.stream.streamObj.getVideoTracks();\n\t\t\t\t\t\t\t\t\t//         tracks.forEach(element => {\n\t\t\t\t\t\t\t\t\t//             consumer.peer.stream.streamObj.removeTrack(element);\n\t\t\t\t\t\t\t\t\t//         });\n\t\t\t\t\t\t\t\t\t//     }\n\n\t\t\t\t\t\t\t\t\t//     if (consumer.kind === 'audio' && consumer.peer.stream !== null) {\n\t\t\t\t\t\t\t\t\t//         let tracks = consumer.peer.stream.streamObj.getAudioTracks();\n\t\t\t\t\t\t\t\t\t//         tracks.forEach(element => {\n\t\t\t\t\t\t\t\t\t//             consumer.peer.stream.streamObj.removeTrack(element);\n\t\t\t\t\t\t\t\t\t//         });\n\t\t\t\t\t\t\t\t\t//     }\n\t\t\t\t\t\t\t\t\t//     this.emit('stream-removed', { stream: consumer.peer.stream });\n\t\t\t\t\t\t\t\t\t//     consumer.peer.stream = null;\n\t\t\t\t\t\t\t\t\t// }\n\n\t\t\t\t\t\t\t\t\t// this.emit(`${consumer.kind}-removed`);\n\t\t\t\t\t\t\t\t\tconsumer.disableStats();\n\n\t\t\t\t\t\t\t\t\t// consumer.disableInternalStats()\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tconsumer.on('pause', function (originator) {\n\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t_this17._stats.actStreamSSRCPairs('consumer_' + consumer.id, false);\n\t\t\t\t\t\t\t\t\t/*\n                  logger.debug(\n                      'consumer event -- [pause] [id:%s, originator:%s, consumer:%o]',\n         \tconsumer.id, originator, consumer);\n         */\n\t\t\t\t\t\t\t\t\tlogger.debug('consumer event [pause] - consumer.id: ' + consumer.id + ' originator: ' + originator);\n\n\t\t\t\t\t\t\t\t\tvar smute = 'audio-mute';\n\t\t\t\t\t\t\t\t\tif (consumer.kind === 'audio') {\n\t\t\t\t\t\t\t\t\t\tsmute = 'audio-mute';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (consumer.kind === 'video') {\n\t\t\t\t\t\t\t\t\t\tsmute = 'video-mute';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// There comunicated peers are sited the different servers.\n\t\t\t\t\t\t\t\t\t// 'PAUSE' signal.\n\t\t\t\t\t\t\t\t\t// let remotePaused = 0;\n\t\t\t\t\t\t\t\t\t// if (originator === 'remote') {\n\t\t\t\t\t\t\t\t\t//     let peer = this._peers.get(consumer.peer.name);\n\t\t\t\t\t\t\t\t\t//     if (peer != null) {\n\t\t\t\t\t\t\t\t\t//         peer.consumers.forEach(element => {\n\t\t\t\t\t\t\t\t\t//             if (element.kind === 'audio' && element.remotelyPaused) {\n\t\t\t\t\t\t\t\t\t//                 remotePaused += 1;\n\t\t\t\t\t\t\t\t\t//             }\n\n\t\t\t\t\t\t\t\t\t//             if (element.kind === 'video' && element.remotelyPaused) {\n\t\t\t\t\t\t\t\t\t//                 remotePaused += 1;\n\t\t\t\t\t\t\t\t\t//             }\n\t\t\t\t\t\t\t\t\t//         });\n\t\t\t\t\t\t\t\t\t//     }\n\n\t\t\t\t\t\t\t\t\t//     if (remotePaused >= 2) {\n\t\t\t\t\t\t\t\t\t//         if (consumer.peer.stream !== null) {\n\t\t\t\t\t\t\t\t\t//             let vtracks = consumer.peer.stream.streamObj.getVideoTracks();\n\t\t\t\t\t\t\t\t\t//             vtracks.forEach(e => {\n\t\t\t\t\t\t\t\t\t//                 consumer.peer.stream.streamObj.removeTrack(e);\n\t\t\t\t\t\t\t\t\t//             });\n\n\t\t\t\t\t\t\t\t\t//             let atracks = consumer.peer.stream.streamObj.getAudioTracks();\n\t\t\t\t\t\t\t\t\t//             atracks.forEach(e => {\n\t\t\t\t\t\t\t\t\t//                 consumer.peer.stream.streamObj.removeTrack(e);\n\t\t\t\t\t\t\t\t\t//             });\n\n\t\t\t\t\t\t\t\t\t//             this.emit('stream-removed', { stream: consumer.peer.stream });\n\t\t\t\t\t\t\t\t\t//             consumer.peer.stream = null;\n\t\t\t\t\t\t\t\t\t//         }\n\t\t\t\t\t\t\t\t\t//     }\n\t\t\t\t\t\t\t\t\t// }\n\n\t\t\t\t\t\t\t\t\t// if (originator === 'remote' && remotePaused <= 1)\n\t\t\t\t\t\t\t\t\tif (originator === 'remote') {\n\t\t\t\t\t\t\t\t\t\tif (consumer.peer && consumer.peer.streams && consumer.appData) {\n\t\t\t\t\t\t\t\t\t\t\tlogger.debug('_handleConsumer() consumer event [pause] - streamId: ' + consumer.appData.streamID + ' userID: ' + consumer.peer.name + ' - Emit [' + smute + '] to APP');\n\t\t\t\t\t\t\t\t\t\t\t_this17.emit(smute, {\n\t\t\t\t\t\t\t\t\t\t\t\tstream: consumer.peer.streams.get(consumer.appData.streamID)\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t// only for stat\n\t\t\t\t\t\t\t\t\t\t\t_this17._subscribes.set(consumer.appData.streamID, {\n\t\t\t\t\t\t\t\t\t\t\t\tstreamID: consumer.appData.streamID,\n\t\t\t\t\t\t\t\t\t\t\t\tstatus: 'inactive'\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tlogger.warn('_handleConsumer() consumer event [pause] error - invalid consumer.peer or consumer.appData');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tconsumer.on('resume', function (originator) {\n\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t_this17._stats.actStreamSSRCPairs('consumer_' + consumer.id, true);\n\t\t\t\t\t\t\t\t\t/*\n                  logger.debug(\n                      'consumer event -- [resume] [id:%s, originator:%s, consumer:%o]',\n         \tconsumer.id, originator, consumer);\n         \t*/\n\t\t\t\t\t\t\t\t\tlogger.debug('consumer event [resume] - consumer.id: ' + consumer.id + ' originator: ' + originator);\n\n\t\t\t\t\t\t\t\t\tvar smute = 'audio-unmute';\n\t\t\t\t\t\t\t\t\tif (consumer.kind === 'audio') {\n\t\t\t\t\t\t\t\t\t\tsmute = 'audio-unmute';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (consumer.kind === 'video') {\n\t\t\t\t\t\t\t\t\t\tsmute = 'video-unmute';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (originator === 'remote') {\n\t\t\t\t\t\t\t\t\t\tif (consumer.peer && consumer.peer.streams && consumer.appData) {\n\t\t\t\t\t\t\t\t\t\t\tvar stream = consumer.peer.streams.get(consumer.appData.streamID);\n\t\t\t\t\t\t\t\t\t\t\tif (smute === 'video-unmute') {\n\t\t\t\t\t\t\t\t\t\t\t\tif (!_this17._remoteVideos.has(consumer.appData.streamID)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t_this17.emit('video-added', { stream: stream });\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\t\t\t\t_this17._remoteVideos.set(stream.getId(), {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuserId: consumer.peer.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstreamId: stream.getId()\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\t\tlogger.debug('_handleConsumer() consumer event [resume] - streamId: ' + consumer.appData.streamID + ' userID: ' + consumer.peer.name + ' - Emit [' + smute + '] to APP');\n\t\t\t\t\t\t\t\t\t\t\t_this17.emit(smute, { stream: stream });\n\n\t\t\t\t\t\t\t\t\t\t\t// only for stat\n\t\t\t\t\t\t\t\t\t\t\t_this17._subscribes.set(consumer.appData.streamID, {\n\t\t\t\t\t\t\t\t\t\t\t\tstreamID: consumer.appData.streamID,\n\t\t\t\t\t\t\t\t\t\t\t\tstatus: 'active'\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tlogger.warn('_handleConsumer() consumer event [resume] - error - invalid consumer.peer or consumer.appData');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tconsumer.on('effectiveprofilechange', function (profile) {\n\t\t\t\t\t\t\t\t\t/*\n                  logger.debug(\n                      'consumer event -- [effectiveprofilechange] [id:%s, consumer:%o, profile:%s]',\n         \tconsumer.id, consumer, profile);\n         \t*/\n\t\t\t\t\t\t\t\t\tlogger.debug('consumer event [effectiveprofilechange] - consumer.id: ' + consumer.id + ' profile: ' + profile);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tconsumer.on('stats', function (stats) {\n\t\t\t\t\t\t\t\t\tconsumer.getStats().then(function (s) {\n\t\t\t\t\t\t\t\t\t\tvar r = {};\n\t\t\t\t\t\t\t\t\t\tif (!!consumer.track && consumer.track.kind === 'video') {\n\t\t\t\t\t\t\t\t\t\t\tr = _this17._extractResolution(s);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\tif (!consumer.peer) {\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tvar sid = consumer.peer.name;\n\t\t\t\t\t\t\t\t\t\tif (!!consumer.appData) {\n\t\t\t\t\t\t\t\t\t\t\tsid = consumer.appData.streamID;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t_this17._stats.setConsumeStats(stats, r, consumer.peer.name, consumer.id, sid);\n\t\t\t\t\t\t\t\t\t}).catch(function (e) {\n\t\t\t\t\t\t\t\t\t\tlogger.warn('consumer event [stats] error - ' + e.toString());\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tconsumer.on('internalStats', function (stats) {\n\t\t\t\t\t\t\t\t\tif (!consumer.peer) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tvar result = _this17._internalStats('receiverStats', stats, consumer.peer.name, consumer.id);\n\t\t\t\t\t\t\t\t\t_this17._stats.pushLoggerToServer(null, result);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Receive the consumer (if we can).\n\t\t\t\t\t\t\t\tif (consumer.supported) {\n\t\t\t\t\t\t\t\t\t// TODO : 将 streams 变量显式定义到 mediasoupclient::Peer 中\n\t\t\t\t\t\t\t\t\tif (!consumer.peer.streams) consumer.peer.streams = new _map2.default();\n\n\t\t\t\t\t\t\t\t\t// Seek after existing stream.\n\t\t\t\t\t\t\t\t\tstream_ = consumer.peer.streams.get(consumer.appData.streamID);\n\n\t\t\t\t\t\t\t\t\tif (!stream_) {\n\t\t\t\t\t\t\t\t\t\tsid = !consumer.appData.streamID ? consumer.peer.name : consumer.appData.streamID;\n\n\t\t\t\t\t\t\t\t\t\tstream_ = new _stream2.default({\n\t\t\t\t\t\t\t\t\t\t\tuserID: consumer.peer.name,\n\t\t\t\t\t\t\t\t\t\t\tsource: consumer.appData.source,\n\t\t\t\t\t\t\t\t\t\t\tstreamID: sid,\n\t\t\t\t\t\t\t\t\t\t\tvideoType: consumer.appData.videoType,\n\t\t\t\t\t\t\t\t\t\t\tstreamType: 'consumer',\n\t\t\t\t\t\t\t\t\t\t\topenAudioCtx: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tstream_.streamObj = new MediaStream();\n\t\t\t\t\t\t\t\t\t\tconsumer.peer.streams.set(stream_.streamID, stream_);\n\n\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\tthis._remoteStreams.set(sid, stream_);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tconsumer.receive(this._recvTransport).then(function (track) {\n\t\t\t\t\t\t\t\t\t\tlogger.debug('_handleConsumer() consumer.receive - consumer.name: ' + consumer.peer.name + ' track.kind: ' + track.kind);\n\n\t\t\t\t\t\t\t\t\t\tif (track.kind === 'audio') {\n\t\t\t\t\t\t\t\t\t\t\tstream_.attachAudioTracks({\n\t\t\t\t\t\t\t\t\t\t\t\ttrack: track,\n\t\t\t\t\t\t\t\t\t\t\t\tautoPlay: false\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t// TODO : 如下采用 timer 并不合理\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('_handleConsumer() consumer userID: ' + consumer.peer.name + ' streamId: ' + stream_.getId() + ' - Emit [audio-added] to APP');\n\t\t\t\t\t\t\t\t\t\t\t\t_this17.emit('audio-added', { stream: stream_ });\n\t\t\t\t\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (track.kind === 'video') {\n\t\t\t\t\t\t\t\t\t\t\tstream_.videoTracks = track;\n\n\t\t\t\t\t\t\t\t\t\t\t// TODO : 如下采用 timer 并不合理\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('_handleConsumer() consumer userID: ' + consumer.peer.name + ' streamId: ' + stream_.getId() + ' - Emit [video-added] to APP');\n\n\t\t\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\t\t\tif (!consumer.remotelyPaused) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t_this17.emit('video-added', { stream: stream_ });\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\t\t\t\t_this17._remoteVideos.set(stream_.getId(), {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuserId: consumer.peer.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstreamId: stream_.getId()\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (stream_.trackNumber === 1) {\n\t\t\t\t\t\t\t\t\t\t\t// TODO : 如下采用 timer 并不合理\n\t\t\t\t\t\t\t\t\t\t\t// delay 500ms, becasuse need waiting peer-join event arrived.\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('_handleConsumer() consumer userID: ' + consumer.peer.name + ' streamId: ' + stream_.getId() + ' - Emit [stream-added] to APP');\n\t\t\t\t\t\t\t\t\t\t\t\t_this17.emit('stream-added', { stream: stream_, type: stream_.type });\n\t\t\t\t\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tconsumer.transport.handler._pc.getStats(track).then(function (stat) {\n\t\t\t\t\t\t\t\t\t\t\tstat.forEach(function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (e.type === 'inbound-rtp') {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar _stats$getStreamPrope = _this17._stats.getStreamPropertyBySSRC(e.ssrc, 'userID'),\n\t\t\t\t\t\t\t\t\t\t\t\t\t    id = _stats$getStreamPrope.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t    value = _stats$getStreamPrope.value;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (value === '') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this17._stats.setStreamSSRCPairs('consumer_' + consumer.id, e.ssrc, stream_, false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\t\t\t\t\tlogger.warn('_handleConsumer() error - unexpected error while receiving a new Consumer: ' + error.toString());\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t// pause the track by default.\n\t\t\t\t\t\t\t\t\tif (!stream_.subscribed) consumer.pause();\n\n\t\t\t\t\t\t\t\t\t// Concern transmission statistics.\n\t\t\t\t\t\t\t\t\t/* \n         // 2020/2/4 禁用\n         consumer.enableInternalStats(this._interval);\n         */\n\t\t\t\t\t\t\t\t\tconsumer.enableStats(this._interval);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlogger.warn('_handleConsumer() error - consumer.peer.name: ' + consumer.peer.name + ' consumer.supported: ' + consumer.supported);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcase 10:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context7.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee7, this);\n\t\t\t}));\n\n\t\t\tfunction _handleConsumer(_x9) {\n\t\t\t\treturn _ref10.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn _handleConsumer;\n\t\t}()\n\t}, {\n\t\tkey: '_setMicProducer',\n\t\tvalue: function _setMicProducer(stream) {\n\t\t\tvar _this18 = this;\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('_setMicProducer() error - parameter [stream] is INVALID.');\n\t\t\t\treturn _promise2.default.reject(new Error('INVALID parameter [stream]'));\n\t\t\t}\n\n\t\t\tlogger.debug('_setMicProducer() - stream.streamID: ' + stream.streamID);\n\n\t\t\tif (!this._room.canSend('audio')) {\n\t\t\t\treturn _promise2.default.reject(new Error('cannot send audio'));\n\t\t\t}\n\n\t\t\tif (this._mapMicProducers.get(stream._innerStreamID)) {\n\t\t\t\treturn _promise2.default.reject(new Error('mic Producer already exists'));\n\t\t\t}\n\n\t\t\tvar producer = void 0;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar tracks = stream.streamObj.getAudioTracks();\n\t\t\t\tif (tracks.length <= 0) {\n\t\t\t\t\treturn _promise2.default.reject('Audio track non-exist');\n\t\t\t\t} else {\n\t\t\t\t\tvar track = tracks[0];\n\n\t\t\t\t\t// 检查 Stream 的 audioProfile -- 以 Client._audioCodec 为准\n\t\t\t\t\tvar ap = stream.getAudioProfile();\n\t\t\t\t\tif (!!ap) {\n\t\t\t\t\t\tvar ac = _this18._audioCodec.toLowerCase();\n\t\t\t\t\t\tif (ap.codec.toLowerCase() !== ac) {\n\t\t\t\t\t\t\tlogger.debug('_setMicProducer() Stream.audioProfile is not match this._audioCodec - this._audioCodec: ' + _this18._audioCodec);\n\n\t\t\t\t\t\t\tif (ac === 'opus') {\n\t\t\t\t\t\t\t\tstream.setAudioProfile('music_standard');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstream.setAudioProfile('isac32');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// \n\t\t\t\t\tvar audioProfile = stream.getAudioProfile();\n\n\t\t\t\t\tlogger.debug('_setMicProducer() will createProducer - streamId: ' + stream.streamID + ' audioProfile: ' + (0, _stringify2.default)(audioProfile));\n\n\t\t\t\t\t// send inner-stream identify.\n\t\t\t\t\t// 注：在 Producer 构造函数中，将会 track.clone()\n\t\t\t\t\tproducer = _this18._room.createProducer(track, {\n\t\t\t\t\t\taudioProfile: audioProfile\n\t\t\t\t\t}, {\n\t\t\t\t\t\tsource: 'mic_' + stream.streamID,\n\t\t\t\t\t\tstreamID: stream.innerStreamID,\n\t\t\t\t\t\tuserID: stream.userID\n\t\t\t\t\t});\n\t\t\t\t\t// No need to keep original track.\n\t\t\t\t\t// track.stop();\n\n\t\t\t\t\t// Send it.\n\t\t\t\t\treturn producer.send(_this18._sendTransport);\n\t\t\t\t}\n\t\t\t}).then(function () {\n\t\t\t\t_this18._mapMicProducers.set(stream._innerStreamID, producer);\n\n\t\t\t\t// 将 producer attach 到 stream 中，以便在需要时， stream 中可以操作 producer 相关接口\n\t\t\t\tstream.attachMicProducer(producer);\n\n\t\t\t\tproducer.enableStats(_this18._interval);\n\n\t\t\t\t/*\n    // 2020/2/4 禁用\n    producer.enableInternalStats(this._interval);\n    */\n\n\t\t\t\t// \n\t\t\t\tvar producerInfo = {\n\t\t\t\t\tid: producer.id,\n\t\t\t\t\tsource: 'mic',\n\t\t\t\t\tlocallyPaused: producer.locallyPaused,\n\t\t\t\t\tremotelyPaused: producer.remotelyPaused,\n\t\t\t\t\ttrack: producer.track,\n\t\t\t\t\tcodec: producer.rtpParameters.codecs[0].name\n\t\t\t\t};\n\t\t\t\tlogger.debug('_setMicProducer() - producerInfo: ' + (0, _stringify2.default)(producerInfo));\n\n\t\t\t\tproducer.on('close', function (originator) {\n\t\t\t\t\tlogger.debug('_setMicProducer() micProducer event [close] - [originator:' + originator + ']');\n\n\t\t\t\t\tif (originator === 'remote') {\n\t\t\t\t\t\tlogger.debug('producer close');\n\t\t\t\t\t}\n\n\t\t\t\t\t_this18._mapMicProducers.delete(stream._innerStreamID);\n\n\t\t\t\t\t// 将 producer attach 到 stream 中，以便在需要时， stream 中可以操作 producer 相关接口\n\t\t\t\t\tstream.detachMicProducer(producer);\n\n\t\t\t\t\tproducer.disableStats();\n\t\t\t\t\t// producer.disableInternalStats();\n\t\t\t\t});\n\n\t\t\t\tproducer.on('pause', function (originator) {\n\t\t\t\t\tlogger.debug('_setMicProducer() micProducer event [pause] - [originator:' + originator + ']');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('resume', function (originator) {\n\t\t\t\t\tlogger.debug('_setMicProducer() micProducer event [resume] - [originator:' + originator + ']');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('handled', function () {\n\t\t\t\t\tlogger.debug('_setMicProducer() micProducer event [handled]');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('unhandled', function () {\n\t\t\t\t\tlogger.debug('_setMicProducer() micProducer event [unhandled]');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('stats', function (stats) {\n\t\t\t\t\t_this18._stats.setMicStats(stats, stream._innerStreamID);\n\t\t\t\t});\n\n\t\t\t\tproducer.on('internalStats', function (stats) {\n\t\t\t\t\tvar result = _this18._internalStats('senderStats', stats);\n\t\t\t\t\t_this18._stats.pushLoggerToServer(null, result);\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\tlogger.debug('_setMicProducer() succeeded');\n\t\t\t}).catch(function (error) {\n\t\t\t\tlogger.warn('_setMicProducer() failed - ' + error.toString());\n\n\t\t\t\tif (producer) {\n\t\t\t\t\t_this18._mapMicProducers.delete(stream._innerStreamID);\n\n\t\t\t\t\t// 将 producer attach 到 stream 中，以便在需要时， stream 中可以操作 producer 相关接口\n\t\t\t\t\tstream.detachMicProducer(producer);\n\n\t\t\t\t\tproducer.close();\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setWebcamProducer',\n\t\tvalue: function _setWebcamProducer(stream) {\n\t\t\tvar _this19 = this;\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('_setWebcamProducer() error - parameter [stream] is INVALID.');\n\t\t\t\treturn _promise2.default.reject(new Error('INVALID parameter [stream]'));\n\t\t\t}\n\n\t\t\tlogger.debug('_setWebcamProducer() stream.streamID: ' + stream.streamID);\n\n\t\t\tif (!this._room.canSend('video')) {\n\t\t\t\treturn _promise2.default.reject(new Error('cannot send video'));\n\t\t\t}\n\n\t\t\tif (this._webcamProducer) {\n\t\t\t\treturn _promise2.default.reject(new Error('webcam Producer already exists'));\n\t\t\t}\n\n\t\t\tvar producer = void 0;\n\n\t\t\treturn _promise2.default.resolve().then((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee8() {\n\t\t\t\tvar tracks, track, ap, ac, audioProfile, transport;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee8$(_context8) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context8.prev = _context8.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\ttracks = stream.streamObj.getVideoTracks();\n\n\t\t\t\t\t\t\t\tif (!(tracks.length <= 0)) {\n\t\t\t\t\t\t\t\t\t_context8.next = 5;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context8.abrupt('return', _promise2.default.reject('Video track non-exist'));\n\n\t\t\t\t\t\t\tcase 5:\n\t\t\t\t\t\t\t\ttrack = tracks[0];\n\n\t\t\t\t\t\t\t\t// 检查 Stream 的 audioProfile -- 以 Client._audioCodec 为准\n\n\t\t\t\t\t\t\t\tap = stream.getAudioProfile();\n\n\t\t\t\t\t\t\t\tif (!!ap) {\n\t\t\t\t\t\t\t\t\tac = _this19._audioCodec.toLowerCase();\n\n\t\t\t\t\t\t\t\t\tif (ap.codec.toLowerCase() !== ac) {\n\t\t\t\t\t\t\t\t\t\tlogger.debug('_setWebcamProducer() Stream.audioProfile is not match this._audioCodec - this._audioCodec: ' + _this19._audioCodec);\n\n\t\t\t\t\t\t\t\t\t\tif (ac === 'opus') {\n\t\t\t\t\t\t\t\t\t\t\tstream.setAudioProfile('music_standard');\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tstream.setAudioProfile('isac32');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\taudioProfile = stream.getAudioProfile();\n\n\n\t\t\t\t\t\t\t\tlogger.debug('_setWebcamProducer() will createProducer - streamId: ' + stream.streamID + ' audioProfile: ' + (0, _stringify2.default)(audioProfile));\n\n\t\t\t\t\t\t\t\t// send inner-stream identify.                \n\t\t\t\t\t\t\t\tproducer = _this19._room.createProducer(track, {\n\t\t\t\t\t\t\t\t\tsimulcast: _this19._useSimulcast,\n\t\t\t\t\t\t\t\t\taudioProfile: audioProfile,\n\t\t\t\t\t\t\t\t\tcodecOptions: {\n\t\t\t\t\t\t\t\t\t\tvideoGoogleStartBitrate: stream.idealBandwidth,\n\t\t\t\t\t\t\t\t\t\tvideoGoogleMaxBitrate: stream.maxBandwidth,\n\t\t\t\t\t\t\t\t\t\tvideoGoogleMinBitrate: stream.minBandwidth\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\t\tsource: 'webcam_' + stream.streamID,\n\t\t\t\t\t\t\t\t\tstreamID: stream.innerStreamID,\n\t\t\t\t\t\t\t\t\tuserID: stream.userID,\n\t\t\t\t\t\t\t\t\tvideoType: stream.videoType\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// No need to keep original track.\n\t\t\t\t\t\t\t\t// track.stop();\n\n\t\t\t\t\t\t\t\t// Send it.\n\t\t\t\t\t\t\t\ttransport = void 0;\n\n\t\t\t\t\t\t\t\tif (!_this19._sendTransport.videoSent()) {\n\t\t\t\t\t\t\t\t\t_context8.next = 19;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t_context8.next = 15;\n\t\t\t\t\t\t\t\treturn _this19._newTransport('send', 'web_cam');\n\n\t\t\t\t\t\t\tcase 15:\n\t\t\t\t\t\t\t\ttransport = _context8.sent;\n\n\t\t\t\t\t\t\t\t_this19._mapVideoSendTransports.set(stream._innerStreamID, transport);\n\t\t\t\t\t\t\t\t_context8.next = 20;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 19:\n\t\t\t\t\t\t\t\ttransport = _this19._sendTransport;\n\n\t\t\t\t\t\t\tcase 20:\n\t\t\t\t\t\t\t\treturn _context8.abrupt('return', producer.send(transport));\n\n\t\t\t\t\t\t\tcase 21:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context8.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee8, _this19);\n\t\t\t}))).then(function () {\n\t\t\t\t_this19._mapWebcamProducers.set(stream._innerStreamID, producer);\n\n\t\t\t\t// 将 producer attach 到 stream 中，以便在需要时， stream 中可以操作 producer 相关接口\n\t\t\t\tstream.attachWebcamProducer(producer);\n\n\t\t\t\tproducer.enableStats(_this19._interval);\n\n\t\t\t\t/*\n    // 2020/2/4 禁用\n    producer.enableInternalStats(this._interval);\n    */\n\n\t\t\t\t// \n\t\t\t\tvar producerInfo = {\n\t\t\t\t\tid: producer.id,\n\t\t\t\t\tsource: 'webcam',\n\t\t\t\t\tdeviceLabel: 'device.webcam',\n\t\t\t\t\ttype: 'front/rear',\n\t\t\t\t\tlocallyPaused: producer.locallyPaused,\n\t\t\t\t\tremotelyPaused: producer.remotelyPaused,\n\t\t\t\t\ttrack: producer.track,\n\t\t\t\t\tcodec: producer.rtpParameters.codecs[0].name\n\t\t\t\t};\n\t\t\t\tlogger.debug('_setWebcamProducer() - producerInfo: ' + (0, _stringify2.default)(producerInfo));\n\n\t\t\t\tproducer.on('close', function (originator) {\n\t\t\t\t\t// \n\t\t\t\t\t_this19._stats.removeStreamById('producer_' + producer.id);\n\t\t\t\t\t// \n\t\t\t\t\tlogger.debug('_setWebcamProducer() webcamProducer event [close] - [originator:' + originator + ']');\n\n\t\t\t\t\tproducer.disableStats();\n\t\t\t\t\t// producer.disableInternalStats();\n\n\t\t\t\t\t_this19._mapWebcamProducers.delete(stream._innerStreamID);\n\t\t\t\t\tstream.detachWebcamProducer(producer); // 从 stream 中 detach \n\n\t\t\t\t\tvar transport = _this19._mapVideoSendTransports.get(stream._innerStreamID);\n\t\t\t\t\tif (typeof transport !== 'undefined') {\n\t\t\t\t\t\ttransport.close();\n\t\t\t\t\t\ttransport.removeAllListeners();\n\t\t\t\t\t\t_this19._mapVideoSendTransports.delete(stream._innerStreamID);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tproducer.on('pause', function (originator) {\n\t\t\t\t\t// \n\t\t\t\t\t_this19._stats.actStreamSSRCPairs('producer_' + producer.id, false);\n\t\t\t\t\t// \n\t\t\t\t\tlogger.debug('_setWebcamProducer() webcamProducer event [pause] - [originator:' + originator + ']');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('resume', function (originator) {\n\t\t\t\t\t// \n\t\t\t\t\t_this19._stats.actStreamSSRCPairs('producer_' + producer.id, true);\n\t\t\t\t\t// \n\t\t\t\t\tlogger.debug('_setWebcamProducer() webcamProducer event [resume] [originator:' + originator + ']');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('handled', function () {\n\t\t\t\t\tlogger.debug('_setWebcamProducer() webcamProducer event [handled]');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('unhandled', function () {\n\t\t\t\t\tlogger.debug('_setWebcamProducer() webcamProducer event [unhandled]');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('stats', function (stats) {\n\t\t\t\t\t// logger.log(stats);\n\t\t\t\t\t_this19._stats.setWebcamStats(stats, stream._innerStreamID);\n\t\t\t\t});\n\n\t\t\t\tproducer.on('internalStats', function (stats) {\n\t\t\t\t\tvar result = _this19._internalStats('senderStats', stats);\n\t\t\t\t\t_this19._stats.pushLoggerToServer(null, result);\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\tlogger.debug('_setWebcamProducer() succeeded');\n\t\t\t\tproducer.transport.handler._pc.getStats(producer.track).then(function (stat) {\n\t\t\t\t\tstat.forEach(function (e) {\n\t\t\t\t\t\tif (e.type === 'outbound-rtp') {\n\t\t\t\t\t\t\t_this19._stats.setStreamSSRCPairs('producer_' + producer.id, e.ssrc, stream, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}).catch(function (error) {\n\t\t\t\tlogger.warn('_setWebcamProducer() failed:%o', error);\n\n\t\t\t\tif (producer) {\n\t\t\t\t\t_this19._mapWebcamProducers.delete(stream._innerStreamID);\n\t\t\t\t\tstream.detachWebcamProducer(producer); // 从 stream 中 detach \n\t\t\t\t\tproducer.close();\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * set(create) screen producer.\n   * \n   * @param {Any} stream screen stream.\n   */\n\n\t}, {\n\t\tkey: '_setScreenProducer',\n\t\tvalue: function _setScreenProducer(stream) {\n\t\t\tvar _this20 = this;\n\n\t\t\tif (!stream) {\n\t\t\t\tlogger.warn('_setScreenProducer() error - parameter [stream] is INVALID.');\n\t\t\t\treturn _promise2.default.reject(new Error('INVALID parameter [stream]'));\n\t\t\t}\n\n\t\t\tlogger.debug('_setScreenProducer() - streamId: ' + stream.innerStreamID);\n\n\t\t\tif (!this._room.canSend('video')) {\n\t\t\t\treturn _promise2.default.reject(new Error('cannot send video'));\n\t\t\t}\n\n\t\t\tif (this._screenProducer) {\n\t\t\t\treturn _promise2.default.reject(new Error('screen Producer already exists'));\n\t\t\t}\n\n\t\t\tvar producer = void 0;\n\n\t\t\treturn _promise2.default.resolve().then((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee9() {\n\t\t\t\tvar track;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee9$(_context9) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context9.prev = _context9.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\ttrack = stream.streamObj.getVideoTracks()[0];\n\n\n\t\t\t\t\t\t\t\tproducer = _this20._room.createProducer(track, {\n\t\t\t\t\t\t\t\t\tsimulcast: _this20._useSimulcast\n\t\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\t\tsource: 'screen',\n\t\t\t\t\t\t\t\t\tstreamID: stream.innerStreamID\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// No need to keep original track.\n\t\t\t\t\t\t\t\t// track.stop();\n\n\t\t\t\t\t\t\t\t// Send it.\n\t\t\t\t\t\t\t\t_context9.next = 4;\n\t\t\t\t\t\t\t\treturn _this20._newTransport('send', 'screen');\n\n\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\t_this20._screenTransport = _context9.sent;\n\t\t\t\t\t\t\t\treturn _context9.abrupt('return', producer.send(_this20._screenTransport));\n\n\t\t\t\t\t\t\tcase 6:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context9.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee9, _this20);\n\t\t\t}))).then(function () {\n\t\t\t\t_this20._screenProducer = producer;\n\t\t\t\t_this20._screenProducer.enableStats(_this20._interval);\n\n\t\t\t\t/*\n    // 2020/2/4 禁用\n    this._screenProducer.enableInternalStats(this._interval);\n    */\n\n\t\t\t\tvar producerInfo = {\n\t\t\t\t\tid: producer.id,\n\t\t\t\t\tsource: 'screen',\n\t\t\t\t\tdeviceLabel: 'device.screen',\n\t\t\t\t\ttype: 'front',\n\t\t\t\t\tlocallyPaused: producer.locallyPaused,\n\t\t\t\t\tremotelyPaused: producer.remotelyPaused,\n\t\t\t\t\ttrack: producer.track,\n\t\t\t\t\tcodec: producer.rtpParameters.codecs[0].name\n\t\t\t\t};\n\n\t\t\t\tlogger.debug('_setScreenProducer() - streamId: ' + stream.innerStreamID + ' producerInfo: ' + producerInfo);\n\n\t\t\t\tproducer.on('close', function (originator) {\n\t\t\t\t\t// \n\t\t\t\t\t_this20._stats.removeStreamById('producer_' + producer.id);\n\t\t\t\t\t// \n\t\t\t\t\tlogger.debug('setScreenProducer() screenProducer event [close] - [originator:' + originator + ']');\n\n\t\t\t\t\t_this20._screenProducer = null;\n\t\t\t\t\t_this20._screenTransport.close();\n\t\t\t\t\t_this20._screenTransport.removeAllListeners();\n\t\t\t\t\t_this20._screenTransport = null;\n\n\t\t\t\t\tproducer.disableStats();\n\t\t\t\t\t// producer.disableInternalStats();\n\t\t\t\t});\n\n\t\t\t\tproducer.on('pause', function (originator) {\n\t\t\t\t\t// \n\t\t\t\t\t_this20._stats.actStreamSSRCPairs('producer_' + producer.id, false);\n\t\t\t\t\t// \n\t\t\t\t\tlogger.debug('_setScreenProducer() screenProducer event [pause] - [originator:' + originator + ']');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('resume', function (originator) {\n\t\t\t\t\t// \n\t\t\t\t\t_this20._stats.actStreamSSRCPairs('producer_' + producer.id, true);\n\t\t\t\t\t// \n\t\t\t\t\tlogger.debug('_setScreenProducer() screenProducer event [resume] - [originator:' + originator + ']');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('handled', function () {\n\t\t\t\t\tlogger.debug('_setScreenProducer() screenProducer event [handled]');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('unhandled', function () {\n\t\t\t\t\tlogger.debug('screen Producer event [unhandled]');\n\t\t\t\t});\n\n\t\t\t\tproducer.on('stats', function (stats) {\n\t\t\t\t\t// logger.log(stats);\n\t\t\t\t\t_this20._stats.setWebcamStats(stats, stream.innerStreamID);\n\t\t\t\t});\n\n\t\t\t\tproducer.on('internalStats', function (stats) {\n\t\t\t\t\tvar result = _this20._internalStats('senderStats', stats);\n\t\t\t\t\t_this20._stats.pushLoggerToServer(null, result);\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\tlogger.debug('_setScreenProducer() succeeded');\n\t\t\t\tproducer.transport.handler._pc.getStats(producer.track).then(function (stat) {\n\t\t\t\t\tstat.forEach(function (e) {\n\t\t\t\t\t\tif (e.type === 'outbound-rtp') {\n\t\t\t\t\t\t\t_this20._stats.setStreamSSRCPairs('producer_' + producer.id, e.ssrc, stream, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}).catch(function (error) {\n\t\t\t\tlogger.warn('_setScreenProducer() failed:%o', error);\n\n\t\t\t\tif (producer) {\n\t\t\t\t\tproducer.close();\n\t\t\t\t\t_this20._screenProducer = null;\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Delay with some of milliseconds.\n   * \n   * @param {number} ms milliseconds\n   */\n\n\t}, {\n\t\tkey: '_delay',\n\t\tvalue: function _delay(ms) {\n\t\t\tvar ctr,\n\t\t\t    rej,\n\t\t\t    p = new _promise2.default(function (resolve, reject) {\n\t\t\t\tctr = setTimeout(resolve, ms);\n\t\t\t\trej = reject;\n\t\t\t});\n\t\t\tp.cancel = function () {\n\t\t\t\tclearTimeout(ctr);rej(Error('Cancelled'));\n\t\t\t};\n\t\t\treturn p;\n\t\t}\n\n\t\t// 中止 ice restart 重试\n\n\t}, {\n\t\tkey: '_stopIceRestartTimer',\n\t\tvalue: function _stopIceRestartTimer() {\n\t\t\tif (!!this.iceRestartTimer) {\n\t\t\t\tclearInterval(this.iceRestartTimer);\n\t\t\t\tthis.iceRestartTimer = null;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: '_retryRestartIce',\n\t\tvalue: function _retryRestartIce(transport) {\n\t\t\tvar _this21 = this;\n\n\t\t\tif (!transport) {\n\t\t\t\tlogger.warn('_retryRestartIce() error - parameter [transport] is INVALID');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// No need doing anythin if protoo closed.\n\t\t\tif (!this._protoo || this._protoo.closed) {\n\t\t\t\tlogger.warn('_retryRestartIce() error - _protoo not connected.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// if state is 'connected'.\n\t\t\tif (transport.connectionState === 'connected') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('_retryRestartIce() - transport.id: ' + transport.id);\n\n\t\t\tvar retry_time = 0;\n\t\t\tthis.iceRestartTimer = setInterval(function () {\n\t\t\t\t// if protoo was closed.\n\t\t\t\tif (!_this21._protoo || _this21._protoo.closed) {\n\t\t\t\t\tif (!!_this21.iceRestartTimer) {\n\t\t\t\t\t\tclearInterval(_this21.iceRestartTimer);\n\t\t\t\t\t}\n\t\t\t\t\t_this21.iceRestartTimer = null;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// 如果当前尚未进入连接状态，则直接return\n\t\t\t\tif (!_this21._protoo.connected) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\tif (!_this21._joined) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// if too many retries.\n\t\t\t\tif (retry_time++ > Client.ICE_RETRY_NUM_TIME) {\n\t\t\t\t\tif (!!_this21.iceRestartTimer) {\n\t\t\t\t\t\tclearInterval(_this21.iceRestartTimer);\n\t\t\t\t\t}\n\t\t\t\t\t_this21.iceRestartTimer = null;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('iceRestartTimer - retrying ... transport.id: ' + transport.id + ' retry_time: ' + retry_time);\n\n\t\t\t\t_this21._restartIce(transport).then(function () {\n\t\t\t\t\t// let transport_ = tp\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tif (transport.connectionState === 'connected') {\n\t\t\t\t\t\t\tlogger.debug('iceRestartTimer - [connected] transport.id: ' + transport.id + ' retry_time: ' + retry_time);\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\tif (!!_this21.iceRestartTimer) {\n\t\t\t\t\t\t\t\tclearInterval(_this21.iceRestartTimer);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t_this21.iceRestartTimer = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 1000);\n\n\t\t\t\t\treturn;\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\tlogger.warn('_retryRestartIce() error - ' + error.toString());\n\t\t\t\t});\n\t\t\t}, 3000);\n\t\t}\n\n\t\t/**\n   * restart ICE.\n   * @param {Any} tp transport \n   */\n\n\t}, {\n\t\tkey: '_restartIce',\n\t\tvalue: function () {\n\t\t\tvar _ref13 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee10(tp) {\n\t\t\t\treturn _regenerator2.default.wrap(function _callee10$(_context10) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context10.prev = _context10.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t_context10.prev = 0;\n\t\t\t\t\t\t\t\t_context10.next = 3;\n\t\t\t\t\t\t\t\treturn tp.restartIce(null, function (e) {\n\t\t\t\t\t\t\t\t\tlogger.warn('_restartIce() transport.id: ' + tp.id + ' error - ' + e.toString());\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\tlogger.debug('_restartIce() transport.id: ' + tp.id);\n\n\t\t\t\t\t\t\t\treturn _context10.abrupt('return', tp);\n\n\t\t\t\t\t\t\tcase 7:\n\t\t\t\t\t\t\t\t_context10.prev = 7;\n\t\t\t\t\t\t\t\t_context10.t0 = _context10['catch'](0);\n\n\t\t\t\t\t\t\t\tlogger.warn('_restartIce() error - ' + _context10.t0.toString());\n\t\t\t\t\t\t\t\tthrow _context10.t0;\n\n\t\t\t\t\t\t\tcase 11:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context10.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee10, this, [[0, 7]]);\n\t\t\t}));\n\n\t\t\tfunction _restartIce(_x10) {\n\t\t\t\treturn _ref13.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn _restartIce;\n\t\t}()\n\t}, {\n\t\tkey: 'getStats',\n\t\tvalue: function getStats() {\n\t\t\treturn this.getNetState();\n\t\t}\n\t}, {\n\t\tkey: 'getNetState',\n\t\tvalue: function getNetState() {\n\t\t\t// \n\t\t\tvar clientStats = {\n\t\t\t\ticeSendTransport: !this._sendTransport || !this._sendTransport._handler || !this._sendTransport._handler._pc ? 'fault' : this._sendTransport._handler._pc.iceConnectionState,\n\t\t\t\ticeRecvTransport: !this._recvTransport || !this._recvTransport._handler || !this._recvTransport._handler._pc ? 'fault' : this._recvTransport._handler._pc.iceConnectionState,\n\t\t\t\twebsocketTransport: !this._protoo || !this._protoo._transport ? 'fault' : this._protoo._transport.connected ? 'online' : 'offline',\n\t\t\t\tloginStatus: this._joined ? 'online' : 'offline',\n\t\t\t\tstats: !this._stats ? {} : this._stats.summarize\n\t\t\t};\n\n\t\t\treturn clientStats;\n\t\t}\n\n\t\t/**\n   * get audio recv stats\n   * @param {*} callback \n   * \n   */\n\n\t}, {\n\t\tkey: 'getRemoteAudioStats',\n\t\tvalue: function getRemoteAudioStats(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\tlogger.warn('API getRemoteAudioStats() error - parameter: callback invalid');\n\t\t\t\tthrow new TypeError('callback is not function.');\n\t\t\t}\n\n\t\t\tcallback(this._stats.audioDownStat);\n\t\t}\n\n\t\t/**\n   * get audio recv stats\n   * @param {*} callback \n   * \n   */\n\n\t}, {\n\t\tkey: 'remoteAudioStats',\n\t\tvalue: function remoteAudioStats() {\n\t\t\treturn this._stats.audioDownStat;\n\t\t}\n\n\t\t/**\n   * get video recv stats\n   * @param {*} callback \n   * \n   */\n\n\t}, {\n\t\tkey: 'getRemoteVideoStats',\n\t\tvalue: function getRemoteVideoStats(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\tlogger.warn('API getRemoteVideoStats() error - parameter: callback invalid');\n\t\t\t\tthrow new TypeError('callback is not function.');\n\t\t\t}\n\n\t\t\tcallback(this._stats.videoDownStat);\n\t\t}\n\n\t\t/**\n   * get video recv stats\n   * @param {*} callback \n   * \n   */\n\n\t}, {\n\t\tkey: 'remoteVideoStats',\n\t\tvalue: function remoteVideoStats() {\n\t\t\treturn this._stats.videoDownStat;\n\t\t}\n\n\t\t/**\n   * get audio send stats\n   * @param {*} callback \n   */\n\n\t}, {\n\t\tkey: 'getLocalAudioStats',\n\t\tvalue: function getLocalAudioStats(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\tlogger.warn('API getLocalAudioStats() error - parameter: callback invalid');\n\t\t\t\tthrow new TypeError('callback is not function.');\n\t\t\t}\n\n\t\t\tcallback(this._stats.audioUpStat);\n\t\t}\n\n\t\t/**\n   * get audio send stats\n   * @param {*} callback \n   */\n\n\t}, {\n\t\tkey: 'localAudioStats',\n\t\tvalue: function localAudioStats() {\n\t\t\treturn this._stats.audioUpStat;\n\t\t}\n\n\t\t/**\n   * get video send stats\n   * @param {*} callback \n   */\n\n\t}, {\n\t\tkey: 'getLocalVideoStats',\n\t\tvalue: function getLocalVideoStats(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\tlogger.warn('API getLocalVideoStats() error - parameter: callback invalid');\n\t\t\t\tthrow new TypeError('callback is not function.');\n\t\t\t}\n\n\t\t\tcallback(this._stats.videoUpStat);\n\t\t}\n\n\t\t/**\n   * get video send stats\n   * @param {*} callback \n   */\n\n\t}, {\n\t\tkey: 'localVideoStats',\n\t\tvalue: function localVideoStats() {\n\t\t\treturn this._stats.videoUpStat;\n\t\t}\n\n\t\t/**\n   * set sei.\n   * @param {string|number} uid \n   * @param {string} type\n   * @param {Boolean} isScreen\n   * @param {Object} sei conference layout\n   * @param {string} devId innerStreamId\n   */\n\n\t}, {\n\t\tkey: 'setSEI',\n\t\tvalue: function setSEI(uid, type, isScreen, sei, devId, onSuccess, onFailure) {\n\t\t\tvar _this22 = this;\n\n\t\t\t/*\n   // TODO : 未来再做有效性检查 -- 目前需要向前兼容\n   if (typeof onSuccess !== 'function')\n   {\n   \tlogger.error('API setSEI() error - parameter: onSuccess invalid');\n   \tthrow TypeError('onSuccess is not function.');\n   }\n   \tif (typeof onFailure !== 'function')\n   {\n   \tlogger.error('API setSEI() error - parameter: onFailure invalid');\n   \tthrow TypeError('onFailure is not function.');\n   }\n   */\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API setSEI() error - protooTransport broken');\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('protooTransport broken');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._joined) {\n\t\t\t\tlogger.warn('API setSEI() error - non-joined');\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('non-joined');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._role !== '1') {\n\t\t\t\tlogger.warn('API setSEI() error - Must be master - this._role: ' + this._role);\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('Must be master');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar _type = '';\n\t\t\tif (type.toLocaleLowerCase() === 'add') {\n\t\t\t\t_type = 'add';\n\t\t\t} else if (type.toLocaleLowerCase() === 'del') {\n\t\t\t\t_type = 'del';\n\t\t\t}\n\n\t\t\tif (_type === '') {\n\t\t\t\tlogger.warn('setSEI() error - parameter [type] type: ' + type + ' is INVALID');\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('parameter [type] is INVALID');\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar sType = {\n\t\t\t\t'type': _type,\n\t\t\t\t'peerId': '' + uid,\n\t\t\t\t'devId': devId || ''\n\t\t\t};\n\n\t\t\tif (isScreen) {\n\t\t\t\tsType.devId = uid + ':screen';\n\t\t\t\tsei.pos = sei.pos.map(function (e) {\n\t\t\t\t\tif (e.id === devId) {\n\t\t\t\t\t\te.id = uid + ':screen';\n\t\t\t\t\t}\n\t\t\t\t\treturn e;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlogger.debug('API setSEI() - uid: ' + uid + ' type: ' + type + ' isScreen: ' + isScreen + ' sei: ' + (0, _stringify2.default)(sei) + ' devId: ' + devId);\n\n\t\t\t_promise2.default.resolve().then(function () {\n\t\t\t\tlogger.debug('API setSEI() - setMixer sType: ' + (0, _stringify2.default)(sType));\n\t\t\t\t_this22._protoo.send('setMixer', sType);\n\t\t\t\treturn;\n\t\t\t}).then(function () {\n\t\t\t\t_this22._protoo.send('setSEI', { sei: sei });\n\n\t\t\t\tif (typeof onSuccess === 'function') {\n\t\t\t\t\tonSuccess();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}).catch(function (error) {\n\t\t\t\tlogger.warn('API setSEI() error - ' + error.toString());\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('' + error.toString());\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * subscribe other room's audio/video\n   * @param {*} subscribeRoomId \n   * @param {function} onSuccess \n   * @param {function} onFailure \n   */\n\n\t}, {\n\t\tkey: 'subscribeOtherRoom',\n\t\tvalue: function subscribeOtherRoom(subscribeRoomId, onSuccess, onFailure) {\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API subscribeOtherRoom() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API subscribeOtherRoom() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!subscribeRoomId) {\n\t\t\t\tlogger.warn('API subscribeOtherRoom() error - parameter: subscribeRoomId invalid');\n\t\t\t\tonFailure('Param error - subscribeRoomId is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API subscribeOtherRoom() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._joined) {\n\t\t\t\tlogger.warn('API subscribeOtherRoom() error - non-joined');\n\n\t\t\t\tonFailure('non-joined');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._role !== '1') {\n\t\t\t\tlogger.warn('API subscribeOtherRoom() error - Must be master - this._role: ' + this._role);\n\n\t\t\t\tonFailure('Must be master');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.warn('API subscribeOtherRoom() - subscribeRoomId: ' + subscribeRoomId);\n\n\t\t\tthis._protoo.send('subscribeOtherRoom', { subscribeRoomId: subscribeRoomId }).then(onSuccess).catch(onFailure);\n\t\t}\n\n\t\t/**\n   * unsubscribe other room's audio/video\n   * @param {*} unsubscribeRoomId \n   * @param {function} onSuccess \n   * @param {function} onFailure \n   */\n\n\t}, {\n\t\tkey: 'unsubscribeOtherRoom',\n\t\tvalue: function unsubscribeOtherRoom(unsubscribeRoomId, onSuccess, onFailure) {\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API unsubscribeOtherRoom() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API unsubscribeOtherRoom() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!unsubscribeRoomId) {\n\t\t\t\tlogger.warn('API unsubscribeOtherRoom() error - parameter: unsubscribeRoomId invalid');\n\t\t\t\tonFailure('Param error - unsubscribeRoomId is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API unsubscribeOtherRoom() error - protooTransport broken');\n\n\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._joined) {\n\t\t\t\tlogger.warn('API unsubscribeOtherRoom() error - non-joined');\n\n\t\t\t\tonFailure('non-joined');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._role !== '1') {\n\t\t\t\tlogger.warn('API unsubscribeOtherRoom() error - Must be master - this._role: ' + this._role);\n\n\t\t\t\tonFailure('Must be master');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.warn('API unsubscribeOtherRoom() - subscribeRoomId: ' + unsubscribeRoomId);\n\n\t\t\tthis._protoo.send('unsubscribeOtherRoom', { unsubscribeRoomId: unsubscribeRoomId }).then(onSuccess).catch(onFailure);\n\t\t}\n\n\t\t/**\n   * switch user role\n   * @param {Number} role\n   * @param {Function} onSuccess\n   * @param {Function} onFailure\n   */\n\n\t}, {\n\t\tkey: 'setUserRole',\n\t\tvalue: function setUserRole(role, onSuccess, onFailure) {\n\t\t\tvar _this23 = this;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API setUserRole() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API setUserRole() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!role) {\n\t\t\t\tlogger.warn('API setUserRole() error - parameter [role] is INVALID.');\n\n\t\t\t\tonFailure('Param error - role is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar formatRole = +role;\n\t\t\tif (this._joined) {\n\t\t\t\tif (!this._protooTransportStat) {\n\t\t\t\t\tlogger.warn('API setUserRole() error - protooTransport broken');\n\n\t\t\t\t\tonFailure('protooTransport is broken');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// 如果要切换到 3 ，则首先应判断当前是否有 publish，如有 publish，应通知上层首先 unpublish\n\t\t\t\tif (formatRole === 3 && this.isPublish) {\n\t\t\t\t\tlogger.warn('API setUserRole() error - unpublish all the stream before setUserRole');\n\n\t\t\t\t\tonFailure('Please unpublish all stream');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (+this._role === formatRole) {\n\t\t\t\t\tonFailure('Role: no changed.');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (formatRole !== 2 && formatRole !== 3) {\n\t\t\t\t\tlogger.warn('API setUserRole() error - Role: Only allowed between 2 | 3');\n\n\t\t\t\t\tonFailure('Role: Only allowed between 2 | 3');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// 不允许对主播身份进行切换\n\t\t\t\tif (+this._role === 1) {\n\t\t\t\t\tlogger.warn('API setUserRole() error - Role: Only allowed between 2 | 3');\n\n\t\t\t\t\tonFailure('Role: Only allowed between 2 | 3');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('API setUserRole() - role: ' + formatRole);\n\n\t\t\t\t// send message\n\t\t\t\tthis._protoo.send('changeRole', { role: formatRole }).then(function () {\n\t\t\t\t\tlogger.debug('API setUserRole() succ');\n\t\t\t\t\t_this23._role = formatRole + '';\n\t\t\t\t\tonSuccess();\n\t\t\t\t}).catch(function (e) {\n\t\t\t\t\tlogger.debug('API setUserRole() fail - ' + e.toString());\n\t\t\t\t\tonFailure(e.toString());\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (formatRole > 3 || formatRole < 1) {\n\t\t\t\t\tlogger.warn('API setUserRole() error - parameter [role] is INVALID.');\n\t\t\t\t\tonFailure('Role: Only allowed between 1 | 2 | 3');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlogger.warn('API setUserRole() - role: ' + role);\n\n\t\t\t\tthis._role = role + '';\n\n\t\t\t\tonSuccess();\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'setVideoMixerBGIUrl',\n\t\tvalue: function setVideoMixerBGIUrl(url, onSuccess, onFailure) {\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API setVideoMixerBGIUrl() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API setVideoMixerBGIUrl() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (typeof url !== 'string') {\n\t\t\t\tlogger.warn('API setVideoMixerBGIUrl() error - url: ' + (typeof url === 'undefined' ? 'undefined' : (0, _typeof3.default)(url)));\n\n\t\t\t\tonFailure('parameter [url] is INVALID');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._videoMixerBGIUrl = url.trim();\n\n\t\t\tif (this._joined) {\n\t\t\t\tthis._protoo.send('updateVideoMixerBGIUrl', { roomId: this._roomId, url: url });\n\t\t\t\tlogger.debug('API setVideoMixerBGIUrl() success - ' + url);\n\n\t\t\t\tonSuccess();\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'setRtmpUrl',\n\t\tvalue: function setRtmpUrl(opts, onSuccess, onFailure) {\n\t\t\tvar url = opts.url,\n\t\t\t    avMode = opts.avMode;\n\t\t\t/*\n   // TODO : 未来再做有效性检查 -- 目前需要向前兼容\n   if (typeof onSuccess !== 'function')\n   {\n   \tlogger.error('API setRtmpUrl() error - parameter: onSuccess invalid');\n   \tthrow TypeError('onSuccess is not function.');\n   }\n   \tif (typeof onFailure !== 'function')\n   {\n   \tlogger.error('API setRtmpUrl() error - parameter: onFailure invalid');\n   \tthrow TypeError('onFailure is not function.');\n   }\n   */\n\n\t\t\tvar mediaType = 0;\n\t\t\tif ((typeof avMode === 'undefined' ? 'undefined' : (0, _typeof3.default)(avMode)) !== undefined && avMode === 'audio') {\n\t\t\t\tmediaType = 1;\n\t\t\t} else {\n\t\t\t\tmediaType = 2;\n\t\t\t}\n\n\t\t\tif (typeof url !== 'string') {\n\t\t\t\tlogger.warn('API setRtmpUrl() error - url: ' + (typeof url === 'undefined' ? 'undefined' : (0, _typeof3.default)(url)));\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('parameter [url] is INVALID');\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/* 暂不执行格式检查，由上层保证\n   let pattern = new RegExp('^(rtmp?:\\\\/\\\\/)?' + // protocol\n   \t'((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|' + // domain name\n   \t'((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))' + // OR ip (v4) address\n   \t'(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*' + // port and path\n   \t'(\\\\?[;:&a-z\\\\d%_.~+=-]*)?' + // query string\n   \t'(\\\\#[-a-z\\\\d_]*)?$', 'i'); // fragment locator\n   if (!pattern.test(url))\n   {\n   \tlogger.warn(`API setRtmpUrl() error - url is invalid`);\n   \tthrow Error('url is invalid');\n   }\n   */\n\n\t\t\tthis._valid_rtmp_url = url.trim();\n\n\t\t\tif (this._joined) {\n\t\t\t\tthis._protoo.send('updateRtmpUrl', { roomId: this._roomId, url: url, mediaType: mediaType });\n\t\t\t\tlogger.debug('API setRtmpUrl() success - ' + url + ' mediaType: ' + mediaType);\n\n\t\t\t\tif (typeof onSuccess === 'function') {\n\t\t\t\t\tonSuccess();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * update token\n   * @param {string} token\n   */\n\n\t}, {\n\t\tkey: 'renewToken',\n\t\tvalue: function renewToken(token, onSuccess, onFailure) {\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.error('API renewToken() error - parameter: onSuccess invalid');\n\t\t\t\tthrow TypeError('onSuccess is not function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.error('API renewToken() error - parameter: onFailure invalid');\n\t\t\t\tthrow TypeError('onFailure is not function.');\n\t\t\t}\n\n\t\t\tif (!this._joined) {\n\t\t\t\tlogger.warn('you should join room first.');\n\t\t\t\tonFailure('non-joined');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (typeof token === 'string') {\n\t\t\t\tthis._protoo.send('refreshToken', { token: token });\n\t\t\t} else {\n\t\t\t\tonFailure('Param error - token is invalid');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * kickout peer.\n   * @param {string} userId \n   */\n\n\t}, {\n\t\tkey: 'kickOut',\n\t\tvalue: function kickOut(userId, onSuccess, onFailure) {\n\t\t\t/*\n   // TODO : 未来再做有效性检查 -- 目前需要向前兼容\n   if (typeof onSuccess !== 'function')\n   {\n   \tlogger.error('API kickOut() error - parameter: onSuccess invalid');\n   \tthrow TypeError('onSuccess is not function.');\n   }\n   \tif (typeof onFailure !== 'function')\n   {\n   \tlogger.error('API kickOut() error - parameter: onFailure invalid');\n   \tthrow TypeError('onFailure is not function.');\n   }\n   */\n\n\t\t\tif (!this._protooTransportStat) {\n\t\t\t\tlogger.warn('API kickOut() error - protooTransport broken');\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('protooTransport broken');\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._joined) {\n\t\t\t\tlogger.warn('API kickOut() error - non-joined');\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('non-joined');\n\t\t\t\t}\n\n\t\t\t\treturn; // throw TypeError('non-joined');\n\t\t\t}\n\n\t\t\tif (!userId) {\n\t\t\t\tlogger.warn('API kickOut() error - parameter [userId] is INVALID.');\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('parameter [userId] is INVALID');\n\t\t\t\t}\n\n\t\t\t\treturn; // throw TypeError('userId');\n\t\t\t}\n\n\t\t\tvar uid = userId + '';\n\t\t\tuid = uid.trim();\n\n\t\t\tif (uid === '') {\n\t\t\t\tlogger.warn('API kickOut() error - parameter [userId] is INVALID.');\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('parameter [userId] is INVALID');\n\t\t\t\t}\n\n\t\t\t\treturn; // throw TypeError('userId');\n\t\t\t}\n\n\t\t\tif (this._role !== '1') {\n\t\t\t\tlogger.warn('API kickOut() error - Must be master - this._role: ' + this._role);\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure('Must be master');\n\t\t\t\t}\n\n\t\t\t\treturn; // throw Error('You not master so no permission of kickout.');\n\t\t\t}\n\n\t\t\tif (!this._peers.get(uid)) {\n\t\t\t\tlogger.warn('API kickOut() error - userId: ' + uid + ' not found.');\n\n\t\t\t\tif (typeof onFailure === 'function') {\n\t\t\t\t\tonFailure(uid + ' not found');\n\t\t\t\t}\n\n\t\t\t\treturn; // throw Error(`no this peer: ${uid}`);\n\t\t\t}\n\n\t\t\tlogger.warn('API kickOut() - userId: ' + uid);\n\n\t\t\tthis._protoo.send('kickout', { peerId: uid });\n\n\t\t\tif (typeof onSuccess === 'function') {\n\t\t\t\tonSuccess();\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * get status of ice(sendtransport, recvtransport)\\websocket\\login\n   */\n\n\t}, {\n\t\tkey: 'getTransportStatus',\n\t\tvalue: function getTransportStatus() {\n\t\t\treturn {\n\t\t\t\ticeSendTransport: !this._sendTransport || !this._sendTransport._handler || !this._sendTransport._handler._pc ? 'fault' : this._sendTransport._handler._pc.iceConnectionState,\n\t\t\t\ticeRecvTransport: !this._recvTransport || !this._recvTransport._handler || !this._recvTransport._handler._pc ? 'fault' : this._recvTransport._handler._pc.iceConnectionState,\n\t\t\t\twebsocketTransport: !this._protoo || !this._protoo._transport ? 'fault' : this._protoo._transport.connected,\n\t\t\t\tloginStatus: this._joined ? 'online' : 'offline'\n\t\t\t};\n\t\t}\n\n\t\t/**\n   * extract Resulution (width and height) from stats\n   * @param {Any} stats \n   */\n\n\t}, {\n\t\tkey: '_extractResolution',\n\t\tvalue: function _extractResolution(stats) {\n\t\t\tvar resolution = {\n\t\t\t\tframeHeight: 0,\n\t\t\t\tframeWidth: 0\n\t\t\t};\n\n\t\t\tvar BreakException = {};\n\t\t\tstats.forEach(function (report) {\n\t\t\t\t(0, _keys2.default)(report).forEach(function (statName) {\n\t\t\t\t\tif (statName.toLocaleLowerCase() === 'frameheight') //frameHeight\n\t\t\t\t\t\tresolution.frameHeight = report[statName];\n\t\t\t\t\tif (statName.toLocaleLowerCase() === 'framewidth') //frameWidth\n\t\t\t\t\t\tresolution.frameWidth = report[statName];\n\t\t\t\t});\n\n\t\t\t\ttry {\n\t\t\t\t\tif (resolution.frameWidth !== 0) {\n\t\t\t\t\t\tthrow BreakException;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e !== BreakException) throw e;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn resolution;\n\t\t}\n\n\t\t/**\n   * Generate new sending transport.\n   * @param {string} direction send | recv.\n   * @param {string} type Media type of string.\n   */\n\n\t}, {\n\t\tkey: '_newTransport',\n\t\tvalue: function () {\n\t\t\tvar _ref14 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee12(direction, type) {\n\t\t\t\tvar _this24 = this;\n\n\t\t\t\tvar type_, sendTransport;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee12$(_context12) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context12.prev = _context12.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\ttype_ = '';\n\n\t\t\t\t\t\t\t\tif (!(typeof direction === 'undefined' || direction === null)) {\n\t\t\t\t\t\t\t\t\t_context12.next = 5;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context12.abrupt('return');\n\n\t\t\t\t\t\t\tcase 5:\n\t\t\t\t\t\t\t\tif (!(direction !== 'send' && direction !== 'recv')) {\n\t\t\t\t\t\t\t\t\t_context12.next = 7;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context12.abrupt('return');\n\n\t\t\t\t\t\t\tcase 7:\n\n\t\t\t\t\t\t\t\tif (typeof type === 'undefined' || type === null) {\n\t\t\t\t\t\t\t\t\ttype_ = 'SEND_MIC_WEBCAM';\n\t\t\t\t\t\t\t\t} else if (type === '') {\n\t\t\t\t\t\t\t\t\ttype_ = 'SEND_MIC_WEBCAM';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttype_ = type;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tsendTransport = this._room.createTransport('send', { media: type_ });\n\n\n\t\t\t\t\t\t\t\tsendTransport.on('close', function (originator) {\n\t\t\t\t\t\t\t\t\tlogger.debug('sendTransport event [close] - [originator: ' + originator + ']');\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// The actual code of events we are intresting, and all the stuff heppens in below lines of 'failed'.\n\t\t\t\t\t\t\t\t// Note: The major stats PC follow with default sending transport, thus try one time at here.\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tsendTransport.on('connectionstatechange', function () {\n\t\t\t\t\t\t\t\t\tvar _ref15 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee11(connectionstate) {\n\t\t\t\t\t\t\t\t\t\treturn _regenerator2.default.wrap(function _callee11$(_context11) {\n\t\t\t\t\t\t\t\t\t\t\twhile (1) {\n\t\t\t\t\t\t\t\t\t\t\t\tswitch (_context11.prev = _context11.next) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (connectionstate === 'disconnected') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// only for stat\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this24._iceSendDisconnectedCnt++;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.warn('sendTransport disconnected. will retryRestartIce...');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this24._retryRestartIce(sendTransport);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, _this24.TIMEOUT_ICE_DISCONNECTED);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (connectionstate === 'failed') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.warn('sendTransport failed. will retryRestartIce...');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this24._retryRestartIce(sendTransport);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (connectionstate === 'connected') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// for webrtc internals\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetStats(sendTransport._handler._pc, function (result) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this24._stats.setWebrtcInternalSendStats(result);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// end for webrtc internals\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('sendTransport connectionstatechange: ' + connectionstate);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn _context11.stop();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}, _callee11, _this24);\n\t\t\t\t\t\t\t\t\t}));\n\n\t\t\t\t\t\t\t\t\treturn function (_x13) {\n\t\t\t\t\t\t\t\t\t\treturn _ref15.apply(this, arguments);\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}());\n\n\t\t\t\t\t\t\t\treturn _context12.abrupt('return', sendTransport);\n\n\t\t\t\t\t\t\tcase 12:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context12.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee12, this);\n\t\t\t}));\n\n\t\t\tfunction _newTransport(_x11, _x12) {\n\t\t\t\treturn _ref14.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn _newTransport;\n\t\t}()\n\n\t\t/**\n   * Interanal statistic data.\n   * @param {string} direction for interanl statistic data.\n   * @param {Any} stats statistic data.\n   * @param {name} consumer name.\n   * @param {id} consumer id.\n   */\n\n\t}, {\n\t\tkey: '_internalStats',\n\t\tvalue: function _internalStats(direction, stats, name, id) {\n\t\t\t// Receiver stats[that's our concerned]\n\t\t\t// Report type=media-source\n\t\t\t// Report type=certificate ? option\n\t\t\t// Report type=codec\n\t\t\t// Report type=candidate-pair\n\t\t\t// Report type=local-candidate\n\t\t\t// Report type=remote-candidate\n\t\t\t// Report type=inbound-rtp\n\t\t\t// Report type=outbound-rtp\n\t\t\t// Report type=media-source\n\t\t\t// Report type=remote-inbound-rtp\n\t\t\t// Report type=track\n\t\t\t// Report type=stream\n\t\t\t// Report type=peer-connection\n\t\t\t// Report type=transport\n\n\t\t\t// direction: Receiver stats | Sender stats\n\t\t\tvar result = {\n\t\t\t\t'appId': this._appId,\n\t\t\t\t'userId': this._uid,\n\t\t\t\t'roomId': this._roomId,\n\t\t\t\t'stats': 'internalStats',\n\t\t\t\t'direction': direction,\n\t\t\t\t'media-source': [],\n\t\t\t\t'certificate': [],\n\t\t\t\t'codec': [],\n\t\t\t\t'candidate-pair': [],\n\t\t\t\t'local-candidate': [],\n\t\t\t\t'remote-candidate': [],\n\t\t\t\t'inbound-rtp': [],\n\t\t\t\t'outbound-rtp': [],\n\t\t\t\t'remote-inbound-rtp': [],\n\t\t\t\t'track': [],\n\t\t\t\t'stream': [],\n\t\t\t\t'peer-connection': [],\n\t\t\t\t'transport': []\n\t\t\t};\n\n\t\t\tstats.forEach(function (res) {\n\t\t\t\tif (res.type === 'certificate') {\n\t\t\t\t\t//ignore\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'codec') {\n\t\t\t\t\tresult['codec'].push(res);\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'candidate-pair') {\n\t\t\t\t\tresult['candidate-pair'].push(res);\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'local-candidate') {\n\t\t\t\t\tresult['local-candidate'].push(res);\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'inbound-rtp') {\n\t\t\t\t\tresult['inbound-rtp'].push(res);\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'track') {\n\t\t\t\t\tresult['track'].push(res);\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'stream') {\n\t\t\t\t\tresult['stream'].push(res);\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'peer-connection') {\n\t\t\t\t\tresult['peer-connection'].push(res);\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'transport') {\n\t\t\t\t\tresult['transport'].push(res);\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'media-source') {\n\t\t\t\t\tresult['media-source'].push(res);\n\t\t\t\t}\n\n\t\t\t\tif (res.type === 'transport') {\n\t\t\t\t\tresult['transport'].push(res);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (direction === 'receiverStats') {\n\t\t\t\tresult.consumerPeerId = name;\n\t\t\t\tresult.consumer = id;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t}, {\n\t\tkey: 'producerStreams',\n\t\tget: function get() {\n\t\t\tvar streams = [];\n\n\t\t\tthis._publishStreams.forEach(function (s, key) {\n\t\t\t\tif (!s) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar item = {\n\t\t\t\t\tstreamId: s.streamID,\n\t\t\t\t\ttype: s.streamType,\n\t\t\t\t\tuserId: s.userID,\n\t\t\t\t\tspecialCameraId: s.specialCameraId,\n\t\t\t\t\tspecialMicId: s.specialMicId,\n\t\t\t\t\thasVideo: s.hasVideo(),\n\t\t\t\t\thasAudio: s.hasAudio()\n\t\t\t\t};\n\n\t\t\t\tstreams.push(item);\n\t\t\t});\n\n\t\t\treturn streams;\n\t\t}\n\t}, {\n\t\tkey: 'consumerStreams',\n\t\tget: function get() {\n\t\t\tvar streams = [];\n\n\t\t\tthis._peers.forEach(function (value, key) {\n\t\t\t\tif (!value.streams) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvalue.streams.forEach(function (s, index) {\n\t\t\t\t\tif (!s) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar item = {\n\t\t\t\t\t\tstreamId: s.streamID,\n\t\t\t\t\t\ttype: s.streamType,\n\t\t\t\t\t\tuserId: s.userID,\n\t\t\t\t\t\tspecialCameraId: s.specialCameraId,\n\t\t\t\t\t\tspecialMicId: s.specialMicId,\n\t\t\t\t\t\thasVideo: s.hasVideo(),\n\t\t\t\t\t\thasAudio: s.hasAudio()\n\t\t\t\t\t};\n\n\t\t\t\t\t// \n\t\t\t\t\tstreams.push(item);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn streams;\n\t\t}\n\n\t\t// \n\n\t}, {\n\t\tkey: 'micProducers',\n\t\tget: function get() {\n\t\t\tvar producers = [];\n\n\t\t\tthis._mapMicProducers.forEach(function (value, key) {\n\t\t\t\tvar item = {\n\t\t\t\t\tstreamId: key,\n\t\t\t\t\tappData: value.appData\n\t\t\t\t};\n\n\t\t\t\t// \n\t\t\t\tproducers.push(item);\n\t\t\t});\n\n\t\t\treturn producers;\n\t\t}\n\t}, {\n\t\tkey: 'webcamProducers',\n\t\tget: function get() {\n\t\t\tvar producers = [];\n\n\t\t\tthis._mapWebcamProducers.forEach(function (value, key) {\n\t\t\t\tvar item = {\n\t\t\t\t\tstreamId: key,\n\t\t\t\t\tappData: value.appData\n\t\t\t\t};\n\n\t\t\t\t// \n\t\t\t\tproducers.push(item);\n\t\t\t});\n\n\t\t\treturn producers;\n\t\t}\n\t}, {\n\t\tkey: 'screenProducers',\n\t\tget: function get() {\n\t\t\tvar producers = [];\n\n\t\t\tif (this._screenProducer != null) {\n\t\t\t\tvar item = {\n\t\t\t\t\tstreamId: 'x_screen',\n\t\t\t\t\tappData: this._screenProducer.appData\n\t\t\t\t};\n\n\t\t\t\t// \n\t\t\t\tproducers.push(item);\n\t\t\t}\n\n\t\t\treturn producers;\n\t\t}\n\t}, {\n\t\tkey: 'isLocalStreamAllowed',\n\t\tget: function get() {\n\t\t\tvar role = +this._role;\n\t\t\treturn role === 1 || role === 2;\n\t\t}\n\t}, {\n\t\tkey: 'isPublish',\n\t\tget: function get() {\n\t\t\tif (!this._publishs) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this._publishs.size > 0;\n\t\t}\n\t}, {\n\t\tkey: 'closed',\n\t\tget: function get() {\n\t\t\treturn this._closed;\n\t\t}\n\t}], [{\n\t\tkey: 'JOIN_ROOM_TIME_OUT',\n\t\tget: function get() {\n\t\t\treturn 4000; // 10000;\n\t\t}\n\n\t\t// ice reconnect waiting time.\n\n\t}, {\n\t\tkey: 'TIMEOUT_ICE_DISCONNECTED',\n\t\tget: function get() {\n\t\t\treturn 10000;\n\t\t}\n\n\t\t// limit ice retry number of times.\n\n\t}, {\n\t\tkey: 'ICE_RETRY_NUM_TIME',\n\t\tget: function get() {\n\t\t\treturn 10;\n\t\t}\n\n\t\t/**\n   * @param {Any} conf TURN configure.\n   * Set TURN server configure.\n   */\n\n\t}, {\n\t\tkey: 'TurnConf',\n\t\tset: function set(conf) {\n\t\t\tif (typeof conf === 'undefined' || conf === null) {\n\t\t\t\tthrow new TypeError('turn configure');\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tturnConf.urls = conf.urls;\n\t\t\t\tturnConf.credential = conf.credential;\n\t\t\t\tturnConf.username = conf.username;\n\t\t\t\tturnConf.iceTransportPolicy = conf.iceTransportPolicy;\n\t\t\t} catch (e) {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t}]);\n\treturn Client;\n}(_events.EventEmitter);\n\nexports.default = Client;\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/_webpack@4.41.6@webpack/buildin/global.js */ \"./node_modules/_webpack@4.41.6@webpack/buildin/global.js\")))\n\n/***/ }),\n\n/***/ \"./lib/config.js\":\n/*!***********************!*\\\n  !*** ./lib/config.js ***!\n  \\***********************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * client config of default.\n * You can coustom it and pass to client object as parameter.\n */\nvar clientConfig = {\n  mode: 'live',\n  codec: 'vp8',\n  proxyServer: 'YOUR NGINX PROXY SERVER IP',\n  turnServer: {\n    turnServerURL: 'turn:114.116.84.241', //YOUR TURNSERVER URL\n    username: 'ttt', //YOUR USERNAME\n    password: '123456', //YOUR PASSWORD\n    udpport: 'THE UDP PORT YOU WANT TO ADD',\n    tcpport: 'THE TCP PORT YOU WANT TO ADD',\n    iceTransportPolicy: 'all' // relay, all\n  },\n  svcRootUrl: '119_3_245_117.3ttech.cn',\n  role: '2',\n  publish_rtmp_url: 'rtmp://push.3ttech.cn/sdk/?',\n  subcribe_rtmp_url: 'rtmp://pull.3ttech.cn/sdk/?'\n};\n\n/**\n * retry protoo-client\n * @ref: https://www.npmjs.com/package/retry#retryoperationoptions\n * @ref: https://protoojs.org/#websockettransport34\n */\nvar protoo_peer_RETRY_OPTIONS = {\n  retries: 3,\n  factor: 2,\n  minTimeout: 1 * 1000,\n  maxTimeout: 8 * 1000\n};\n\n// \nvar tttErrMsg = new _map2.default([[1, { reason: 'success' }], [2, { reason: 'auth lock dog - noresource' }], [4, { reason: 'already in channel' }], [5, { reason: 'param invalid' }], [6, { reason: 'no server available' }], [9, { reason: 'already login' }], [10, { reason: 'overmax' }], [11, { reason: 'audio timeout' }], [12, { reason: 'video timeout' }], [13, { reason: 'live not start' }], [14, { reason: 'timeout' }], [15, { reason: 'update user media message' }], [16, { reason: 'no-chair' }], [17, { reason: 'user non-exist' }], [18, { reason: 'record error' }], [19, { reason: 'audiomixer error' }], [20, { reason: 'dboper error' }], [21, { reason: 'chair password error' }], [22, { reason: 'password error' }], [23, { reason: 'no password' }], [24, { reason: 'channel is not exist' }], [25, { reason: 'invalid appid' }], [26, { reason: 'rtmp connect' }], [27, { reason: 'authentication' }], [30, { reason: 'connect timeout' }]]);\n\n/**\n * stream specication config.\n */\nvar spec = {\n  userID: '',\n  streamID: '',\n  audio: false,\n  video: false,\n  screen: true,\n  extensionId: 'minllpmhdgpndnkomcoccfekfegnlikg'\n\n  /**\n   * the log level by defined.\n   */\n};var logLevel = {\n  'LOG_NONE': 6, //不输出日志信息\n  'LOG_ERROR': 5, //输出 ERROR 级别的日志信息\n  'LOG_WARN': 4, //输出 WARN 和 ERROR 级别的日志信息\n  'LOG_INFO': 3, // 输出 INFO WARN 和 ERROR 级别的日志信息\n  'LOG_DEBUG': 2, //输出所有 API 日志信息\n  'LOG_TRACE': 1\n};\n\n/**\n * The video profile information.\n * @type {{Profile_80p: string, Profile_120p: string, Profile_180p: string, Profile_240p: string, Profile_360p: string, Profile_480p: string, Profile_720p: string, Profile_1080: string}}\n */\nvar videoProfile = {\n  // profile of resolution  |resolution  | FPS  | bps * k\n  Profile_80p: '80p', //110*80     | 15   | 50*1000 \n  Profile_120p: '120p', //120*160    | 15   | 60*1000\n  Profile_160p: '160p', //210*160    | 15   | 100*1000\n  Profile_200p: '200p', //270*200    | 15   | 140*1000\n  Profile_240p: '240p', //320*240    | 15   | 200*1000\n  Profile_320p: '320p', //420*240    | 15   | 250*1000\n  Profile_360p: '360p', //480*360    | 15   | 300*1000\n  Profile_480p: '480p', //640*480    | 15   | 500*1000\n  Profile_540p: '540p', //720*540    | 15   | 800*1000\n  Profile_720p: '720p', //1024*720   | 15   | 1130*1000\n  Profile_1080p: '1080p', //1920*1080  | 15   | 2080*1000\n  Profile_3840p: '3840p', //3840*2160  | 15   | 8000*1000\n  Profile_7680p: '7680p' //7680*4320  | 15   | 20000*1000\n};\n\n/** 4:3 resolution and bandwidth */\nvar videoResolution = new _map2.default([[80, { width: 110, height: 80, bps: { ideal: 60 * 1000, min: 50 * 1000, max: 100 * 1000 } }], [120, { width: 160, height: 120, bps: { ideal: 65 * 1000, min: 60 * 1000, max: 100 * 1000 } }], [160, { width: 210, height: 160, bps: { ideal: 140 * 1000, min: 100 * 1000, max: 200 * 1000 } }], [200, { width: 270, height: 200, bps: { ideal: 140 * 1000, min: 100 * 1000, max: 200 * 1000 } }], [240, { width: 320, height: 240, bps: { ideal: 300 * 1000, min: 200 * 1000, max: 400 * 1000 } }], [320, { width: 420, height: 320, bps: { ideal: 350 * 1000, min: 250 * 1000, max: 500 * 1000 } }], [360, { width: 480, height: 360, bps: { ideal: 400 * 1000, min: 300 * 1000, max: 600 * 1000 } }], [480, { width: 640, height: 480, bps: { ideal: 500 * 1000, min: 400 * 1000, max: 800 * 1000 } }], [540, { width: 720, height: 540, bps: { ideal: 1000 * 1000, min: 800 * 1000, max: 1200 * 1000 } }], [720, { width: 1280, height: 720, bps: { ideal: 1130 * 1000, min: 1000 * 1000, max: 2000 * 1000 } }], [1080, { width: 1920, height: 1080, bps: { ideal: 2000 * 1000, min: 1800 * 1000, max: 3000 * 1000 } }], [3840, { width: 3840, height: 2160, bps: { ideal: 8000 * 1000, min: 7000 * 1000, max: 15000 * 1000 } }], [7680, { width: 7680, height: 4320, bps: { ideal: 20000 * 1000, min: 15000 * 1000, max: 25000 * 1000 } }]]);\n\n/** the screen resolution and bandwidth. */\nvar screenResolution = new _map2.default([[720, { width: 1280, height: 720, bps: { ideal: 1000 * 1000, min: 800 * 1000, max: 1500 * 1000 } }], [1080, { width: 1920, height: 1080, bps: { ideal: 1800 * 1000, min: 1500 * 1000, max: 2000 * 1000 } }], [2160, { width: 3840, height: 2160, bps: { ideal: 2500 * 1000, min: 2000 * 1000, max: 3000 * 1000 } }], [4320, { width: 7680, height: 4320, bps: { ideal: 3000 * 1000, min: 2500 * 1000, max: 4000 * 1000 } }]]);\n\n/**\n * The video resolution constraints.\n * A vast majority of the customer leaverage it thus it's defined by sensor producters.\n */\nvar videoAttributes = {\n  sif: [320, 240],\n  vga: [640, 480],\n  hd720p: [1280, 720]\n\n  /**\n   * video parameter\n   */\n};var videoSpec = {\n  /**\n   * The invalid constraint error in safari is because the browser expects that you pass a correct width, one of:\n   *   320\n   *   640\n   *   1280\n   *  the height is auto calculate in an aspect ratio of 4:3 for 320 or 640, and 16:9 for 1280, then if you pass a width of 320, you video stream is set in:\n   */\n  width: { min: 80, ideal: 640, max: 1920 },\n  height: { min: 60, ideal: 480, max: 1080 },\n  bitrate: { min: 80, max: 2000, ideal: 400 },\n  frameRate: { min: 2, ideal: 15, max: 30 },\n  aspectRatio: 4 / 3\n};\n\n/**\n * audio parameters.\n */\nvar audioSpec = {\n  sampleRate: {\n    min: 4000,\n    max: 48000,\n    ideal: 8000\n  },\n  channelCount: {\n    min: 1,\n    max: 2,\n    ideal: 1\n  }\n\n  //\n  // {\n  //\tstereo : 1, // 取值 1 / 0\n  //\tmaxaveragebitrate : 24 * 1024, // 数值型\n  //\tmaxplaybackrate   : 48000, // 数值型\n  //\tcbr : 1, // 取值 1 / 0\n  //\tuseinbandfec : 1, // 取值 1 / 0\n  //\tusedtx : 1, // 取值 1 / 0\n  //\tmaxptime : 20, // 最大打包时长\n  // }\n  // speech_low_quality | speech_standard | music_standard | standard_stereo | high_quality | high_quality_stereo\n};var audioProfileSpec = new _map2.default([['isac32', {\n  codec: 'isac',\n  maxplaybackrate: 32000,\n  stereo: 0,\n  maxaveragebitrate: 40 * 1024\n}], ['speech_low_quality', {\n  codec: 'opus',\n  maxplaybackrate: 16000,\n  stereo: 0,\n  maxaveragebitrate: 24 * 1024\n}], ['speech_standard', {\n  codec: 'opus',\n  maxplaybackrate: 32000,\n  stereo: 0,\n  maxaveragebitrate: 24 * 1024\n}], ['music_standard', {\n  codec: 'opus',\n  maxplaybackrate: 48000,\n  stereo: 0,\n  maxaveragebitrate: 40 * 1024\n}], ['standard_stereo', {\n  codec: 'opus',\n  maxplaybackrate: 48000,\n  stereo: 1,\n  maxaveragebitrate: 64 * 1024\n}], ['high_quality', {\n  codec: 'opus',\n  maxplaybackrate: 48000,\n  stereo: 0,\n  maxaveragebitrate: 128 * 1024\n}], ['high_quality_stereo', {\n  codec: 'opus',\n  maxplaybackrate: 48000,\n  stereo: 1,\n  maxaveragebitrate: 192 * 1024\n}]]);\n\n/**\n * screen specification constraints.\n */\nvar screenSpec = {\n  's_frameRate': 15,\n  's_720p': {\n    maxWidth: 1280,\n    maxHeight: 720,\n    maxAspectRatio: 1.77\n  },\n  's_1080p': {\n    maxWidth: 1920,\n    maxHeight: 1080,\n    maxAspectRatio: 1.77\n  },\n  's_2k': {\n    maxWidth: 2048,\n    maxHeight: 1080,\n    maxAspectRatio: 1.77\n  },\n  's_4k': {\n    maxWidth: 3840,\n    maxHeight: 2160,\n    maxAspectRatio: 1.77\n  },\n  's_8k': {\n    maxWidth: 7680,\n    maxHeight: 4320,\n    maxAspectRatio: 1.77\n  }\n\n  /**\n   * log server url.\n   * @type {string}\n   */\n};var logserver_url = 'https://log.wushuangtech.com:15100'; // 'https://log.3tcall.com:15100';// \n\n/**\n * The authorization server address. server support JSONP callback.\n * @type {string}\n * 废弃\n */\nvar auth_url = 'https://apiusercenter.3ttech.cn/authority.php';\n\n/**\n * ip location address.\n * @type {string}\n */\nvar iplocationAddress = 'webdispatch.3ttech.cn';\n\nvar iplocationPort = 443;\n\n/**\n * control server address.\n * @type {string}\n */\nvar mediaServerAddress = ''; //'webdispatch.3ttech.cn';\n\nmodule.exports = {\n  clientConfig: clientConfig,\n  logLevel: logLevel,\n  authUrl: auth_url,\n  audioProfileSpec: audioProfileSpec,\n  videoProfile: videoProfile,\n  audioSpec: audioSpec,\n  videoSpec: videoSpec,\n  mediaServerAddress: mediaServerAddress,\n  tttErrMsg: tttErrMsg,\n  logserver_url: logserver_url,\n  iplocationAddress: iplocationAddress,\n  iplocationPort: iplocationPort,\n  videoResolution: videoResolution,\n  screenResolution: screenResolution,\n  videoAttributes: videoAttributes,\n  protoo_peer_RETRY_OPTIONS: protoo_peer_RETRY_OPTIONS,\n  screenSpec: screenSpec\n};\n\n/***/ }),\n\n/***/ \"./lib/getStats.js\":\n/*!*************************!*\\\n  !*** ./lib/getStats.js ***!\n  \\*************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\n\n// Last time updated: 2019-02-20 3:31:29 PM UTC\n\n// _______________\n// getStats v1.2.0\n\n// Open-Sourced: https://github.com/muaz-khan/getStats\n\n// --------------------------------------------------\n// Muaz Khan     - www.MuazKhan.com\n// MIT License   - www.WebRTC-Experiment.com/licence\n// --------------------------------------------------\n\nvar _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/keys.js\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar statInterval = 0;\n\nvar getStats = function getStats(mediaStreamTrack, callback, interval) {\n\n\tvar browserFakeUserAgent = 'Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45';\n\n\t(function (that) {\n\t\tif (!that) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof window !== 'undefined') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof global === 'undefined') {\n\t\t\treturn;\n\t\t}\n\n\t\tglobal.navigator = {\n\t\t\tuserAgent: browserFakeUserAgent,\n\t\t\tgetUserMedia: function getUserMedia() {}\n\t\t};\n\n\t\tif (!global.console) {\n\t\t\tglobal.console = {};\n\t\t}\n\n\t\tif (typeof global.console.log === 'undefined' || typeof global.console.error === 'undefined') {\n\t\t\tglobal.console.error = global.console.log = global.console.log || function () {\n\t\t\t\tconsole.log(arguments);\n\t\t\t};\n\t\t}\n\n\t\tif (typeof document === 'undefined') {\n\t\t\t/*global document:true */\n\t\t\tthat.document = {\n\t\t\t\tdocumentElement: {\n\t\t\t\t\tappendChild: function appendChild() {\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tdocument.createElement = document.captureStream = document.mozCaptureStream = function () {\n\t\t\t\tvar obj = {\n\t\t\t\t\tgetContext: function getContext() {\n\t\t\t\t\t\treturn obj;\n\t\t\t\t\t},\n\t\t\t\t\tplay: function play() {},\n\t\t\t\t\tpause: function pause() {},\n\t\t\t\t\tdrawImage: function drawImage() {},\n\t\t\t\t\ttoDataURL: function toDataURL() {\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\treturn obj;\n\t\t\t};\n\n\t\t\tthat.HTMLVideoElement = function () {};\n\t\t}\n\n\t\tif (typeof location === 'undefined') {\n\t\t\t/*global location:true */\n\t\t\tthat.location = {\n\t\t\t\tprotocol: 'file:',\n\t\t\t\thref: '',\n\t\t\t\thash: ''\n\t\t\t};\n\t\t}\n\n\t\tif (typeof screen === 'undefined') {\n\t\t\t/*global screen:true */\n\t\t\tthat.screen = {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0\n\t\t\t};\n\t\t}\n\n\t\tif (typeof URL === 'undefined') {\n\t\t\t/*global screen:true */\n\t\t\tthat.URL = {\n\t\t\t\tcreateObjectURL: function createObjectURL() {\n\t\t\t\t\treturn '';\n\t\t\t\t},\n\t\t\t\trevokeObjectURL: function revokeObjectURL() {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (typeof MediaStreamTrack === 'undefined') {\n\t\t\t/*global screen:true */\n\t\t\tthat.MediaStreamTrack = function () {};\n\t\t}\n\n\t\tif (typeof RTCPeerConnection === 'undefined') {\n\t\t\t/*global screen:true */\n\t\t\tthat.RTCPeerConnection = function () {};\n\t\t}\n\n\t\t/*global window:true */\n\t\tthat.window = global;\n\t})(typeof global !== 'undefined' ? global : null);\n\n\tvar RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;\n\n\tif (typeof MediaStreamTrack === 'undefined') {\n\t\tMediaStreamTrack = {}; // todo?\n\t}\n\n\tvar systemNetworkType = ((navigator.connection || {}).type || 'unknown').toString().toLowerCase();\n\n\tvar getStatsResult = {\n\t\tisSafari: false,\n\t\tencryption: 'sha-256',\n\t\taudio: {\n\t\t\tssrc: []\n\t\t},\n\t\tvideo: {\n\t\t\tssrc: []\n\t\t},\n\t\tbandwidth: {\n\t\t\tsystemBandwidth: 0, // 目前暂未用\n\t\t\tsentPerSecond: 0, // 目前暂未用\n\t\t\tencodedPerSecond: 0, // 目前暂未用\n\t\t\thelper: {\n\t\t\t\tprevBytesReceived: 0, // 用于计算 bandwith.downSpeed\n\t\t\t\tprevBytesSent: 0 // 用于计算 bandwith.upSpeed\n\t\t\t},\n\t\t\tupSpeed: 0, // \n\t\t\tdownSpeed: 0,\n\t\t\trtt: 0\n\t\t},\n\t\tresults: {},\n\t\tconnectionType: {\n\t\t\tsystemNetworkType: systemNetworkType,\n\t\t\tlocal: {\n\t\t\t\tcandidateType: '',\n\t\t\t\ttransport: '',\n\t\t\t\tipAddress: '',\n\t\t\t\tportNumber: '',\n\t\t\t\tnetworkType: ''\n\t\t\t},\n\t\t\tremote: {\n\t\t\t\tcandidateType: '',\n\t\t\t\ttransport: '',\n\t\t\t\tipAddress: '',\n\t\t\t\tportNumber: ''\n\t\t\t}\n\t\t},\n\t\tinternal: {\n\t\t\tactiveConnection: {\n\t\t\t\tlocalCandidate: '',\n\t\t\t\tremoteCandidate: ''\n\t\t\t},\n\t\t\taudio: {},\n\t\t\tvideo: {},\n\t\t\tcandidates: []\n\t\t},\n\t\tnomore: function nomore() {\n\t\t\t_nomore = true;\n\t\t}\n\t};\n\n\tvar getStatsParser = {\n\t\tcheckIfOfferer: function checkIfOfferer(result) {\n\t\t\tif (result.type === 'googLibjingleSession') {\n\t\t\t\tgetStatsResult.isOfferer = result.googInitiator;\n\t\t\t}\n\t\t}\n\t};\n\n\tvar isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\n\t// \n\tgetStatsResult.isSafari = isSafari;\n\n\tvar peer = this;\n\n\tif (!(arguments[0] instanceof RTCPeerConnection)) {\n\t\tthrow '1st argument is not instance of RTCPeerConnection.';\n\t}\n\n\tpeer = arguments[0];\n\n\tif (arguments[1] instanceof MediaStreamTrack) {\n\t\tmediaStreamTrack = arguments[1]; // redundant on non-safari\n\t\tcallback = arguments[2];\n\t\tinterval = arguments[3];\n\t}\n\n\t// \n\tif (+interval < 1000) {\n\t\tinterval = 1000;\n\t}\n\n\t// \n\tstatInterval = interval;\n\n\tvar _nomore = false;\n\n\tfunction getStatsLooper() {\n\t\tgetStatsWrapper(function (results) {\n\t\t\tif (!results || !results.forEach) return;\n\n\t\t\t// dump\n\t\t\t// console.log(`<WEBRTC-STAT> ${JSON.stringify(results)}`);\n\n\t\t\t/*\n   if (isSafari)\n   \treturn;\n   */\n\t\t\tresults.forEach(function (result) {\n\t\t\t\t// console.error('result', result);\n\t\t\t\t(0, _keys2.default)(getStatsParser).forEach(function (key) {\n\t\t\t\t\tif (typeof getStatsParser[key] === 'function') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tgetStatsParser[key](result);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.warn(e.message, e.stack, e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tif (peer.iceConnectionState.search(/failed|closed|disconnected/gi) !== -1) {\n\t\t\t\t\t_nomore = true;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_nomore = true;\n\t\t\t}\n\n\t\t\tif (_nomore === true) {\n\t\t\t\tif (getStatsResult.datachannel) {\n\t\t\t\t\tgetStatsResult.datachannel.state = 'close';\n\t\t\t\t}\n\t\t\t\tgetStatsResult.ended = true;\n\t\t\t}\n\n\t\t\t// \n\t\t\tgetStatsResult.internal.candidates.forEach(function (candidate) {\n\t\t\t\tif (!candidate) return;\n\n\t\t\t\tif (candidate.id === getStatsResult.internal.activeConnection.localCandidate) {\n\t\t\t\t\tgetStatsResult.connectionType.local.candidateType = candidate.candidateType;\n\t\t\t\t\tgetStatsResult.connectionType.local.ipAddress = candidate.ipAddress;\n\t\t\t\t\tgetStatsResult.connectionType.local.portNumber = candidate.portNumber;\n\t\t\t\t\tgetStatsResult.connectionType.local.networkType = candidate.networkType;\n\t\t\t\t\tgetStatsResult.connectionType.local.transport = candidate.transport;\n\t\t\t\t} else if (candidate.id === getStatsResult.internal.activeConnection.remoteCandidate) {\n\t\t\t\t\tgetStatsResult.connectionType.remote.candidateType = candidate.candidateType;\n\t\t\t\t\tgetStatsResult.connectionType.remote.ipAddress = candidate.ipAddress;\n\t\t\t\t\tgetStatsResult.connectionType.remote.portNumber = candidate.portNumber;\n\t\t\t\t\tgetStatsResult.connectionType.remote.transport = candidate.transport;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// allow users to access native results\n\t\t\tgetStatsResult.results = results;\n\n\t\t\t// \n\t\t\tgetStatsResult.audio.ssrc.forEach(function (ssrc) {\n\t\t\t\t// TODO : \n\t\t\t});\n\n\t\t\t// \n\t\t\tgetStatsResult.video.ssrc.forEach(function (ssrc) {\n\t\t\t\t// TODO : \n\t\t\t});\n\n\t\t\t// console.log(`<WEBRTC-STAT-RES> ${JSON.stringify(getStatsResult)}`)\n\n\t\t\tcallback(getStatsResult);\n\n\t\t\t// second argument checks to see, if target-user is still connected.\n\t\t\tif (!_nomore) {\n\t\t\t\t(typeof interval === 'undefined' ? 'undefined' : (0, _typeof3.default)(interval)) != undefined && interval && setTimeout(getStatsLooper, interval || 1000);\n\t\t\t}\n\t\t});\n\t}\n\n\t// a wrapper around getStats which hides the differences (where possible)\n\t// following code-snippet is taken from somewhere on the github\n\tfunction getStatsWrapper(cb) {\n\t\t// if !peer or peer.signalingState == 'closed' then return;\n\n\t\tif (typeof window.InstallTrigger !== 'undefined' || isSafari) {\n\t\t\t// maybe \"isEdge?\"\n\t\t\tpeer.getStats(window.mediaStreamTrack || null).then(function (res) {\n\t\t\t\tvar items = [];\n\t\t\t\tres.forEach(function (r) {\n\t\t\t\t\titems.push(r);\n\t\t\t\t});\n\t\t\t\tcb(items);\n\t\t\t}).catch(cb);\n\t\t} else {\n\t\t\tpeer.getStats(function (res) {\n\t\t\t\tvar items = [];\n\t\t\t\tres.result().forEach(function (res) {\n\t\t\t\t\tvar item = {};\n\t\t\t\t\tres.names().forEach(function (name) {\n\t\t\t\t\t\titem[name] = res.stat(name);\n\t\t\t\t\t});\n\t\t\t\t\titem.id = res.id;\n\t\t\t\t\titem.type = res.type;\n\t\t\t\t\titem.timestamp = res.timestamp;\n\t\t\t\t\titems.push(item);\n\t\t\t\t});\n\t\t\t\tcb(items);\n\t\t\t});\n\t\t}\n\t};\n\n\tgetStatsParser.datachannel = function (result) {\n\t\tif (result.type !== 'datachannel') return;\n\n\t\tgetStatsResult.datachannel = {\n\t\t\tstate: result.state // open or connecting\n\t\t};\n\t};\n\n\tgetStatsParser.googCertificate = function (result) {\n\t\tif (result.type == 'googCertificate') {\n\t\t\tgetStatsResult.encryption = result.googFingerprintAlgorithm;\n\t\t}\n\n\t\t// Safari-11 or higher\n\t\tif (result.type == 'certificate') {\n\t\t\t// todo: is it possible to have different encryption methods for senders and receivers?\n\t\t\t// if yes, then we need to set:\n\t\t\t//    getStatsResult.encryption.local = value;\n\t\t\t//    getStatsResult.encryption.remote = value;\n\t\t\tgetStatsResult.encryption = result.fingerprintAlgorithm;\n\t\t}\n\t};\n\n\t// \n\tgetStatsParser.checkAudioTracks = function (result) {\n\t\tif (result.type !== 'ssrc') return;\n\t\tif (result.mediaType !== 'audio') return;\n\n\t\tvar ssrc = result.ssrc;\n\n\t\tvar sendrecvType = result.id.split('_').pop();\n\t\tif (result.isRemote === true) {\n\t\t\tsendrecvType = 'recv';\n\t\t}\n\t\tif (result.isRemote === false) {\n\t\t\tsendrecvType = 'send';\n\t\t}\n\n\t\tif (!sendrecvType) return;\n\n\t\t// 将 ssrc 记录下来\n\t\tif (getStatsResult.audio.ssrc.indexOf(ssrc) === -1) {\n\t\t\tgetStatsResult.audio.ssrc.push(ssrc);\n\t\t}\n\n\t\t// \n\t\tif (!getStatsResult.audio[ssrc]) {\n\t\t\tgetStatsResult.audio[ssrc] = {};\n\t\t\tgetStatsResult.audio[ssrc][sendrecvType] = {};\n\t\t\tgetStatsResult.audio[ssrc][sendrecvType].codecs = [];\n\t\t\tgetStatsResult.audio[ssrc][sendrecvType].tracks = [];\n\t\t}\n\n\t\tif (!!result.googCodecName && result.googCodecName !== '') {\n\t\t\tif (getStatsResult.audio[ssrc][sendrecvType].codecs.indexOf(result.googCodecName) === -1) {\n\t\t\t\tgetStatsResult.audio[ssrc][sendrecvType].codecs.push(result.googCodecName);\n\t\t\t}\n\t\t}\n\n\t\t// \n\t\tif (!getStatsResult.internal.audio[ssrc]) {\n\t\t\tgetStatsResult.internal.audio[ssrc] = {};\n\t\t}\n\n\t\t//\n\t\tif (!getStatsResult.internal.audio[ssrc][sendrecvType]) {\n\t\t\tgetStatsResult.internal.audio[ssrc][sendrecvType] = {};\n\t\t}\n\n\t\tvar bytes = 0;\n\t\tvar kilobytes = 0;\n\t\t// \n\t\tif (sendrecvType === 'send' && result.bytesSent !== undefined) {\n\t\t\tif (!getStatsResult.internal.audio[ssrc][sendrecvType].prevBytesSent) {\n\t\t\t\tgetStatsResult.internal.audio[ssrc][sendrecvType].prevBytesSent = 0; //result.bytesSent;\n\t\t\t}\n\n\t\t\tbytes = result.bytesSent - getStatsResult.internal.audio[ssrc][sendrecvType].prevBytesSent;\n\t\t\tgetStatsResult.internal.audio[ssrc][sendrecvType].prevBytesSent = result.bytesSent;\n\n\t\t\tkilobytes = bytes * 8 / 1024; // to kbps\n\t\t\tgetStatsResult.audio[ssrc][sendrecvType].availableBandwidth = parseInt(kilobytes, 10);\n\t\t\tgetStatsResult.audio[ssrc].upSpeedKBPS = parseInt(kilobytes, 10);\n\t\t}\n\n\t\tif (sendrecvType === 'recv' && result.bytesReceived !== undefined) {\n\t\t\tif (!getStatsResult.internal.audio[ssrc][sendrecvType].prevBytesReceived) {\n\t\t\t\tgetStatsResult.internal.audio[ssrc][sendrecvType].prevBytesReceived = 0; //result.bytesReceived;\n\t\t\t}\n\n\t\t\tbytes = result.bytesReceived - getStatsResult.internal.audio[ssrc][sendrecvType].prevBytesReceived;\n\t\t\tgetStatsResult.internal.audio[ssrc][sendrecvType].prevBytesReceived = result.bytesReceived;\n\n\t\t\tkilobytes = bytes * 8 / 1024; // to kbps\n\n\t\t\t// getStatsResult.audio[sendrecvType].availableBandwidth = kilobytes.toFixed(1);\n\t\t\tgetStatsResult.audio[ssrc].downSpeedKBPS = parseInt(kilobytes, 10);\n\t\t}\n\n\t\tif (result.googTrackId && getStatsResult.audio[ssrc][sendrecvType].tracks.indexOf(result.googTrackId) === -1) {\n\t\t\tgetStatsResult.audio[ssrc][sendrecvType].tracks.push(result.googTrackId);\n\t\t}\n\n\t\t// calculate latency\n\t\tif (result.googCurrentDelayMs !== undefined) {\n\t\t\tgetStatsResult.internal.audio[ssrc].googCurrentDelayMs = result.googCurrentDelayMs;\n\n\t\t\tgetStatsResult.audio[ssrc].latency = parseInt(result.googCurrentDelayMs, 10);\n\n\t\t\tif (getStatsResult.audio[ssrc].latency < 0) {\n\t\t\t\tgetStatsResult.audio[ssrc].latency = 0;\n\t\t\t}\n\t\t}\n\n\t\tvar pkts = 0;\n\t\t// \n\t\tif (sendrecvType === 'recv' && result.packetsReceived !== undefined) {\n\t\t\tif (!getStatsResult.internal.audio[ssrc].prevPacketsReceived) {\n\t\t\t\tgetStatsResult.internal.audio[ssrc].prevPacketsReceived = 0;\n\t\t\t}\n\n\t\t\tpkts = result.packetsReceived - getStatsResult.internal.audio[ssrc].prevPacketsReceived;\n\t\t\tgetStatsResult.internal.audio[ssrc].prevPacketsReceived = result.packetsReceived;\n\n\t\t\tgetStatsResult.audio[ssrc].packetsReceived = parseInt(pkts, 10);\n\n\t\t\tif (getStatsResult.audio[ssrc].packetsReceived < 0) {\n\t\t\t\tgetStatsResult.audio[ssrc].packetsReceived = 0;\n\t\t\t}\n\t\t}\n\n\t\t// \n\t\tif (sendrecvType === 'send' && result.packetsSent !== undefined) {\n\t\t\tif (!getStatsResult.internal.audio[ssrc].prevPacketsSent) {\n\t\t\t\tgetStatsResult.internal.audio[ssrc].prevPacketsSent = 0;\n\t\t\t}\n\n\t\t\tpkts = result.packetsSent - getStatsResult.internal.audio[ssrc].prevPacketsSent;\n\t\t\tgetStatsResult.internal.audio[ssrc].prevPacketsSent = result.packetsSent;\n\n\t\t\tgetStatsResult.audio[ssrc].packetsSent = parseInt(pkts, 10);\n\n\t\t\tif (getStatsResult.audio[ssrc].packetsSent < 0) {\n\t\t\t\tgetStatsResult.audio[ssrc].packetsSent = 0;\n\t\t\t}\n\t\t}\n\n\t\t// calculate packetsLost\n\t\tif (result.packetsLost !== undefined) {\n\t\t\tif (!getStatsResult.internal.audio[ssrc].prevPacketsLost) {\n\t\t\t\tgetStatsResult.internal.audio[ssrc].prevPacketsLost = 0; //result.packetsLost;\n\t\t\t}\n\n\t\t\tvar lost = result.packetsLost - getStatsResult.internal.audio[ssrc].prevPacketsLost;\n\t\t\tgetStatsResult.internal.audio[ssrc].prevPacketsLost = result.packetsLost;\n\n\t\t\tgetStatsResult.audio[ssrc].packetsLost = parseInt(lost, 10);\n\n\t\t\tif (getStatsResult.audio[ssrc].packetsLost < 0) {\n\t\t\t\tgetStatsResult.audio[ssrc].packetsLost = 0;\n\t\t\t}\n\t\t}\n\t};\n\n\tgetStatsParser.checkVideoTracks = function (result) {\n\t\tif (result.type !== 'ssrc') return;\n\t\tif (result.mediaType !== 'video') return;\n\n\t\tvar ssrc = result.ssrc;\n\n\t\tvar sendrecvType = result.id.split('_').pop();\n\t\tif (result.isRemote === true) {\n\t\t\tsendrecvType = 'recv';\n\t\t}\n\t\tif (result.isRemote === false) {\n\t\t\tsendrecvType = 'send';\n\t\t}\n\n\t\tif (!sendrecvType) return;\n\n\t\t// 将 ssrc 记录下来\n\t\tif (getStatsResult.video.ssrc.indexOf(ssrc) === -1) {\n\t\t\tgetStatsResult.video.ssrc.push(ssrc);\n\t\t}\n\n\t\t// \n\t\tif (!getStatsResult.video[ssrc]) {\n\t\t\tgetStatsResult.video[ssrc] = {};\n\t\t\tgetStatsResult.video[ssrc][sendrecvType] = {};\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].codecs = [];\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].tracks = [];\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].resolutions = {};\n\t\t}\n\n\t\tif (getStatsResult.video[ssrc][sendrecvType].codecs.indexOf(result.googCodecName || 'VP8') === -1) {\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].codecs.push(result.googCodecName || 'VP8');\n\t\t}\n\n\t\t// \n\t\tif (!getStatsResult.internal.video[ssrc]) {\n\t\t\tgetStatsResult.internal.video[ssrc] = {};\n\t\t\tgetStatsResult.internal.video[ssrc][sendrecvType] = {};\n\t\t}\n\n\t\t//\n\t\tif (!getStatsResult.internal.video[ssrc][sendrecvType]) {\n\t\t\tgetStatsResult.internal.video[ssrc][sendrecvType] = {};\n\t\t}\n\n\t\tvar bytes = 0;\n\t\tvar kilobytes = 0;\n\t\tif (sendrecvType === 'send' && result.bytesSent !== undefined) {\n\t\t\tif (!getStatsResult.internal.video[ssrc][sendrecvType].prevBytesSent) {\n\t\t\t\tgetStatsResult.internal.video[ssrc][sendrecvType].prevBytesSent = 0; //result.bytesSent;\n\t\t\t}\n\n\t\t\tbytes = result.bytesSent - getStatsResult.internal.video[ssrc][sendrecvType].prevBytesSent;\n\t\t\tgetStatsResult.internal.video[ssrc][sendrecvType].prevBytesSent = result.bytesSent;\n\n\t\t\tkilobytes = bytes * 8 / 1024; // to kbps\n\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].availableBandwidth = parseInt(kilobytes, 10);\n\t\t\tgetStatsResult.video[ssrc].upSpeedKBPS = parseInt(kilobytes, 10);\n\t\t}\n\n\t\tif (sendrecvType === 'recv' && result.bytesReceived !== undefined) {\n\t\t\tif (!getStatsResult.internal.video[ssrc][sendrecvType].prevBytesReceived) {\n\t\t\t\tgetStatsResult.internal.video[ssrc][sendrecvType].prevBytesReceived = 0; //result.bytesReceived;\n\t\t\t}\n\n\t\t\tbytes = result.bytesReceived - getStatsResult.internal.video[ssrc][sendrecvType].prevBytesReceived;\n\t\t\tgetStatsResult.internal.video[ssrc][sendrecvType].prevBytesReceived = result.bytesReceived;\n\n\t\t\tkilobytes = bytes * 8 / 1024; // to kbps\n\t\t\t// getStatsResult.video[ssrc][sendrecvType].availableBandwidth = kilobytes.toFixed(1);\n\t\t\tgetStatsResult.video[ssrc].downSpeedKBPS = parseInt(kilobytes, 10);\n\t\t}\n\n\t\tif (result.googFrameHeightReceived && result.googFrameWidthReceived) {\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].resolutions.width = result.googFrameWidthReceived;\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].resolutions.height = result.googFrameHeightReceived;\n\t\t}\n\n\t\tif (result.googFrameHeightSent && result.googFrameWidthSent) {\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].resolutions.width = result.googFrameWidthSent;\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].resolutions.height = result.googFrameHeightSent;\n\t\t}\n\n\t\tif (result.googTrackId && getStatsResult.video[ssrc][sendrecvType].tracks.indexOf(result.googTrackId) === -1) {\n\t\t\tgetStatsResult.video[ssrc][sendrecvType].tracks.push(result.googTrackId);\n\t\t}\n\n\t\t// calculate latency\n\t\tif (result.googCurrentDelayMs !== undefined) {\n\t\t\tgetStatsResult.internal.video[ssrc].googCurrentDelayMs = result.googCurrentDelayMs;\n\n\t\t\tgetStatsResult.video[ssrc].latency = parseInt(result.googCurrentDelayMs, 10);\n\n\t\t\tif (getStatsResult.video[ssrc].latency < 0) {\n\t\t\t\tgetStatsResult.video[ssrc].latency = 0;\n\t\t\t}\n\t\t}\n\n\t\tvar pkts = 0;\n\t\t// \n\t\tif (sendrecvType === 'recv' && result.packetsReceived !== undefined) {\n\t\t\tif (!getStatsResult.internal.video[ssrc].prevPacketsReceived) {\n\t\t\t\tgetStatsResult.internal.video[ssrc].prevPacketsReceived = 0;\n\t\t\t}\n\n\t\t\tpkts = result.packetsReceived - getStatsResult.internal.video[ssrc].prevPacketsReceived;\n\t\t\tgetStatsResult.internal.video[ssrc].prevPacketsReceived = result.packetsReceived;\n\n\t\t\tgetStatsResult.video[ssrc].packetsReceived = parseInt(pkts, 10);\n\n\t\t\tif (getStatsResult.video[ssrc].packetsReceived < 0) {\n\t\t\t\tgetStatsResult.video[ssrc].packetsReceived = 0;\n\t\t\t}\n\t\t}\n\n\t\t// \n\t\tif (sendrecvType === 'send' && result.packetsSent !== undefined) {\n\t\t\tif (!getStatsResult.internal.video[ssrc].prevPacketsSent) {\n\t\t\t\tgetStatsResult.internal.video[ssrc].prevPacketsSent = 0;\n\t\t\t}\n\n\t\t\tpkts = result.packetsSent - getStatsResult.internal.video[ssrc].prevPacketsSent;\n\t\t\tgetStatsResult.internal.video[ssrc].prevPacketsSent = result.packetsSent;\n\n\t\t\tgetStatsResult.video[ssrc].packetsSent = parseInt(pkts, 10);\n\n\t\t\tif (getStatsResult.video[ssrc].packetsSent < 0) {\n\t\t\t\tgetStatsResult.video[ssrc].packetsSent = 0;\n\t\t\t}\n\t\t}\n\n\t\t// calculate packetsLost\n\t\tif (result.packetsLost !== undefined) {\n\t\t\tif (!getStatsResult.internal.video[ssrc].prevPacketsLost) {\n\t\t\t\tgetStatsResult.internal.video[ssrc].prevPacketsLost = 0; //result.packetsLost;\n\t\t\t}\n\n\t\t\tvar lost = result.packetsLost - getStatsResult.internal.video[ssrc].prevPacketsLost;\n\t\t\tgetStatsResult.internal.video[ssrc].prevPacketsLost = result.packetsLost;\n\n\t\t\tgetStatsResult.video[ssrc].packetsLost = parseInt(lost, 10);\n\n\t\t\tif (getStatsResult.video[ssrc].packetsLost < 0) {\n\t\t\t\tgetStatsResult.video[ssrc].packetsLost = 0;\n\t\t\t}\n\t\t}\n\t};\n\n\tgetStatsParser.bweforvideo = function (result) {\n\t\tif (result.type !== 'VideoBwe') return;\n\n\t\tgetStatsResult.bandwidth.availableSendBandwidth = result.googAvailableSendBandwidth;\n\n\t\tgetStatsResult.bandwidth.googActualEncBitrate = result.googActualEncBitrate;\n\t\tgetStatsResult.bandwidth.googAvailableSendBandwidth = result.googAvailableSendBandwidth;\n\t\tgetStatsResult.bandwidth.googAvailableReceiveBandwidth = result.googAvailableReceiveBandwidth;\n\t\tgetStatsResult.bandwidth.googRetransmitBitrate = result.googRetransmitBitrate;\n\t\tgetStatsResult.bandwidth.googTargetEncBitrate = result.googTargetEncBitrate;\n\t\tgetStatsResult.bandwidth.googBucketDelay = result.googBucketDelay;\n\t\tgetStatsResult.bandwidth.googTransmitBitrate = result.googTransmitBitrate;\n\t};\n\n\tgetStatsParser.candidatePair = function (result) {\n\t\tif (result.type !== 'googCandidatePair' && result.type !== 'candidate-pair' && result.type !== 'local-candidate' && result.type !== 'remote-candidate') return;\n\n\t\t// result.googActiveConnection means either STUN or TURN is used.\n\n\t\tif (!isSafari) {\n\t\t\tif (result.googActiveConnection == 'true') {\n\t\t\t\t// id === 'Conn-audio-1-0'\n\t\t\t\t// localCandidateId, remoteCandidateId\n\t\t\t\tgetStatsResult.internal.activeConnection.remoteCandidate = result.remoteCandidateId;\n\t\t\t\tgetStatsResult.internal.activeConnection.localCandidate = result.localCandidateId;\n\n\t\t\t\t// \n\t\t\t\tgetStatsResult.connectionType.transport = result.googTransportType;\n\n\t\t\t\tgetStatsResult.bandwidth.rtt = result.googRtt;\n\n\t\t\t\t// \n\t\t\t\tvar downSpeed = (result.bytesReceived - getStatsResult.bandwidth.helper.prevBytesReceived) * 1000 * 8 / statInterval;\n\t\t\t\tvar upSpeed = (result.bytesSent - getStatsResult.bandwidth.helper.prevBytesSent) * 1000 * 8 / statInterval;\n\t\t\t\tgetStatsResult.bandwidth.helper.prevBytesReceived = result.bytesReceived;\n\t\t\t\tgetStatsResult.bandwidth.helper.prevBytesSent = result.bytesSent;\n\t\t\t\t// \n\t\t\t\tupSpeed = upSpeed > 0 ? upSpeed / 1024 : 0;\n\t\t\t\tdownSpeed = downSpeed > 0 ? downSpeed / 1024 : 0;\n\t\t\t\tgetStatsResult.bandwidth.upSpeed = parseInt(upSpeed, 10); // kbps\n\t\t\t\tgetStatsResult.bandwidth.downSpeed = parseInt(downSpeed, 10); // kbps\n\t\t\t}\n\n\t\t\tif (result.type === 'candidate-pair') {\n\t\t\t\tif (result.selected === true && result.nominated === true && result.state === 'succeeded') {\n\t\t\t\t\t// remoteCandidateId, localCandidateId, componentId\n\t\t\t\t\tvar localCandidate = getStatsResult.internal.candidates[result.remoteCandidateId];\n\t\t\t\t\tvar remoteCandidate = getStatsResult.internal.candidates[result.remoteCandidateId];\n\n\t\t\t\t\t// Firefox used above two pairs for connection\n\t\t\t\t}\n\t\t\t}\n\t\t} else // isSafari\n\t\t\t{\n\t\t\t\tif (result.type !== 'candidate-pair' || result.nominated !== true || result.state !== 'succeeded') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar sendrecvType = result.availableOutgoingBitrate !== undefined ? 'send' : 'recv';\n\n\t\t\t\tgetStatsResult.internal.activeConnection.remoteCandidate = result.remoteCandidateId;\n\t\t\t\tgetStatsResult.internal.activeConnection.localCandidate = result.localCandidateId;\n\n\t\t\t\tgetStatsResult.bandwidth.rtt = result.currentRoundTripTime * 1000;\n\n\t\t\t\tif (sendrecvType === 'send' && result.bytesSent !== undefined) {\n\t\t\t\t\tvar _upSpeed = (result.bytesSent - getStatsResult.bandwidth.helper.prevBytesSent) * 1000 * 8 / statInterval;\n\t\t\t\t\tgetStatsResult.bandwidth.helper.prevBytesSent = result.bytesSent;\n\t\t\t\t\t// \n\t\t\t\t\t_upSpeed = _upSpeed > 0 ? _upSpeed / 1024 : 0;\n\t\t\t\t\tgetStatsResult.bandwidth.upSpeed = parseInt(_upSpeed, 10); // kbps\n\t\t\t\t}\n\n\t\t\t\tif (sendrecvType === 'recv' && result.bytesReceived !== undefined) {\n\t\t\t\t\t// \n\t\t\t\t\tvar _downSpeed = (result.bytesReceived - getStatsResult.bandwidth.helper.prevBytesReceived) * 1000 * 8 / statInterval;\n\t\t\t\t\tgetStatsResult.bandwidth.helper.prevBytesReceived = result.bytesReceived;\n\t\t\t\t\t// \n\t\t\t\t\t_downSpeed = _downSpeed > 0 ? _downSpeed / 1024 : 0;\n\t\t\t\t\tgetStatsResult.bandwidth.downSpeed = parseInt(_downSpeed, 10); // kbps\n\t\t\t\t}\n\n\t\t\t\tif (result.availableOutgoingBitrate !== undefined) {\n\t\t\t\t\t// TODO : \n\t\t\t\t}\n\n\t\t\t\tif (result.availableIncomingBitrate !== undefined) {\n\t\t\t\t\t// TODO : \n\t\t\t\t}\n\t\t\t}\n\t};\n\n\tgetStatsParser.localcandidate = function (result) {\n\t\tif (result.type !== 'localcandidate' && result.type !== 'local-candidate') return;\n\t\tif (!result.id) return;\n\n\t\tvar candidate = {\n\t\t\tcandidateType: result.candidateType,\n\t\t\tipAddress: result.ipAddress,\n\t\t\tportNumber: result.portNumber,\n\t\t\tnetworkType: result.networkType,\n\t\t\tpriority: result.priority,\n\t\t\ttransport: result.transport,\n\t\t\ttimestamp: result.timestamp,\n\t\t\tid: result.id,\n\t\t\ttype: result.type\n\t\t};\n\n\t\tgetStatsResult.internal.candidates.push(candidate);\n\t};\n\n\tgetStatsParser.remotecandidate = function (result) {\n\t\tif (result.type !== 'remotecandidate' && result.type !== 'remote-candidate') return;\n\t\tif (!result.id) return;\n\n\t\tvar candidate = {\n\t\t\tcandidateType: result.candidateType,\n\t\t\tipAddress: result.ipAddress,\n\t\t\tportNumber: result.portNumber,\n\t\t\tnetworkType: result.networkType,\n\t\t\tpriority: result.priority,\n\t\t\ttransport: result.transport,\n\t\t\ttimestamp: result.timestamp,\n\t\t\tid: result.id,\n\t\t\ttype: result.type\n\t\t};\n\n\t\tgetStatsResult.internal.candidates.push(candidate);\n\t};\n\n\t/*\n // 暂不用\n getStatsParser.dataSentReceived = function (result)\n {\n \tif (!result.googCodecName || (result.mediaType !== 'video' && result.mediaType !== 'audio'))\n \t\treturn;\n \t\tif (!!result.bytesSent)\n \t{\n \t\tgetStatsResult[result.mediaType].bytesSent = parseInt(result.bytesSent);\n \t}\n \t\tif (!!result.bytesReceived)\n \t{\n \t\tgetStatsResult[result.mediaType].bytesReceived = parseInt(result.bytesReceived);\n \t}\n };\n */\n\n\t// 如下为 safari 下相关处理\n\tgetStatsParser.inboundrtp = function (result) {\n\t\tif (!isSafari) return;\n\t\tif (result.type !== 'inbound-rtp') return;\n\n\t\tvar mediaType = result.mediaType || 'audio';\n\t\tvar sendrecvType = 'recv'; // result.isRemote ? 'recv' : 'send';\n\n\t\tif (!sendrecvType) return;\n\n\t\tvar ssrc = result.ssrc;\n\n\t\t// \n\t\tif (!getStatsResult[mediaType][ssrc]) {\n\t\t\tgetStatsResult[mediaType][ssrc] = {};\n\t\t\tgetStatsResult[mediaType][ssrc][sendrecvType] = {};\n\t\t}\n\n\t\tif (!getStatsResult.internal[mediaType][ssrc]) {\n\t\t\tgetStatsResult.internal[mediaType][ssrc] = {};\n\t\t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType] = {};\n\t\t}\n\n\t\t//\n\t\tif (!getStatsResult.internal[mediaType][ssrc][sendrecvType]) {\n\t\t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType] = {};\n\t\t}\n\n\t\t/*\n  if (!!result.bytesSent)\n  {\n  \tvar kilobytes = 0;\n  \tif (!getStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesSent)\n  \t{\n  \t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesSent = 0;//result.bytesSent;\n  \t}\n  \t\tvar bytes = result.bytesSent - getStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesSent;\n  \tgetStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesSent = result.bytesSent;\n  \t\tkilobytes = (bytes * 8 / 1024); // to kbps\n  \t\tgetStatsResult[mediaType][sendrecvType].availableBandwidth = kilobytes.toFixed(1);\n  \tgetStatsResult[mediaType].upSpeedKBPS = kilobytes.toFixed(1);\n  }\n  */\n\n\t\tif (result.bytesReceived !== undefined) {\n\t\t\t// \n\t\t\tvar kilobytes = 0;\n\t\t\tif (!getStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesReceived) {\n\t\t\t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesReceived = 0; //result.bytesReceived;\n\t\t\t}\n\n\t\t\tvar bytes = result.bytesReceived - getStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesReceived;\n\t\t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesReceived = result.bytesReceived;\n\n\t\t\tkilobytes = bytes * 8 / 1024; // to kbps\n\t\t\t// getStatsResult[mediaType][ssrc][sendrecvType].availableBandwidth = kilobytes.toFixed(1);\n\t\t\tgetStatsResult[mediaType][ssrc].downSpeedKBPS = parseInt(kilobytes, 10);\n\t\t}\n\n\t\t// calculate latency\n\t\tif (result.jitter !== undefined) {\n\t\t\tgetStatsResult.internal[mediaType][ssrc].jitter = result.jitter;\n\n\t\t\tgetStatsResult[mediaType][ssrc].latency = parseInt(result.jitter, 10);\n\n\t\t\tif (getStatsResult[mediaType][ssrc].latency < 0) {\n\t\t\t\tgetStatsResult[mediaType][ssrc].latency = 0;\n\t\t\t}\n\t\t}\n\n\t\t// \n\t\tvar pkts = 0;\n\t\t// \n\t\tif (result.packetsReceived !== undefined) {\n\t\t\tif (!getStatsResult.internal[mediaType][ssrc].prevPacketsReceived) {\n\t\t\t\tgetStatsResult.internal[mediaType][ssrc].prevPacketsReceived = 0;\n\t\t\t}\n\n\t\t\tpkts = result.packetsReceived - getStatsResult.internal[mediaType][ssrc].prevPacketsReceived;\n\t\t\tgetStatsResult.internal[mediaType][ssrc].prevPacketsReceived = result.packetsReceived;\n\n\t\t\tgetStatsResult[mediaType][ssrc].packetsReceived = parseInt(pkts, 10);\n\n\t\t\tif (getStatsResult[mediaType][ssrc].packetsReceived < 0) {\n\t\t\t\tgetStatsResult[mediaType][ssrc].packetsReceived = 0;\n\t\t\t}\n\t\t}\n\n\t\t// calculate packetsLost\n\t\tif (result.packetsLost !== undefined) {\n\t\t\tif (!getStatsResult.internal[mediaType][ssrc].prevPacketsLost) {\n\t\t\t\tgetStatsResult.internal[mediaType][ssrc].prevPacketsLost = 0; //result.packetsLost;\n\t\t\t}\n\n\t\t\tvar lost = result.packetsLost - getStatsResult.internal[mediaType][ssrc].prevPacketsLost;\n\t\t\tgetStatsResult.internal[mediaType][ssrc].prevPacketsLost = result.packetsLost;\n\n\t\t\tgetStatsResult[mediaType][ssrc].packetsLost = parseInt(lost, 10);\n\n\t\t\tif (getStatsResult[mediaType][ssrc].packetsLost < 0) {\n\t\t\t\tgetStatsResult[mediaType][ssrc].packetsLost = 0;\n\t\t\t}\n\t\t}\n\t};\n\n\tgetStatsParser.outboundrtp = function (result) {\n\t\tif (!isSafari) return;\n\t\tif (result.type !== 'outbound-rtp') return;\n\n\t\tvar mediaType = result.mediaType || 'audio';\n\t\tvar sendrecvType = 'send'; // result.isRemote ? 'recv' : 'send';\n\n\t\tif (!sendrecvType) return;\n\n\t\tvar ssrc = result.ssrc;\n\n\t\t// \n\t\tif (!getStatsResult[mediaType][ssrc]) {\n\t\t\tgetStatsResult[mediaType][ssrc] = {};\n\t\t\tgetStatsResult[mediaType][ssrc][sendrecvType] = {};\n\t\t}\n\n\t\tif (!getStatsResult.internal[mediaType][ssrc]) {\n\t\t\tgetStatsResult.internal[mediaType][ssrc] = {};\n\t\t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType] = {};\n\t\t}\n\n\t\t//\n\t\tif (!getStatsResult.internal[mediaType][ssrc][sendrecvType]) {\n\t\t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType] = {};\n\t\t}\n\n\t\tif (result.bytesSent !== undefined) {\n\t\t\t// \n\t\t\tvar kilobytes = 0;\n\t\t\tif (!getStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesSent) {\n\t\t\t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesSent = 0; //result.bytesSent;\n\t\t\t}\n\n\t\t\tvar bytes = result.bytesSent - getStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesSent;\n\t\t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesSent = result.bytesSent;\n\n\t\t\tkilobytes = bytes * 8 / 1024; // to kbps\n\n\t\t\tgetStatsResult[mediaType][ssrc][sendrecvType].availableBandwidth = parseInt(kilobytes, 10);\n\t\t\tgetStatsResult[mediaType][ssrc].upSpeedKBPS = parseInt(kilobytes, 10);\n\t\t}\n\n\t\t/*\n  if (!!result.bytesReceived)\n  {\n  \tvar kilobytes = 0;\n  \tif (!getStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesReceived)\n  \t{\n  \t\tgetStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesReceived = 0;//result.bytesReceived;\n  \t}\n  \t\tvar bytes = result.bytesReceived - getStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesReceived;\n  \tgetStatsResult.internal[mediaType][ssrc][sendrecvType].prevBytesReceived = result.bytesReceived;\n  \t\tkilobytes = (bytes * 8 / 1024); // to kbps\n  \t// getStatsResult[mediaType][sendrecvType].availableBandwidth = kilobytes.toFixed(1);\n  \tgetStatsResult[mediaType].downSpeedKBPS = kilobytes.toFixed(1);\n  }\n  */\n\n\t\tvar pkts = 0;\n\n\t\t// \n\t\tif (result.packetsSent !== undefined) {\n\t\t\tif (!getStatsResult.internal[mediaType][ssrc].prevPacketsSent) {\n\t\t\t\tgetStatsResult.internal[mediaType][ssrc].prevPacketsSent = 0;\n\t\t\t}\n\n\t\t\tpkts = result.packetsSent - getStatsResult.internal[mediaType][ssrc].prevPacketsSent;\n\t\t\tgetStatsResult.internal[mediaType][ssrc].prevPacketsSent = result.packetsSent;\n\n\t\t\tgetStatsResult[mediaType][ssrc].packetsSent = parseInt(pkts, 10);\n\n\t\t\tif (getStatsResult[mediaType][ssrc].packetsSent < 0) {\n\t\t\t\tgetStatsResult[mediaType][ssrc].packetsSent = 0;\n\t\t\t}\n\t\t}\n\n\t\t// calculate packetsLost\n\t\tif (result.packetsLost !== undefined) {\n\t\t\tif (!getStatsResult.internal[mediaType][ssrc].prevPacketsLost) {\n\t\t\t\tgetStatsResult.internal[mediaType][ssrc].prevPacketsLost = 0; //result.packetsLost;\n\t\t\t}\n\n\t\t\tvar lost = result.packetsLost - getStatsResult.internal[mediaType][ssrc].prevPacketsLost;\n\t\t\tgetStatsResult.internal[mediaType][ssrc].prevPacketsLost = result.packetsLost;\n\n\t\t\tgetStatsResult[mediaType][ssrc].packetsLost = parseInt(lost, 10);\n\n\t\t\tif (getStatsResult[mediaType][ssrc].packetsLost < 0) {\n\t\t\t\tgetStatsResult[mediaType][ssrc].packetsLost = 0;\n\t\t\t}\n\t\t}\n\t};\n\n\tgetStatsParser.track = function (result) {\n\t\tif (!isSafari) return;\n\t\tif (result.type !== 'track') return;\n\n\t\tvar sendrecvType = result.remoteSource === true ? 'send' : 'recv';\n\n\t\tif (!getStatsResult.resolutions) {\n\t\t\tgetStatsResult.resolutions = {};\n\t\t\tgetStatsResult.resolutions[sendrecvType] = {};\n\t\t}\n\n\t\tif (!getStatsResult.resolutions[sendrecvType]) {\n\t\t\tgetStatsResult.resolutions[sendrecvType] = {};\n\t\t}\n\n\t\tif (result.frameWidth && result.frameHeight) {\n\t\t\tgetStatsResult.resolutions[sendrecvType].width = result.frameWidth;\n\t\t\tgetStatsResult.resolutions[sendrecvType].height = result.frameHeight;\n\t\t}\n\n\t\t// framesSent, framesReceived\n\t};\n\n\tvar SSRC = {\n\t\taudio: {\n\t\t\tsend: [],\n\t\t\trecv: []\n\t\t},\n\t\tvideo: {\n\t\t\tsend: [],\n\t\t\trecv: []\n\t\t}\n\t};\n\n\tgetStatsParser.ssrc = function (result) {\n\t\tif (!result.googCodecName || result.mediaType !== 'video' && result.mediaType !== 'audio') return;\n\t\tif (result.type !== 'ssrc') return;\n\t\tvar sendrecvType = result.id.split('_').pop();\n\n\t\tif (SSRC[result.mediaType][sendrecvType].indexOf(result.ssrc) === -1) {\n\t\t\tSSRC[result.mediaType][sendrecvType].push(result.ssrc);\n\t\t}\n\n\t\t// getStatsResult[result.mediaType][sendrecvType].streams = SSRC[result.mediaType][sendrecvType].length;\n\t};\n\n\tgetStatsLooper();\n};\n\nif (true /* && !!module.exports*/) {\n\t\tmodule.exports = getStats;\n\t}\n\nif (true) {\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = (function () {\n\t\treturn getStats;\n\t}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n}\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/_webpack@4.41.6@webpack/buildin/global.js */ \"./node_modules/_webpack@4.41.6@webpack/buildin/global.js\")))\n\n/***/ }),\n\n/***/ \"./lib/logger.js\":\n/*!***********************!*\\\n  !*** ./lib/logger.js ***!\n  \\***********************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _debug = __webpack_require__(/*! debug */ \"./node_modules/_debug@4.1.1@debug/src/browser.js\");\n\nvar _debug2 = _interopRequireDefault(_debug);\n\nvar _config = __webpack_require__(/*! ./config */ \"./lib/config.js\");\n\nvar config = _interopRequireWildcard(_config);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/* eslint-disable no-console */\nvar clogLevel = config.logLevel;\n\nvar APP_NAME = 'tttwebsdk';\nvar LOG_LEVEL = clogLevel.LOG_TRACE;\nvar LOG_SUBMIT_ON = true; // 默认开启日志提交（向日志中心提交）\nvar PRIVATE_CLOUD = false; // \n\nvar Logger = function () {\n\tfunction Logger(prefix) {\n\t\t(0, _classCallCheck3.default)(this, Logger);\n\n\t\tthis._userAgent = navigator.userAgent;\n\t\tthis._isMobile = /mobile/i.test(this._userAgent);\n\n\t\t// \n\t\tif (prefix) {\n\t\t\tthis._prefix = APP_NAME + ' ' + prefix;\n\t\t\tthis._debug = (0, _debug2.default)(APP_NAME + ':' + prefix);\n\t\t\tthis._warn = (0, _debug2.default)(APP_NAME + ':WARN:' + prefix);\n\t\t\tthis._error = (0, _debug2.default)(APP_NAME + ':ERROR:' + prefix);\n\t\t} else {\n\t\t\tthis._prefix = '' + APP_NAME;\n\t\t\tthis._debug = (0, _debug2.default)(APP_NAME);\n\t\t\tthis._warn = (0, _debug2.default)(APP_NAME + ':WARN');\n\t\t\tthis._error = (0, _debug2.default)(APP_NAME + ':ERROR');\n\t\t}\n\n\t\t/* eslint-disable no-console */\n\t\t// this._debug.log = console.info.bind(console);\n\t\t// this._warn.log = console.warn.bind(console);\n\t\t// this._error.log = console.error.bind(console);\n\t\tthis._debug = this._log_debug.bind(this);\n\t\tthis._warn = this._log_warn.bind(this);\n\t\tthis._error = this._log_error.bind(this);\n\t\t/* eslint-enable no-console */\n\t}\n\n\t(0, _createClass3.default)(Logger, [{\n\t\tkey: 'setLoggerLevel',\n\t\tvalue: function setLoggerLevel(level) {\n\t\t\tLogger.logLevel = level;\n\t\t}\n\t}, {\n\t\tkey: '_log_debug',\n\t\tvalue: function _log_debug() {\n\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\targs[_key] = arguments[_key];\n\t\t\t}\n\n\t\t\tif (Logger.logLevel <= clogLevel.LOG_INFO) {\n\t\t\t\tvar msg = '[' + this._prefix + ']';\n\n\t\t\t\t[].slice.apply(args).forEach(function (element) {\n\t\t\t\t\tif ((typeof element === 'undefined' ? 'undefined' : (0, _typeof3.default)(element)) === 'object') msg += ' ' + (0, _stringify2.default)(element);else msg += ' ' + element;\n\t\t\t\t});\n\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.log(msg);\n\t\t\t}\n\t\t\tthis._log.apply(this, args);\n\t\t}\n\t}, {\n\t\tkey: '_log_error',\n\t\tvalue: function _log_error() {\n\t\t\tfor (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\t\targs[_key2] = arguments[_key2];\n\t\t\t}\n\n\t\t\tif (Logger.logLevel <= clogLevel.LOG_ERROR) {\n\t\t\t\t// let msg = `${new Date()} -- [${this._prefix}]`;\n\t\t\t\tvar msg = '[' + this._prefix + ']';\n\n\t\t\t\t[].slice.apply(args).forEach(function (element) {\n\t\t\t\t\tif ((typeof element === 'undefined' ? 'undefined' : (0, _typeof3.default)(element)) === 'object') msg += ' ' + (0, _stringify2.default)(element);else msg += ' ' + element;\n\t\t\t\t});\n\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error(msg);\n\t\t\t}\n\n\t\t\tthis._log.apply(this, args);\n\t\t}\n\t}, {\n\t\tkey: '_log_warn',\n\t\tvalue: function _log_warn() {\n\t\t\tfor (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n\t\t\t\targs[_key3] = arguments[_key3];\n\t\t\t}\n\n\t\t\tif (Logger.logLevel <= clogLevel.LOG_WARN) {\n\t\t\t\t// let msg = `${new Date()} -- [${this._prefix}]`;\n\t\t\t\tvar msg = '[' + this._prefix + ']';\n\n\t\t\t\t[].slice.apply(args).forEach(function (element) {\n\t\t\t\t\tif ((typeof element === 'undefined' ? 'undefined' : (0, _typeof3.default)(element)) === 'object') msg += ' ' + (0, _stringify2.default)(element);else msg += ' ' + element;\n\t\t\t\t});\n\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn(msg);\n\t\t\t}\n\n\t\t\tthis._log.apply(this, args);\n\t\t}\n\t}, {\n\t\tkey: '_log',\n\t\tvalue: function _log() {\n\t\t\tif (!Logger.logSubmit) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tvar dev = this._isMobile ? 'web_mobile' : 'web';\n\t\t\tvar msg = 'appid=' + global.g_appid + ', roomid=' + global.g_roomid + ', userid=' + global.g_userid + ' server=' + global.g_server + ' dev=' + dev + ' ua=' + this._userAgent + ' time=' + new Date();\n\n\t\t\tfor (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n\t\t\t\targs[_key4] = arguments[_key4];\n\t\t\t}\n\n\t\t\t[].slice.apply(args).forEach(function (element) {\n\t\t\t\tif ((typeof element === 'undefined' ? 'undefined' : (0, _typeof3.default)(element)) === 'object') msg += ' ' + (0, _stringify2.default)(element);else msg += ' ' + element;\n\t\t\t});\n\n\t\t\tfetch(config.logserver_url /*'https://log.wushuangtech.com:15100'*/\n\t\t\t, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tmode: \"cors\",\n\t\t\t\tcache: \"no-cache\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"text/plain; charset=utf-8\"\n\t\t\t\t\t// \"Content-Type\": \"application/json; charset=utf-8\",\n\t\t\t\t},\n\t\t\t\tredirect: \"follow\",\n\t\t\t\treferrer: \"no-referrer\",\n\t\t\t\tbody: 'event=' + this._prefix + ' ' + msg\n\t\t\t})\n\t\t\t// eslint-disable-next-line no-console\n\t\t\t.catch(function (error) {\n\t\t\t\treturn console.warn('Error:', error);\n\t\t\t}).then(function (response) {\n\t\t\t\treturn (0, _stringify2.default)(response);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'debug',\n\t\tget: function get() {\n\t\t\treturn this._debug;\n\t\t}\n\t}, {\n\t\tkey: 'warn',\n\t\tget: function get() {\n\t\t\treturn this._warn;\n\t\t}\n\t}, {\n\t\tkey: 'error',\n\t\tget: function get() {\n\t\t\treturn this._error;\n\t\t}\n\t}], [{\n\t\tkey: 'privateCloud',\n\t\tget: function get() {\n\t\t\treturn PRIVATE_CLOUD;\n\t\t},\n\t\tset: function set(isPrivate) {\n\t\t\tPRIVATE_CLOUD = Boolean(isPrivate);\n\t\t}\n\t}, {\n\t\tkey: 'logSubmit',\n\t\tget: function get() {\n\t\t\treturn LOG_SUBMIT_ON;\n\t\t},\n\t\tset: function set(enable) {\n\t\t\tLOG_SUBMIT_ON = Boolean(enable);\n\t\t}\n\t}, {\n\t\tkey: 'logLevel',\n\t\tget: function get() {\n\t\t\treturn LOG_LEVEL;\n\t\t},\n\t\tset: function set(value) {\n\t\t\tswitch (value) {\n\t\t\t\tcase 'LOG_NONE':\n\t\t\t\t\tLOG_LEVEL = clogLevel.LOG_NONE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'LOG_ERROR':\n\t\t\t\t\tLOG_LEVEL = clogLevel.LOG_ERROR;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'LOG_WARN':\n\t\t\t\t\tLOG_LEVEL = clogLevel.LOG_WARN;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'LOG_INFO':\n\t\t\t\t\tLOG_LEVEL = clogLevel.LOG_INFO;\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'LOG_DEBUG':\n\t\t\t\t\tLOG_LEVEL = clogLevel.LOG_DEBUG;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'LOG_TRACE':\n\t\t\t\t\tLOG_LEVEL = clogLevel.LOG_TRACE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow TypeError('parameter error. must be: LOG_NONE, LOG_ERROR, LOG_WARN, LOG_INFO, LOG_DEBUG, LOG_TRACE');\n\t\t\t}\n\t\t}\n\t}]);\n\treturn Logger;\n}();\n\nexports.default = Logger;\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/_webpack@4.41.6@webpack/buildin/global.js */ \"./node_modules/_webpack@4.41.6@webpack/buildin/global.js\")))\n\n/***/ }),\n\n/***/ \"./lib/mslib/CommandQueue.js\":\n/*!***********************************!*\\\n  !*** ./lib/mslib/CommandQueue.js ***!\n  \\***********************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/assign.js\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _events = __webpack_require__(/*! events */ \"./node_modules/_events@3.1.0@events/events.js\");\n\nvar _Logger = __webpack_require__(/*! ./Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _errors = __webpack_require__(/*! ./errors */ \"./lib/mslib/errors.js\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('<CommandQueue>');\n\nvar CommandQueue = function (_EventEmitter) {\n\t(0, _inherits3.default)(CommandQueue, _EventEmitter);\n\n\tfunction CommandQueue() {\n\t\t(0, _classCallCheck3.default)(this, CommandQueue);\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (CommandQueue.__proto__ || (0, _getPrototypeOf2.default)(CommandQueue)).call(this));\n\n\t\t_this.setMaxListeners(Infinity);\n\n\t\t// Closed flag.\n\t\t// @type {Boolean}\n\t\t_this._closed = false;\n\n\t\t// Busy running a command.\n\t\t// @type {Boolean}\n\t\t_this._busy = false;\n\n\t\t// Queue for pending commands. Each command is an Object with method,\n\t\t// resolve, reject, and other members (depending the case).\n\t\t// @type {Array<Object>}\n\t\t_this._queue = [];\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(CommandQueue, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tthis._closed = true;\n\t\t}\n\t}, {\n\t\tkey: 'push',\n\t\tvalue: function push(method, data) {\n\t\t\tvar _this2 = this;\n\n\t\t\tvar command = (0, _assign2.default)({ method: method }, data);\n\n\t\t\tlogger.debug('push() [method:%s]', method);\n\n\t\t\treturn new _promise2.default(function (resolve, reject) {\n\t\t\t\tvar queue = _this2._queue;\n\n\t\t\t\tcommand.resolve = resolve;\n\t\t\t\tcommand.reject = reject;\n\n\t\t\t\t// Append command to the queue.\n\t\t\t\tqueue.push(command);\n\t\t\t\t_this2._handlePendingCommands();\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_handlePendingCommands',\n\t\tvalue: function _handlePendingCommands() {\n\t\t\tvar _this3 = this;\n\n\t\t\tif (this._busy) return;\n\n\t\t\tvar queue = this._queue;\n\n\t\t\t// Take the first command.\n\t\t\tvar command = queue[0];\n\n\t\t\tif (!command) return;\n\n\t\t\tthis._busy = true;\n\n\t\t\t// Execute it.\n\t\t\tthis._handleCommand(command).then(function () {\n\t\t\t\t_this3._busy = false;\n\n\t\t\t\t// Remove the first command (the completed one) from the queue.\n\t\t\t\tqueue.shift();\n\n\t\t\t\t// And continue.\n\t\t\t\t_this3._handlePendingCommands();\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_handleCommand',\n\t\tvalue: function _handleCommand(command) {\n\t\t\tvar _this4 = this;\n\n\t\t\tlogger.debug('_handleCommand() [method:%s]', command.method);\n\n\t\t\tif (this._closed) {\n\t\t\t\tcommand.reject(new _errors.InvalidStateError('closed'));\n\n\t\t\t\treturn _promise2.default.resolve();\n\t\t\t}\n\n\t\t\tvar promiseHolder = { promise: null };\n\n\t\t\tthis.emit('exec', command, promiseHolder);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn promiseHolder.promise;\n\t\t\t}).then(function (result) {\n\t\t\t\tlogger.debug('_handleCommand() | command succeeded [method:%s]', command.method);\n\n\t\t\t\tif (_this4._closed) {\n\t\t\t\t\tcommand.reject(new _errors.InvalidStateError('closed'));\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Resolve the command with the given result (if any).\n\t\t\t\tcommand.resolve(result);\n\t\t\t}).catch(function (error) {\n\t\t\t\tlogger.error('_handleCommand() | command failed [method:%s]: %o', command.method, error);\n\n\t\t\t\t// Reject the command with the error.\n\t\t\t\tcommand.reject(error);\n\t\t\t});\n\t\t}\n\t}]);\n\treturn CommandQueue;\n}(_events.EventEmitter);\n\nexports.default = CommandQueue;\n\n/***/ }),\n\n/***/ \"./lib/mslib/Consumer.js\":\n/*!*******************************!*\\\n  !*** ./lib/mslib/Consumer.js ***!\n  \\*******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _Logger = __webpack_require__(/*! ./Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ./EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _errors = __webpack_require__(/*! ./errors */ \"./lib/mslib/errors.js\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar PROFILES = new _set2.default(['default', 'low', 'medium', 'high']);\nvar DEFAULT_STATS_INTERVAL = 1000;\n\nvar logger = new _Logger2.default('Consumer');\n\nvar Consumer = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Consumer, _EnhancedEventEmitter);\n\n\t/**\n  * @private\n  *\n  * @emits {originator: String, [appData]: Any} pause\n  * @emits {originator: String, [appData]: Any} resume\n  * @emits {profile: String} effectiveprofilechange\n  * @emits {stats: Object} stats\n  * @emits handled\n  * @emits unhandled\n  * @emits {originator: String} close\n  *\n  * @emits @close\n  */\n\tfunction Consumer(id, kind, rtpParameters, peer, appData) {\n\t\t(0, _classCallCheck3.default)(this, Consumer);\n\n\t\t// Id.\n\t\t// @type {Number}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Consumer.__proto__ || (0, _getPrototypeOf2.default)(Consumer)).call(this, logger));\n\n\t\t_this._id = id;\n\n\t\t// Closed flag.\n\t\t// @type {Boolean}\n\t\t_this._closed = false;\n\n\t\t// Media kind.\n\t\t// @type {String}\n\t\t_this._kind = kind;\n\n\t\t// RTP parameters.\n\t\t// @type {RTCRtpParameters}\n\t\t_this._rtpParameters = rtpParameters;\n\n\t\t// Associated Peer.\n\t\t// @type {Peer}\n\t\t_this._peer = peer;\n\n\t\t// App custom data.\n\t\t// @type {Any}\n\t\t_this._appData = appData;\n\n\t\t// Whether we can receive this Consumer (based on our RTP capabilities).\n\t\t// @type {Boolean}\n\t\t_this._supported = false;\n\n\t\t// Associated Transport.\n\t\t// @type {Transport}\n\t\t_this._transport = null;\n\n\t\t// Remote track.\n\t\t// @type {MediaStreamTrack}\n\t\t_this._track = null;\n\n\t\t// Locally paused flag.\n\t\t// @type {Boolean}\n\t\t_this._locallyPaused = false;\n\n\t\t// Remotely paused flag.\n\t\t// @type {Boolean}\n\t\t_this._remotelyPaused = false;\n\n\t\t// Periodic stats flag.\n\t\t// @type {Boolean}\n\t\t_this._statsEnabled = false;\n\n\t\t// Periodic stats gathering interval (milliseconds).\n\t\t// @type {Number}\n\t\t_this._statsInterval = DEFAULT_STATS_INTERVAL;\n\n\t\t// Preferred profile.\n\t\t// @type {String}\n\t\t_this._preferredProfile = 'default';\n\n\t\t// Effective profile.\n\t\t// @type {String}\n\t\t_this._effectiveProfile = null;\n\t\treturn _this;\n\t}\n\n\t/**\n  * Consumer id.\n  *\n  * @return {Number}\n  */\n\n\n\t(0, _createClass3.default)(Consumer, [{\n\t\tkey: 'close',\n\n\n\t\t/**\n   * Closes the Consumer.\n   * This is called when the local Room is closed.\n   *\n   * @private\n   */\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._closed = true;\n\n\t\t\tif (this._statsEnabled) {\n\t\t\t\tthis._statsEnabled = false;\n\n\t\t\t\tif (this.transport) this.transport.disableConsumerStats(this);\n\t\t\t}\n\n\t\t\tthis.emit('@close');\n\t\t\tthis.safeEmit('close', 'local');\n\n\t\t\tthis._destroy();\n\t\t}\n\n\t\t/**\n   * My remote Consumer was closed.\n   * Invoked via remote notification.\n   *\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'remoteClose',\n\t\tvalue: function remoteClose() {\n\t\t\tlogger.debug('remoteClose()');\n\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._closed = true;\n\n\t\t\tif (this._transport) this._transport.removeConsumer(this);\n\n\t\t\tthis._destroy();\n\n\t\t\tthis.emit('@close');\n\t\t\tthis.safeEmit('close', 'remote');\n\t\t}\n\t}, {\n\t\tkey: '_destroy',\n\t\tvalue: function _destroy() {\n\t\t\tthis._transport = null;\n\n\t\t\ttry {\n\t\t\t\tthis._track.stop();\n\t\t\t} catch (error) {}\n\n\t\t\tthis._track = null;\n\t\t}\n\n\t\t/**\n   * Receives RTP.\n   *\n   * @param {transport} Transport instance.\n   *\n   * @return {Promise} Resolves with a remote MediaStreamTrack.\n   */\n\n\t}, {\n\t\tkey: 'receive',\n\t\tvalue: function receive(transport) {\n\t\t\tvar _this2 = this;\n\n\t\t\tlogger.debug('receive() [transport:%o]', transport);\n\n\t\t\tif (this._closed) return _promise2.default.reject(new _errors.InvalidStateError('Consumer closed'));else if (!this._supported) return _promise2.default.reject(new Error('unsupported codecs'));else if (this._transport) return _promise2.default.reject(new Error('already handled by a Transport'));else if ((typeof transport === 'undefined' ? 'undefined' : (0, _typeof3.default)(transport)) !== 'object') return _promise2.default.reject(new TypeError('invalid Transport'));\n\n\t\t\tthis._transport = transport;\n\n\t\t\treturn transport.addConsumer(this).then(function (track) {\n\t\t\t\t_this2._track = track;\n\n\t\t\t\t// If we were paused, disable the track.\n\t\t\t\tif (_this2.paused) track.enabled = false;\n\n\t\t\t\ttransport.once('@close', function () {\n\t\t\t\t\tif (_this2._closed || _this2._transport !== transport) return;\n\n\t\t\t\t\t_this2._transport = null;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t_this2._track.stop();\n\t\t\t\t\t} catch (error) {}\n\n\t\t\t\t\t_this2._track = null;\n\n\t\t\t\t\t_this2.safeEmit('unhandled');\n\t\t\t\t});\n\n\t\t\t\t_this2.safeEmit('handled');\n\n\t\t\t\tif (_this2._statsEnabled) transport.enableConsumerStats(_this2, _this2._statsInterval);\n\n\t\t\t\treturn track;\n\t\t\t}).catch(function (error) {\n\t\t\t\t_this2._transport = null;\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Pauses receiving media.\n   *\n   * @param {Any} [appData] - App custom data.\n   *\n   * @return {Boolean} true if paused.\n   */\n\n\t}, {\n\t\tkey: 'pause',\n\t\tvalue: function pause(appData) {\n\t\t\tlogger.debug('pause()');\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.warn('pause() | Consumer closed');\n\n\t\t\t\treturn false;\n\t\t\t} else if (this._locallyPaused) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis._locallyPaused = true;\n\n\t\t\tif (this._track) this._track.enabled = false;\n\n\t\t\tif (this._transport) this._transport.pauseConsumer(this, appData);\n\n\t\t\tthis.safeEmit('pause', 'local', appData);\n\n\t\t\t// Return true if really paused.\n\t\t\treturn this.paused;\n\t\t}\n\n\t\t/**\n   * My remote Consumer was paused.\n   * Invoked via remote notification.\n   *\n   * @private\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\n\t}, {\n\t\tkey: 'remotePause',\n\t\tvalue: function remotePause(appData) {\n\t\t\tlogger.debug('remotePause()');\n\n\t\t\tif (this._closed || this._remotelyPaused) return;\n\n\t\t\tthis._remotelyPaused = true;\n\n\t\t\tif (this._track) this._track.enabled = false;\n\n\t\t\tthis.safeEmit('pause', 'remote', appData);\n\t\t}\n\n\t\t/**\n   * Resumes receiving media.\n   *\n   * @param {Any} [appData] - App custom data.\n   *\n   * @return {Boolean} true if not paused.\n   */\n\n\t}, {\n\t\tkey: 'resume',\n\t\tvalue: function resume(appData) {\n\t\t\tlogger.debug('resume()');\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.warn('resume() | Consumer closed');\n\n\t\t\t\treturn false;\n\t\t\t} else if (!this._locallyPaused) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis._locallyPaused = false;\n\n\t\t\tif (this._track && !this._remotelyPaused) this._track.enabled = true;\n\n\t\t\tif (this._transport) this._transport.resumeConsumer(this, appData);\n\n\t\t\tthis.safeEmit('resume', 'local', appData);\n\n\t\t\t// Return true if not paused.\n\t\t\treturn !this.paused;\n\t\t}\n\n\t\t/**\n   * My remote Consumer was resumed.\n   * Invoked via remote notification.\n   *\n   * @private\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\n\t}, {\n\t\tkey: 'remoteResume',\n\t\tvalue: function remoteResume(appData) {\n\t\t\tlogger.debug('remoteResume()');\n\n\t\t\tif (this._closed || !this._remotelyPaused) return;\n\n\t\t\tthis._remotelyPaused = false;\n\n\t\t\tif (this._track && !this._locallyPaused) this._track.enabled = true;\n\n\t\t\tthis.safeEmit('resume', 'remote', appData);\n\t\t}\n\n\t\t/**\n   * Set preferred receiving profile.\n   *\n   * @param {String} profile\n   */\n\n\t}, {\n\t\tkey: 'setPreferredProfile',\n\t\tvalue: function setPreferredProfile(profile) {\n\t\t\tlogger.debug('setPreferredProfile() [profile:%s]', profile);\n\n\t\t\tif (this._closed) {\n\t\t\t\tlogger.warn('setPreferredProfile() | Consumer closed');\n\n\t\t\t\treturn;\n\t\t\t} else if (profile === this._preferredProfile) {\n\t\t\t\treturn;\n\t\t\t} else if (!PROFILES.has(profile)) {\n\t\t\t\tlogger.error('setPreferredProfile() | invalid profile \"%s\"', profile);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._preferredProfile = profile;\n\n\t\t\tif (this._transport) this._transport.setConsumerPreferredProfile(this, this._preferredProfile);\n\t\t}\n\n\t\t/**\n   * Preferred receiving profile was set on my remote Consumer.\n   *\n   * @param {String} profile\n   */\n\n\t}, {\n\t\tkey: 'remoteSetPreferredProfile',\n\t\tvalue: function remoteSetPreferredProfile(profile) {\n\t\t\tlogger.debug('remoteSetPreferredProfile() [profile:%s]', profile);\n\n\t\t\tif (this._closed || profile === this._preferredProfile) return;\n\n\t\t\tthis._preferredProfile = profile;\n\t\t}\n\n\t\t/**\n   * Effective receiving profile changed on my remote Consumer.\n   *\n   * @param {String} profile\n   */\n\n\t}, {\n\t\tkey: 'remoteEffectiveProfileChanged',\n\t\tvalue: function remoteEffectiveProfileChanged(profile) {\n\t\t\tlogger.debug('remoteEffectiveProfileChanged() [profile:%s]', profile);\n\n\t\t\tif (this._closed || profile === this._effectiveProfile) return;\n\n\t\t\tthis._effectiveProfile = profile;\n\n\t\t\tthis.safeEmit('effectiveprofilechange', this._effectiveProfile);\n\t\t}\n\n\t\t/**\n   * Enables periodic stats retrieval.\n   */\n\n\t}, {\n\t\tkey: 'enableStats',\n\t\tvalue: function enableStats() {\n\t\t\tvar interval = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_STATS_INTERVAL;\n\n\t\t\tlogger.debug('enableStats() [interval:%s]', interval);\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.warn('enableStats() | Consumer closed');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._statsEnabled) return;\n\n\t\t\tif (typeof interval !== 'number' || interval < 1000) this._statsInterval = DEFAULT_STATS_INTERVAL;else this._statsInterval = interval;\n\n\t\t\tthis._statsEnabled = true;\n\n\t\t\tif (this._transport) this._transport.enableConsumerStats(this, this._statsInterval);\n\t\t}\n\n\t\t/**\n   * Disables periodic stats retrieval.\n   */\n\n\t}, {\n\t\tkey: 'disableStats',\n\t\tvalue: function disableStats() {\n\t\t\t// logger.debug('disableStats()');\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.error('disableStats() | Consumer closed');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._statsEnabled) return;\n\n\t\t\tthis._statsEnabled = false;\n\n\t\t\tif (this._transport) this._transport.disableConsumerStats(this);\n\t\t}\n\n\t\t/**\n   * Mark this Consumer as suitable for reception or not.\n   *\n   * @private\n   *\n   * @param {Boolean} flag\n   */\n\n\t}, {\n\t\tkey: 'setSupported',\n\t\tvalue: function setSupported(flag) {\n\t\t\tthis._supported = flag;\n\t\t}\n\n\t\t/**\n   * Receive remote stats.\n   *\n   * @private\n   *\n   * @param {Object} stats\n   */\n\n\t}, {\n\t\tkey: 'remoteStats',\n\t\tvalue: function remoteStats(stats) {\n\t\t\tthis.safeEmit('stats', stats);\n\t\t}\n\n\t\t/**\n   * Get consumer stats.\n   *\n   * @private\n   *\n   * @param {Object} selector\n   */\n\n\t}, {\n\t\tkey: 'getStats',\n\t\tvalue: function getStats(selector) {\n\t\t\treturn this.transport.getStats(selector);\n\t\t}\n\n\t\t/**\n   * Enable internal statistics.\n   * @param {number} interval \n   */\n\n\t}, {\n\t\tkey: 'enableInternalStats',\n\t\tvalue: function enableInternalStats(interval) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar in_interval = interval > 0 && interval !== undefined ? interval : DEFAULT_STATS_INTERVAL;\n\t\t\t// logger.debug('enableInternalStats() [interval:%s]', in_interval);\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.error('enableInternalStats() | Producer closed');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._internalStatsEnabled) return;\n\t\t\tif (typeof in_interval !== 'number' || in_interval < 1000) this._interanlStatsInterval = DEFAULT_STATS_INTERVAL;else this._interanlStatsInterval = in_interval;\n\n\t\t\tthis._internalStatsEnabled = true;\n\t\t\tif (this._transport) {\n\t\t\t\tthis._internalTimer = setInterval(function () {\n\t\t\t\t\treturn _this3.getStats().then(function (s) {\n\t\t\t\t\t\t_this3.emit('internalStats', s);\n\t\t\t\t\t});\n\t\t\t\t}, in_interval);\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Disable internal statistics.\n   */\n\n\t}, {\n\t\tkey: 'disableInternalStats',\n\t\tvalue: function disableInternalStats() {\n\t\t\tif (this._internalStatsEnabled) {\n\t\t\t\tclearInterval(this._internalTimer);\n\t\t\t}\n\n\t\t\tthis._internalTimer = null;\n\t\t\tthis._internalStatsEnabled = false;\n\t\t}\n\t}, {\n\t\tkey: 'id',\n\t\tget: function get() {\n\t\t\treturn this._id;\n\t\t}\n\n\t\t/**\n   * Whether the Consumer is closed.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'closed',\n\t\tget: function get() {\n\t\t\treturn this._closed;\n\t\t}\n\n\t\t/**\n   * Media kind.\n   *\n   * @return {String}\n   */\n\n\t}, {\n\t\tkey: 'kind',\n\t\tget: function get() {\n\t\t\treturn this._kind;\n\t\t}\n\n\t\t/**\n   * RTP parameters.\n   *\n   * @return {RTCRtpParameters}\n   */\n\n\t}, {\n\t\tkey: 'rtpParameters',\n\t\tget: function get() {\n\t\t\treturn this._rtpParameters;\n\t\t}\n\n\t\t/**\n   * Associated Peer.\n   *\n   * @return {Peer}\n   */\n\n\t}, {\n\t\tkey: 'peer',\n\t\tget: function get() {\n\t\t\treturn this._peer;\n\t\t}\n\n\t\t/**\n   * App custom data.\n   *\n   * @return {Any}\n   */\n\n\t}, {\n\t\tkey: 'appData',\n\t\tget: function get() {\n\t\t\treturn this._appData;\n\t\t}\n\n\t\t/**\n   * Whether we can receive this Consumer (based on our RTP capabilities).\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'supported',\n\t\tget: function get() {\n\t\t\treturn this._supported;\n\t\t}\n\n\t\t/**\n   * Associated Transport.\n   *\n   * @return {Transport}\n   */\n\n\t}, {\n\t\tkey: 'transport',\n\t\tget: function get() {\n\t\t\treturn this._transport;\n\t\t}\n\n\t\t/**\n   * The associated track (if any yet).\n   *\n   * @return {MediaStreamTrack|null}\n   */\n\n\t}, {\n\t\tkey: 'track',\n\t\tget: function get() {\n\t\t\treturn this._track;\n\t\t}\n\n\t\t/**\n   * Whether the Consumer is locally paused.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'locallyPaused',\n\t\tget: function get() {\n\t\t\treturn this._locallyPaused;\n\t\t}\n\n\t\t/**\n   * Whether the Consumer is remotely paused.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'remotelyPaused',\n\t\tget: function get() {\n\t\t\treturn this._remotelyPaused;\n\t\t}\n\n\t\t/**\n   * Whether the Consumer is paused.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'paused',\n\t\tget: function get() {\n\t\t\treturn this._locallyPaused || this._remotelyPaused;\n\t\t}\n\n\t\t/**\n   * The preferred profile.\n   *\n   * @type {String}\n   */\n\n\t}, {\n\t\tkey: 'preferredProfile',\n\t\tget: function get() {\n\t\t\treturn this._preferredProfile;\n\t\t}\n\n\t\t/**\n   * The effective profile.\n   *\n   * @type {String}\n   */\n\n\t}, {\n\t\tkey: 'effectiveProfile',\n\t\tget: function get() {\n\t\t\treturn this._effectiveProfile;\n\t\t}\n\t}]);\n\treturn Consumer;\n}(_EnhancedEventEmitter3.default);\n\nexports.default = Consumer;\n\n/***/ }),\n\n/***/ \"./lib/mslib/Device.js\":\n/*!*****************************!*\\\n  !*** ./lib/mslib/Device.js ***!\n  \\*****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _bowser = __webpack_require__(/*! bowser */ \"./node_modules/_bowser@1.9.4@bowser/src/bowser.js\");\n\nvar _bowser2 = _interopRequireDefault(_bowser);\n\nvar _Logger = __webpack_require__(/*! ./Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _Chrome = __webpack_require__(/*! ./handlers/Chrome70 */ \"./lib/mslib/handlers/Chrome70.js\");\n\nvar _Chrome2 = _interopRequireDefault(_Chrome);\n\nvar _Chrome3 = __webpack_require__(/*! ./handlers/Chrome69 */ \"./lib/mslib/handlers/Chrome69.js\");\n\nvar _Chrome4 = _interopRequireDefault(_Chrome3);\n\nvar _Chrome5 = __webpack_require__(/*! ./handlers/Chrome67 */ \"./lib/mslib/handlers/Chrome67.js\");\n\nvar _Chrome6 = _interopRequireDefault(_Chrome5);\n\nvar _Chrome7 = __webpack_require__(/*! ./handlers/Chrome55 */ \"./lib/mslib/handlers/Chrome55.js\");\n\nvar _Chrome8 = _interopRequireDefault(_Chrome7);\n\nvar _Safari = __webpack_require__(/*! ./handlers/Safari13 */ \"./lib/mslib/handlers/Safari13.js\");\n\nvar _Safari2 = _interopRequireDefault(_Safari);\n\nvar _Safari3 = __webpack_require__(/*! ./handlers/Safari12 */ \"./lib/mslib/handlers/Safari12.js\");\n\nvar _Safari4 = _interopRequireDefault(_Safari3);\n\nvar _Safari5 = __webpack_require__(/*! ./handlers/Safari11 */ \"./lib/mslib/handlers/Safari11.js\");\n\nvar _Safari6 = _interopRequireDefault(_Safari5);\n\nvar _Firefox = __webpack_require__(/*! ./handlers/Firefox65 */ \"./lib/mslib/handlers/Firefox65.js\");\n\nvar _Firefox2 = _interopRequireDefault(_Firefox);\n\nvar _Firefox3 = __webpack_require__(/*! ./handlers/Firefox59 */ \"./lib/mslib/handlers/Firefox59.js\");\n\nvar _Firefox4 = _interopRequireDefault(_Firefox3);\n\nvar _Firefox5 = __webpack_require__(/*! ./handlers/Firefox50 */ \"./lib/mslib/handlers/Firefox50.js\");\n\nvar _Firefox6 = _interopRequireDefault(_Firefox5);\n\nvar _Edge = __webpack_require__(/*! ./handlers/Edge11 */ \"./lib/mslib/handlers/Edge11.js\");\n\nvar _Edge2 = _interopRequireDefault(_Edge);\n\nvar _ReactNative = __webpack_require__(/*! ./handlers/ReactNative */ \"./lib/mslib/handlers/ReactNative.js\");\n\nvar _ReactNative2 = _interopRequireDefault(_ReactNative);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Device');\n\n/**\n * Class with static members representing the underlying device or browser.\n */\n\nvar Device = function () {\n\tfunction Device() {\n\t\t(0, _classCallCheck3.default)(this, Device);\n\t}\n\n\t(0, _createClass3.default)(Device, null, [{\n\t\tkey: 'setHandler',\n\n\t\t/**\n   * Provides a custom RTC handler class and avoid auto-detection. Useful\n   * for making mediasoup-client work with custom devices.\n   *\n   * NOTE: This function must be called upon library load.\n   *\n   * @param {Class} handler - A handler class.\n   * @param {Object} [metadata] - Handler metadata.\n   * @param {String} [metadata.flag] - Handler flag.\n   * @param {String} [metadata.name] - Handler name.\n   * @param {String} [metadata.version] - Handler version.\n   * @param {Object} [metadata.bowser] - Handler bowser Object.\n   */\n\t\tvalue: function setHandler(handler) {\n\t\t\tvar metadata = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\t\t\tDevice._detected = true;\n\n\t\t\tDevice._handlerClass = handler;\n\n\t\t\t// Optional fields.\n\t\t\tDevice._flag = metadata.flag;\n\t\t\tDevice._name = metadata.name;\n\t\t\tDevice._version = metadata.version;\n\t\t\tDevice._bowser = metadata.bowser || {};\n\t\t}\n\n\t\t/**\n   * Get the device flag.\n   *\n   * @return {String}\n   */\n\n\t}, {\n\t\tkey: 'getFlag',\n\t\tvalue: function getFlag() {\n\t\t\tif (!Device._detected) Device._detect();\n\n\t\t\treturn Device._flag;\n\t\t}\n\n\t\t/**\n   * Get the device name.\n   *\n   * @return {String}\n   */\n\n\t}, {\n\t\tkey: 'getName',\n\t\tvalue: function getName() {\n\t\t\tif (!Device._detected) Device._detect();\n\n\t\t\treturn Device._name;\n\t\t}\n\n\t\t/**\n   * Get the device version.\n   *\n   * @return {String}\n   */\n\n\t}, {\n\t\tkey: 'getVersion',\n\t\tvalue: function getVersion() {\n\t\t\tif (!Device._detected) Device._detect();\n\n\t\t\treturn Device._version;\n\t\t}\n\n\t\t/**\n   * Get the bowser module Object.\n   *\n   * @return {Object}\n   */\n\n\t}, {\n\t\tkey: 'getBowser',\n\t\tvalue: function getBowser() {\n\t\t\tif (!Device._detected) Device._detect();\n\n\t\t\treturn Device._bowser;\n\t\t}\n\n\t\t/**\n   * Whether this device is supported.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'isSupported',\n\t\tvalue: function isSupported() {\n\t\t\tif (!Device._detected) Device._detect();\n\n\t\t\treturn Boolean(Device._handlerClass);\n\t\t}\n\n\t\t/**\n   * Returns a suitable WebRTC handler class.\n   *\n   * @type {Class}\n   */\n\n\t}, {\n\t\tkey: '_detect',\n\n\n\t\t/**\n   * Detects the current device/browser.\n   *\n   * @private\n   */\n\t\tvalue: function _detect() {\n\t\t\tDevice._detected = true;\n\n\t\t\t// If this is React-Native manually fill data.\n\t\t\tif (global.navigator && global.navigator.product === 'ReactNative') {\n\t\t\t\tDevice._flag = 'react-native';\n\t\t\t\tDevice._name = 'ReactNative';\n\t\t\t\tDevice._version = undefined; // NOTE: No idea how to know it.\n\t\t\t\tDevice._bowser = {};\n\t\t\t\tDevice._handlerClass = _ReactNative2.default;\n\t\t\t}\n\t\t\t// If this is a browser use bowser module detection.\n\t\t\telse if (global.navigator && typeof global.navigator.userAgent === 'string') {\n\t\t\t\t\tvar ua = global.navigator.userAgent;\n\t\t\t\t\tvar browser = _bowser2.default.detect(ua);\n\n\t\t\t\t\tDevice._flag = undefined;\n\t\t\t\t\tDevice._name = browser.name || undefined;\n\t\t\t\t\tDevice._version = browser.version || undefined;\n\t\t\t\t\tDevice._bowser = browser;\n\t\t\t\t\tDevice._handlerClass = null;\n\n\t\t\t\t\t// Chrome, Chromium (desktop and mobile).\n\t\t\t\t\tif (_bowser2.default.check({ chrome: '70', chromium: '70' }, true, ua)) {\n\t\t\t\t\t\tDevice._flag = 'chrome';\n\t\t\t\t\t\tDevice._handlerClass = _Chrome2.default;\n\t\t\t\t\t} else if (_bowser2.default.check({ chrome: '69', chromium: '69' }, true, ua)) {\n\t\t\t\t\t\tDevice._flag = 'chrome';\n\t\t\t\t\t\tDevice._handlerClass = _Chrome4.default;\n\t\t\t\t\t} else if (_bowser2.default.check({ chrome: '67', chromium: '67' }, true, ua)) {\n\t\t\t\t\t\tDevice._flag = 'chrome';\n\t\t\t\t\t\tDevice._handlerClass = _Chrome6.default;\n\t\t\t\t\t} else if (_bowser2.default.check({ chrome: '55', chromium: '55' }, true, ua)) {\n\t\t\t\t\t\tDevice._flag = 'chrome';\n\t\t\t\t\t\tDevice._handlerClass = _Chrome8.default;\n\t\t\t\t\t}\n\t\t\t\t\t// Special case for old Chrome >= 49 if webrtc-adapter is present.\n\t\t\t\t\telse if (_bowser2.default.check({ chrome: '49', chromium: '49' }, true, ua) && global.adapter) {\n\t\t\t\t\t\t\tDevice._flag = 'chrome';\n\t\t\t\t\t\t\tDevice._handlerClass = _Chrome8.default;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Firefox (desktop and mobile).\n\t\t\t\t\t\telse if (_bowser2.default.check({ firefox: '65' }, true, ua)) {\n\t\t\t\t\t\t\t\tDevice._flag = 'firefox';\n\t\t\t\t\t\t\t\tDevice._handlerClass = _Firefox2.default;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Firefox (desktop and mobile).\n\t\t\t\t\t\t\telse if (_bowser2.default.check({ firefox: '59' }, true, ua)) {\n\t\t\t\t\t\t\t\t\tDevice._flag = 'firefox';\n\t\t\t\t\t\t\t\t\tDevice._handlerClass = _Firefox4.default;\n\t\t\t\t\t\t\t\t} else if (_bowser2.default.check({ firefox: '50' }, true, ua)) {\n\t\t\t\t\t\t\t\t\tDevice._flag = 'firefox';\n\t\t\t\t\t\t\t\t\tDevice._handlerClass = _Firefox6.default;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Safari (desktop and mobile).\n\t\t\t\t\t\t\t\telse if (_bowser2.default.check({ safari: '13' }, true, ua)) {\n\t\t\t\t\t\t\t\t\t\tDevice._flag = 'safari';\n\t\t\t\t\t\t\t\t\t\tDevice._handlerClass = _Safari2.default;\n\t\t\t\t\t\t\t\t\t} else if (_bowser2.default.check({ safari: '12.1' }, true, ua)) {\n\t\t\t\t\t\t\t\t\t\tDevice._flag = 'safari';\n\t\t\t\t\t\t\t\t\t\tDevice._handlerClass = _Safari4.default;\n\t\t\t\t\t\t\t\t\t} else if (_bowser2.default.check({ safari: '11' }, true, ua)) {\n\t\t\t\t\t\t\t\t\t\tDevice._flag = 'safari';\n\t\t\t\t\t\t\t\t\t\tDevice._handlerClass = _Safari6.default;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// Edge (desktop).\n\t\t\t\t\t\t\t\t\telse if (_bowser2.default.check({ msedge: '11' }, true, ua)) {\n\t\t\t\t\t\t\t\t\t\t\tDevice._flag = 'msedge';\n\t\t\t\t\t\t\t\t\t\t\tDevice._handlerClass = _Edge2.default;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t// Opera (desktop and mobile).\n\t\t\t\t\t\t\t\t\t\telse if (_bowser2.default.check({ opera: '57' }, true, ua)) {\n\t\t\t\t\t\t\t\t\t\t\t\tDevice._flag = 'opera';\n\t\t\t\t\t\t\t\t\t\t\t\tDevice._handlerClass = _Chrome2.default;\n\t\t\t\t\t\t\t\t\t\t\t} else if (_bowser2.default.check({ opera: '44' }, true, ua)) {\n\t\t\t\t\t\t\t\t\t\t\t\tDevice._flag = 'opera';\n\t\t\t\t\t\t\t\t\t\t\t\tDevice._handlerClass = _Chrome8.default;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t// Best effort for Chromium based browsers.\n\t\t\t\t\t\t\t\t\t\t\telse if (browser.chromium || browser.blink || browser.webkit) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('best effort Chrome based browser detection [name:\"%s\"]', browser.name);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tDevice._flag = 'chrome';\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar match = ua.match(/(?:(?:Chrome|Chromium))[ /](\\w+)/i);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (match) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar version = Number(match[1]);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (version >= 70) Device._handlerClass = _Chrome2.default;else if (version >= 69) Device._handlerClass = _Chrome4.default;else if (version >= 67) Device._handlerClass = _Chrome6.default;else Device._handlerClass = _Chrome8.default;\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDevice._handlerClass = _Chrome2.default;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\tif (Device.isSupported()) {\n\t\t\t\t\t\tlogger.debug('browser supported [flag:%s, name:\"%s\", version:%s, handler:%s]', Device._flag, Device._name, Device._version, Device._handlerClass.tag);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlogger.warn('browser not supported [name:%s, version:%s]', Device._name, Device._version);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Otherwise fail.\n\t\t\t\telse {\n\t\t\t\t\t\tlogger.warn('device not supported');\n\t\t\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'Handler',\n\t\tget: function get() {\n\t\t\tif (!Device._detected) Device._detect();\n\n\t\t\treturn Device._handlerClass;\n\t\t}\n\t}]);\n\treturn Device;\n}();\n\n// Initialized flag.\n// @type {Boolean}\n\n\nexports.default = Device;\nDevice._detected = false;\n\n// Device flag.\n// @type {String}\nDevice._flag = undefined;\n\n// Device name.\n// @type {String}\nDevice._name = undefined;\n\n// Device version.\n// @type {String}\nDevice._version = undefined;\n\n// bowser module Object.\n// @type {Object}\nDevice._bowser = undefined;\n\n// WebRTC hander for this device.\n// @type {Class}\nDevice._handlerClass = null;\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../node_modules/_webpack@4.41.6@webpack/buildin/global.js */ \"./node_modules/_webpack@4.41.6@webpack/buildin/global.js\")))\n\n/***/ }),\n\n/***/ \"./lib/mslib/EnhancedEventEmitter.js\":\n/*!*******************************************!*\\\n  !*** ./lib/mslib/EnhancedEventEmitter.js ***!\n  \\*******************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _events = __webpack_require__(/*! events */ \"./node_modules/_events@3.1.0@events/events.js\");\n\nvar _Logger = __webpack_require__(/*! ./Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar EnhancedEventEmitter = function (_EventEmitter) {\n\t(0, _inherits3.default)(EnhancedEventEmitter, _EventEmitter);\n\n\tfunction EnhancedEventEmitter(logger) {\n\t\t(0, _classCallCheck3.default)(this, EnhancedEventEmitter);\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (EnhancedEventEmitter.__proto__ || (0, _getPrototypeOf2.default)(EnhancedEventEmitter)).call(this));\n\n\t\t_this.setMaxListeners(Infinity);\n\n\t\t_this._logger = logger || new _Logger2.default('<EnhancedEventEmitter>');\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(EnhancedEventEmitter, [{\n\t\tkey: 'safeEmit',\n\t\tvalue: function safeEmit(event) {\n\t\t\ttry {\n\t\t\t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t\t\t\t\targs[_key - 1] = arguments[_key];\n\t\t\t\t}\n\n\t\t\t\tthis.emit.apply(this, [event].concat(args));\n\t\t\t} catch (error) {\n\t\t\t\tthis._logger.error('safeEmit() | event listener threw an error [event:%s]:%o', event, error);\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'safeEmitAsPromise',\n\t\tvalue: function safeEmitAsPromise(event) {\n\t\t\tvar _this2 = this;\n\n\t\t\tfor (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n\t\t\t\targs[_key2 - 1] = arguments[_key2];\n\t\t\t}\n\n\t\t\treturn new _promise2.default(function (resolve, reject) {\n\t\t\t\tvar callback = function callback(result) {\n\t\t\t\t\tresolve(result);\n\t\t\t\t};\n\n\t\t\t\tvar errback = function errback(error) {\n\t\t\t\t\t_this2._logger.error('safeEmitAsPromise() | errback called [event:%s]:%o', event, error);\n\n\t\t\t\t\treject(error);\n\t\t\t\t};\n\n\t\t\t\t_this2.safeEmit.apply(_this2, [event].concat(args, [callback, errback]));\n\t\t\t});\n\t\t}\n\t}]);\n\treturn EnhancedEventEmitter;\n}(_events.EventEmitter);\n\nexports.default = EnhancedEventEmitter;\n\n/***/ }),\n\n/***/ \"./lib/mslib/Logger.js\":\n/*!*****************************!*\\\n  !*** ./lib/mslib/Logger.js ***!\n  \\*****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _debug = __webpack_require__(/*! debug */ \"./node_modules/_debug@4.1.1@debug/src/browser.js\");\n\nvar _debug2 = _interopRequireDefault(_debug);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar APP_NAME = 'mediasoup-client';\n\nvar Logger = function () {\n\tfunction Logger(prefix) {\n\t\t(0, _classCallCheck3.default)(this, Logger);\n\n\t\tif (prefix) {\n\t\t\tthis._debug = (0, _debug2.default)(APP_NAME + ':' + prefix);\n\t\t\tthis._warn = (0, _debug2.default)(APP_NAME + ':WARN:' + prefix);\n\t\t\tthis._error = (0, _debug2.default)(APP_NAME + ':ERROR:' + prefix);\n\t\t} else {\n\t\t\tthis._debug = (0, _debug2.default)(APP_NAME);\n\t\t\tthis._warn = (0, _debug2.default)(APP_NAME + ':WARN');\n\t\t\tthis._error = (0, _debug2.default)(APP_NAME + ':ERROR');\n\t\t}\n\n\t\t/* eslint-disable no-console */\n\t\tthis._debug.log = console.info.bind(console);\n\t\tthis._warn.log = console.warn.bind(console);\n\t\tthis._error.log = console.error.bind(console);\n\t\t/* eslint-enable no-console */\n\t}\n\n\t(0, _createClass3.default)(Logger, [{\n\t\tkey: 'debug',\n\t\tget: function get() {\n\t\t\treturn this._debug;\n\t\t}\n\t}, {\n\t\tkey: 'warn',\n\t\tget: function get() {\n\t\t\treturn this._warn;\n\t\t}\n\t}, {\n\t\tkey: 'error',\n\t\tget: function get() {\n\t\t\treturn this._error;\n\t\t}\n\t}]);\n\treturn Logger;\n}();\n\nexports.default = Logger;\n\n/***/ }),\n\n/***/ \"./lib/mslib/Peer.js\":\n/*!***************************!*\\\n  !*** ./lib/mslib/Peer.js ***!\n  \\***************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _Logger = __webpack_require__(/*! ./Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ./EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('<Peer>');\n\nvar Peer = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Peer, _EnhancedEventEmitter);\n\n\t/**\n  * @private\n  *\n  * @emits {consumer: Consumer} newconsumer\n  * @emits {originator: String, [appData]: Any} close\n  *\n  * @emits @close\n  */\n\tfunction Peer(name, appData) {\n\t\t(0, _classCallCheck3.default)(this, Peer);\n\n\t\t// Name.\n\t\t// @type {String}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Peer.__proto__ || (0, _getPrototypeOf2.default)(Peer)).call(this, logger));\n\n\t\t_this._name = name;\n\n\t\t// Closed flag.\n\t\t// @type {Boolean}\n\t\t_this._closed = false;\n\n\t\t// App custom data.\n\t\t// @type {Any}\n\t\t_this._appData = appData;\n\n\t\t// Map of Consumers indexed by id.\n\t\t// @type {map<Number, Consumer>}\n\t\t_this._consumers = new _map2.default();\n\t\treturn _this;\n\t}\n\n\t/**\n  * Peer name.\n  *\n  * @return {String}\n  */\n\n\n\t(0, _createClass3.default)(Peer, [{\n\t\tkey: 'close',\n\n\n\t\t/**\n   * Closes the Peer.\n   * This is called when the local Room is closed.\n   *\n   * @private\n   */\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._closed = true;\n\n\t\t\tthis.emit('@close');\n\t\t\tthis.safeEmit('close', 'local');\n\n\t\t\t// Close all the Consumers.\n\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\tvar _didIteratorError = false;\n\t\t\tvar _iteratorError = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator = (0, _getIterator3.default)(this._consumers.values()), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\t\tvar consumer = _step.value;\n\n\t\t\t\t\tconsumer.close();\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError = true;\n\t\t\t\t_iteratorError = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * The remote Peer or Room was closed.\n   * Invoked via remote notification.\n   *\n   * @private\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\n\t}, {\n\t\tkey: 'remoteClose',\n\t\tvalue: function remoteClose(appData) {\n\t\t\tlogger.debug('remoteClose()');\n\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._closed = true;\n\n\t\t\tthis.emit('@close');\n\t\t\tthis.safeEmit('close', 'remote', appData);\n\n\t\t\t// Close all the Consumers.\n\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\tvar _didIteratorError2 = false;\n\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(this._consumers.values()), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\tvar consumer = _step2.value;\n\n\t\t\t\t\tconsumer.remoteClose();\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t_iteratorError2 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Get the Consumer with the given id.\n   *\n   * @param {Number} id\n   *\n   * @return {Consumer}\n   */\n\n\t}, {\n\t\tkey: 'getConsumerById',\n\t\tvalue: function getConsumerById(id) {\n\t\t\treturn this._consumers.get(id);\n\t\t}\n\n\t\t/**\n   * Add an associated Consumer.\n   *\n   * @private\n   *\n   * @param {Consumer} consumer\n   */\n\n\t}, {\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this2 = this;\n\n\t\t\tif (this._consumers.has(consumer.id)) throw new Error('Consumer already exists [id:' + consumer.id + ']');\n\n\t\t\t// Store it.\n\t\t\tthis._consumers.set(consumer.id, consumer);\n\n\t\t\t// Handle it.\n\t\t\tconsumer.on('@close', function () {\n\t\t\t\t_this2._consumers.delete(consumer.id);\n\t\t\t});\n\n\t\t\t// Emit event.\n\t\t\tthis.safeEmit('newconsumer', consumer);\n\t\t}\n\t}, {\n\t\tkey: 'name',\n\t\tget: function get() {\n\t\t\treturn this._name;\n\t\t}\n\n\t\t/**\n   * Whether the Peer is closed.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'closed',\n\t\tget: function get() {\n\t\t\treturn this._closed;\n\t\t}\n\n\t\t/**\n   * App custom data.\n   *\n   * @return {Any}\n   */\n\n\t}, {\n\t\tkey: 'appData',\n\t\tget: function get() {\n\t\t\treturn this._appData;\n\t\t}\n\n\t\t/**\n   * The list of Consumers.\n   *\n   * @return {Array<Consumer>}\n   */\n\n\t}, {\n\t\tkey: 'consumers',\n\t\tget: function get() {\n\t\t\treturn (0, _from2.default)(this._consumers.values());\n\t\t}\n\t}]);\n\treturn Peer;\n}(_EnhancedEventEmitter3.default);\n\nexports.default = Peer;\n\n/***/ }),\n\n/***/ \"./lib/mslib/Producer.js\":\n/*!*******************************!*\\\n  !*** ./lib/mslib/Producer.js ***!\n  \\*******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/assign.js\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _Logger = __webpack_require__(/*! ./Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ./EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _errors = __webpack_require__(/*! ./errors */ \"./lib/mslib/errors.js\");\n\nvar _utils = __webpack_require__(/*! ./utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar DEFAULT_STATS_INTERVAL = 1000;\nvar SIMULCAST_DEFAULT = {\n\tlow: 100000,\n\tmedium: 300000,\n\thigh: 1500000\n};\n\nvar logger = new _Logger2.default('<Producer>');\n\nvar Producer = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Producer, _EnhancedEventEmitter);\n\n\t/**\n  * @private\n  *\n  * @emits {originator: String, [appData]: Any} pause\n  * @emits {originator: String, [appData]: Any} resume\n  * @emits {stats: Object} stats\n  * @emits handled\n  * @emits unhandled\n  * @emits trackended\n  * @emits {originator: String, [appData]: Any} close\n  *\n  * @emits {originator: String, [appData]: Any} @close\n  */\n\tfunction Producer(track, options, appData) {\n\t\t(0, _classCallCheck3.default)(this, Producer);\n\n\t\t// Id.\n\t\t// @type {Number}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Producer.__proto__ || (0, _getPrototypeOf2.default)(Producer)).call(this, logger));\n\n\t\t_this._id = utils.randomNumber();\n\n\t\t// Closed flag.\n\t\t// @type {Boolean}\n\t\t_this._closed = false;\n\n\t\t// Original track.\n\t\t// @type {MediaStreamTrack}\n\t\t_this._originalTrack = track;\n\n\t\t// Track cloned from the original one (if supported).\n\t\t// @type {MediaStreamTrack}\n\t\ttry {\n\t\t\t_this._track = track.clone();\n\t\t} catch (error) {\n\t\t\t_this._track = track;\n\t\t}\n\n\t\t// App custom data.\n\t\t// @type {Any}\n\t\t_this._appData = appData;\n\n\t\t// Simulcast.\n\t\t// @type {Object|false}\n\t\t_this._simulcast = false;\n\n\t\tif ((0, _typeof3.default)(options.simulcast) === 'object') _this._simulcast = (0, _assign2.default)({}, SIMULCAST_DEFAULT, options.simulcast);else if (options.simulcast === true) _this._simulcast = (0, _assign2.default)({}, SIMULCAST_DEFAULT);\n\n\t\t_this._audioProfile = null;\n\t\tif ((0, _typeof3.default)(options.audioProfile) == 'object') _this._audioProfile = options.audioProfile;\n\n\t\t// @type {codecOptions}\n\t\t// {\n\t\t//   videoGoogleStartBitrate: Number,\n\t\t//   videoGoogleMaxBitrate: Number,\n\t\t//   videoGoogleMinBitrate: Number\n\t\t// }\n\t\t_this._videoBitrateOptions = null;\n\t\tif ((0, _typeof3.default)(options.codecOptions) === 'object') _this._videoBitrateOptions = options.codecOptions;\n\n\t\t// Associated Transport.\n\t\t// @type {Transport}\n\t\t_this._transport = null;\n\n\t\t// RTP parameters.\n\t\t// @type {RTCRtpParameters}\n\t\t_this._rtpParameters = null;\n\n\t\t// Locally paused flag.\n\t\t// @type {Boolean}\n\t\t_this._locallyPaused = !_this._track.enabled;\n\n\t\t// Remotely paused flag.\n\t\t// @type {Boolean}\n\t\t_this._remotelyPaused = false;\n\n\t\t// Periodic stats flag.\n\t\t// @type {Boolean}\n\t\t_this._statsEnabled = false;\n\n\t\t// Periodic stats gathering interval (milliseconds).\n\t\t// @type {Number}\n\t\t_this._statsInterval = DEFAULT_STATS_INTERVAL;\n\n\t\t// Handle the effective track.\n\t\t_this._handleTrack();\n\t\treturn _this;\n\t}\n\n\t/**\n  * Producer id.\n  *\n  * @return {Number}\n  */\n\n\n\t(0, _createClass3.default)(Producer, [{\n\t\tkey: 'close',\n\n\n\t\t/**\n   * Closes the Producer.\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\t\tvalue: function close(appData) {\n\t\t\tlogger.debug('close()');\n\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._closed = true;\n\n\t\t\tif (this._statsEnabled) {\n\t\t\t\tthis._statsEnabled = false;\n\n\t\t\t\tif (this.transport) {\n\t\t\t\t\tthis.transport.disableProducerStats(this);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this._transport) this._transport.removeProducer(this, 'local', appData);\n\n\t\t\tthis._destroy();\n\n\t\t\tthis.emit('@close', 'local', appData);\n\t\t\tthis.safeEmit('close', 'local', appData);\n\t\t}\n\n\t\t/**\n   * My remote Producer was closed.\n   * Invoked via remote notification.\n   *\n   * @private\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\n\t}, {\n\t\tkey: 'remoteClose',\n\t\tvalue: function remoteClose(appData) {\n\t\t\tlogger.debug('remoteClose()');\n\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._closed = true;\n\n\t\t\tif (this._transport) this._transport.removeProducer(this, 'remote', appData);\n\n\t\t\tthis._destroy();\n\n\t\t\tthis.emit('@close', 'remote', appData);\n\t\t\tthis.safeEmit('close', 'remote', appData);\n\t\t}\n\t}, {\n\t\tkey: '_destroy',\n\t\tvalue: function _destroy() {\n\t\t\tthis._transport = false;\n\t\t\tthis._rtpParameters = null;\n\n\t\t\ttry {\n\t\t\t\tthis._track.stop();\n\t\t\t} catch (error) {}\n\t\t}\n\n\t\t/**\n   * Sends RTP.\n   *\n   * @param {transport} Transport instance.\n   *\n   * @return {Promise}\n   */\n\n\t}, {\n\t\tkey: 'send',\n\t\tvalue: function send(transport) {\n\t\t\tvar _this2 = this;\n\n\t\t\tlogger.debug('send() [transport:%o]', transport);\n\n\t\t\tif (this._closed) return _promise2.default.reject(new _errors.InvalidStateError('Producer closed'));else if (this._transport) return _promise2.default.reject(new Error('already handled by a Transport'));else if ((typeof transport === 'undefined' ? 'undefined' : (0, _typeof3.default)(transport)) !== 'object') return _promise2.default.reject(new TypeError('invalid Transport'));\n\n\t\t\tif (this._originalTrack.kind === 'audio') {\n\t\t\t\ttransport._audioSent = true;\n\t\t\t} else if (this._originalTrack.kind === 'video') {\n\t\t\t\ttransport._videoSent = true;\n\t\t\t}\n\n\t\t\tthis._transport = transport;\n\n\t\t\treturn transport.addProducer(this).then(function () {\n\t\t\t\ttransport.once('@close', function () {\n\t\t\t\t\tif (_this2._closed || _this2._transport !== transport) return;\n\n\t\t\t\t\t_this2._transport.removeProducer(_this2, 'local');\n\n\t\t\t\t\t_this2._transport = null;\n\t\t\t\t\t_this2._rtpParameters = null;\n\n\t\t\t\t\t_this2.safeEmit('unhandled');\n\t\t\t\t});\n\n\t\t\t\t_this2.safeEmit('handled');\n\n\t\t\t\tif (_this2._statsEnabled) transport.enableProducerStats(_this2, _this2._statsInterval);\n\t\t\t}).catch(function (error) {\n\t\t\t\t_this2._transport = null;\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Pauses sending media.\n   *\n   * @param {Any} [appData] - App custom data.\n   *\n   * @return {Boolean} true if paused.\n   */\n\n\t}, {\n\t\tkey: 'pause',\n\t\tvalue: function pause(appData) {\n\t\t\tlogger.debug('pause()');\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.error('pause() | Producer closed');\n\n\t\t\t\treturn false;\n\t\t\t} else if (this._locallyPaused) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis._locallyPaused = true;\n\t\t\tthis._track.enabled = false;\n\n\t\t\tif (this._transport) this._transport.pauseProducer(this, appData);\n\n\t\t\tthis.safeEmit('pause', 'local', appData);\n\n\t\t\t// Return true if really paused.\n\t\t\treturn this.paused;\n\t\t}\n\n\t\t/**\n   * My remote Producer was paused.\n   * Invoked via remote notification.\n   *\n   * @private\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\n\t}, {\n\t\tkey: 'remotePause',\n\t\tvalue: function remotePause(appData) {\n\t\t\tlogger.debug('remotePause()');\n\n\t\t\tif (this._closed || this._remotelyPaused) return;\n\n\t\t\tthis._remotelyPaused = true;\n\t\t\tthis._track.enabled = false;\n\n\t\t\tthis.safeEmit('pause', 'remote', appData);\n\t\t}\n\n\t\t/**\n   * Resumes sending media.\n   *\n   * @param {Any} [appData] - App custom data.\n   *\n   * @return {Boolean} true if not paused.\n   */\n\n\t}, {\n\t\tkey: 'resume',\n\t\tvalue: function resume(appData) {\n\t\t\tlogger.debug('resume()');\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.error('resume() | Producer closed');\n\n\t\t\t\treturn false;\n\t\t\t} else if (!this._locallyPaused) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis._locallyPaused = false;\n\n\t\t\tif (!this._remotelyPaused) this._track.enabled = true;\n\n\t\t\tif (this._transport) this._transport.resumeProducer(this, appData);\n\n\t\t\tthis.safeEmit('resume', 'local', appData);\n\n\t\t\t// Return true if not paused.\n\t\t\treturn !this.paused;\n\t\t}\n\n\t\t/**\n   * My remote Producer was resumed.\n   * Invoked via remote notification.\n   *\n   * @private\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\n\t}, {\n\t\tkey: 'remoteResume',\n\t\tvalue: function remoteResume(appData) {\n\t\t\tlogger.debug('remoteResume()');\n\n\t\t\tif (this._closed || !this._remotelyPaused) return;\n\n\t\t\tthis._remotelyPaused = false;\n\n\t\t\tif (!this._locallyPaused) this._track.enabled = true;\n\n\t\t\tthis.safeEmit('resume', 'remote', appData);\n\t\t}\n\n\t\t/**\n   * stop the track\n   */\n\n\t}, {\n\t\tkey: 'stopTrack',\n\t\tvalue: function stopTrack() {\n\t\t\tlogger.debug('stopTrack() ');\n\t\t\ttry {\n\t\t\t\tthis._track.onended = null;\n\t\t\t\tthis._track.stop();\n\t\t\t} catch (error) {\n\t\t\t\tlogger.debug('stopTrack() fail - ' + error.toString());\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Replaces the current track with a new one.\n   *\n   * @param {MediaStreamTrack} track - New track.\n   *\n   * @return {Promise} Resolves with the new track itself.\n   */\n\n\t}, {\n\t\tkey: 'replaceTrack',\n\t\tvalue: function replaceTrack(track) {\n\t\t\tvar _this3 = this;\n\n\t\t\tlogger.debug('replaceTrack() [track:%o]', track);\n\n\t\t\tif (this._closed) return _promise2.default.reject(new _errors.InvalidStateError('Producer closed'));else if (!track) return _promise2.default.reject(new TypeError('no track given'));else if (track.readyState === 'ended') return _promise2.default.reject(new Error('track.readyState is [ended]'));\n\n\t\t\tvar clonedTrack = void 0;\n\n\t\t\ttry {\n\t\t\t\tclonedTrack = track.clone();\n\t\t\t} catch (error) {\n\t\t\t\tclonedTrack = track;\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// If this Producer is handled by a Transport, we need to tell it about\n\t\t\t\t// the new track.\n\t\t\t\tif (_this3._transport) return _this3._transport.replaceProducerTrack(_this3, clonedTrack);\n\t\t\t}).then(function () {\n\t\t\t\t// Stop the previous track.\n\t\t\t\ttry {\n\t\t\t\t\t_this3._track.onended = null;\n\t\t\t\t\t_this3._track.stop();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.debug('replaceTrack() fail - ' + error.toString());\n\t\t\t\t}\n\n\t\t\t\t// If this Producer was locally paused/resumed and the state of the new\n\t\t\t\t// track does not match, fix it.\n\t\t\t\tif (!_this3.paused) clonedTrack.enabled = true;else clonedTrack.enabled = false;\n\n\t\t\t\t// Set the new tracks.\n\t\t\t\t_this3._originalTrack = track;\n\t\t\t\t_this3._track = clonedTrack;\n\n\t\t\t\t// Handle the effective track.\n\t\t\t\t_this3._handleTrack();\n\n\t\t\t\t// Return the new track.\n\t\t\t\treturn _this3._track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(track, constraints, codecOptions) {\n\t\t\tvar _this4 = this;\n\n\t\t\tthis._track.applyConstraints(constraints).then(function () {\n\t\t\t\tlogger.debug('updateTrack() track.applyConstraints ok -- constraints: ' + (0, _stringify2.default)(constraints));\n\n\t\t\t\t// \n\t\t\t\t_this4.setCodecOption(codecOptions);\n\t\t\t\t_this4._transport.updateTrack(_this4, track);\n\t\t\t}).catch(function (err) {\n\t\t\t\t//\n\t\t\t\tlogger.warn('updateTrack() error - track.applyConstraints failed - ' + err.toString());\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'setCodecOption',\n\t\tvalue: function setCodecOption(codecOptions) {\n\t\t\tthis._videoBitrateOptions = {\n\t\t\t\tvideoGoogleStartBitrate: codecOptions.idealBandwidth,\n\t\t\t\tvideoGoogleMaxBitrate: codecOptions.maxBandwidth,\n\t\t\t\tvideoGoogleMinBitrate: codecOptions.minBandwidth\n\t\t\t};\n\t\t}\n\n\t\t// \n\n\t}, {\n\t\tkey: 'setRtpParameters',\n\n\n\t\t/**\n   * Set/update RTP parameters.\n   *\n   * @private\n   *\n   * @param {RTCRtpParameters} rtpParameters\n   */\n\t\tvalue: function setRtpParameters(rtpParameters) {\n\t\t\tthis._rtpParameters = rtpParameters;\n\t\t}\n\n\t\t/**\n   * Enables periodic stats retrieval.\n   */\n\n\t}, {\n\t\tkey: 'enableStats',\n\t\tvalue: function enableStats() {\n\t\t\tvar interval = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_STATS_INTERVAL;\n\n\t\t\tlogger.debug('enableStats() [interval:%s]', interval);\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.error('enableStats() | Producer closed');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._statsEnabled) return;\n\n\t\t\tif (typeof interval !== 'number' || interval < 1000) this._statsInterval = DEFAULT_STATS_INTERVAL;else this._statsInterval = interval;\n\n\t\t\tthis._statsEnabled = true;\n\n\t\t\tif (this._transport) this._transport.enableProducerStats(this, this._statsInterval);\n\t\t}\n\n\t\t/**\n   * Disables periodic stats retrieval.\n   */\n\n\t}, {\n\t\tkey: 'disableStats',\n\t\tvalue: function disableStats() {\n\t\t\t// logger.debug('disableStats()');\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.error('disableStats() | Producer closed');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._statsEnabled) return;\n\n\t\t\tthis._statsEnabled = false;\n\n\t\t\tif (this._transport) this._transport.disableProducerStats(this);\n\t\t}\n\n\t\t/**\n   * Receive remote stats.\n   *\n   * @private\n   *\n   * @param {Object} stats\n   */\n\n\t}, {\n\t\tkey: 'enableInternalStats',\n\t\tvalue: function enableInternalStats() {\n\t\t\tvar _this5 = this;\n\n\t\t\tvar interval = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_STATS_INTERVAL;\n\t\t\tlogger.debug('enableInternalStats() [interval:%s]', interval);\n\n\t\t\tif (this._closed) {\n\t\t\t\t// logger.error('enableInternalStats() | Producer closed');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._internalStatsEnabled) return;\n\t\t\tif (typeof interval !== 'number' || interval < 1000) this._interanlStatsInterval = DEFAULT_STATS_INTERVAL;else this._statsInterval = interval;\n\t\t\tthis._internalStatsEnabled = true;\n\t\t\tif (this._transport) {\n\t\t\t\tthis._internalTimer = setInterval(function () {\n\t\t\t\t\treturn _this5.getStats().then(function (s) {\n\t\t\t\t\t\t_this5.emit('internalStats', s);\n\t\t\t\t\t});\n\t\t\t\t}, interval);\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'disableInternalStats',\n\t\tvalue: function disableInternalStats() {\n\t\t\tif (this._internalStatsEnabled) {\n\t\t\t\tclearInterval(this._internalTimer);\n\t\t\t}\n\n\t\t\tthis._internalTimer = null;\n\t\t\tthis._internalStatsEnabled = false;\n\t\t}\n\t}, {\n\t\tkey: 'remoteStats',\n\t\tvalue: function remoteStats(stats) {\n\t\t\tthis.safeEmit('stats', stats);\n\t\t}\n\n\t\t/**\n   * Get producer stats.\n   *\n   * @private\n   *\n   * @param {Object} stats\n   */\n\n\t}, {\n\t\tkey: 'getStats',\n\t\tvalue: function getStats() {\n\t\t\treturn this.transport.getStats(this.track);\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: '_handleTrack',\n\t\tvalue: function _handleTrack() {\n\t\t\tvar _this6 = this;\n\n\t\t\t// If the cloned track is closed (for example if the desktop sharing is closed\n\t\t\t// via chrome UI) notify the app and let it decide wheter to close the Producer\n\t\t\t// or not.\n\t\t\tthis._track.onended = function () {\n\t\t\t\tif (_this6._closed) return;\n\n\t\t\t\tlogger.warn('track \"ended\" event');\n\n\t\t\t\t_this6.safeEmit('trackended');\n\t\t\t};\n\t\t}\n\t}, {\n\t\tkey: 'id',\n\t\tget: function get() {\n\t\t\treturn this._id;\n\t\t}\n\n\t\t/**\n   * Whether the Producer is closed.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'closed',\n\t\tget: function get() {\n\t\t\treturn this._closed;\n\t\t}\n\n\t\t/**\n   * Media kind.\n   *\n   * @return {String}\n   */\n\n\t}, {\n\t\tkey: 'kind',\n\t\tget: function get() {\n\t\t\treturn this._track.kind;\n\t\t}\n\n\t\t/**\n   * The associated track.\n   *\n   * @return {MediaStreamTrack}\n   */\n\n\t}, {\n\t\tkey: 'track',\n\t\tget: function get() {\n\t\t\treturn this._track;\n\t\t}\n\n\t\t/**\n   * The associated original track.\n   *\n   * @return {MediaStreamTrack}\n   */\n\n\t}, {\n\t\tkey: 'originalTrack',\n\t\tget: function get() {\n\t\t\treturn this._originalTrack;\n\t\t}\n\n\t\t/**\n   * Simulcast settings.\n   *\n   * @return {Object|false}\n   */\n\n\t}, {\n\t\tkey: 'simulcast',\n\t\tget: function get() {\n\t\t\treturn this._simulcast;\n\t\t}\n\n\t\t/**\n   * App custom data.\n   *\n   * @return {Any}\n   */\n\n\t}, {\n\t\tkey: 'appData',\n\t\tget: function get() {\n\t\t\treturn this._appData;\n\t\t}\n\n\t\t/**\n   * Associated Transport.\n   *\n   * @return {Transport}\n   */\n\n\t}, {\n\t\tkey: 'transport',\n\t\tget: function get() {\n\t\t\treturn this._transport;\n\t\t}\n\n\t\t/**\n   * RTP parameters.\n   *\n   * @return {RTCRtpParameters}\n   */\n\n\t}, {\n\t\tkey: 'rtpParameters',\n\t\tget: function get() {\n\t\t\treturn this._rtpParameters;\n\t\t}\n\n\t\t/**\n   * Whether the Producer is locally paused.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'locallyPaused',\n\t\tget: function get() {\n\t\t\treturn this._locallyPaused;\n\t\t}\n\n\t\t/**\n   * Whether the Producer is remotely paused.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'remotelyPaused',\n\t\tget: function get() {\n\t\t\treturn this._remotelyPaused;\n\t\t}\n\n\t\t/**\n   * Whether the Producer is paused.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'paused',\n\t\tget: function get() {\n\t\t\treturn this._locallyPaused || this._remotelyPaused;\n\t\t}\n\t}, {\n\t\tkey: 'videoBitrateOptions',\n\t\tget: function get() {\n\t\t\treturn this._videoBitrateOptions;\n\t\t}\n\n\t\t// \n\n\t}, {\n\t\tkey: 'audioProfile',\n\t\tget: function get() {\n\t\t\treturn this._audioProfile;\n\t\t}\n\t}]);\n\treturn Producer;\n}(_EnhancedEventEmitter3.default);\n\nexports.default = Producer;\n\n/***/ }),\n\n/***/ \"./lib/mslib/Room.js\":\n/*!***************************!*\\\n  !*** ./lib/mslib/Room.js ***!\n  \\***************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _assign = __webpack_require__(/*! babel-runtime/core-js/object/assign */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/assign.js\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _Logger = __webpack_require__(/*! ./Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ./EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _errors = __webpack_require__(/*! ./errors */ \"./lib/mslib/errors.js\");\n\nvar _ortc = __webpack_require__(/*! ./ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _Device = __webpack_require__(/*! ./Device */ \"./lib/mslib/Device.js\");\n\nvar _Device2 = _interopRequireDefault(_Device);\n\nvar _Transport = __webpack_require__(/*! ./Transport */ \"./lib/mslib/Transport.js\");\n\nvar _Transport2 = _interopRequireDefault(_Transport);\n\nvar _Producer = __webpack_require__(/*! ./Producer */ \"./lib/mslib/Producer.js\");\n\nvar _Producer2 = _interopRequireDefault(_Producer);\n\nvar _Peer = __webpack_require__(/*! ./Peer */ \"./lib/mslib/Peer.js\");\n\nvar _Peer2 = _interopRequireDefault(_Peer);\n\nvar _Consumer = __webpack_require__(/*! ./Consumer */ \"./lib/mslib/Consumer.js\");\n\nvar _Consumer2 = _interopRequireDefault(_Consumer);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('<Room>');\n\nvar RoomState = {\n\tnew: 'new',\n\tjoining: 'joining',\n\tjoined: 'joined',\n\tclosed: 'closed'\n};\n\n/**\n * An instance of Room represents a remote multi conference and a local\n * peer that joins it.\n */\n\nvar Room = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Room, _EnhancedEventEmitter);\n\n\t/**\n  * Room class.\n  *\n  * @param {Object} [options]\n  * @param {Object} [options.roomSettings] Remote room settings, including its RTP\n  * capabilities, mandatory codecs, etc. If given, no 'queryRoom' request is sent\n  * to the server to discover them.\n  * @param {Number} [options.requestTimeout=10000] - Timeout for sent requests\n  * (in milliseconds). Defaults to 10000 (10 seconds).\n  * @param {Object} [options.transportOptions] - Options for Transport created in mediasoup.\n  * @param {Array<RTCIceServer>} [options.turnServers] - Array of TURN servers.\n  * @param {RTCIceTransportPolicy} [options.iceTransportPolicy] - ICE transport policy.\n  * @param {Boolean} [options.spy] - Whether this is a spy peer.\n  *\n  * @throws {Error} if device is not supported.\n  *\n  * @emits {request: Object, callback: Function, errback: Function} request\n  * @emits {notification: Object} notify\n  * @emits {peer: Peer} newpeer\n  * @emits {originator: String, [appData]: Any} close\n  */\n\tfunction Room(options) {\n\t\t(0, _classCallCheck3.default)(this, Room);\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Room.__proto__ || (0, _getPrototypeOf2.default)(Room)).call(this, logger));\n\n\t\tlogger.debug('constructor() [options:%o]', options);\n\n\t\tif (!_Device2.default.isSupported()) throw new Error('current browser/device not supported');\n\n\t\toptions = options || {};\n\n\t\t// Computed settings.\n\t\t// @type {Object}\n\t\t_this._settings = {\n\t\t\troomSettings: options.roomSettings,\n\t\t\trequestTimeout: options.requestTimeout || 30000,\n\t\t\ttransportOptions: options.transportOptions || {},\n\t\t\tturnServers: options.turnServers || [],\n\t\t\ticeTransportPolicy: options.iceTransportPolicy || 'all',\n\t\t\tspy: Boolean(options.spy)\n\t\t};\n\n\t\t// Room state.\n\t\t// @type {Boolean}\n\t\t_this._state = RoomState.new;\n\n\t\t// My mediasoup Peer name.\n\t\t// @type {String}\n\t\t_this._peerName = null;\n\n\t\t// Map of Transports indexed by id.\n\t\t// @type {map<Number, Transport>}\n\t\t_this._transports = new _map2.default();\n\n\t\t// Map of Producers indexed by id.\n\t\t// @type {map<Number, Producer>}\n\t\t_this._producers = new _map2.default();\n\n\t\t// Map of Peers indexed by name.\n\t\t// @type {map<String, Peer>}\n\t\t_this._peers = new _map2.default();\n\n\t\t// Extended RTP capabilities.\n\t\t// @type {Object}\n\t\t_this._extendedRtpCapabilities = null;\n\n\t\t// Whether we can send audio/video based on computed extended RTP\n\t\t// capabilities.\n\t\t// @type {Object}\n\t\t_this._canSendByKind = {\n\t\t\taudio: false,\n\t\t\tvideo: false\n\t\t};\n\t\treturn _this;\n\t}\n\n\t/**\n  * Whether the Room is joined.\n  *\n  * @return {Boolean}\n  */\n\n\n\t(0, _createClass3.default)(Room, [{\n\t\tkey: 'getTransportById',\n\n\n\t\t/**\n   * Get the Transport with the given id.\n   *\n   * @param {Number} id\n   *\n   * @return {Transport}\n   */\n\t\tvalue: function getTransportById(id) {\n\t\t\treturn this._transports.get(id);\n\t\t}\n\n\t\t/**\n   * Get the Producer with the given id.\n   *\n   * @param {Number} id\n   *\n   * @return {Producer}\n   */\n\n\t}, {\n\t\tkey: 'getProducerById',\n\t\tvalue: function getProducerById(id) {\n\t\t\treturn this._producers.get(id);\n\t\t}\n\n\t\t/**\n   * Get the Peer with the given name.\n   *\n   * @param {String} name\n   *\n   * @return {Peer}\n   */\n\n\t}, {\n\t\tkey: 'getPeerByName',\n\t\tvalue: function getPeerByName(name) {\n\t\t\treturn this._peers.get(name);\n\t\t}\n\n\t\t/**\n   * Start the procedures to join a remote room.\n   * @param {String} peerName - My mediasoup Peer name.\n   * @param {Any} [appData] - App custom data.\n   * @return {Promise}\n   */\n\n\t}, {\n\t\tkey: 'join',\n\t\tvalue: function join(peerName, appData) {\n\t\t\tvar _this2 = this;\n\n\t\t\tlogger.debug('join() [peerName:\"%s\"]', peerName);\n\n\t\t\tif (typeof peerName !== 'string') return _promise2.default.reject(new TypeError('invalid peerName'));\n\n\t\t\tif (this._state !== RoomState.new && this._state !== RoomState.closed) {\n\t\t\t\treturn _promise2.default.reject(new _errors.InvalidStateError('invalid state \"' + this._state + '\"'));\n\t\t\t}\n\n\t\t\tthis._peerName = peerName;\n\t\t\tthis._state = RoomState.joining;\n\n\t\t\tvar roomSettings = void 0;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// If Room settings are provided don't query them.\n\t\t\t\tif (_this2._settings.roomSettings) {\n\t\t\t\t\troomSettings = _this2._settings.roomSettings;\n\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\treturn _this2._sendRequest('queryRoom', { target: 'room' }).then(function (response) {\n\t\t\t\t\t\troomSettings = response;\n\n\t\t\t\t\t\tlogger.debug('join() | got Room settings:%o', roomSettings);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).then(function () {\n\t\t\t\treturn _Device2.default.Handler.getNativeRtpCapabilities();\n\t\t\t}).then(function (nativeRtpCapabilities) {\n\t\t\t\tlogger.debug('join() | native RTP capabilities:%o', nativeRtpCapabilities);\n\n\t\t\t\t// Get extended RTP capabilities.\n\t\t\t\t_this2._extendedRtpCapabilities = ortc.getExtendedRtpCapabilities(nativeRtpCapabilities, roomSettings.rtpCapabilities);\n\n\t\t\t\tlogger.debug('join() | extended RTP capabilities:%o', _this2._extendedRtpCapabilities);\n\n\t\t\t\t// Check unsupported codecs.\n\t\t\t\tvar unsupportedRoomCodecs = ortc.getUnsupportedCodecs(roomSettings.rtpCapabilities, roomSettings.mandatoryCodecPayloadTypes, _this2._extendedRtpCapabilities);\n\n\t\t\t\tif (unsupportedRoomCodecs.length > 0) {\n\t\t\t\t\tlogger.error('%s mandatory room codecs not supported:%o', unsupportedRoomCodecs.length, unsupportedRoomCodecs);\n\n\t\t\t\t\tthrow new _errors.UnsupportedError('mandatory room codecs not supported', unsupportedRoomCodecs);\n\t\t\t\t}\n\n\t\t\t\t// Check whether we can send audio/video.\n\t\t\t\t_this2._canSendByKind.audio = ortc.canSend('audio', _this2._extendedRtpCapabilities);\n\t\t\t\t_this2._canSendByKind.video = ortc.canSend('video', _this2._extendedRtpCapabilities);\n\n\t\t\t\t// Generate our effective RTP capabilities for receiving media.\n\t\t\t\tvar effectiveLocalRtpCapabilities = ortc.getRtpCapabilities(_this2._extendedRtpCapabilities);\n\n\t\t\t\tlogger.debug('join() | effective local RTP capabilities for receiving:%o', effectiveLocalRtpCapabilities);\n\n\t\t\t\tvar data = {\n\t\t\t\t\ttarget: 'room',\n\t\t\t\t\tpeerName: _this2._peerName,\n\t\t\t\t\trtpCapabilities: effectiveLocalRtpCapabilities,\n\t\t\t\t\tspy: _this2._settings.spy,\n\t\t\t\t\tappData: appData\n\t\t\t\t};\n\n\t\t\t\treturn _this2._sendRequest('join', data).then(function (response) {\n\t\t\t\t\treturn response.peers;\n\t\t\t\t});\n\t\t\t}).then(function (peers) {\n\t\t\t\t// Handle Peers already existing in the room.\n\t\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\t\tvar _didIteratorError = false;\n\t\t\t\tvar _iteratorError = undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tfor (var _iterator = (0, _getIterator3.default)(peers || []), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\t\t\tvar peerData = _step.value;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t_this2._handlePeerData(peerData);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tlogger.error('join() | error handling Peer:%o', error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\t_didIteratorError = true;\n\t\t\t\t\t_iteratorError = err;\n\t\t\t\t} finally {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t\t}\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t_this2._state = RoomState.joined;\n\n\t\t\t\tlogger.debug('join() | joined the Room');\n\n\t\t\t\t// Return the list of already existing Peers.\n\t\t\t\treturn _this2.peers;\n\t\t\t}).catch(function (error) {\n\t\t\t\t_this2._state = RoomState.new;\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Leave the Room.\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\n\t}, {\n\t\tkey: 'leave',\n\t\tvalue: function leave(appData) {\n\t\t\tlogger.debug('leave()');\n\n\t\t\tif (this.closed) return;\n\n\t\t\t// Send a notification.\n\t\t\tthis._sendNotification('leave', { appData: appData });\n\n\t\t\t// Set closed state after sending the notification (otherwise the\n\t\t\t// notification won't be sent).\n\t\t\tthis._state = RoomState.closed;\n\n\t\t\tthis.safeEmit('close', 'local', appData);\n\n\t\t\t// Close all the Transports.\n\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\tvar _didIteratorError2 = false;\n\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(this._transports.values()), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\tvar transport = _step2.value;\n\n\t\t\t\t\ttransport.close();\n\t\t\t\t}\n\n\t\t\t\t// Close all the Producers.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t_iteratorError2 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion3 = true;\n\t\t\tvar _didIteratorError3 = false;\n\t\t\tvar _iteratorError3 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator3 = (0, _getIterator3.default)(this._producers.values()), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\t\t\tvar producer = _step3.value;\n\n\t\t\t\t\tproducer.close();\n\t\t\t\t}\n\n\t\t\t\t// Close all the Peers.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError3 = true;\n\t\t\t\t_iteratorError3 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t\t\t_iterator3.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError3) {\n\t\t\t\t\t\tthrow _iteratorError3;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion4 = true;\n\t\t\tvar _didIteratorError4 = false;\n\t\t\tvar _iteratorError4 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator4 = (0, _getIterator3.default)(this._peers.values()), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n\t\t\t\t\tvar peer = _step4.value;\n\n\t\t\t\t\tpeer.close();\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError4 = true;\n\t\t\t\t_iteratorError4 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion4 && _iterator4.return) {\n\t\t\t\t\t\t_iterator4.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError4) {\n\t\t\t\t\t\tthrow _iteratorError4;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * The remote Room was closed or our remote Peer has been closed.\n   * Invoked via remote notification or via API.\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\n\t}, {\n\t\tkey: 'remoteClose',\n\t\tvalue: function remoteClose(appData) {\n\t\t\tlogger.debug('remoteClose()');\n\n\t\t\tif (this.closed) return;\n\n\t\t\tthis._state = RoomState.closed;\n\n\t\t\tthis.safeEmit('close', 'remote', appData);\n\n\t\t\t// Close all the Transports.\n\t\t\tvar _iteratorNormalCompletion5 = true;\n\t\t\tvar _didIteratorError5 = false;\n\t\t\tvar _iteratorError5 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator5 = (0, _getIterator3.default)(this._transports.values()), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n\t\t\t\t\tvar transport = _step5.value;\n\n\t\t\t\t\ttransport.remoteClose(null, { destroy: true });\n\t\t\t\t}\n\n\t\t\t\t// Close all the Producers.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError5 = true;\n\t\t\t\t_iteratorError5 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion5 && _iterator5.return) {\n\t\t\t\t\t\t_iterator5.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError5) {\n\t\t\t\t\t\tthrow _iteratorError5;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion6 = true;\n\t\t\tvar _didIteratorError6 = false;\n\t\t\tvar _iteratorError6 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator6 = (0, _getIterator3.default)(this._producers.values()), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n\t\t\t\t\tvar producer = _step6.value;\n\n\t\t\t\t\tproducer.remoteClose();\n\t\t\t\t}\n\n\t\t\t\t// Close all the Peers.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError6 = true;\n\t\t\t\t_iteratorError6 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion6 && _iterator6.return) {\n\t\t\t\t\t\t_iterator6.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError6) {\n\t\t\t\t\t\tthrow _iteratorError6;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion7 = true;\n\t\t\tvar _didIteratorError7 = false;\n\t\t\tvar _iteratorError7 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator7 = (0, _getIterator3.default)(this._peers.values()), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n\t\t\t\t\tvar peer = _step7.value;\n\n\t\t\t\t\tpeer.remoteClose();\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError7 = true;\n\t\t\t\t_iteratorError7 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion7 && _iterator7.return) {\n\t\t\t\t\t\t_iterator7.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError7) {\n\t\t\t\t\t\tthrow _iteratorError7;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Whether we can send audio/video.\n   *\n   * @param {String} kind - 'audio' or 'video'.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'canSend',\n\t\tvalue: function canSend(kind) {\n\t\t\tif (kind !== 'audio' && kind !== 'video') throw new TypeError('invalid kind \"' + kind + '\"');\n\n\t\t\tif (!this.joined || this._settings.spy) return false;\n\n\t\t\treturn this._canSendByKind[kind];\n\t\t}\n\n\t\t/**\n   * Creates a Transport.\n   *\n   * @param {String} direction - Must be 'send' or 'recv'.\n   * @param {Any} [appData] - App custom data.\n   *\n   * @return {Transport}\n   *\n   * @throws {InvalidStateError} if not joined.\n   * @throws {TypeError} if wrong arguments.\n   */\n\n\t}, {\n\t\tkey: 'createTransport',\n\t\tvalue: function createTransport(direction, appData) {\n\t\t\tvar _this3 = this;\n\n\t\t\tlogger.debug('createTransport() [direction:%s]', direction);\n\n\t\t\tif (!this.joined) throw new _errors.InvalidStateError('invalid state \"' + this._state + '\"');else if (direction !== 'send' && direction !== 'recv') throw new TypeError('invalid direction \"' + direction + '\"');else if (direction === 'send' && this._settings.spy) throw new TypeError('a spy peer cannot send media to the room');\n\n\t\t\t// Create a new Transport.\n\t\t\tvar transport = new _Transport2.default(direction, this._extendedRtpCapabilities, this._settings, appData);\n\n\t\t\t// Store it.\n\t\t\tthis._transports.set(transport.id, transport);\n\n\t\t\ttransport.on('@request', function (method, data, callback, errback) {\n\t\t\t\t_this3._sendRequest(method, data).then(callback).catch(errback);\n\t\t\t});\n\n\t\t\ttransport.on('@notify', function (method, data) {\n\t\t\t\t_this3._sendNotification(method, data);\n\t\t\t});\n\n\t\t\ttransport.on('@close', function () {\n\t\t\t\t_this3._transports.delete(transport.id);\n\t\t\t});\n\n\t\t\treturn transport;\n\t\t}\n\n\t\t/**\n   * Creates a Producer.\n   *\n   * @param {MediaStreamTrack} track\n   * @param {Object} [options]\n   * @param {Object} [options.simulcast]\n   * @param {Any} [appData] - App custom data.\n   *\n   * @return {Producer}\n   *\n   * @throws {InvalidStateError} if not joined.\n   * @throws {TypeError} if wrong arguments.\n   * @throws {Error} if cannot send the given kindor we are a spy peer.\n   */\n\n\t}, {\n\t\tkey: 'createProducer',\n\t\tvalue: function createProducer(track, options, appData) {\n\t\t\tvar _this4 = this;\n\n\t\t\tlogger.debug('createProducer() [track:%o, options:%o]', track, options);\n\n\t\t\tif (!this.joined) throw new _errors.InvalidStateError('invalid state \"' + this._state + '\"');else if (this._settings.spy) throw new Error('a spy peer cannot send media to the room');else if (!track) throw new TypeError('no track given');else if (!this._canSendByKind[track.kind]) throw new Error('cannot send ' + track.kind);else if (track.readyState === 'ended') throw new Error('track.readyState is \"ended\"');\n\n\t\t\toptions = options || {};\n\n\t\t\t// Create a new Producer.\n\t\t\tvar producer = new _Producer2.default(track, options, appData);\n\n\t\t\t// Store it.\n\t\t\tthis._producers.set(producer.id, producer);\n\n\t\t\tproducer.on('@close', function () {\n\t\t\t\t_this4._producers.delete(producer.id);\n\t\t\t});\n\n\t\t\treturn producer;\n\t\t}\n\n\t\t/**\n   * Produce a ICE restart in all the Transports.\n   */\n\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(callback, errback) {\n\t\t\tif (!this.joined) {\n\t\t\t\tlogger.warn('restartIce() | invalid state \"' + this._state + '\"');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion8 = true;\n\t\t\tvar _didIteratorError8 = false;\n\t\t\tvar _iteratorError8 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator8 = (0, _getIterator3.default)(this._transports.values()), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n\t\t\t\t\tvar transport = _step8.value;\n\n\t\t\t\t\ttransport.restartIce(callback, errback);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError8 = true;\n\t\t\t\t_iteratorError8 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion8 && _iterator8.return) {\n\t\t\t\t\t\t_iterator8.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError8) {\n\t\t\t\t\t\tthrow _iteratorError8;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Provide the local Room with a notification generated by mediasoup server.\n   *\n   * @param {Object} notification\n   */\n\n\t}, {\n\t\tkey: 'receiveNotification',\n\t\tvalue: function receiveNotification(notification) {\n\t\t\tvar _this5 = this;\n\n\t\t\tif (this.closed) return _promise2.default.reject(new _errors.InvalidStateError('Room closed'));else if ((typeof notification === 'undefined' ? 'undefined' : (0, _typeof3.default)(notification)) !== 'object') return _promise2.default.reject(new TypeError('wrong notification Object'));else if (notification.notification !== true) return _promise2.default.reject(new TypeError('not a notification'));else if (typeof notification.method !== 'string') return _promise2.default.reject(new TypeError('wrong/missing notification method'));\n\n\t\t\tvar method = notification.method;\n\n\n\t\t\tif (method !== 'producerStats' && method !== 'consumerStats') {\n\t\t\t\tlogger.debug('receiveNotification() [method:%s, notification:%o]', method, notification);\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tswitch (method) {\n\t\t\t\t\tcase 'closed':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar appData = notification.appData;\n\n\n\t\t\t\t\t\t\t_this5.remoteClose(appData);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'transportClosed':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar id = notification.id,\n\t\t\t\t\t\t\t    _appData = notification.appData;\n\n\t\t\t\t\t\t\tvar transport = _this5._transports.get(id);\n\n\t\t\t\t\t\t\tif (!transport) throw new Error('Transport not found [id:\"' + id + '\"]');\n\n\t\t\t\t\t\t\ttransport.remoteClose(_appData, { destroy: false });\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'transportStats':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id = notification.id,\n\t\t\t\t\t\t\t    stats = notification.stats;\n\n\t\t\t\t\t\t\tvar _transport = _this5._transports.get(_id);\n\n\t\t\t\t\t\t\tif (!_transport) throw new Error('Transport not found [id:' + _id + ']');\n\n\t\t\t\t\t\t\t_transport.remoteStats(stats);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'newPeer':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar name = notification.name;\n\n\n\t\t\t\t\t\t\tif (_this5._peers.has(name)) throw new Error('Peer already exists [name:\"' + name + '\"]');\n\n\t\t\t\t\t\t\tvar peerData = notification;\n\n\t\t\t\t\t\t\t_this5._handlePeerData(peerData);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'peerClosed':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar peerName = notification.name;\n\t\t\t\t\t\t\tvar _appData2 = notification.appData;\n\n\t\t\t\t\t\t\tvar peer = _this5._peers.get(peerName);\n\n\t\t\t\t\t\t\tif (!peer) throw new Error('no Peer found [name:\"' + peerName + '\"]');\n\n\t\t\t\t\t\t\tpeer.remoteClose(_appData2);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'producerPaused':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id2 = notification.id,\n\t\t\t\t\t\t\t    _appData3 = notification.appData;\n\n\t\t\t\t\t\t\tvar producer = _this5._producers.get(_id2);\n\n\t\t\t\t\t\t\tif (!producer) throw new Error('Producer not found [id:' + _id2 + ']');\n\n\t\t\t\t\t\t\tproducer.remotePause(_appData3);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'producerResumed':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id3 = notification.id,\n\t\t\t\t\t\t\t    _appData4 = notification.appData;\n\n\t\t\t\t\t\t\tvar _producer = _this5._producers.get(_id3);\n\n\t\t\t\t\t\t\tif (!_producer) throw new Error('Producer not found [id:' + _id3 + ']');\n\n\t\t\t\t\t\t\t_producer.remoteResume(_appData4);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'producerClosed':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id4 = notification.id,\n\t\t\t\t\t\t\t    _appData5 = notification.appData;\n\n\t\t\t\t\t\t\tvar _producer2 = _this5._producers.get(_id4);\n\n\t\t\t\t\t\t\tif (!_producer2) throw new Error('Producer not found [id:' + _id4 + ']');\n\n\t\t\t\t\t\t\t_producer2.remoteClose(_appData5);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'producerStats':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id5 = notification.id,\n\t\t\t\t\t\t\t    _stats = notification.stats;\n\n\t\t\t\t\t\t\tvar _producer3 = _this5._producers.get(_id5);\n\n\t\t\t\t\t\t\tif (!_producer3) throw new Error('Producer not found [id:' + _id5 + ']');\n\n\t\t\t\t\t\t\t_producer3.remoteStats(_stats);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'newConsumer':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _peerName = notification.peerName;\n\n\t\t\t\t\t\t\tvar _peer = _this5._peers.get(_peerName);\n\n\t\t\t\t\t\t\tif (!_peer) throw new Error('no Peer found [name:\"' + _peerName + '\"]');\n\n\t\t\t\t\t\t\tvar consumerData = notification;\n\n\t\t\t\t\t\t\t_this5._handleConsumerData(consumerData, _peer);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'consumerClosed':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id6 = notification.id,\n\t\t\t\t\t\t\t    _peerName2 = notification.peerName,\n\t\t\t\t\t\t\t    _appData6 = notification.appData;\n\n\t\t\t\t\t\t\tvar _peer2 = _this5._peers.get(_peerName2);\n\n\t\t\t\t\t\t\tif (!_peer2) throw new Error('no Peer found [name:\"' + _peerName2 + '\"]');\n\n\t\t\t\t\t\t\tvar consumer = _peer2.getConsumerById(_id6);\n\n\t\t\t\t\t\t\tif (!consumer) throw new Error('Consumer not found [id:' + _id6 + ']');\n\n\t\t\t\t\t\t\tconsumer.remoteClose(_appData6);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'consumerPaused':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id7 = notification.id,\n\t\t\t\t\t\t\t    _peerName3 = notification.peerName,\n\t\t\t\t\t\t\t    _appData7 = notification.appData;\n\n\t\t\t\t\t\t\tvar _peer3 = _this5._peers.get(_peerName3);\n\n\t\t\t\t\t\t\tif (!_peer3) throw new Error('no Peer found [name:\"' + _peerName3 + '\"]');\n\n\t\t\t\t\t\t\tvar _consumer = _peer3.getConsumerById(_id7);\n\n\t\t\t\t\t\t\tif (!_consumer) throw new Error('Consumer not found [id:' + _id7 + ']');\n\n\t\t\t\t\t\t\t_consumer.remotePause(_appData7);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'consumerResumed':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id8 = notification.id,\n\t\t\t\t\t\t\t    _peerName4 = notification.peerName,\n\t\t\t\t\t\t\t    _appData8 = notification.appData;\n\n\t\t\t\t\t\t\tvar _peer4 = _this5._peers.get(_peerName4);\n\n\t\t\t\t\t\t\tif (!_peer4) throw new Error('no Peer found [name:\"' + _peerName4 + '\"]');\n\n\t\t\t\t\t\t\tvar _consumer2 = _peer4.getConsumerById(_id8);\n\n\t\t\t\t\t\t\tif (!_consumer2) throw new Error('Consumer not found [id:' + _id8 + ']');\n\n\t\t\t\t\t\t\t_consumer2.remoteResume(_appData8);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'consumerPreferredProfileSet':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id9 = notification.id,\n\t\t\t\t\t\t\t    _peerName5 = notification.peerName,\n\t\t\t\t\t\t\t    profile = notification.profile;\n\n\t\t\t\t\t\t\tvar _peer5 = _this5._peers.get(_peerName5);\n\n\t\t\t\t\t\t\tif (!_peer5) throw new Error('no Peer found [name:\"' + _peerName5 + '\"]');\n\n\t\t\t\t\t\t\tvar _consumer3 = _peer5.getConsumerById(_id9);\n\n\t\t\t\t\t\t\tif (!_consumer3) throw new Error('Consumer not found [id:' + _id9 + ']');\n\n\t\t\t\t\t\t\t_consumer3.remoteSetPreferredProfile(profile);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'consumerEffectiveProfileChanged':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id10 = notification.id,\n\t\t\t\t\t\t\t    _peerName6 = notification.peerName,\n\t\t\t\t\t\t\t    _profile = notification.profile;\n\n\t\t\t\t\t\t\tvar _peer6 = _this5._peers.get(_peerName6);\n\n\t\t\t\t\t\t\tif (!_peer6) throw new Error('no Peer found [name:\"' + _peerName6 + '\"]');\n\n\t\t\t\t\t\t\tvar _consumer4 = _peer6.getConsumerById(_id10);\n\n\t\t\t\t\t\t\tif (!_consumer4) throw new Error('Consumer not found [id:' + _id10 + ']');\n\n\t\t\t\t\t\t\t_consumer4.remoteEffectiveProfileChanged(_profile);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'consumerStats':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _id11 = notification.id,\n\t\t\t\t\t\t\t    _peerName7 = notification.peerName,\n\t\t\t\t\t\t\t    _stats2 = notification.stats;\n\n\t\t\t\t\t\t\tvar _peer7 = _this5._peers.get(_peerName7);\n\n\t\t\t\t\t\t\tif (!_peer7) throw new Error('no Peer found [name:\"' + _peerName7 + '\"]');\n\n\t\t\t\t\t\t\tvar _consumer5 = _peer7.getConsumerById(_id11);\n\n\t\t\t\t\t\t\tif (!_consumer5) throw new Error('Consumer not found [id:' + _id11 + ']');\n\n\t\t\t\t\t\t\t_consumer5.remoteStats(_stats2);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error('unknown notification method \"' + method + '\"');\n\t\t\t\t}\n\t\t\t}).catch(function (error) {\n\t\t\t\tlogger.error('receiveNotification() failed [notification:%o]: %s', notification, error);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_sendRequest',\n\t\tvalue: function _sendRequest(method, data) {\n\t\t\tvar _this6 = this;\n\n\t\t\tvar request = (0, _assign2.default)({ method: method, target: 'peer' }, data);\n\n\t\t\t// Should never happen.\n\t\t\t// Ignore if closed.\n\t\t\tif (this.closed) {\n\t\t\t\tlogger.error('_sendRequest() | Room closed [method:%s, request:%o]', method, request);\n\n\t\t\t\treturn _promise2.default.reject(new _errors.InvalidStateError('Room closed'));\n\t\t\t}\n\n\t\t\tlogger.debug('_sendRequest() [method:%s, request:%o]', method, request);\n\n\t\t\treturn new _promise2.default(function (resolve, reject) {\n\t\t\t\tvar done = false;\n\n\t\t\t\tvar timer = setTimeout(function () {\n\t\t\t\t\tlogger.error('request failed [method:%s]: timeout', method);\n\n\t\t\t\t\tdone = true;\n\t\t\t\t\treject(new _errors.TimeoutError('timeout'));\n\t\t\t\t}, _this6._settings.requestTimeout);\n\n\t\t\t\tvar callback = function callback(response) {\n\t\t\t\t\tif (done) return;\n\n\t\t\t\t\tdone = true;\n\t\t\t\t\tclearTimeout(timer);\n\n\t\t\t\t\tif (_this6.closed) {\n\t\t\t\t\t\tlogger.error('request failed [method:%s]: Room closed', method);\n\n\t\t\t\t\t\treject(new Error('Room closed'));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlogger.debug('request succeeded [method:%s, response:%o]', method, response);\n\n\t\t\t\t\tresolve(response);\n\t\t\t\t};\n\n\t\t\t\tvar errback = function errback(error) {\n\t\t\t\t\tif (done) return;\n\n\t\t\t\t\tdone = true;\n\t\t\t\t\tclearTimeout(timer);\n\n\t\t\t\t\tif (_this6.closed) {\n\t\t\t\t\t\tlogger.error('request failed [method:%s]: Room closed', method);\n\n\t\t\t\t\t\treject(new Error('Room closed'));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Make sure message is an Error.\n\t\t\t\t\tif (!(error instanceof Error)) error = new Error(String(error));\n\n\t\t\t\t\tlogger.error('request failed [method:%s]:%o', method, error);\n\n\t\t\t\t\treject(error);\n\t\t\t\t};\n\n\t\t\t\t_this6.safeEmit('request', request, callback, errback);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_sendNotification',\n\t\tvalue: function _sendNotification(method, data) {\n\t\t\t// Ignore if closed.\n\t\t\tif (this.closed) return;\n\n\t\t\tvar notification = (0, _assign2.default)({ method: method, target: 'peer', notification: true }, data);\n\n\t\t\tlogger.debug('_sendNotification() [method:%s, notification:%o]', method, notification);\n\n\t\t\tthis.safeEmit('notify', notification);\n\t\t}\n\t}, {\n\t\tkey: '_handlePeerData',\n\t\tvalue: function _handlePeerData(peerData) {\n\t\t\tvar _this7 = this;\n\n\t\t\tvar name = peerData.name,\n\t\t\t    consumers = peerData.consumers,\n\t\t\t    appData = peerData.appData;\n\n\t\t\tvar peer = new _Peer2.default(name, appData);\n\n\t\t\t// Store it.\n\t\t\tthis._peers.set(peer.name, peer);\n\n\t\t\tpeer.on('@close', function () {\n\t\t\t\t_this7._peers.delete(peer.name);\n\t\t\t});\n\n\t\t\t// Add consumers.\n\t\t\tvar _iteratorNormalCompletion9 = true;\n\t\t\tvar _didIteratorError9 = false;\n\t\t\tvar _iteratorError9 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator9 = (0, _getIterator3.default)(consumers), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {\n\t\t\t\t\tvar consumerData = _step9.value;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis._handleConsumerData(consumerData, peer);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tlogger.error('error handling existing Consumer in Peer:%o', error);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If already joined emit event.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError9 = true;\n\t\t\t\t_iteratorError9 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion9 && _iterator9.return) {\n\t\t\t\t\t\t_iterator9.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError9) {\n\t\t\t\t\t\tthrow _iteratorError9;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.joined) this.safeEmit('newpeer', peer);\n\t\t}\n\t}, {\n\t\tkey: '_handleConsumerData',\n\t\tvalue: function _handleConsumerData(producerData, peer) {\n\t\t\tvar id = producerData.id,\n\t\t\t    kind = producerData.kind,\n\t\t\t    rtpParameters = producerData.rtpParameters,\n\t\t\t    paused = producerData.paused,\n\t\t\t    appData = producerData.appData;\n\n\t\t\tvar consumer = new _Consumer2.default(id, kind, rtpParameters, peer, appData);\n\t\t\tvar supported = ortc.canReceive(consumer.rtpParameters, this._extendedRtpCapabilities);\n\n\t\t\tif (supported) consumer.setSupported(true);\n\n\t\t\tif (paused) consumer.remotePause();\n\n\t\t\tpeer.addConsumer(consumer);\n\t\t}\n\t}, {\n\t\tkey: 'joined',\n\t\tget: function get() {\n\t\t\treturn this._state === RoomState.joined;\n\t\t}\n\n\t\t/**\n   * Whether the Room is closed.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'closed',\n\t\tget: function get() {\n\t\t\treturn this._state === RoomState.closed;\n\t\t}\n\n\t\t/**\n   * My mediasoup Peer name.\n   *\n   * @return {String}\n   */\n\n\t}, {\n\t\tkey: 'peerName',\n\t\tget: function get() {\n\t\t\treturn this._peerName;\n\t\t}\n\n\t\t/**\n   * The list of Transports.\n   *\n   * @return {Array<Transport>}\n   */\n\n\t}, {\n\t\tkey: 'transports',\n\t\tget: function get() {\n\t\t\treturn (0, _from2.default)(this._transports.values());\n\t\t}\n\n\t\t/**\n   * The list of Producers.\n   *\n   * @return {Array<Producer>}\n   */\n\n\t}, {\n\t\tkey: 'producers',\n\t\tget: function get() {\n\t\t\treturn (0, _from2.default)(this._producers.values());\n\t\t}\n\n\t\t/**\n   * The list of Peers.\n   *\n   * @return {Array<Peer>}\n   */\n\n\t}, {\n\t\tkey: 'peers',\n\t\tget: function get() {\n\t\t\treturn (0, _from2.default)(this._peers.values());\n\t\t}\n\t}]);\n\treturn Room;\n}(_EnhancedEventEmitter3.default);\n\nexports.default = Room;\n\n/***/ }),\n\n/***/ \"./lib/mslib/Transport.js\":\n/*!********************************!*\\\n  !*** ./lib/mslib/Transport.js ***!\n  \\********************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _Logger = __webpack_require__(/*! ./Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ./EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _errors = __webpack_require__(/*! ./errors */ \"./lib/mslib/errors.js\");\n\nvar _utils = __webpack_require__(/*! ./utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _Device = __webpack_require__(/*! ./Device */ \"./lib/mslib/Device.js\");\n\nvar _Device2 = _interopRequireDefault(_Device);\n\nvar _CommandQueue = __webpack_require__(/*! ./CommandQueue */ \"./lib/mslib/CommandQueue.js\");\n\nvar _CommandQueue2 = _interopRequireDefault(_CommandQueue);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar DEFAULT_STATS_INTERVAL = 1000;\n\nvar logger = new _Logger2.default('<Transport>');\n\nvar Transport = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Transport, _EnhancedEventEmitter);\n\n\t/**\n  * @private\n  *\n  * @emits {state: String} connectionstatechange\n  * @emits {stats: Object} stats\n  * @emits {originator: String, [appData]: Any} close\n  *\n  * @emits {method: String, [data]: Object, callback: Function, errback: Function} @request\n  * @emits {method: String, [data]: Object} @notify\n  * @emits @close\n  */\n\tfunction Transport(direction, extendedRtpCapabilities, settings, appData) {\n\t\t(0, _classCallCheck3.default)(this, Transport);\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Transport.__proto__ || (0, _getPrototypeOf2.default)(Transport)).call(this, logger));\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\t// Id.\n\t\t// @type {Number}\n\t\t_this._id = utils.randomNumber();\n\n\t\t// Closed flag.\n\t\t// @type {Boolean}\n\t\t_this._closed = false;\n\n\t\t// Direction.\n\t\t// @type {String}\n\t\t_this._direction = direction;\n\n\t\t// Room settings.\n\t\t// @type {Object}\n\t\t_this._settings = settings;\n\n\t\t// App custom data.\n\t\t// @type {Any}\n\t\t_this._appData = appData;\n\n\t\t// Periodic stats flag.\n\t\t// @type {Boolean}\n\t\t_this._statsEnabled = false;\n\n\t\t// Commands handler.\n\t\t// @type {CommandQueue}\n\t\t_this._commandQueue = new _CommandQueue2.default();\n\n\t\t// Device specific handler.\n\t\t_this._handler = new _Device2.default.Handler(direction, extendedRtpCapabilities, settings);\n\n\t\t// Transport state. Values can be:\n\t\t// 'new'/'connecting'/'connected'/'failed'/'disconnected'/'closed'\n\t\t// @type {String}\n\t\t_this._connectionState = 'new';\n\n\t\t// Distinct audio and video kind for sending meidaStream(consists of audio and video) convenience.\n\t\t// @type {Boolean}\n\t\t_this._audioSent = false; // is sent of this transport by audio track.\n\n\t\t// @type {Boolean}\n\t\t_this._videoSent = false; // is sent of this transport by video track.\n\n\t\t_this._commandQueue.on('exec', _this._execCommand.bind(_this));\n\n\t\t_this._handleHandler();\n\t\treturn _this;\n\t}\n\n\t/**\n  * Transport id.\n  *\n  * @return {Number}\n  */\n\n\n\t(0, _createClass3.default)(Transport, [{\n\t\tkey: 'close',\n\n\n\t\t/**\n   * Close the Transport.\n   *\n   * @param {Any} [appData] - App custom data.\n   */\n\t\tvalue: function close(appData) {\n\t\t\tlogger.debug('close()');\n\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._closed = true;\n\n\t\t\tthis._audioSent = false;\n\t\t\tthis._videoSent = false;\n\n\t\t\tif (this._statsEnabled) {\n\t\t\t\tthis._statsEnabled = false;\n\t\t\t\tthis.disableStats();\n\t\t\t}\n\n\t\t\tthis.safeEmit('@notify', 'closeTransport', { id: this._id, appData: appData });\n\n\t\t\tthis.emit('@close');\n\t\t\tthis.safeEmit('close', 'local', appData);\n\n\t\t\tthis._destroy();\n\t\t}\n\n\t\t/**\n   * My remote Transport was closed.\n   * Invoked via remote notification.\n   *\n   * @private\n   *\n   * @param {Any} [appData] - App custom data.\n   * @param {Object} destroy - Whether the local transport must be destroyed.\n   */\n\n\t}, {\n\t\tkey: 'remoteClose',\n\t\tvalue: function remoteClose(appData, _ref) {\n\t\t\tvar destroy = _ref.destroy;\n\n\t\t\tlogger.debug('remoteClose() [destroy:%s]', destroy);\n\n\t\t\tif (this._closed) return;\n\n\t\t\tif (!destroy) {\n\t\t\t\tthis._handler.remoteClosed();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._closed = true;\n\t\t\tthis._audioSent = false;\n\t\t\tthis._videoSent = false;\n\n\t\t\tthis.emit('@close');\n\t\t\tthis.safeEmit('close', 'remote', appData);\n\n\t\t\tthis._destroy();\n\t\t}\n\t}, {\n\t\tkey: '_destroy',\n\t\tvalue: function _destroy() {\n\t\t\t// Close the CommandQueue.\n\t\t\tthis._commandQueue.close();\n\n\t\t\t// Close the handler.\n\t\t\tthis._handler.close();\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(callback, errback) {\n\t\t\tvar _this2 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\tif (this._closed) return;else if (this._connectionState === 'new') return;\n\n\t\t\t_promise2.default.resolve().then(function () {\n\t\t\t\tvar data = {\n\t\t\t\t\tid: _this2._id\n\t\t\t\t};\n\n\t\t\t\treturn _this2.safeEmitAsPromise('@request', 'restartTransport', data);\n\t\t\t}).then(function (response) {\n\t\t\t\tvar remoteIceParameters = response.iceParameters;\n\n\t\t\t\t// Enqueue command.\n\t\t\t\treturn _this2._commandQueue.push('restartIce', { remoteIceParameters: remoteIceParameters });\n\t\t\t}).catch(function (error) {\n\t\t\t\tif (errback) {\n\t\t\t\t\terrback(error);\n\t\t\t\t}\n\n\t\t\t\tlogger.error('restartIce() | failed: %o', error);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'enableStats',\n\t\tvalue: function enableStats() {\n\t\t\tvar interval = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_STATS_INTERVAL;\n\n\t\t\tlogger.debug('enableStats() [interval:%s]', interval);\n\n\t\t\tif (typeof interval !== 'number' || interval < 1000) interval = DEFAULT_STATS_INTERVAL;\n\n\t\t\tthis._statsEnabled = true;\n\n\t\t\tvar data = {\n\t\t\t\tid: this._id,\n\t\t\t\tinterval: interval\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'enableTransportStats', data);\n\t\t}\n\t}, {\n\t\tkey: 'disableStats',\n\t\tvalue: function disableStats() {\n\t\t\tlogger.debug('disableStats()');\n\n\t\t\tthis._statsEnabled = false;\n\n\t\t\tvar data = {\n\t\t\t\tid: this._id\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'disableTransportStats', data);\n\t\t}\n\t}, {\n\t\tkey: '_handleHandler',\n\t\tvalue: function _handleHandler() {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar handler = this._handler;\n\n\t\t\thandler.on('@connectionstatechange', function (state) {\n\t\t\t\tif (_this3._connectionState === state) return;\n\n\t\t\t\tlogger.debug('Transport connection state changed to %s', state);\n\n\t\t\t\t_this3._connectionState = state;\n\n\t\t\t\tif (!_this3._closed) _this3.safeEmit('connectionstatechange', state);\n\t\t\t});\n\n\t\t\thandler.on('@needcreatetransport', function (transportLocalParameters, callback, errback) {\n\t\t\t\tvar data = {\n\t\t\t\t\tid: _this3._id,\n\t\t\t\t\tdirection: _this3._direction,\n\t\t\t\t\toptions: _this3._settings.transportOptions,\n\t\t\t\t\tappData: _this3._appData\n\t\t\t\t};\n\n\t\t\t\tif (transportLocalParameters) {\n\t\t\t\t\tif (transportLocalParameters.dtlsParameters) data.dtlsParameters = transportLocalParameters.dtlsParameters;else if (transportLocalParameters.plainRtpParameters) data.plainRtpParameters = transportLocalParameters.plainRtpParameters;\n\t\t\t\t}\n\n\t\t\t\t_this3.safeEmit('@request', 'createTransport', data, callback, errback);\n\t\t\t});\n\n\t\t\thandler.on('@needupdatetransport', function (transportLocalParameters) {\n\t\t\t\tvar data = {\n\t\t\t\t\tid: _this3._id\n\t\t\t\t};\n\n\t\t\t\tif (transportLocalParameters) {\n\t\t\t\t\tif (transportLocalParameters.dtlsParameters) data.dtlsParameters = transportLocalParameters.dtlsParameters;else if (transportLocalParameters.plainRtpParameters) data.plainRtpParameters = transportLocalParameters.plainRtpParameters;\n\t\t\t\t}\n\n\t\t\t\t_this3.safeEmit('@notify', 'updateTransport', data);\n\t\t\t});\n\n\t\t\thandler.on('@needupdateproducer', function (producer, rtpParameters) {\n\t\t\t\tvar data = {\n\t\t\t\t\tid: producer.id,\n\t\t\t\t\trtpParameters: rtpParameters\n\t\t\t\t};\n\n\t\t\t\t// Update Producer RTP parameters.\n\t\t\t\tproducer.setRtpParameters(rtpParameters);\n\n\t\t\t\t// Notify the server.\n\t\t\t\t_this3.safeEmit('@notify', 'updateProducer', data);\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Send the given Producer over this Transport.\n   *\n   * @private\n   *\n   * @param {Producer} producer\n   *\n   * @return {Promise}\n   */\n\n\t}, {\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tlogger.debug('addProducer() [producer:%o]', producer);\n\n\t\t\tif (this._closed) return _promise2.default.reject(new _errors.InvalidStateError('Transport closed'));else if (this._direction !== 'send') return _promise2.default.reject(new Error('not a sending Transport'));\n\n\t\t\t// Enqueue command.\n\t\t\treturn this._commandQueue.push('addProducer', { producer: producer });\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer, originator, appData) {\n\t\t\tlogger.debug('removeProducer() [producer:%o]', producer);\n\n\t\t\t// Enqueue command.\n\t\t\tif (!this._closed) {\n\t\t\t\tthis._commandQueue.push('removeProducer', { producer: producer }).catch(function () {});\n\t\t\t}\n\n\t\t\tif (originator === 'local') this.safeEmit('@notify', 'closeProducer', { id: producer.id, appData: appData });\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'pauseProducer',\n\t\tvalue: function pauseProducer(producer, appData) {\n\t\t\tlogger.debug('pauseProducer() [producer:%o]', producer);\n\n\t\t\tvar data = {\n\t\t\t\tid: producer.id,\n\t\t\t\tappData: appData\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'pauseProducer', data);\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'resumeProducer',\n\t\tvalue: function resumeProducer(producer, appData) {\n\t\t\tlogger.debug('resumeProducer() [producer:%o]', producer);\n\n\t\t\tvar data = {\n\t\t\t\tid: producer.id,\n\t\t\t\tappData: appData\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'resumeProducer', data);\n\t\t}\n\n\t\t/**\n   * @private\n   *\n   * @return {Promise}\n   */\n\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tlogger.debug('replaceProducerTrack() [producer:%o]', producer);\n\n\t\t\treturn this._commandQueue.push('replaceProducerTrack', { producer: producer, track: track });\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'enableProducerStats',\n\t\tvalue: function enableProducerStats(producer, interval) {\n\t\t\tlogger.debug('enableProducerStats() [producer:%o]', producer);\n\n\t\t\tvar data = {\n\t\t\t\tid: producer.id,\n\t\t\t\tinterval: interval\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'enableProducerStats', data);\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'disableProducerStats',\n\t\tvalue: function disableProducerStats(producer) {\n\t\t\tlogger.debug('disableProducerStats() [producer:%o]', producer);\n\n\t\t\tvar data = {\n\t\t\t\tid: producer.id\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'disableProducerStats', data);\n\t\t}\n\n\t\t/**\n   * Receive the given Consumer over this Transport.\n   *\n   * @private\n   *\n   * @param {Consumer} consumer\n   *\n   * @return {Promise} Resolves to a remote MediaStreamTrack.\n   */\n\n\t}, {\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tlogger.debug('addConsumer() [consumer:%o]', consumer);\n\n\t\t\tif (this._closed) return _promise2.default.reject(new _errors.InvalidStateError('Transport closed'));else if (this._direction !== 'recv') return _promise2.default.reject(new Error('not a receiving Transport'));\n\n\t\t\t// Enqueue command.\n\t\t\treturn this._commandQueue.push('addConsumer', { consumer: consumer });\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tlogger.debug('removeConsumer() [consumer:%o]', consumer);\n\n\t\t\t// Enqueue command.\n\t\t\tthis._commandQueue.push('removeConsumer', { consumer: consumer }).catch(function () {});\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'pauseConsumer',\n\t\tvalue: function pauseConsumer(consumer, appData) {\n\t\t\tlogger.debug('pauseConsumer() [consumer:%o]', consumer);\n\n\t\t\tvar data = {\n\t\t\t\tid: consumer.id,\n\t\t\t\tappData: appData\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'pauseConsumer', data);\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'resumeConsumer',\n\t\tvalue: function resumeConsumer(consumer, appData) {\n\t\t\tlogger.debug('resumeConsumer() [consumer:%o]', consumer);\n\n\t\t\tvar data = {\n\t\t\t\tid: consumer.id,\n\t\t\t\tappData: appData\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'resumeConsumer', data);\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'setConsumerPreferredProfile',\n\t\tvalue: function setConsumerPreferredProfile(consumer, profile) {\n\t\t\tlogger.debug('setConsumerPreferredProfile() [consumer:%o]', consumer);\n\n\t\t\tvar data = {\n\t\t\t\tid: consumer.id,\n\t\t\t\tprofile: profile\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'setConsumerPreferredProfile', data);\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'enableConsumerStats',\n\t\tvalue: function enableConsumerStats(consumer, interval) {\n\t\t\tlogger.debug('enableConsumerStats() [consumer:%o]', consumer);\n\n\t\t\tvar data = {\n\t\t\t\tid: consumer.id,\n\t\t\t\tinterval: interval\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'enableConsumerStats', data);\n\t\t}\n\n\t\t/**\n   * @private\n   */\n\n\t}, {\n\t\tkey: 'disableConsumerStats',\n\t\tvalue: function disableConsumerStats(consumer) {\n\t\t\tlogger.debug('disableConsumerStats() [consumer:%o]', consumer);\n\n\t\t\tvar data = {\n\t\t\t\tid: consumer.id\n\t\t\t};\n\n\t\t\tthis.safeEmit('@notify', 'disableConsumerStats', data);\n\t\t}\n\n\t\t/**\n   * Receive remote stats.\n   *\n   * @private\n   *\n   * @param {Object} stats\n   */\n\n\t}, {\n\t\tkey: 'remoteStats',\n\t\tvalue: function remoteStats(stats) {\n\t\t\tthis.safeEmit('stats', stats);\n\t\t}\n\n\t\t/**\n   * Get handler stats.\n   *\n   * @public\n   *\n   * @param {Object} selector\n   */\n\n\t}, {\n\t\tkey: 'getStats',\n\t\tvalue: function getStats(selector) {\n\t\t\treturn this._handler.getPCStats(selector);\n\t\t}\n\t}, {\n\t\tkey: 'removeTrack',\n\t\tvalue: function removeTrack(track) {\n\t\t\treturn this._handler.removeTrack(track);\n\t\t}\n\t}, {\n\t\tkey: 'audioSent',\n\t\tvalue: function audioSent() {\n\t\t\treturn this._audioSent;\n\t\t}\n\t}, {\n\t\tkey: 'videoSent',\n\t\tvalue: function videoSent() {\n\t\t\treturn this._videoSent;\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\treturn this._handler.updateTrack(producer, track);\n\t\t}\n\t}, {\n\t\tkey: '_execCommand',\n\t\tvalue: function _execCommand(command, promiseHolder) {\n\t\t\tvar promise = void 0;\n\n\t\t\ttry {\n\t\t\t\tswitch (command.method) {\n\t\t\t\t\tcase 'addProducer':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar producer = command.producer;\n\n\n\t\t\t\t\t\t\tpromise = this._execAddProducer(producer);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'removeProducer':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _producer = command.producer;\n\n\n\t\t\t\t\t\t\tpromise = this._execRemoveProducer(_producer);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'replaceProducerTrack':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _producer2 = command.producer,\n\t\t\t\t\t\t\t    track = command.track;\n\n\n\t\t\t\t\t\t\tpromise = this._execReplaceProducerTrack(_producer2, track);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'addConsumer':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar consumer = command.consumer;\n\n\n\t\t\t\t\t\t\tpromise = this._execAddConsumer(consumer);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'removeConsumer':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar _consumer = command.consumer;\n\n\n\t\t\t\t\t\t\tpromise = this._execRemoveConsumer(_consumer);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcase 'restartIce':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar remoteIceParameters = command.remoteIceParameters;\n\n\n\t\t\t\t\t\t\tpromise = this._execRestartIce(remoteIceParameters);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpromise = _promise2.default.reject(new Error('unknown command method \"' + command.method + '\"'));\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tpromise = _promise2.default.reject(error);\n\t\t\t}\n\n\t\t\t// Fill the given Promise holder.\n\t\t\tpromiseHolder.promise = promise;\n\t\t}\n\t}, {\n\t\tkey: '_execAddProducer',\n\t\tvalue: function _execAddProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tlogger.debug('_execAddProducer()');\n\n\t\t\tvar producerRtpParameters = void 0;\n\n\t\t\t// Call the handler.\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this4._handler.addProducer(producer);\n\t\t\t}).then(function (rtpParameters) {\n\t\t\t\tproducerRtpParameters = rtpParameters;\n\n\t\t\t\tvar data = {\n\t\t\t\t\tid: producer.id,\n\t\t\t\t\tkind: producer.kind,\n\t\t\t\t\ttransportId: _this4._id,\n\t\t\t\t\trtpParameters: rtpParameters,\n\t\t\t\t\tpaused: producer.locallyPaused,\n\t\t\t\t\tappData: producer.appData\n\t\t\t\t};\n\n\t\t\t\treturn _this4.safeEmitAsPromise('@request', 'createProducer', data);\n\t\t\t}).then(function () {\n\t\t\t\tproducer.setRtpParameters(producerRtpParameters);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_execRemoveProducer',\n\t\tvalue: function _execRemoveProducer(producer) {\n\t\t\tlogger.debug('_execRemoveProducer()');\n\n\t\t\t// Call the handler.\n\t\t\treturn this._handler.removeProducer(producer);\n\t\t}\n\t}, {\n\t\tkey: '_execReplaceProducerTrack',\n\t\tvalue: function _execReplaceProducerTrack(producer, track) {\n\t\t\tlogger.debug('_execReplaceProducerTrack()');\n\n\t\t\t// Call the handler.\n\t\t\treturn this._handler.replaceProducerTrack(producer, track);\n\t\t}\n\t}, {\n\t\tkey: '_execAddConsumer',\n\t\tvalue: function _execAddConsumer(consumer) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('_execAddConsumer()');\n\n\t\t\tvar consumerTrack = void 0;\n\n\t\t\t// Call the handler.\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this5._handler.addConsumer(consumer);\n\t\t\t}).then(function (track) {\n\t\t\t\tconsumerTrack = track;\n\n\t\t\t\tvar data = {\n\t\t\t\t\tid: consumer.id,\n\t\t\t\t\ttransportId: _this5.id,\n\t\t\t\t\tpaused: consumer.locallyPaused,\n\t\t\t\t\tpreferredProfile: consumer.preferredProfile\n\t\t\t\t};\n\n\t\t\t\treturn _this5.safeEmitAsPromise('@request', 'enableConsumer', data);\n\t\t\t}).then(function (response) {\n\t\t\t\tvar paused = response.paused,\n\t\t\t\t    preferredProfile = response.preferredProfile,\n\t\t\t\t    effectiveProfile = response.effectiveProfile;\n\n\n\t\t\t\tif (paused) consumer.remotePause();\n\n\t\t\t\tif (preferredProfile) consumer.remoteSetPreferredProfile(preferredProfile);\n\n\t\t\t\tif (effectiveProfile) consumer.remoteEffectiveProfileChanged(effectiveProfile);\n\n\t\t\t\treturn consumerTrack;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_execRemoveConsumer',\n\t\tvalue: function _execRemoveConsumer(consumer) {\n\t\t\tlogger.debug('_execRemoveConsumer()');\n\n\t\t\t// Call the handler.\n\t\t\treturn this._handler.removeConsumer(consumer);\n\t\t}\n\t}, {\n\t\tkey: '_execRestartIce',\n\t\tvalue: function _execRestartIce(remoteIceParameters) {\n\t\t\tlogger.debug('_execRestartIce()');\n\n\t\t\t// Call the handler.\n\t\t\treturn this._handler.restartIce(remoteIceParameters);\n\t\t}\n\t}, {\n\t\tkey: 'id',\n\t\tget: function get() {\n\t\t\treturn this._id;\n\t\t}\n\n\t\t/**\n   * Whether the Transport is closed.\n   *\n   * @return {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'closed',\n\t\tget: function get() {\n\t\t\treturn this._closed;\n\t\t}\n\n\t\t/**\n   * Transport direction.\n   *\n   * @return {String}\n   */\n\n\t}, {\n\t\tkey: 'direction',\n\t\tget: function get() {\n\t\t\treturn this._direction;\n\t\t}\n\n\t\t/**\n   * App custom data.\n   *\n   * @return {Any}\n   */\n\n\t}, {\n\t\tkey: 'appData',\n\t\tget: function get() {\n\t\t\treturn this._appData;\n\t\t}\n\n\t\t/**\n   * Connection state.\n   *\n   * @return {String}\n   */\n\n\t}, {\n\t\tkey: 'connectionState',\n\t\tget: function get() {\n\t\t\treturn this._connectionState;\n\t\t}\n\n\t\t/**\n   * Device handler.\n   *\n   * @return {Handler}\n   */\n\n\t}, {\n\t\tkey: 'handler',\n\t\tget: function get() {\n\t\t\treturn this._handler;\n\t\t}\n\t}]);\n\treturn Transport;\n}(_EnhancedEventEmitter3.default);\n\nexports.default = Transport;\n\n/***/ }),\n\n/***/ \"./lib/mslib/errors.js\":\n/*!*****************************!*\\\n  !*** ./lib/mslib/errors.js ***!\n  \\*****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.UnsupportedError = exports.TimeoutError = exports.InvalidStateError = undefined;\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Error produced when calling a method in an invalid state.\n */\nvar InvalidStateError = exports.InvalidStateError = function (_Error) {\n\t(0, _inherits3.default)(InvalidStateError, _Error);\n\n\tfunction InvalidStateError(message) {\n\t\t(0, _classCallCheck3.default)(this, InvalidStateError);\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (InvalidStateError.__proto__ || (0, _getPrototypeOf2.default)(InvalidStateError)).call(this, message));\n\n\t\t_this.name = 'InvalidStateError';\n\n\t\tif (Error.hasOwnProperty('captureStackTrace')) // Just in V8.\n\t\t\tError.captureStackTrace(_this, InvalidStateError);else _this.stack = new Error(message).stack;\n\t\treturn _this;\n\t}\n\n\treturn InvalidStateError;\n}(Error);\n\n/**\n * Error produced when a Promise is rejected due to a timeout.\n */\n\n\nvar TimeoutError = exports.TimeoutError = function (_Error2) {\n\t(0, _inherits3.default)(TimeoutError, _Error2);\n\n\tfunction TimeoutError(message) {\n\t\t(0, _classCallCheck3.default)(this, TimeoutError);\n\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (TimeoutError.__proto__ || (0, _getPrototypeOf2.default)(TimeoutError)).call(this, message));\n\n\t\t_this2.name = 'TimeoutError';\n\n\t\tif (Error.hasOwnProperty('captureStackTrace')) // Just in V8.\n\t\t\tError.captureStackTrace(_this2, TimeoutError);else _this2.stack = new Error(message).stack;\n\t\treturn _this2;\n\t}\n\n\treturn TimeoutError;\n}(Error);\n\n/**\n * Error indicating not support for something.\n */\n\n\nvar UnsupportedError = exports.UnsupportedError = function (_Error3) {\n\t(0, _inherits3.default)(UnsupportedError, _Error3);\n\n\tfunction UnsupportedError(message, data) {\n\t\t(0, _classCallCheck3.default)(this, UnsupportedError);\n\n\t\tvar _this3 = (0, _possibleConstructorReturn3.default)(this, (UnsupportedError.__proto__ || (0, _getPrototypeOf2.default)(UnsupportedError)).call(this, message));\n\n\t\t_this3.name = 'UnsupportedError';\n\n\t\tif (Error.hasOwnProperty('captureStackTrace')) // Just in V8.\n\t\t\tError.captureStackTrace(_this3, UnsupportedError);else _this3.stack = new Error(message).stack;\n\n\t\t_this3.data = data;\n\t\treturn _this3;\n\t}\n\n\treturn UnsupportedError;\n}(Error);\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Chrome55.js\":\n/*!****************************************!*\\\n  !*** ./lib/mslib/handlers/Chrome55.js ***!\n  \\****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _planBUtils = __webpack_require__(/*! ./sdp/planBUtils */ \"./lib/mslib/handlers/sdp/planBUtils.js\");\n\nvar sdpPlanBUtils = _interopRequireWildcard(_planBUtils);\n\nvar _RemotePlanBSdp = __webpack_require__(/*! ./sdp/RemotePlanBSdp */ \"./lib/mslib/handlers/sdp/RemotePlanBSdp.js\");\n\nvar _RemotePlanBSdp2 = _interopRequireDefault(_RemotePlanBSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Chrome55');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemotePlanBSdp}\n\t\t_this._remoteSdp = new _RemotePlanBSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Local stream.\n\t\t// @type {MediaStream}\n\t\t_this2._stream = new MediaStream();\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._stream.getTrackById(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\t// \n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Add the track to the local stream.\n\t\t\t\t_this3._stream.addTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\t_this3._pc.addStream(_this3._stream);\n\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = { type: 'offer', sdp: offerSdp };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('addProducer() _rtpParametersByKind: %o - rtpParameters: %o', _this3._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\t// Fill the RTP parameters for this track.\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\t_this3._stream.removeTrack(track);\n\t\t\t\t_this3._pc.addStream(_this3._stream);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\t// \n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Remove the track from the local stream.\n\t\t\t\t_this4._stream.removeTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\t_this4._pc.addStream(_this4._stream);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).catch(function (error) {\n\t\t\t\t// NOTE: If there are no sending tracks, setLocalDescription() will fail with\n\t\t\t\t// \"Failed to create channels\". If so, ignore it.\n\t\t\t\tif (_this4._stream.getTracks().length === 0) {\n\t\t\t\t\tlogger.warn('removeProducer() | ignoring expected error due no sending tracks: %s', error.toString());\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t}).then(function () {\n\t\t\t\tif (_this4._pc.signalingState === 'stable') return;\n\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\t// \n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tvar oldTrack = producer.track;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Remove the old track from the local stream.\n\t\t\t\t_this5._stream.removeTrack(oldTrack);\n\n\t\t\t\t// Add the new track to the local stream.\n\t\t\t\t_this5._stream.addTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\t_this5._pc.addStream(_this5._stream);\n\n\t\t\t\treturn _this5._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = { type: 'offer', sdp: offerSdp };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this5._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this5._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this5._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this5._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this5._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('replaceProducerTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this5._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\t// Fill the RTP parameters for the new track.\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\t// We need to provide new RTP parameters.\n\t\t\t\t_this5.safeEmit('@needupdateproducer', producer, rtpParameters);\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\t_this5._stream.removeTrack(track);\n\t\t\t\t_this5._stream.addTrack(oldTrack);\n\t\t\t\t_this5._pc.addStream(_this5._stream);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of revc', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\t// \n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\t\t\t\t\t/*\n     sdpPlanBUtils.addPlanBSimulcast(sdpObject, track, {\n         mid: transceiver.mid\n     });\n     */\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('updateTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this8._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\t\t\t\t/*\n    sdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n        mid: transceiver.mid,\n        planBSimulcast: true\n    });\n    */\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Seen media kinds.\n\t\t// @type {Set<String>}\n\t\t_this9._kinds = new _set2.default();\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - kind {String}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\t\t\tthis._kinds.add(consumer.kind);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._kinds), (0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar stream = _this10._pc.getRemoteStreams().find(function (s) {\n\t\t\t\t\treturn s.id === consumerInfo.streamId;\n\t\t\t\t});\n\t\t\t\tvar track = stream.getTrackById(consumerInfo.trackId);\n\n\t\t\t\tif (!track) throw new Error('remote track not found');\n\n\t\t\t\treturn track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (!this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tthis._consumerInfos.delete(consumer.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._kinds), (0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._kinds), (0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of revc', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Chrome55 = function () {\n\t(0, _createClass3.default)(Chrome55, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require'\n\t\t\t});\n\n\t\t\treturn pc.createOffer({\n\t\t\t\tofferToReceiveAudio: true,\n\t\t\t\tofferToReceiveVideo: true\n\t\t\t}).then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Chrome55';\n\t\t}\n\t}]);\n\n\tfunction Chrome55(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Chrome55);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Chrome55;\n}();\n\nexports.default = Chrome55;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Chrome67.js\":\n/*!****************************************!*\\\n  !*** ./lib/mslib/handlers/Chrome67.js ***!\n  \\****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _planBUtils = __webpack_require__(/*! ./sdp/planBUtils */ \"./lib/mslib/handlers/sdp/planBUtils.js\");\n\nvar sdpPlanBUtils = _interopRequireWildcard(_planBUtils);\n\nvar _RemotePlanBSdp = __webpack_require__(/*! ./sdp/RemotePlanBSdp */ \"./lib/mslib/handlers/sdp/RemotePlanBSdp.js\");\n\nvar _RemotePlanBSdp2 = _interopRequireDefault(_RemotePlanBSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Chrome67');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require',\n\t\t\tsdpSemantics: 'plan-b'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemotePlanBSdp}\n\t\t_this._remoteSdp = new _RemotePlanBSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Local stream.\n\t\t// @type {MediaStream}\n\t\t_this2._stream = new MediaStream();\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._stream.getTrackById(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\t// \n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Add the track to the local stream.\n\t\t\t\t_this3._stream.addTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\t_this3._pc.addStream(_this3._stream);\n\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = { type: 'offer', sdp: offerSdp };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('addProducer() _rtpParametersByKind: %o - rtpParameters: %o', _this3._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\t// Fill the RTP parameters for this track.\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\t_this3._stream.removeTrack(track);\n\t\t\t\t_this3._pc.addStream(_this3._stream);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\t// \n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Remove the track from the local stream.\n\t\t\t\t_this4._stream.removeTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\t_this4._pc.addStream(_this4._stream);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).catch(function (error) {\n\t\t\t\t// NOTE: If there are no sending tracks, setLocalDescription() will fail with\n\t\t\t\t// \"Failed to create channels\". If so, ignore it.\n\t\t\t\tif (_this4._stream.getTracks().length === 0) {\n\t\t\t\t\tlogger.warn('removeProducer() | ignoring expected error due no sending tracks: %s', error.toString());\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t}).then(function () {\n\t\t\t\tif (_this4._pc.signalingState === 'stable') return;\n\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar oldTrack = producer.track;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this5._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === oldTrack;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\treturn rtpSender.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t// Remove the old track from the local stream.\n\t\t\t\t_this5._stream.removeTrack(oldTrack);\n\n\t\t\t\t// Add the new track to the local stream.\n\t\t\t\t_this5._stream.addTrack(track);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of revc', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\t// \n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\t\t\t\t\t/*\n     sdpPlanBUtils.addPlanBSimulcast(sdpObject, track, {\n         mid: transceiver.mid\n     });\n     */\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('updateTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this8._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\t/*\n    sdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n        mid: transceiver.mid,\n        planBSimulcast: true\n    });\n    */\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Seen media kinds.\n\t\t// @type {Set<String>}\n\t\t_this9._kinds = new _set2.default();\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - kind {String}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\t\t\tthis._kinds.add(consumer.kind);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._kinds), (0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar stream = _this10._pc.getRemoteStreams().find(function (s) {\n\t\t\t\t\treturn s.id === consumerInfo.streamId;\n\t\t\t\t});\n\t\t\t\tvar track = stream.getTrackById(consumerInfo.trackId);\n\n\t\t\t\tif (!track) throw new Error('remote track not found');\n\n\t\t\t\treturn track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (!this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tthis._consumerInfos.delete(consumer.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._kinds), (0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._kinds), (0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of revc', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Chrome67 = function () {\n\t(0, _createClass3.default)(Chrome67, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require',\n\t\t\t\tsdpSemantics: 'plan-b'\n\t\t\t});\n\n\t\t\treturn pc.createOffer({\n\t\t\t\tofferToReceiveAudio: true,\n\t\t\t\tofferToReceiveVideo: true\n\t\t\t}).then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Chrome67';\n\t\t}\n\t}]);\n\n\tfunction Chrome67(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Chrome67);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Chrome67;\n}();\n\nexports.default = Chrome67;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Chrome69.js\":\n/*!****************************************!*\\\n  !*** ./lib/mslib/handlers/Chrome69.js ***!\n  \\****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _planBUtils = __webpack_require__(/*! ./sdp/planBUtils */ \"./lib/mslib/handlers/sdp/planBUtils.js\");\n\nvar sdpPlanBUtils = _interopRequireWildcard(_planBUtils);\n\nvar _RemotePlanBSdp = __webpack_require__(/*! ./sdp/RemotePlanBSdp */ \"./lib/mslib/handlers/sdp/RemotePlanBSdp.js\");\n\nvar _RemotePlanBSdp2 = _interopRequireDefault(_RemotePlanBSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Chrome69');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require',\n\t\t\tsdpSemantics: 'plan-b'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemotePlanBSdp}\n\t\t_this._remoteSdp = new _RemotePlanBSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Local stream.\n\t\t// @type {MediaStream}\n\t\t_this2._stream = new MediaStream();\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._stream.getTrackById(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tvar rtpSender = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Add the track to the local stream.\n\t\t\t\t_this3._stream.addTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\trtpSender = _this3._pc.addTrack(track, _this3._stream);\n\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = { type: 'offer', sdp: offerSdp };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('addProducer() _rtpParametersByKind: %o - rtpParameters: %o', _this3._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\t// Fill the RTP parameters for this track.\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\ttry {\n\t\t\t\t\t_this3._pc.removeTrack(rtpSender);\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\t_this3._stream.removeTrack(track);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this4._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === track;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('RTCRtpSender not found');\n\n\t\t\t\t// Remove the associated RtpSender.\n\t\t\t\t_this4._pc.removeTrack(rtpSender);\n\n\t\t\t\t// Remove the track from the local stream.\n\t\t\t\t_this4._stream.removeTrack(track);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).catch(function (error) {\n\t\t\t\t// NOTE: If there are no sending tracks, setLocalDescription() will fail with\n\t\t\t\t// \"Failed to create channels\". If so, ignore it.\n\t\t\t\tif (_this4._stream.getTracks().length === 0) {\n\t\t\t\t\tlogger.warn('removeProducer() | ignoring expected error due no sending tracks: %s', error.toString());\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t}).then(function () {\n\t\t\t\tif (_this4._pc.signalingState === 'stable') return;\n\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar oldTrack = producer.track;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this5._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === oldTrack;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\treturn rtpSender.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t// Remove the old track from the local stream.\n\t\t\t\t_this5._stream.removeTrack(oldTrack);\n\n\t\t\t\t// Add the new track to the local stream.\n\t\t\t\t_this5._stream.addTrack(track);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of revc', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\t\t\t\t\t/*\n     sdpPlanBUtils.addPlanBSimulcast(sdpObject, track, {\n         mid: transceiver.mid\n     });\n     */\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('updateTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this8._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\t\t\t\t/*\n    sdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n        mid: transceiver.mid,\n        planBSimulcast: true\n    });\n    */\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Seen media kinds.\n\t\t// @type {Set<String>}\n\t\t_this9._kinds = new _set2.default();\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - kind {String}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\t\t\tthis._kinds.add(consumer.kind);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._kinds), (0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar newRtpReceiver = _this10._pc.getReceivers().find(function (rtpReceiver) {\n\t\t\t\t\tvar track = rtpReceiver.track;\n\n\n\t\t\t\t\tif (!track) return false;\n\n\t\t\t\t\treturn track.id === consumerInfo.trackId;\n\t\t\t\t});\n\n\t\t\t\tif (!newRtpReceiver) throw new Error('remote track not found');\n\n\t\t\t\treturn newRtpReceiver.track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (!this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tthis._consumerInfos.delete(consumer.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._kinds), (0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._kinds), (0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of revc', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Chrome69 = function () {\n\t(0, _createClass3.default)(Chrome69, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require',\n\t\t\t\tsdpSemantics: 'plan-b'\n\t\t\t});\n\n\t\t\treturn pc.createOffer({\n\t\t\t\tofferToReceiveAudio: true,\n\t\t\t\tofferToReceiveVideo: true\n\t\t\t}).then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Chrome69';\n\t\t}\n\t}]);\n\n\tfunction Chrome69(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Chrome69);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Chrome69;\n}();\n\nexports.default = Chrome69;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Chrome70.js\":\n/*!****************************************!*\\\n  !*** ./lib/mslib/handlers/Chrome70.js ***!\n  \\****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _unifiedPlanUtils = __webpack_require__(/*! ./sdp/unifiedPlanUtils */ \"./lib/mslib/handlers/sdp/unifiedPlanUtils.js\");\n\nvar sdpUnifiedPlanUtils = _interopRequireWildcard(_unifiedPlanUtils);\n\nvar _RemoteUnifiedPlanSdp = __webpack_require__(/*! ./sdp/RemoteUnifiedPlanSdp */ \"./lib/mslib/handlers/sdp/RemoteUnifiedPlanSdp.js\");\n\nvar _RemoteUnifiedPlanSdp2 = _interopRequireDefault(_RemoteUnifiedPlanSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Chrome70');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require',\n\t\t\tsdpSemantics: 'unified-plan'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemoteUnifiedPlanSdp}\n\t\t_this._remoteSdp = new _RemoteUnifiedPlanSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Ids of alive local tracks.\n\t\t// @type {Set<Number>}\n\t\t_this2._trackIds = new _set2.default();\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._trackIds.has(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s] producer.audioProfile: %o', producer.id, producer.kind, track.id, producer.audioProfile);\n\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\t// \n\t\t\tvar transceiver = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\t// Add the track id to the Set.\n\t\t\tthis._trackIds.add(track.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is any inactive transceiver for same kind and\n\t\t\t\t// reuse it if so.\n\t\t\t\ttransceiver = _this3._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind && t.direction === 'inactive';\n\t\t\t\t});\n\n\t\t\t\tif (transceiver) {\n\t\t\t\t\tlogger.debug('addProducer() | reusing an inactive transceiver');\n\n\t\t\t\t\ttransceiver.direction = 'sendonly';\n\n\t\t\t\t\treturn transceiver.sender.replaceTrack(track);\n\t\t\t\t} else {\n\t\t\t\t\ttransceiver = _this3._pc.addTransceiver(track, { direction: 'sendonly' });\n\t\t\t\t}\n\t\t\t}).then(function () {\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpUnifiedPlanUtils.addPlanBSimulcast(sdpObject, track, { mid: transceiver.mid });\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = { type: 'offer', sdp: offerSdp };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tlogger.debug('addProducer() | this._pc.localDescription.sdp: ', localSdpObj);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\t// \n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('addProducer() _rtpParametersByKind: %o - rtpParameters: %o', _this3._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, { mid: transceiver.mid, planBSimulcast: true });\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\ttry {\n\t\t\t\t\ttransceiver.direction = 'inactive';\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\t_this3._trackIds.delete(track.id);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tif (!this._trackIds.has(track.id)) return _promise2.default.reject(new Error('track not found'));\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this4._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === track;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\t_this4._pc.removeTrack(rtpSender);\n\n\t\t\t\t// Remove the track id from the Set.\n\t\t\t\t_this4._trackIds.delete(track.id);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar oldTrack = producer.track;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this5._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === oldTrack;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\treturn rtpSender.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t// Remove the old track id from the Set.\n\t\t\t\t_this5._trackIds.delete(oldTrack.id);\n\n\t\t\t\t// Add the new track id to the Set.\n\t\t\t\t_this5._trackIds.add(track.id);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of send', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpUnifiedPlanUtils.addPlanBSimulcast(sdpObject, track, {\n\t\t\t\t\t\tmid: transceiver.mid\n\t\t\t\t\t});\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('updateTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this8._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n\t\t\t\t\tmid: transceiver.mid,\n\t\t\t\t\tplanBSimulcast: true\n\t\t\t\t});\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - mid {String}\n\t\t// - kind {String}\n\t\t// - closed {Boolean}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tmid: '' + consumer.kind[0] + consumer.id,\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tclosed: consumer.closed,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() kind:%s [offer:%o]', consumer.kind, offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() kind:%s [answer:%o]', consumer.kind, answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar transceiver = _this10._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.mid === consumerInfo.mid;\n\t\t\t\t});\n\n\t\t\t\tif (!transceiver) throw new Error('remote track not found');\n\n\t\t\t\treturn transceiver.receiver.track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tvar consumerInfo = this._consumerInfos.get(consumer.id);\n\n\t\t\tif (!consumerInfo) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tconsumerInfo.closed = true;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of revc', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Chrome70 = function () {\n\t(0, _createClass3.default)(Chrome70, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require',\n\t\t\t\tsdpSemantics: 'unified-plan'\n\t\t\t});\n\n\t\t\tpc.addTransceiver('audio');\n\t\t\tpc.addTransceiver('video');\n\n\t\t\treturn pc.createOffer().then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Chrome70';\n\t\t}\n\t}]);\n\n\tfunction Chrome70(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Chrome70);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Chrome70;\n}();\n\nexports.default = Chrome70;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Edge11.js\":\n/*!**************************************!*\\\n  !*** ./lib/mslib/handlers/Edge11.js ***!\n  \\**************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _edgeUtils = __webpack_require__(/*! ./ortc/edgeUtils */ \"./lib/mslib/handlers/ortc/edgeUtils.js\");\n\nvar edgeUtils = _interopRequireWildcard(_edgeUtils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar CNAME = 'CNAME-EDGE-' + utils.randomNumber(); /* global RTCIceGatherer, RTCIceTransport, RTCDtlsTransport, RTCRtpReceiver, RTCRtpSender */\n\nvar logger = new _Logger2.default('Edge11');\n\nvar Edge11 = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Edge11, _EnhancedEventEmitter);\n\t(0, _createClass3.default)(Edge11, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\treturn _promise2.default.resolve(edgeUtils.getCapabilities());\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Edge11';\n\t\t}\n\t}]);\n\n\tfunction Edge11(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Edge11);\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Edge11.__proto__ || (0, _getPrototypeOf2.default)(Edge11)).call(this, logger));\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = {\n\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t};\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\t_this._transportReady = false;\n\n\t\t// ICE gatherer.\n\t\t_this._iceGatherer = null;\n\n\t\t// ICE transport.\n\t\t_this._iceTransport = null;\n\n\t\t// DTLS transport.\n\t\t// @type {RTCDtlsTransport}\n\t\t_this._dtlsTransport = null;\n\n\t\t// Map of RTCRtpSenders indexed by Producer.id.\n\t\t// @type {Map<Number, RTCRtpSender}\n\t\t_this._rtpSenders = new _map2.default();\n\n\t\t// Map of RTCRtpReceivers indexed by Consumer.id.\n\t\t// @type {Map<Number, RTCRtpReceiver}\n\t\t_this._rtpReceivers = new _map2.default();\n\n\t\t// Remote Transport parameters.\n\t\t// @type {Object}\n\t\t_this._transportRemoteParameters = null;\n\n\t\t_this._setIceGatherer(settings);\n\t\t_this._setIceTransport();\n\t\t_this._setDtlsTransport();\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Edge11, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close the ICE gatherer.\n\t\t\t// NOTE: Not yet implemented by Edge.\n\t\t\ttry {\n\t\t\t\tthis._iceGatherer.close();\n\t\t\t} catch (error) {}\n\n\t\t\t// Close the ICE transport.\n\t\t\ttry {\n\t\t\t\tthis._iceTransport.stop();\n\t\t\t} catch (error) {}\n\n\t\t\t// Close the DTLS transport.\n\t\t\ttry {\n\t\t\t\tthis._dtlsTransport.stop();\n\t\t\t} catch (error) {}\n\n\t\t\t// Close RTCRtpSenders.\n\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\tvar _didIteratorError = false;\n\t\t\tvar _iteratorError = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator = (0, _getIterator3.default)(this._rtpSenders.values()), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\t\tvar rtpSender = _step.value;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\trtpSender.stop();\n\t\t\t\t\t} catch (error) {}\n\t\t\t\t}\n\n\t\t\t\t// Close RTCRtpReceivers.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError = true;\n\t\t\t\t_iteratorError = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\tvar _didIteratorError2 = false;\n\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(this._rtpReceivers.values()), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\tvar rtpReceiver = _step2.value;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\trtpReceiver.stop();\n\t\t\t\t\t} catch (error) {}\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t_iteratorError2 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\t\t}\n\t}, {\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this2 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._rtpSenders.has(producer.id)) return _promise2.default.reject(new Error('Producer already added'));\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this2._transportReady) return _this2._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlogger.debug('addProducer() | calling new RTCRtpSender()');\n\n\t\t\t\tvar rtpSender = new RTCRtpSender(track, _this2._dtlsTransport);\n\t\t\t\tvar rtpParameters = utils.clone(_this2._rtpParametersByKind[producer.kind]);\n\n\t\t\t\t// Fill RTCRtpParameters.encodings.\n\t\t\t\tvar encoding = {\n\t\t\t\t\tssrc: utils.randomNumber()\n\t\t\t\t};\n\n\t\t\t\tif (rtpParameters.codecs.some(function (codec) {\n\t\t\t\t\treturn codec.name === 'rtx';\n\t\t\t\t})) {\n\t\t\t\t\tencoding.rtx = {\n\t\t\t\t\t\tssrc: utils.randomNumber()\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\trtpParameters.encodings.push(encoding);\n\n\t\t\t\t// Fill RTCRtpParameters.rtcp.\n\t\t\t\trtpParameters.rtcp = {\n\t\t\t\t\tcname: CNAME,\n\t\t\t\t\treducedSize: true,\n\t\t\t\t\tmux: true\n\t\t\t\t};\n\n\t\t\t\t// NOTE: Convert our standard RTCRtpParameters into those that Edge\n\t\t\t\t// expects.\n\t\t\t\tvar edgeRtpParameters = edgeUtils.mangleRtpParameters(rtpParameters);\n\n\t\t\t\tlogger.debug('addProducer() | calling rtpSender.send() [params:%o]', edgeRtpParameters);\n\n\t\t\t\trtpSender.send(edgeRtpParameters);\n\n\t\t\t\t// Store it.\n\t\t\t\t_this2._rtpSenders.set(producer.id, rtpSender);\n\n\t\t\t\treturn rtpParameters;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar rtpSender = _this3._rtpSenders.get(producer.id);\n\n\t\t\t\tif (!rtpSender) throw new Error('RTCRtpSender not found');\n\n\t\t\t\t_this3._rtpSenders.delete(producer.id);\n\n\t\t\t\ttry {\n\t\t\t\t\tlogger.debug('removeProducer() | calling rtpSender.stop()');\n\n\t\t\t\t\trtpSender.stop();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.warn('rtpSender.stop() failed:%o', error);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this4 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar rtpSender = _this4._rtpSenders.get(producer.id);\n\n\t\t\t\tif (!rtpSender) throw new Error('RTCRtpSender not found');\n\n\t\t\t\trtpSender.setTrack(track);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._rtpReceivers.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this5._transportReady) return _this5._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlogger.debug('addConsumer() | calling new RTCRtpReceiver()');\n\n\t\t\t\tvar rtpReceiver = new RTCRtpReceiver(_this5._dtlsTransport, consumer.kind);\n\n\t\t\t\trtpReceiver.addEventListener('error', function (event) {\n\t\t\t\t\tlogger.error('iceGatherer \"error\" event [event:%o]', event);\n\t\t\t\t});\n\n\t\t\t\t// NOTE: Convert our standard RTCRtpParameters into those that Edge\n\t\t\t\t// expects.\n\t\t\t\tvar edgeRtpParameters = edgeUtils.mangleRtpParameters(consumer.rtpParameters);\n\n\t\t\t\t// Ignore MID RTP extension for receiving media.\n\t\t\t\tedgeRtpParameters.headerExtensions = edgeRtpParameters.headerExtensions.filter(function (extension) {\n\t\t\t\t\treturn extension.uri !== 'urn:ietf:params:rtp-hdrext:sdes:mid';\n\t\t\t\t});\n\n\t\t\t\tlogger.debug('addConsumer() | calling rtpReceiver.receive() [params:%o]', edgeRtpParameters);\n\n\t\t\t\trtpReceiver.receive(edgeRtpParameters);\n\n\t\t\t\t// Store it.\n\t\t\t\t_this5._rtpReceivers.set(consumer.id, rtpReceiver);\n\n\t\t\t\treturn rtpReceiver.track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar rtpReceiver = _this6._rtpReceivers.get(consumer.id);\n\n\t\t\t\tif (!rtpReceiver) throw new Error('RTCRtpReceiver not found');\n\n\t\t\t\t_this6._rtpReceivers.delete(consumer.id);\n\n\t\t\t\ttry {\n\t\t\t\t\tlogger.debug('removeConsumer() | calling rtpReceiver.stop()');\n\n\t\t\t\t\trtpReceiver.stop();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.warn('rtpReceiver.stop() failed:%o', error);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t_promise2.default.resolve().then(function () {\n\t\t\t\t_this7._transportRemoteParameters.iceParameters = remoteIceParameters;\n\n\t\t\t\tvar remoteIceCandidates = _this7._transportRemoteParameters.iceCandidates;\n\n\t\t\t\tlogger.debug('restartIce() | calling iceTransport.start()');\n\n\t\t\t\t_this7._iceTransport.start(_this7._iceGatherer, remoteIceParameters, 'controlling');\n\n\t\t\t\tvar _iteratorNormalCompletion3 = true;\n\t\t\t\tvar _didIteratorError3 = false;\n\t\t\t\tvar _iteratorError3 = undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tfor (var _iterator3 = (0, _getIterator3.default)(remoteIceCandidates), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\t\t\t\tvar candidate = _step3.value;\n\n\t\t\t\t\t\t_this7._iceTransport.addRemoteCandidate(candidate);\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\t_didIteratorError3 = true;\n\t\t\t\t\t_iteratorError3 = err;\n\t\t\t\t} finally {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t\t\t\t_iterator3.return();\n\t\t\t\t\t\t}\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tif (_didIteratorError3) {\n\t\t\t\t\t\t\tthrow _iteratorError3;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t_this7._iceTransport.addRemoteCandidate({});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setIceGatherer',\n\t\tvalue: function _setIceGatherer(settings) {\n\t\t\tvar iceGatherer = new RTCIceGatherer({\n\t\t\t\ticeServers: settings.turnServers || [],\n\t\t\t\tgatherPolicy: settings.iceTransportPolicy\n\t\t\t});\n\n\t\t\ticeGatherer.addEventListener('error', function (event) {\n\t\t\t\tlogger.error('iceGatherer \"error\" event [event:%o]', event);\n\t\t\t});\n\n\t\t\t// NOTE: Not yet implemented by Edge, which starts gathering automatically.\n\t\t\ttry {\n\t\t\t\ticeGatherer.gather();\n\t\t\t} catch (error) {\n\t\t\t\tlogger.debug('iceGatherer.gather() failed: %s', error.toString());\n\t\t\t}\n\n\t\t\tthis._iceGatherer = iceGatherer;\n\t\t}\n\t}, {\n\t\tkey: '_setIceTransport',\n\t\tvalue: function _setIceTransport() {\n\t\t\tvar _this8 = this;\n\n\t\t\tvar iceTransport = new RTCIceTransport(this._iceGatherer);\n\n\t\t\t// NOTE: Not yet implemented by Edge.\n\t\t\ticeTransport.addEventListener('statechange', function () {\n\t\t\t\tswitch (iceTransport.state) {\n\t\t\t\t\tcase 'checking':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'connected':\n\t\t\t\t\tcase 'completed':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'connected');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'failed':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'failed');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'disconnected':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'closed':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'closed');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// NOTE: Not standard, but implemented by Edge.\n\t\t\ticeTransport.addEventListener('icestatechange', function () {\n\t\t\t\tswitch (iceTransport.state) {\n\t\t\t\t\tcase 'checking':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'connected':\n\t\t\t\t\tcase 'completed':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'connected');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'failed':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'failed');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'disconnected':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'closed':\n\t\t\t\t\t\t_this8.emit('@connectionstatechange', 'closed');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ticeTransport.addEventListener('candidatepairchange', function (event) {\n\t\t\t\tlogger.debug('iceTransport \"candidatepairchange\" event [pair:%o]', event.pair);\n\t\t\t});\n\n\t\t\tthis._iceTransport = iceTransport;\n\t\t}\n\t}, {\n\t\tkey: '_setDtlsTransport',\n\t\tvalue: function _setDtlsTransport() {\n\t\t\tvar _this9 = this;\n\n\t\t\tvar dtlsTransport = new RTCDtlsTransport(this._iceTransport);\n\n\t\t\t// NOTE: Not yet implemented by Edge.\n\t\t\tdtlsTransport.addEventListener('statechange', function () {\n\t\t\t\tlogger.debug('dtlsTransport \"statechange\" event [state:%s]', dtlsTransport.state);\n\t\t\t});\n\n\t\t\t// NOTE: Not standard, but implemented by Edge.\n\t\t\tdtlsTransport.addEventListener('dtlsstatechange', function () {\n\t\t\t\tlogger.debug('dtlsTransport \"dtlsstatechange\" event [state:%s]', dtlsTransport.state);\n\n\t\t\t\tif (dtlsTransport.state === 'closed') _this9.emit('@connectionstatechange', 'closed');\n\t\t\t});\n\n\t\t\tdtlsTransport.addEventListener('error', function (event) {\n\t\t\t\tlogger.error('dtlsTransport \"error\" event [event:%o]', event);\n\t\t\t});\n\n\t\t\tthis._dtlsTransport = dtlsTransport;\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar dtlsParameters = _this10._dtlsTransport.getLocalParameters();\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this10.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t_this10._transportRemoteParameters = transportRemoteParameters;\n\n\t\t\t\tvar remoteIceParameters = transportRemoteParameters.iceParameters;\n\t\t\t\tvar remoteIceCandidates = transportRemoteParameters.iceCandidates;\n\t\t\t\tvar remoteDtlsParameters = transportRemoteParameters.dtlsParameters;\n\n\t\t\t\t// Start the RTCIceTransport.\n\t\t\t\t_this10._iceTransport.start(_this10._iceGatherer, remoteIceParameters, 'controlling');\n\n\t\t\t\t// Add remote ICE candidates.\n\t\t\t\tvar _iteratorNormalCompletion4 = true;\n\t\t\t\tvar _didIteratorError4 = false;\n\t\t\t\tvar _iteratorError4 = undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tfor (var _iterator4 = (0, _getIterator3.default)(remoteIceCandidates), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n\t\t\t\t\t\tvar candidate = _step4.value;\n\n\t\t\t\t\t\t_this10._iceTransport.addRemoteCandidate(candidate);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Also signal a 'complete' candidate as per spec.\n\t\t\t\t\t// NOTE: It should be {complete: true} but Edge prefers {}.\n\t\t\t\t\t// NOTE: If we don't signal end of candidates, the Edge RTCIceTransport\n\t\t\t\t\t// won't enter the 'completed' state.\n\t\t\t\t} catch (err) {\n\t\t\t\t\t_didIteratorError4 = true;\n\t\t\t\t\t_iteratorError4 = err;\n\t\t\t\t} finally {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (!_iteratorNormalCompletion4 && _iterator4.return) {\n\t\t\t\t\t\t\t_iterator4.return();\n\t\t\t\t\t\t}\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tif (_didIteratorError4) {\n\t\t\t\t\t\t\tthrow _iteratorError4;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t_this10._iceTransport.addRemoteCandidate({});\n\n\t\t\t\t// NOTE: Edge does not like SHA less than 256.\n\t\t\t\tremoteDtlsParameters.fingerprints = remoteDtlsParameters.fingerprints.filter(function (fingerprint) {\n\t\t\t\t\treturn fingerprint.algorithm === 'sha-256' || fingerprint.algorithm === 'sha-384' || fingerprint.algorithm === 'sha-512';\n\t\t\t\t});\n\n\t\t\t\t// Start the RTCDtlsTransport.\n\t\t\t\t_this10._dtlsTransport.start(remoteDtlsParameters);\n\n\t\t\t\t_this10._transportReady = true;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn Edge11;\n}(_EnhancedEventEmitter3.default);\n\nexports.default = Edge11;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Firefox50.js\":\n/*!*****************************************!*\\\n  !*** ./lib/mslib/handlers/Firefox50.js ***!\n  \\*****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _extends2 = __webpack_require__(/*! babel-runtime/helpers/extends */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/extends.js\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _unifiedPlanUtils = __webpack_require__(/*! ./sdp/unifiedPlanUtils */ \"./lib/mslib/handlers/sdp/unifiedPlanUtils.js\");\n\nvar sdpUnifiedPlanUtils = _interopRequireWildcard(_unifiedPlanUtils);\n\nvar _RemoteUnifiedPlanSdp = __webpack_require__(/*! ./sdp/RemoteUnifiedPlanSdp */ \"./lib/mslib/handlers/sdp/RemoteUnifiedPlanSdp.js\");\n\nvar _RemoteUnifiedPlanSdp2 = _interopRequireDefault(_RemoteUnifiedPlanSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Firefox50');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemoteUnifiedPlanSdp}\n\t\t_this._remoteSdp = new _RemoteUnifiedPlanSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Local stream.\n\t\t// @type {MediaStream}\n\t\t_this2._stream = new MediaStream();\n\n\t\t// RID value counter for simulcast (so they never match).\n\t\t// @type {Number}\n\t\t_this2._nextRid = 1;\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._stream.getTrackById(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tvar rtpSender = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t_this3._stream.addTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\trtpSender = _this3._pc.addTrack(track, _this3._stream);\n\t\t\t}).then(function () {\n\t\t\t\tvar encodings = [];\n\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tif (producer.simulcast.high) {\n\t\t\t\t\t\tencodings.push({\n\t\t\t\t\t\t\trid: 'high' + _this3._nextRid,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tpriority: 'low',\n\t\t\t\t\t\t\tmaxBitrate: producer.simulcast.high\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (producer.simulcast.medium) {\n\t\t\t\t\t\tencodings.push({\n\t\t\t\t\t\t\trid: 'medium' + _this3._nextRid,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tpriority: 'medium',\n\t\t\t\t\t\t\tmaxBitrate: producer.simulcast.medium\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (producer.simulcast.low) {\n\t\t\t\t\t\tencodings.push({\n\t\t\t\t\t\t\trid: 'low' + _this3._nextRid,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tpriority: 'high',\n\t\t\t\t\t\t\tmaxBitrate: producer.simulcast.low\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update RID counter for future ones.\n\t\t\t\t\t_this3._nextRid++;\n\t\t\t\t}\n\n\t\t\t\tvar parameters = rtpSender.getParameters();\n\n\t\t\t\treturn rtpSender.setParameters((0, _extends3.default)({}, parameters, { encodings: encodings }));\n\t\t\t}).then(function () {\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('addProducer() _rtpParametersByKind: %o - rtpParameters: %o', _this3._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\t// Fill the RTP parameters for this track.\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\ttry {\n\t\t\t\t\t_this3._pc.removeTrack(rtpSender);\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\t_this3._stream.removeTrack(track);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this4._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === track;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('RTCRtpSender not found');\n\n\t\t\t\t// Remove the associated RtpSender.\n\t\t\t\t_this4._pc.removeTrack(rtpSender);\n\n\t\t\t\t// Remove the track from the local stream.\n\t\t\t\t_this4._stream.removeTrack(track);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar oldTrack = producer.track;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this5._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === oldTrack;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\treturn rtpSender.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t// Remove the old track from the local stream.\n\t\t\t\t_this5._stream.removeTrack(oldTrack);\n\n\t\t\t\t// Add the new track to the local stream.\n\t\t\t\t_this5._stream.addTrack(track);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpUnifiedPlanUtils.addPlanBSimulcast(sdpObject, track, {\n\t\t\t\t\t\tmid: transceiver.mid\n\t\t\t\t\t});\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('updateTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this8._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n\t\t\t\t\tmid: transceiver.mid,\n\t\t\t\t\tplanBSimulcast: true\n\t\t\t\t});\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - mid {String}\n\t\t// - kind {String}\n\t\t// - closed {Boolean}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\n\t\t// Add an entry into consumers info to hold a fake DataChannel, so\n\t\t// the first m= section of the remote SDP is always \"active\" and Firefox\n\t\t// does not close the transport when there is no remote audio/video Consumers.\n\t\t//\n\t\t// ISSUE: https://github.com/versatica/mediasoup-client/issues/2\n\t\tvar fakeDataChannelConsumerInfo = {\n\t\t\tmid: 'fake-dc',\n\t\t\tkind: 'application',\n\t\t\tclosed: false,\n\t\t\tcname: null\n\t\t};\n\n\t\t_this9._consumerInfos.set(555, fakeDataChannelConsumerInfo);\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tmid: '' + consumer.kind[0] + consumer.id,\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tclosed: consumer.closed,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar newRtpReceiver = _this10._pc.getReceivers().find(function (rtpReceiver) {\n\t\t\t\t\tvar track = rtpReceiver.track;\n\n\n\t\t\t\t\tif (!track) return false;\n\n\t\t\t\t\treturn track.id === consumerInfo.trackId;\n\t\t\t\t});\n\n\t\t\t\tif (!newRtpReceiver) throw new Error('remote track not found');\n\n\t\t\t\treturn newRtpReceiver.track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tvar consumerInfo = this._consumerInfos.get(consumer.id);\n\n\t\t\tif (!consumerInfo) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tconsumerInfo.closed = true;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Firefox50 = function () {\n\t(0, _createClass3.default)(Firefox50, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require'\n\t\t\t});\n\n\t\t\t// NOTE: We need to add a real video track to get the RID extension mapping.\n\t\t\tvar canvas = document.createElement('canvas');\n\n\t\t\t// NOTE: Otherwise Firefox fails in next line.\n\t\t\tcanvas.getContext('2d');\n\n\t\t\tvar fakeStream = canvas.captureStream();\n\t\t\tvar fakeVideoTrack = fakeStream.getVideoTracks()[0];\n\t\t\tvar rtpSender = pc.addTrack(fakeVideoTrack, fakeStream);\n\n\t\t\trtpSender.setParameters({\n\t\t\t\tencodings: [{ rid: 'RID1', maxBitrate: 40000 }, { rid: 'RID2', maxBitrate: 10000 }]\n\t\t\t});\n\n\t\t\treturn pc.createOffer({\n\t\t\t\tofferToReceiveAudio: true,\n\t\t\t\tofferToReceiveVideo: true\n\t\t\t}).then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tcanvas.remove();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tfakeVideoTrack.stop();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tcanvas.remove();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tfakeVideoTrack.stop();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Firefox50';\n\t\t}\n\t}]);\n\n\tfunction Firefox50(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Firefox50);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Firefox50;\n}();\n\nexports.default = Firefox50;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Firefox59.js\":\n/*!*****************************************!*\\\n  !*** ./lib/mslib/handlers/Firefox59.js ***!\n  \\*****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _extends2 = __webpack_require__(/*! babel-runtime/helpers/extends */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/extends.js\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _unifiedPlanUtils = __webpack_require__(/*! ./sdp/unifiedPlanUtils */ \"./lib/mslib/handlers/sdp/unifiedPlanUtils.js\");\n\nvar sdpUnifiedPlanUtils = _interopRequireWildcard(_unifiedPlanUtils);\n\nvar _RemoteUnifiedPlanSdp = __webpack_require__(/*! ./sdp/RemoteUnifiedPlanSdp */ \"./lib/mslib/handlers/sdp/RemoteUnifiedPlanSdp.js\");\n\nvar _RemoteUnifiedPlanSdp2 = _interopRequireDefault(_RemoteUnifiedPlanSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Firefox59');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemoteUnifiedPlanSdp}\n\t\t_this._remoteSdp = new _RemoteUnifiedPlanSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Local stream.\n\t\t// @type {MediaStream}\n\t\t_this2._stream = new MediaStream();\n\n\t\t// RID value counter for simulcast (so they never match).\n\t\t// @type {Number}\n\t\t_this2._nextRid = 1;\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._stream.getTrackById(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tvar rtpSender = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Add the track to the local stream.\n\t\t\t\t_this3._stream.addTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\trtpSender = _this3._pc.addTrack(track, _this3._stream);\n\t\t\t}).then(function () {\n\t\t\t\tvar encodings = [];\n\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tif (producer.simulcast.high) {\n\t\t\t\t\t\tencodings.push({\n\t\t\t\t\t\t\trid: 'high' + _this3._nextRid,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tpriority: 'low',\n\t\t\t\t\t\t\tmaxBitrate: producer.simulcast.high\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (producer.simulcast.medium) {\n\t\t\t\t\t\tencodings.push({\n\t\t\t\t\t\t\trid: 'medium' + _this3._nextRid,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tpriority: 'medium',\n\t\t\t\t\t\t\tmaxBitrate: producer.simulcast.medium\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (producer.simulcast.low) {\n\t\t\t\t\t\tencodings.push({\n\t\t\t\t\t\t\trid: 'low' + _this3._nextRid,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tpriority: 'high',\n\t\t\t\t\t\t\tmaxBitrate: producer.simulcast.low\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update RID counter for future ones.\n\t\t\t\t\t_this3._nextRid++;\n\t\t\t\t}\n\n\t\t\t\tvar parameters = rtpSender.getParameters();\n\n\t\t\t\treturn rtpSender.setParameters((0, _extends3.default)({}, parameters, { encodings: encodings }));\n\t\t\t}).then(function () {\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('addProducer() _rtpParametersByKind: %o - rtpParameters: %o', _this3._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\t// Fill the RTP parameters for this track.\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\ttry {\n\t\t\t\t\t_this3._pc.removeTrack(rtpSender);\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\t_this3._stream.removeTrack(track);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this4._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === track;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('RTCRtpSender not found');\n\n\t\t\t\t// Remove the associated RtpSender.\n\t\t\t\t_this4._pc.removeTrack(rtpSender);\n\n\t\t\t\t// Remove the track from the local stream.\n\t\t\t\t_this4._stream.removeTrack(track);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar oldTrack = producer.track;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this5._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === oldTrack;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\treturn rtpSender.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t// Remove the old track from the local stream.\n\t\t\t\t_this5._stream.removeTrack(oldTrack);\n\n\t\t\t\t// Add the new track to the local stream.\n\t\t\t\t_this5._stream.addTrack(track);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpUnifiedPlanUtils.addPlanBSimulcast(sdpObject, track, {\n\t\t\t\t\t\tmid: transceiver.mid\n\t\t\t\t\t});\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('updateTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this8._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n\t\t\t\t\tmid: transceiver.mid,\n\t\t\t\t\tplanBSimulcast: true\n\t\t\t\t});\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - mid {String}\n\t\t// - kind {String}\n\t\t// - closed {Boolean}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tmid: '' + consumer.kind[0] + consumer.id,\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tclosed: consumer.closed,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar newTransceiver = _this10._pc.getTransceivers().find(function (transceiver) {\n\t\t\t\t\tvar receiver = transceiver.receiver;\n\n\n\t\t\t\t\tif (!receiver) return false;\n\n\t\t\t\t\tvar track = receiver.track;\n\n\n\t\t\t\t\tif (!track) return false;\n\n\t\t\t\t\treturn transceiver.mid === consumerInfo.mid;\n\t\t\t\t});\n\n\t\t\t\tif (!newTransceiver) throw new Error('remote track not found');\n\n\t\t\t\treturn newTransceiver.receiver.track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tvar consumerInfo = this._consumerInfos.get(consumer.id);\n\n\t\t\tif (!consumerInfo) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tconsumerInfo.closed = true;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Firefox59 = function () {\n\t(0, _createClass3.default)(Firefox59, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require'\n\t\t\t});\n\n\t\t\t// NOTE: We need to add a real video track to get the RID extension mapping.\n\t\t\tvar canvas = document.createElement('canvas');\n\n\t\t\t// NOTE: Otherwise Firefox fails in next line.\n\t\t\tcanvas.getContext('2d');\n\n\t\t\tvar fakeStream = canvas.captureStream();\n\t\t\tvar fakeVideoTrack = fakeStream.getVideoTracks()[0];\n\t\t\tvar rtpSender = pc.addTrack(fakeVideoTrack, fakeStream);\n\n\t\t\trtpSender.setParameters({\n\t\t\t\tencodings: [{ rid: 'RID1', maxBitrate: 40000 }, { rid: 'RID2', maxBitrate: 10000 }]\n\t\t\t});\n\n\t\t\treturn pc.createOffer({\n\t\t\t\tofferToReceiveAudio: true,\n\t\t\t\tofferToReceiveVideo: true\n\t\t\t}).then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tcanvas.remove();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tfakeVideoTrack.stop();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tcanvas.remove();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tfakeVideoTrack.stop();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Firefox59';\n\t\t}\n\t}]);\n\n\tfunction Firefox59(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Firefox59);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Firefox59;\n}();\n\nexports.default = Firefox59;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Firefox65.js\":\n/*!*****************************************!*\\\n  !*** ./lib/mslib/handlers/Firefox65.js ***!\n  \\*****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _extends2 = __webpack_require__(/*! babel-runtime/helpers/extends */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/extends.js\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _unifiedPlanUtils = __webpack_require__(/*! ./sdp/unifiedPlanUtils */ \"./lib/mslib/handlers/sdp/unifiedPlanUtils.js\");\n\nvar sdpUnifiedPlanUtils = _interopRequireWildcard(_unifiedPlanUtils);\n\nvar _RemoteUnifiedPlanSdp = __webpack_require__(/*! ./sdp/RemoteUnifiedPlanSdp */ \"./lib/mslib/handlers/sdp/RemoteUnifiedPlanSdp.js\");\n\nvar _RemoteUnifiedPlanSdp2 = _interopRequireDefault(_RemoteUnifiedPlanSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Firefox65');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemoteUnifiedPlanSdp}\n\t\t_this._remoteSdp = new _RemoteUnifiedPlanSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Ids of alive local tracks.\n\t\t// @type {Set<Number>}\n\t\t_this2._trackIds = new _set2.default();\n\n\t\t// RID value counter for simulcast (so they never match).\n\t\t// @type {Number}\n\t\t_this2._nextRid = 1;\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._trackIds.has(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tvar transceiver = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\t// Add the track id to the Set.\n\t\t\tthis._trackIds.add(track.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is any inactive transceiver for same kind and\n\t\t\t\t// reuse it if so.\n\t\t\t\ttransceiver = _this3._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind && t.direction === 'inactive';\n\t\t\t\t});\n\n\t\t\t\tif (transceiver) {\n\t\t\t\t\tlogger.debug('addProducer() | reusing an inactive transceiver');\n\n\t\t\t\t\ttransceiver.direction = 'sendonly';\n\n\t\t\t\t\treturn transceiver.sender.replaceTrack(track);\n\t\t\t\t} else {\n\t\t\t\t\ttransceiver = _this3._pc.addTransceiver(track, { direction: 'sendonly' });\n\t\t\t\t}\n\t\t\t}).then(function () {\n\t\t\t\tvar _transceiver = transceiver,\n\t\t\t\t    sender = _transceiver.sender;\n\n\t\t\t\tvar encodings = [];\n\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tif (producer.simulcast.high) {\n\t\t\t\t\t\tencodings.push({\n\t\t\t\t\t\t\trid: 'high' + _this3._nextRid,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tpriority: 'low',\n\t\t\t\t\t\t\tmaxBitrate: producer.simulcast.high\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (producer.simulcast.medium) {\n\t\t\t\t\t\tencodings.push({\n\t\t\t\t\t\t\trid: 'medium' + _this3._nextRid,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tpriority: 'medium',\n\t\t\t\t\t\t\tmaxBitrate: producer.simulcast.medium\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (producer.simulcast.low) {\n\t\t\t\t\t\tencodings.push({\n\t\t\t\t\t\t\trid: 'low' + _this3._nextRid,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tpriority: 'high',\n\t\t\t\t\t\t\tmaxBitrate: producer.simulcast.low\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update RID counter for future ones.\n\t\t\t\t\t_this3._nextRid++;\n\t\t\t\t}\n\n\t\t\t\tvar parameters = sender.getParameters();\n\n\t\t\t\treturn sender.setParameters((0, _extends3.default)({}, parameters, { encodings: encodings }));\n\t\t\t}).then(function () {\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('addProducer() _rtpParametersByKind: %o - rtpParameters: %o', _this3._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, { mid: transceiver.mid });\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\ttry {\n\t\t\t\t\ttransceiver.direction = 'inactive';\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\t_this3._trackIds.delete(track.id);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tif (!this._trackIds.has(track.id)) return _promise2.default.reject(new Error('track not found'));\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this4._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === track;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\t_this4._pc.removeTrack(rtpSender);\n\n\t\t\t\t// Remove the track id from the Set.\n\t\t\t\t_this4._trackIds.delete(track.id);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar oldTrack = producer.track;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this5._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === oldTrack;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\treturn rtpSender.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t// Remove the old track id from the Set.\n\t\t\t\t_this5._trackIds.delete(oldTrack.id);\n\n\t\t\t\t// Add the new track id to the Set.\n\t\t\t\t_this5._trackIds.add(track.id);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpUnifiedPlanUtils.addPlanBSimulcast(sdpObject, track, {\n\t\t\t\t\t\tmid: transceiver.mid\n\t\t\t\t\t});\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('updateTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this8._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n\t\t\t\t\tmid: transceiver.mid,\n\t\t\t\t\tplanBSimulcast: true\n\t\t\t\t});\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - mid {String}\n\t\t// - kind {String}\n\t\t// - closed {Boolean}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tmid: '' + consumer.kind[0] + consumer.id,\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tclosed: consumer.closed,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar transceiver = _this10._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.mid === consumerInfo.mid;\n\t\t\t\t});\n\n\t\t\t\tif (!transceiver) throw new Error('remote track not found');\n\n\t\t\t\treturn transceiver.receiver.track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tvar consumerInfo = this._consumerInfos.get(consumer.id);\n\n\t\t\tif (!consumerInfo) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tconsumerInfo.closed = true;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Firefox65 = function () {\n\t(0, _createClass3.default)(Firefox65, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require'\n\t\t\t});\n\n\t\t\t// NOTE: We need to add a real video track to get the RID extension mapping.\n\t\t\tvar canvas = document.createElement('canvas');\n\n\t\t\t// NOTE: Otherwise Firefox fails in next line.\n\t\t\tcanvas.getContext('2d');\n\n\t\t\tvar fakeStream = canvas.captureStream();\n\t\t\tvar fakeVideoTrack = fakeStream.getVideoTracks()[0];\n\t\t\tvar rtpSender = pc.addTrack(fakeVideoTrack, fakeStream);\n\n\t\t\trtpSender.setParameters({\n\t\t\t\tencodings: [{ rid: 'RID1', maxBitrate: 40000 }, { rid: 'RID2', maxBitrate: 10000 }]\n\t\t\t});\n\n\t\t\treturn pc.createOffer({\n\t\t\t\tofferToReceiveAudio: true,\n\t\t\t\tofferToReceiveVideo: true\n\t\t\t}).then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tcanvas.remove();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tfakeVideoTrack.stop();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tcanvas.remove();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tfakeVideoTrack.stop();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Firefox65';\n\t\t}\n\t}]);\n\n\tfunction Firefox65(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Firefox65);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Firefox65;\n}();\n\nexports.default = Firefox65;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/ReactNative.js\":\n/*!*******************************************!*\\\n  !*** ./lib/mslib/handlers/ReactNative.js ***!\n  \\*******************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _planBUtils = __webpack_require__(/*! ./sdp/planBUtils */ \"./lib/mslib/handlers/sdp/planBUtils.js\");\n\nvar sdpPlanBUtils = _interopRequireWildcard(_planBUtils);\n\nvar _RemotePlanBSdp = __webpack_require__(/*! ./sdp/RemotePlanBSdp */ \"./lib/mslib/handlers/sdp/RemotePlanBSdp.js\");\n\nvar _RemotePlanBSdp2 = _interopRequireDefault(_RemotePlanBSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('ReactNative');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemotePlanBSdp}\n\t\t_this._remoteSdp = new _RemotePlanBSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Handled tracks.\n\t\t// @type {Set<MediaStreamTrack>}\n\t\t_this2._tracks = new _set2.default();\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._tracks.has(track)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\tif (!track.streamReactTag) return _promise2.default.reject(new Error('no track.streamReactTag property'));\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\tvar stream = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Add the track to the Set.\n\t\t\t\t_this3._tracks.add(track);\n\n\t\t\t\t// Hack: Create a new stream with track.streamReactTag as id.\n\t\t\t\tstream = new MediaStream(track.streamReactTag);\n\n\t\t\t\t// Add the track to the stream.\n\t\t\t\tstream.addTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\t_this3._pc.addStream(stream);\n\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = { type: 'offer', sdp: offerSdp };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\tvar offerDesc = new RTCSessionDescription(offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offerDesc);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\tvar answerDesc = new RTCSessionDescription(answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answerDesc);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('addProducer() _rtpParametersByKind: %o - rtpParameters: %o', _this3._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\t// Fill the RTP parameters for this track.\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\t_this3._tracks.delete(track);\n\t\t\t\tstream.removeTrack(track);\n\t\t\t\t_this3._pc.removeStream(stream);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (!track.streamReactTag) return _promise2.default.reject(new Error('no track.streamReactTag property'));\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Remove the track from the Set.\n\t\t\t\t_this4._tracks.delete(track);\n\n\t\t\t\t// Hack: Create a new stream with track.streamReactTag as id.\n\t\t\t\tvar stream = new MediaStream(track.streamReactTag);\n\n\t\t\t\t// Add the track to the stream.\n\t\t\t\tstream.addTrack(track);\n\n\t\t\t\t// Remove the stream from the PeerConnection.\n\t\t\t\t_this4._pc.removeStream(stream);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).catch(function (error) {\n\t\t\t\t// NOTE: If there are no sending tracks, setLocalDescription() will fail with\n\t\t\t\t// \"Failed to create channels\". If so, ignore it.\n\t\t\t\tif (_this4._tracks.size === 0) {\n\t\t\t\t\tlogger.warn('removeProducer() | ignoring expected error due no sending tracks: %s', error.toString());\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t}).then(function () {\n\t\t\t\tif (_this4._pc.signalingState === 'stable') return;\n\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\tvar answerDesc = new RTCSessionDescription(answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answerDesc);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (!track.streamReactTag) return _promise2.default.reject(new Error('no track.streamReactTag property'));\n\n\t\t\tvar oldTrack = producer.track;\n\t\t\tvar stream = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Add the new Track to the Set and remove the old one.\n\t\t\t\t_this5._tracks.add(track);\n\t\t\t\t_this5._tracks.delete(oldTrack);\n\n\t\t\t\t// Hack: Create a new stream with track.streamReactTag as id.\n\t\t\t\tstream = new MediaStream(track.streamReactTag);\n\n\t\t\t\t// Add the track to the stream and remove the old one.\n\t\t\t\tstream.addTrack(track);\n\t\t\t\tstream.removeTrack(oldTrack);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\t_this5._pc.addStream(stream);\n\n\t\t\t\treturn _this5._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = { type: 'offer', sdp: offerSdp };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\tvar offerDesc = new RTCSessionDescription(offer);\n\n\t\t\t\treturn _this5._pc.setLocalDescription(offerDesc);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this5._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this5._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\tvar answerDesc = new RTCSessionDescription(answer);\n\n\t\t\t\treturn _this5._pc.setRemoteDescription(answerDesc);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this5._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('replaceProducerTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this5._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\t// Fill the RTP parameters for the new track.\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\t// We need to provide new RTP parameters.\n\t\t\t\t_this5.safeEmit('@needupdateproducer', producer, rtpParameters);\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\t_this5._tracks.delete(track);\n\t\t\t\tstream.removeTrack(track);\n\t\t\t\t_this5._pc.addStream(stream);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\tvar answerDesc = new RTCSessionDescription(answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answerDesc);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\tvar audioCodec = 'isac';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setOpusAttributes(offer.sdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setSpecialAudioCodec(offer.sdp, audioCodec);\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\t\t\t\t\t/*\n     sdpPlanBUtils.addPlanBSimulcast(sdpObject, track, {\n         mid: transceiver.mid\n     });\n     */\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t// for opus profile - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setOpusAttributes(remoteSdp, producer.audioProfile);\n\t\t\t\t// \n\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setSpecialAudioCodec(remoteSdp, audioCodec);\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\tif (!!rtpParameters && !!rtpParameters.codecs) {\n\t\t\t\t\t// \n\t\t\t\t\trtpParameters.codecs.forEach(function (item, index) {\n\t\t\t\t\t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== 'audio/' + audioCodec) {\n\t\t\t\t\t\t\trtpParameters.codecs.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug('updateTrack() _rtpParametersByKind: %o - rtpParameters: %o', _this8._rtpParametersByKind[producer.kind], rtpParameters);\n\t\t\t\t}\n\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\t\t\t\t/*\n    sdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n        mid: transceiver.mid,\n        planBSimulcast: true\n    });\n    */\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Seen media kinds.\n\t\t// @type {Set<String>}\n\t\t_this9._kinds = new _set2.default();\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - kind {String}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\t\t\tthis._kinds.add(consumer.kind);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._kinds), (0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\tvar offerDesc = new RTCSessionDescription(offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offerDesc);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar stream = _this10._pc.getRemoteStreams().find(function (s) {\n\t\t\t\t\treturn s.id === consumerInfo.streamId;\n\t\t\t\t});\n\t\t\t\tvar track = stream.getTrackById(consumerInfo.trackId);\n\n\t\t\t\t// Hack: Add a streamReactTag property with the reactTag of the MediaStream\n\t\t\t\t// generated by react-native-webrtc (this is needed because react-native-webrtc\n\t\t\t\t// assumes that we're gonna use the streams generated by it).\n\t\t\t\ttrack.streamReactTag = stream.reactTag;\n\n\t\t\t\tif (!track) throw new Error('remote track not found');\n\n\t\t\t\treturn track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (!this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tthis._consumerInfos.delete(consumer.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._kinds), (0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\tvar offerDesc = new RTCSessionDescription(offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offerDesc);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._kinds), (0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\tvar offerDesc = new RTCSessionDescription(offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offerDesc);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar ReactNative = function () {\n\t(0, _createClass3.default)(ReactNative, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require'\n\t\t\t});\n\n\t\t\treturn pc.createOffer({\n\t\t\t\tofferToReceiveAudio: true,\n\t\t\t\tofferToReceiveVideo: true\n\t\t\t}).then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'ReactNative';\n\t\t}\n\t}]);\n\n\tfunction ReactNative(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, ReactNative);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn ReactNative;\n}();\n\nexports.default = ReactNative;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Safari11.js\":\n/*!****************************************!*\\\n  !*** ./lib/mslib/handlers/Safari11.js ***!\n  \\****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _planBUtils = __webpack_require__(/*! ./sdp/planBUtils */ \"./lib/mslib/handlers/sdp/planBUtils.js\");\n\nvar sdpPlanBUtils = _interopRequireWildcard(_planBUtils);\n\nvar _RemotePlanBSdp = __webpack_require__(/*! ./sdp/RemotePlanBSdp */ \"./lib/mslib/handlers/sdp/RemotePlanBSdp.js\");\n\nvar _RemotePlanBSdp2 = _interopRequireDefault(_RemotePlanBSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Safari11');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemotePlanBSdp}\n\t\t_this._remoteSdp = new _RemotePlanBSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Local stream.\n\t\t// @type {MediaStream}\n\t\t_this2._stream = new MediaStream();\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._stream.getTrackById(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\tvar rtpSender = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\tvar audioCodec = 'opus';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Add the track to the local stream.\n\t\t\t\t_this3._stream.addTrack(track);\n\n\t\t\t\t// Add the stream to the PeerConnection.\n\t\t\t\trtpSender = _this3._pc.addTrack(track, _this3._stream);\n\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    offer.sdp = bandwidthHandler.setOpusAttributes(offer.sdp, producer.audioProfile);\n    // \n    \toffer.sdp = bandwidthHandler.setSpecialAudioCodec(offer.sdp, audioCodec);\n    */\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    remoteSdp = bandwidthHandler.setOpusAttributes(remoteSdp, producer.audioProfile);\n    // \n    \tremoteSdp = bandwidthHandler.setSpecialAudioCodec(remoteSdp, audioCodec);\n    */\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\t/* 2020/3/10\n    if (!!rtpParameters && !!rtpParameters.codecs)\n    {\n    \t// \n    \trtpParameters.codecs.forEach((item, index) => {\n    \t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== `audio/${audioCodec}`) {\n    \t\t\trtpParameters.codecs.splice(index, 1);\n    \t\t}\n    \t});\n    \t\t\tlogger.debug(\n    \t\t'addProducer() _rtpParametersByKind: %o - rtpParameters: %o',\n    \t\tthis._rtpParametersByKind[producer.kind], rtpParameters\n    \t);\n    }\n    */\n\n\t\t\t\t// Fill the RTP parameters for this track.\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\ttry {\n\t\t\t\t\t_this3._pc.removeTrack(rtpSender);\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\t_this3._stream.removeTrack(track);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar audioCodec = 'opus';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this4._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === track;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('RTCRtpSender not found');\n\n\t\t\t\t// Remove the associated RtpSender.\n\t\t\t\t_this4._pc.removeTrack(rtpSender);\n\n\t\t\t\t// Remove the track from the local stream.\n\t\t\t\t_this4._stream.removeTrack(track);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    offer.sdp = bandwidthHandler.setOpusAttributes(offer.sdp, producer.audioProfile);\n    // \n    \toffer.sdp = bandwidthHandler.setSpecialAudioCodec(offer.sdp, audioCodec);\n    */\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).catch(function (error) {\n\t\t\t\t// NOTE: If there are no sending tracks, setLocalDescription() will fail with\n\t\t\t\t// \"Failed to create channels\". If so, ignore it.\n\t\t\t\tif (_this4._stream.getTracks().length === 0) {\n\t\t\t\t\tlogger.warn('removeProducer() | ignoring expected error due no sending tracks: %s', error.toString());\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t}).then(function () {\n\t\t\t\tif (_this4._pc.signalingState === 'stable') return;\n\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    remoteSdp = bandwidthHandler.setOpusAttributes(remoteSdp, producer.audioProfile);\n    // \n    \tremoteSdp = bandwidthHandler.setSpecialAudioCodec(remoteSdp, audioCodec);\n    */\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar oldTrack = producer.track;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this5._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === oldTrack;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\treturn rtpSender.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t// Remove the old track from the local stream.\n\t\t\t\t_this5._stream.removeTrack(oldTrack);\n\n\t\t\t\t// Add the new track to the local stream.\n\t\t\t\t_this5._stream.addTrack(track);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of send', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\tvar audioCodec = 'opus'; // safari 下默认为 opus -- 因其不支持 isac\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    offer.sdp = bandwidthHandler.setOpusAttributes(offer.sdp, producer.audioProfile);\n    // \n    \toffer.sdp = bandwidthHandler.setSpecialAudioCodec(offer.sdp, audioCodec);\n    */\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpPlanBUtils.addSimulcastForTrack(sdpObject, track);\n\t\t\t\t\t/*\n     sdpPlanBUtils.addPlanBSimulcast(sdpObject, track, {\n         mid: transceiver.mid\n     });\n     */\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    remoteSdp = bandwidthHandler.setOpusAttributes(remoteSdp, producer.audioProfile);\n    // \n    \tremoteSdp = bandwidthHandler.setSpecialAudioCodec(remoteSdp, audioCodec);\n    */\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\t/* 2020/3/10\n    if (!!rtpParameters && !!rtpParameters.codecs)\n    {\n    \t// \n    \trtpParameters.codecs.forEach((item, index) => {\n    \t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== `audio/${audioCodec}`) {\n    \t\t\trtpParameters.codecs.splice(index, 1);\n    \t\t}\n    \t});\n    \t\tlogger.debug(\n    \t\t'updateTrack() _rtpParametersByKind: %o - rtpParameters: %o',\n    \t\tthis._rtpParametersByKind[producer.kind], rtpParameters\n    \t);\n    }\n    */\n\n\t\t\t\tsdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track);\n\t\t\t\t/*\n    sdpPlanBUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n        mid: transceiver.mid,\n        planBSimulcast: true\n    });\n    */\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Seen media kinds.\n\t\t// @type {Set<String>}\n\t\t_this9._kinds = new _set2.default();\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - kind {String}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\t\t\tthis._kinds.add(consumer.kind);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._kinds), (0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar newRtpReceiver = _this10._pc.getReceivers().find(function (rtpReceiver) {\n\t\t\t\t\tvar track = rtpReceiver.track;\n\n\n\t\t\t\t\tif (!track) return false;\n\n\t\t\t\t\treturn track.id === consumerInfo.trackId;\n\t\t\t\t});\n\n\t\t\t\tif (!newRtpReceiver) throw new Error('remote track not found');\n\n\t\t\t\treturn newRtpReceiver.track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (!this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tthis._consumerInfos.delete(consumer.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._kinds), (0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._kinds), (0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of recv', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Safari11 = function () {\n\t(0, _createClass3.default)(Safari11, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require'\n\t\t\t});\n\n\t\t\tpc.addTransceiver('audio');\n\t\t\tpc.addTransceiver('video');\n\n\t\t\treturn pc.createOffer().then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Safari11';\n\t\t}\n\t}]);\n\n\tfunction Safari11(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Safari11);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Safari11;\n}();\n\nexports.default = Safari11;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Safari12.js\":\n/*!****************************************!*\\\n  !*** ./lib/mslib/handlers/Safari12.js ***!\n  \\****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _unifiedPlanUtils = __webpack_require__(/*! ./sdp/unifiedPlanUtils */ \"./lib/mslib/handlers/sdp/unifiedPlanUtils.js\");\n\nvar sdpUnifiedPlanUtils = _interopRequireWildcard(_unifiedPlanUtils);\n\nvar _RemoteUnifiedPlanSdp = __webpack_require__(/*! ./sdp/RemoteUnifiedPlanSdp */ \"./lib/mslib/handlers/sdp/RemoteUnifiedPlanSdp.js\");\n\nvar _RemoteUnifiedPlanSdp2 = _interopRequireDefault(_RemoteUnifiedPlanSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Safari12');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemoteUnifiedPlanSdp}\n\t\t_this._remoteSdp = new _RemoteUnifiedPlanSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Ids of alive local tracks.\n\t\t// @type {Set<Number>}\n\t\t_this2._trackIds = new _set2.default();\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._trackIds.has(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\tvar transceiver = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\tvar audioCodec = 'opus';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\t// Add the track id to the Set.\n\t\t\tthis._trackIds.add(track.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is any inactive transceiver for same kind and\n\t\t\t\t// reuse it if so.\n\t\t\t\ttransceiver = _this3._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind && t.direction === 'inactive';\n\t\t\t\t});\n\n\t\t\t\tif (transceiver) {\n\t\t\t\t\tlogger.debug('addProducer() | reusing an inactive transceiver');\n\n\t\t\t\t\ttransceiver.direction = 'sendonly';\n\n\t\t\t\t\treturn transceiver.sender.replaceTrack(track);\n\t\t\t\t} else {\n\t\t\t\t\ttransceiver = _this3._pc.addTransceiver(track, { direction: 'sendonly' });\n\t\t\t\t}\n\t\t\t}).then(function () {\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    offer.sdp = bandwidthHandler.setOpusAttributes(offer.sdp, producer.audioProfile);\n    // \n    \toffer.sdp = bandwidthHandler.setSpecialAudioCodec(offer.sdp, audioCodec);\n    */\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpUnifiedPlanUtils.addPlanBSimulcast(sdpObject, track, { mid: transceiver.mid });\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = { type: 'offer', sdp: offerSdp };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    remoteSdp = bandwidthHandler.setOpusAttributes(remoteSdp, producer.audioProfile);\n    // \n    \tremoteSdp = bandwidthHandler.setSpecialAudioCodec(remoteSdp, audioCodec);\n    */\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\t/* 2020/3/10\n    if (!!rtpParameters && !!rtpParameters.codecs)\n    {\n    \t// \n    \trtpParameters.codecs.forEach((item, index) => {\n    \t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== `audio/${audioCodec}`) {\n    \t\t\trtpParameters.codecs.splice(index, 1);\n    \t\t}\n    \t});\n    \t\t\tlogger.debug(\n    \t\t'addProducer() _rtpParametersByKind: %o - rtpParameters: %o',\n    \t\tthis._rtpParametersByKind[producer.kind], rtpParameters\n    \t);\n    }\n    */\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, { mid: transceiver.mid, planBSimulcast: true });\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\ttry {\n\t\t\t\t\ttransceiver.direction = 'inactive';\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\t_this3._trackIds.delete(track.id);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tif (!this._trackIds.has(track.id)) return _promise2.default.reject(new Error('track not found'));\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar audioCodec = 'opus';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this4._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === track;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\t_this4._pc.removeTrack(rtpSender);\n\n\t\t\t\t// Remove the track id from the Set.\n\t\t\t\t_this4._trackIds.delete(track.id);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    offer.sdp = bandwidthHandler.setOpusAttributes(offer.sdp, producer.audioProfile);\n    // \n    \toffer.sdp = bandwidthHandler.setSpecialAudioCodec(offer.sdp, audioCodec);\n    */\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    remoteSdp = bandwidthHandler.setOpusAttributes(remoteSdp, producer.audioProfile);\n    // \n    \tremoteSdp = bandwidthHandler.setSpecialAudioCodec(remoteSdp, audioCodec);\n    */\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar oldTrack = producer.track;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this5._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === oldTrack;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\treturn rtpSender.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t// Remove the old track id from the Set.\n\t\t\t\t_this5._trackIds.delete(oldTrack.id);\n\n\t\t\t\t// Add the new track id to the Set.\n\t\t\t\t_this5._trackIds.add(track.id);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of send', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\tvar audioCodec = 'opus';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    offer.sdp = bandwidthHandler.setOpusAttributes(offer.sdp, producer.audioProfile);\n    // \n    \toffer.sdp = bandwidthHandler.setSpecialAudioCodec(offer.sdp, audioCodec);\n    */\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpUnifiedPlanUtils.addPlanBSimulcast(sdpObject, track, {\n\t\t\t\t\t\tmid: transceiver.mid\n\t\t\t\t\t});\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    remoteSdp = bandwidthHandler.setOpusAttributes(remoteSdp, producer.audioProfile);\n    // \n    \tremoteSdp = bandwidthHandler.setSpecialAudioCodec(remoteSdp, audioCodec);\n    */\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\t/* 2020/3/10\n    if (!!rtpParameters && !!rtpParameters.codecs)\n    {\n    \t// \n    \trtpParameters.codecs.forEach((item, index) => {\n    \t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== `audio/${audioCodec}`) {\n    \t\t\trtpParameters.codecs.splice(index, 1);\n    \t\t}\n    \t});\n    \t\tlogger.debug(\n    \t\t'updateTrack() _rtpParametersByKind: %o - rtpParameters: %o',\n    \t\tthis._rtpParametersByKind[producer.kind], rtpParameters\n    \t);\n    }\n    */\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n\t\t\t\t\tmid: transceiver.mid,\n\t\t\t\t\tplanBSimulcast: true\n\t\t\t\t});\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - mid {String}\n\t\t// - kind {String}\n\t\t// - closed {Boolean}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tmid: '' + consumer.kind[0] + consumer.id,\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tclosed: consumer.closed,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar transceiver = _this10._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.mid === consumerInfo.mid;\n\t\t\t\t});\n\n\t\t\t\tif (!transceiver) throw new Error('remote track not found');\n\n\t\t\t\treturn transceiver.receiver.track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tvar consumerInfo = this._consumerInfos.get(consumer.id);\n\n\t\t\tif (!consumerInfo) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tconsumerInfo.closed = true;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of recv', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Safari12 = function () {\n\t(0, _createClass3.default)(Safari12, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require'\n\t\t\t});\n\n\t\t\tpc.addTransceiver('audio');\n\t\t\tpc.addTransceiver('video');\n\n\t\t\treturn pc.createOffer().then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Safari12';\n\t\t}\n\t}]);\n\n\tfunction Safari12(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Safari12);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Safari12;\n}();\n\nexports.default = Safari12;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/Safari13.js\":\n/*!****************************************!*\\\n  !*** ./lib/mslib/handlers/Safari13.js ***!\n  \\****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _sdpform = __webpack_require__(/*! ../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter2 = __webpack_require__(/*! ../EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter3 = _interopRequireDefault(_EnhancedEventEmitter2);\n\nvar _utils = __webpack_require__(/*! ../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ../ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _unifiedPlanUtils = __webpack_require__(/*! ./sdp/unifiedPlanUtils */ \"./lib/mslib/handlers/sdp/unifiedPlanUtils.js\");\n\nvar sdpUnifiedPlanUtils = _interopRequireWildcard(_unifiedPlanUtils);\n\nvar _RemoteUnifiedPlanSdp = __webpack_require__(/*! ./sdp/RemoteUnifiedPlanSdp */ \"./lib/mslib/handlers/sdp/RemoteUnifiedPlanSdp.js\");\n\nvar _RemoteUnifiedPlanSdp2 = _interopRequireDefault(_RemoteUnifiedPlanSdp);\n\nvar _bandwidthHandler = __webpack_require__(/*! ./sdp/bandwidthHandler */ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\");\n\nvar _bandwidthHandler2 = _interopRequireDefault(_bandwidthHandler);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('Safari13');\n\nvar Handler = function (_EnhancedEventEmitter) {\n\t(0, _inherits3.default)(Handler, _EnhancedEventEmitter);\n\n\tfunction Handler(direction, rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, Handler);\n\n\t\t// RTCPeerConnection instance.\n\t\t// @type {RTCPeerConnection}\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Handler.__proto__ || (0, _getPrototypeOf2.default)(Handler)).call(this, logger));\n\n\t\t_this._pc = new RTCPeerConnection({\n\t\t\ticeServers: settings.turnServers || [],\n\t\t\ticeTransportPolicy: settings.iceTransportPolicy,\n\t\t\tbundlePolicy: 'max-bundle',\n\t\t\trtcpMuxPolicy: 'require'\n\t\t});\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\t_this._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Remote SDP handler.\n\t\t// @type {RemoteUnifiedPlanSdp}\n\t\t_this._remoteSdp = new _RemoteUnifiedPlanSdp2.default(direction, rtpParametersByKind);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\t_this._pc.addEventListener('iceconnectionstatechange', function () {\n\t\t\tswitch (_this._pc.iceConnectionState) {\n\t\t\t\tcase 'checking':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\t_this.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Handler, [{\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\t// Close RTCPeerConnection.\n\t\t\ttry {\n\t\t\t\tthis._pc.close();\n\t\t\t} catch (error) {}\n\t\t}\n\t}, {\n\t\tkey: 'remoteClosed',\n\t\tvalue: function remoteClosed() {\n\t\t\tlogger.debug('remoteClosed()');\n\n\t\t\tthis._transportReady = false;\n\n\t\t\tif (this._transportUpdated) this._transportUpdated = false;\n\t\t}\n\t}]);\n\treturn Handler;\n}(_EnhancedEventEmitter3.default);\n\nvar SendHandler = function (_Handler) {\n\t(0, _inherits3.default)(SendHandler, _Handler);\n\n\tfunction SendHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, SendHandler);\n\n\t\t// Got transport local and remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this2 = (0, _possibleConstructorReturn3.default)(this, (SendHandler.__proto__ || (0, _getPrototypeOf2.default)(SendHandler)).call(this, 'send', rtpParametersByKind, settings));\n\n\t\t_this2._transportReady = false;\n\n\t\t// Ids of alive local tracks.\n\t\t// @type {Set<Number>}\n\t\t_this2._trackIds = new _set2.default();\n\t\treturn _this2;\n\t}\n\n\t(0, _createClass3.default)(SendHandler, [{\n\t\tkey: 'addProducer',\n\t\tvalue: function addProducer(producer) {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tlogger.debug('addProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tif (this._trackIds.has(track.id)) return _promise2.default.reject(new Error('track already added'));\n\n\t\t\tvar transceiver = void 0;\n\t\t\tvar localSdpObj = void 0;\n\n\t\t\tvar audioCodec = 'opus';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\t// Add the track id to the Set.\n\t\t\tthis._trackIds.add(track.id);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is any inactive transceiver for same kind and\n\t\t\t\t// reuse it if so.\n\t\t\t\ttransceiver = _this3._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind && t.direction === 'inactive';\n\t\t\t\t});\n\n\t\t\t\tif (transceiver) {\n\t\t\t\t\tlogger.debug('addProducer() | reusing an inactive transceiver');\n\n\t\t\t\t\ttransceiver.direction = 'sendonly';\n\n\t\t\t\t\treturn transceiver.sender.replaceTrack(track);\n\t\t\t\t} else {\n\t\t\t\t\ttransceiver = _this3._pc.addTransceiver(track, { direction: 'sendonly' });\n\t\t\t\t}\n\t\t\t}).then(function () {\n\t\t\t\treturn _this3._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    offer.sdp = bandwidthHandler.setOpusAttributes(offer.sdp, producer.audioProfile);\n    // \n    \toffer.sdp = bandwidthHandler.setSpecialAudioCodec(offer.sdp, audioCodec);\n    */\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('addProducer() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpUnifiedPlanUtils.addPlanBSimulcast(sdpObject, track, { mid: transceiver.mid });\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = { type: 'offer', sdp: offerSdp };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this3._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this3._transportReady) return _this3._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this3._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this3._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    remoteSdp = bandwidthHandler.setOpusAttributes(remoteSdp, producer.audioProfile);\n    // \n    \tremoteSdp = bandwidthHandler.setSpecialAudioCodec(remoteSdp, audioCodec);\n    */\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this3._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this3._rtpParametersByKind[producer.kind]);\n\t\t\t\t/* 2020/3/10\n    if (!!rtpParameters && !!rtpParameters.codecs)\n    {\n    \t// \n    \trtpParameters.codecs.forEach((item, index) => {\n    \t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== `audio/${audioCodec}`) {\n    \t\t\trtpParameters.codecs.splice(index, 1);\n    \t\t}\n    \t});\n    \t\t\tlogger.debug(\n    \t\t'addProducer() _rtpParametersByKind: %o - rtpParameters: %o',\n    \t\tthis._rtpParametersByKind[producer.kind], rtpParameters\n    \t);\n    }\n    */\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, { mid: transceiver.mid, planBSimulcast: true });\n\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\n\t\t\t\ttry {\n\t\t\t\t\ttransceiver.direction = 'inactive';\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\t_this3._trackIds.delete(track.id);\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeProducer',\n\t\tvalue: function removeProducer(producer) {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar track = producer.track;\n\n\n\t\t\tif (!this._trackIds.has(track.id)) return _promise2.default.reject(new Error('track not found'));\n\n\t\t\tlogger.debug('removeProducer() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar audioCodec = 'opus';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this4._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === track;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\t_this4._pc.removeTrack(rtpSender);\n\n\t\t\t\t// Remove the track id from the Set.\n\t\t\t\t_this4._trackIds.delete(track.id);\n\n\t\t\t\treturn _this4._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    offer.sdp = bandwidthHandler.setOpusAttributes(offer.sdp, producer.audioProfile);\n    // \n    \toffer.sdp = bandwidthHandler.setSpecialAudioCodec(offer.sdp, audioCodec);\n    */\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this4._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this4._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this4._remoteSdp.createAnswerSdp(localSdpObj);\n\n\t\t\t\t// for video bitrate - jove\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    remoteSdp = bandwidthHandler.setOpusAttributes(remoteSdp, producer.audioProfile);\n    // \n    \tremoteSdp = bandwidthHandler.setSpecialAudioCodec(remoteSdp, audioCodec);\n    */\n\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeProducer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this4._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'replaceProducerTrack',\n\t\tvalue: function replaceProducerTrack(producer, track) {\n\t\t\tvar _this5 = this;\n\n\t\t\tlogger.debug('replaceProducerTrack() [id:%s, kind:%s, trackId:%s]', producer.id, producer.kind, track.id);\n\n\t\t\tvar oldTrack = producer.track;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get the associated RTCRtpSender.\n\t\t\t\tvar rtpSender = _this5._pc.getSenders().find(function (s) {\n\t\t\t\t\treturn s.track === oldTrack;\n\t\t\t\t});\n\n\t\t\t\tif (!rtpSender) throw new Error('local track not found');\n\n\t\t\t\treturn rtpSender.replaceTrack(track);\n\t\t\t}).then(function () {\n\t\t\t\t// Remove the old track id from the Set.\n\t\t\t\t_this5._trackIds.delete(oldTrack.id);\n\n\t\t\t\t// Add the new track id to the Set.\n\t\t\t\t_this5._trackIds.add(track.id);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\treturn _this6._pc.createOffer({ iceRestart: true });\n\t\t\t}).then(function (offer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this6._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tvar localSdpObj = _sdpform2.default.parse(_this6._pc.localDescription.sdp);\n\t\t\t\tvar remoteSdp = _this6._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tvar answer = { type: 'answer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this6._pc.setRemoteDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this7 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Get our local DTLS parameters.\n\t\t\t\tvar transportLocalParameters = {};\n\t\t\t\tvar sdp = _this7._pc.localDescription.sdp;\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\n\t\t\t\t// Let's decide that we'll be DTLS server (because we can).\n\t\t\t\tdtlsParameters.role = 'server';\n\n\t\t\t\ttransportLocalParameters.dtlsParameters = dtlsParameters;\n\n\t\t\t\t// Provide the remote SDP handler with transport local parameters.\n\t\t\t\t_this7._remoteSdp.setTransportLocalParameters(transportLocalParameters);\n\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this7.safeEmitAsPromise('@needcreatetransport', transportLocalParameters);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this7._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this7._transportReady = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of send', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'updateTrack',\n\t\tvalue: function updateTrack(producer, track) {\n\t\t\tvar _this8 = this;\n\n\t\t\tlogger.debug('update Track() [trackId:%s]', track.id);\n\t\t\tvar localSdpObj; // Add the track id to the Set.\n\t\t\tvar transceiver;\n\n\t\t\tvar audioCodec = 'opus';\n\t\t\tif (producer.audioProfile && producer.audioProfile.codec && producer.audioProfile.codec !== '') {\n\t\t\t\taudioCodec = producer.audioProfile.codec.toLowerCase();\n\t\t\t}\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// Let's check if there is transceiver for same kind.\n\t\t\t\t// One production consists video or (and) audio track(s).\n\t\t\t\ttransceiver = _this8._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.receiver.track.kind === track.kind;\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\treturn _this8._pc.createOffer();\n\t\t\t}).then(function (offer) {\n\t\t\t\t// for video bitrate - jove\n\t\t\t\toffer.sdp = _bandwidthHandler2.default.setVideoBitrates(offer.sdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    offer.sdp = bandwidthHandler.setOpusAttributes(offer.sdp, producer.audioProfile);\n    // \n    \toffer.sdp = bandwidthHandler.setSpecialAudioCodec(offer.sdp, audioCodec);\n    */\n\n\t\t\t\t// If simulcast is set, mangle the offer.\n\t\t\t\t// var offerSdp;\n\t\t\t\tif (producer.simulcast) {\n\t\t\t\t\tlogger.debug('updateTrack() | enabling simulcast');\n\n\t\t\t\t\tvar sdpObject = _sdpform2.default.parse(offer.sdp);\n\n\t\t\t\t\tsdpUnifiedPlanUtils.addPlanBSimulcast(sdpObject, track, {\n\t\t\t\t\t\tmid: transceiver.mid\n\t\t\t\t\t});\n\n\t\t\t\t\tvar offerSdp = _sdpform2.default.write(sdpObject);\n\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: 'offer',\n\t\t\t\t\t\tsdp: offerSdp\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setLocalDescription() [offer:%o]', offer);\n\t\t\t\treturn _this8._pc.setLocalDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\tlocalSdpObj = _sdpform2.default.parse(_this8._pc.localDescription.sdp);\n\n\t\t\t\tvar remoteSdp = _this8._remoteSdp.createAnswerSdp(localSdpObj);\n\t\t\t\tremoteSdp = _bandwidthHandler2.default.setVideoBitrates(remoteSdp, producer.videoBitrateOptions);\n\n\t\t\t\t/* 2020/3/10\n    // for opus profile - jove\n    remoteSdp = bandwidthHandler.setOpusAttributes(remoteSdp, producer.audioProfile);\n    // \n    \tremoteSdp = bandwidthHandler.setSpecialAudioCodec(remoteSdp, audioCodec);\n    */\n\n\t\t\t\tvar answer = {\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tsdp: remoteSdp\n\t\t\t\t};\n\t\t\t\tlogger.debug('updateTrack() | calling pc.setRemoteDescription() [answer:%o]', answer);\n\t\t\t\treturn _this8._pc.setRemoteDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tvar rtpParameters = utils.clone(_this8._rtpParametersByKind[producer.kind]);\n\t\t\t\t/* 2020/3/10\n    if (!!rtpParameters && !!rtpParameters.codecs)\n    {\n    \t// \n    \trtpParameters.codecs.forEach((item, index) => {\n    \t\tif (item.mimeType.indexOf('audio') === 0 && item.mimeType.toLowerCase() !== `audio/${audioCodec}`) {\n    \t\t\trtpParameters.codecs.splice(index, 1);\n    \t\t}\n    \t});\n    \t\tlogger.debug(\n    \t\t'updateTrack() _rtpParametersByKind: %o - rtpParameters: %o',\n    \t\tthis._rtpParametersByKind[producer.kind], rtpParameters\n    \t);\n    }\n    */\n\n\t\t\t\tsdpUnifiedPlanUtils.fillRtpParametersForTrack(rtpParameters, localSdpObj, track, {\n\t\t\t\t\tmid: transceiver.mid,\n\t\t\t\t\tplanBSimulcast: true\n\t\t\t\t});\n\t\t\t\treturn rtpParameters;\n\t\t\t}).catch(function (error) {\n\t\t\t\t// Panic here. Try to undo things.\n\t\t\t\t// failed at here and nothing to do.\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn SendHandler;\n}(Handler);\n\nvar RecvHandler = function (_Handler2) {\n\t(0, _inherits3.default)(RecvHandler, _Handler2);\n\n\tfunction RecvHandler(rtpParametersByKind, settings) {\n\t\t(0, _classCallCheck3.default)(this, RecvHandler);\n\n\t\t// Got transport remote parameters.\n\t\t// @type {Boolean}\n\t\tvar _this9 = (0, _possibleConstructorReturn3.default)(this, (RecvHandler.__proto__ || (0, _getPrototypeOf2.default)(RecvHandler)).call(this, 'recv', rtpParametersByKind, settings));\n\n\t\t_this9._transportCreated = false;\n\n\t\t// Got transport local parameters.\n\t\t// @type {Boolean}\n\t\t_this9._transportUpdated = false;\n\n\t\t// Map of Consumers information indexed by consumer.id.\n\t\t// - mid {String}\n\t\t// - kind {String}\n\t\t// - closed {Boolean}\n\t\t// - trackId {String}\n\t\t// - ssrc {Number}\n\t\t// - rtxSsrc {Number}\n\t\t// - cname {String}\n\t\t// @type {Map<Number, Object>}\n\t\t_this9._consumerInfos = new _map2.default();\n\t\treturn _this9;\n\t}\n\n\t(0, _createClass3.default)(RecvHandler, [{\n\t\tkey: 'addConsumer',\n\t\tvalue: function addConsumer(consumer) {\n\t\t\tvar _this10 = this;\n\n\t\t\tlogger.debug('addConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tif (this._consumerInfos.has(consumer.id)) return _promise2.default.reject(new Error('Consumer already added'));\n\n\t\t\tvar encoding = consumer.rtpParameters.encodings[0];\n\t\t\tvar cname = consumer.rtpParameters.rtcp.cname;\n\t\t\tvar consumerInfo = {\n\t\t\t\tmid: '' + consumer.kind[0] + consumer.id,\n\t\t\t\tkind: consumer.kind,\n\t\t\t\tclosed: consumer.closed,\n\t\t\t\tstreamId: 'recv-stream-' + consumer.id,\n\t\t\t\ttrackId: 'consumer-' + consumer.kind + '-' + consumer.id,\n\t\t\t\tssrc: encoding.ssrc,\n\t\t\t\tcname: cname\n\t\t\t};\n\n\t\t\tif (encoding.rtx && encoding.rtx.ssrc) consumerInfo.rtxSsrc = encoding.rtx.ssrc;\n\n\t\t\tthis._consumerInfos.set(consumer.id, consumerInfo);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!_this10._transportCreated) return _this10._setupTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar remoteSdp = _this10._remoteSdp.createOfferSdp((0, _from2.default)(_this10._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this10._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this10._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('addConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this10._pc.setLocalDescription(answer);\n\t\t\t}).then(function () {\n\t\t\t\tif (!_this10._transportUpdated) return _this10._updateTransport();\n\t\t\t}).then(function () {\n\t\t\t\tvar transceiver = _this10._pc.getTransceivers().find(function (t) {\n\t\t\t\t\treturn t.mid === consumerInfo.mid;\n\t\t\t\t});\n\n\t\t\t\tif (!transceiver) throw new Error('remote track not found');\n\n\t\t\t\treturn transceiver.receiver.track;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'removeConsumer',\n\t\tvalue: function removeConsumer(consumer) {\n\t\t\tvar _this11 = this;\n\n\t\t\tlogger.debug('removeConsumer() [id:%s, kind:%s]', consumer.id, consumer.kind);\n\n\t\t\tvar consumerInfo = this._consumerInfos.get(consumer.id);\n\n\t\t\tif (!consumerInfo) return _promise2.default.reject(new Error('Consumer not found'));\n\n\t\t\tconsumerInfo.closed = true;\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this11._remoteSdp.createOfferSdp((0, _from2.default)(_this11._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this11._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this11._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('removeConsumer() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this11._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'restartIce',\n\t\tvalue: function restartIce(remoteIceParameters) {\n\t\t\tvar _this12 = this;\n\n\t\t\tlogger.debug('restartIce()');\n\n\t\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\t\tthis._remoteSdp.updateTransportRemoteIceParameters(remoteIceParameters);\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tvar remoteSdp = _this12._remoteSdp.createOfferSdp((0, _from2.default)(_this12._consumerInfos.values()));\n\t\t\t\tvar offer = { type: 'offer', sdp: remoteSdp };\n\n\t\t\t\tlogger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n\n\t\t\t\treturn _this12._pc.setRemoteDescription(offer);\n\t\t\t}).then(function () {\n\t\t\t\treturn _this12._pc.createAnswer();\n\t\t\t}).then(function (answer) {\n\t\t\t\tlogger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n\n\t\t\t\treturn _this12._pc.setLocalDescription(answer);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setupTransport',\n\t\tvalue: function _setupTransport() {\n\t\t\tvar _this13 = this;\n\n\t\t\tlogger.debug('_setupTransport()');\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\t// We need transport remote parameters.\n\t\t\t\treturn _this13.safeEmitAsPromise('@needcreatetransport', null);\n\t\t\t}).then(function (transportRemoteParameters) {\n\t\t\t\t// Provide the remote SDP handler with transport remote parameters.\n\t\t\t\t_this13._remoteSdp.setTransportRemoteParameters(transportRemoteParameters);\n\n\t\t\t\t_this13._transportCreated = true;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_updateTransport',\n\t\tvalue: function _updateTransport() {\n\t\t\tlogger.debug('_updateTransport()');\n\n\t\t\t// Get our local DTLS parameters.\n\t\t\tvar sdp = this._pc.localDescription.sdp;\n\t\t\tvar sdpObj = _sdpform2.default.parse(sdp);\n\t\t\tvar dtlsParameters = sdpCommonUtils.extractDtlsParameters(sdpObj);\n\t\t\tvar transportLocalParameters = { dtlsParameters: dtlsParameters };\n\n\t\t\t// We need to provide transport local parameters.\n\t\t\tthis.safeEmit('@needupdatetransport', transportLocalParameters);\n\n\t\t\tthis._transportUpdated = true;\n\t\t}\n\t}, {\n\t\tkey: 'getPCStats',\n\t\tvalue: function getPCStats(selector) {\n\t\t\t// logger.debug('getPCStats of send', selector);\n\t\t\treturn this._pc.getStats(selector).then(function (stats) {\n\t\t\t\treturn stats;\n\t\t\t}).catch(function (e) {\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\t}]);\n\treturn RecvHandler;\n}(Handler);\n\nvar Safari13 = function () {\n\t(0, _createClass3.default)(Safari13, null, [{\n\t\tkey: 'getNativeRtpCapabilities',\n\t\tvalue: function getNativeRtpCapabilities() {\n\t\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\t\tvar pc = new RTCPeerConnection({\n\t\t\t\ticeServers: [],\n\t\t\t\ticeTransportPolicy: 'all',\n\t\t\t\tbundlePolicy: 'max-bundle',\n\t\t\t\trtcpMuxPolicy: 'require'\n\t\t\t});\n\n\t\t\tpc.addTransceiver('audio');\n\t\t\tpc.addTransceiver('video');\n\n\t\t\treturn pc.createOffer().then(function (offer) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error) {}\n\n\t\t\t\tvar sdpObj = _sdpform2.default.parse(offer.sdp);\n\t\t\t\tvar nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities(sdpObj);\n\n\t\t\t\treturn nativeRtpCapabilities;\n\t\t\t}).catch(function (error) {\n\t\t\t\ttry {\n\t\t\t\t\tpc.close();\n\t\t\t\t} catch (error2) {}\n\n\t\t\t\tthrow error;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'tag',\n\t\tget: function get() {\n\t\t\treturn 'Safari13';\n\t\t}\n\t}]);\n\n\tfunction Safari13(direction, extendedRtpCapabilities, settings) {\n\t\t(0, _classCallCheck3.default)(this, Safari13);\n\n\t\tlogger.debug('constructor() [direction:%s, extendedRtpCapabilities:%o]', direction, extendedRtpCapabilities);\n\n\t\tvar rtpParametersByKind = void 0;\n\n\t\tswitch (direction) {\n\t\t\tcase 'send':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new SendHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t\tcase 'recv':\n\t\t\t\t{\n\t\t\t\t\trtpParametersByKind = {\n\t\t\t\t\t\taudio: ortc.getReceivingFullRtpParameters('audio', extendedRtpCapabilities),\n\t\t\t\t\t\tvideo: ortc.getReceivingFullRtpParameters('video', extendedRtpCapabilities)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new RecvHandler(rtpParametersByKind, settings);\n\t\t\t\t}\n\t\t}\n\t}\n\n\treturn Safari13;\n}();\n\nexports.default = Safari13;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/ortc/edgeUtils.js\":\n/*!**********************************************!*\\\n  !*** ./lib/mslib/handlers/ortc/edgeUtils.js ***!\n  \\**********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nexports.getCapabilities = getCapabilities;\nexports.mangleRtpParameters = mangleRtpParameters;\n\nvar _utils = __webpack_require__(/*! ../../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Normalize Edge's RTCRtpReceiver.getCapabilities() to produce a full\n * compliant ORTC RTCRtpCapabilities.\n *\n * @return {RTCRtpCapabilities}\n */\nfunction getCapabilities() {\n\tvar nativeCaps = RTCRtpReceiver.getCapabilities();\n\tvar caps = utils.clone(nativeCaps);\n\n\tvar _iteratorNormalCompletion = true;\n\tvar _didIteratorError = false;\n\tvar _iteratorError = undefined;\n\n\ttry {\n\t\tfor (var _iterator = (0, _getIterator3.default)(caps.codecs), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\tvar codec = _step.value;\n\n\t\t\t// Rename numChannels to channels.\n\t\t\tcodec.channels = codec.numChannels;\n\t\t\tdelete codec.numChannels;\n\n\t\t\t// Normalize channels.\n\t\t\tif (codec.kind !== 'audio') delete codec.channels;else if (!codec.channels) codec.channels = 1;\n\n\t\t\t// Add mimeType.\n\t\t\tcodec.mimeType = codec.kind + '/' + codec.name;\n\n\t\t\t// NOTE: Edge sets some numeric parameters as String rather than Number. Fix them.\n\t\t\tif (codec.parameters) {\n\t\t\t\tvar parameters = codec.parameters;\n\n\t\t\t\tif (parameters.apt) parameters.apt = Number(parameters.apt);\n\n\t\t\t\tif (parameters['packetization-mode']) parameters['packetization-mode'] = Number(parameters['packetization-mode']);\n\t\t\t}\n\n\t\t\t// Delete emty parameter String in rtcpFeedback.\n\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\tvar _didIteratorError2 = false;\n\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(codec.rtcpFeedback || []), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\tvar feedback = _step2.value;\n\n\t\t\t\t\tif (!feedback.parameter) delete feedback.parameter;\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t_iteratorError2 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError = true;\n\t\t_iteratorError = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t_iterator.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError) {\n\t\t\t\tthrow _iteratorError;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn caps;\n}\n\n/**\n * Generate RTCRtpParameters as Edge like them.\n *\n * @param  {RTCRtpParameters} rtpParameters\n * @return {RTCRtpParameters}\n */\n/* global RTCRtpReceiver */\n\nfunction mangleRtpParameters(rtpParameters) {\n\tvar params = utils.clone(rtpParameters);\n\n\tvar _iteratorNormalCompletion3 = true;\n\tvar _didIteratorError3 = false;\n\tvar _iteratorError3 = undefined;\n\n\ttry {\n\t\tfor (var _iterator3 = (0, _getIterator3.default)(params.codecs), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\tvar codec = _step3.value;\n\n\t\t\t// Rename channels to numChannels.\n\t\t\tif (codec.channels) {\n\t\t\t\tcodec.numChannels = codec.channels;\n\t\t\t\tdelete codec.channels;\n\t\t\t}\n\n\t\t\t// Remove mimeType.\n\t\t\tdelete codec.mimeType;\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError3 = true;\n\t\t_iteratorError3 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t_iterator3.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError3) {\n\t\t\t\tthrow _iteratorError3;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn params;\n}\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/sdp/RemotePlainRtpSdp.js\":\n/*!*****************************************************!*\\\n  !*** ./lib/mslib/handlers/sdp/RemotePlainRtpSdp.js ***!\n  \\*****************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/keys.js\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _sdpform = __webpack_require__(/*! ../../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _utils = __webpack_require__(/*! ../../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('<RemotePlainRtpSdp>');\n\nvar RemoteSdp = function () {\n\tfunction RemoteSdp(rtpParametersByKind) {\n\t\t(0, _classCallCheck3.default)(this, RemoteSdp);\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\tthis._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Transport local parameters, including plain RTP parameteres.\n\t\t// @type {Object}\n\t\tthis._transportLocalParameters = null;\n\n\t\t// Transport remote parameters, including plain RTP parameters.\n\t\t// @type {Object}\n\t\tthis._transportRemoteParameters = null;\n\n\t\t// SDP global fields.\n\t\t// @type {Object}\n\t\tthis._sdpGlobalFields = {\n\t\t\tid: utils.randomNumber(),\n\t\t\tversion: 0\n\t\t};\n\t}\n\n\t(0, _createClass3.default)(RemoteSdp, [{\n\t\tkey: 'setTransportLocalParameters',\n\t\tvalue: function setTransportLocalParameters(transportLocalParameters) {\n\t\t\tlogger.debug('setTransportLocalParameters() [transportLocalParameters:%o]', transportLocalParameters);\n\n\t\t\tthis._transportLocalParameters = transportLocalParameters;\n\t\t}\n\t}, {\n\t\tkey: 'setTransportRemoteParameters',\n\t\tvalue: function setTransportRemoteParameters(transportRemoteParameters) {\n\t\t\tlogger.debug('setTransportRemoteParameters() [transportRemoteParameters:%o]', transportRemoteParameters);\n\n\t\t\tthis._transportRemoteParameters = transportRemoteParameters;\n\t\t}\n\t}]);\n\treturn RemoteSdp;\n}();\n\nvar SendRemoteSdp = function (_RemoteSdp) {\n\t(0, _inherits3.default)(SendRemoteSdp, _RemoteSdp);\n\n\tfunction SendRemoteSdp(rtpParametersByKind) {\n\t\t(0, _classCallCheck3.default)(this, SendRemoteSdp);\n\t\treturn (0, _possibleConstructorReturn3.default)(this, (SendRemoteSdp.__proto__ || (0, _getPrototypeOf2.default)(SendRemoteSdp)).call(this, rtpParametersByKind));\n\t}\n\n\t(0, _createClass3.default)(SendRemoteSdp, [{\n\t\tkey: 'createAnswerSdp',\n\t\tvalue: function createAnswerSdp(localSdpObj) {\n\t\t\tlogger.debug('createAnswerSdp()');\n\n\t\t\tif (!this._transportLocalParameters) throw new Error('no transport local parameters');else if (!this._transportRemoteParameters) throw new Error('no transport remote parameters');\n\n\t\t\tvar remotePlainRtpParameters = this._transportRemoteParameters.plainRtpParameters;\n\t\t\tvar sdpObj = {};\n\t\t\tvar mids = (localSdpObj.media || []).filter(function (m) {\n\t\t\t\treturn m.hasOwnProperty('mid');\n\t\t\t}).map(function (m) {\n\t\t\t\treturn String(m.mid);\n\t\t\t});\n\n\t\t\t// Increase our SDP version.\n\t\t\tthis._sdpGlobalFields.version++;\n\n\t\t\tsdpObj.version = 0;\n\t\t\tsdpObj.origin = {\n\t\t\t\taddress: remotePlainRtpParameters.ip,\n\t\t\t\tipVer: remotePlainRtpParameters.version,\n\t\t\t\tnetType: 'IN',\n\t\t\t\tsessionId: this._sdpGlobalFields.id,\n\t\t\t\tsessionVersion: this._sdpGlobalFields.version,\n\t\t\t\tusername: 'mediasoup-client'\n\t\t\t};\n\t\t\tsdpObj.name = '-';\n\t\t\tsdpObj.timing = { start: 0, stop: 0 };\n\n\t\t\tsdpObj.msidSemantic = {\n\t\t\t\tsemantic: 'WMS',\n\t\t\t\ttoken: '*'\n\t\t\t};\n\n\t\t\tif (mids.length > 0) {\n\t\t\t\tsdpObj.groups = [{\n\t\t\t\t\ttype: 'BUNDLE',\n\t\t\t\t\tmids: mids.join(' ')\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\tsdpObj.media = [];\n\n\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\tvar _didIteratorError = false;\n\t\t\tvar _iteratorError = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator = (0, _getIterator3.default)(localSdpObj.media || []), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\t\tvar localMediaObj = _step.value;\n\n\t\t\t\t\tvar closed = localMediaObj.direction === 'inactive';\n\t\t\t\t\tvar kind = localMediaObj.type;\n\t\t\t\t\tvar codecs = this._rtpParametersByKind[kind].codecs;\n\t\t\t\t\tvar headerExtensions = this._rtpParametersByKind[kind].headerExtensions;\n\t\t\t\t\tvar remoteMediaObj = {};\n\n\t\t\t\t\tremoteMediaObj.type = localMediaObj.type;\n\n\t\t\t\t\tremoteMediaObj.port = remotePlainRtpParameters.port;\n\t\t\t\t\tremoteMediaObj.protocol = 'RTP/AVP';\n\t\t\t\t\tremoteMediaObj.connection = {\n\t\t\t\t\t\tip: remotePlainRtpParameters.ip,\n\t\t\t\t\t\tversion: remotePlainRtpParameters.version\n\t\t\t\t\t};\n\t\t\t\t\tremoteMediaObj.mid = localMediaObj.mid;\n\n\t\t\t\t\tswitch (localMediaObj.direction) {\n\t\t\t\t\t\tcase 'sendrecv':\n\t\t\t\t\t\tcase 'sendonly':\n\t\t\t\t\t\t\tremoteMediaObj.direction = 'recvonly';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'recvonly':\n\t\t\t\t\t\tcase 'inactive':\n\t\t\t\t\t\t\tremoteMediaObj.direction = 'inactive';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.rtp = [];\n\t\t\t\t\tremoteMediaObj.rtcpFb = [];\n\t\t\t\t\tremoteMediaObj.fmtp = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\t\t\tvar _didIteratorError2 = false;\n\t\t\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(codecs), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\t\t\tvar codec = _step2.value;\n\n\t\t\t\t\t\t\tvar rtp = {\n\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\tcodec: codec.name,\n\t\t\t\t\t\t\t\trate: codec.clockRate\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (codec.channels > 1) rtp.encoding = codec.channels;\n\n\t\t\t\t\t\t\tremoteMediaObj.rtp.push(rtp);\n\n\t\t\t\t\t\t\tif (codec.parameters) {\n\t\t\t\t\t\t\t\tvar paramFmtp = {\n\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\tconfig: ''\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion5 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError5 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError5 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator5 = (0, _getIterator3.default)((0, _keys2.default)(codec.parameters)), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n\t\t\t\t\t\t\t\t\t\tvar key = _step5.value;\n\n\t\t\t\t\t\t\t\t\t\tif (paramFmtp.config) paramFmtp.config += ';';\n\n\t\t\t\t\t\t\t\t\t\tparamFmtp.config += key + '=' + codec.parameters[key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError5 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError5 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion5 && _iterator5.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator5.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError5) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError5;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (paramFmtp.config) remoteMediaObj.fmtp.push(paramFmtp);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (codec.rtcpFeedback) {\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion6 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError6 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError6 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator6 = (0, _getIterator3.default)(codec.rtcpFeedback), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n\t\t\t\t\t\t\t\t\t\tvar fb = _step6.value;\n\n\t\t\t\t\t\t\t\t\t\tremoteMediaObj.rtcpFb.push({\n\t\t\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\t\t\ttype: fb.type,\n\t\t\t\t\t\t\t\t\t\t\tsubtype: fb.parameter || ''\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError6 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError6 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion6 && _iterator6.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator6.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError6) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError6;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t\t\t_iteratorError2 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.payloads = codecs.map(function (codec) {\n\t\t\t\t\t\treturn codec.payloadType;\n\t\t\t\t\t}).join(' ');\n\n\t\t\t\t\tif (!closed) {\n\t\t\t\t\t\tremoteMediaObj.ext = [];\n\n\t\t\t\t\t\tvar _iteratorNormalCompletion3 = true;\n\t\t\t\t\t\tvar _didIteratorError3 = false;\n\t\t\t\t\t\tvar _iteratorError3 = undefined;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar _loop = function _loop() {\n\t\t\t\t\t\t\t\tvar ext = _step3.value;\n\n\t\t\t\t\t\t\t\t// Don't add a header extension if not present in the offer.\n\t\t\t\t\t\t\t\tvar matchedLocalExt = (localMediaObj.ext || []).find(function (localExt) {\n\t\t\t\t\t\t\t\t\treturn localExt.uri === ext.uri;\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (!matchedLocalExt) return 'continue';\n\n\t\t\t\t\t\t\t\tremoteMediaObj.ext.push({\n\t\t\t\t\t\t\t\t\turi: ext.uri,\n\t\t\t\t\t\t\t\t\tvalue: ext.id\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tfor (var _iterator3 = (0, _getIterator3.default)(headerExtensions), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\t\t\t\t\t\tvar _ret = _loop();\n\n\t\t\t\t\t\t\t\tif (_ret === 'continue') continue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t_didIteratorError3 = true;\n\t\t\t\t\t\t\t_iteratorError3 = err;\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t\t\t\t\t\t_iterator3.return();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tif (_didIteratorError3) {\n\t\t\t\t\t\t\t\t\tthrow _iteratorError3;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Simulcast.\n\t\t\t\t\tif (localMediaObj.simulcast_03) {\n\t\t\t\t\t\t// eslint-disable-next-line camelcase\n\t\t\t\t\t\tremoteMediaObj.simulcast_03 = {\n\t\t\t\t\t\t\tvalue: localMediaObj.simulcast_03.value.replace(/send/g, 'recv')\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tremoteMediaObj.rids = [];\n\n\t\t\t\t\t\tvar _iteratorNormalCompletion4 = true;\n\t\t\t\t\t\tvar _didIteratorError4 = false;\n\t\t\t\t\t\tvar _iteratorError4 = undefined;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tfor (var _iterator4 = (0, _getIterator3.default)(localMediaObj.rids || []), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n\t\t\t\t\t\t\t\tvar rid = _step4.value;\n\n\t\t\t\t\t\t\t\tif (rid.direction !== 'send') continue;\n\n\t\t\t\t\t\t\t\tremoteMediaObj.rids.push({\n\t\t\t\t\t\t\t\t\tid: rid.id,\n\t\t\t\t\t\t\t\t\tdirection: 'recv'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t_didIteratorError4 = true;\n\t\t\t\t\t\t\t_iteratorError4 = err;\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion4 && _iterator4.return) {\n\t\t\t\t\t\t\t\t\t_iterator4.return();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tif (_didIteratorError4) {\n\t\t\t\t\t\t\t\t\tthrow _iteratorError4;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.rtcpMux = 'rtcp-mux';\n\t\t\t\t\tremoteMediaObj.rtcpRsize = 'rtcp-rsize';\n\n\t\t\t\t\t// Push it.\n\t\t\t\t\tsdpObj.media.push(remoteMediaObj);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError = true;\n\t\t\t\t_iteratorError = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar sdp = _sdpform2.default.write(sdpObj);\n\n\t\t\treturn sdp;\n\t\t}\n\t}]);\n\treturn SendRemoteSdp;\n}(RemoteSdp);\n\nvar RecvRemoteSdp = function (_RemoteSdp2) {\n\t(0, _inherits3.default)(RecvRemoteSdp, _RemoteSdp2);\n\n\tfunction RecvRemoteSdp(rtpParametersByKind) {\n\t\t(0, _classCallCheck3.default)(this, RecvRemoteSdp);\n\t\treturn (0, _possibleConstructorReturn3.default)(this, (RecvRemoteSdp.__proto__ || (0, _getPrototypeOf2.default)(RecvRemoteSdp)).call(this, rtpParametersByKind));\n\t}\n\n\t/**\n  * @param {Array<Object>} consumerInfos - Consumer informations.\n  * @return {String}\n  */\n\n\n\t(0, _createClass3.default)(RecvRemoteSdp, [{\n\t\tkey: 'createOfferSdp',\n\t\tvalue: function createOfferSdp(consumerInfos) {\n\t\t\tlogger.debug('createOfferSdp()');\n\n\t\t\tif (!this._transportRemoteParameters) throw new Error('no transport remote parameters');\n\n\t\t\tvar remotePlainRtpParameters = this._transportRemoteParameters.plainRtpParameters;\n\t\t\tvar sdpObj = {};\n\t\t\tvar mids = consumerInfos.map(function (info) {\n\t\t\t\treturn String(info.mid);\n\t\t\t});\n\n\t\t\t// Increase our SDP version.\n\t\t\tthis._sdpGlobalFields.version++;\n\n\t\t\tsdpObj.version = 0;\n\t\t\tsdpObj.origin = {\n\t\t\t\taddress: remotePlainRtpParameters.ip,\n\t\t\t\tipVer: remotePlainRtpParameters.version,\n\t\t\t\tnetType: 'IN',\n\t\t\t\tsessionId: this._sdpGlobalFields.id,\n\t\t\t\tsessionVersion: this._sdpGlobalFields.version,\n\t\t\t\tusername: 'mediasoup-client'\n\t\t\t};\n\t\t\tsdpObj.name = '-';\n\t\t\tsdpObj.timing = { start: 0, stop: 0 };\n\n\t\t\tsdpObj.msidSemantic = {\n\t\t\t\tsemantic: 'WMS',\n\t\t\t\ttoken: '*'\n\t\t\t};\n\n\t\t\tif (mids.length > 0) {\n\t\t\t\tsdpObj.groups = [{\n\t\t\t\t\ttype: 'BUNDLE',\n\t\t\t\t\tmids: mids.join(' ')\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\tsdpObj.media = [];\n\n\t\t\tvar _iteratorNormalCompletion7 = true;\n\t\t\tvar _didIteratorError7 = false;\n\t\t\tvar _iteratorError7 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator7 = (0, _getIterator3.default)(consumerInfos), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n\t\t\t\t\tvar info = _step7.value;\n\n\t\t\t\t\tvar closed = info.closed;\n\t\t\t\t\tvar kind = info.kind;\n\t\t\t\t\tvar codecs = this._rtpParametersByKind[kind].codecs;\n\t\t\t\t\tvar headerExtensions = this._rtpParametersByKind[kind].headerExtensions;\n\t\t\t\t\tvar remoteMediaObj = {};\n\n\t\t\t\t\tremoteMediaObj.type = kind;\n\t\t\t\t\tremoteMediaObj.mid = info.mid;\n\t\t\t\t\tremoteMediaObj.msid = info.streamId + ' ' + info.trackId;\n\t\t\t\t\tremoteMediaObj.port = remotePlainRtpParameters.port;\n\t\t\t\t\tremoteMediaObj.protocol = 'RTP/AVP';\n\t\t\t\t\tremoteMediaObj.connection = {\n\t\t\t\t\t\tip: remotePlainRtpParameters.ip,\n\t\t\t\t\t\tversion: remotePlainRtpParameters.version\n\t\t\t\t\t};\n\n\t\t\t\t\tif (!closed) remoteMediaObj.direction = 'sendonly';else remoteMediaObj.direction = 'inactive';\n\n\t\t\t\t\tremoteMediaObj.rtp = [];\n\t\t\t\t\tremoteMediaObj.rtcpFb = [];\n\t\t\t\t\tremoteMediaObj.fmtp = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion8 = true;\n\t\t\t\t\tvar _didIteratorError8 = false;\n\t\t\t\t\tvar _iteratorError8 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator8 = (0, _getIterator3.default)(codecs), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n\t\t\t\t\t\t\tvar codec = _step8.value;\n\n\t\t\t\t\t\t\tvar rtp = {\n\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\tcodec: codec.name,\n\t\t\t\t\t\t\t\trate: codec.clockRate\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (codec.channels > 1) rtp.encoding = codec.channels;\n\n\t\t\t\t\t\t\tremoteMediaObj.rtp.push(rtp);\n\n\t\t\t\t\t\t\tif (codec.parameters) {\n\t\t\t\t\t\t\t\tvar paramFmtp = {\n\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\tconfig: ''\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion10 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError10 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError10 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator10 = (0, _getIterator3.default)((0, _keys2.default)(codec.parameters)), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n\t\t\t\t\t\t\t\t\t\tvar key = _step10.value;\n\n\t\t\t\t\t\t\t\t\t\tif (paramFmtp.config) paramFmtp.config += ';';\n\n\t\t\t\t\t\t\t\t\t\tparamFmtp.config += key + '=' + codec.parameters[key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError10 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError10 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion10 && _iterator10.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator10.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError10) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError10;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (paramFmtp.config) remoteMediaObj.fmtp.push(paramFmtp);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (codec.rtcpFeedback) {\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion11 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError11 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError11 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator11 = (0, _getIterator3.default)(codec.rtcpFeedback), _step11; !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n\t\t\t\t\t\t\t\t\t\tvar fb = _step11.value;\n\n\t\t\t\t\t\t\t\t\t\tremoteMediaObj.rtcpFb.push({\n\t\t\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\t\t\ttype: fb.type,\n\t\t\t\t\t\t\t\t\t\t\tsubtype: fb.parameter || ''\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError11 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError11 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion11 && _iterator11.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator11.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError11) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError11;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError8 = true;\n\t\t\t\t\t\t_iteratorError8 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion8 && _iterator8.return) {\n\t\t\t\t\t\t\t\t_iterator8.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError8) {\n\t\t\t\t\t\t\t\tthrow _iteratorError8;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.payloads = codecs.map(function (codec) {\n\t\t\t\t\t\treturn codec.payloadType;\n\t\t\t\t\t}).join(' ');\n\n\t\t\t\t\tif (!closed) {\n\t\t\t\t\t\tremoteMediaObj.ext = [];\n\n\t\t\t\t\t\tvar _iteratorNormalCompletion9 = true;\n\t\t\t\t\t\tvar _didIteratorError9 = false;\n\t\t\t\t\t\tvar _iteratorError9 = undefined;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tfor (var _iterator9 = (0, _getIterator3.default)(headerExtensions), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {\n\t\t\t\t\t\t\t\tvar _ext = _step9.value;\n\n\t\t\t\t\t\t\t\t// Ignore MID RTP extension for receiving media.\n\t\t\t\t\t\t\t\tif (_ext.uri === 'urn:ietf:params:rtp-hdrext:sdes:mid') continue;\n\n\t\t\t\t\t\t\t\tremoteMediaObj.ext.push({\n\t\t\t\t\t\t\t\t\turi: _ext.uri,\n\t\t\t\t\t\t\t\t\tvalue: _ext.id\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t_didIteratorError9 = true;\n\t\t\t\t\t\t\t_iteratorError9 = err;\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion9 && _iterator9.return) {\n\t\t\t\t\t\t\t\t\t_iterator9.return();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tif (_didIteratorError9) {\n\t\t\t\t\t\t\t\t\tthrow _iteratorError9;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.rtcpMux = 'rtcp-mux';\n\t\t\t\t\tremoteMediaObj.rtcpRsize = 'rtcp-rsize';\n\n\t\t\t\t\tif (!closed) {\n\t\t\t\t\t\tremoteMediaObj.ssrcs = [];\n\t\t\t\t\t\tremoteMediaObj.ssrcGroups = [];\n\n\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\tid: info.ssrc,\n\t\t\t\t\t\t\tattribute: 'cname',\n\t\t\t\t\t\t\tvalue: info.cname\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (info.rtxSsrc) {\n\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\tid: info.rtxSsrc,\n\t\t\t\t\t\t\t\tattribute: 'cname',\n\t\t\t\t\t\t\t\tvalue: info.cname\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Associate original and retransmission SSRC.\n\t\t\t\t\t\t\tremoteMediaObj.ssrcGroups.push({\n\t\t\t\t\t\t\t\tsemantics: 'FID',\n\t\t\t\t\t\t\t\tssrcs: info.ssrc + ' ' + info.rtxSsrc\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Push it.\n\t\t\t\t\tsdpObj.media.push(remoteMediaObj);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError7 = true;\n\t\t\t\t_iteratorError7 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion7 && _iterator7.return) {\n\t\t\t\t\t\t_iterator7.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError7) {\n\t\t\t\t\t\tthrow _iteratorError7;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar sdp = _sdpform2.default.write(sdpObj);\n\n\t\t\treturn sdp;\n\t\t}\n\t}]);\n\treturn RecvRemoteSdp;\n}(RemoteSdp);\n\nvar RemotePlainRtpSdp = function RemotePlainRtpSdp(direction, rtpParametersByKind) {\n\t(0, _classCallCheck3.default)(this, RemotePlainRtpSdp);\n\n\tlogger.debug('constructor() [direction:%s, rtpParametersByKind:%o]', direction, rtpParametersByKind);\n\n\tswitch (direction) {\n\t\tcase 'send':\n\t\t\treturn new SendRemoteSdp(rtpParametersByKind);\n\t\tcase 'recv':\n\t\t\treturn new RecvRemoteSdp(rtpParametersByKind);\n\t}\n};\n\nexports.default = RemotePlainRtpSdp;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/sdp/RemotePlanBSdp.js\":\n/*!**************************************************!*\\\n  !*** ./lib/mslib/handlers/sdp/RemotePlanBSdp.js ***!\n  \\**************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/keys.js\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _sdpform = __webpack_require__(/*! ../../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _utils = __webpack_require__(/*! ../../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('<RemotePlanBSdp>');\n\nvar RemoteSdp = function () {\n\tfunction RemoteSdp(rtpParametersByKind) {\n\t\t(0, _classCallCheck3.default)(this, RemoteSdp);\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\tthis._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Transport local parameters, including DTLS parameteres.\n\t\t// @type {Object}\n\t\tthis._transportLocalParameters = null;\n\n\t\t// Transport remote parameters, including ICE parameters, ICE candidates\n\t\t// and DTLS parameteres.\n\t\t// @type {Object}\n\t\tthis._transportRemoteParameters = null;\n\n\t\t// SDP global fields.\n\t\t// @type {Object}\n\t\tthis._sdpGlobalFields = {\n\t\t\tid: utils.randomNumber(),\n\t\t\tversion: 0\n\t\t};\n\t}\n\n\t(0, _createClass3.default)(RemoteSdp, [{\n\t\tkey: 'setTransportLocalParameters',\n\t\tvalue: function setTransportLocalParameters(transportLocalParameters) {\n\t\t\tlogger.debug('setTransportLocalParameters() [transportLocalParameters:%o]', transportLocalParameters);\n\n\t\t\tthis._transportLocalParameters = transportLocalParameters;\n\t\t}\n\t}, {\n\t\tkey: 'setTransportRemoteParameters',\n\t\tvalue: function setTransportRemoteParameters(transportRemoteParameters) {\n\t\t\tlogger.debug('setTransportRemoteParameters() [transportRemoteParameters:%o]', transportRemoteParameters);\n\n\t\t\tthis._transportRemoteParameters = transportRemoteParameters;\n\t\t}\n\t}, {\n\t\tkey: 'updateTransportRemoteIceParameters',\n\t\tvalue: function updateTransportRemoteIceParameters(remoteIceParameters) {\n\t\t\tlogger.debug('updateTransportRemoteIceParameters() [remoteIceParameters:%o]', remoteIceParameters);\n\n\t\t\tthis._transportRemoteParameters.iceParameters = remoteIceParameters;\n\t\t}\n\t}]);\n\treturn RemoteSdp;\n}();\n\nvar SendRemoteSdp = function (_RemoteSdp) {\n\t(0, _inherits3.default)(SendRemoteSdp, _RemoteSdp);\n\n\tfunction SendRemoteSdp(rtpParametersByKind) {\n\t\t(0, _classCallCheck3.default)(this, SendRemoteSdp);\n\t\treturn (0, _possibleConstructorReturn3.default)(this, (SendRemoteSdp.__proto__ || (0, _getPrototypeOf2.default)(SendRemoteSdp)).call(this, rtpParametersByKind));\n\t}\n\n\t(0, _createClass3.default)(SendRemoteSdp, [{\n\t\tkey: 'createAnswerSdp',\n\t\tvalue: function createAnswerSdp(localSdpObj) {\n\t\t\tlogger.debug('createAnswerSdp()');\n\n\t\t\tif (!this._transportLocalParameters) throw new Error('no transport local parameters');else if (!this._transportRemoteParameters) throw new Error('no transport remote parameters');\n\n\t\t\tvar remoteIceParameters = this._transportRemoteParameters.iceParameters;\n\t\t\tvar remoteIceCandidates = this._transportRemoteParameters.iceCandidates;\n\t\t\tvar remoteDtlsParameters = this._transportRemoteParameters.dtlsParameters;\n\t\t\tvar sdpObj = {};\n\t\t\tvar mids = (localSdpObj.media || []).map(function (m) {\n\t\t\t\treturn String(m.mid);\n\t\t\t});\n\n\t\t\t// Increase our SDP version.\n\t\t\tthis._sdpGlobalFields.version++;\n\n\t\t\tsdpObj.version = 0;\n\t\t\tsdpObj.origin = {\n\t\t\t\taddress: '0.0.0.0',\n\t\t\t\tipVer: 4,\n\t\t\t\tnetType: 'IN',\n\t\t\t\tsessionId: this._sdpGlobalFields.id,\n\t\t\t\tsessionVersion: this._sdpGlobalFields.version,\n\t\t\t\tusername: 'mediasoup-client'\n\t\t\t};\n\t\t\tsdpObj.name = '-';\n\t\t\tsdpObj.timing = { start: 0, stop: 0 };\n\t\t\tsdpObj.icelite = remoteIceParameters.iceLite ? 'ice-lite' : null;\n\t\t\tsdpObj.msidSemantic = {\n\t\t\t\tsemantic: 'WMS',\n\t\t\t\ttoken: '*'\n\t\t\t};\n\t\t\tsdpObj.groups = [{\n\t\t\t\ttype: 'BUNDLE',\n\t\t\t\tmids: mids.join(' ')\n\t\t\t}];\n\t\t\tsdpObj.media = [];\n\n\t\t\t// NOTE: We take the latest fingerprint.\n\t\t\tvar numFingerprints = remoteDtlsParameters.fingerprints.length;\n\n\t\t\tsdpObj.fingerprint = {\n\t\t\t\ttype: remoteDtlsParameters.fingerprints[numFingerprints - 1].algorithm,\n\t\t\t\thash: remoteDtlsParameters.fingerprints[numFingerprints - 1].value\n\t\t\t};\n\n\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\tvar _didIteratorError = false;\n\t\t\tvar _iteratorError = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator = (0, _getIterator3.default)(localSdpObj.media || []), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\t\tvar localMediaObj = _step.value;\n\n\t\t\t\t\tvar kind = localMediaObj.type;\n\t\t\t\t\tvar codecs = this._rtpParametersByKind[kind].codecs;\n\t\t\t\t\tvar headerExtensions = this._rtpParametersByKind[kind].headerExtensions;\n\t\t\t\t\tvar remoteMediaObj = {};\n\n\t\t\t\t\tremoteMediaObj.type = localMediaObj.type;\n\t\t\t\t\tremoteMediaObj.port = 7;\n\t\t\t\t\tremoteMediaObj.protocol = 'RTP/SAVPF';\n\t\t\t\t\tremoteMediaObj.connection = { ip: '127.0.0.1', version: 4 };\n\t\t\t\t\tremoteMediaObj.mid = localMediaObj.mid;\n\n\t\t\t\t\tremoteMediaObj.iceUfrag = remoteIceParameters.usernameFragment;\n\t\t\t\t\tremoteMediaObj.icePwd = remoteIceParameters.password;\n\t\t\t\t\tremoteMediaObj.candidates = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\t\t\tvar _didIteratorError2 = false;\n\t\t\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(remoteIceCandidates), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\t\t\tvar candidate = _step2.value;\n\n\t\t\t\t\t\t\tvar candidateObj = {};\n\n\t\t\t\t\t\t\t// mediasoup does not support non rtcp-mux so candidates component is\n\t\t\t\t\t\t\t// always RTP (1).\n\t\t\t\t\t\t\tcandidateObj.component = 1;\n\t\t\t\t\t\t\tcandidateObj.foundation = candidate.foundation;\n\t\t\t\t\t\t\tcandidateObj.ip = candidate.ip;\n\t\t\t\t\t\t\tcandidateObj.port = candidate.port;\n\t\t\t\t\t\t\tcandidateObj.priority = candidate.priority;\n\t\t\t\t\t\t\tcandidateObj.transport = candidate.protocol;\n\t\t\t\t\t\t\tcandidateObj.type = candidate.type;\n\t\t\t\t\t\t\tif (candidate.tcpType) candidateObj.tcptype = candidate.tcpType;\n\n\t\t\t\t\t\t\tremoteMediaObj.candidates.push(candidateObj);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t\t\t_iteratorError2 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.endOfCandidates = 'end-of-candidates';\n\n\t\t\t\t\t// Announce support for ICE renomination.\n\t\t\t\t\t// https://tools.ietf.org/html/draft-thatcher-ice-renomination\n\t\t\t\t\tremoteMediaObj.iceOptions = 'renomination';\n\n\t\t\t\t\tswitch (remoteDtlsParameters.role) {\n\t\t\t\t\t\tcase 'client':\n\t\t\t\t\t\t\tremoteMediaObj.setup = 'active';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'server':\n\t\t\t\t\t\t\tremoteMediaObj.setup = 'passive';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (localMediaObj.direction) {\n\t\t\t\t\t\tcase 'sendrecv':\n\t\t\t\t\t\tcase 'sendonly':\n\t\t\t\t\t\t\tremoteMediaObj.direction = 'recvonly';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'recvonly':\n\t\t\t\t\t\tcase 'inactive':\n\t\t\t\t\t\t\tremoteMediaObj.direction = 'inactive';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If video, be ready for simulcast.\n\t\t\t\t\tif (kind === 'video') remoteMediaObj.xGoogleFlag = 'conference';\n\n\t\t\t\t\tremoteMediaObj.rtp = [];\n\t\t\t\t\tremoteMediaObj.rtcpFb = [];\n\t\t\t\t\tremoteMediaObj.fmtp = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion3 = true;\n\t\t\t\t\tvar _didIteratorError3 = false;\n\t\t\t\t\tvar _iteratorError3 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator3 = (0, _getIterator3.default)(codecs), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\t\t\t\t\tvar codec = _step3.value;\n\n\t\t\t\t\t\t\tvar rtp = {\n\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\tcodec: codec.name,\n\t\t\t\t\t\t\t\trate: codec.clockRate\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (codec.channels > 1) rtp.encoding = codec.channels;\n\n\t\t\t\t\t\t\tremoteMediaObj.rtp.push(rtp);\n\n\t\t\t\t\t\t\tif (codec.parameters) {\n\t\t\t\t\t\t\t\tvar paramFmtp = {\n\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\tconfig: ''\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion5 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError5 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError5 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator5 = (0, _getIterator3.default)((0, _keys2.default)(codec.parameters)), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n\t\t\t\t\t\t\t\t\t\tvar key = _step5.value;\n\n\t\t\t\t\t\t\t\t\t\tif (paramFmtp.config) paramFmtp.config += ';';\n\n\t\t\t\t\t\t\t\t\t\tparamFmtp.config += key + '=' + codec.parameters[key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError5 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError5 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion5 && _iterator5.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator5.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError5) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError5;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (paramFmtp.config) remoteMediaObj.fmtp.push(paramFmtp);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (codec.rtcpFeedback) {\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion6 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError6 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError6 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator6 = (0, _getIterator3.default)(codec.rtcpFeedback), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n\t\t\t\t\t\t\t\t\t\tvar fb = _step6.value;\n\n\t\t\t\t\t\t\t\t\t\tremoteMediaObj.rtcpFb.push({\n\t\t\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\t\t\ttype: fb.type,\n\t\t\t\t\t\t\t\t\t\t\tsubtype: fb.parameter || ''\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError6 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError6 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion6 && _iterator6.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator6.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError6) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError6;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError3 = true;\n\t\t\t\t\t\t_iteratorError3 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t\t\t\t\t_iterator3.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError3) {\n\t\t\t\t\t\t\t\tthrow _iteratorError3;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.payloads = codecs.map(function (codec) {\n\t\t\t\t\t\treturn codec.payloadType;\n\t\t\t\t\t}).join(' ');\n\n\t\t\t\t\tremoteMediaObj.ext = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion4 = true;\n\t\t\t\t\tvar _didIteratorError4 = false;\n\t\t\t\t\tvar _iteratorError4 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvar _loop = function _loop() {\n\t\t\t\t\t\t\tvar ext = _step4.value;\n\n\t\t\t\t\t\t\t// Don't add a header extension if not present in the offer.\n\t\t\t\t\t\t\tvar matchedLocalExt = (localMediaObj.ext || []).find(function (localExt) {\n\t\t\t\t\t\t\t\treturn localExt.uri === ext.uri;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!matchedLocalExt) return 'continue';\n\n\t\t\t\t\t\t\tremoteMediaObj.ext.push({\n\t\t\t\t\t\t\t\turi: ext.uri,\n\t\t\t\t\t\t\t\tvalue: ext.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tfor (var _iterator4 = (0, _getIterator3.default)(headerExtensions), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n\t\t\t\t\t\t\tvar _ret = _loop();\n\n\t\t\t\t\t\t\tif (_ret === 'continue') continue;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError4 = true;\n\t\t\t\t\t\t_iteratorError4 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion4 && _iterator4.return) {\n\t\t\t\t\t\t\t\t_iterator4.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError4) {\n\t\t\t\t\t\t\t\tthrow _iteratorError4;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.rtcpMux = 'rtcp-mux';\n\t\t\t\t\tremoteMediaObj.rtcpRsize = 'rtcp-rsize';\n\n\t\t\t\t\t// Push it.\n\t\t\t\t\tsdpObj.media.push(remoteMediaObj);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError = true;\n\t\t\t\t_iteratorError = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar sdp = _sdpform2.default.write(sdpObj);\n\n\t\t\treturn sdp;\n\t\t}\n\t}]);\n\treturn SendRemoteSdp;\n}(RemoteSdp);\n\nvar RecvRemoteSdp = function (_RemoteSdp2) {\n\t(0, _inherits3.default)(RecvRemoteSdp, _RemoteSdp2);\n\n\tfunction RecvRemoteSdp(rtpParametersByKind) {\n\t\t(0, _classCallCheck3.default)(this, RecvRemoteSdp);\n\t\treturn (0, _possibleConstructorReturn3.default)(this, (RecvRemoteSdp.__proto__ || (0, _getPrototypeOf2.default)(RecvRemoteSdp)).call(this, rtpParametersByKind));\n\t}\n\n\t/**\n  * @param {Array<String>} kinds - Media kinds.\n  * @param {Array<Object>} consumerInfos - Consumer informations.\n  * @return {String}\n  */\n\n\n\t(0, _createClass3.default)(RecvRemoteSdp, [{\n\t\tkey: 'createOfferSdp',\n\t\tvalue: function createOfferSdp(kinds, consumerInfos) {\n\t\t\tvar _this3 = this;\n\n\t\t\tlogger.debug('createOfferSdp()');\n\n\t\t\tif (!this._transportRemoteParameters) throw new Error('no transport remote parameters');\n\n\t\t\tvar remoteIceParameters = this._transportRemoteParameters.iceParameters;\n\t\t\tvar remoteIceCandidates = this._transportRemoteParameters.iceCandidates;\n\t\t\tvar remoteDtlsParameters = this._transportRemoteParameters.dtlsParameters;\n\t\t\tvar sdpObj = {};\n\t\t\tvar mids = kinds;\n\n\t\t\t// Increase our SDP version.\n\t\t\tthis._sdpGlobalFields.version++;\n\n\t\t\tsdpObj.version = 0;\n\t\t\tsdpObj.origin = {\n\t\t\t\taddress: '0.0.0.0',\n\t\t\t\tipVer: 4,\n\t\t\t\tnetType: 'IN',\n\t\t\t\tsessionId: this._sdpGlobalFields.id,\n\t\t\t\tsessionVersion: this._sdpGlobalFields.version,\n\t\t\t\tusername: 'mediasoup-client'\n\t\t\t};\n\t\t\tsdpObj.name = '-';\n\t\t\tsdpObj.timing = { start: 0, stop: 0 };\n\t\t\tsdpObj.icelite = remoteIceParameters.iceLite ? 'ice-lite' : null;\n\t\t\tsdpObj.msidSemantic = {\n\t\t\t\tsemantic: 'WMS',\n\t\t\t\ttoken: '*'\n\t\t\t};\n\t\t\tsdpObj.groups = [{\n\t\t\t\ttype: 'BUNDLE',\n\t\t\t\tmids: mids.join(' ')\n\t\t\t}];\n\t\t\tsdpObj.media = [];\n\n\t\t\t// NOTE: We take the latest fingerprint.\n\t\t\tvar numFingerprints = remoteDtlsParameters.fingerprints.length;\n\n\t\t\tsdpObj.fingerprint = {\n\t\t\t\ttype: remoteDtlsParameters.fingerprints[numFingerprints - 1].algorithm,\n\t\t\t\thash: remoteDtlsParameters.fingerprints[numFingerprints - 1].value\n\t\t\t};\n\n\t\t\tvar _iteratorNormalCompletion7 = true;\n\t\t\tvar _didIteratorError7 = false;\n\t\t\tvar _iteratorError7 = undefined;\n\n\t\t\ttry {\n\t\t\t\tvar _loop2 = function _loop2() {\n\t\t\t\t\tvar kind = _step7.value;\n\n\t\t\t\t\tvar codecs = _this3._rtpParametersByKind[kind].codecs;\n\t\t\t\t\tvar headerExtensions = _this3._rtpParametersByKind[kind].headerExtensions;\n\t\t\t\t\tvar remoteMediaObj = {};\n\n\t\t\t\t\tremoteMediaObj.type = kind;\n\t\t\t\t\tremoteMediaObj.port = 7;\n\t\t\t\t\tremoteMediaObj.protocol = 'RTP/SAVPF';\n\t\t\t\t\tremoteMediaObj.connection = { ip: '127.0.0.1', version: 4 };\n\t\t\t\t\tremoteMediaObj.mid = kind;\n\n\t\t\t\t\tremoteMediaObj.iceUfrag = remoteIceParameters.usernameFragment;\n\t\t\t\t\tremoteMediaObj.icePwd = remoteIceParameters.password;\n\t\t\t\t\tremoteMediaObj.candidates = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion8 = true;\n\t\t\t\t\tvar _didIteratorError8 = false;\n\t\t\t\t\tvar _iteratorError8 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator8 = (0, _getIterator3.default)(remoteIceCandidates), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n\t\t\t\t\t\t\tvar candidate = _step8.value;\n\n\t\t\t\t\t\t\tvar candidateObj = {};\n\n\t\t\t\t\t\t\t// mediasoup does not support non rtcp-mux so candidates component is\n\t\t\t\t\t\t\t// always RTP (1).\n\t\t\t\t\t\t\tcandidateObj.component = 1;\n\t\t\t\t\t\t\tcandidateObj.foundation = candidate.foundation;\n\t\t\t\t\t\t\tcandidateObj.ip = candidate.ip;\n\t\t\t\t\t\t\tcandidateObj.port = candidate.port;\n\t\t\t\t\t\t\tcandidateObj.priority = candidate.priority;\n\t\t\t\t\t\t\tcandidateObj.transport = candidate.protocol;\n\t\t\t\t\t\t\tcandidateObj.type = candidate.type;\n\t\t\t\t\t\t\tif (candidate.tcpType) candidateObj.tcptype = candidate.tcpType;\n\n\t\t\t\t\t\t\tremoteMediaObj.candidates.push(candidateObj);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError8 = true;\n\t\t\t\t\t\t_iteratorError8 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion8 && _iterator8.return) {\n\t\t\t\t\t\t\t\t_iterator8.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError8) {\n\t\t\t\t\t\t\t\tthrow _iteratorError8;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.endOfCandidates = 'end-of-candidates';\n\n\t\t\t\t\t// Announce support for ICE renomination.\n\t\t\t\t\t// https://tools.ietf.org/html/draft-thatcher-ice-renomination\n\t\t\t\t\tremoteMediaObj.iceOptions = 'renomination';\n\n\t\t\t\t\tremoteMediaObj.setup = 'actpass';\n\n\t\t\t\t\tif (consumerInfos.some(function (info) {\n\t\t\t\t\t\treturn info.kind === kind;\n\t\t\t\t\t})) remoteMediaObj.direction = 'sendonly';else remoteMediaObj.direction = 'inactive';\n\n\t\t\t\t\tremoteMediaObj.rtp = [];\n\t\t\t\t\tremoteMediaObj.rtcpFb = [];\n\t\t\t\t\tremoteMediaObj.fmtp = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion9 = true;\n\t\t\t\t\tvar _didIteratorError9 = false;\n\t\t\t\t\tvar _iteratorError9 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator9 = (0, _getIterator3.default)(codecs), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {\n\t\t\t\t\t\t\tvar codec = _step9.value;\n\n\t\t\t\t\t\t\tvar rtp = {\n\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\tcodec: codec.name,\n\t\t\t\t\t\t\t\trate: codec.clockRate\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (codec.channels > 1) rtp.encoding = codec.channels;\n\n\t\t\t\t\t\t\tremoteMediaObj.rtp.push(rtp);\n\n\t\t\t\t\t\t\tif (codec.parameters) {\n\t\t\t\t\t\t\t\tvar paramFmtp = {\n\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\tconfig: ''\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion12 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError12 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError12 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator12 = (0, _getIterator3.default)((0, _keys2.default)(codec.parameters)), _step12; !(_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done); _iteratorNormalCompletion12 = true) {\n\t\t\t\t\t\t\t\t\t\tvar key = _step12.value;\n\n\t\t\t\t\t\t\t\t\t\tif (paramFmtp.config) paramFmtp.config += ';';\n\n\t\t\t\t\t\t\t\t\t\tparamFmtp.config += key + '=' + codec.parameters[key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError12 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError12 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion12 && _iterator12.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator12.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError12) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError12;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (paramFmtp.config) remoteMediaObj.fmtp.push(paramFmtp);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (codec.rtcpFeedback) {\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion13 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError13 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError13 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator13 = (0, _getIterator3.default)(codec.rtcpFeedback), _step13; !(_iteratorNormalCompletion13 = (_step13 = _iterator13.next()).done); _iteratorNormalCompletion13 = true) {\n\t\t\t\t\t\t\t\t\t\tvar fb = _step13.value;\n\n\t\t\t\t\t\t\t\t\t\tremoteMediaObj.rtcpFb.push({\n\t\t\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\t\t\ttype: fb.type,\n\t\t\t\t\t\t\t\t\t\t\tsubtype: fb.parameter || ''\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError13 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError13 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion13 && _iterator13.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator13.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError13) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError13;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError9 = true;\n\t\t\t\t\t\t_iteratorError9 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion9 && _iterator9.return) {\n\t\t\t\t\t\t\t\t_iterator9.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError9) {\n\t\t\t\t\t\t\t\tthrow _iteratorError9;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.payloads = codecs.map(function (codec) {\n\t\t\t\t\t\treturn codec.payloadType;\n\t\t\t\t\t}).join(' ');\n\n\t\t\t\t\tremoteMediaObj.ext = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion10 = true;\n\t\t\t\t\tvar _didIteratorError10 = false;\n\t\t\t\t\tvar _iteratorError10 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator10 = (0, _getIterator3.default)(headerExtensions), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n\t\t\t\t\t\t\tvar _ext = _step10.value;\n\n\t\t\t\t\t\t\t// Ignore MID RTP extension for receiving media.\n\t\t\t\t\t\t\tif (_ext.uri === 'urn:ietf:params:rtp-hdrext:sdes:mid') continue;\n\n\t\t\t\t\t\t\tremoteMediaObj.ext.push({\n\t\t\t\t\t\t\t\turi: _ext.uri,\n\t\t\t\t\t\t\t\tvalue: _ext.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError10 = true;\n\t\t\t\t\t\t_iteratorError10 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion10 && _iterator10.return) {\n\t\t\t\t\t\t\t\t_iterator10.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError10) {\n\t\t\t\t\t\t\t\tthrow _iteratorError10;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.rtcpMux = 'rtcp-mux';\n\t\t\t\t\tremoteMediaObj.rtcpRsize = 'rtcp-rsize';\n\n\t\t\t\t\tremoteMediaObj.ssrcs = [];\n\t\t\t\t\tremoteMediaObj.ssrcGroups = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion11 = true;\n\t\t\t\t\tvar _didIteratorError11 = false;\n\t\t\t\t\tvar _iteratorError11 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator11 = (0, _getIterator3.default)(consumerInfos), _step11; !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n\t\t\t\t\t\t\tvar info = _step11.value;\n\n\t\t\t\t\t\t\tif (info.kind !== kind) continue;\n\n\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\tid: info.ssrc,\n\t\t\t\t\t\t\t\tattribute: 'msid',\n\t\t\t\t\t\t\t\tvalue: info.streamId + ' ' + info.trackId\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\tid: info.ssrc,\n\t\t\t\t\t\t\t\tattribute: 'mslabel',\n\t\t\t\t\t\t\t\tvalue: info.streamId\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\tid: info.ssrc,\n\t\t\t\t\t\t\t\tattribute: 'label',\n\t\t\t\t\t\t\t\tvalue: info.trackId\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\tid: info.ssrc,\n\t\t\t\t\t\t\t\tattribute: 'cname',\n\t\t\t\t\t\t\t\tvalue: info.cname\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (info.rtxSsrc) {\n\t\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\t\tid: info.rtxSsrc,\n\t\t\t\t\t\t\t\t\tattribute: 'msid',\n\t\t\t\t\t\t\t\t\tvalue: info.streamId + ' ' + info.trackId\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\t\tid: info.rtxSsrc,\n\t\t\t\t\t\t\t\t\tattribute: 'mslabel',\n\t\t\t\t\t\t\t\t\tvalue: info.streamId\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\t\tid: info.rtxSsrc,\n\t\t\t\t\t\t\t\t\tattribute: 'label',\n\t\t\t\t\t\t\t\t\tvalue: info.trackId\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\t\tid: info.rtxSsrc,\n\t\t\t\t\t\t\t\t\tattribute: 'cname',\n\t\t\t\t\t\t\t\t\tvalue: info.cname\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Associate original and retransmission SSRC.\n\t\t\t\t\t\t\t\tremoteMediaObj.ssrcGroups.push({\n\t\t\t\t\t\t\t\t\tsemantics: 'FID',\n\t\t\t\t\t\t\t\t\tssrcs: info.ssrc + ' ' + info.rtxSsrc\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Push it.\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError11 = true;\n\t\t\t\t\t\t_iteratorError11 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion11 && _iterator11.return) {\n\t\t\t\t\t\t\t\t_iterator11.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError11) {\n\t\t\t\t\t\t\t\tthrow _iteratorError11;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tsdpObj.media.push(remoteMediaObj);\n\t\t\t\t};\n\n\t\t\t\tfor (var _iterator7 = (0, _getIterator3.default)(kinds), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n\t\t\t\t\t_loop2();\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError7 = true;\n\t\t\t\t_iteratorError7 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion7 && _iterator7.return) {\n\t\t\t\t\t\t_iterator7.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError7) {\n\t\t\t\t\t\tthrow _iteratorError7;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar sdp = _sdpform2.default.write(sdpObj);\n\n\t\t\treturn sdp;\n\t\t}\n\t}]);\n\treturn RecvRemoteSdp;\n}(RemoteSdp);\n\nvar RemotePlanBSdp = function RemotePlanBSdp(direction, rtpParametersByKind) {\n\t(0, _classCallCheck3.default)(this, RemotePlanBSdp);\n\n\tlogger.debug('constructor() [direction:%s, rtpParametersByKind:%o]', direction, rtpParametersByKind);\n\n\tswitch (direction) {\n\t\tcase 'send':\n\t\t\treturn new SendRemoteSdp(rtpParametersByKind);\n\t\tcase 'recv':\n\t\t\treturn new RecvRemoteSdp(rtpParametersByKind);\n\t}\n};\n\nexports.default = RemotePlanBSdp;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/sdp/RemoteUnifiedPlanSdp.js\":\n/*!********************************************************!*\\\n  !*** ./lib/mslib/handlers/sdp/RemoteUnifiedPlanSdp.js ***!\n  \\********************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/keys.js\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _sdpform = __webpack_require__(/*! ../../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nvar _Logger = __webpack_require__(/*! ../../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _utils = __webpack_require__(/*! ../../utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('<RemoteUnifiedPlanSdp>');\n\nvar RemoteSdp = function () {\n\tfunction RemoteSdp(rtpParametersByKind) {\n\t\t(0, _classCallCheck3.default)(this, RemoteSdp);\n\n\t\t// Generic sending RTP parameters for audio and video.\n\t\t// @type {Object}\n\t\tthis._rtpParametersByKind = rtpParametersByKind;\n\n\t\t// Transport local parameters, including DTLS parameteres.\n\t\t// @type {Object}\n\t\tthis._transportLocalParameters = null;\n\n\t\t// Transport remote parameters, including ICE parameters, ICE candidates\n\t\t// and DTLS parameteres.\n\t\t// @type {Object}\n\t\tthis._transportRemoteParameters = null;\n\n\t\t// SDP global fields.\n\t\t// @type {Object}\n\t\tthis._sdpGlobalFields = {\n\t\t\tid: utils.randomNumber(),\n\t\t\tversion: 0\n\t\t};\n\t}\n\n\t(0, _createClass3.default)(RemoteSdp, [{\n\t\tkey: 'setTransportLocalParameters',\n\t\tvalue: function setTransportLocalParameters(transportLocalParameters) {\n\t\t\tlogger.debug('setTransportLocalParameters() [transportLocalParameters:%o]', transportLocalParameters);\n\n\t\t\tthis._transportLocalParameters = transportLocalParameters;\n\t\t}\n\t}, {\n\t\tkey: 'setTransportRemoteParameters',\n\t\tvalue: function setTransportRemoteParameters(transportRemoteParameters) {\n\t\t\tlogger.debug('setTransportRemoteParameters() [transportRemoteParameters:%o]', transportRemoteParameters);\n\n\t\t\tthis._transportRemoteParameters = transportRemoteParameters;\n\t\t}\n\t}, {\n\t\tkey: 'updateTransportRemoteIceParameters',\n\t\tvalue: function updateTransportRemoteIceParameters(remoteIceParameters) {\n\t\t\tlogger.debug('updateTransportRemoteIceParameters() [remoteIceParameters:%o]', remoteIceParameters);\n\n\t\t\tthis._transportRemoteParameters.iceParameters = remoteIceParameters;\n\t\t}\n\t}]);\n\treturn RemoteSdp;\n}();\n\nvar SendRemoteSdp = function (_RemoteSdp) {\n\t(0, _inherits3.default)(SendRemoteSdp, _RemoteSdp);\n\n\tfunction SendRemoteSdp(rtpParametersByKind) {\n\t\t(0, _classCallCheck3.default)(this, SendRemoteSdp);\n\t\treturn (0, _possibleConstructorReturn3.default)(this, (SendRemoteSdp.__proto__ || (0, _getPrototypeOf2.default)(SendRemoteSdp)).call(this, rtpParametersByKind));\n\t}\n\n\t(0, _createClass3.default)(SendRemoteSdp, [{\n\t\tkey: 'createAnswerSdp',\n\t\tvalue: function createAnswerSdp(localSdpObj) {\n\t\t\tlogger.debug('createAnswerSdp()');\n\n\t\t\tif (!this._transportLocalParameters) throw new Error('no transport local parameters');else if (!this._transportRemoteParameters) throw new Error('no transport remote parameters');\n\n\t\t\tvar remoteIceParameters = this._transportRemoteParameters.iceParameters;\n\t\t\tvar remoteIceCandidates = this._transportRemoteParameters.iceCandidates;\n\t\t\tvar remoteDtlsParameters = this._transportRemoteParameters.dtlsParameters;\n\t\t\tvar sdpObj = {};\n\t\t\tvar bundleMids = (localSdpObj.media || []).filter(function (m) {\n\t\t\t\treturn m.hasOwnProperty('mid');\n\t\t\t}).map(function (m) {\n\t\t\t\treturn String(m.mid);\n\t\t\t});\n\n\t\t\t// Increase our SDP version.\n\t\t\tthis._sdpGlobalFields.version++;\n\n\t\t\tsdpObj.version = 0;\n\t\t\tsdpObj.origin = {\n\t\t\t\taddress: '0.0.0.0',\n\t\t\t\tipVer: 4,\n\t\t\t\tnetType: 'IN',\n\t\t\t\tsessionId: this._sdpGlobalFields.id,\n\t\t\t\tsessionVersion: this._sdpGlobalFields.version,\n\t\t\t\tusername: 'mediasoup-client'\n\t\t\t};\n\t\t\tsdpObj.name = '-';\n\t\t\tsdpObj.timing = { start: 0, stop: 0 };\n\t\t\tsdpObj.icelite = remoteIceParameters.iceLite ? 'ice-lite' : null;\n\t\t\tsdpObj.msidSemantic = {\n\t\t\t\tsemantic: 'WMS',\n\t\t\t\ttoken: '*'\n\t\t\t};\n\n\t\t\tif (bundleMids.length > 0) {\n\t\t\t\tsdpObj.groups = [{\n\t\t\t\t\ttype: 'BUNDLE',\n\t\t\t\t\tmids: bundleMids.join(' ')\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\tsdpObj.media = [];\n\n\t\t\t// NOTE: We take the latest fingerprint.\n\t\t\tvar numFingerprints = remoteDtlsParameters.fingerprints.length;\n\n\t\t\tsdpObj.fingerprint = {\n\t\t\t\ttype: remoteDtlsParameters.fingerprints[numFingerprints - 1].algorithm,\n\t\t\t\thash: remoteDtlsParameters.fingerprints[numFingerprints - 1].value\n\t\t\t};\n\n\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\tvar _didIteratorError = false;\n\t\t\tvar _iteratorError = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator = (0, _getIterator3.default)(localSdpObj.media || []), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\t\tvar localMediaObj = _step.value;\n\n\t\t\t\t\tvar closed = localMediaObj.direction === 'inactive';\n\t\t\t\t\tvar kind = localMediaObj.type;\n\t\t\t\t\tvar codecs = this._rtpParametersByKind[kind].codecs;\n\t\t\t\t\tvar headerExtensions = this._rtpParametersByKind[kind].headerExtensions;\n\t\t\t\t\tvar remoteMediaObj = {};\n\n\t\t\t\t\tremoteMediaObj.type = localMediaObj.type;\n\t\t\t\t\tremoteMediaObj.port = 7;\n\t\t\t\t\tremoteMediaObj.protocol = 'RTP/SAVPF';\n\t\t\t\t\tremoteMediaObj.connection = { ip: '127.0.0.1', version: 4 };\n\t\t\t\t\tremoteMediaObj.mid = localMediaObj.mid;\n\n\t\t\t\t\tremoteMediaObj.iceUfrag = remoteIceParameters.usernameFragment;\n\t\t\t\t\tremoteMediaObj.icePwd = remoteIceParameters.password;\n\t\t\t\t\tremoteMediaObj.candidates = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\t\t\tvar _didIteratorError2 = false;\n\t\t\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(remoteIceCandidates), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\t\t\tvar candidate = _step2.value;\n\n\t\t\t\t\t\t\tvar candidateObj = {};\n\n\t\t\t\t\t\t\t// mediasoup does not support non rtcp-mux so candidates component is\n\t\t\t\t\t\t\t// always RTP (1).\n\t\t\t\t\t\t\tcandidateObj.component = 1;\n\t\t\t\t\t\t\tcandidateObj.foundation = candidate.foundation;\n\t\t\t\t\t\t\tcandidateObj.ip = candidate.ip;\n\t\t\t\t\t\t\tcandidateObj.port = candidate.port;\n\t\t\t\t\t\t\tcandidateObj.priority = candidate.priority;\n\t\t\t\t\t\t\tcandidateObj.transport = candidate.protocol;\n\t\t\t\t\t\t\tcandidateObj.type = candidate.type;\n\t\t\t\t\t\t\tif (candidate.tcpType) candidateObj.tcptype = candidate.tcpType;\n\n\t\t\t\t\t\t\tremoteMediaObj.candidates.push(candidateObj);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t\t\t_iteratorError2 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.endOfCandidates = 'end-of-candidates';\n\n\t\t\t\t\t// Announce support for ICE renomination.\n\t\t\t\t\t// https://tools.ietf.org/html/draft-thatcher-ice-renomination\n\t\t\t\t\tremoteMediaObj.iceOptions = 'renomination';\n\n\t\t\t\t\tswitch (remoteDtlsParameters.role) {\n\t\t\t\t\t\tcase 'client':\n\t\t\t\t\t\t\tremoteMediaObj.setup = 'active';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'server':\n\t\t\t\t\t\t\tremoteMediaObj.setup = 'passive';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (localMediaObj.direction) {\n\t\t\t\t\t\tcase 'sendrecv':\n\t\t\t\t\t\tcase 'sendonly':\n\t\t\t\t\t\t\tremoteMediaObj.direction = 'recvonly';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'recvonly':\n\t\t\t\t\t\tcase 'inactive':\n\t\t\t\t\t\t\tremoteMediaObj.direction = 'inactive';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.rtp = [];\n\t\t\t\t\tremoteMediaObj.rtcpFb = [];\n\t\t\t\t\tremoteMediaObj.fmtp = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion3 = true;\n\t\t\t\t\tvar _didIteratorError3 = false;\n\t\t\t\t\tvar _iteratorError3 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator3 = (0, _getIterator3.default)(codecs), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\t\t\t\t\tvar codec = _step3.value;\n\n\t\t\t\t\t\t\tvar rtp = {\n\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\tcodec: codec.name,\n\t\t\t\t\t\t\t\trate: codec.clockRate\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (codec.channels > 1) rtp.encoding = codec.channels;\n\n\t\t\t\t\t\t\tremoteMediaObj.rtp.push(rtp);\n\n\t\t\t\t\t\t\tif (codec.parameters) {\n\t\t\t\t\t\t\t\tvar paramFmtp = {\n\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\tconfig: ''\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion6 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError6 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError6 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator6 = (0, _getIterator3.default)((0, _keys2.default)(codec.parameters)), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n\t\t\t\t\t\t\t\t\t\tvar key = _step6.value;\n\n\t\t\t\t\t\t\t\t\t\tif (paramFmtp.config) paramFmtp.config += ';';\n\n\t\t\t\t\t\t\t\t\t\tparamFmtp.config += key + '=' + codec.parameters[key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError6 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError6 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion6 && _iterator6.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator6.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError6) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError6;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (paramFmtp.config) remoteMediaObj.fmtp.push(paramFmtp);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (codec.rtcpFeedback) {\n\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion7 = true;\n\t\t\t\t\t\t\t\tvar _didIteratorError7 = false;\n\t\t\t\t\t\t\t\tvar _iteratorError7 = undefined;\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tfor (var _iterator7 = (0, _getIterator3.default)(codec.rtcpFeedback), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n\t\t\t\t\t\t\t\t\t\tvar fb = _step7.value;\n\n\t\t\t\t\t\t\t\t\t\tremoteMediaObj.rtcpFb.push({\n\t\t\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\t\t\ttype: fb.type,\n\t\t\t\t\t\t\t\t\t\t\tsubtype: fb.parameter || ''\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t_didIteratorError7 = true;\n\t\t\t\t\t\t\t\t\t_iteratorError7 = err;\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion7 && _iterator7.return) {\n\t\t\t\t\t\t\t\t\t\t\t_iterator7.return();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tif (_didIteratorError7) {\n\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError7;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError3 = true;\n\t\t\t\t\t\t_iteratorError3 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t\t\t\t\t_iterator3.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError3) {\n\t\t\t\t\t\t\t\tthrow _iteratorError3;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.payloads = codecs.map(function (codec) {\n\t\t\t\t\t\treturn codec.payloadType;\n\t\t\t\t\t}).join(' ');\n\n\t\t\t\t\t// NOTE: Firefox does not like a=extmap lines if a=inactive.\n\t\t\t\t\tif (!closed) {\n\t\t\t\t\t\tremoteMediaObj.ext = [];\n\n\t\t\t\t\t\tvar _iteratorNormalCompletion4 = true;\n\t\t\t\t\t\tvar _didIteratorError4 = false;\n\t\t\t\t\t\tvar _iteratorError4 = undefined;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar _loop = function _loop() {\n\t\t\t\t\t\t\t\tvar ext = _step4.value;\n\n\t\t\t\t\t\t\t\t// Don't add a header extension if not present in the offer.\n\t\t\t\t\t\t\t\tvar matchedLocalExt = (localMediaObj.ext || []).find(function (localExt) {\n\t\t\t\t\t\t\t\t\treturn localExt.uri === ext.uri;\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (!matchedLocalExt) return 'continue';\n\n\t\t\t\t\t\t\t\tremoteMediaObj.ext.push({\n\t\t\t\t\t\t\t\t\turi: ext.uri,\n\t\t\t\t\t\t\t\t\tvalue: ext.id\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tfor (var _iterator4 = (0, _getIterator3.default)(headerExtensions), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n\t\t\t\t\t\t\t\tvar _ret = _loop();\n\n\t\t\t\t\t\t\t\tif (_ret === 'continue') continue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t_didIteratorError4 = true;\n\t\t\t\t\t\t\t_iteratorError4 = err;\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion4 && _iterator4.return) {\n\t\t\t\t\t\t\t\t\t_iterator4.return();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tif (_didIteratorError4) {\n\t\t\t\t\t\t\t\t\tthrow _iteratorError4;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Simulcast.\n\t\t\t\t\tif (localMediaObj.simulcast_03) {\n\t\t\t\t\t\t// eslint-disable-next-line camelcase\n\t\t\t\t\t\tremoteMediaObj.simulcast_03 = {\n\t\t\t\t\t\t\tvalue: localMediaObj.simulcast_03.value.replace(/send/g, 'recv')\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tremoteMediaObj.rids = [];\n\n\t\t\t\t\t\tvar _iteratorNormalCompletion5 = true;\n\t\t\t\t\t\tvar _didIteratorError5 = false;\n\t\t\t\t\t\tvar _iteratorError5 = undefined;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tfor (var _iterator5 = (0, _getIterator3.default)(localMediaObj.rids || []), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n\t\t\t\t\t\t\t\tvar rid = _step5.value;\n\n\t\t\t\t\t\t\t\tif (rid.direction !== 'send') continue;\n\n\t\t\t\t\t\t\t\tremoteMediaObj.rids.push({\n\t\t\t\t\t\t\t\t\tid: rid.id,\n\t\t\t\t\t\t\t\t\tdirection: 'recv'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t_didIteratorError5 = true;\n\t\t\t\t\t\t\t_iteratorError5 = err;\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion5 && _iterator5.return) {\n\t\t\t\t\t\t\t\t\t_iterator5.return();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tif (_didIteratorError5) {\n\t\t\t\t\t\t\t\t\tthrow _iteratorError5;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.rtcpMux = 'rtcp-mux';\n\t\t\t\t\tremoteMediaObj.rtcpRsize = 'rtcp-rsize';\n\n\t\t\t\t\t// Push it.\n\t\t\t\t\tsdpObj.media.push(remoteMediaObj);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError = true;\n\t\t\t\t_iteratorError = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar sdp = _sdpform2.default.write(sdpObj);\n\n\t\t\treturn sdp;\n\t\t}\n\t}]);\n\treturn SendRemoteSdp;\n}(RemoteSdp);\n\nvar RecvRemoteSdp = function (_RemoteSdp2) {\n\t(0, _inherits3.default)(RecvRemoteSdp, _RemoteSdp2);\n\n\tfunction RecvRemoteSdp(rtpParametersByKind) {\n\t\t(0, _classCallCheck3.default)(this, RecvRemoteSdp);\n\t\treturn (0, _possibleConstructorReturn3.default)(this, (RecvRemoteSdp.__proto__ || (0, _getPrototypeOf2.default)(RecvRemoteSdp)).call(this, rtpParametersByKind));\n\t}\n\n\t/**\n  * @param {Array<Object>} consumerInfos - Consumer informations.\n  * @return {String}\n  */\n\n\n\t(0, _createClass3.default)(RecvRemoteSdp, [{\n\t\tkey: 'createOfferSdp',\n\t\tvalue: function createOfferSdp(consumerInfos) {\n\t\t\tlogger.debug('createOfferSdp()');\n\n\t\t\tif (!this._transportRemoteParameters) throw new Error('no transport remote parameters');\n\n\t\t\tvar remoteIceParameters = this._transportRemoteParameters.iceParameters;\n\t\t\tvar remoteIceCandidates = this._transportRemoteParameters.iceCandidates;\n\t\t\tvar remoteDtlsParameters = this._transportRemoteParameters.dtlsParameters;\n\t\t\tvar sdpObj = {};\n\t\t\tvar mids = consumerInfos.map(function (info) {\n\t\t\t\treturn String(info.mid);\n\t\t\t});\n\n\t\t\t// Increase our SDP version.\n\t\t\tthis._sdpGlobalFields.version++;\n\n\t\t\tsdpObj.version = 0;\n\t\t\tsdpObj.origin = {\n\t\t\t\taddress: '0.0.0.0',\n\t\t\t\tipVer: 4,\n\t\t\t\tnetType: 'IN',\n\t\t\t\tsessionId: this._sdpGlobalFields.id,\n\t\t\t\tsessionVersion: this._sdpGlobalFields.version,\n\t\t\t\tusername: 'mediasoup-client'\n\t\t\t};\n\t\t\tsdpObj.name = '-';\n\t\t\tsdpObj.timing = { start: 0, stop: 0 };\n\t\t\tsdpObj.icelite = remoteIceParameters.iceLite ? 'ice-lite' : null;\n\t\t\tsdpObj.msidSemantic = {\n\t\t\t\tsemantic: 'WMS',\n\t\t\t\ttoken: '*'\n\t\t\t};\n\n\t\t\tif (mids.length > 0) {\n\t\t\t\tsdpObj.groups = [{\n\t\t\t\t\ttype: 'BUNDLE',\n\t\t\t\t\tmids: mids.join(' ')\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\tsdpObj.media = [];\n\n\t\t\t// NOTE: We take the latest fingerprint.\n\t\t\tvar numFingerprints = remoteDtlsParameters.fingerprints.length;\n\n\t\t\tsdpObj.fingerprint = {\n\t\t\t\ttype: remoteDtlsParameters.fingerprints[numFingerprints - 1].algorithm,\n\t\t\t\thash: remoteDtlsParameters.fingerprints[numFingerprints - 1].value\n\t\t\t};\n\n\t\t\tvar _iteratorNormalCompletion8 = true;\n\t\t\tvar _didIteratorError8 = false;\n\t\t\tvar _iteratorError8 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator8 = (0, _getIterator3.default)(consumerInfos), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n\t\t\t\t\tvar info = _step8.value;\n\n\t\t\t\t\tvar closed = info.closed;\n\t\t\t\t\tvar kind = info.kind;\n\t\t\t\t\tvar codecs = void 0;\n\t\t\t\t\tvar headerExtensions = void 0;\n\n\t\t\t\t\tif (info.kind !== 'application') {\n\t\t\t\t\t\tcodecs = this._rtpParametersByKind[kind].codecs;\n\t\t\t\t\t\theaderExtensions = this._rtpParametersByKind[kind].headerExtensions;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar remoteMediaObj = {};\n\n\t\t\t\t\tif (info.kind !== 'application') {\n\t\t\t\t\t\tremoteMediaObj.type = kind;\n\t\t\t\t\t\tremoteMediaObj.port = 7;\n\t\t\t\t\t\tremoteMediaObj.protocol = 'RTP/SAVPF';\n\t\t\t\t\t\tremoteMediaObj.connection = { ip: '127.0.0.1', version: 4 };\n\t\t\t\t\t\tremoteMediaObj.mid = info.mid;\n\t\t\t\t\t\tremoteMediaObj.msid = info.streamId + ' ' + info.trackId;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tremoteMediaObj.type = kind;\n\t\t\t\t\t\tremoteMediaObj.port = 9;\n\t\t\t\t\t\tremoteMediaObj.protocol = 'DTLS/SCTP';\n\t\t\t\t\t\tremoteMediaObj.connection = { ip: '127.0.0.1', version: 4 };\n\t\t\t\t\t\tremoteMediaObj.mid = info.mid;\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.iceUfrag = remoteIceParameters.usernameFragment;\n\t\t\t\t\tremoteMediaObj.icePwd = remoteIceParameters.password;\n\t\t\t\t\tremoteMediaObj.candidates = [];\n\n\t\t\t\t\tvar _iteratorNormalCompletion9 = true;\n\t\t\t\t\tvar _didIteratorError9 = false;\n\t\t\t\t\tvar _iteratorError9 = undefined;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfor (var _iterator9 = (0, _getIterator3.default)(remoteIceCandidates), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {\n\t\t\t\t\t\t\tvar candidate = _step9.value;\n\n\t\t\t\t\t\t\tvar candidateObj = {};\n\n\t\t\t\t\t\t\t// mediasoup does not support non rtcp-mux so candidates component is\n\t\t\t\t\t\t\t// always RTP (1).\n\t\t\t\t\t\t\tcandidateObj.component = 1;\n\t\t\t\t\t\t\tcandidateObj.foundation = candidate.foundation;\n\t\t\t\t\t\t\tcandidateObj.ip = candidate.ip;\n\t\t\t\t\t\t\tcandidateObj.port = candidate.port;\n\t\t\t\t\t\t\tcandidateObj.priority = candidate.priority;\n\t\t\t\t\t\t\tcandidateObj.transport = candidate.protocol;\n\t\t\t\t\t\t\tcandidateObj.type = candidate.type;\n\t\t\t\t\t\t\tif (candidate.tcpType) candidateObj.tcptype = candidate.tcpType;\n\n\t\t\t\t\t\t\tremoteMediaObj.candidates.push(candidateObj);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t_didIteratorError9 = true;\n\t\t\t\t\t\t_iteratorError9 = err;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!_iteratorNormalCompletion9 && _iterator9.return) {\n\t\t\t\t\t\t\t\t_iterator9.return();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (_didIteratorError9) {\n\t\t\t\t\t\t\t\tthrow _iteratorError9;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tremoteMediaObj.endOfCandidates = 'end-of-candidates';\n\n\t\t\t\t\t// Announce support for ICE renomination.\n\t\t\t\t\t// https://tools.ietf.org/html/draft-thatcher-ice-renomination\n\t\t\t\t\tremoteMediaObj.iceOptions = 'renomination';\n\n\t\t\t\t\tremoteMediaObj.setup = 'actpass';\n\n\t\t\t\t\tif (info.kind !== 'application') {\n\t\t\t\t\t\tif (!closed) remoteMediaObj.direction = 'sendonly';else remoteMediaObj.direction = 'inactive';\n\n\t\t\t\t\t\tremoteMediaObj.rtp = [];\n\t\t\t\t\t\tremoteMediaObj.rtcpFb = [];\n\t\t\t\t\t\tremoteMediaObj.fmtp = [];\n\n\t\t\t\t\t\tvar _iteratorNormalCompletion10 = true;\n\t\t\t\t\t\tvar _didIteratorError10 = false;\n\t\t\t\t\t\tvar _iteratorError10 = undefined;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tfor (var _iterator10 = (0, _getIterator3.default)(codecs), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n\t\t\t\t\t\t\t\tvar codec = _step10.value;\n\n\t\t\t\t\t\t\t\tvar rtp = {\n\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\tcodec: codec.name,\n\t\t\t\t\t\t\t\t\trate: codec.clockRate\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tif (codec.channels > 1) rtp.encoding = codec.channels;\n\n\t\t\t\t\t\t\t\tremoteMediaObj.rtp.push(rtp);\n\n\t\t\t\t\t\t\t\tif (codec.parameters) {\n\t\t\t\t\t\t\t\t\tvar paramFmtp = {\n\t\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\t\tconfig: ''\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion12 = true;\n\t\t\t\t\t\t\t\t\tvar _didIteratorError12 = false;\n\t\t\t\t\t\t\t\t\tvar _iteratorError12 = undefined;\n\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tfor (var _iterator12 = (0, _getIterator3.default)((0, _keys2.default)(codec.parameters)), _step12; !(_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done); _iteratorNormalCompletion12 = true) {\n\t\t\t\t\t\t\t\t\t\t\tvar key = _step12.value;\n\n\t\t\t\t\t\t\t\t\t\t\tif (paramFmtp.config) paramFmtp.config += ';';\n\n\t\t\t\t\t\t\t\t\t\t\tparamFmtp.config += key + '=' + codec.parameters[key];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\t_didIteratorError12 = true;\n\t\t\t\t\t\t\t\t\t\t_iteratorError12 = err;\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion12 && _iterator12.return) {\n\t\t\t\t\t\t\t\t\t\t\t\t_iterator12.return();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\t\tif (_didIteratorError12) {\n\t\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError12;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (paramFmtp.config) remoteMediaObj.fmtp.push(paramFmtp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (codec.rtcpFeedback) {\n\t\t\t\t\t\t\t\t\tvar _iteratorNormalCompletion13 = true;\n\t\t\t\t\t\t\t\t\tvar _didIteratorError13 = false;\n\t\t\t\t\t\t\t\t\tvar _iteratorError13 = undefined;\n\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tfor (var _iterator13 = (0, _getIterator3.default)(codec.rtcpFeedback), _step13; !(_iteratorNormalCompletion13 = (_step13 = _iterator13.next()).done); _iteratorNormalCompletion13 = true) {\n\t\t\t\t\t\t\t\t\t\t\tvar fb = _step13.value;\n\n\t\t\t\t\t\t\t\t\t\t\tremoteMediaObj.rtcpFb.push({\n\t\t\t\t\t\t\t\t\t\t\t\tpayload: codec.payloadType,\n\t\t\t\t\t\t\t\t\t\t\t\ttype: fb.type,\n\t\t\t\t\t\t\t\t\t\t\t\tsubtype: fb.parameter || ''\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\t_didIteratorError13 = true;\n\t\t\t\t\t\t\t\t\t\t_iteratorError13 = err;\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion13 && _iterator13.return) {\n\t\t\t\t\t\t\t\t\t\t\t\t_iterator13.return();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\t\tif (_didIteratorError13) {\n\t\t\t\t\t\t\t\t\t\t\t\tthrow _iteratorError13;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t_didIteratorError10 = true;\n\t\t\t\t\t\t\t_iteratorError10 = err;\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion10 && _iterator10.return) {\n\t\t\t\t\t\t\t\t\t_iterator10.return();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tif (_didIteratorError10) {\n\t\t\t\t\t\t\t\t\tthrow _iteratorError10;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tremoteMediaObj.payloads = codecs.map(function (codec) {\n\t\t\t\t\t\t\treturn codec.payloadType;\n\t\t\t\t\t\t}).join(' ');\n\n\t\t\t\t\t\t// NOTE: Firefox does not like a=extmap lines if a=inactive.\n\t\t\t\t\t\tif (!closed) {\n\t\t\t\t\t\t\tremoteMediaObj.ext = [];\n\n\t\t\t\t\t\t\tvar _iteratorNormalCompletion11 = true;\n\t\t\t\t\t\t\tvar _didIteratorError11 = false;\n\t\t\t\t\t\t\tvar _iteratorError11 = undefined;\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tfor (var _iterator11 = (0, _getIterator3.default)(headerExtensions), _step11; !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n\t\t\t\t\t\t\t\t\tvar _ext = _step11.value;\n\n\t\t\t\t\t\t\t\t\t// Ignore MID RTP extension for receiving media.\n\t\t\t\t\t\t\t\t\tif (_ext.uri === 'urn:ietf:params:rtp-hdrext:sdes:mid') continue;\n\n\t\t\t\t\t\t\t\t\tremoteMediaObj.ext.push({\n\t\t\t\t\t\t\t\t\t\turi: _ext.uri,\n\t\t\t\t\t\t\t\t\t\tvalue: _ext.id\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t_didIteratorError11 = true;\n\t\t\t\t\t\t\t\t_iteratorError11 = err;\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion11 && _iterator11.return) {\n\t\t\t\t\t\t\t\t\t\t_iterator11.return();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\tif (_didIteratorError11) {\n\t\t\t\t\t\t\t\t\t\tthrow _iteratorError11;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tremoteMediaObj.rtcpMux = 'rtcp-mux';\n\t\t\t\t\t\tremoteMediaObj.rtcpRsize = 'rtcp-rsize';\n\n\t\t\t\t\t\tif (!closed) {\n\t\t\t\t\t\t\tremoteMediaObj.ssrcs = [];\n\t\t\t\t\t\t\tremoteMediaObj.ssrcGroups = [];\n\n\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\tid: info.ssrc,\n\t\t\t\t\t\t\t\tattribute: 'cname',\n\t\t\t\t\t\t\t\tvalue: info.cname\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (info.rtxSsrc) {\n\t\t\t\t\t\t\t\tremoteMediaObj.ssrcs.push({\n\t\t\t\t\t\t\t\t\tid: info.rtxSsrc,\n\t\t\t\t\t\t\t\t\tattribute: 'cname',\n\t\t\t\t\t\t\t\t\tvalue: info.cname\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Associate original and retransmission SSRC.\n\t\t\t\t\t\t\t\tremoteMediaObj.ssrcGroups.push({\n\t\t\t\t\t\t\t\t\tsemantics: 'FID',\n\t\t\t\t\t\t\t\t\tssrcs: info.ssrc + ' ' + info.rtxSsrc\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tremoteMediaObj.payloads = 5000;\n\t\t\t\t\t\tremoteMediaObj.sctpmap = {\n\t\t\t\t\t\t\tapp: 'webrtc-datachannel',\n\t\t\t\t\t\t\tmaxMessageSize: 256,\n\t\t\t\t\t\t\tsctpmapNumber: 5000\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Push it.\n\t\t\t\t\tsdpObj.media.push(remoteMediaObj);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError8 = true;\n\t\t\t\t_iteratorError8 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion8 && _iterator8.return) {\n\t\t\t\t\t\t_iterator8.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError8) {\n\t\t\t\t\t\tthrow _iteratorError8;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar sdp = _sdpform2.default.write(sdpObj);\n\n\t\t\treturn sdp;\n\t\t}\n\t}]);\n\treturn RecvRemoteSdp;\n}(RemoteSdp);\n\nvar RemoteUnifiedPlanSdp = function RemoteUnifiedPlanSdp(direction, rtpParametersByKind) {\n\t(0, _classCallCheck3.default)(this, RemoteUnifiedPlanSdp);\n\n\tlogger.debug('constructor() [direction:%s, rtpParametersByKind:%o]', direction, rtpParametersByKind);\n\n\tswitch (direction) {\n\t\tcase 'send':\n\t\t\treturn new SendRemoteSdp(rtpParametersByKind);\n\t\tcase 'recv':\n\t\t\treturn new RecvRemoteSdp(rtpParametersByKind);\n\t}\n};\n\nexports.default = RemoteUnifiedPlanSdp;\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/sdp/bandwidthHandler.js\":\n/*!****************************************************!*\\\n  !*** ./lib/mslib/handlers/sdp/bandwidthHandler.js ***!\n  \\****************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _Logger = __webpack_require__(/*! ../../Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _sdpform = __webpack_require__(/*! ../../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _Logger2.default('<BandwidthHandler>');\n\nfunction setBAS(sdp, bandwidth, isScreen) {\n\tif (!!navigator.mozGetUserMedia || !bandwidth) {\n\t\treturn sdp;\n\t}\n\n\t// logger.debug(`setBAS() bandwidth: ${JSON.stringify(bandwidth)}`);\n\n\tif (isScreen) {\n\t\tif (!bandwidth.screen) {\n\t\t\tconsole.warn('It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.');\n\t\t} else if (bandwidth.screen < 300) {\n\t\t\tconsole.warn('It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail.');\n\t\t}\n\t}\n\n\t// if screen; must use at least 300kbs\n\tif (bandwidth.screen && isScreen) {\n\t\tsdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\n\t\tsdp = sdp.replace(/a=mid:video\\r\\n/g, 'a=mid:video\\r\\nb=AS:' + bandwidth.screen + '\\r\\n');\n\t}\n\n\t// remove existing bandwidth lines\n\tif (bandwidth.audio || bandwidth.video || bandwidth.data) {\n\t\tsdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\n\t}\n\n\tif (bandwidth.audio) {\n\t\tsdp = sdp.replace(/a=mid:audio\\r\\n/g, 'a=mid:audio\\r\\nb=AS:' + bandwidth.audio + '\\r\\n');\n\t}\n\n\tif (bandwidth.video) {\n\t\tsdp = sdp.replace(/a=mid:video\\r\\n/g, 'a=mid:video\\r\\nb=AS:' + (isScreen ? bandwidth.screen : bandwidth.video) + '\\r\\n');\n\t}\n\n\treturn sdp;\n}\n\n// Find the line in sdpLines that starts with |prefix|, and, if specified,\n// contains |substr| (case-insensitive search).\nfunction findLine(sdpLines, prefix, substr) {\n\treturn findLineInRange(sdpLines, 0, -1, prefix, substr);\n}\n\n// Find the line in sdpLines[startLine...endLine - 1] that starts with |prefix|\n// and, if specified, contains |substr| (case-insensitive search).\nfunction findLineInRange(sdpLines, startLine, endLine, prefix, substr) {\n\tvar realEndLine = endLine !== -1 ? endLine : sdpLines.length;\n\tfor (var i = startLine; i < realEndLine; ++i) {\n\t\tif (sdpLines[i].indexOf(prefix) === 0) {\n\t\t\tif (!substr || sdpLines[i].toLowerCase().indexOf(substr.toLowerCase()) !== -1) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\n// Gets the codec payload type from an a=rtpmap:X line.\nfunction getCodecPayloadType(sdpLine) {\n\tvar pattern = new RegExp('a=rtpmap:(\\\\d+) \\\\w+\\\\/\\\\d+');\n\tvar result = sdpLine.match(pattern);\n\treturn result && result.length === 2 ? result[1] : null;\n}\n\nfunction setVideoBitrates(sdp, params) {\n\tif (typeof params === 'undefined' || params === null) return sdp;\n\n\tif (typeof params.videoGoogleMinBitrate === 'undefined' || typeof params.videoGoogleMaxBitrate === 'undefined') return sdp;\n\n\t// logger.debug(`setVideoBitrates() params: ${JSON.stringify(params)}`);\n\n\tparams = params || {};\n\tvar xgoogle_min_bitrate = params.videoGoogleMinBitrate;\n\tvar xgoogle_max_bitrate = params.videoGoogleMaxBitrate;\n\tvar xgoogle_start_bitrate = params.videoGoogleStartBitrate;\n\n\tvar sdpLines = sdp.split('\\r\\n');\n\n\t// H264\n\tvar h264Index = findLine(sdpLines, 'a=rtpmap', 'H264/90000');\n\tvar h264Payload;\n\tif (h264Index) {\n\t\th264Payload = getCodecPayloadType(sdpLines[h264Index]);\n\t}\n\n\tif (!h264Payload) {\n\t\treturn sdp;\n\t}\n\n\tvar rtxIndex = findLine(sdpLines, 'a=rtpmap', 'rtx/90000');\n\tvar rtxPayload;\n\tif (rtxIndex) {\n\t\trtxPayload = getCodecPayloadType(sdpLines[rtxIndex]);\n\t}\n\n\tif (!rtxIndex) {\n\t\treturn sdp;\n\t}\n\n\tvar appendNext = '';\n\tvar pattern = void 0;\n\tvar idx = 0;\n\n\tvar rtxFmtpLineIndex = 0;\n\twhile (rtxFmtpLineIndex !== null) {\n\t\trtxFmtpLineIndex = findLineInRange(sdpLines, rtxFmtpLineIndex, -1, 'a=fmtp', 'profile-level-id=42001f');\n\t\tif (rtxFmtpLineIndex !== null) {\n\t\t\tappendNext = '';\n\t\t\t// \n\t\t\tidx = sdpLines[rtxFmtpLineIndex].indexOf('x-google-min-bitrate=');\n\t\t\tif (idx === -1) {\n\t\t\t\tappendNext += ';x-google-min-bitrate=' + (xgoogle_min_bitrate || '228');\n\t\t\t} else {\n\t\t\t\tpattern = new RegExp('x-google-min-bitrate=(\\\\d+)');\n\t\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].replace(pattern, 'x-google-min-bitrate=' + (xgoogle_min_bitrate || '228'));\n\t\t\t}\n\t\t\t// \n\n\t\t\t// \n\t\t\tidx = sdpLines[rtxFmtpLineIndex].indexOf('x-google-max-bitrate=');\n\t\t\tif (idx === -1) {\n\t\t\t\tappendNext += ';x-google-max-bitrate=' + (xgoogle_max_bitrate || '228');\n\t\t\t} else {\n\t\t\t\tpattern = new RegExp('x-google-max-bitrate=(\\\\d+)');\n\t\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].replace(pattern, 'x-google-max-bitrate=' + (xgoogle_max_bitrate || '228'));\n\t\t\t}\n\t\t\t// \n\n\t\t\t// \n\t\t\tidx = sdpLines[rtxFmtpLineIndex].indexOf('x-google-start-bitrate=');\n\t\t\tif (idx === -1) {\n\t\t\t\tappendNext += ';x-google-start-bitrate=' + (xgoogle_start_bitrate || '228');\n\t\t\t} else {\n\t\t\t\tpattern = new RegExp('x-google-start-bitrate=(\\\\d+)');\n\t\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].replace(pattern, 'x-google-start-bitrate=' + (xgoogle_start_bitrate || '228'));\n\t\t\t}\n\t\t\t// \n\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].concat(appendNext);\n\n\t\t\tsdp = sdpLines.join('\\r\\n');\n\t\t}\n\n\t\tif (rtxFmtpLineIndex === null) break;\n\t\trtxFmtpLineIndex += 1;\n\t}\n\n\trtxFmtpLineIndex = 0;\n\twhile (rtxFmtpLineIndex !== null) {\n\t\trtxFmtpLineIndex = findLineInRange(sdpLines, rtxFmtpLineIndex, -1, 'a=fmtp', 'profile-level-id=42e01f');\n\t\tif (rtxFmtpLineIndex !== null) {\n\t\t\tappendNext = '';\n\t\t\t// \n\t\t\tidx = sdpLines[rtxFmtpLineIndex].indexOf('x-google-min-bitrate=');\n\t\t\tif (idx === -1) {\n\t\t\t\tappendNext += ';x-google-min-bitrate=' + (xgoogle_min_bitrate || '228');\n\t\t\t} else {\n\t\t\t\tpattern = new RegExp('x-google-min-bitrate=(\\\\d+)');\n\t\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].replace(pattern, 'x-google-min-bitrate=' + (xgoogle_min_bitrate || '228'));\n\t\t\t}\n\t\t\t// \n\n\t\t\t// \n\t\t\tidx = sdpLines[rtxFmtpLineIndex].indexOf('x-google-max-bitrate=');\n\t\t\tif (idx === -1) {\n\t\t\t\tappendNext += ';x-google-max-bitrate=' + (xgoogle_max_bitrate || '228');\n\t\t\t} else {\n\t\t\t\tpattern = new RegExp('x-google-max-bitrate=(\\\\d+)');\n\t\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].replace(pattern, 'x-google-max-bitrate=' + (xgoogle_max_bitrate || '228'));\n\t\t\t}\n\t\t\t// \n\n\t\t\t// \n\t\t\tidx = sdpLines[rtxFmtpLineIndex].indexOf('x-google-start-bitrate=');\n\t\t\tif (idx === -1) {\n\t\t\t\tappendNext += ';x-google-start-bitrate=' + (xgoogle_start_bitrate || '228');\n\t\t\t} else {\n\t\t\t\tpattern = new RegExp('x-google-start-bitrate=(\\\\d+)');\n\t\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].replace(pattern, 'x-google-start-bitrate=' + (xgoogle_start_bitrate || '228'));\n\t\t\t}\n\t\t\t// \n\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].concat(appendNext);\n\n\t\t\tsdp = sdpLines.join('\\r\\n');\n\t\t}\n\n\t\tif (rtxFmtpLineIndex === null) break;\n\t\trtxFmtpLineIndex += 1;\n\t}\n\n\t// logger.debug(`setVideoBitrates() OK - sdp: ${sdp}`);\n\n\treturn sdp;\n}\n\n// a=fmtp:111 minptime=10;useinbandfec=1;stereo=1;maxaveragebitrate=24000;maxplaybackrate=48000;\n// \n// params:\n// {\n//\tstereo : 1, // 取值 1 / 0\n//\tmaxaveragebitrate : 24 * 1024, // 数值型\n//\tmaxplaybackrate   : 48000, // 数值型\n//\tcbr : 1, // 取值 1 / 0\n//\tuseinbandfec : 1, // 取值 1 / 0\n//\tusedtx : 1, // 取值 1 / 0\n//\tmaxptime : 20, // 最大打包时长\n// }\nfunction setOpusAttributes(sdp, params) {\n\tparams = params || {};\n\n\tvar sdpLines = sdp.split('\\r\\n');\n\n\t// logger.debug(`setOpusAttributes() params: ${JSON.stringify(params)}`);\n\n\t// Opus\n\t// 得到 opus payload type\n\tvar opusIndex = findLine(sdpLines, 'a=rtpmap', 'opus/48000');\n\tvar opusPayload;\n\tif (opusIndex) {\n\t\topusPayload = getCodecPayloadType(sdpLines[opusIndex]);\n\t}\n\n\tif (!opusPayload) {\n\t\treturn sdp;\n\t}\n\n\t// 得到 opus fmtp 行\n\tvar opusFmtpLineIndex = findLine(sdpLines, 'a=fmtp:' + opusPayload.toString());\n\tif (opusFmtpLineIndex === null) {\n\t\treturn sdp;\n\t}\n\n\tvar appendOpusNext = '';\n\t// \n\n\tvar pattern = void 0;\n\tvar idx = 0;\n\n\tif (typeof params.stereo != 'undefined') {\n\t\tidx = sdpLines[opusFmtpLineIndex].indexOf('stereo=');\n\t\tif (idx === -1) {\n\t\t\tappendOpusNext += ';stereo=' + params.stereo;\n\t\t} else {\n\t\t\tpattern = new RegExp('stereo=(\\\\d)');\n\t\t\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].replace(pattern, 'stereo=' + params.stereo);\n\t\t}\n\t}\n\n\tif (typeof params['sprop-stereo'] != 'undefined') {\n\t\tidx = sdpLines[opusFmtpLineIndex].indexOf('sprop-stereo=');\n\t\tif (idx === -1) {\n\t\t\tappendOpusNext += ';sprop-stereo=' + params['sprop-stereo'];\n\t\t} else {\n\t\t\tpattern = new RegExp('sprop-stereo=(\\\\d)');\n\t\t\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].replace(pattern, 'sprop-stereo=' + params['sprop-stereo']);\n\t\t}\n\t}\n\n\tif (typeof params.maxaveragebitrate != 'undefined') {\n\t\tidx = sdpLines[opusFmtpLineIndex].indexOf('maxaveragebitrate=');\n\t\tif (idx == -1) {\n\t\t\tappendOpusNext += ';maxaveragebitrate=' + (params.maxaveragebitrate || 128 * 1024 * 8);\n\t\t} else {\n\t\t\tpattern = new RegExp('maxaveragebitrate=(\\\\d+)');\n\t\t\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].replace(pattern, 'maxaveragebitrate=' + (params.maxaveragebitrate || 128 * 1024 * 8));\n\t\t}\n\t}\n\n\tif (typeof params.maxplaybackrate != 'undefined') {\n\t\tidx = sdpLines[opusFmtpLineIndex].indexOf('maxplaybackrate=');\n\t\tif (idx === -1) {\n\t\t\tappendOpusNext += ';maxplaybackrate=' + (params.maxplaybackrate || 48000);\n\t\t} else {\n\t\t\tpattern = new RegExp('maxplaybackrate=(\\\\d+)');\n\t\t\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].replace(pattern, 'maxplaybackrate=' + (params.maxplaybackrate || 48000));\n\t\t}\n\t}\n\n\tif (typeof params.cbr != 'undefined') {\n\t\tidx = sdpLines[opusFmtpLineIndex].indexOf('cbr=');\n\t\tif (idx === -1) {\n\t\t\tappendOpusNext += ';cbr=' + params.cbr;\n\t\t} else {\n\t\t\tpattern = new RegExp('cbr=(\\\\d+)');\n\t\t\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].replace(pattern, 'cbr=' + params.cbr);\n\t\t}\n\t}\n\n\tif (typeof params.useinbandfec != 'undefined') {\n\t\tidx = sdpLines[opusFmtpLineIndex].indexOf('useinbandfec=');\n\t\tif (idx === -1) {\n\t\t\tappendOpusNext += ';useinbandfec=' + params.useinbandfec;\n\t\t} else {\n\t\t\tpattern = new RegExp('useinbandfec=(\\\\d)');\n\t\t\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].replace(pattern, 'useinbandfec=' + params.useinbandfec);\n\t\t}\n\t}\n\n\tif (typeof params.usedtx != 'undefined') {\n\t\tidx = sdpLines[opusFmtpLineIndex].indexOf('usedtx=');\n\t\tif (idx === -1) {\n\t\t\tappendOpusNext += ';usedtx=' + params.usedtx;\n\t\t} else {\n\t\t\tpattern = new RegExp('usedtx=(\\\\d)');\n\t\t\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].replace(pattern, 'usedtx=' + params.usedtx);\n\t\t}\n\t}\n\n\tif (typeof params.maxptime != 'undefined') {\n\t\tappendOpusNext += '\\r\\na=maxptime:' + params.maxptime;\n\t}\n\n\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].concat(appendOpusNext);\n\n\tsdp = sdpLines.join('\\r\\n');\n\n\t// logger.debug(`setOpusAttributes() OK - sdp: ${sdp}`);\n\n\treturn sdp;\n}\n\n// \nfunction setSpecialAudioCodec(sdp, codec) {\n\tvar sdpObject = _sdpform2.default.parse(sdp);\n\n\tif (!sdpObject) {\n\t\treturn sdp;\n\t}\n\n\tsdpObject.media.forEach(function (item, index) {\n\t\tif (item.type !== 'audio') return;\n\n\t\t// \n\t\tif (!item.rtp) return;\n\n\t\tsdpObject.media[index].rtp = item.rtp.filter(function (ele) {\n\t\t\treturn ele.codec.toLowerCase() == codec || ele.codec == 'CN' || ele.codec == 'telephone-event';\n\t\t});\n\n\t\t// \n\t\tvar codecPT = -1;\n\t\titem.rtp.forEach(function (ele, index) {\n\t\t\tif (ele.codec == codec) codecPT = ele.payload;\n\t\t});\n\n\t\tsdpObject.media[index].payloads = item.rtp.map(function (rtp) {\n\t\t\treturn rtp.payload;\n\t\t}).join(' ');\n\n\t\t// \n\t\tif (item.fmtp) {\n\t\t\tsdpObject.media[index].fmtp = item.fmtp.filter(function (ele) {\n\t\t\t\treturn ele.payload == codecPT;\n\t\t\t});\n\t\t}\n\n\t\t// \n\t\tif (item.rtcpFb) {\n\t\t\tsdpObject.media[index].rtcpFb = item.rtcpFb.filter(function (ele) {\n\t\t\t\treturn ele.payload == codecPT;\n\t\t\t});\n\t\t}\n\t});\n\n\t// \n\tsdp = _sdpform2.default.write(sdpObject);\n\t// console.log(`setSpecialAudioCodec -- sdp: ${sdp}`, sdpObject);\n\n\treturn sdp;\n}\n\nexports.default = {\n\tsetBAS: setBAS,\n\tsetVideoBitrates: setVideoBitrates,\n\tsetOpusAttributes: setOpusAttributes,\n\tsetSpecialAudioCodec: setSpecialAudioCodec\n};\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/sdp/commonUtils.js\":\n/*!***********************************************!*\\\n  !*** ./lib/mslib/handlers/sdp/commonUtils.js ***!\n  \\***********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _from = __webpack_require__(/*! babel-runtime/core-js/array/from */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nexports.extractRtpCapabilities = extractRtpCapabilities;\nexports.extractDtlsParameters = extractDtlsParameters;\n\nvar _sdpform = __webpack_require__(/*! ../../../sdpform */ \"./lib/sdpform/index.js\");\n\nvar _sdpform2 = _interopRequireDefault(_sdpform);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Extract RTP capabilities from a SDP.\n *\n * @param {Object} sdpObj - SDP Object generated by sdpform.\n * @return {RTCRtpCapabilities}\n */\nfunction extractRtpCapabilities(sdpObj) {\n\t// Map of RtpCodecParameters indexed by payload type.\n\tvar codecsMap = new _map2.default();\n\n\t// Array of RtpHeaderExtensions.\n\tvar headerExtensions = [];\n\n\t// Whether a m=audio/video section has been already found.\n\tvar gotAudio = false;\n\tvar gotVideo = false;\n\n\tvar _iteratorNormalCompletion = true;\n\tvar _didIteratorError = false;\n\tvar _iteratorError = undefined;\n\n\ttry {\n\t\tfor (var _iterator = (0, _getIterator3.default)(sdpObj.media), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\tvar m = _step.value;\n\n\t\t\tvar kind = m.type;\n\n\t\t\tswitch (kind) {\n\t\t\t\tcase 'audio':\n\t\t\t\t\t{\n\t\t\t\t\t\tif (gotAudio) continue;\n\n\t\t\t\t\t\tgotAudio = true;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'video':\n\t\t\t\t\t{\n\t\t\t\t\t\tif (gotVideo) continue;\n\n\t\t\t\t\t\tgotVideo = true;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\t{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get codecs.\n\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\tvar _didIteratorError2 = false;\n\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(m.rtp), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\tvar rtp = _step2.value;\n\n\t\t\t\t\tvar codec = {\n\t\t\t\t\t\tname: rtp.codec,\n\t\t\t\t\t\tmimeType: kind + '/' + rtp.codec,\n\t\t\t\t\t\tkind: kind,\n\t\t\t\t\t\tclockRate: rtp.rate,\n\t\t\t\t\t\tpreferredPayloadType: rtp.payload,\n\t\t\t\t\t\tchannels: rtp.encoding,\n\t\t\t\t\t\trtcpFeedback: [],\n\t\t\t\t\t\tparameters: {}\n\t\t\t\t\t};\n\n\t\t\t\t\tif (codec.kind !== 'audio') delete codec.channels;else if (!codec.channels) codec.channels = 1;\n\n\t\t\t\t\tcodecsMap.set(codec.preferredPayloadType, codec);\n\t\t\t\t}\n\n\t\t\t\t// Get codec parameters.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t_iteratorError2 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion3 = true;\n\t\t\tvar _didIteratorError3 = false;\n\t\t\tvar _iteratorError3 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator3 = (0, _getIterator3.default)(m.fmtp || []), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\t\t\tvar fmtp = _step3.value;\n\n\t\t\t\t\tvar parameters = _sdpform2.default.parseFmtpConfig(fmtp.config);\n\t\t\t\t\tvar _codec = codecsMap.get(fmtp.payload);\n\n\t\t\t\t\tif (!_codec) continue;\n\n\t\t\t\t\t_codec.parameters = parameters;\n\t\t\t\t}\n\n\t\t\t\t// Get RTCP feedback for each codec.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError3 = true;\n\t\t\t\t_iteratorError3 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t\t\t_iterator3.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError3) {\n\t\t\t\t\t\tthrow _iteratorError3;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion4 = true;\n\t\t\tvar _didIteratorError4 = false;\n\t\t\tvar _iteratorError4 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator4 = (0, _getIterator3.default)(m.rtcpFb || []), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n\t\t\t\t\tvar fb = _step4.value;\n\n\t\t\t\t\tvar _codec2 = codecsMap.get(fb.payload);\n\n\t\t\t\t\tif (!_codec2) continue;\n\n\t\t\t\t\tvar feedback = {\n\t\t\t\t\t\ttype: fb.type,\n\t\t\t\t\t\tparameter: fb.subtype\n\t\t\t\t\t};\n\n\t\t\t\t\tif (!feedback.parameter) delete feedback.parameter;\n\n\t\t\t\t\t_codec2.rtcpFeedback.push(feedback);\n\t\t\t\t}\n\n\t\t\t\t// Get RTP header extensions.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError4 = true;\n\t\t\t\t_iteratorError4 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion4 && _iterator4.return) {\n\t\t\t\t\t\t_iterator4.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError4) {\n\t\t\t\t\t\tthrow _iteratorError4;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion5 = true;\n\t\t\tvar _didIteratorError5 = false;\n\t\t\tvar _iteratorError5 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator5 = (0, _getIterator3.default)(m.ext || []), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n\t\t\t\t\tvar ext = _step5.value;\n\n\t\t\t\t\tvar headerExtension = {\n\t\t\t\t\t\tkind: kind,\n\t\t\t\t\t\turi: ext.uri,\n\t\t\t\t\t\tpreferredId: ext.value\n\t\t\t\t\t};\n\n\t\t\t\t\theaderExtensions.push(headerExtension);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError5 = true;\n\t\t\t\t_iteratorError5 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion5 && _iterator5.return) {\n\t\t\t\t\t\t_iterator5.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError5) {\n\t\t\t\t\t\tthrow _iteratorError5;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError = true;\n\t\t_iteratorError = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t_iterator.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError) {\n\t\t\t\tthrow _iteratorError;\n\t\t\t}\n\t\t}\n\t}\n\n\tvar rtpCapabilities = {\n\t\tcodecs: (0, _from2.default)(codecsMap.values()),\n\t\theaderExtensions: headerExtensions,\n\t\tfecMechanisms: [] // TODO\n\t};\n\n\treturn rtpCapabilities;\n}\n\n/**\n * Extract DTLS parameters from a SDP.\n *\n * @param {Object} sdpObj - SDP Object generated by sdpform.\n * @return {RTCDtlsParameters}\n */\nfunction extractDtlsParameters(sdpObj) {\n\tvar media = getFirstActiveMediaSection(sdpObj);\n\tvar fingerprint = media.fingerprint || sdpObj.fingerprint;\n\tvar role = void 0;\n\n\tswitch (media.setup) {\n\t\tcase 'active':\n\t\t\trole = 'client';\n\t\t\tbreak;\n\t\tcase 'passive':\n\t\t\trole = 'server';\n\t\t\tbreak;\n\t\tcase 'actpass':\n\t\t\trole = 'auto';\n\t\t\tbreak;\n\t}\n\n\tvar dtlsParameters = {\n\t\trole: role,\n\t\tfingerprints: [{\n\t\t\talgorithm: fingerprint.type,\n\t\t\tvalue: fingerprint.hash\n\t\t}]\n\t};\n\n\treturn dtlsParameters;\n}\n\n/**\n * Get the first acive media section.\n *\n * @private\n * @param {Object} sdpObj - SDP Object generated by sdpform.\n * @return {Object} SDP media section as parsed by sdpform.\n */\nfunction getFirstActiveMediaSection(sdpObj) {\n\treturn (sdpObj.media || []).find(function (m) {\n\t\treturn m.iceUfrag && m.port !== 0;\n\t});\n}\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/sdp/plainRtpUtils.js\":\n/*!*************************************************!*\\\n  !*** ./lib/mslib/handlers/sdp/plainRtpUtils.js ***!\n  \\*************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.extractPlainRtpParametersByKind = extractPlainRtpParametersByKind;\nexports.fillRtpParametersForKind = fillRtpParametersForKind;\n/**\n * Extract plain RTP parameters from a SDP.\n *\n * @param {Object} sdpObj - SDP Object generated by sdpform.\n * @param {String} kind - media type.\n * @return {PlainRtpParameters}\n */\nfunction extractPlainRtpParametersByKind(sdpObj, kind) {\n\tvar mSection = (sdpObj.media || []).find(function (m) {\n\t\treturn m.type === kind;\n\t});\n\n\tif (!mSection) throw new Error('m=' + kind + ' section not found');\n\n\tvar plainRtpParameters = {\n\t\tip: sdpObj.connection.ip,\n\t\tport: mSection.port\n\t};\n\n\treturn plainRtpParameters;\n}\n\n/**\n * Fill the given RTP parameters for the given media type.\n *\n * @param {RTCRtpParameters} rtpParameters -  RTP parameters to be filled.\n * @param {Object} sdpObj - Local SDP Object generated by sdpform.\n * @param {String} kind - media type.\n */\nfunction fillRtpParametersForKind(rtpParameters, sdpObj, kind) {\n\tvar rtcp = {\n\t\tcname: null,\n\t\treducedSize: true,\n\t\tmux: true\n\t};\n\n\tvar mSection = (sdpObj.media || []).find(function (m) {\n\t\treturn m.type === kind;\n\t});\n\n\tif (!mSection) throw new Error('m=' + kind + ' section not found');\n\n\t// Get the SSRC and CNAME.\n\n\tvar ssrcCnameLine = (mSection.ssrcs || []).find(function (line) {\n\t\treturn line.attribute === 'cname';\n\t});\n\n\tvar ssrc = void 0;\n\n\tif (ssrcCnameLine) {\n\t\tssrc = ssrcCnameLine.id;\n\t\trtcp.cname = ssrcCnameLine.value;\n\t}\n\n\t// Fill RTP parameters.\n\n\trtpParameters.rtcp = rtcp;\n\trtpParameters.encodings = [];\n\n\tvar encoding = { ssrc: ssrc };\n\n\trtpParameters.encodings.push(encoding);\n}\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/sdp/planBUtils.js\":\n/*!**********************************************!*\\\n  !*** ./lib/mslib/handlers/sdp/planBUtils.js ***!\n  \\**********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/slicedToArray.js\");\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nexports.fillRtpParametersForTrack = fillRtpParametersForTrack;\nexports.addSimulcastForTrack = addSimulcastForTrack;\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Fill the given RTP parameters for the given track.\n *\n * @param {RTCRtpParameters} rtpParameters -  RTP parameters to be filled.\n * @param {Object} sdpObj - Local SDP Object generated by sdpform.\n * @param {MediaStreamTrack} track\n */\nfunction fillRtpParametersForTrack(rtpParameters, sdpObj, track) {\n\tvar kind = track.kind;\n\tvar rtcp = {\n\t\tcname: null,\n\t\treducedSize: true,\n\t\tmux: true\n\t};\n\n\tvar mSection = (sdpObj.media || []).find(function (m) {\n\t\treturn m.type === kind;\n\t});\n\n\tif (!mSection) throw new Error('m=' + kind + ' section not found');\n\n\t// First media SSRC (or the only one).\n\tvar firstSsrc = void 0;\n\n\t// Get all the SSRCs.\n\n\tvar ssrcs = new _set2.default();\n\n\tvar _iteratorNormalCompletion = true;\n\tvar _didIteratorError = false;\n\tvar _iteratorError = undefined;\n\n\ttry {\n\t\tfor (var _iterator = (0, _getIterator3.default)(mSection.ssrcs || []), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\tvar line = _step.value;\n\n\t\t\tif (line.attribute !== 'msid') continue;\n\n\t\t\tvar trackId = line.value.split(' ')[1];\n\n\t\t\tif (trackId === track.id) {\n\t\t\t\tvar ssrc = line.id;\n\n\t\t\t\tssrcs.add(ssrc);\n\n\t\t\t\tif (!firstSsrc) firstSsrc = ssrc;\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError = true;\n\t\t_iteratorError = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t_iterator.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError) {\n\t\t\t\tthrow _iteratorError;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (ssrcs.size === 0) throw new Error('a=ssrc line not found for local track [track.id:' + track.id + ']');\n\n\t// Get media and RTX SSRCs.\n\n\tvar ssrcToRtxSsrc = new _map2.default();\n\n\t// First assume RTX is used.\n\tvar _iteratorNormalCompletion2 = true;\n\tvar _didIteratorError2 = false;\n\tvar _iteratorError2 = undefined;\n\n\ttry {\n\t\tfor (var _iterator2 = (0, _getIterator3.default)(mSection.ssrcGroups || []), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\tvar _line = _step2.value;\n\n\t\t\tif (_line.semantics !== 'FID') continue;\n\n\t\t\tvar _line$ssrcs$split = _line.ssrcs.split(/\\s+/),\n\t\t\t    _line$ssrcs$split2 = (0, _slicedToArray3.default)(_line$ssrcs$split, 2),\n\t\t\t    _ssrc = _line$ssrcs$split2[0],\n\t\t\t    rtxSsrc = _line$ssrcs$split2[1];\n\n\t\t\t_ssrc = Number(_ssrc);\n\t\t\trtxSsrc = Number(rtxSsrc);\n\n\t\t\tif (ssrcs.has(_ssrc)) {\n\t\t\t\t// Remove both the SSRC and RTX SSRC from the Set so later we know that they\n\t\t\t\t// are already handled.\n\t\t\t\tssrcs.delete(_ssrc);\n\t\t\t\tssrcs.delete(rtxSsrc);\n\n\t\t\t\t// Add to the map.\n\t\t\t\tssrcToRtxSsrc.set(_ssrc, rtxSsrc);\n\t\t\t}\n\t\t}\n\n\t\t// If the Set of SSRCs is not empty it means that RTX is not being used, so take\n\t\t// media SSRCs from there.\n\t} catch (err) {\n\t\t_didIteratorError2 = true;\n\t\t_iteratorError2 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t_iterator2.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError2) {\n\t\t\t\tthrow _iteratorError2;\n\t\t\t}\n\t\t}\n\t}\n\n\tvar _iteratorNormalCompletion3 = true;\n\tvar _didIteratorError3 = false;\n\tvar _iteratorError3 = undefined;\n\n\ttry {\n\t\tfor (var _iterator3 = (0, _getIterator3.default)(ssrcs), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\tvar _ssrc2 = _step3.value;\n\n\t\t\t// Add to the map.\n\t\t\tssrcToRtxSsrc.set(_ssrc2, null);\n\t\t}\n\n\t\t// Get RTCP info.\n\t} catch (err) {\n\t\t_didIteratorError3 = true;\n\t\t_iteratorError3 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t_iterator3.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError3) {\n\t\t\t\tthrow _iteratorError3;\n\t\t\t}\n\t\t}\n\t}\n\n\tvar ssrcCnameLine = mSection.ssrcs.find(function (line) {\n\t\treturn line.attribute === 'cname' && line.id === firstSsrc;\n\t});\n\n\tif (ssrcCnameLine) rtcp.cname = ssrcCnameLine.value;\n\n\t// Fill RTP parameters.\n\n\trtpParameters.rtcp = rtcp;\n\trtpParameters.encodings = [];\n\n\tvar simulcast = ssrcToRtxSsrc.size > 1;\n\tvar simulcastProfiles = ['low', 'medium', 'high'];\n\n\tvar _iteratorNormalCompletion4 = true;\n\tvar _didIteratorError4 = false;\n\tvar _iteratorError4 = undefined;\n\n\ttry {\n\t\tfor (var _iterator4 = (0, _getIterator3.default)(ssrcToRtxSsrc), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n\t\t\tvar _step4$value = (0, _slicedToArray3.default)(_step4.value, 2),\n\t\t\t    _ssrc3 = _step4$value[0],\n\t\t\t    rtxSsrc = _step4$value[1];\n\n\t\t\tvar encoding = { ssrc: _ssrc3 };\n\n\t\t\tif (rtxSsrc) encoding.rtx = { ssrc: rtxSsrc };\n\n\t\t\tif (simulcast) encoding.profile = simulcastProfiles.shift();\n\n\t\t\trtpParameters.encodings.push(encoding);\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError4 = true;\n\t\t_iteratorError4 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion4 && _iterator4.return) {\n\t\t\t\t_iterator4.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError4) {\n\t\t\t\tthrow _iteratorError4;\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Adds simulcast into the given SDP for the given track.\n *\n * @param {Object} sdpObj - Local SDP Object generated by sdpform.\n * @param {MediaStreamTrack} track\n */\nfunction addSimulcastForTrack(sdpObj, track) {\n\tvar kind = track.kind;\n\n\tvar mSection = (sdpObj.media || []).find(function (m) {\n\t\treturn m.type === kind;\n\t});\n\n\tif (!mSection) throw new Error('m=' + kind + ' section not found');\n\n\tvar ssrc = void 0;\n\tvar rtxSsrc = void 0;\n\tvar msid = void 0;\n\n\t// Get the SSRC.\n\n\tvar ssrcMsidLine = (mSection.ssrcs || []).find(function (line) {\n\t\tif (line.attribute !== 'msid') return false;\n\n\t\tvar trackId = line.value.split(' ')[1];\n\n\t\tif (trackId === track.id) {\n\t\t\tssrc = line.id;\n\t\t\tmsid = line.value.split(' ')[0];\n\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tif (!ssrcMsidLine) throw new Error('a=ssrc line not found for local track [track.id:' + track.id + ']');\n\n\t// Get the SSRC for RTX.\n\n\t(mSection.ssrcGroups || []).some(function (line) {\n\t\tif (line.semantics !== 'FID') return;\n\n\t\tvar ssrcs = line.ssrcs.split(/\\s+/);\n\n\t\tif (Number(ssrcs[0]) === ssrc) {\n\t\t\trtxSsrc = Number(ssrcs[1]);\n\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tvar ssrcCnameLine = mSection.ssrcs.find(function (line) {\n\t\treturn line.attribute === 'cname' && line.id === ssrc;\n\t});\n\n\tif (!ssrcCnameLine) throw new Error('CNAME line not found for local track [track.id:' + track.id + ']');\n\n\tvar cname = ssrcCnameLine.value;\n\tvar ssrc2 = ssrc + 1;\n\tvar ssrc3 = ssrc + 2;\n\n\tmSection.ssrcGroups = mSection.ssrcGroups || [];\n\n\tmSection.ssrcGroups.push({\n\t\tsemantics: 'SIM',\n\t\tssrcs: ssrc + ' ' + ssrc2 + ' ' + ssrc3\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc2,\n\t\tattribute: 'cname',\n\t\tvalue: cname\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc2,\n\t\tattribute: 'msid',\n\t\tvalue: msid + ' ' + track.id\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc3,\n\t\tattribute: 'cname',\n\t\tvalue: cname\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc3,\n\t\tattribute: 'msid',\n\t\tvalue: msid + ' ' + track.id\n\t});\n\n\tif (rtxSsrc) {\n\t\tvar rtxSsrc2 = rtxSsrc + 1;\n\t\tvar rtxSsrc3 = rtxSsrc + 2;\n\n\t\tmSection.ssrcGroups.push({\n\t\t\tsemantics: 'FID',\n\t\t\tssrcs: ssrc2 + ' ' + rtxSsrc2\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc2,\n\t\t\tattribute: 'cname',\n\t\t\tvalue: cname\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc2,\n\t\t\tattribute: 'msid',\n\t\t\tvalue: msid + ' ' + track.id\n\t\t});\n\n\t\tmSection.ssrcGroups.push({\n\t\t\tsemantics: 'FID',\n\t\t\tssrcs: ssrc3 + ' ' + rtxSsrc3\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc3,\n\t\t\tattribute: 'cname',\n\t\t\tvalue: cname\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc3,\n\t\t\tattribute: 'msid',\n\t\t\tvalue: msid + ' ' + track.id\n\t\t});\n\t}\n}\n\n/***/ }),\n\n/***/ \"./lib/mslib/handlers/sdp/unifiedPlanUtils.js\":\n/*!****************************************************!*\\\n  !*** ./lib/mslib/handlers/sdp/unifiedPlanUtils.js ***!\n  \\****************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _slicedToArray2 = __webpack_require__(/*! babel-runtime/helpers/slicedToArray */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/slicedToArray.js\");\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _set = __webpack_require__(/*! babel-runtime/core-js/set */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nexports.fillRtpParametersForTrack = fillRtpParametersForTrack;\nexports.addPlanBSimulcast = addPlanBSimulcast;\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Fill the given RTP parameters for the given mid or sending track.\n *\n * @param {RTCRtpParameters} rtpParameters -  RTP parameters to be filled.\n * @param {Object} sdpObj - Local SDP Object generated by sdpform.\n * @param {MediaStreamTrack} track\n * @param {String} [mid]\n * @param {Boolean} [planBSimulcast]\n */\nfunction fillRtpParametersForTrack(rtpParameters, sdpObj, track) {\n\tvar _ref = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {},\n\t    _ref$mid = _ref.mid,\n\t    mid = _ref$mid === undefined ? null : _ref$mid,\n\t    _ref$planBSimulcast = _ref.planBSimulcast,\n\t    planBSimulcast = _ref$planBSimulcast === undefined ? false : _ref$planBSimulcast;\n\n\tvar mSection = findMediaSection(sdpObj, track, mid);\n\n\tif (mid !== null && mid !== undefined) rtpParameters.muxId = String(mid);\n\n\trtpParameters.rtcp = {\n\t\tcname: null,\n\t\treducedSize: true,\n\t\tmux: true\n\t};\n\n\t// Get the SSRC and CNAME.\n\n\tvar ssrcCnameLine = (mSection.ssrcs || []).find(function (line) {\n\t\treturn line.attribute === 'cname';\n\t});\n\n\tif (!ssrcCnameLine) throw new Error('CNAME value not found');\n\n\trtpParameters.rtcp.cname = ssrcCnameLine.value;\n\n\t// Standard simylcast based on a=simulcast and RID.\n\tif (!planBSimulcast) {\n\t\t// Get first (and may be the only one) ssrc.\n\t\tvar ssrc = ssrcCnameLine.id;\n\n\t\t// Get a=rid lines.\n\n\t\t// Array of Objects with rid and profile keys.\n\t\tvar simulcastStreams = [];\n\n\t\tvar _iteratorNormalCompletion = true;\n\t\tvar _didIteratorError = false;\n\t\tvar _iteratorError = undefined;\n\n\t\ttry {\n\t\t\tfor (var _iterator = (0, _getIterator3.default)(mSection.rids || []), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\tvar rid = _step.value;\n\n\t\t\t\tif (rid.direction !== 'send') continue;\n\n\t\t\t\tif (/^low/.test(rid.id)) simulcastStreams.push({ rid: rid.id, profile: 'low' });else if (/^medium/.test(rid.id)) simulcastStreams.push({ rid: rid.id, profile: 'medium' });\n\t\t\t\tif (/^high/.test(rid.id)) simulcastStreams.push({ rid: rid.id, profile: 'high' });\n\t\t\t}\n\n\t\t\t// Fill RTP parameters.\n\t\t} catch (err) {\n\t\t\t_didIteratorError = true;\n\t\t\t_iteratorError = err;\n\t\t} finally {\n\t\t\ttry {\n\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t_iterator.return();\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\trtpParameters.encodings = [];\n\n\t\tif (simulcastStreams.length === 0) {\n\t\t\tvar encoding = { ssrc: ssrc };\n\n\t\t\trtpParameters.encodings.push(encoding);\n\t\t} else {\n\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\tvar _didIteratorError2 = false;\n\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator2 = (0, _getIterator3.default)(simulcastStreams), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\tvar simulcastStream = _step2.value;\n\n\t\t\t\t\tvar _encoding = {\n\t\t\t\t\t\tencodingId: simulcastStream.rid,\n\t\t\t\t\t\tprofile: simulcastStream.profile\n\t\t\t\t\t};\n\n\t\t\t\t\trtpParameters.encodings.push(_encoding);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t_iteratorError2 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t// Simulcast based on PlanB.\n\telse {\n\t\t\t// First media SSRC (or the only one).\n\t\t\tvar firstSsrc = void 0;\n\n\t\t\t// Get all the SSRCs.\n\n\t\t\tvar ssrcs = new _set2.default();\n\n\t\t\tvar _iteratorNormalCompletion3 = true;\n\t\t\tvar _didIteratorError3 = false;\n\t\t\tvar _iteratorError3 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator3 = (0, _getIterator3.default)(mSection.ssrcs || []), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\t\t\tvar line = _step3.value;\n\n\t\t\t\t\tif (line.attribute !== 'msid') continue;\n\n\t\t\t\t\tvar _ssrc = line.id;\n\n\t\t\t\t\tssrcs.add(_ssrc);\n\n\t\t\t\t\tif (!firstSsrc) firstSsrc = _ssrc;\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError3 = true;\n\t\t\t\t_iteratorError3 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t\t\t_iterator3.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError3) {\n\t\t\t\t\t\tthrow _iteratorError3;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (ssrcs.size === 0) throw new Error('no a=ssrc lines found');\n\n\t\t\t// Get media and RTX SSRCs.\n\n\t\t\tvar ssrcToRtxSsrc = new _map2.default();\n\n\t\t\t// First assume RTX is used.\n\t\t\tvar _iteratorNormalCompletion4 = true;\n\t\t\tvar _didIteratorError4 = false;\n\t\t\tvar _iteratorError4 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator4 = (0, _getIterator3.default)(mSection.ssrcGroups || []), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n\t\t\t\t\tvar _line = _step4.value;\n\n\t\t\t\t\tif (_line.semantics !== 'FID') continue;\n\n\t\t\t\t\tvar _line$ssrcs$split = _line.ssrcs.split(/\\s+/),\n\t\t\t\t\t    _line$ssrcs$split2 = (0, _slicedToArray3.default)(_line$ssrcs$split, 2),\n\t\t\t\t\t    _ssrc2 = _line$ssrcs$split2[0],\n\t\t\t\t\t    rtxSsrc = _line$ssrcs$split2[1];\n\n\t\t\t\t\t_ssrc2 = Number(_ssrc2);\n\t\t\t\t\trtxSsrc = Number(rtxSsrc);\n\n\t\t\t\t\tif (ssrcs.has(_ssrc2)) {\n\t\t\t\t\t\t// Remove both the SSRC and RTX SSRC from the Set so later we know that they\n\t\t\t\t\t\t// are already handled.\n\t\t\t\t\t\tssrcs.delete(_ssrc2);\n\t\t\t\t\t\tssrcs.delete(rtxSsrc);\n\n\t\t\t\t\t\t// Add to the map.\n\t\t\t\t\t\tssrcToRtxSsrc.set(_ssrc2, rtxSsrc);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If the Set of SSRCs is not empty it means that RTX is not being used, so take\n\t\t\t\t// media SSRCs from there.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError4 = true;\n\t\t\t\t_iteratorError4 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion4 && _iterator4.return) {\n\t\t\t\t\t\t_iterator4.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError4) {\n\t\t\t\t\t\tthrow _iteratorError4;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion5 = true;\n\t\t\tvar _didIteratorError5 = false;\n\t\t\tvar _iteratorError5 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator5 = (0, _getIterator3.default)(ssrcs), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n\t\t\t\t\tvar _ssrc3 = _step5.value;\n\n\t\t\t\t\t// Add to the map.\n\t\t\t\t\tssrcToRtxSsrc.set(_ssrc3, null);\n\t\t\t\t}\n\n\t\t\t\t// Fill RTP parameters.\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError5 = true;\n\t\t\t\t_iteratorError5 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion5 && _iterator5.return) {\n\t\t\t\t\t\t_iterator5.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError5) {\n\t\t\t\t\t\tthrow _iteratorError5;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trtpParameters.encodings = [];\n\n\t\t\tvar simulcast = ssrcToRtxSsrc.size > 1;\n\t\t\tvar simulcastProfiles = ['low', 'medium', 'high'];\n\n\t\t\tvar _iteratorNormalCompletion6 = true;\n\t\t\tvar _didIteratorError6 = false;\n\t\t\tvar _iteratorError6 = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator6 = (0, _getIterator3.default)(ssrcToRtxSsrc), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n\t\t\t\t\tvar _step6$value = (0, _slicedToArray3.default)(_step6.value, 2),\n\t\t\t\t\t    _ssrc4 = _step6$value[0],\n\t\t\t\t\t    rtxSsrc = _step6$value[1];\n\n\t\t\t\t\tvar _encoding2 = { ssrc: _ssrc4 };\n\n\t\t\t\t\tif (rtxSsrc) _encoding2.rtx = { ssrc: rtxSsrc };\n\n\t\t\t\t\tif (simulcast) _encoding2.profile = simulcastProfiles.shift();\n\n\t\t\t\t\trtpParameters.encodings.push(_encoding2);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError6 = true;\n\t\t\t\t_iteratorError6 = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion6 && _iterator6.return) {\n\t\t\t\t\t\t_iterator6.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError6) {\n\t\t\t\t\t\tthrow _iteratorError6;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n}\n\n/**\n * Adds multi-ssrc based simulcast (PlanB) into the given SDP for the given mid\n * or track.\n * NOTE: This is for Chrome/Safari using Unified-Plan with legacy simulcast.\n *\n * @param {Object} sdpObj - Local SDP Object generated by sdpform.\n * @param {MediaStreamTrack} track\n * @param {String} [mid]\n */\nfunction addPlanBSimulcast(sdpObj, track) {\n\tvar _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n\t    _ref2$mid = _ref2.mid,\n\t    mid = _ref2$mid === undefined ? null : _ref2$mid;\n\n\tvar mSection = findMediaSection(sdpObj, track, mid);\n\n\t// Get the SSRC.\n\n\tvar ssrcMsidLine = (mSection.ssrcs || []).find(function (line) {\n\t\treturn line.attribute === 'msid';\n\t});\n\n\tif (!ssrcMsidLine) throw new Error('a=ssrc line with msid information not found');\n\n\tvar ssrc = ssrcMsidLine.id;\n\tvar msid = ssrcMsidLine.value.split(' ')[0];\n\tvar rtxSsrc = void 0;\n\n\t// Get the SSRC for RTX.\n\n\t(mSection.ssrcGroups || []).some(function (line) {\n\t\tif (line.semantics !== 'FID') return;\n\n\t\tvar ssrcs = line.ssrcs.split(/\\s+/);\n\n\t\tif (Number(ssrcs[0]) === ssrc) {\n\t\t\trtxSsrc = Number(ssrcs[1]);\n\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tvar ssrcCnameLine = mSection.ssrcs.find(function (line) {\n\t\treturn line.attribute === 'cname' && line.id === ssrc;\n\t});\n\n\tif (!ssrcCnameLine) throw new Error('CNAME line not found');\n\n\tvar cname = ssrcCnameLine.value;\n\tvar ssrc2 = ssrc + 1;\n\tvar ssrc3 = ssrc + 2;\n\n\t// mSection.ssrcGroups = mSection.ssrcGroups || [];\n\tmSection.ssrcGroups = [];\n\tmSection.ssrcs = [];\n\n\tmSection.ssrcGroups.push({\n\t\tsemantics: 'SIM',\n\t\tssrcs: ssrc + ' ' + ssrc2 + ' ' + ssrc3\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc,\n\t\tattribute: 'cname',\n\t\tvalue: cname\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc,\n\t\tattribute: 'msid',\n\t\tvalue: msid + ' ' + track.id\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc2,\n\t\tattribute: 'cname',\n\t\tvalue: cname\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc2,\n\t\tattribute: 'msid',\n\t\tvalue: msid + ' ' + track.id\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc3,\n\t\tattribute: 'cname',\n\t\tvalue: cname\n\t});\n\n\tmSection.ssrcs.push({\n\t\tid: ssrc3,\n\t\tattribute: 'msid',\n\t\tvalue: msid + ' ' + track.id\n\t});\n\n\tif (rtxSsrc) {\n\t\tvar rtxSsrc2 = rtxSsrc + 1;\n\t\tvar rtxSsrc3 = rtxSsrc + 2;\n\n\t\tmSection.ssrcGroups.push({\n\t\t\tsemantics: 'FID',\n\t\t\tssrcs: ssrc + ' ' + rtxSsrc\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc,\n\t\t\tattribute: 'cname',\n\t\t\tvalue: cname\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc,\n\t\t\tattribute: 'msid',\n\t\t\tvalue: msid + ' ' + track.id\n\t\t});\n\n\t\tmSection.ssrcGroups.push({\n\t\t\tsemantics: 'FID',\n\t\t\tssrcs: ssrc2 + ' ' + rtxSsrc2\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc2,\n\t\t\tattribute: 'cname',\n\t\t\tvalue: cname\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc2,\n\t\t\tattribute: 'msid',\n\t\t\tvalue: msid + ' ' + track.id\n\t\t});\n\n\t\tmSection.ssrcGroups.push({\n\t\t\tsemantics: 'FID',\n\t\t\tssrcs: ssrc3 + ' ' + rtxSsrc3\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc3,\n\t\t\tattribute: 'cname',\n\t\t\tvalue: cname\n\t\t});\n\n\t\tmSection.ssrcs.push({\n\t\t\tid: rtxSsrc3,\n\t\t\tattribute: 'msid',\n\t\t\tvalue: msid + ' ' + track.id\n\t\t});\n\t}\n}\n\nfunction findMediaSection(sdpObj, track, mid) {\n\tvar mSection = void 0;\n\n\tif (mid !== null && mid !== undefined) {\n\t\tmid = String(mid);\n\n\t\tmSection = (sdpObj.media || []).find(function (m) {\n\t\t\treturn String(m.mid) === mid;\n\t\t});\n\n\t\tif (!mSection) throw new Error('SDP section with mid=' + mid + ' not found');\n\t} else {\n\t\tmSection = (sdpObj.media || []).find(function (m) {\n\t\t\treturn m.type === track.kind && m.msid && m.msid.split(' ')[1] === track.id;\n\t\t});\n\n\t\tif (!mSection) throw new Error('SDP section with a=msid containing track.id=' + track.id + ' not found');\n\t}\n\n\treturn mSection;\n}\n\n/***/ }),\n\n/***/ \"./lib/mslib/index.js\":\n/*!****************************!*\\\n  !*** ./lib/mslib/index.js ***!\n  \\****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.internals = exports.Room = undefined;\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nexports.setDeviceHandler = setDeviceHandler;\nexports.isDeviceSupported = isDeviceSupported;\nexports.getDeviceInfo = getDeviceInfo;\nexports.checkCapabilitiesForRoom = checkCapabilitiesForRoom;\n\nvar _ortc = __webpack_require__(/*! ./ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _Device = __webpack_require__(/*! ./Device */ \"./lib/mslib/Device.js\");\n\nvar _Device2 = _interopRequireDefault(_Device);\n\nvar _Room = __webpack_require__(/*! ./Room */ \"./lib/mslib/Room.js\");\n\nvar _Room2 = _interopRequireDefault(_Room);\n\nvar _internals = __webpack_require__(/*! ./internals */ \"./lib/mslib/internals.js\");\n\nvar internals = _interopRequireWildcard(_internals);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * mediasoup-client v2.4.9.\n *\n * Provides a custom RTC handler class and avoid auto-detection. Useful\n * for making mediasoup-client work with custom devices.\n *\n * NOTE: This function must be called upon library load.\n *\n * @param {Class} handler - A handler class.\n * @param {Object} [metadata] - Handler metadata.\n * @param {String} [metadata.flag] - Handler flag.\n * @param {String} [metadata.name] - Handler name.\n * @param {String} [metadata.version] - Handler version.\n * @param {Object} [metadata.bowser] - Handler bowser Object.\n */\nfunction setDeviceHandler(handler, metadata) {\n  _Device2.default.setHandler(handler, metadata);\n}\n\n/**\n * Whether the current browser or device is supported.\n *\n * @return {Boolean}\n *\n * @example\n * isDeviceSupported()\n * // => true\n */\nfunction isDeviceSupported() {\n  return _Device2.default.isSupported();\n}\n\n/**\n * Get information regarding the current browser or device.\n *\n * @return {Object} - Object with `name` (String) and version {String}.\n *\n * @example\n * getDeviceInfo()\n * // => { flag: 'chrome', name: 'Chrome', version: '59.0', bowser: {} }\n */\nfunction getDeviceInfo() {\n  return {\n    flag: _Device2.default.getFlag(),\n    name: _Device2.default.getName(),\n    version: _Device2.default.getVersion(),\n    bowser: _Device2.default.getBowser()\n  };\n}\n\n/**\n * Check whether this device/browser can send/receive audio/video in a room\n * whose RTP capabilities are given.\n *\n * @param {Object} Room RTP capabilities.\n *\n * @return {Promise} Resolves to an Object with 'audio' and 'video' Booleans.\n */\nfunction checkCapabilitiesForRoom(roomRtpCapabilities) {\n  if (!_Device2.default.isSupported()) return _promise2.default.reject(new Error('current browser/device not supported'));\n\n  return _Device2.default.Handler.getNativeRtpCapabilities().then(function (nativeRtpCapabilities) {\n    var extendedRtpCapabilities = ortc.getExtendedRtpCapabilities(nativeRtpCapabilities, roomRtpCapabilities);\n\n    return {\n      audio: ortc.canSend('audio', extendedRtpCapabilities),\n      video: ortc.canSend('video', extendedRtpCapabilities)\n    };\n  });\n}\n\n/**\n * Expose the Room class.\n *\n * @example\n * const room = new Room();`\n */\nexports.Room = _Room2.default;\n\n/**\n * Expose internals.\n */\n\nexports.internals = internals;\n\n/**\n * REF: Base upon the stabile release es5-lib's version of mediasoup-client 2.4.9.\n * NOTE: Carefully modify there folder files especially in heandlers/ for Full Compatibility broswers\n * Changelogs:\n * Get peerconnect sates. date:\n * Get sender. date: 8/20/2019\n * Remove Sender. date: 8/20/2019\n * Use ES6. date: 10/10/2019\n */\n\n/***/ }),\n\n/***/ \"./lib/mslib/internals.js\":\n/*!********************************!*\\\n  !*** ./lib/mslib/internals.js ***!\n  \\********************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.RemotePlainRtpSdp = exports.RemotePlanBSdp = exports.RemoteUnifiedPlanSdp = exports.sdpPlainRtpUtils = exports.sdpPlanBUtils = exports.sdpUnifiedPlanUtils = exports.sdpCommonUtils = exports.ortc = exports.utils = exports.EnhancedEventEmitter = exports.Logger = undefined;\n\nvar _Logger = __webpack_require__(/*! ./Logger */ \"./lib/mslib/Logger.js\");\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _EnhancedEventEmitter = __webpack_require__(/*! ./EnhancedEventEmitter */ \"./lib/mslib/EnhancedEventEmitter.js\");\n\nvar _EnhancedEventEmitter2 = _interopRequireDefault(_EnhancedEventEmitter);\n\nvar _utils = __webpack_require__(/*! ./utils */ \"./lib/mslib/utils.js\");\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _ortc = __webpack_require__(/*! ./ortc */ \"./lib/mslib/ortc.js\");\n\nvar ortc = _interopRequireWildcard(_ortc);\n\nvar _commonUtils = __webpack_require__(/*! ./handlers/sdp/commonUtils */ \"./lib/mslib/handlers/sdp/commonUtils.js\");\n\nvar sdpCommonUtils = _interopRequireWildcard(_commonUtils);\n\nvar _unifiedPlanUtils = __webpack_require__(/*! ./handlers/sdp/unifiedPlanUtils */ \"./lib/mslib/handlers/sdp/unifiedPlanUtils.js\");\n\nvar sdpUnifiedPlanUtils = _interopRequireWildcard(_unifiedPlanUtils);\n\nvar _planBUtils = __webpack_require__(/*! ./handlers/sdp/planBUtils */ \"./lib/mslib/handlers/sdp/planBUtils.js\");\n\nvar sdpPlanBUtils = _interopRequireWildcard(_planBUtils);\n\nvar _plainRtpUtils = __webpack_require__(/*! ./handlers/sdp/plainRtpUtils */ \"./lib/mslib/handlers/sdp/plainRtpUtils.js\");\n\nvar sdpPlainRtpUtils = _interopRequireWildcard(_plainRtpUtils);\n\nvar _RemoteUnifiedPlanSdp = __webpack_require__(/*! ./handlers/sdp/RemoteUnifiedPlanSdp */ \"./lib/mslib/handlers/sdp/RemoteUnifiedPlanSdp.js\");\n\nvar _RemoteUnifiedPlanSdp2 = _interopRequireDefault(_RemoteUnifiedPlanSdp);\n\nvar _RemotePlanBSdp = __webpack_require__(/*! ./handlers/sdp/RemotePlanBSdp */ \"./lib/mslib/handlers/sdp/RemotePlanBSdp.js\");\n\nvar _RemotePlanBSdp2 = _interopRequireDefault(_RemotePlanBSdp);\n\nvar _RemotePlainRtpSdp = __webpack_require__(/*! ./handlers/sdp/RemotePlainRtpSdp */ \"./lib/mslib/handlers/sdp/RemotePlainRtpSdp.js\");\n\nvar _RemotePlainRtpSdp2 = _interopRequireDefault(_RemotePlainRtpSdp);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.Logger = _Logger2.default;\nexports.EnhancedEventEmitter = _EnhancedEventEmitter2.default;\nexports.utils = utils;\nexports.ortc = ortc;\nexports.sdpCommonUtils = sdpCommonUtils;\nexports.sdpUnifiedPlanUtils = sdpUnifiedPlanUtils;\nexports.sdpPlanBUtils = sdpPlanBUtils;\nexports.sdpPlainRtpUtils = sdpPlainRtpUtils;\nexports.RemoteUnifiedPlanSdp = _RemoteUnifiedPlanSdp2.default;\nexports.RemotePlanBSdp = _RemotePlanBSdp2.default;\nexports.RemotePlainRtpSdp = _RemotePlainRtpSdp2.default; /**\n                                                          * This module is intended for custom handler developers and exposes internal\n                                                          * API and utilities. No public documentation is provided.\n                                                          */\n\n/***/ }),\n\n/***/ \"./lib/mslib/ortc.js\":\n/*!***************************!*\\\n  !*** ./lib/mslib/ortc.js ***!\n  \\***************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _getIterator2 = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nexports.getExtendedRtpCapabilities = getExtendedRtpCapabilities;\nexports.getRtpCapabilities = getRtpCapabilities;\nexports.getUnsupportedCodecs = getUnsupportedCodecs;\nexports.canSend = canSend;\nexports.canReceive = canReceive;\nexports.getSendingRtpParameters = getSendingRtpParameters;\nexports.getReceivingFullRtpParameters = getReceivingFullRtpParameters;\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Generate extended RTP capabilities for sending and receiving.\n *\n * @param {RTCRtpCapabilities} localCaps - Local capabilities.\n * @param {RTCRtpCapabilities} remoteCaps - Remote capabilities.\n *\n * @return {RTCExtendedRtpCapabilities}\n */\nfunction getExtendedRtpCapabilities(localCaps, remoteCaps) {\n\tvar extendedCaps = {\n\t\tcodecs: [],\n\t\theaderExtensions: [],\n\t\tfecMechanisms: []\n\t};\n\n\t// Match media codecs and keep the order preferred by remoteCaps.\n\tvar _iteratorNormalCompletion = true;\n\tvar _didIteratorError = false;\n\tvar _iteratorError = undefined;\n\n\ttry {\n\t\tvar _loop = function _loop() {\n\t\t\tvar remoteCodec = _step.value;\n\n\t\t\t// TODO: Ignore pseudo-codecs and feature codecs.\n\t\t\tif (remoteCodec.name === 'rtx') return 'continue';\n\n\t\t\tvar matchingLocalCodec = (localCaps.codecs || []).find(function (localCodec) {\n\t\t\t\treturn matchCapCodecs(localCodec, remoteCodec);\n\t\t\t});\n\n\t\t\tif (matchingLocalCodec) {\n\t\t\t\tvar extendedCodec = {\n\t\t\t\t\tname: remoteCodec.name,\n\t\t\t\t\tmimeType: remoteCodec.mimeType,\n\t\t\t\t\tkind: remoteCodec.kind,\n\t\t\t\t\tclockRate: remoteCodec.clockRate,\n\t\t\t\t\tsendPayloadType: matchingLocalCodec.preferredPayloadType,\n\t\t\t\t\tsendRtxPayloadType: null,\n\t\t\t\t\trecvPayloadType: remoteCodec.preferredPayloadType,\n\t\t\t\t\trecvRtxPayloadType: null,\n\t\t\t\t\tchannels: remoteCodec.channels,\n\t\t\t\t\trtcpFeedback: reduceRtcpFeedback(matchingLocalCodec, remoteCodec),\n\t\t\t\t\tparameters: remoteCodec.parameters\n\t\t\t\t};\n\n\t\t\t\tif (!extendedCodec.channels) delete extendedCodec.channels;\n\n\t\t\t\textendedCaps.codecs.push(extendedCodec);\n\t\t\t}\n\t\t};\n\n\t\tfor (var _iterator = (0, _getIterator3.default)(remoteCaps.codecs || []), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\tvar _ret = _loop();\n\n\t\t\tif (_ret === 'continue') continue;\n\t\t}\n\n\t\t// Match RTX codecs.\n\t} catch (err) {\n\t\t_didIteratorError = true;\n\t\t_iteratorError = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t_iterator.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError) {\n\t\t\t\tthrow _iteratorError;\n\t\t\t}\n\t\t}\n\t}\n\n\tvar _iteratorNormalCompletion2 = true;\n\tvar _didIteratorError2 = false;\n\tvar _iteratorError2 = undefined;\n\n\ttry {\n\t\tvar _loop2 = function _loop2() {\n\t\t\tvar extendedCodec = _step2.value;\n\n\t\t\tvar matchingLocalRtxCodec = (localCaps.codecs || []).find(function (localCodec) {\n\t\t\t\treturn localCodec.name === 'rtx' && localCodec.parameters.apt === extendedCodec.sendPayloadType;\n\t\t\t});\n\n\t\t\tvar matchingRemoteRtxCodec = (remoteCaps.codecs || []).find(function (remoteCodec) {\n\t\t\t\treturn remoteCodec.name === 'rtx' && remoteCodec.parameters.apt === extendedCodec.recvPayloadType;\n\t\t\t});\n\n\t\t\tif (matchingLocalRtxCodec && matchingRemoteRtxCodec) {\n\t\t\t\textendedCodec.sendRtxPayloadType = matchingLocalRtxCodec.preferredPayloadType;\n\t\t\t\textendedCodec.recvRtxPayloadType = matchingRemoteRtxCodec.preferredPayloadType;\n\t\t\t}\n\t\t};\n\n\t\tfor (var _iterator2 = (0, _getIterator3.default)(extendedCaps.codecs || []), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t_loop2();\n\t\t}\n\n\t\t// Match header extensions.\n\t} catch (err) {\n\t\t_didIteratorError2 = true;\n\t\t_iteratorError2 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t_iterator2.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError2) {\n\t\t\t\tthrow _iteratorError2;\n\t\t\t}\n\t\t}\n\t}\n\n\tvar _iteratorNormalCompletion3 = true;\n\tvar _didIteratorError3 = false;\n\tvar _iteratorError3 = undefined;\n\n\ttry {\n\t\tvar _loop3 = function _loop3() {\n\t\t\tvar remoteExt = _step3.value;\n\n\t\t\tvar matchingLocalExt = (localCaps.headerExtensions || []).find(function (localExt) {\n\t\t\t\treturn matchCapHeaderExtensions(localExt, remoteExt);\n\t\t\t});\n\n\t\t\tif (matchingLocalExt) {\n\t\t\t\tvar extendedExt = {\n\t\t\t\t\tkind: remoteExt.kind,\n\t\t\t\t\turi: remoteExt.uri,\n\t\t\t\t\tsendId: matchingLocalExt.preferredId,\n\t\t\t\t\trecvId: remoteExt.preferredId\n\t\t\t\t};\n\n\t\t\t\textendedCaps.headerExtensions.push(extendedExt);\n\t\t\t}\n\t\t};\n\n\t\tfor (var _iterator3 = (0, _getIterator3.default)(remoteCaps.headerExtensions || []), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\t_loop3();\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError3 = true;\n\t\t_iteratorError3 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t_iterator3.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError3) {\n\t\t\t\tthrow _iteratorError3;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn extendedCaps;\n}\n\n/**\n * Generate RTP capabilities for receiving media based on the given extended\n * RTP capabilities.\n *\n * @param {RTCExtendedRtpCapabilities} extendedRtpCapabilities\n *\n * @return {RTCRtpCapabilities}\n */\nfunction getRtpCapabilities(extendedRtpCapabilities) {\n\tvar caps = {\n\t\tcodecs: [],\n\t\theaderExtensions: [],\n\t\tfecMechanisms: []\n\t};\n\n\tvar _iteratorNormalCompletion4 = true;\n\tvar _didIteratorError4 = false;\n\tvar _iteratorError4 = undefined;\n\n\ttry {\n\t\tfor (var _iterator4 = (0, _getIterator3.default)(extendedRtpCapabilities.codecs), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n\t\t\tvar capCodec = _step4.value;\n\n\t\t\tvar codec = {\n\t\t\t\tname: capCodec.name,\n\t\t\t\tmimeType: capCodec.mimeType,\n\t\t\t\tkind: capCodec.kind,\n\t\t\t\tclockRate: capCodec.clockRate,\n\t\t\t\tpreferredPayloadType: capCodec.recvPayloadType,\n\t\t\t\tchannels: capCodec.channels,\n\t\t\t\trtcpFeedback: capCodec.rtcpFeedback,\n\t\t\t\tparameters: capCodec.parameters\n\t\t\t};\n\n\t\t\tif (!codec.channels) delete codec.channels;\n\n\t\t\tcaps.codecs.push(codec);\n\n\t\t\t// Add RTX codec.\n\t\t\tif (capCodec.recvRtxPayloadType) {\n\t\t\t\tvar rtxCapCodec = {\n\t\t\t\t\tname: 'rtx',\n\t\t\t\t\tmimeType: capCodec.kind + '/rtx',\n\t\t\t\t\tkind: capCodec.kind,\n\t\t\t\t\tclockRate: capCodec.clockRate,\n\t\t\t\t\tpreferredPayloadType: capCodec.recvRtxPayloadType,\n\t\t\t\t\tparameters: {\n\t\t\t\t\t\tapt: capCodec.recvPayloadType\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tcaps.codecs.push(rtxCapCodec);\n\t\t\t}\n\n\t\t\t// TODO: In the future, we need to add FEC, CN, etc, codecs.\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError4 = true;\n\t\t_iteratorError4 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion4 && _iterator4.return) {\n\t\t\t\t_iterator4.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError4) {\n\t\t\t\tthrow _iteratorError4;\n\t\t\t}\n\t\t}\n\t}\n\n\tvar _iteratorNormalCompletion5 = true;\n\tvar _didIteratorError5 = false;\n\tvar _iteratorError5 = undefined;\n\n\ttry {\n\t\tfor (var _iterator5 = (0, _getIterator3.default)(extendedRtpCapabilities.headerExtensions), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n\t\t\tvar capExt = _step5.value;\n\n\t\t\tvar ext = {\n\t\t\t\tkind: capExt.kind,\n\t\t\t\turi: capExt.uri,\n\t\t\t\tpreferredId: capExt.recvId\n\t\t\t};\n\n\t\t\tcaps.headerExtensions.push(ext);\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError5 = true;\n\t\t_iteratorError5 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion5 && _iterator5.return) {\n\t\t\t\t_iterator5.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError5) {\n\t\t\t\tthrow _iteratorError5;\n\t\t\t}\n\t\t}\n\t}\n\n\tcaps.fecMechanisms = extendedRtpCapabilities.fecMechanisms;\n\n\treturn caps;\n}\n\n/**\n * Get unsupported remote codecs.\n *\n * @param {RTCRtpCapabilities} remoteCaps - Remote capabilities.\n * @param {Array<Number>} mandatoryCodecPayloadTypes - List of codec PT values.\n * @param {RTCExtendedRtpCapabilities} extendedRtpCapabilities\n *\n * @return {Boolean}\n */\nfunction getUnsupportedCodecs(remoteCaps, mandatoryCodecPayloadTypes, extendedRtpCapabilities) {\n\t// If not given just ignore.\n\tif (!Array.isArray(mandatoryCodecPayloadTypes)) return [];\n\n\tvar unsupportedCodecs = [];\n\tvar remoteCodecs = remoteCaps.codecs;\n\tvar supportedCodecs = extendedRtpCapabilities.codecs;\n\n\tvar _iteratorNormalCompletion6 = true;\n\tvar _didIteratorError6 = false;\n\tvar _iteratorError6 = undefined;\n\n\ttry {\n\t\tvar _loop4 = function _loop4() {\n\t\t\tvar pt = _step6.value;\n\n\t\t\tif (!supportedCodecs.some(function (codec) {\n\t\t\t\treturn codec.recvPayloadType === pt;\n\t\t\t})) {\n\t\t\t\tvar unsupportedCodec = remoteCodecs.find(function (codec) {\n\t\t\t\t\treturn codec.preferredPayloadType === pt;\n\t\t\t\t});\n\n\t\t\t\tif (!unsupportedCodec) throw new Error('mandatory codec PT ' + pt + ' not found in remote codecs');\n\n\t\t\t\tunsupportedCodecs.push(unsupportedCodec);\n\t\t\t}\n\t\t};\n\n\t\tfor (var _iterator6 = (0, _getIterator3.default)(mandatoryCodecPayloadTypes), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n\t\t\t_loop4();\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError6 = true;\n\t\t_iteratorError6 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion6 && _iterator6.return) {\n\t\t\t\t_iterator6.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError6) {\n\t\t\t\tthrow _iteratorError6;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn unsupportedCodecs;\n}\n\n/**\n * Whether media can be sent based on the given RTP capabilities.\n *\n * @param {String} kind\n * @param {RTCExtendedRtpCapabilities} extendedRtpCapabilities\n *\n * @return {Boolean}\n */\nfunction canSend(kind, extendedRtpCapabilities) {\n\treturn extendedRtpCapabilities.codecs.some(function (codec) {\n\t\treturn codec.kind === kind;\n\t});\n}\n\n/**\n * Whether the given RTP parameters can be received with the given RTP\n * capabilities.\n *\n * @param {RTCRtpParameters} rtpParameters\n * @param {RTCExtendedRtpCapabilities} extendedRtpCapabilities\n *\n * @return {Boolean}\n */\nfunction canReceive(rtpParameters, extendedRtpCapabilities) {\n\tif (rtpParameters.codecs.length === 0) return false;\n\n\tvar firstMediaCodec = rtpParameters.codecs[0];\n\n\treturn extendedRtpCapabilities.codecs.some(function (codec) {\n\t\treturn codec.recvPayloadType === firstMediaCodec.payloadType;\n\t});\n}\n\n/**\n * Generate RTP parameters of the given kind for sending media.\n * Just the first media codec per kind is considered.\n * NOTE: muxId, encodings and rtcp fields are left empty.\n *\n * @param {kind} kind\n * @param {RTCExtendedRtpCapabilities} extendedRtpCapabilities\n *\n * @return {RTCRtpParameters}\n */\nfunction getSendingRtpParameters(kind, extendedRtpCapabilities) {\n\tvar params = {\n\t\tmuxId: null,\n\t\tcodecs: [],\n\t\theaderExtensions: [],\n\t\tencodings: [],\n\t\trtcp: {}\n\t};\n\n\tvar _iteratorNormalCompletion7 = true;\n\tvar _didIteratorError7 = false;\n\tvar _iteratorError7 = undefined;\n\n\ttry {\n\t\tfor (var _iterator7 = (0, _getIterator3.default)(extendedRtpCapabilities.codecs), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n\t\t\tvar capCodec = _step7.value;\n\n\t\t\tif (capCodec.kind !== kind) continue;\n\n\t\t\tvar codec = {\n\t\t\t\tname: capCodec.name,\n\t\t\t\tmimeType: capCodec.mimeType,\n\t\t\t\tclockRate: capCodec.clockRate,\n\t\t\t\tpayloadType: capCodec.sendPayloadType,\n\t\t\t\tchannels: capCodec.channels,\n\t\t\t\trtcpFeedback: capCodec.rtcpFeedback,\n\t\t\t\tparameters: capCodec.parameters\n\t\t\t};\n\n\t\t\tif (!codec.channels) delete codec.channels;\n\n\t\t\tparams.codecs.push(codec);\n\n\t\t\t// Add RTX codec.\n\t\t\tif (capCodec.sendRtxPayloadType) {\n\t\t\t\tvar rtxCodec = {\n\t\t\t\t\tname: 'rtx',\n\t\t\t\t\tmimeType: capCodec.kind + '/rtx',\n\t\t\t\t\tclockRate: capCodec.clockRate,\n\t\t\t\t\tpayloadType: capCodec.sendRtxPayloadType,\n\t\t\t\t\tparameters: {\n\t\t\t\t\t\tapt: capCodec.sendPayloadType\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tparams.codecs.push(rtxCodec);\n\t\t\t}\n\n\t\t\t// NOTE: We assume a single media codec plus an optional RTX codec for now.\n\t\t\t// TODO: In the future, we need to add FEC, CN, etc, codecs.\n\t\t\t// jove 2020/2/24 break;\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError7 = true;\n\t\t_iteratorError7 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion7 && _iterator7.return) {\n\t\t\t\t_iterator7.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError7) {\n\t\t\t\tthrow _iteratorError7;\n\t\t\t}\n\t\t}\n\t}\n\n\tvar _iteratorNormalCompletion8 = true;\n\tvar _didIteratorError8 = false;\n\tvar _iteratorError8 = undefined;\n\n\ttry {\n\t\tfor (var _iterator8 = (0, _getIterator3.default)(extendedRtpCapabilities.headerExtensions), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n\t\t\tvar capExt = _step8.value;\n\n\t\t\tif (capExt.kind && capExt.kind !== kind) continue;\n\n\t\t\tvar ext = {\n\t\t\t\turi: capExt.uri,\n\t\t\t\tid: capExt.sendId\n\t\t\t};\n\n\t\t\tparams.headerExtensions.push(ext);\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError8 = true;\n\t\t_iteratorError8 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion8 && _iterator8.return) {\n\t\t\t\t_iterator8.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError8) {\n\t\t\t\tthrow _iteratorError8;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn params;\n}\n\n/**\n * Generate RTP parameters of the given kind for receiving media.\n * All the media codecs per kind are considered. This is useful for generating\n * a SDP remote offer.\n * NOTE: muxId, encodings and rtcp fields are left empty.\n *\n * @param {String} kind\n * @param {RTCExtendedRtpCapabilities} extendedRtpCapabilities\n *\n * @return {RTCRtpParameters}\n */\nfunction getReceivingFullRtpParameters(kind, extendedRtpCapabilities) {\n\tvar params = {\n\t\tmuxId: null,\n\t\tcodecs: [],\n\t\theaderExtensions: [],\n\t\tencodings: [],\n\t\trtcp: {}\n\t};\n\n\tvar _iteratorNormalCompletion9 = true;\n\tvar _didIteratorError9 = false;\n\tvar _iteratorError9 = undefined;\n\n\ttry {\n\t\tfor (var _iterator9 = (0, _getIterator3.default)(extendedRtpCapabilities.codecs), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {\n\t\t\tvar capCodec = _step9.value;\n\n\t\t\tif (capCodec.kind !== kind) continue;\n\n\t\t\tvar codec = {\n\t\t\t\tname: capCodec.name,\n\t\t\t\tmimeType: capCodec.mimeType,\n\t\t\t\tclockRate: capCodec.clockRate,\n\t\t\t\tpayloadType: capCodec.recvPayloadType,\n\t\t\t\tchannels: capCodec.channels,\n\t\t\t\trtcpFeedback: capCodec.rtcpFeedback,\n\t\t\t\tparameters: capCodec.parameters\n\t\t\t};\n\n\t\t\tif (!codec.channels) delete codec.channels;\n\n\t\t\tparams.codecs.push(codec);\n\n\t\t\t// Add RTX codec.\n\t\t\tif (capCodec.recvRtxPayloadType) {\n\t\t\t\tvar rtxCodec = {\n\t\t\t\t\tname: 'rtx',\n\t\t\t\t\tmimeType: capCodec.kind + '/rtx',\n\t\t\t\t\tclockRate: capCodec.clockRate,\n\t\t\t\t\tpayloadType: capCodec.recvRtxPayloadType,\n\t\t\t\t\tparameters: {\n\t\t\t\t\t\tapt: capCodec.recvPayloadType\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tparams.codecs.push(rtxCodec);\n\t\t\t}\n\n\t\t\t// TODO: In the future, we need to add FEC, CN, etc, codecs.\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError9 = true;\n\t\t_iteratorError9 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion9 && _iterator9.return) {\n\t\t\t\t_iterator9.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError9) {\n\t\t\t\tthrow _iteratorError9;\n\t\t\t}\n\t\t}\n\t}\n\n\tvar _iteratorNormalCompletion10 = true;\n\tvar _didIteratorError10 = false;\n\tvar _iteratorError10 = undefined;\n\n\ttry {\n\t\tfor (var _iterator10 = (0, _getIterator3.default)(extendedRtpCapabilities.headerExtensions), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n\t\t\tvar capExt = _step10.value;\n\n\t\t\tif (capExt.kind && capExt.kind !== kind) continue;\n\n\t\t\tvar ext = {\n\t\t\t\turi: capExt.uri,\n\t\t\t\tid: capExt.recvId\n\t\t\t};\n\n\t\t\tparams.headerExtensions.push(ext);\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError10 = true;\n\t\t_iteratorError10 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion10 && _iterator10.return) {\n\t\t\t\t_iterator10.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError10) {\n\t\t\t\tthrow _iteratorError10;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn params;\n}\n\nfunction matchCapCodecs(aCodec, bCodec) {\n\tvar aMimeType = aCodec.mimeType.toLowerCase();\n\tvar bMimeType = bCodec.mimeType.toLowerCase();\n\n\tif (aMimeType !== bMimeType) return false;\n\n\tif (aCodec.clockRate !== bCodec.clockRate) return false;\n\n\tif (aCodec.channels !== bCodec.channels) return false;\n\n\t// Match H264 parameters.\n\tif (aMimeType === 'video/h264') {\n\t\tvar aPacketizationMode = (aCodec.parameters || {})['packetization-mode'] || 0;\n\t\tvar bPacketizationMode = (bCodec.parameters || {})['packetization-mode'] || 0;\n\n\t\tif (aPacketizationMode !== bPacketizationMode) return false;\n\t}\n\n\treturn true;\n}\n\nfunction matchCapHeaderExtensions(aExt, bExt) {\n\tif (aExt.kind && bExt.kind && aExt.kind !== bExt.kind) return false;\n\n\tif (aExt.uri !== bExt.uri) return false;\n\n\treturn true;\n}\n\nfunction reduceRtcpFeedback(codecA, codecB) {\n\tvar reducedRtcpFeedback = [];\n\n\tvar _iteratorNormalCompletion11 = true;\n\tvar _didIteratorError11 = false;\n\tvar _iteratorError11 = undefined;\n\n\ttry {\n\t\tvar _loop5 = function _loop5() {\n\t\t\tvar aFb = _step11.value;\n\n\t\t\tvar matchingBFb = (codecB.rtcpFeedback || []).find(function (bFb) {\n\t\t\t\treturn bFb.type === aFb.type && bFb.parameter === aFb.parameter;\n\t\t\t});\n\n\t\t\tif (matchingBFb) reducedRtcpFeedback.push(matchingBFb);\n\t\t};\n\n\t\tfor (var _iterator11 = (0, _getIterator3.default)(codecA.rtcpFeedback || []), _step11; !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n\t\t\t_loop5();\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError11 = true;\n\t\t_iteratorError11 = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion11 && _iterator11.return) {\n\t\t\t\t_iterator11.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError11) {\n\t\t\t\tthrow _iteratorError11;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn reducedRtcpFeedback;\n}\n\n/***/ }),\n\n/***/ \"./lib/mslib/utils.js\":\n/*!****************************!*\\\n  !*** ./lib/mslib/utils.js ***!\n  \\****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nexports.randomNumber = randomNumber;\nexports.clone = clone;\n\nvar _randomNumber = __webpack_require__(/*! random-number */ \"./node_modules/_random-number@0.0.9@random-number/index.js\");\n\nvar _randomNumber2 = _interopRequireDefault(_randomNumber);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar randomNumberGenerator = _randomNumber2.default.generator({\n  min: 10000000,\n  max: 99999999,\n  integer: true\n});\n\n/**\n * Generates a random positive number between 10000000 and 99999999.\n *\n * @return {Number}\n */\nfunction randomNumber() {\n  return randomNumberGenerator();\n}\n\n/**\n * Clones the given Object/Array.\n *\n * @param {Object|Array} obj\n *\n * @return {Object|Array}\n */\nfunction clone(obj) {\n  return JSON.parse((0, _stringify2.default)(obj));\n}\n\n/***/ }),\n\n/***/ \"./lib/protoo/Message.js\":\n/*!*******************************!*\\\n  !*** ./lib/protoo/Message.js ***!\n  \\*******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _typeof2 = __webpack_require__(/*! babel-runtime/helpers/typeof */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _logger = __webpack_require__(/*! ../logger */ \"./lib/logger.js\");\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nvar _utils = __webpack_require__(/*! ./utils */ \"./lib/protoo/utils.js\");\n\nvar protooUtils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _logger2.default('<protooMessage>');\n\nvar Message = function () {\n\tfunction Message() {\n\t\t(0, _classCallCheck3.default)(this, Message);\n\t}\n\n\t(0, _createClass3.default)(Message, null, [{\n\t\tkey: 'parse',\n\t\tvalue: function parse(raw) {\n\t\t\tvar object = void 0;\n\t\t\tvar message = {};\n\n\t\t\ttry {\n\t\t\t\tobject = JSON.parse(raw);\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('parse() | invalid JSON: %s', error);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ((typeof object === 'undefined' ? 'undefined' : (0, _typeof3.default)(object)) !== 'object' || Array.isArray(object)) {\n\t\t\t\tlogger.error('parse() | not an object');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Request.\n\t\t\tif (object.request) {\n\t\t\t\tmessage.request = true;\n\n\t\t\t\tif (typeof object.method !== 'string') {\n\t\t\t\t\tlogger.error('parse() | missing/invalid method field');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (typeof object.id !== 'number') {\n\t\t\t\t\tlogger.error('parse() | missing/invalid id field');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tmessage.id = object.id;\n\n\t\t\t\tmessage.method = object.method;\n\t\t\t\tmessage.data = object.data || {};\n\t\t\t}\n\t\t\t// Response.\n\t\t\telse if (object.response) {\n\t\t\t\t\tmessage.response = true;\n\n\t\t\t\t\tif (typeof object.id !== 'number') {\n\t\t\t\t\t\tlogger.error('parse() | missing/invalid id field');\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tmessage.id = object.id;\n\n\t\t\t\t\t// Success.\n\t\t\t\t\tif (object.ok) {\n\t\t\t\t\t\tmessage.ok = true;\n\t\t\t\t\t\tmessage.data = object.data || {};\n\t\t\t\t\t}\n\t\t\t\t\t// Error.\n\t\t\t\t\telse {\n\t\t\t\t\t\t\tmessage.errorCode = object.errorCode;\n\t\t\t\t\t\t\tmessage.errorReason = object.errorReason;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Notification.\n\t\t\t\telse if (object.notification) {\n\t\t\t\t\t\tmessage.notification = true;\n\n\t\t\t\t\t\tif (typeof object.method !== 'string') {\n\t\t\t\t\t\t\tlogger.error('parse() | missing/invalid method field');\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessage.method = object.method;\n\t\t\t\t\t\tmessage.data = object.data || {};\n\t\t\t\t\t}\n\t\t\t\t\t// Invalid.\n\t\t\t\t\telse {\n\t\t\t\t\t\t\tlogger.error('parse() | missing request/response field');\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\treturn message;\n\t\t}\n\t}, {\n\t\tkey: 'requestFactory',\n\t\tvalue: function requestFactory(method, data) {\n\t\t\tvar request = {\n\t\t\t\trequest: true,\n\t\t\t\tid: protooUtils.randomNumberGenerator(),\n\t\t\t\tmethod: method,\n\t\t\t\tdata: data || {}\n\t\t\t};\n\n\t\t\treturn request;\n\t\t}\n\t}, {\n\t\tkey: 'successResponseFactory',\n\t\tvalue: function successResponseFactory(request, data) {\n\t\t\tvar response = {\n\t\t\t\tresponse: true,\n\t\t\t\tid: request.id,\n\t\t\t\tok: true,\n\t\t\t\tdata: data || {}\n\t\t\t};\n\n\t\t\treturn response;\n\t\t}\n\t}, {\n\t\tkey: 'errorResponseFactory',\n\t\tvalue: function errorResponseFactory(request, errorCode, errorReason) {\n\t\t\tvar response = {\n\t\t\t\tresponse: true,\n\t\t\t\tid: request.id,\n\t\t\t\terrorCode: errorCode,\n\t\t\t\terrorReason: errorReason\n\t\t\t};\n\n\t\t\treturn response;\n\t\t}\n\t}, {\n\t\tkey: 'notificationFactory',\n\t\tvalue: function notificationFactory(method, data) {\n\t\t\tvar notification = {\n\t\t\t\tnotification: true,\n\t\t\t\tmethod: method,\n\t\t\t\tdata: data || {}\n\t\t\t};\n\n\t\t\treturn notification;\n\t\t}\n\t}]);\n\treturn Message;\n}();\n\nexports.default = Message;\n\n/***/ }),\n\n/***/ \"./lib/protoo/Peer.js\":\n/*!****************************!*\\\n  !*** ./lib/protoo/Peer.js ***!\n  \\****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _events = __webpack_require__(/*! events */ \"./node_modules/_events@3.1.0@events/events.js\");\n\nvar _logger = __webpack_require__(/*! ../logger */ \"./lib/logger.js\");\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nvar _Message = __webpack_require__(/*! ./Message */ \"./lib/protoo/Message.js\");\n\nvar _Message2 = _interopRequireDefault(_Message);\n\nvar _WebSocketTransport = __webpack_require__(/*! ./transports/WebSocketTransport */ \"./lib/protoo/transports/WebSocketTransport.js\");\n\nvar _WebSocketTransport2 = _interopRequireDefault(_WebSocketTransport);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _logger2.default('<protooPeer>');\n\n// Max time waiting for a response.\nvar REQUEST_TIMEOUT = 20000;\n\nvar Peer = function (_EventEmitter) {\n\t(0, _inherits3.default)(Peer, _EventEmitter);\n\n\tfunction Peer(protooUrl, sessionId) {\n\t\t(0, _classCallCheck3.default)(this, Peer);\n\n\t\tlogger.debug('constructor() protooUrl: ' + protooUrl);\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Peer.__proto__ || (0, _getPrototypeOf2.default)(Peer)).call(this));\n\n\t\t_this.setMaxListeners(Infinity);\n\n\t\t_this._sessionId = sessionId;\n\n\t\t_this._protooUrl = protooUrl;\n\n\t\t// Transport.\n\t\t_this._transport = new _WebSocketTransport2.default(protooUrl);\n\n\t\t// Closed flag.\n\t\t_this._closed = false;\n\n\t\t// Connected flag.\n\t\t// @type {Boolean}\n\t\t_this._connected = false;\n\n\t\t// Custom data object.\n\t\t_this._data = {};\n\n\t\t// Map of sent requests' handlers indexed by request.id.\n\t\t_this._requestHandlers = new _map2.default();\n\n\t\t// Handle transport.\n\t\t_this._handleTransport();\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(Peer, [{\n\t\tkey: 'send',\n\t\tvalue: function send(method, data) {\n\t\t\tvar _this2 = this;\n\n\t\t\tif (!this.connected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// \n\t\t\tvar request = _Message2.default.requestFactory(method, data);\n\n\t\t\treturn this._transport.send(request).then(function () {\n\t\t\t\treturn new _promise2.default(function (pResolve, pReject) {\n\t\t\t\t\tvar handler = {\n\t\t\t\t\t\tresolve: function resolve(data2) {\n\t\t\t\t\t\t\tif (!_this2._requestHandlers.delete(request.id)) return;\n\n\t\t\t\t\t\t\tclearTimeout(handler.timer);\n\t\t\t\t\t\t\tpResolve(data2);\n\t\t\t\t\t\t},\n\t\t\t\t\t\treject: function reject(error) {\n\t\t\t\t\t\t\tif (!_this2._requestHandlers.delete(request.id)) return;\n\n\t\t\t\t\t\t\tclearTimeout(handler.timer);\n\t\t\t\t\t\t\tpReject(error);\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttimer: setTimeout(function () {\n\t\t\t\t\t\t\tif (!_this2._requestHandlers.delete(request.id)) return;\n\n\t\t\t\t\t\t\t// 如果已经 close ，则无需再处理\n\t\t\t\t\t\t\tif (_this2.closed) return;\n\n\t\t\t\t\t\t\tpReject(new Error('request timeout'));\n\t\t\t\t\t\t}, REQUEST_TIMEOUT),\n\t\t\t\t\t\tclose: function close() {\n\t\t\t\t\t\t\tclearTimeout(handler.timer);\n\t\t\t\t\t\t\tpReject(new Error('peer closed'));\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\t// Add handler stuff to the Map.\n\t\t\t\t\t_this2._requestHandlers.set(request.id, handler);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'notify',\n\t\tvalue: function notify(method, data) {\n\t\t\tif (!this.connected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar notification = _Message2.default.notificationFactory(method, data);\n\n\t\t\treturn this._transport.send(notification);\n\t\t}\n\t}, {\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._closed = true;\n\n\t\t\t// Close transport.\n\t\t\tthis._transport.close();\n\n\t\t\t// Close every pending request handler.\n\t\t\tthis._requestHandlers.forEach(function (handler) {\n\t\t\t\treturn handler.close();\n\t\t\t});\n\n\t\t\t// Emit 'close' event.\n\t\t\tthis.emit('close', { sid: this._sessionId });\n\t\t}\n\t}, {\n\t\tkey: '_handleTransport',\n\t\tvalue: function _handleTransport() {\n\t\t\tvar _this3 = this;\n\n\t\t\tif (this._transport.closed) {\n\t\t\t\tthis._closed = true;\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\treturn _this3.emit('close', { sid: _this3._sessionId });\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._transport.on('connecting', function (currentAttempt) {\n\t\t\t\tlogger.debug('_handleTransport() _transport event [connecting] - [currentAttempt: ' + currentAttempt + ']');\n\n\t\t\t\t_this3.emit('connecting', { sid: _this3._sessionId, currentAttempt: currentAttempt });\n\t\t\t});\n\n\t\t\tthis._transport.on('open', function () {\n\t\t\t\tif (_this3._closed) return;\n\n\t\t\t\tlogger.debug('_handleTransport() _transport event [open]');\n\n\t\t\t\t_this3._connected = true;\n\n\t\t\t\t// Emit 'open' event.\n\t\t\t\t_this3.emit('open', { sid: _this3._sessionId });\n\t\t\t});\n\n\t\t\tthis._transport.on('conn-interrupt', function () {\n\t\t\t\tif (_this3._closed) return;\n\n\t\t\t\tlogger.debug('_handleTransport() _transport event [conn-interrupt]');\n\n\t\t\t\t_this3._connected = false;\n\n\t\t\t\t// Emit 'conn-interrupt' event.\n\t\t\t\t_this3.emit('conn-interrupt', { sid: _this3._sessionId });\n\t\t\t});\n\n\t\t\tthis._transport.on('reinit', function () {\n\t\t\t\tif (_this3._closed) return;\n\n\t\t\t\tlogger.debug('_handleTransport(0 _transport event [reinit]');\n\n\t\t\t\t_this3._connected = true;\n\n\t\t\t\t// Emit 'reinit' event.\n\t\t\t\t_this3.emit('reinit', { sid: _this3._sessionId });\n\t\t\t});\n\n\t\t\tthis._transport.on('conn-reconn', function () {\n\t\t\t\tif (_this3._closed) return;\n\n\t\t\t\tlogger.debug('_handleTransport() _transport event [conn-reconn]');\n\n\t\t\t\t_this3._connected = true;\n\n\t\t\t\t// Emit 'conn-reconn' event.\n\t\t\t\t_this3.emit('conn-reconn', { sid: _this3._sessionId });\n\t\t\t});\n\n\t\t\t// 从 WebSocketTransport 层上报的 disconnected 事件，表示当前已彻底断链（已经过多次重试，最终失败）\n\t\t\tthis._transport.on('disconnected', function () {\n\t\t\t\tlogger.debug('_handleTransport() _transport [disconnected]');\n\n\t\t\t\t_this3._connected = false;\n\n\t\t\t\t_this3.emit('disconnected', { sid: _this3._sessionId });\n\t\t\t});\n\n\t\t\tthis._transport.on('failed', function (currentAttempt) {\n\t\t\t\tlogger.debug('_handleTransport() _transport event [failed] - [currentAttempt: ' + currentAttempt + ']');\n\n\t\t\t\t_this3._connected = false;\n\n\t\t\t\t_this3.emit('failed', { sid: _this3._sessionId, currentAttempt: currentAttempt });\n\t\t\t});\n\n\t\t\tthis._transport.on('close', function () {\n\t\t\t\tif (_this3._closed) return;\n\n\t\t\t\t_this3._closed = true;\n\n\t\t\t\t_this3._connected = false;\n\n\t\t\t\tlogger.debug('_handleTransport() _transport event [close]');\n\n\t\t\t\t// Emit 'close' event.\n\t\t\t\t_this3.emit('close', { sid: _this3._sessionId });\n\t\t\t});\n\n\t\t\tthis._transport.on('message', function (message) {\n\t\t\t\t// 如果已经 close ，则无需再处理\n\t\t\t\tif (_this3.closed) return;\n\n\t\t\t\tif (message.request) {\n\t\t\t\t\t_this3._handleRequest(message);\n\t\t\t\t} else if (message.response) {\n\t\t\t\t\t_this3._handleResponse(message);\n\t\t\t\t} else if (message.notification) {\n\t\t\t\t\t_this3._handleNotification(message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_handleRequest',\n\t\tvalue: function _handleRequest(request) {\n\t\t\tvar _this4 = this;\n\n\t\t\tthis.emit('request', { sid: this._sessionId },\n\t\t\t// Request.\n\t\t\trequest,\n\t\t\t// accept() function.\n\t\t\tfunction (data) {\n\t\t\t\tvar response = _Message2.default.successResponseFactory(request, data);\n\n\t\t\t\t_this4._transport.send(response).catch(function (error) {\n\t\t\t\t\tlogger.warn('_handleRequest() accept() _transport.send error - ' + (0, _stringify2.default)(error));\n\t\t\t\t});\n\t\t\t},\n\t\t\t// reject() function.\n\t\t\tfunction (errorCode, errorReason) {\n\t\t\t\tif (errorCode instanceof Error) {\n\t\t\t\t\terrorReason = errorCode.toString();\n\t\t\t\t\terrorCode = 500;\n\t\t\t\t} else if (typeof errorCode === 'number' && errorReason instanceof Error) {\n\t\t\t\t\terrorReason = errorReason.toString();\n\t\t\t\t}\n\n\t\t\t\tvar response = _Message2.default.errorResponseFactory(request, errorCode, errorReason);\n\n\t\t\t\t_this4._transport.send(response).catch(function (error) {\n\t\t\t\t\tlogger.warn('_handleRequest() reject() error - ' + (0, _stringify2.default)(error));\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_handleResponse',\n\t\tvalue: function _handleResponse(response) {\n\t\t\tvar handler = this._requestHandlers.get(response.id);\n\n\t\t\tif (!handler) {\n\t\t\t\tlogger.error('_handleResponse() received response does not match any sent request');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (response.ok) {\n\t\t\t\thandler.resolve(response.data);\n\t\t\t} else {\n\t\t\t\tvar error = new Error(response.errorReason);\n\n\t\t\t\terror.code = response.errorCode;\n\t\t\t\thandler.reject(error);\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: '_handleNotification',\n\t\tvalue: function _handleNotification(notification) {\n\t\t\tthis.emit('notification', { sid: this._sessionId }, notification);\n\t\t}\n\t}, {\n\t\tkey: 'data',\n\t\tget: function get() {\n\t\t\treturn this._data;\n\t\t},\n\t\tset: function set(obj) {\n\t\t\tthis._data = obj || {};\n\t\t}\n\t}, {\n\t\tkey: 'closed',\n\t\tget: function get() {\n\t\t\treturn this._closed;\n\t\t}\n\n\t\t/**\n   * Whether the Peer is connected.\n   *\n   * @returns {Boolean}\n   */\n\n\t}, {\n\t\tkey: 'connected',\n\t\tget: function get() {\n\t\t\treturn this._connected;\n\t\t}\n\t}]);\n\treturn Peer;\n}(_events.EventEmitter);\n\nexports.default = Peer;\n\n/***/ }),\n\n/***/ \"./lib/protoo/index.js\":\n/*!*****************************!*\\\n  !*** ./lib/protoo/index.js ***!\n  \\*****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WebSocketTransport = exports.Peer = undefined;\n\nvar _Peer = __webpack_require__(/*! ./Peer */ \"./lib/protoo/Peer.js\");\n\nvar _Peer2 = _interopRequireDefault(_Peer);\n\nvar _WebSocketTransport = __webpack_require__(/*! ./transports/WebSocketTransport */ \"./lib/protoo/transports/WebSocketTransport.js\");\n\nvar _WebSocketTransport2 = _interopRequireDefault(_WebSocketTransport);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.Peer = _Peer2.default;\nexports.WebSocketTransport = _WebSocketTransport2.default;\n\n/***/ }),\n\n/***/ \"./lib/protoo/transports/WebSocketTransport.js\":\n/*!*****************************************************!*\\\n  !*** ./lib/protoo/transports/WebSocketTransport.js ***!\n  \\*****************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _events = __webpack_require__(/*! events */ \"./node_modules/_events@3.1.0@events/events.js\");\n\nvar _logger = __webpack_require__(/*! ../../logger */ \"./lib/logger.js\");\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nvar _Message = __webpack_require__(/*! ../Message */ \"./lib/protoo/Message.js\");\n\nvar _Message2 = _interopRequireDefault(_Message);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar W3CWebSocket = __webpack_require__(/*! websocket */ \"./node_modules/_websocket@1.0.31@websocket/lib/browser.js\").w3cwebsocket;\nvar retry = __webpack_require__(/*! retry */ \"./node_modules/_retry@0.12.0@retry/index.js\");\n\nvar logger = new _logger2.default('<protooWebSocketTransport>');\n\nvar WS_SUBPROTOCOL = 'protoo';\nvar DEFAULT_RETRY_OPTIONS = {\n\tretries: 10,\n\tfactor: 2,\n\tminTimeout: 1 * 1000,\n\tmaxTimeout: 4 * 1000\n};\n\nvar WebSocketTransport = function (_EventEmitter) {\n\t(0, _inherits3.default)(WebSocketTransport, _EventEmitter);\n\n\tfunction WebSocketTransport(url, options) {\n\t\t(0, _classCallCheck3.default)(this, WebSocketTransport);\n\n\t\tlogger.debug('constructor() - url: ' + url + ' options: ' + (0, _stringify2.default)(options));\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (WebSocketTransport.__proto__ || (0, _getPrototypeOf2.default)(WebSocketTransport)).call(this));\n\n\t\t_this.setMaxListeners(Infinity);\n\n\t\t// Save URL and options.\n\t\t// 在 url 后追加 sid，用于 服务器端标识本客户端的该会话 （主要用于本客户端断网重连时标识用）\n\t\tvar timestamp = Date.parse(new Date());\n\t\tvar randNum = Math.round(Math.random() * 1000000000);\n\n\t\t_this._origUrl = url + '&sid=' + timestamp + '-' + randNum;\n\t\t_this._url = _this._origUrl;\n\t\t// \n\t\t_this._options = options || {};\n\n\t\t// WebSocket instance.\n\t\t_this._ws = null;\n\n\t\t// \n\t\t_this._xNeedReInit = false;\n\n\t\t// Closed flag.\n\t\t_this._closed = false;\n\n\t\t// 当前的连接状态\n\t\t_this._connected = false;\n\n\t\t// Set WebSocket\n\t\t_this._setWebSocket();\n\t\treturn _this;\n\t}\n\n\t(0, _createClass3.default)(WebSocketTransport, [{\n\t\tkey: 'send',\n\t\tvalue: function send(message) {\n\t\t\tif (this._closed) return _promise2.default.reject(new Error('transport closed'));\n\n\t\t\ttry {\n\t\t\t\tthis._ws.send((0, _stringify2.default)(message));\n\n\t\t\t\treturn _promise2.default.resolve();\n\t\t\t} catch (error) {\n\t\t\t\tlogger.warn('send() messge: ' + (0, _stringify2.default)(message) + ' error - ' + error.toString());\n\n\t\t\t\treturn _promise2.default.reject(error);\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('close()');\n\n\t\t\tif (this._closed) return;\n\n\t\t\tthis._xNeedReInit = false;\n\n\t\t\t// Don't wait for the WebSocket 'close' event, do it now.\n\t\t\tthis._closed = true;\n\t\t\tthis.emit('close', { code: 3000, reason: 'active close' });\n\n\t\t\ttry {\n\t\t\t\tthis._ws.onopen = null;\n\t\t\t\tthis._ws.onclose = null;\n\t\t\t\tthis._ws.onerror = null;\n\t\t\t\tthis._ws.onmessage = null;\n\t\t\t\tthis._ws.close();\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('close() error - closing the WebSocket: ' + error.toString());\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: '_setWebSocket',\n\t\tvalue: function _setWebSocket() {\n\t\t\tvar _this2 = this;\n\n\t\t\tvar options = this._options;\n\t\t\tvar operation = retry.operation(this._options.retry || DEFAULT_RETRY_OPTIONS);\n\t\t\tthis._connected = false;\n\n\t\t\toperation.attempt(function (currentAttempt) {\n\t\t\t\tif (_this2._closed) {\n\t\t\t\t\toperation.stop();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\tif (_this2._ws != null) {\n\t\t\t\t\t_this2._ws.close();\n\t\t\t\t\t_this2._ws = null;\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('_setWebSocket() - currentAttempt: ' + currentAttempt);\n\n\t\t\t\t_this2._ws = new W3CWebSocket(_this2._url, WS_SUBPROTOCOL, options.origin, options.headers, options.requestOptions, options.clientConfig);\n\n\t\t\t\t_this2.emit('connecting', currentAttempt);\n\n\t\t\t\t_this2._ws.onopen = function (e) {\n\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\t_this2._connected = true;\n\n\t\t\t\t\t// Emit 'open' event.\n\t\t\t\t\tvar suffix = 'retry=true';\n\t\t\t\t\tif (_this2._url.indexOf(suffix, _this2._url.length - suffix.length) !== -1) {\n\t\t\t\t\t\tlogger.debug('WebSocket event - [conn-reconn] - this._url: ' + _this2._url);\n\n\t\t\t\t\t\t_this2.emit('conn-reconn');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar evt = _this2._xNeedReInit ? 'reinit' : 'open';\n\n\t\t\t\t\t\tlogger.debug('WebSocket event - [' + evt + '] - this._url: ' + _this2._url);\n\n\t\t\t\t\t\t// 将 _xNeedReInit 复位\n\t\t\t\t\t\t_this2._xNeedReInit = false;\n\n\t\t\t\t\t\t_this2.emit(evt);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t_this2._ws.onclose = function (event) {\n\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\t// Emit 'conn-interrupt' event.\n\t\t\t\t\t_this2.emit('conn-interrupt', event);\n\n\t\t\t\t\tlogger.warn('WebSocket event - [close] wasClean: ' + event.wasClean + ' code: ' + event.code + ' reason: ' + event.reason);\n\n\t\t\t\t\t// Don't retry if code is 4000 (closed by the server).\n\t\t\t\t\tif (event.code !== 4000) {\n\t\t\t\t\t\t// TODO : 未来再考虑对 3003 这种情况的重连恢复 -- 目前仅仅是彻底close\n\t\t\t\t\t\t_this2._xNeedReInit = event.code === 3003; // 如果关闭码为 3003 ，则要求客户端完全重新开始（设置retry）\n\n\t\t\t\t\t\t// If it was not connected, try again.\n\t\t\t\t\t\tif (!_this2._connected && !_this2._xNeedReInit) {\n\t\t\t\t\t\t\t// this.emit('failed', currentAttempt);\n\n\t\t\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\t\t\tif (operation.retry(true)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlogger.debug('WebSocket event - [close] event.code === 4000 - Emit [close]');\n\t\t\t\t\t\t\t\t// Emit 'close' event.\n\t\t\t\t\t\t\t\t_this2.emit('close', event);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// If it was connected, start from scratch.\n\t\t\t\t\t\t\toperation.stop();\n\n\t\t\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\t\t\t// 由于本次是 retry ，则在 url 后追加 retry=true\n\t\t\t\t\t\t\t// There have some issues on server then comments it now.\n\t\t\t\t\t\t\t_this2._url = _this2._xNeedReInit ? _this2._origUrl + '&timestamp=' + +new Date() : _this2._origUrl + '&timestamp=' + +new Date() + '&retry=true';\n\n\t\t\t\t\t\t\tlogger.debug('WebSocket event - [close] event.code !== 4000 - retry websocket transport: ' + _this2._url);\n\n\t\t\t\t\t\t\t_this2._setWebSocket();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_this2._xNeedReInit = false;\n\n\t\t\t\t\t\t// 消除 url 中的 retry=true\n\t\t\t\t\t\t_this2._url = _this2._origUrl + '&timestamp=' + +new Date();\n\n\t\t\t\t\t\t// 不再尝试重试，当前已进入最终断开状态，向上层抛出 [close] 事件\n\t\t\t\t\t\t_this2._closed = true;\n\n\t\t\t\t\t\tlogger.debug('WebSocket event - [close] event.code === 4000 - Emit [close]');\n\t\t\t\t\t\t// Emit 'close' event.\n\t\t\t\t\t\t_this2.emit('close', event);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t_this2._ws.onerror = function (e) {\n\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\tlogger.error('WebSocket event [error] - ' + e.toString() + ' - nothing todo.');\n\t\t\t\t};\n\n\t\t\t\t_this2._ws.onmessage = function (event) {\n\t\t\t\t\tif (_this2._closed) return;\n\n\t\t\t\t\tvar message = _Message2.default.parse(event.data);\n\n\t\t\t\t\tif (!message) return;\n\n\t\t\t\t\tif (_this2.listenerCount('message') === 0) {\n\t\t\t\t\t\tlogger.warn('no listeners for WebSocket event [message] - ignoring received message');\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Emit 'message' event.\n\t\t\t\t\t_this2.emit('message', message);\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'connected',\n\t\tget: function get() {\n\t\t\treturn this._connected;\n\t\t}\n\t}, {\n\t\tkey: 'closed',\n\t\tget: function get() {\n\t\t\treturn this._closed;\n\t\t}\n\t}]);\n\treturn WebSocketTransport;\n}(_events.EventEmitter);\n\nexports.default = WebSocketTransport;\n\n/***/ }),\n\n/***/ \"./lib/protoo/utils.js\":\n/*!*****************************!*\\\n  !*** ./lib/protoo/utils.js ***!\n  \\*****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nvar randomNumber = __webpack_require__(/*! random-number */ \"./node_modules/_random-number@0.0.9@random-number/index.js\");\n\nvar randomNumberGenerator = exports.randomNumberGenerator = randomNumber.generator({\n\tmin: 1000000,\n\tmax: 9999999,\n\tinteger: true\n});\n\n/***/ }),\n\n/***/ \"./lib/sdpform/grammar.js\":\n/*!********************************!*\\\n  !*** ./lib/sdpform/grammar.js ***!\n  \\********************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _keys = __webpack_require__(/*! babel-runtime/core-js/object/keys */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/keys.js\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar grammar = module.exports = {\n  v: [{\n    name: 'version',\n    reg: /^(\\d*)$/\n  }],\n  o: [{ //o=- 20518 0 IN IP4 203.0.113.1\n    // NB: sessionId will be a String in most cases because it is huge\n    name: 'origin',\n    reg: /^(\\S*) (\\d*) (\\d*) (\\S*) IP(\\d) (\\S*)/,\n    names: ['username', 'sessionId', 'sessionVersion', 'netType', 'ipVer', 'address'],\n    format: '%s %s %d %s IP%d %s'\n  }],\n  // default parsing of these only (though some of these feel outdated)\n  s: [{ name: 'name' }],\n  i: [{ name: 'description' }],\n  u: [{ name: 'uri' }],\n  e: [{ name: 'email' }],\n  p: [{ name: 'phone' }],\n  z: [{ name: 'timezones' }], // TODO: this one can actually be parsed properly..\n  r: [{ name: 'repeats' }], // TODO: this one can also be parsed properly\n  //k: [{}], // outdated thing ignored\n  t: [{ //t=0 0\n    name: 'timing',\n    reg: /^(\\d*) (\\d*)/,\n    names: ['start', 'stop'],\n    format: '%d %d'\n  }],\n  c: [{ //c=IN IP4 10.47.197.26\n    name: 'connection',\n    reg: /^IN IP(\\d) (\\S*)/,\n    names: ['version', 'ip'],\n    format: 'IN IP%d %s'\n  }],\n  b: [{ //b=AS:4000\n    push: 'bandwidth',\n    reg: /^(TIAS|AS|CT|RR|RS):(\\d*)/,\n    names: ['type', 'limit'],\n    format: '%s:%s'\n  }],\n  m: [{ //m=video 51744 RTP/AVP 126 97 98 34 31\n    // NB: special - pushes to session\n    // TODO: rtp/fmtp should be filtered by the payloads found here?\n    reg: /^(\\w*) (\\d*) ([\\w\\/]*)(?: (.*))?/,\n    names: ['type', 'port', 'protocol', 'payloads'],\n    format: '%s %d %s %s'\n  }],\n  a: [{ //a=rtpmap:110 opus/48000/2\n    push: 'rtp',\n    reg: /^rtpmap:(\\d*) ([\\w\\-\\.]*)(?:\\s*\\/(\\d*)(?:\\s*\\/(\\S*))?)?/,\n    names: ['payload', 'codec', 'rate', 'encoding'],\n    format: function format(o) {\n      return o.encoding ? 'rtpmap:%d %s/%s/%s' : o.rate ? 'rtpmap:%d %s/%s' : 'rtpmap:%d %s';\n    }\n  }, { //a=fmtp:108 profile-level-id=24;object=23;bitrate=64000\n    //a=fmtp:111 minptime=10; useinbandfec=1\n    push: 'fmtp',\n    reg: /^fmtp:(\\d*) ([\\S| ]*)/,\n    names: ['payload', 'config'],\n    format: 'fmtp:%d %s'\n  }, { //a=control:streamid=0\n    name: 'control',\n    reg: /^control:(.*)/,\n    format: 'control:%s'\n  }, { //a=rtcp:65179 IN IP4 193.84.77.194\n    name: 'rtcp',\n    reg: /^rtcp:(\\d*)(?: (\\S*) IP(\\d) (\\S*))?/,\n    names: ['port', 'netType', 'ipVer', 'address'],\n    format: function format(o) {\n      return o.address != null ? 'rtcp:%d %s IP%d %s' : 'rtcp:%d';\n    }\n  }, { //a=rtcp-fb:98 trr-int 100\n    push: 'rtcpFbTrrInt',\n    reg: /^rtcp-fb:(\\*|\\d*) trr-int (\\d*)/,\n    names: ['payload', 'value'],\n    format: 'rtcp-fb:%d trr-int %d'\n  }, { //a=rtcp-fb:98 nack rpsi\n    push: 'rtcpFb',\n    reg: /^rtcp-fb:(\\*|\\d*) ([\\w-_]*)(?: ([\\w-_]*))?/,\n    names: ['payload', 'type', 'subtype'],\n    format: function format(o) {\n      return o.subtype != null ? 'rtcp-fb:%s %s %s' : 'rtcp-fb:%s %s';\n    }\n  }, { //a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n    //a=extmap:1/recvonly URI-gps-string\n    push: 'ext',\n    reg: /^extmap:(\\d+)(?:\\/(\\w+))? (\\S*)(?: (\\S*))?/,\n    names: ['value', 'direction', 'uri', 'config'],\n    format: function format(o) {\n      return 'extmap:%d' + (o.direction ? '/%s' : '%v') + ' %s' + (o.config ? ' %s' : '');\n    }\n  }, { //a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:PS1uQCVeeCFCanVmcjkpPywjNWhcYD0mXXtxaVBR|2^20|1:32\n    push: 'crypto',\n    reg: /^crypto:(\\d*) ([\\w_]*) (\\S*)(?: (\\S*))?/,\n    names: ['id', 'suite', 'config', 'sessionConfig'],\n    format: function format(o) {\n      return o.sessionConfig != null ? 'crypto:%d %s %s %s' : 'crypto:%d %s %s';\n    }\n  }, { //a=setup:actpass\n    name: 'setup',\n    reg: /^setup:(\\w*)/,\n    format: 'setup:%s'\n  }, { //a=mid:1\n    name: 'mid',\n    reg: /^mid:([^\\s]*)/,\n    format: 'mid:%s'\n  }, { //a=msid:0c8b064d-d807-43b4-b434-f92a889d8587 98178685-d409-46e0-8e16-7ef0db0db64a\n    name: 'msid',\n    reg: /^msid:(.*)/,\n    format: 'msid:%s'\n  }, { //a=ptime:20\n    name: 'ptime',\n    reg: /^ptime:(\\d*)/,\n    format: 'ptime:%d'\n  }, { //a=maxptime:60\n    name: 'maxptime',\n    reg: /^maxptime:(\\d*)/,\n    format: 'maxptime:%d'\n  }, { //a=sendrecv\n    name: 'direction',\n    reg: /^(sendrecv|recvonly|sendonly|inactive)/\n  }, { //a=ice-lite\n    name: 'icelite',\n    reg: /^(ice-lite)/\n  }, { //a=ice-ufrag:F7gI\n    name: 'iceUfrag',\n    reg: /^ice-ufrag:(\\S*)/,\n    format: 'ice-ufrag:%s'\n  }, { //a=ice-pwd:x9cml/YzichV2+XlhiMu8g\n    name: 'icePwd',\n    reg: /^ice-pwd:(\\S*)/,\n    format: 'ice-pwd:%s'\n  }, { //a=fingerprint:SHA-1 00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:00:11:22:33\n    name: 'fingerprint',\n    reg: /^fingerprint:(\\S*) (\\S*)/,\n    names: ['type', 'hash'],\n    format: 'fingerprint:%s %s'\n  }, { //a=candidate:0 1 UDP 2113667327 203.0.113.1 54400 typ host\n    //a=candidate:1162875081 1 udp 2113937151 192.168.34.75 60017 typ host generation 0 network-id 3 network-cost 10\n    //a=candidate:3289912957 2 udp 1845501695 193.84.77.194 60017 typ srflx raddr 192.168.34.75 rport 60017 generation 0 network-id 3 network-cost 10\n    //a=candidate:229815620 1 tcp 1518280447 192.168.150.19 60017 typ host tcptype active generation 0 network-id 3 network-cost 10\n    //a=candidate:3289912957 2 tcp 1845501695 193.84.77.194 60017 typ srflx raddr 192.168.34.75 rport 60017 tcptype passive generation 0 network-id 3 network-cost 10\n    push: 'candidates',\n    reg: /^candidate:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?(?: network-id (\\d*))?(?: network-cost (\\d*))?/,\n    names: ['foundation', 'component', 'transport', 'priority', 'ip', 'port', 'type', 'raddr', 'rport', 'tcptype', 'generation', 'network-id', 'network-cost'],\n    format: function format(o) {\n      var str = 'candidate:%s %d %s %d %s %d typ %s';\n\n      str += o.raddr != null ? ' raddr %s rport %d' : '%v%v';\n\n      // NB: candidate has three optional chunks, so %void middles one if it's missing\n      str += o.tcptype != null ? ' tcptype %s' : '%v';\n\n      if (o.generation != null) {\n        str += ' generation %d';\n      }\n\n      str += o['network-id'] != null ? ' network-id %d' : '%v';\n      str += o['network-cost'] != null ? ' network-cost %d' : '%v';\n      return str;\n    }\n  }, { //a=end-of-candidates (keep after the candidates line for readability)\n    name: 'endOfCandidates',\n    reg: /^(end-of-candidates)/\n  }, { //a=remote-candidates:1 203.0.113.1 54400 2 203.0.113.1 54401 ...\n    name: 'remoteCandidates',\n    reg: /^remote-candidates:(.*)/,\n    format: 'remote-candidates:%s'\n  }, { //a=ice-options:google-ice\n    name: 'iceOptions',\n    reg: /^ice-options:(\\S*)/,\n    format: 'ice-options:%s'\n  }, { //a=ssrc:2566107569 cname:t9YU8M1UxTF8Y1A1\n    push: 'ssrcs',\n    reg: /^ssrc:(\\d*) ([\\w_-]*)(?::(.*))?/,\n    names: ['id', 'attribute', 'value'],\n    format: function format(o) {\n      var str = 'ssrc:%d';\n      if (o.attribute != null) {\n        str += ' %s';\n        if (o.value != null) {\n          str += ':%s';\n        }\n      }\n      return str;\n    }\n  }, { //a=ssrc-group:FEC 1 2\n    //a=ssrc-group:FEC-FR 3004364195 1080772241\n    push: 'ssrcGroups',\n    // token-char = %x21 / %x23-27 / %x2A-2B / %x2D-2E / %x30-39 / %x41-5A / %x5E-7E\n    reg: /^ssrc-group:([\\x21\\x23\\x24\\x25\\x26\\x27\\x2A\\x2B\\x2D\\x2E\\w]*) (.*)/,\n    names: ['semantics', 'ssrcs'],\n    format: 'ssrc-group:%s %s'\n  }, { //a=msid-semantic: WMS Jvlam5X3SX1OP6pn20zWogvaKJz5Hjf9OnlV\n    name: 'msidSemantic',\n    reg: /^msid-semantic:\\s?(\\w*) (\\S*)/,\n    names: ['semantic', 'token'],\n    format: 'msid-semantic: %s %s' // space after ':' is not accidental\n  }, { //a=group:BUNDLE audio video\n    push: 'groups',\n    reg: /^group:(\\w*) (.*)/,\n    names: ['type', 'mids'],\n    format: 'group:%s %s'\n  }, { //a=rtcp-mux\n    name: 'rtcpMux',\n    reg: /^(rtcp-mux)/\n  }, { //a=rtcp-rsize\n    name: 'rtcpRsize',\n    reg: /^(rtcp-rsize)/\n  }, { //a=sctpmap:5000 webrtc-datachannel 1024\n    name: 'sctpmap',\n    reg: /^sctpmap:([\\w_\\/]*) (\\S*)(?: (\\S*))?/,\n    names: ['sctpmapNumber', 'app', 'maxMessageSize'],\n    format: function format(o) {\n      return o.maxMessageSize != null ? 'sctpmap:%s %s %s' : 'sctpmap:%s %s';\n    }\n  }, { //a=x-google-flag:conference\n    name: 'xGoogleFlag',\n    reg: /^x-google-flag:([^\\s]*)/,\n    format: 'x-google-flag:%s'\n  }, { //a=rid:1 send max-width=1280;max-height=720;max-fps=30;depend=0\n    push: 'rids',\n    reg: /^rid:([\\d\\w]+) (\\w+)(?: ([\\S| ]*))?/,\n    names: ['id', 'direction', 'params'],\n    format: function format(o) {\n      return o.params ? 'rid:%s %s %s' : 'rid:%s %s';\n    }\n  }, { //a=imageattr:97 send [x=800,y=640,sar=1.1,q=0.6] [x=480,y=320] recv [x=330,y=250]\n    //a=imageattr:* send [x=800,y=640] recv *\n    //a=imageattr:100 recv [x=320,y=240]\n    push: 'imageattrs',\n    reg: new RegExp(\n    //a=imageattr:97\n    '^imageattr:(\\\\d+|\\\\*)' +\n    //send [x=800,y=640,sar=1.1,q=0.6] [x=480,y=320]\n    '[\\\\s\\\\t]+(send|recv)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*)' +\n    //recv [x=330,y=250]\n    '(?:[\\\\s\\\\t]+(recv|send)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*))?'),\n    names: ['pt', 'dir1', 'attrs1', 'dir2', 'attrs2'],\n    format: function format(o) {\n      return 'imageattr:%s %s %s' + (o.dir2 ? ' %s %s' : '');\n    }\n  }, { //a=simulcast:send 1,2,3;~4,~5 recv 6;~7,~8\n    //a=simulcast:recv 1;4,5 send 6;7\n    name: 'simulcast',\n    reg: new RegExp(\n    //a=simulcast:\n    '^simulcast:' +\n    //send 1,2,3;~4,~5\n    '(send|recv) ([a-zA-Z0-9\\\\-_~;,]+)' +\n    //space + recv 6;~7,~8\n    '(?:\\\\s?(send|recv) ([a-zA-Z0-9\\\\-_~;,]+))?' +\n    //end\n    '$'),\n    names: ['dir1', 'list1', 'dir2', 'list2'],\n    format: function format(o) {\n      return 'simulcast:%s %s' + (o.dir2 ? ' %s %s' : '');\n    }\n  }, { //Old simulcast draft 03 (implemented by Firefox)\n    //  https://tools.ietf.org/html/draft-ietf-mmusic-sdp-simulcast-03\n    //a=simulcast: recv pt=97;98 send pt=97\n    //a=simulcast: send rid=5;6;7 paused=6,7\n    name: 'simulcast_03',\n    reg: /^simulcast:[\\s\\t]+([\\S+\\s\\t]+)$/,\n    names: ['value'],\n    format: 'simulcast: %s'\n  }, {\n    //a=framerate:25\n    //a=framerate:29.97\n    name: 'framerate',\n    reg: /^framerate:(\\d+(?:$|\\.\\d+))/,\n    format: 'framerate:%s'\n  }, { // RFC4570\n    //a=source-filter: incl IN IP4 239.5.2.31 10.1.15.5\n    name: 'sourceFilter',\n    reg: /^source-filter: *(excl|incl) (\\S*) (IP4|IP6|\\*) (\\S*) (.*)/,\n    names: ['filterMode', 'netType', 'addressTypes', 'destAddress', 'srcList'],\n    format: 'source-filter: %s %s %s %s %s'\n  }, { //a=bundle-only\n    name: 'bundleOnly',\n    reg: /^(bundle-only)/\n  }, { //a=label:1\n    name: 'label',\n    reg: /^label:(.+)/,\n    format: 'label:%s'\n  }, {\n    // RFC version 26 for SCTP over DTLS\n    // https://tools.ietf.org/html/draft-ietf-mmusic-sctp-sdp-26#section-5\n    name: 'sctpPort',\n    reg: /^sctp-port:(\\d+)$/,\n    format: 'sctp-port:%s'\n  }, {\n    // RFC version 26 for SCTP over DTLS\n    // https://tools.ietf.org/html/draft-ietf-mmusic-sctp-sdp-26#section-6\n    name: 'maxMessageSize',\n    reg: /^max-message-size:(\\d+)$/,\n    format: 'max-message-size:%s'\n  }, { // any a= that we don't understand is kepts verbatim on media.invalid\n    push: 'invalid',\n    names: ['value']\n  }]\n};\n\n// set sensible defaults to avoid polluting the grammar with boring details\n(0, _keys2.default)(grammar).forEach(function (key) {\n  var objs = grammar[key];\n  objs.forEach(function (obj) {\n    if (!obj.reg) {\n      obj.reg = /(.*)/;\n    }\n    if (!obj.format) {\n      obj.format = '%s';\n    }\n  });\n});\n\n/***/ }),\n\n/***/ \"./lib/sdpform/index.js\":\n/*!******************************!*\\\n  !*** ./lib/sdpform/index.js ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar parser = __webpack_require__(/*! ./parser */ \"./lib/sdpform/parser.js\");\nvar writer = __webpack_require__(/*! ./writer */ \"./lib/sdpform/writer.js\");\n\nexports.write = writer;\nexports.parse = parser.parse;\nexports.parseFmtpConfig = parser.parseFmtpConfig;\nexports.parseParams = parser.parseParams;\nexports.parsePayloads = parser.parsePayloads;\nexports.parseRemoteCandidates = parser.parseRemoteCandidates;\nexports.parseImageAttributes = parser.parseImageAttributes;\nexports.parseSimulcastStreamList = parser.parseSimulcastStreamList;\n/**\n * REF: Base upon sdp-transform 2.7.0\n */\n\n/***/ }),\n\n/***/ \"./lib/sdpform/parser.js\":\n/*!*******************************!*\\\n  !*** ./lib/sdpform/parser.js ***!\n  \\*******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar toIntIfInt = function toIntIfInt(v) {\n  return String(Number(v)) === v ? Number(v) : v;\n};\n\nvar attachProperties = function attachProperties(match, location, names, rawName) {\n  if (rawName && !names) {\n    location[rawName] = toIntIfInt(match[1]);\n  } else {\n    for (var i = 0; i < names.length; i += 1) {\n      if (match[i + 1] != null) {\n        location[names[i]] = toIntIfInt(match[i + 1]);\n      }\n    }\n  }\n};\n\nvar parseReg = function parseReg(obj, location, content) {\n  var needsBlank = obj.name && obj.names;\n  if (obj.push && !location[obj.push]) {\n    location[obj.push] = [];\n  } else if (needsBlank && !location[obj.name]) {\n    location[obj.name] = {};\n  }\n  var keyLocation = obj.push ? {} : // blank object that will be pushed\n  needsBlank ? location[obj.name] : location; // otherwise, named location or root\n\n  attachProperties(content.match(obj.reg), keyLocation, obj.names, obj.name);\n\n  if (obj.push) {\n    location[obj.push].push(keyLocation);\n  }\n};\n\nvar grammar = __webpack_require__(/*! ./grammar */ \"./lib/sdpform/grammar.js\");\nvar validLine = RegExp.prototype.test.bind(/^([a-z])=(.*)/);\n\nexports.parse = function (sdp) {\n  var session = {},\n      media = [],\n      location = session; // points at where properties go under (one of the above)\n\n  // parse lines we understand\n  sdp.split(/(\\r\\n|\\r|\\n)/).filter(validLine).forEach(function (l) {\n    var type = l[0];\n    var content = l.slice(2);\n    if (type === 'm') {\n      media.push({ rtp: [], fmtp: [] });\n      location = media[media.length - 1]; // point at latest media line\n    }\n\n    for (var j = 0; j < (grammar[type] || []).length; j += 1) {\n      var obj = grammar[type][j];\n      if (obj.reg.test(content)) {\n        return parseReg(obj, location, content);\n      }\n    }\n  });\n\n  session.media = media; // link it up\n  return session;\n};\n\nvar paramReducer = function paramReducer(acc, expr) {\n  var s = expr.split(/=(.+)/, 2);\n  if (s.length === 2) {\n    acc[s[0]] = toIntIfInt(s[1]);\n  } else if (s.length === 1 && expr.length > 1) {\n    acc[s[0]] = undefined;\n  }\n  return acc;\n};\n\nexports.parseParams = function (str) {\n  return str.split(/\\;\\s?/).reduce(paramReducer, {});\n};\n\n// For backward compatibility - alias will be removed in 3.0.0\nexports.parseFmtpConfig = exports.parseParams;\n\nexports.parsePayloads = function (str) {\n  return str.split(' ').map(Number);\n};\n\nexports.parseRemoteCandidates = function (str) {\n  var candidates = [];\n  var parts = str.split(' ').map(toIntIfInt);\n  for (var i = 0; i < parts.length; i += 3) {\n    candidates.push({\n      component: parts[i],\n      ip: parts[i + 1],\n      port: parts[i + 2]\n    });\n  }\n  return candidates;\n};\n\nexports.parseImageAttributes = function (str) {\n  return str.split(' ').map(function (item) {\n    return item.substring(1, item.length - 1).split(',').reduce(paramReducer, {});\n  });\n};\n\nexports.parseSimulcastStreamList = function (str) {\n  return str.split(';').map(function (stream) {\n    return stream.split(',').map(function (format) {\n      var scid,\n          paused = false;\n\n      if (format[0] !== '~') {\n        scid = toIntIfInt(format);\n      } else {\n        scid = toIntIfInt(format.substring(1, format.length));\n        paused = true;\n      }\n\n      return {\n        scid: scid,\n        paused: paused\n      };\n    });\n  });\n};\n\n/***/ }),\n\n/***/ \"./lib/sdpform/writer.js\":\n/*!*******************************!*\\\n  !*** ./lib/sdpform/writer.js ***!\n  \\*******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar grammar = __webpack_require__(/*! ./grammar */ \"./lib/sdpform/grammar.js\");\n\n// customized util.format - discards excess arguments and can void middle ones\nvar formatRegExp = /%[sdv%]/g;\nvar format = function format(formatStr) {\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  return formatStr.replace(formatRegExp, function (x) {\n    if (i >= len) {\n      return x; // missing argument\n    }\n    var arg = args[i];\n    i += 1;\n    switch (x) {\n      case '%%':\n        return '%';\n      case '%s':\n        return String(arg);\n      case '%d':\n        return Number(arg);\n      case '%v':\n        return '';\n    }\n  });\n  // NB: we discard excess arguments - they are typically undefined from makeLine\n};\n\nvar makeLine = function makeLine(type, obj, location) {\n  var str = obj.format instanceof Function ? obj.format(obj.push ? location : location[obj.name]) : obj.format;\n\n  var args = [type + '=' + str];\n  if (obj.names) {\n    for (var i = 0; i < obj.names.length; i += 1) {\n      var n = obj.names[i];\n      if (obj.name) {\n        args.push(location[obj.name][n]);\n      } else {\n        // for mLine and push attributes\n        args.push(location[obj.names[i]]);\n      }\n    }\n  } else {\n    args.push(location[obj.name]);\n  }\n  return format.apply(null, args);\n};\n\n// RFC specified order\n// TODO: extend this with all the rest\nvar defaultOuterOrder = ['v', 'o', 's', 'i', 'u', 'e', 'p', 'c', 'b', 't', 'r', 'z', 'a'];\nvar defaultInnerOrder = ['i', 'c', 'b', 'a'];\n\nmodule.exports = function (session, opts) {\n  opts = opts || {};\n  // ensure certain properties exist\n  if (session.version == null) {\n    session.version = 0; // 'v=0' must be there (only defined version atm)\n  }\n  if (session.name == null) {\n    session.name = ' '; // 's= ' must be there if no meaningful name set\n  }\n  session.media.forEach(function (mLine) {\n    if (mLine.payloads == null) {\n      mLine.payloads = '';\n    }\n  });\n\n  var outerOrder = opts.outerOrder || defaultOuterOrder;\n  var innerOrder = opts.innerOrder || defaultInnerOrder;\n  var sdp = [];\n\n  // loop through outerOrder for matching properties on session\n  outerOrder.forEach(function (type) {\n    grammar[type].forEach(function (obj) {\n      if (obj.name in session && session[obj.name] != null) {\n        sdp.push(makeLine(type, obj, session));\n      } else if (obj.push in session && session[obj.push] != null) {\n        session[obj.push].forEach(function (el) {\n          sdp.push(makeLine(type, obj, el));\n        });\n      }\n    });\n  });\n\n  // then for each media line, follow the innerOrder\n  session.media.forEach(function (mLine) {\n    sdp.push(makeLine('m', grammar.m[0], mLine));\n\n    innerOrder.forEach(function (type) {\n      grammar[type].forEach(function (obj) {\n        if (obj.name in mLine && mLine[obj.name] != null) {\n          sdp.push(makeLine(type, obj, mLine));\n        } else if (obj.push in mLine && mLine[obj.push] != null) {\n          mLine[obj.push].forEach(function (el) {\n            sdp.push(makeLine(type, obj, el));\n          });\n        }\n      });\n    });\n  });\n\n  return sdp.join('\\r\\n') + '\\r\\n';\n};\n\n/***/ }),\n\n/***/ \"./lib/stats.js\":\n/*!**********************!*\\\n  !*** ./lib/stats.js ***!\n  \\**********************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _freeze = __webpack_require__(/*! babel-runtime/core-js/object/freeze */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/freeze.js\");\n\nvar _freeze2 = _interopRequireDefault(_freeze);\n\nvar _logger = __webpack_require__(/*! ./logger */ \"./lib/logger.js\");\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nvar _config = __webpack_require__(/*! ./config */ \"./lib/config.js\");\n\nvar config = _interopRequireWildcard(_config);\n\nvar _utils = __webpack_require__(/*! ./utils */ \"./lib/utils.js\");\n\nvar tttUtils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar pkg = __webpack_require__(/*! ../package.json */ \"./package.json\");\n\nvar EventType = (0, _freeze2.default)({\n\tHEART_BEAT: 'event=sdkHeartbeat',\n\tENTER_FAIL: 'event=ENTER_FAIL',\n\tENTER_TIMEOUT: 'event=ENTER_TIMEOUT'\n});\n\nvar logger = new _logger2.default('Stats');\n\nvar STAT_REPORT_INTERVAL = 10 * 1000;\n\nvar Stats = function () {\n\tfunction Stats() {\n\t\t(0, _classCallCheck3.default)(this, Stats);\n\n\t\tthis._appId = '';\n\t\tthis._roomId = '';\n\t\tthis._sessionId = '';\n\t\tthis._userId = '';\n\t\tthis._connectionId = '';\n\t\tthis._roleType = '';\n\t\tthis._domain = '';\n\n\t\tthis._signalReconnectTimes = 0;\n\n\t\tthis._netType = '';\n\n\t\tthis._isMobile = /mobile/i.test(navigator.userAgent);\n\n\t\tthis._outputAdjustVolume = 1;\n\t\tthis._micAdjustVolume = 1;\n\t\tthis._presetAudioBitrate = 0; // kbps\n\n\t\t// \n\t\tthis._isAudioOpen = false;\n\t\tthis._isVideoOpen = false;\n\n\t\t// 保存 webrtc internal stats -- 用于上报时集合\n\t\tthis._webrtcInternalSendStats = new Array();\n\t\tthis._webrtcInternalRecvStats = new Array();\n\n\t\tthis._reportInterval = null;\n\n\t\t// \n\t\tthis._webrtcStats = [];\n\n\t\t/*\n  this.stats = [{\n  \tappId: '',\n  \troomId: '',\n  \tsessionId: '',\n  \tuserId: '',\n  \tlogtype: '1',\n  \tconnectionId: '',\n  \troleType: '',\n  \tlogTime: '',\n  \tequipInfo: {\n  \t\tsdkVersion: 'ver3.7.3_Sep_28_2019',\n  \t\tnetType: '0',\n  \t\tequipModel: 'web',\n  \t\tpublicVersion: pkg.version\n  \t},\n  \tvideoInfo: {\n  \t\tV_SENT: [\n  \t\t\t{\n  \t\t\t\tDEVID: '',\n  \t\t\t\tV_SSRC: 0,\n  \t\t\t\tV_VBR: 0,\n  \t\t\t\tV_RBR: 0,\n  \t\t\t\tV_FPS: 0,\n  \t\t\t\tV_SENDBYTES: 0,\n  \t\t\t\tV_SENDCOUNT: 0,\n  \t\t\t\tV_SENDFRACTIONLOST: 0,\n  \t\t\t\tV_RTT: 0,\n  \t\t\t\tV_BUF: 0,\n  \t\t\t\tV_RECV: 0,\n  \t\t\t\tV_ENCERROR: 0,\n  \t\t\t\tV_ENC: 0,\n  \t\t\t\tV_RECONNECT: 0,\n  \t\t\t\tV_MUTED: 0,\n  \t\t\t\tV_DYNAMICS: 0,\n  \t\t\t\tV_QP: 0,\n  \t\t\t\tV_SFPS: 0\n  \t\t\t}\n  \t\t],\n  \t\tV_RECV: [\n  \t\t\t{\n  \t\t\t\tRECVUID: '',\n  \t\t\t\tRECVID: '',\n  \t\t\t\tSSRC: 0,\n  \t\t\t\tV_FPS: 0,\n  \t\t\t\tV_WIDTH: 0,\n  \t\t\t\tV_HEIGHT: 0,\n  \t\t\t\tV_RECVBR: 0,\n  \t\t\t\tV_RECVBYTES: 0,\n  \t\t\t\tV_RECVCOUNT: 0,\n  \t\t\t\tV_LOSTRATE: 0,\n  \t\t\t\tV_RTT: 0,\n  \t\t\t\tV_JITTER: 0,\n  \t\t\t\tV_RDELAY: 0,\n  \t\t\t\tV_LOSTDELAY: 0,\n  \t\t\t\tV_CARTON: 0,\n  \t\t\t\tV_RECVFRAMECOUNT: 0,\n  \t\t\t\tV_LOSTFRAMECOUNT: 0,\n  \t\t\t\tV_DELAY: 0,\n  \t\t\t\tV_BUF: 0,\n  \t\t\t\tV_FRACTIONLOST: 0,\n  \t\t\t\tV_MUTED: 0\n  \t\t\t}\n  \t\t]\n  \t},\n  \taudioInfo: {\n  \t\tA_SENT: {\n  \t\t\tA_BR: 0,\n  \t\t\tA_SSRC: 0,\n  \t\t\tA_RBR: 0,\n  \t\t\tA_RTT: 0,\n  \t\t\tA_MUTED: 0,\n  \t\t\tA_CAP: 0,\n  \t\t\tA_ENC: 0,\n  \t\t\tA_LOSTRATE: 0,\n  \t\t\tA_RECV: 0,\n  \t\t\tA_SENT: 0,\n  \t\t\tA_RECONNECT: 0,\n  \t\t\tA_RECVERROR: 0\n  \t\t},\n  \t\tA_RECV: [\n  \t\t\t{\n  \t\t\t\tRECVUID: '',\n  \t\t\t\tA_DEVID: '',\n  \t\t\t\tA_RECVBR: 0,\n  \t\t\t\tA_SSRC: 0,\n  \t\t\t\tA_RECVBYTES: 0,\n  \t\t\t\tA_LOSTRATE: 0,\n  \t\t\t\tA_BUFFERDURATION: 0,\n  \t\t\t\tA_RCARTON: 0,\n  \t\t\t\tA_RECVFRACTIONLOST: 0,\n  \t\t\t\tA_RTT: 0,\n  \t\t\t\tA_DELAY: 0,\n  \t\t\t\tA_DECODELENGTH: 0,\n  \t\t\t\tA_AVJMS: 0,\n  \t\t\t\tA_MAXJMS: 0\n  \t\t\t}\n  \t\t]\n  \t},\n  \tsystemEnvironments: {\n  \t\tsysCpu: 2,\n  \t\tappCpu: 1,\n  \t\tsysRam: 1024,\n  \t\tappRam: 1024\n  \t}\n  }];\n  */\n\n\t\t// key : streamId\n\t\t// value : stat infos\n\t\tthis._audioRecvStats = new _map2.default();\n\t\tthis._videoRecvStats = new _map2.default();\n\n\t\t// key : streamId\n\t\t// value : stat infos\n\t\tthis._audioSendStats = new _map2.default();\n\t\tthis._videoSendStats = new _map2.default();\n\n\t\t// \n\t\tthis._sendRTT = 0;\n\t\tthis._recvRTT = 0;\n\t\t//\n\t\t// availableRecvBW: 0,\n\t\t// availableSendBW: 0,\n\t\tthis._summarize = {\n\t\t\trtt: 0,\n\t\t\tnetworkType: '',\n\t\t\tupSpeed: 0,\n\t\t\tupFractionLost: 0,\n\t\t\tdownSpeed: 0,\n\t\t\tdownFractionLost: 0\n\t\t};\n\t\t// \n\t\tthis._netstat = {\n\t\t\tfractionLost: 0,\n\t\t\troundTripTime: 0,\n\t\t\tquality: 0,\n\t\t\twsState: '',\n\t\t\tsendIceState: '',\n\t\t\trecvIceState: '',\n\t\t\taudioUp: {\n\t\t\t\ttimestamp: 0,\n\t\t\t\tbitrate: 0,\n\t\t\t\tpacketCount: 0,\n\t\t\t\tpacketsLost: 0,\n\t\t\t\tnackCount: 0,\n\t\t\t\tjitter: 0,\n\t\t\t\tpliCount: 0,\n\t\t\t\tsliCount: 0,\n\t\t\t\tfractionLost: 0,\n\t\t\t\troundTripTime: 0\n\t\t\t},\n\t\t\taudioDown: {\n\t\t\t\ttimestamp: 0,\n\t\t\t\tbitrate: 0,\n\t\t\t\tpacketCount: 0,\n\t\t\t\tpacketsLost: 0,\n\t\t\t\tnackCount: 0,\n\t\t\t\tpliCount: 0,\n\t\t\t\tsliCount: 0,\n\t\t\t\tfractionLost: 0,\n\t\t\t\troundTripTime: 0\n\t\t\t},\n\t\t\tvideoUp: {\n\t\t\t\ttimestamp: 0,\n\t\t\t\tbitrate: 0,\n\t\t\t\tpacketCount: 0,\n\t\t\t\tpacketsLost: 0,\n\t\t\t\tnackCount: 0,\n\t\t\t\tjitter: 0,\n\t\t\t\tpliCount: 0,\n\t\t\t\tsliCount: 0,\n\t\t\t\tfractionLost: 0,\n\t\t\t\troundTripTime: 0\n\t\t\t},\n\t\t\tvideoDown: {\n\t\t\t\ttimestamp: 0,\n\t\t\t\tbitrate: 0,\n\t\t\t\tpacketCount: 0,\n\t\t\t\tpacketsLost: 0,\n\t\t\t\tnackCount: 0,\n\t\t\t\tpliCount: 0,\n\t\t\t\tsliCount: 0,\n\t\t\t\tfractionLost: 0,\n\t\t\t\troundTripTime: 0\n\t\t\t}\n\t\t};\n\n\t\tthis._cstat = {\n\t\t\tpeerId: '',\n\t\t\tappId: '',\n\t\t\tconnectionId: '',\n\t\t\troomId: '',\n\t\t\tconsumer: '',\n\t\t\tstat: []\n\t\t};\n\n\t\tthis.streamSsrcPairs = new _map2.default();\n\n\t\tthis.STATS_INTERVAL = 4000;\n\t\tthis.STATS_INTERVAL_S = 2000;\n\t\tthis._gwInfo = {};\n\t\tthis._iplocationInfo = {};\n\t\tthis.setNetworkType();\n\t}\n\n\t(0, _createClass3.default)(Stats, [{\n\t\tkey: 'stop',\n\t\tvalue: function stop() {\n\t\t\tif (!!this._reportInterval) {\n\t\t\t\tclearInterval(this._reportInterval);\n\t\t\t\tthis._reportInterval = null;\n\t\t\t}\n\n\t\t\tthis._webrtcInternalSendStats.clear();\n\t\t\tthis._webrtcInternalRecvStats.clear();\n\t\t}\n\n\t\t// \n\n\t}, {\n\t\tkey: 'getAudioUpStat',\n\t\tvalue: function getAudioUpStat(streamId) {\n\t\t\tif (!!this._audioSendStats) {\n\t\t\t\treturn this._audioSendStats.get(streamId);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t}, {\n\t\tkey: 'getVideoUpStat',\n\t\tvalue: function getVideoUpStat(streamId) {\n\t\t\tif (!!this._videoSendStats) {\n\t\t\t\treturn this._videoSendStats.get(streamId);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t}, {\n\t\tkey: 'getAudioDownStat',\n\t\tvalue: function getAudioDownStat(streamId) {\n\t\t\tif (!!this._audioRecvStats) {\n\t\t\t\treturn this._audioRecvStats.get(streamId);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t}, {\n\t\tkey: 'getVideoDownStat',\n\t\tvalue: function getVideoDownStat(streamId) {\n\t\t\tif (!!this._videoRecvStats) {\n\t\t\t\treturn this._videoRecvStats.get(streamId);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t}, {\n\t\tkey: 'setStreamSSRCPairs',\n\t\tvalue: function setStreamSSRCPairs(id, ssrc, stream, act) {\n\t\t\tvar item = {\n\t\t\t\tssrc: ssrc,\n\t\t\t\tactive: act,\n\t\t\t\tstream: stream\n\t\t\t};\n\t\t\tthis.streamSsrcPairs.set(id, item);\n\t\t}\n\t}, {\n\t\tkey: 'actStreamSSRCPairs',\n\t\tvalue: function actStreamSSRCPairs(id, act) {\n\t\t\tvar item = this.streamSsrcPairs.get(id);\n\n\t\t\tif (item) {\n\t\t\t\titem.active = act;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'isActStreamSSRCPairs',\n\t\tvalue: function isActStreamSSRCPairs(id) {\n\t\t\tvar item = this.streamSsrcPairs.get(id);\n\n\t\t\tif (item) {\n\t\t\t\treturn item.active;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t}, {\n\t\tkey: 'getStreamPropertyBySSRC',\n\t\tvalue: function getStreamPropertyBySSRC(ssrc, property) {\n\t\t\tvar id = '';\n\t\t\tvar found = false;\n\t\t\tvar value = '';\n\n\t\t\tthis.streamSsrcPairs.forEach(function (item, key) {\n\t\t\t\tif (!found && item && '' + item.ssrc === '' + ssrc) {\n\t\t\t\t\tid = key;\n\t\t\t\t\tvalue = item.stream[property];\n\n\t\t\t\t\tfound = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tid: id,\n\t\t\t\tvalue: value\n\t\t\t};\n\t\t}\n\t}, {\n\t\tkey: 'removeStreamById',\n\t\tvalue: function removeStreamById(id) {\n\t\t\tthis.streamSsrcPairs.delete(id);\n\t\t}\n\n\t\t/**\n   * CONNECTING, OPEN, CLOSING, disconnected, CLOSED.\n   * @param {string} state \n   */\n\n\t}, {\n\t\tkey: 'setWsState',\n\t\tvalue: function setWsState(state) {\n\t\t\tthis._netstat.wsState = state;\n\t\t}\n\n\t\t/**\n   * new, checking, connected, completed, disconnected, failed, closed\n   * @param {string} state\n   */\n\n\t}, {\n\t\tkey: 'setSendIceState',\n\t\tvalue: function setSendIceState(state) {\n\t\t\tthis._netstat.sendIceState = state;\n\t\t}\n\n\t\t/**\n   * new, checking, connected, completed, disconnected, failed, closed\n   * @param {string} state\n   */\n\n\t}, {\n\t\tkey: 'setRecvIceState',\n\t\tvalue: function setRecvIceState(state) {\n\t\t\tthis._netstat.recvIceState = state;\n\t\t}\n\t}, {\n\t\tkey: 'setAppid',\n\t\tvalue: function setAppid(appId) {\n\t\t\tthis._appId = appId;\n\n\t\t\t// this.stats[0].appId = `${appId}`;\n\t\t\tthis._cstat.appId = appId;\n\t\t}\n\t}, {\n\t\tkey: 'setRoomId',\n\t\tvalue: function setRoomId(roomId) {\n\t\t\tthis._roomId = roomId;\n\n\t\t\t// this.stats[0].roomId = `${roomId}`;\n\t\t\tthis._cstat.roomId = roomId;\n\t\t}\n\t}, {\n\t\tkey: 'setSessionId',\n\t\tvalue: function setSessionId(sessionId) {\n\t\t\tthis._sessionId = sessionId;\n\n\t\t\t// this.stats[0].sessionId = `${sessionId}`;\n\t\t}\n\t}, {\n\t\tkey: 'setUserId',\n\t\tvalue: function setUserId(userId) {\n\t\t\tthis._userId = userId;\n\n\t\t\t// this.stats[0].userId = `${userId}`;\n\t\t\tthis._cstat.peerId = userId;\n\t\t}\n\t}, {\n\t\tkey: 'setConnectionId',\n\t\tvalue: function setConnectionId(connectionId) {\n\t\t\tthis._connectionId = connectionId;\n\n\t\t\t// this.stats[0].connectionId = `${connectionId}`;\n\t\t\tthis._cstat.connectionId = connectionId;\n\t\t}\n\t}, {\n\t\tkey: 'setRoleType',\n\t\tvalue: function setRoleType(roleType) {\n\t\t\tthis._roleType = '' + roleType;\n\n\t\t\t// this.stats[0].roleType = `${roleType}`;\n\t\t}\n\t}, {\n\t\tkey: 'setOutputAdjustVolume',\n\t\tvalue: function setOutputAdjustVolume(outputVolume) {\n\t\t\tthis._outputAdjustVolume = outputVolume;\n\t\t}\n\t}, {\n\t\tkey: 'setMicAdjustVolume',\n\t\tvalue: function setMicAdjustVolume(micVolume) {\n\t\t\tthis._micAdjustVolume = micVolume;\n\t\t}\n\t}, {\n\t\tkey: 'setPresetAudioBitrate',\n\t\tvalue: function setPresetAudioBitrate(br) {\n\t\t\tthis._presetAudioBitrate = br;\n\t\t}\n\t}, {\n\t\tkey: 'setSignalReconnectTimes',\n\t\tvalue: function setSignalReconnectTimes(reconnTimes) {\n\t\t\tthis._signalReconnectTimes = reconnTimes;\n\t\t}\n\t}, {\n\t\tkey: 'setDeviceInfo',\n\t\tvalue: function setDeviceInfo(info) {\n\t\t\t// logger.debug({ 'clientInfo': info });\n\n\t\t\t// Comment this line for attend to logger server's issue.\n\t\t\t// this.stats[0].equipInfo.equipModel = `{'Web': ${JSON.stringify(info)}}`;\n\n\t\t\t// Comment this line for attend to logger server's issue. \n\t\t\t// this.stats[0].equipInfo.equipModel = `Web: ${info.name}-${info.version}-${info.bowser.osname}-${info.bowser.osversion}`;\n\t\t}\n\t}, {\n\t\tkey: 'setDomain',\n\t\tvalue: function setDomain(domain) {\n\t\t\tthis._domain = domain;\n\t\t}\n\t}, {\n\t\tkey: 'setGWInfo',\n\t\tvalue: function setGWInfo(gwInfo) {\n\t\t\tthis._gwInfo = gwInfo[0];\n\t\t}\n\t}, {\n\t\tkey: 'setIPlocationInfo',\n\t\tvalue: function setIPlocationInfo(info) {\n\t\t\tthis._iplocationInfo = info;\n\t\t}\n\t}, {\n\t\tkey: 'setNetworkType',\n\t\tvalue: function setNetworkType() {\n\t\t\ttry {\n\t\t\t\tvar connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n\t\t\t\tswitch (connection.type) {\n\t\t\t\t\tcase 'wifi':\n\t\t\t\t\t\tthis._netType = '0';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'ethernet':\n\t\t\t\t\t\tthis._netType = '4';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthis._netType = '4';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\t// \n\t\t// 向日志服务器上报 stat 信息 （HeartBeat）\n\n\t}, {\n\t\tkey: '_reportWebrtcStats',\n\t\tvalue: function _reportWebrtcStats() {\n\t\t\tvar _this = this;\n\n\t\t\t// \n\t\t\tif (!this._webrtcInternalSendStats && !this._webrtcInternalRecvStats) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar sendStatLen = this._webrtcInternalSendStats.length;\n\t\t\tvar recvStatLen = this._webrtcInternalRecvStats.length;\n\n\t\t\t// logger.debug(`_reportWebrtcStats -- sendStatLen: ${sendStatLen} recvStatLen: ${recvStatLen}`);\n\n\t\t\tvar cnt = Math.min(Math.max(sendStatLen, recvStatLen), 10);\n\t\t\tthis._webrtcStats = [];\n\n\t\t\tvar _loop = function _loop(i) {\n\t\t\t\t// \n\t\t\t\tvar oStat = {};\n\n\t\t\t\t// \n\t\t\t\toStat.appId = '' + _this._appId;\n\t\t\t\toStat.roomId = '' + _this._roomId;\n\t\t\t\toStat.sessionId = '' + _this._sessionId;\n\t\t\t\toStat.userId = '' + _this._userId;\n\t\t\t\toStat.connectionId = '' + _this._connectionId;\n\t\t\t\toStat.roleType = '' + _this._roleType;\n\t\t\t\t// oStat.logTime = `${Math.floor(Date.now())}`;\n\t\t\t\t// oStat.gwToUeId = 0; // 暂无此值 // TODO : \n\t\t\t\t// oStat.ueToGwId = 0; // 暂无此值 // TODO : \n\t\t\t\toStat.signalReconnectTimes = _this._signalReconnectTimes;\n\t\t\t\toStat.equipInfo = {\n\t\t\t\t\tsdkVersion: pkg.version + '_' + pkg.buildDate, // 'ver3.7.3_Sep_28_2019',\n\t\t\t\t\tnetType: '' + _this._netType,\n\t\t\t\t\tequipModel: _this._isMobile ? 'web_mobile' : 'web',\n\t\t\t\t\tinBackground: 0,\n\t\t\t\t\tsystemVersion: 'web',\n\t\t\t\t\tpublicVersion: '3T_Web_SDK_V' + pkg.version + '_' + pkg.buildDate\n\t\t\t\t};\n\n\t\t\t\t// \n\t\t\t\toStat.audioInfo = {};\n\t\t\t\toStat.audioInfo.A_SENT = {};\n\t\t\t\toStat.audioInfo.A_RECV = [];\n\n\t\t\t\toStat.videoInfo = {};\n\t\t\t\toStat.videoInfo.V_SENT = [];\n\t\t\t\toStat.videoInfo.V_RECV = [];\n\n\t\t\t\t// for send stat\n\t\t\t\tvar sendStat = _this._webrtcInternalSendStats.shift();\n\n\t\t\t\tif (sendStat) {\n\t\t\t\t\t// \n\t\t\t\t\toStat.logTime = sendStat.statTimeTick;\n\n\t\t\t\t\t// \n\t\t\t\t\tvar sendVideoCnt = 0;\n\n\t\t\t\t\t// rtt from stat\n\t\t\t\t\tvar rtt = 0;\n\n\t\t\t\t\tsendStat.results.forEach(function (v) {\n\t\t\t\t\t\tif (v.type === 'VideoBwe') {\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t} else if (v.type === 'googCandidatePair') {\n\t\t\t\t\t\t\tif (v.googActiveConnection === 'true') {\n\t\t\t\t\t\t\t\trtt = parseInt(v.googRtt, 10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (v.type === 'ssrc') {\n\t\t\t\t\t\t\tvar ssrc = parseInt(v.ssrc, 10);\n\n\t\t\t\t\t\t\tif (v.mediaType === 'audio') {\n\t\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t\tvar audioBR = !sendStat.audio[ssrc].upSpeedKBPS ? 0 : sendStat.audio[ssrc].upSpeedKBPS;\n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_BR = parseInt(audioBR, 10);\n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_SSRC = ssrc;\n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_SENT.A_RBR = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_RTT = parseInt(v.googRtt, 10);\n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_MUTED = _this._isAudioOpen ? 0 : 1;\n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_SENT.A_CAP = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_SENT.A_ENC = 0; // 暂无此值 // TODO : \n\n\t\t\t\t\t\t\t\tvar audioLost = parseInt(!sendStat.audio[ssrc].packetsLost ? 0 : sendStat.audio[ssrc].packetsLost, 10);\n\t\t\t\t\t\t\t\tvar audioPkts = parseInt(!sendStat.audio[ssrc].packetsSent ? 0 : sendStat.audio[ssrc].packetsSent, 10);\n\t\t\t\t\t\t\t\tvar audioPacketsLost = audioPkts > 0 ? audioLost / audioPkts : 0;\n\n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_FRACTIONLOST = parseFloat(audioPacketsLost.toFixed(1));\n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_RECV = 0; // TODO : // audioBytesReceivedTotal;\n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_SENT = parseInt(v.bytesSent, 10);\n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_RECONNECT = {};\n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_SENT.A_RECVERROR = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_SENT.A_MAXERRORUID = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_SENT.A_RECVERRORTIME = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_SENT.A_MUTEFRAME = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_SENT.A_MUTEALL = 0; // 暂无此值 TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_LEVELSUM = 1; // TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_PRELEVELSUM = 1; // TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_MIC_VOL = _this._micAdjustVolume;\n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_CAP_STAT = 1; // TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_SPEAKING = 1; // TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_SENT.A_BITRATE = _this._presetAudioBitrate;\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t} else if (v.mediaType === 'video') {\n\t\t\t\t\t\t\t\tvar sid = '';\n\n\t\t\t\t\t\t\t\tvar _getStreamPropertyByS = _this.getStreamPropertyBySSRC(ssrc, \"innerStreamID\"),\n\t\t\t\t\t\t\t\t    id = _getStreamPropertyByS.id,\n\t\t\t\t\t\t\t\t    value = _getStreamPropertyByS.value;\n\n\t\t\t\t\t\t\t\tif (!_this.isActStreamSSRCPairs(id)) return;\n\n\t\t\t\t\t\t\t\tsid = value;\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt] = {};\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].DEVID = '' + sid;\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_SSRC = +ssrc;\n\t\t\t\t\t\t\t\tvar videoVBR = !sendStat.video[ssrc].upSpeedKBPS ? 0 : sendStat.video[ssrc].upSpeedKBPS;\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_VBR = parseInt(videoVBR, 10); // kbps;\n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_SENT[sendVideoCnt].V_RBR = 0; // 暂无此值 // TODO :\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_FPS = parseInt(v.googFrameRateInput, 10);\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_SENDBYTES = parseInt(v.bytesSent, 10);\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_SENDCOUNT = parseInt(v.packetsSent, 10);\n\n\t\t\t\t\t\t\t\tvar videoLost = parseInt(!sendStat.video[ssrc].packetsLost ? 0 : sendStat.video[ssrc].packetsLost, 10);\n\t\t\t\t\t\t\t\tvar videoPkts = parseInt(!sendStat.video[ssrc].packetsSent ? 0 : sendStat.video[ssrc].packetsSent, 10);\n\t\t\t\t\t\t\t\tvar videoPacketsLost = videoPkts > 0 ? videoLost / videoPkts : 0;\n\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_SENDFRACTIONLOST = parseFloat(videoPacketsLost.toFixed(1));\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_RTT = parseInt(v.googRtt, 10);\n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_SENT[sendVideoCnt].V_BUF = 0; // 暂无此值 // TODO :\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_RECV = 0; // TODO : // videoBytesReceivedTotal; \n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_SEND = parseInt(v.bytesSent, 10);\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_LOSS = 0; // TODO :\n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_SENT[sendVideoCnt].V_ENCERROR = 0; // 暂无此值 // TODO :\n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_SENT[sendVideoCnt].V_ENC = 0; // 暂无此值 // TODO :\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_RECONNECT = {}; // TODO : \n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_MUTED = _this._isVideoOpen ? 0 : 1;\n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_SENT[sendVideoCnt].V_DYNAMICS = parseInt((videoVBR) , 10); // TODO : 待确认\n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_QP = 36; // TODO : \n\t\t\t\t\t\t\t\toStat.videoInfo.V_SENT[sendVideoCnt].V_SFPS = parseInt(v.googFrameRateSent, 10);\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tsendVideoCnt++;\n\t\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\t// for recv stat\n\t\t\t\tvar recvStat = _this._webrtcInternalRecvStats.shift();\n\n\t\t\t\tif (recvStat) {\n\t\t\t\t\t// \n\t\t\t\t\toStat.logTime = recvStat.statTimeTick;\n\n\t\t\t\t\t// \n\t\t\t\t\tvar recvVideoCnt = 0;\n\t\t\t\t\tvar recvAudioCnt = 0;\n\n\t\t\t\t\t// rtt from stat\n\t\t\t\t\tvar _rtt = 0;\n\n\t\t\t\t\t// \n\t\t\t\t\trecvStat.results.forEach(function (v) {\n\t\t\t\t\t\tif (v.type === 'VideoBwe') {\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t} else if (v.type === 'googCandidatePair') {\n\t\t\t\t\t\t\tif (v.googActiveConnection === 'true') {\n\t\t\t\t\t\t\t\t_rtt = parseInt(v.googRtt, 10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (v.type === 'ssrc') {\n\t\t\t\t\t\t\tvar ssrc = parseInt(v.ssrc, 10);\n\t\t\t\t\t\t\tif (v.mediaType === 'audio') {\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tvar _getStreamPropertyByS2 = _this.getStreamPropertyBySSRC(ssrc, \"userID\"),\n\t\t\t\t\t\t\t\t    id = _getStreamPropertyByS2.id,\n\t\t\t\t\t\t\t\t    value = _getStreamPropertyByS2.value;\n\n\t\t\t\t\t\t\t\tif (!_this.isActStreamSSRCPairs(id)) return;\n\n\t\t\t\t\t\t\t\tvar uid = value;\n\t\t\t\t\t\t\t\tif (uid === '') //\n\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt] = {};\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].RECVUID = uid;\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_SSRC = ssrc;\n\t\t\t\t\t\t\t\tvar audioRecvBR = !recvStat.audio[ssrc].downSpeedKBPS ? 0 : recvStat.audio[ssrc].downSpeedKBPS;\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_RECVBR = parseInt(audioRecvBR, 10);\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_RECVBYTES = parseInt(v.bytesReceived, 10);\n\n\t\t\t\t\t\t\t\tvar audioLost = parseInt(!recvStat.audio[ssrc].packetsLost ? 0 : recvStat.audio[ssrc].packetsLost, 10);\n\t\t\t\t\t\t\t\tvar audioPkts = parseInt(!recvStat.audio[ssrc].packetsReceived ? 0 : recvStat.audio[ssrc].packetsReceived, 10);\n\t\t\t\t\t\t\t\tvar audioPacketsLost = audioPkts > 0 ? audioLost / audioPkts : 0;\n\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_LOSTRATE = parseFloat(audioPacketsLost.toFixed(1));\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_BUFFERDURATION = parseInt(v.googJitterBufferMs, 10);\n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_RECV[recvAudioCnt].A_RCARTON = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_RECV[recvAudioCnt].A_RCARTON_DIFF = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_RECV[recvAudioCnt].A_RCARTONCOUNT = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_RECVFRACTIONLOST = parseFloat(audioPacketsLost.toFixed(1));\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_RTT = _rtt;\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_DELAY = parseInt(!recvStat.audio[ssrc].latency ? 0 : recvStat.audio[ssrc].latency, 10);\n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_RECV[recvAudioCnt].A_DECODELENGTH = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_AVJMS = 0; // TODO : // v.googJitterBufferMs average\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_MAXJMS = 0; // TODO : // v.googJitterBufferMs max\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_DISCARDEDPKTS = parseInt(v.packetsLost, 10);\n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_VOLUME = _this._outputAdjustVolume;\n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_RECV[recvAudioCnt].A_MUTEDBYSELF = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_LEVELSUM = 1; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\toStat.audioInfo.A_RECV[recvAudioCnt].A_MUTE = 0; // TODO : \n\t\t\t\t\t\t\t\t// oStat.audioInfo.A_RECV[recvAudioCnt].A_LOSTDELAY_FRACTION = 0; // 暂无此值 // TODO : \n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\trecvAudioCnt++;\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t} else if (v.mediaType === 'video') {\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tvar _uid = '';\n\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar _getStreamPropertyByS3 = _this.getStreamPropertyBySSRC(ssrc, \"userID\"),\n\t\t\t\t\t\t\t\t\t    _id = _getStreamPropertyByS3.id,\n\t\t\t\t\t\t\t\t\t    _value = _getStreamPropertyByS3.value;\n\n\t\t\t\t\t\t\t\t\tif (!_this.isActStreamSSRCPairs(_id)) return;\n\n\t\t\t\t\t\t\t\t\t_uid = _value;\n\n\t\t\t\t\t\t\t\t\tif (_uid === '') return;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar sid = '';\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar _getStreamPropertyByS4 = _this.getStreamPropertyBySSRC(ssrc, \"streamID\"),\n\t\t\t\t\t\t\t\t\t    _id2 = _getStreamPropertyByS4.id,\n\t\t\t\t\t\t\t\t\t    _value2 = _getStreamPropertyByS4.value;\n\n\t\t\t\t\t\t\t\t\tsid = _value2;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt] = {};\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].RECVUID = '' + _uid;\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].RECVID = '' + sid;\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_SSRC = +ssrc;\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_FPS = parseInt(v.googFrameRateOutput, 10);\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_WIDTH = parseInt(v.googFrameWidthReceived, 10);\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_HEIGHT = parseInt(v.googFrameHeightReceived, 10);\n\t\t\t\t\t\t\t\tvar videoRecvBR = !recvStat.video[ssrc].downSpeedKBPS ? 0 : recvStat.video[ssrc].downSpeedKBPS;\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_RECVBR = parseInt(videoRecvBR, 10);\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_RECVBYTES = parseInt(v.bytesReceived, 10);\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_RECVCOUNT = parseInt(v.packetsReceived, 10);\n\n\t\t\t\t\t\t\t\tvar videoLost = parseInt(!recvStat.video[ssrc].packetsLost ? 0 : recvStat.video[ssrc].packetsLost, 10);\n\t\t\t\t\t\t\t\tvar videoPkts = parseInt(!recvStat.video[ssrc].packetsReceived ? 0 : recvStat.video[ssrc].packetsReceived, 10);\n\t\t\t\t\t\t\t\tvar videoPacketsLost = videoPkts > 0 ? videoLost / videoPkts : 0;\n\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_LOSTRATE = parseFloat(videoPacketsLost.toFixed(1));\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_RTT = _rtt;\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_JITTER = parseInt(v.googJitterBufferMs, 10);\n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_RECV[recvVideoCnt].V_RDELAY = 0; // 暂不此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_RECV[recvVideoCnt].V_LOSTDELAY = 0; // 暂不此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_RECV[recvVideoCnt].V_RDELAY_FRACTION = 0; // 暂不此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_RECV[recvVideoCnt].V_LOSTDELAY_FRACTION = 0; // 暂不此值 // TODO : \n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_RECVFRAMECOUNT = parseInt(v.framesDecoded, 10);\n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_RECV[recvVideoCnt].V_LOSTFRAMECOUNT = 0; // 暂不此值 // TODO : \n\t\t\t\t\t\t\t\tvar vDelay = !recvStat.video[ssrc].latency ? 0 : recvStat.video[ssrc].latency;\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_DELAY = parseInt(vDelay, 10);\n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_RECV[recvVideoCnt].V_CARTON = 0; // 暂不此值 // TODO : \n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_RECV[recvVideoCnt].V_BUF =  0; // 暂不此值 // TODO : \n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_FRACTIONLOST = parseFloat(videoPacketsLost.toFixed(1));\n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_MUTED = 1; // TODO : \n\t\t\t\t\t\t\t\t// oStat.videoInfo.V_RECV[recvVideoCnt].AVDiff = 1; // 暂不此值 // TODO : \n\t\t\t\t\t\t\t\toStat.videoInfo.V_RECV[recvVideoCnt].V_TARGETVBR = parseInt(videoRecvBR, 10); // TODO : \n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\trecvVideoCnt++;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/*\n    oStat.systemEnvironments = {\n    \tsysCpu: 0, // 暂无此值 // TODO : \n    \tappCpu: 0, // 暂无此值 // TODO : \n    \tsysRam: 0, // 暂无此值 // TODO : \n    \tappRam: 0 // 暂无此值 // TODO : \n    };\n    */\n\n\t\t\t\t// \n\t\t\t\t// const localIP = sendStat.connectionType.local.ipAddress || recvStat.connectionType.local.ipAddress || '';\n\t\t\t\tvar remoteIP = '';\n\t\t\t\tvar remotePort = 0;\n\t\t\t\tif (!!sendStat && !!sendStat.connectionType && sendStat.connectionType.remote) {\n\t\t\t\t\tremoteIP = sendStat.connectionType.remote.ipAddress;\n\t\t\t\t\tremotePort = sendStat.connectionType.remote.portNumber;\n\t\t\t\t}\n\t\t\t\tif (!!recvStat && !!recvStat.connectionType && recvStat.connectionType.remote) {\n\t\t\t\t\tremoteIP = recvStat.connectionType.remote.ipAddress;\n\t\t\t\t\tremotePort = recvStat.connectionType.remote.portNumber;\n\t\t\t\t}\n\n\t\t\t\toStat.mediaServerInfo = {\n\t\t\t\t\taIp: remoteIP,\n\t\t\t\t\taudio_port: remotePort,\n\t\t\t\t\taSid: '',\n\t\t\t\t\tvIp: remoteIP,\n\t\t\t\t\tvPort: remotePort,\n\t\t\t\t\tvSid: ''\n\n\t\t\t\t\t// \n\t\t\t\t};_this._webrtcStats.push(oStat);\n\t\t\t};\n\n\t\t\tfor (var i = 0; i < cnt; i++) {\n\t\t\t\t_loop(i);\n\t\t\t}\n\t\t\t// \n\t\t\tif (cnt > 0) {\n\t\t\t\t//... web api send stats to log server.\n\t\t\t\tthis.pushLoggerToServer(EventType.HEART_BEAT, this._webrtcStats);\n\t\t\t}\n\n\t\t\tif (Math.max(sendStatLen, recvStatLen) > 10) {\n\t\t\t\tthis._reportWebrtcStats();\n\t\t\t}\n\t\t}\n\n\t\t// stat info 入队，用于后续定时上报 HeartBeat 信息\n\n\t}, {\n\t\tkey: 'setWebrtcInternalSendStats',\n\t\tvalue: function setWebrtcInternalSendStats(statInfo) {\n\t\t\tthis._sendRTT = statInfo.bandwidth.rtt;\n\t\t\t// \n\t\t\tthis._summarize.rtt = statInfo.bandwidth.rtt;\n\t\t\t// this._summarize.availableRecvBW = statInfo.bandwidth.googAvailableReceiveBandwidth;\n\t\t\t// this._summarize.availableSendBW = statInfo.bandwidth.googAvailableSendBandwidth;\n\t\t\tvar upSpeed = statInfo.bandwidth.upSpeed;\n\t\t\tthis._summarize.upSpeed = parseInt(upSpeed, 10);\n\t\t\tthis._summarize.networkType = statInfo.connectionType.local.networkType;\n\n\t\t\t// \n\t\t\tif (!this._webrtcInternalSendStats) return;\n\n\t\t\t// logger.debug(`<WEBRTC-STAT> setWebrtcInternalSendStats -- statInfo: ${JSON.stringify(statInfo)} this._webrtcInternalSendStats.length: ${this._webrtcInternalSendStats.length}`);\n\n\t\t\tvar d = new Date();\n\t\t\tvar curTS = d.getTime();\n\n\t\t\tstatInfo.statTimeTick = curTS;\n\n\t\t\tthis._webrtcInternalSendStats.push(statInfo);\n\t\t}\n\n\t\t// stat info 入队，用于后续定时上报 HeartBeat 信息\n\n\t}, {\n\t\tkey: 'setWebrtcInternalRecvStats',\n\t\tvalue: function setWebrtcInternalRecvStats(statInfo) {\n\t\t\tthis._recvRTT = statInfo.bandwidth.rtt;\n\t\t\t// \n\t\t\tthis._summarize.rtt = statInfo.bandwidth.rtt;\n\t\t\t// this._summarize.availableRecvBW = statInfo.bandwidth.googAvailableReceiveBandwidth;\n\t\t\t// this._summarize.availableSendBW = statInfo.bandwidth.googAvailableSendBandwidth;\n\t\t\tvar downSpeed = statInfo.bandwidth.downSpeed;\n\t\t\tthis._summarize.downSpeed = parseInt(downSpeed, 10);\n\t\t\tthis._summarize.networkType = statInfo.connectionType.local.networkType;\n\n\t\t\tif (!this._webrtcInternalRecvStats) return;\n\n\t\t\t// logger.debug(`<WEBRTC-STAT> setWebrtcInternalRecvStats -- statInfo: ${JSON.stringify(statInfo)} this._webrtcInternalRecvStats.length: ${this._webrtcInternalRecvStats.length}`);\n\n\t\t\tvar d = new Date();\n\t\t\tvar curTS = d.getTime();\n\n\t\t\tstatInfo.statTimeTick = curTS;\n\n\t\t\tthis._webrtcInternalRecvStats.push(statInfo);\n\t\t}\n\n\t\t// stats : 从 mediasoup 得到的 consumer stat 信息\n\n\t}, {\n\t\tkey: 'setConsumeStats',\n\t\tvalue: function setConsumeStats(stats, resolution, peerId, consumerId, streamId) {\n\t\t\tvar _this2 = this;\n\n\t\t\t// logger.debug(`<STAT> setConsumeStats streamId: ${streamId} ${JSON.stringify(stats)}`);\n\n\t\t\tthis._cstat.consumer = consumerId;\n\t\t\tthis._cstat.stat = stats;\n\n\t\t\t// \n\t\t\tvar d = new Date();\n\t\t\tvar curTS = d.getTime();\n\n\t\t\t// \n\t\t\tvar isVideoDownStat = false;\n\t\t\tvar videoDownStat = {};\n\t\t\tvar isAudioDownStat = false;\n\t\t\tvar audioDownStat = {};\n\n\t\t\tvar downFractionLost = 0;\n\n\t\t\tstats.forEach(function (element) {\n\t\t\t\t// NOTE: only care outbound-rtp.\n\t\t\t\tif (element.type !== 'outbound-rtp') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// this.stats[0].videoInfo.V_RECV[0].RECVUID = `${peerId}`;\n\n\t\t\t\tif (element.kind === 'video') {\n\t\t\t\t\t/*\n     this.stats[0].videoInfo.V_RECV[0].RECVUID = `${peerId}`;\n     this.stats[0].videoInfo.V_RECV[0].RECVID = `${element.inboundRtpId}`;\n     this.stats[0].videoInfo.V_RECV[0].V_RECVBR = parseInt(element.bitrate / 1000.0, 10);\n     this.stats[0].videoInfo.V_RECV[0].V_LOSTRATE = element.fractionLost;\n     this.stats[0].videoInfo.V_RECV[0].V_RTT = parseInt(element.roundTripTime, 10);\n     this.stats[0].videoInfo.V_RECV[0].V_RECVBYTES = parseInt(element.byteCount, 10);\n     this.stats[0].videoInfo.V_RECV[0].V_RECVCOUNT = parseInt(element.packetCount, 10);\n     this.stats[0].videoInfo.V_RECV[0].V_WIDTH = parseInt(resolution.frameWidth, 10);\n     this.stats[0].videoInfo.V_RECV[0].V_HEIGHT = parseInt(resolution.frameHeight, 10);\n     */\n\n\t\t\t\t\tvideoDownStat.statTS = curTS; // 记录 统计时的时戳，用于失效清理（超时3s，认为失效）\n\t\t\t\t\tvideoDownStat.streamId = streamId;\n\t\t\t\t\tvideoDownStat.ssrc = element.ssrc;\n\n\t\t\t\t\tvideoDownStat.timestamp = element.timestamp;\n\t\t\t\t\t_this2._netstat.videoDown.timestamp = element.timestamp;\n\t\t\t\t\tvar downBitrate = element.bitrate;\n\t\t\t\t\tvideoDownStat.bitrate = parseInt(downBitrate / 1024, 10);\n\t\t\t\t\t_this2._netstat.videoDown.bitrate = element.bitrate;\n\t\t\t\t\tvideoDownStat.packetCount = element.packetCount;\n\t\t\t\t\t_this2._netstat.videoDown.packetCount = element.packetCount;\n\t\t\t\t\tvideoDownStat.packetLost = element.packetsLost;\n\t\t\t\t\t_this2._netstat.videoDown.packageLost = element.packetsLost;\n\t\t\t\t\tvideoDownStat.nackCount = element.nackCount;\n\t\t\t\t\t_this2._netstat.videoDown.nackCount = element.nackCount;\n\t\t\t\t\tvideoDownStat.pliCount = element.pliCount;\n\t\t\t\t\t_this2._netstat.videoDown.pliCount = element.pliCount;\n\t\t\t\t\tvideoDownStat.sliCount = element.sliCount;\n\t\t\t\t\t_this2._netstat.videoDown.sliCount = element.sliCount;\n\t\t\t\t\tvideoDownStat.fractionLost = element.fractionLost;\n\n\t\t\t\t\tif (+videoDownStat.fractionLost > +downFractionLost) downFractionLost = +videoDownStat.fractionLost;\n\t\t\t\t\t// \n\t\t\t\t\t_this2._netstat.videoDown.fractionLost = element.fractionLost;\n\t\t\t\t\tif (typeof element.roundTripTime !== 'undefined') {\n\t\t\t\t\t\t_this2._netstat.videoDown.roundTripTime = element.roundTripTime;\n\t\t\t\t\t\tvideoDownStat.rtt = _this2._recvRTT; // element.roundTripTime;\n\t\t\t\t\t}\n\n\t\t\t\t\tisVideoDownStat = true;\n\t\t\t\t} else if (element.kind === 'audio') {\n\t\t\t\t\t/*\n     this.stats[0].audioInfo.A_RECV[0].RECVUID = `${peerId}`;\n     this.stats[0].audioInfo.A_RECV[0].A_DEVID = element.inboundRtpId;\n     this.stats[0].audioInfo.A_RECV[0].A_RECVBR = parseInt(element.bitrate / 1000.0, 10);\n     this.stats[0].audioInfo.A_RECV[0].A_LOSTRATE = element.fractionLost;\n     this.stats[0].audioInfo.A_RECV[0].A_RTT = parseInt(element.roundTripTime, 10);\n     this.stats[0].audioInfo.A_RECV[0].A_RECVBYTES = parseInt(element.byteCount, 10);\n     this.stats[0].audioInfo.A_RECV[0].A_RECVCOUNT = parseInt(element.packetCount, 10);\n     */\n\n\t\t\t\t\taudioDownStat.statTS = curTS; // 记录 统计时的时戳，用于失效清理（超时3s，认为失效）\n\t\t\t\t\taudioDownStat.streamId = streamId;\n\t\t\t\t\taudioDownStat.ssrc = element.ssrc;\n\n\t\t\t\t\t_this2._netstat.audioDown.timestamp = element.timestamp;\n\t\t\t\t\taudioDownStat.timestamp = element.timestamp;\n\t\t\t\t\t_this2._netstat.audioDown.bitrate = element.bitrate;\n\t\t\t\t\tvar _downBitrate = element.bitrate;\n\t\t\t\t\taudioDownStat.bitrate = parseInt(_downBitrate / 1024, 10);\n\t\t\t\t\t_this2._netstat.audioDown.packetCount = element.packetCount;\n\t\t\t\t\taudioDownStat.packetCount = element.packetCount;\n\t\t\t\t\t_this2._netstat.audioDown.packetsLost = element.packetsLost;\n\t\t\t\t\taudioDownStat.packetLost = element.packetsLost;\n\t\t\t\t\t_this2._netstat.audioDown.nackCount = element.nackCount;\n\t\t\t\t\taudioDownStat.nackCount = element.nackCount;\n\t\t\t\t\t_this2._netstat.audioDown.pliCount = element.pliCount;\n\t\t\t\t\taudioDownStat.pliCount = element.pliCount;\n\t\t\t\t\t_this2._netstat.audioDown.sliCount = element.sliCount;\n\t\t\t\t\taudioDownStat.sliCount = element.sliCount;\n\t\t\t\t\t_this2._netstat.audioDown.fractionLost = element.fractionLost;\n\t\t\t\t\taudioDownStat.fractionLost = element.fractionLost;\n\n\t\t\t\t\tif (+audioDownStat.fractionLost > +downFractionLost) downFractionLost = +audioDownStat.fractionLost;\n\n\t\t\t\t\tif (typeof element.roundTripTime !== 'undefined') {\n\t\t\t\t\t\t_this2._netstat.audioDown.roundTripTime = element.roundTripTime;\n\t\t\t\t\t\taudioDownStat.rtt = _this2._recvRTT; // element.roundTripTime;\n\t\t\t\t\t}\n\n\t\t\t\t\tisAudioDownStat = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// \n\t\t\tthis._summarize.downFractionLost = downFractionLost;\n\n\t\t\tthis._setNetQulity();\n\n\t\t\t// 将统计数据暂存 _audioRecvStats 中，以备上层get\n\t\t\tif (isAudioDownStat) {\n\t\t\t\tthis._audioRecvStats.set(streamId, audioDownStat);\n\t\t\t}\n\n\t\t\t// 将统计数据暂存 _videoRecvStats 中，以备上层get\n\t\t\tif (isVideoDownStat) {\n\t\t\t\tthis._videoRecvStats.set(streamId, videoDownStat);\n\t\t\t}\n\n\t\t\t/*\n   this.pushLoggerToServer(null,\n   \t{\n   \t\tappId: this._appId,\n   \t\troomId: this.stats[0].roomId,\n   \t\tuserId: this.stats[0].userId,\n   \t\ttype: 'netStats',\n   \t\tconsumerPeerId: peerId,\n   \t\tstats: stats,\n   \t\tconsumer: consumerId\n   \t}\n   );\n   */\n\n\t\t\tthis._cstat.stat.forEach(function (element) {\n\t\t\t\t// received video. NOTE: only care outbound-rtp.\n\t\t\t\tif (element.kind === 'video' && element.type === 'outbound-rtp') {\n\t\t\t\t\telement.resolution = resolution;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.consumerState(this._cstat);\n\t\t}\n\n\t\t// stats : 从 mediasoup 得到的 mic producer stat 信息\n\n\t}, {\n\t\tkey: 'setMicStats',\n\t\tvalue: function setMicStats(stats, streamId) {\n\t\t\tvar _this3 = this;\n\n\t\t\t// logger.debug(`<STAT> setMicStats streamId: ${streamId} ${JSON.stringify(stats)}`);\n\n\t\t\tvar isAudioUpStat = false;\n\t\t\tvar audioUpStat = {};\n\n\t\t\t// \n\t\t\tvar d = new Date();\n\t\t\tvar curTS = d.getTime();\n\n\t\t\tvar upFractionLost = 0;\n\t\t\tstats.forEach(function (element) {\n\t\t\t\t// NOTE: only care inbound-rtp.\n\t\t\t\tif (element.type !== 'inbound-rtp') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t/*\n    this.stats[0].audioInfo.A_SENT.A_BR = parseInt(element.bitrate / 1000.0, 10);\n    this.stats[0].audioInfo.A_SENT.A_ENC = parseInt(element.packetCount, 10);\n    this.stats[0].audioInfo.A_SENT.A_LOSTRATE = element.packetsLost;\n    */\n\n\t\t\t\taudioUpStat.statTS = curTS; // 记录 统计时的时戳，用于失效清理（超时3s，认为失效）\n\t\t\t\taudioUpStat.streamId = streamId;\n\t\t\t\taudioUpStat.ssrc = element.ssrc;\n\n\t\t\t\t_this3._netstat.audioUp.timestamp = element.timestamp;\n\t\t\t\taudioUpStat.timestamp = element.timestamp;\n\t\t\t\t_this3._netstat.audioUp.bitrate = element.bitrate;\n\t\t\t\tvar upBitrate = element.bitrate;\n\t\t\t\taudioUpStat.bitrate = parseInt(upBitrate / 1024, 10);\n\t\t\t\t_this3._netstat.audioUp.packetCount = element.packetCount;\n\t\t\t\taudioUpStat.packetCount = element.packetCount;\n\t\t\t\t_this3._netstat.audioUp.packetsLost = element.packetsLost;\n\t\t\t\taudioUpStat.packetLost = element.packetsLost;\n\t\t\t\t_this3._netstat.audioUp.nackCount = element.nackCount;\n\t\t\t\taudioUpStat.nackCount = element.nackCount;\n\t\t\t\t_this3._netstat.audioUp.jitter = element.jitter;\n\t\t\t\taudioUpStat.jitter = element.jitter;\n\t\t\t\t_this3._netstat.audioUp.pliCount = element.pliCount;\n\t\t\t\taudioUpStat.pliCount = element.pliCount;\n\t\t\t\t_this3._netstat.audioUp.fractionLost = element.fractionLost;\n\t\t\t\taudioUpStat.fractionLost = element.fractionLost;\n\n\t\t\t\tif (+audioUpStat.fractionLost > +upFractionLost) upFractionLost = +audioUpStat.fractionLost;\n\n\t\t\t\tif (typeof element.roundTripTime !== 'undefined') {\n\t\t\t\t\t_this3._netstat.audioUp.roundTripTime = element.roundTripTime;\n\t\t\t\t\taudioUpStat.rtt = _this3._sendRTT; // element.roundTripTime;\n\t\t\t\t}\n\n\t\t\t\tisAudioUpStat = true;\n\t\t\t});\n\n\t\t\t// \n\t\t\tthis._summarize.upFractionLost = upFractionLost;\n\n\t\t\tthis._setNetQulity();\n\n\t\t\t// 将统计数据暂存 _audioSendStats 中，以备上层get\n\t\t\tif (isAudioUpStat) {\n\t\t\t\tthis._audioSendStats.set(streamId, audioUpStat);\n\t\t\t}\n\n\t\t\t/*\n   this.pushLoggerToServer(null,\n   \t{\n   \t\ttype: 'netStats',\n   \t\tappId: this._appId,\n   \t\troomId: this.stats[0].roomId,\n   \t\tuserId: this.stats[0].userId,\n   \t\tproducer: 'mic',\n   \t\tstats: stats\n   \t}\n   );\n   */\n\t\t}\n\n\t\t// stats : 从 mediasoup 得到的 webcam producer stat 信息\n\n\t}, {\n\t\tkey: 'setWebcamStats',\n\t\tvalue: function setWebcamStats(stats, streamId) {\n\t\t\tvar _this4 = this;\n\n\t\t\t// logger.debug(`<STAT> setWebcamStats streamId: ${streamId} ${JSON.stringify(stats)}`);\n\n\t\t\tvar isVideoUpStat = false;\n\t\t\tvar videoUpStat = {};\n\n\t\t\t// \n\t\t\tvar d = new Date();\n\t\t\tvar curTS = d.getTime();\n\n\t\t\tvar upFractionLost = 0;\n\t\t\tstats.forEach(function (element) {\n\t\t\t\t// NOTE: only care inbound-rtp.\n\t\t\t\tif (element.type !== 'inbound-rtp') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t/*\n    this.stats[0].videoInfo.V_SENT[0].DEVID = `${element.id}`;\n    this.stats[0].videoInfo.V_SENT[0].V_VBR = parseInt(element.bitrate / 1000.0, 10);\n    this.stats[0].videoInfo.V_SENT[0].V_SENDCOUNT = parseInt(element.packetCount, 10);\n    this.stats[0].videoInfo.V_SENT[0].V_SENDFRACTIONLOST = element.packetsLost;\n    */\n\n\t\t\t\tvideoUpStat.statTS = curTS; // 记录 统计时的时戳，用于失效清理（超时3s，认为失效）\n\t\t\t\tvideoUpStat.streamId = streamId;\n\t\t\t\tvideoUpStat.ssrc = element.ssrc;\n\n\t\t\t\t_this4._netstat.videoUp.timestamp = element.timestamp;\n\t\t\t\tvideoUpStat.timestamp = element.timestamp;\n\t\t\t\t_this4._netstat.videoUp.bitrate = element.bitrate;\n\t\t\t\tvar upBitrate = element.bitrate;\n\t\t\t\tvideoUpStat.bitrate = parseInt(upBitrate / 1024, 10);\n\t\t\t\t_this4._netstat.videoUp.packetCount = element.packetCount;\n\t\t\t\tvideoUpStat.packetCount = element.packetCount;\n\t\t\t\t_this4._netstat.videoUp.packetsLost = element.packetsLost;\n\t\t\t\tvideoUpStat.packetLost = element.packetsLost;\n\t\t\t\t_this4._netstat.videoUp.nackCount = element.nackCount;\n\t\t\t\tvideoUpStat.nackCount = element.nackCount;\n\t\t\t\t_this4._netstat.videoUp.jitter = element.jitter;\n\t\t\t\tvideoUpStat.jitter = element.jitter;\n\t\t\t\t_this4._netstat.videoUp.pliCount = element.pliCount;\n\t\t\t\tvideoUpStat.pliCount = element.pliCount;\n\t\t\t\t_this4._netstat.videoUp.fractionLost = element.fractionLost;\n\t\t\t\tvideoUpStat.fractionLost = element.fractionLost;\n\n\t\t\t\tif (+videoUpStat.fractionLost > +upFractionLost) upFractionLost = +videoUpStat.fractionLost;\n\n\t\t\t\tif (typeof element.roundTripTime !== 'undefined') {\n\t\t\t\t\t_this4._netstat.videoUp.roundTripTime = element.roundTripTime;\n\t\t\t\t\tvideoUpStat.rtt = _this4._sendRTT; // element.roundTripTime;\n\t\t\t\t}\n\n\t\t\t\tisVideoUpStat = true;\n\t\t\t});\n\n\t\t\t// \n\t\t\tthis._summarize.upFractionLost = upFractionLost;\n\n\t\t\tthis._setNetQulity();\n\n\t\t\t// 将统计数据暂存 _videoSendStats 中，以备上层get\n\t\t\tif (isVideoUpStat) {\n\t\t\t\tthis._videoSendStats.set(streamId, videoUpStat);\n\t\t\t}\n\n\t\t\t/*\n   this.pushLoggerToServer(null,\n   \t{\n   \t\ttype: 'netStats',\n   \t\tappId: this._appId,\n   \t\troomId: this.stats[0].roomId,\n   \t\tuserId: this.stats[0].userId,\n   \t\tproducer: 'webcam',\n   \t\tstats: stats\n   \t}\n   );\n   */\n\t\t}\n\t}, {\n\t\tkey: 'startHeartBeat',\n\t\tvalue: function startHeartBeat() {\n\t\t\tvar _this5 = this;\n\n\t\t\tif (!!this._reportInterval) {\n\t\t\t\tclearInterval(this._reportInterval);\n\t\t\t\tthis._reportInterval = null;\n\t\t\t}\n\n\t\t\t// logger.debug('startHeartBeat -- ');\n\t\t\tthis._reportInterval = setInterval(function () {\n\t\t\t\t_this5._reportWebrtcStats();\n\t\t\t}, STAT_REPORT_INTERVAL);\n\t\t}\n\t}, {\n\t\tkey: 'stopHeartBeat',\n\t\tvalue: function stopHeartBeat() {\n\t\t\tif (!!this._reportInterval) {\n\t\t\t\tclearInterval(this._reportInterval);\n\t\t\t\tthis._reportInterval = null;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'pushLoggerToServer',\n\t\tvalue: function pushLoggerToServer(eventType, data) {\n\t\t\tif (!_logger2.default.logSubmit) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar data_ = '';\n\t\t\tif (eventType) {\n\t\t\t\tdata_ = eventType + ' ' + (0, _stringify2.default)(data);\n\t\t\t} else {\n\t\t\t\tdata_ = (0, _stringify2.default)(data);\n\t\t\t}\n\n\t\t\tfetch(config.logserver_url, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tmode: 'no-cors',\n\t\t\t\tcache: 'no-cache',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'text/plain; charset=utf-8'\n\t\t\t\t\t// 'Content-Type': 'application/json; charset=utf-8',\n\t\t\t\t},\n\t\t\t\tredirect: 'follow',\n\t\t\t\treferrer: 'no-referrer',\n\t\t\t\tbody: data_\n\t\t\t}).catch(function (error) {\n\t\t\t\tlogger.warn('pushLoggerToServer() error - ' + error.toString());\n\t\t\t}).then(function (response) {\n\t\t\t\t; // JSON.stringify(response);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'consumerState',\n\t\tvalue: function consumerState(stat) {\n\t\t\tif (!!_logger2.default.privateCloud) // 如果是私有化，则不上传stats\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\tfetch('https://' + this._domain + '/stats/', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tmode: 'no-cors',\n\t\t\t\tcache: 'no-cache',\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json',\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tredirect: 'follow',\n\t\t\t\treferrer: 'no-referrer',\n\t\t\t\tbody: (0, _stringify2.default)(stat)\n\t\t\t}).catch(function (error) {\n\t\t\t\tlogger.warn('consumerState() error - ' + error.toString());\n\t\t\t}).then(function (response) {\n\t\t\t\t; // JSON.stringify(response);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_setNetQulity',\n\t\tvalue: function _setNetQulity() {\n\t\t\tvar fractionLost = 0;\n\t\t\tvar count = 0;\n\t\t\tvar roundTripTime = 0;\n\t\t\tif (this._netstat.audioUp.packetCount !== 0) {\n\t\t\t\tcount++;\n\t\t\t\troundTripTime + this._netstat.audioUp.roundTripTime;\n\t\t\t\t// fractionLost += this._netstat.audioUp.fractionLost;\n\t\t\t\tfractionLost += this._netstat.audioUp.packetsLost / this._netstat.audioUp.packetCount;\n\t\t\t}\n\n\t\t\tif (this._netstat.audioDown.packetCount !== 0) {\n\t\t\t\tcount++;\n\t\t\t\troundTripTime + this._netstat.audioDown.roundTripTime;\n\t\t\t\t// fractionLost += this._netstat.audioDown.fractionLost;\n\t\t\t\tfractionLost += this._netstat.audioDown.packetsLost / this._netstat.audioDown.packetCount;\n\t\t\t}\n\n\t\t\tif (this._netstat.videoUp.packetCount !== 0) {\n\t\t\t\tcount++;\n\t\t\t\troundTripTime + this._netstat.videoUp.roundTripTime;\n\t\t\t\t// fractionLost += this._netstat.videoUp.fractionLost;\n\t\t\t\tfractionLost += this._netstat.videoUp.packetsLost / this._netstat.videoUp.packetCount;\n\t\t\t}\n\n\t\t\tif (this._netstat.videoDown.packetCount !== 0) {\n\t\t\t\tcount++;\n\t\t\t\troundTripTime + this._netstat.videoDown.roundTripTime;\n\t\t\t\t// fractionLost += this._netstat.videoDown.fractionLost;\n\t\t\t\tfractionLost += this._netstat.videoDown.packetsLost / this._netstat.videoDown.packetCount;\n\t\t\t}\n\n\t\t\tif (count !== 0) {\n\t\t\t\troundTripTime /= count;\n\n\t\t\t\tthis._netstat.fractionLost = fractionLost / count;\n\t\t\t\tthis._netstat.roundTripTime = roundTripTime;\n\t\t\t\tthis._netstat.quality = 1 - this._netstat.fractionLost;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'sendTimeOutLog',\n\t\tvalue: function sendTimeOutLog(_ref) {\n\t\t\tvar timesOfLinkGW = _ref.timesOfLinkGW,\n\t\t\t    linkGWTime = _ref.linkGWTime,\n\t\t\t    sendGWTime = _ref.sendGWTime,\n\t\t\t    sendEnterTime = _ref.sendEnterTime;\n\n\t\t\tvar enter_timeout = {\n\t\t\t\t\"glbId\": tttUtils.uuid(),\n\t\t\t\t\"appId\": this._appId,\n\t\t\t\t\"userId\": this._userId,\n\t\t\t\t\"roomId\": this._roomId,\n\t\t\t\t\"connectId\": this._connectionId,\n\t\t\t\t\"os\": \"WEB\",\n\t\t\t\t\"logTime\": new Date().toISOString().replace(/a-z/ig, ' '),\n\t\t\t\t\"timesOfLinkIplocal\": this._iplocationInfo.reconnectTimes,\n\t\t\t\ttimesOfLinkGW: timesOfLinkGW,\n\t\t\t\t\"linkIplocalTime\": this._iplocationInfo.connectedTime - this._iplocationInfo.firstConnectTime,\n\t\t\t\t\"sendIplocalTime\": this._iplocationInfo.connectedTime,\n\t\t\t\tlinkGWTime: linkGWTime,\n\t\t\t\tsendGWTime: sendGWTime,\n\t\t\t\tsendEnterTime: sendEnterTime,\n\t\t\t\t\"gwIp\": this._gwInfo.sIp\n\t\t\t};\n\t\t\tthis.pushLoggerToServer(EventType.ENTER_TIMEOUT, enter_timeout);\n\t\t}\n\t}, {\n\t\tkey: 'sendFailLog',\n\t\tvalue: function sendFailLog(_ref2) {\n\t\t\tvar timesOfLinkGW = _ref2.timesOfLinkGW,\n\t\t\t    linkGWTime = _ref2.linkGWTime,\n\t\t\t    sendGWTime = _ref2.sendGWTime,\n\t\t\t    sendEnterTime = _ref2.sendEnterTime,\n\t\t\t    role = _ref2.role,\n\t\t\t    result = _ref2.result;\n\n\t\t\tvar event_fail = {\n\t\t\t\t\"glbId\": tttUtils.uuid(),\n\t\t\t\t\"appId\": this._appId,\n\t\t\t\t\"userId\": this._userId,\n\t\t\t\t\"roomId\": this._roomId,\n\t\t\t\t\"connectId\": this._connectionId,\n\t\t\t\t\"os\": \"WEB\",\n\t\t\t\trole: role,\n\t\t\t\tresult: result,\n\t\t\t\t\"logTime\": new Date().toISOString().replace(/a-z/ig, ' '),\n\t\t\t\t\"timesOfLinkIplocal\": this._iplocationInfo.reconnectTimes,\n\t\t\t\ttimesOfLinkGW: timesOfLinkGW,\n\t\t\t\t\"linkIplocalTime\": this._iplocationInfo.connectedTime - this._iplocationInfo.firstConnectTime,\n\t\t\t\t\"sendIplocalTime\": this._iplocationInfo.connectedTime,\n\t\t\t\tlinkGWTime: linkGWTime,\n\t\t\t\tsendGWTime: sendGWTime,\n\t\t\t\tsendEnterTime: sendEnterTime,\n\t\t\t\t\"innerDiff\": 0,\n\t\t\t\t\"totalDiff\": 0,\n\t\t\t\t\"gwIp\": this._gwInfo.sIp\n\t\t\t};\n\n\t\t\tthis.pushLoggerToServer(EventType.ENTER_FAIL, event_fail);\n\t\t}\n\t}, {\n\t\tkey: 'audioUpStat',\n\t\tget: function get() {\n\t\t\tvar _this6 = this;\n\n\t\t\t// \n\t\t\tvar d = new Date();\n\t\t\tvar curTS = d.getTime();\n\n\t\t\tthis._audioSendStats.forEach(function (value, index) {\n\t\t\t\tif (curTS - value.statTS > 3000) // 超过3s未更新，则失效删除\n\t\t\t\t\t{\n\t\t\t\t\t\t_this6._audioSendStats.delete(index);\n\t\t\t\t\t}\n\t\t\t});\n\n\t\t\t// \n\t\t\treturn this._audioSendStats;\n\t\t}\n\t}, {\n\t\tkey: 'videoUpStat',\n\t\tget: function get() {\n\t\t\tvar _this7 = this;\n\n\t\t\t// \n\t\t\tvar d = new Date();\n\t\t\tvar curTS = d.getTime();\n\n\t\t\tthis._videoSendStats.forEach(function (value, index) {\n\t\t\t\tif (curTS - value.statTS > 3000) // 超过3s未更新，则失效删除\n\t\t\t\t\t{\n\t\t\t\t\t\t_this7._videoSendStats.delete(index);\n\t\t\t\t\t}\n\t\t\t});\n\n\t\t\t// \n\t\t\treturn this._videoSendStats;\n\t\t}\n\t}, {\n\t\tkey: 'audioDownStat',\n\t\tget: function get() {\n\t\t\tvar _this8 = this;\n\n\t\t\t// \n\t\t\tvar d = new Date();\n\t\t\tvar curTS = d.getTime();\n\n\t\t\tthis._audioRecvStats.forEach(function (value, index) {\n\t\t\t\tif (curTS - value.statTS > 3000) // 超过3s未更新，则失效删除\n\t\t\t\t\t{\n\t\t\t\t\t\t_this8._audioRecvStats.delete(index);\n\t\t\t\t\t}\n\t\t\t});\n\n\t\t\t// \n\t\t\treturn this._audioRecvStats;\n\t\t}\n\t}, {\n\t\tkey: 'videoDownStat',\n\t\tget: function get() {\n\t\t\tvar _this9 = this;\n\n\t\t\t// \n\t\t\tvar d = new Date();\n\t\t\tvar curTS = d.getTime();\n\n\t\t\tthis._videoRecvStats.forEach(function (value, index) {\n\t\t\t\tif (curTS - value.statTS > 3000) // 超过3s未更新，则失效删除\n\t\t\t\t\t{\n\t\t\t\t\t\t_this9._videoRecvStats.delete(index);\n\t\t\t\t\t}\n\t\t\t});\n\n\t\t\t// \n\t\t\treturn this._videoRecvStats;\n\t\t}\n\t}, {\n\t\tkey: 'summarize',\n\t\tget: function get() {\n\t\t\treturn this._summarize;\n\t\t}\n\n\t\t//\n\n\t}, {\n\t\tkey: 'netState',\n\t\tget: function get() {\n\t\t\treturn this._netstat;\n\t\t}\n\t}, {\n\t\tkey: 'audioOpen',\n\t\tset: function set(isOpen) {\n\t\t\tthis._isAudioOpen = isOpen;\n\t\t}\n\t}, {\n\t\tkey: 'videoOpen',\n\t\tset: function set(isOpen) {\n\t\t\tthis._isVideoOpen = isOpen;\n\t\t}\n\t}]);\n\treturn Stats;\n}();\n\nexports.default = Stats;\n\n/***/ }),\n\n/***/ \"./lib/stream.js\":\n/*!***********************!*\\\n  !*** ./lib/stream.js ***!\n  \\***********************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _promise = __webpack_require__(/*! babel-runtime/core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _regenerator = __webpack_require__(/*! babel-runtime/regenerator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/regenerator/index.js\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = __webpack_require__(/*! babel-runtime/helpers/asyncToGenerator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/asyncToGenerator.js\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _stringify = __webpack_require__(/*! babel-runtime/core-js/json/stringify */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _getPrototypeOf = __webpack_require__(/*! babel-runtime/core-js/object/get-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(/*! babel-runtime/helpers/classCallCheck */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(/*! babel-runtime/helpers/createClass */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(/*! babel-runtime/helpers/possibleConstructorReturn */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(/*! babel-runtime/helpers/inherits */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _map = __webpack_require__(/*! babel-runtime/core-js/map */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _logger = __webpack_require__(/*! ./logger */ \"./lib/logger.js\");\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nvar _events = __webpack_require__(/*! events */ \"./node_modules/_events@3.1.0@events/events.js\");\n\nvar _config = __webpack_require__(/*! ./config */ \"./lib/config.js\");\n\nvar config = _interopRequireWildcard(_config);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar browser = __webpack_require__(/*! bowser */ \"./node_modules/_bowser@1.9.4@bowser/src/bowser.js\");\nvar hark = __webpack_require__(/*! hark */ \"./node_modules/_hark@1.2.3@hark/hark.js\");\n\nvar logger = new _logger2.default('<Stream>');\n\nvar S_STREAM_MAP = new _map2.default();\n\n// \n// navigator.mediaDevices.getSupportedConstraints();\n/**\r\n * Stream Object and it's functions.\r\n */\n/*\r\n// Stream 构造函数参数结构如下：\r\n{\r\n\tstreamID: @type {string} - 音视频流 ID，通常设置为用户ID\r\n\tstreamId: - 同 streamID ，为规范化命名\r\n\tuserID: @type {string} - 用户ID\r\n\tuserId: - 同 userID ，为规范化命名\r\n\taudioSource: @type {MediaStreamTrack} - 是否使用外部 音频源 注：(可选)\r\n\tvideoSource: @type {MediaStreamTrack} - 是否使用外部 视频源 注：(可选)\r\n\taudio: @type {Boolean} - 是否由 Stream 打开音频设备 -- 注：(可选)，若已设置 audioSource ，则此项失效\r\n\tmicrophoneId: @type {string} - 麦克风的设备ID. 注：(可选)，不设置将使用默认的麦克风\r\n\tvideo: @type {Boolean} - 是否由 Stream 打开视频设备 -- 注：(可选)，若已设置 videoSource ，则此项失效\r\n\tcameraId: @type {string} - 摄像头的设备ID. 注：(可选)，不设置将使用默认的摄像头\r\n\tattributes: { (可选) 包含以下属性：\r\n\t\tvideoProfile: @type {string} 视频分辨率。取值范围见下表定义\r\n\t\tminFrameRate: @type {number} 最小视频帧率\r\n\t\tmaxFrameRate: @type {number} 最大视频帧率\r\n\t\tidealFrameRate: @type {number} 理想帧率\r\n\t}\r\n\tscreen: @type {Boolean} - 是否由 Stream 打开屏幕共享 (可选)\r\n\tcodecOptions: { (可选)\r\n\t\tstartBitrate: @type {number},\r\n\t\tmaxBitrate: @type @{number},\r\n\t\tminBitrate: @type {number}\r\n\t}\r\n\tsubStream: @type {Boolean} 是否子流\r\n}\r\n注：以上参数中\r\n* video, screen 为互斥项，同时最多只能有其中一个设置为true\r\n* audioSource, audio 为互斥项，以 audioSource 优先，如果 audioSource 有值，则 audio 项将被忽略\r\n* videoSource, video 为互斥项，以 videoSource 优先，如果 videoSource 有值，则 video 项将被忽略\r\n*/\n\nvar Stream = function (_EventEmitter) {\n\t(0, _inherits3.default)(Stream, _EventEmitter);\n\n\tfunction Stream(spec) {\n\t\t(0, _classCallCheck3.default)(this, Stream);\n\n\t\tvar _this = (0, _possibleConstructorReturn3.default)(this, (Stream.__proto__ || (0, _getPrototypeOf2.default)(Stream)).call(this));\n\n\t\tvar uId = '';\n\t\tif (!!spec.userId) {\n\t\t\tspec.userId = spec.userId + '';\n\t\t\tuId = spec.userId.trim();\n\t\t} else if (!!spec.userID) {\n\t\t\tspec.userID = spec.userID + '';\n\t\t\tuId = spec.userID.trim();\n\t\t} else {\n\t\t\tuId = '';\n\t\t}\n\t\tspec.userId = uId;\n\n\t\tvar sId = '';\n\t\tif (!!spec.streamId) {\n\t\t\tspec.streamId = spec.streamId + '';\n\t\t\tsId = spec.streamId.trim();\n\t\t} else if (!!spec.streamID) {\n\t\t\tspec.streamID = spec.streamID + '';\n\t\t\tsId = spec.streamID.trim();\n\t\t} else {\n\t\t\tsId = '';\n\t\t}\n\t\tspec.streamId = sId;\n\n\t\t_this._spec = spec;\n\n\t\tlogger.debug('constructor() -- spec: ' + (0, _stringify2.default)(spec));\n\n\t\t// The webrtc stream object.\n\t\t_this._streamObj = null;\n\n\t\t// stream 类型：producer、consumer\n\t\t_this._streamType = '';\n\t\tif (!!_this._spec.streamType) {\n\t\t\t_this._streamType = spec.streamType;\n\t\t}\n\n\t\t//\n\t\t_this._innerStreamID = '';\n\t\t// TODO : use spec.streamID; // 注：当来自远端的 stream 时，以远端 streamID 为 streamID\n\n\t\t// stream identify by consumter layer.\n\t\t_this._customStreamID = sId;\n\n\t\t// peer idnetify indicate which peer belong to.\n\t\t_this._userId = uId;\n\n\t\t// the audio volume.\n\t\t_this._volume = 0.0;\n\n\t\t// is local stream?\n\t\t_this._isLocalStream = false;\n\n\t\t// 当对流有相应暂停/恢复、移除/添加等场景时，便于 在 stream 内部进一步需要操作 producer\n\t\t// webcam producer -- 仅当 Stream 为 localStream 时，才有意义\n\t\t_this._webcamProducer = null;\n\t\t// mic producer -- 仅当 Stream 为 localStream 时，才有意义\n\t\t_this._micProducer = null;\n\n\t\t// audio tag\n\t\t_this._audio = null;\n\n\t\t// video tag\n\t\t_this._video = null;\n\n\t\t// mic设备是否已被 _closeMic\n\t\t_this._isMicClosed = false;\n\n\t\t// 摄像头设备/screen 是否已被 _closeCamera\n\t\t_this._isVideoTrackClosed = false;\n\n\t\t// 用于内部标识是否为外部媒体源\n\t\t_this._mediaSourceAudio = false;\n\t\t_this._mediaSourceVideo = false;\n\t\t// \n\t\t_this._audioSource = null;\n\t\tif (!!_this._spec.audioSource) {\n\t\t\t_this._audioSource = _this._spec.audioSource;\n\n\t\t\t_this._mediaSourceAudio = true; // 用于内部标识是否为外部媒体源\n\t\t\t// 使用外部 AudioSource，不在 Stream 内创建打开 Audio 设备\n\t\t\t_this._spec.audio = false;\n\t\t}\n\n\t\t_this._videoSource = null;\n\t\tif (!!_this._spec.videoSource) {\n\t\t\t_this._videoSource = _this._spec.videoSource;\n\n\t\t\t_this._mediaSourceVideo = true; // 用于内部标识是否为外部媒体源\n\t\t\t// 使用外部 VideoSource，不在 Stream 内创建打开 Video 设备\n\t\t\t_this._spec.video = false;\n\t\t\t_this._spec.screen = false;\n\t\t}\n\n\t\t// 是否 Stream 内启用 mic\n\t\t_this._enableMic = _this._spec.audio;\n\n\t\t// 是否 Stream 内启用 camera\n\t\t_this._enableCamera = _this._spec.video;\n\n\t\t// specifiy source for producer source.\n\t\t_this._source = _this._spec.source;\n\n\t\t// is this stream subscribed.\n\t\t_this._subscribed = false;\n\n\t\t// is closed\n\t\t_this._closed = false;\n\n\t\t// is sub-stream\n\t\t_this._isSubStream = !_this._spec.subStream ? false : _this._spec.subStream;\n\n\t\t// the resulotion of the 4:3 scales\n\t\t_this._keyResolution = 480;\n\n\t\t// is mobile device\n\t\t_this._isMobile = /mobile/i.test(navigator.userAgent);\n\n\t\t// is this stream published.\n\t\t_this._published = false;\n\n\t\t// -1: 未知\n\t\t// 0: camera\n\t\t// 1: screen\n\t\t// 2: External video source\n\t\t_this._videoType = -1;\n\n\t\t// 此处只需针对 consumer stream 进行 videoType 赋值\n\t\t// -- 对于 producer stream 的 videoType 的赋值，将在 Stream.init 中进行\n\t\tif (_this._spec.videoType !== undefined) {\n\t\t\t_this._videoType = _this._spec.videoType;\n\t\t}\n\n\t\t// 如果在 未publish 状态下设置了视频码率，则 _needUpdateVideoStreamBitrate 设置为 true 。待该路流 publish 时，执行 updateTrack\n\t\t_this._needUpdateVideoStreamBitrate = false; // for replaceTrack\n\t\t_this._updateConstraints = {};\n\n\t\t_this._gainNode = null;\n\n\t\t_this._videoSpec = null;\n\n\t\t// \n\t\t_this._specialCameraId = '';\n\t\t_this._specialMicId = '';\n\n\t\t// 音频 profile -- 取值自 config.audioProfileSpec\n\t\t_this._audioProfile = null;\n\n\t\t// webAudio 上下文，操作音频的接口\n\t\t_this._audioCtx = null;\n\t\treturn _this;\n\t}\n\n\t/**\r\n  * Initialize stream for camera(with mic) or screen(with mic).\r\n  * \r\n  * @public\r\n  * @param onSuccess\r\n  * @param onFailure\r\n  */\n\n\n\t(0, _createClass3.default)(Stream, [{\n\t\tkey: 'init',\n\t\tvalue: function () {\n\t\t\tvar _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(onSuccess, onFailure) {\n\t\t\t\tvar _this2 = this;\n\n\t\t\t\tvar constraints, isVideo, isScreen, v, resolution, latest_chrome, _constraints;\n\n\t\t\t\treturn _regenerator2.default.wrap(function _callee3$(_context3) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context3.prev = _context3.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\tlogger.debug('API init() -- this._userId: ' + this._userId + ' this._spec: ' + (0, _stringify2.default)(this._spec));\n\n\t\t\t\t\t\t\t\tif (!(typeof onSuccess !== 'function')) {\n\t\t\t\t\t\t\t\t\t_context3.next = 4;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API init() error - onSuccess have to be a function.');\n\t\t\t\t\t\t\t\tthrow TypeError('onSuccess have to be a function.');\n\n\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\tif (!(typeof onFailure !== 'function')) {\n\t\t\t\t\t\t\t\t\t_context3.next = 7;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API init() error - onFailure have to be a function.');\n\t\t\t\t\t\t\t\tthrow TypeError('onFailure have to be a function.');\n\n\t\t\t\t\t\t\tcase 7:\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tthis._streamType = 'producer';\n\n\t\t\t\t\t\t\t\t// constrainable properties comes from this.spec variable.\n\t\t\t\t\t\t\t\tconstraints = null;\n\t\t\t\t\t\t\t\tisVideo = Boolean(this._spec.video);\n\t\t\t\t\t\t\t\tisScreen = Boolean(this._spec.screen);\n\t\t\t\t\t\t\t\tv = +isVideo + +isScreen;\n\n\t\t\t\t\t\t\t\tif (!(v > 1)) {\n\t\t\t\t\t\t\t\t\t_context3.next = 16;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API init() error - video/screen: only one can be set as true');\n\t\t\t\t\t\t\t\tonFailure('video/screen: only one can be set as true');\n\t\t\t\t\t\t\t\treturn _context3.abrupt('return');\n\n\t\t\t\t\t\t\tcase 16:\n\n\t\t\t\t\t\t\t\tif (this._spec.video || this._spec.screen) {\n\t\t\t\t\t\t\t\t\tthis._enableVideoTrack = true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// 0: camera\n\t\t\t\t\t\t\t\t// 1: screen\n\t\t\t\t\t\t\t\t// 2: External video source\n\t\t\t\t\t\t\t\tthis._videoType = -1;\n\t\t\t\t\t\t\t\tif (this._spec.video) {\n\t\t\t\t\t\t\t\t\tthis._videoType = 0;\n\t\t\t\t\t\t\t\t} else if (this._spec.screen) {\n\t\t\t\t\t\t\t\t\tthis._videoType = 1;\n\t\t\t\t\t\t\t\t} else if (this._mediaSourceVideo) {\n\t\t\t\t\t\t\t\t\tthis._videoType = 2;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tthis._videoSpec = {\n\t\t\t\t\t\t\t\t\twidth: {\n\t\t\t\t\t\t\t\t\t\tmin: config.videoSpec.width.min,\n\t\t\t\t\t\t\t\t\t\tideal: config.videoSpec.width.ideal,\n\t\t\t\t\t\t\t\t\t\tmax: config.videoSpec.width.max\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\theight: {\n\t\t\t\t\t\t\t\t\t\tmin: config.videoSpec.height.min,\n\t\t\t\t\t\t\t\t\t\tideal: config.videoSpec.height.ideal,\n\t\t\t\t\t\t\t\t\t\tmax: config.videoSpec.height.max\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tframeRate: {\n\t\t\t\t\t\t\t\t\t\tmin: config.videoSpec.frameRate.min,\n\t\t\t\t\t\t\t\t\t\tideal: config.videoSpec.frameRate.ideal,\n\t\t\t\t\t\t\t\t\t\tmax: config.videoSpec.frameRate.max\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tif (this._isMobile) {\n\t\t\t\t\t\t\t\t\tthis._videoSpec.facingMode = this._spec.useBackCam ? { exact: 'environment' } : 'user';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (this._spec.attributes) {\n\t\t\t\t\t\t\t\t\t// Obsolate the attribute.resolution field.\n\t\t\t\t\t\t\t\t\t// But Keep the attribute.resolution field for compatible less than 3.2.0 version's SDK.\n\t\t\t\t\t\t\t\t\tif (this._spec.attributes.resolution) {\n\t\t\t\t\t\t\t\t\t\tif (this._spec.attributes.resolution.toUpperCase() === 'HD720P') {\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.width.ideal = config.videoAttributes.hd720p[0];\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.height.ideal = config.videoAttributes.hd720p[1];\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (this._spec.attributes.resolution.toUpperCase() === 'VGA') {\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.width.ideal = config.videoAttributes.vga[0];\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.height.ideal = config.videoAttributes.vga[1];\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (this._spec.attributes.resolution.toUpperCase() === 'SIF') {\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.width.ideal = config.videoAttributes.sif[0];\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.height.ideal = config.videoAttributes.sif[1];\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (typeof this._spec.attributes.width !== 'undefined' && typeof this._spec.attributes.height !== 'undefined') {\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.width.ideal = this._spec.attributes.width;\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.height.ideal = this._spec.attributes.height;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (this._spec.attributes.minFrameRate && this._spec.attributes.maxFrameRate) {\n\t\t\t\t\t\t\t\t\t\tthis._videoSpec.frameRate.min = this._spec.attributes.minFrameRate;\n\t\t\t\t\t\t\t\t\t\tthis._videoSpec.frameRate.max = this._spec.attributes.maxFrameRate;\n\t\t\t\t\t\t\t\t\t\tif (typeof this._spec.attributes.idealFrameRate !== 'undefined') {\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.frameRate.ideal = this._spec.attributes.idealFrameRate;\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tthis._videoSpec.frameRate.ideal = Math.floor((this._spec.attributes.maxFrameRate - this._spec.attributes.minFrameRate) / 2 + this._spec.attributes.minFrameRate);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// leaveage the videoProfile filed from the 3.2.0 version.\n\t\t\t\t\t\t\t\t\tif (this._spec.attributes.videoProfile) {\n\t\t\t\t\t\t\t\t\t\tresolution = this._getResolutionByVideoProfile(this._spec.attributes.videoProfile);\n\n\t\t\t\t\t\t\t\t\t\tthis._videoSpec.width.ideal = resolution.width;\n\t\t\t\t\t\t\t\t\t\tthis._videoSpec.height.ideal = resolution.height;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Determine the audio | video | screen stream constrains.\n\n\t\t\t\t\t\t\t\tif (!(this._spec.video && this._spec.audio)) {\n\t\t\t\t\t\t\t\t\t_context3.next = 28;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/**has video and audio */\n\t\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\t\tvideo: this._videoSpec\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tif (this._spec.microphoneId && this._spec.microphoneId.trim() !== '') {\n\t\t\t\t\t\t\t\t\tconstraints.audio = {\n\t\t\t\t\t\t\t\t\t\tdeviceId: { exact: this._spec.microphoneId.trim() },\n\t\t\t\t\t\t\t\t\t\tsampleRate: config.audioSpec.sampleRate,\n\t\t\t\t\t\t\t\t\t\tchannelCount: config.audioSpec.channelCount\n\t\t\t\t\t\t\t\t\t\t// 记录设备ID\n\t\t\t\t\t\t\t\t\t};this._specialMicId = this._spec.microphoneId.trim();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t/*\r\n         constraints.audio = {\r\n         \taudio: true\r\n         \t// sampleRate: config.audioSpec.sampleRate,    // for compatibility\r\n         \t// channelCount: config.audioSpec.channelCount // for compatibility\r\n         }\r\n         */\n\t\t\t\t\t\t\t\t\tconstraints.audio = true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (this._spec.cameraId && this._spec.cameraId.trim() !== '') {\n\t\t\t\t\t\t\t\t\tconstraints.video.deviceId = { exact: this._spec.cameraId.trim() };\n\t\t\t\t\t\t\t\t\t// 记录 deviceId\n\t\t\t\t\t\t\t\t\tthis._specialCameraId = this._spec.cameraId.trim();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t_context3.next = 47;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 28:\n\t\t\t\t\t\t\t\tif (!(this._spec.audio && !this._spec.screen && !this._spec.video)) {\n\t\t\t\t\t\t\t\t\t_context3.next = 33;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/** only has audio*/\n\t\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\t\tvideo: false\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tif (this._spec.microphoneId && this._spec.microphoneId.trim() !== '') {\n\t\t\t\t\t\t\t\t\tconstraints.audio = {\n\t\t\t\t\t\t\t\t\t\tdeviceId: { exact: this._spec.microphoneId.trim() },\n\t\t\t\t\t\t\t\t\t\tsampleRate: config.audioSpec.sampleRate,\n\t\t\t\t\t\t\t\t\t\tchannelCount: config.audioSpec.channelCount\n\t\t\t\t\t\t\t\t\t\t// 记录设备ID\n\t\t\t\t\t\t\t\t\t};this._specialMicId = this._spec.microphoneId.trim();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t/*\r\n         constraints.audio = {\r\n         \taudio: true\r\n         \t// sampleRate: config.audioSpec.sampleRate,    // compatibility\r\n         \t// channelCount: config.audioSpec.channelCount // compatibility\r\n         }\r\n         */\n\t\t\t\t\t\t\t\t\tconstraints.audio = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t_context3.next = 47;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 33:\n\t\t\t\t\t\t\t\tif (!(this._spec.video && !this._spec.audio && !this._spec.screen)) {\n\t\t\t\t\t\t\t\t\t_context3.next = 38;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/** only has video */\n\t\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\t\taudio: false,\n\t\t\t\t\t\t\t\t\tvideo: this._videoSpec\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tif (this._spec.cameraId && this._spec.cameraId.trim() !== '') {\n\t\t\t\t\t\t\t\t\tconstraints.video.deviceId = { exact: this._spec.cameraId.trim() };\n\t\t\t\t\t\t\t\t\t// 记录 deviceId\n\t\t\t\t\t\t\t\t\tthis._specialCameraId = this._spec.cameraId.trim();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t_context3.next = 47;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 38:\n\t\t\t\t\t\t\t\tif (!this._spec.screen) {\n\t\t\t\t\t\t\t\t\t_context3.next = 47;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/** has screen */\n\t\t\t\t\t\t\t\tlatest_chrome = false;\n\n\t\t\t\t\t\t\t\tif (!(browser.name.toLowerCase() === 'chrome')) {\n\t\t\t\t\t\t\t\t\t_context3.next = 45;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (!(parseInt(browser.version, 10) >= 72)) {\n\t\t\t\t\t\t\t\t\t_context3.next = 45;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlatest_chrome = true;\n\t\t\t\t\t\t\t\t_context3.next = 45;\n\t\t\t\t\t\t\t\treturn this._startScreenCapture().then(function () {\n\t\t\t\t\t\t\t\t\tvar _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(s) {\n\t\t\t\t\t\t\t\t\t\tvar track;\n\t\t\t\t\t\t\t\t\t\treturn _regenerator2.default.wrap(function _callee$(_context) {\n\t\t\t\t\t\t\t\t\t\t\twhile (1) {\n\t\t\t\t\t\t\t\t\t\t\t\tswitch (_context.prev = _context.next) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this2._isLocalStream = true;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this2.streamObj = s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this2._screenStreamEnded(s);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this2._innerStreamID = Stream._getInnerStreamID(_this2.userID, _this2.userID, 0, _this2, _this2._isSubStream);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// if screen simultaneously go with audio track.\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!_this2._spec.audio) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context.next = 16;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context.prev = 5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context.next = 8;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn _this2._createAudioTrack(_this2._spec.microphoneId);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 8:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttrack = _context.sent;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this2.audioTracks = track; // 将 audio track 设置到 stream 中\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context.next = 16;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 12:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context.prev = 12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context.t0 = _context['catch'](5);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.error('API init() _startScreenCapture() error - _createAudioTrack fail. error: ' + (0, _stringify2.default)(_context.t0));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonFailure(_context.t0);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 16:\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('API init() _startScreenCapture() success - this.userID: ' + _this2.userID + ' this._innerStreamID: ' + _this2._innerStreamID);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSuccess();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 18:\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn _context.stop();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}, _callee, _this2, [[5, 12]]);\n\t\t\t\t\t\t\t\t\t}));\n\n\t\t\t\t\t\t\t\t\treturn function (_x3) {\n\t\t\t\t\t\t\t\t\t\treturn _ref2.apply(this, arguments);\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}()).catch(function (err) {\n\t\t\t\t\t\t\t\t\tlogger.error('API init() _startScreenCapture() error - screen capture error. error: ' + (0, _stringify2.default)(err));\n\t\t\t\t\t\t\t\t\treturn onFailure(err);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tcase 45:\n\n\t\t\t\t\t\t\t\tif (!latest_chrome) {\n\t\t\t\t\t\t\t\t\tgetScreenId(function (error, sourceId, screen_constraints) {\n\t\t\t\t\t\t\t\t\t\t// error    == null || 'permission-denied' || 'not-installed' || 'installed-disabled' || 'not-chrome'\n\t\t\t\t\t\t\t\t\t\t// sourceId == null || 'string' || 'firefox'\n\n\t\t\t\t\t\t\t\t\t\tif (sourceId !== 'firefox') {\n\t\t\t\t\t\t\t\t\t\t\tscreen_constraints = {\n\t\t\t\t\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tchromeMediaSource: 'screen',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxWidth: 1920,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxHeight: 1080,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tminAspectRatio: 1.77\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\tif (error === 'permission-denied') return alert('Permission is denied.');\n\t\t\t\t\t\t\t\t\t\t\tif (error === 'not-chrome') return alert('Please use chrome.');\n\n\t\t\t\t\t\t\t\t\t\t\tif (!error && sourceId) {\n\t\t\t\t\t\t\t\t\t\t\t\tscreen_constraints.video.mandatory.chromeMediaSource = 'desktop';\n\t\t\t\t\t\t\t\t\t\t\t\tscreen_constraints.video.mandatory.chromeMediaSourceId = sourceId;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tnavigator.getUserMedia = navigator.mozGetUserMedia || navigator.webkitGetUserMedia;\n\t\t\t\t\t\t\t\t\t\tnavigator.getUserMedia(screen_constraints, function () {\n\t\t\t\t\t\t\t\t\t\t\tvar _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(stream) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar track, tracks, videoTrack;\n\t\t\t\t\t\t\t\t\t\t\t\treturn _regenerator2.default.wrap(function _callee2$(_context2) {\n\t\t\t\t\t\t\t\t\t\t\t\t\twhile (1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tswitch (_context2.prev = _context2.next) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this2._isLocalStream = true;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this2.streamObj = stream;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this2._innerStreamID = Stream._getInnerStreamID(_this2.userID, _this2.userID, 0, _this2, _this2._isSubStream);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// if screen simultaneously go with audio track.\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!_this2._spec.audio) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.next = 15;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.prev = 4;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.next = 7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn _this2._createAudioTrack(_this2._spec.microphoneId);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 7:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttrack = _context2.sent;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this2.audioTracks = track; // 将 audio track 设置到 stream 中\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.next = 15;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 11:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.prev = 11;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_context2.t0 = _context2['catch'](4);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.error('API init() getScreenId() error - stream of screen init failed for obtain audio track. error: ' + _context2.t0.toString());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonFailure(_context2.t0);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 15:\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks = stream.getVideoTracks();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (tracks.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvideoTrack = tracks[0];\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (videoTrack) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvideoTrack.onended = function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('videoTrack.onended - streamId: ' + _this2.getId() + ' videoTrack.id: ' + videoTrack.id + ' - ' + e.toString());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('API init() getScreenId() success - this.userID: ' + _this2.userID + ' this._innerStreamID: ' + _this2._innerStreamID + ' screen_constraints: ' + (0, _stringify2.default)(screen_constraints));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// share this 'MediaStream' object using RTCPeerConnection API\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 19:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn _context2.stop();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}, _callee2, _this2, [[4, 11]]);\n\t\t\t\t\t\t\t\t\t\t\t}));\n\n\t\t\t\t\t\t\t\t\t\t\treturn function (_x4) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn _ref3.apply(this, arguments);\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t}(), function (error) {\n\t\t\t\t\t\t\t\t\t\t\tlogger.error('API init() getScreenId() error: ' + (0, _stringify2.default)(error) + ' -- constraints: ' + (0, _stringify2.default)(screen_constraints));\n\t\t\t\t\t\t\t\t\t\t\tonFailure(error);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}, this._spec.audio);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context3.abrupt('return');\n\n\t\t\t\t\t\t\tcase 47:\n\t\t\t\t\t\t\t\tif (!(this._spec.video || this._spec.audio)) {\n\t\t\t\t\t\t\t\t\t_context3.next = 53;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.debug('API init() this.userID: ' + this.userID + ' this._innerStreamID: ' + this._innerStreamID + ' constraints: ' + (0, _stringify2.default)(constraints));\n\n\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n\t\t\t\t\t\t\t\t\t_this2._isLocalStream = true;\n\n\t\t\t\t\t\t\t\t\tvar videoTracks = stream.getVideoTracks();\n\t\t\t\t\t\t\t\t\tvar audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\t\t\t\tif (audioTracks.length > 0) {\n\t\t\t\t\t\t\t\t\t\tif (!_this2._audioCtx) {\n\t\t\t\t\t\t\t\t\t\t\tvar audioContext = window.AudioContext || window.webkitAudioContext;\n\t\t\t\t\t\t\t\t\t\t\t_this2._audioCtx = new audioContext();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (!!_this2._audioCtx && !_this2._gainNode) {\n\t\t\t\t\t\t\t\t\t\t\t// 音量调节节点\n\t\t\t\t\t\t\t\t\t\t\t_this2._gainNode = _this2._audioCtx.createGain();\n\t\t\t\t\t\t\t\t\t\t\t_this2._gainNode.gain.value = 1;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (!!_this2._audioCtx && !!_this2._gainNode) {\n\t\t\t\t\t\t\t\t\t\t\tvar source = _this2._audioCtx.createMediaStreamSource(stream);\n\t\t\t\t\t\t\t\t\t\t\t_this2.target = _this2._audioCtx.createMediaStreamDestination();\n\t\t\t\t\t\t\t\t\t\t\tsource.connect(_this2._gainNode);\n\t\t\t\t\t\t\t\t\t\t\t_this2._gainNode.connect(_this2.target);\n\t\t\t\t\t\t\t\t\t\t\tif (videoTracks.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t_this2.target.stream.addTrack(videoTracks[0]);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t_this2.streamObj = _this2.target.stream;\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t_this2.streamObj = stream;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t_this2.streamObj = stream;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\tvar tracks = _this2.streamObj.getVideoTracks();\n\t\t\t\t\t\t\t\t\tif (tracks.length > 0) {\n\t\t\t\t\t\t\t\t\t\tvar videoTrack = tracks[0];\n\t\t\t\t\t\t\t\t\t\tif (videoTrack) {\n\t\t\t\t\t\t\t\t\t\t\tvideoTrack.onended = function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('videoTrack.onended - streamId: ' + _this2.getId() + ' videoTrack.id: ' + videoTrack.id + ' - ' + e.toString());\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// the inner stream id.\n\t\t\t\t\t\t\t\t\t_this2._innerStreamID = Stream._getInnerStreamID(_this2.userID, _this2.userID, 0, _this2, _this2._isSubStream);\n\t\t\t\t\t\t\t\t\tlogger.debug('API init() getUserMedia() success - this.userID: ' + _this2.userID + ' this._innerStreamID: ' + _this2._innerStreamID + ' constraints: ' + (0, _stringify2.default)(constraints));\n\n\t\t\t\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\t\t\t\tlogger.error('API init() getUserMedia() error - ' + err.toString() + ' -- constraints: ' + (0, _stringify2.default)(constraints));\n\t\t\t\t\t\t\t\t\tonFailure(err);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\treturn _context3.abrupt('return');\n\n\t\t\t\t\t\t\tcase 53:\n\t\t\t\t\t\t\t\tif (!(this._mediaSourceAudio || this._mediaSourceVideo)) {\n\t\t\t\t\t\t\t\t\t_context3.next = 57;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t_constraints = {\n\t\t\t\t\t\t\t\t\taudio: true,\n\t\t\t\t\t\t\t\t\tvideo: false\n\t\t\t\t\t\t\t\t};\n\n\n\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia(_constraints).then(function (stream) {\n\t\t\t\t\t\t\t\t\t_this2._isLocalStream = true;\n\n\t\t\t\t\t\t\t\t\tvar videoTracks = stream.getVideoTracks();\n\t\t\t\t\t\t\t\t\tif (videoTracks.length > 0) {\n\t\t\t\t\t\t\t\t\t\tvar videoTrack = videoTracks[0];\n\t\t\t\t\t\t\t\t\t\tif (videoTrack) {\n\t\t\t\t\t\t\t\t\t\t\tvideoTrack.onended = function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug('videoTrack.onended - streamId: ' + _this2.getId() + ' videoTrack.id: ' + videoTrack.id + ' - ' + e.toString());\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tvar audioTracks = stream.getAudioTracks();\n\n\t\t\t\t\t\t\t\t\tvar oldTrack = null;\n\t\t\t\t\t\t\t\t\tif (audioTracks.length > 0) {\n\t\t\t\t\t\t\t\t\t\toldTrack = audioTracks[0];\n\t\t\t\t\t\t\t\t\t\tstream.removeTrack(oldTrack);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\tif (!!_this2._audioSource) {\n\t\t\t\t\t\t\t\t\t\tstream.addTrack(_this2._audioSource);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (!!_this2._videoSource) {\n\t\t\t\t\t\t\t\t\t\tstream.addTrack(_this2._videoSource);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t_this2.streamObj = stream;\n\n\t\t\t\t\t\t\t\t\t// the inner stream id.\n\t\t\t\t\t\t\t\t\t_this2._innerStreamID = Stream._getInnerStreamID(_this2.userID, _this2.userID, 0, _this2, _this2._isSubStream);\n\t\t\t\t\t\t\t\t\tlogger.debug('API init() getUserMedia() for [mediasource] success - this.userID: ' + _this2.userID + ' this._innerStreamID: ' + _this2._innerStreamID + ' constraints: ' + (0, _stringify2.default)(_constraints));\n\n\t\t\t\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t\t\t\t}).catch(function (e) {\n\t\t\t\t\t\t\t\t\tlogger.error('API init() getUserMedia() for [mediasource] error - ' + e.toString() + ' -- constraints: ' + (0, _stringify2.default)(_constraints));\n\t\t\t\t\t\t\t\t\tonFailure(e);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\treturn _context3.abrupt('return');\n\n\t\t\t\t\t\t\tcase 57:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context3.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee3, this);\n\t\t\t}));\n\n\t\t\tfunction init(_x, _x2) {\n\t\t\t\treturn _ref.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn init;\n\t\t}()\n\n\t\t/**\r\n   * Only obtain audio track.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: '_createAudioTrack',\n\t\tvalue: function _createAudioTrack(microphoneId) {\n\t\t\tvar _this3 = this;\n\n\t\t\tif (!this._isLocalStream) return _promise2.default.reject('non-localStream');\n\n\t\t\tlogger.debug('_createAudioTrack() - microphoneId: ' + microphoneId + ' this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\t// only obtain audio stream.\n\t\t\tvar constraints = {\n\t\t\t\tvideo: false\n\t\t\t};\n\n\t\t\tif (!!microphoneId && microphoneId.trim() !== '') {\n\t\t\t\tthis._spec.microphoneId = microphoneId.trim();\n\n\t\t\t\tconstraints.audio = {\n\t\t\t\t\tdeviceId: { exact: this._spec.microphoneId },\n\t\t\t\t\tsampleRate: config.audioSpec.sampleRate,\n\t\t\t\t\tchannelCount: config.audioSpec.channelCount\n\t\t\t\t\t// 记录设备ID\n\t\t\t\t};this._specialMicId = this._spec.microphoneId;\n\t\t\t} else {\n\t\t\t\t/*\r\n    constraints.audio = {\r\n    \taudio: true\r\n    \t// sampleRate: config.audioSpec.sampleRate,    // for compatibility\r\n    \t// channelCount: config.audioSpec.channelCount // for compatibility\r\n    }\r\n    */\n\t\t\t\tconstraints.audio = true;\n\t\t\t}\n\n\t\t\tnavigator.getUserMedia = navigator.mozGetUserMedia || navigator.webkitGetUserMedia;\n\t\t\treturn new _promise2.default(function (resolve, reject) {\n\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n\t\t\t\t\tif (!_this3._audioCtx) {\n\t\t\t\t\t\tvar audioContext = window.AudioContext || window.webkitAudioContext;\n\t\t\t\t\t\t_this3._audioCtx = new audioContext();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!!_this3._audioCtx && !_this3._gainNode) {\n\t\t\t\t\t\t// 音量调节节点\n\t\t\t\t\t\t_this3._gainNode = _this3._audioCtx.createGain();\n\t\t\t\t\t\t_this3._gainNode.gain.value = 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!!_this3._audioCtx && !!_this3._gainNode) {\n\t\t\t\t\t\tvar source = _this3._audioCtx.createMediaStreamSource(stream);\n\t\t\t\t\t\t_this3.target = _this3._audioCtx.createMediaStreamDestination();\n\t\t\t\t\t\tsource.connect(_this3._gainNode);\n\t\t\t\t\t\t_this3._gainNode.connect(_this3.target);\n\n\t\t\t\t\t\tvar track = _this3.target.stream.getAudioTracks()[0];\n\n\t\t\t\t\t\tresolve(track);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar _track = stream.getAudioTracks()[0];\n\t\t\t\t\t\tresolve(_track);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\tlogger.warn('_createAudioTrack() getUserMedia faile - ' + error.toString() + ' -- constraints: ' + (0, _stringify2.default)(constraints));\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\r\n   * \r\n   */\n\n\t}, {\n\t\tkey: '_createScreenVideoTrack',\n\t\tvalue: function _createScreenVideoTrack() {\n\t\t\t;\n\t\t}\n\n\t\t/**\r\n      * Only obtain video stream.\r\n   * \r\n   * @param {string} cameraId \r\n   */\n\n\t}, {\n\t\tkey: '_createCameraVideoTrack',\n\t\tvalue: function _createCameraVideoTrack(cameraId) {\n\t\t\tvar _this4 = this;\n\n\t\t\tif (!this._isLocalStream) return _promise2.default.reject('non-localStream');\n\n\t\t\tlogger.debug('_createCameraVideoTrack() - cameraId: ' + cameraId + ' this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\t// only obtain audio stream.\n\t\t\tvar constraints = {\n\t\t\t\taudio: false,\n\t\t\t\tvideo: this._videoSpec\n\t\t\t};\n\n\t\t\tif (!!cameraId && cameraId.trim() !== '') {\n\t\t\t\tthis._spec.cameraId = cameraId.trim();\n\n\t\t\t\tconstraints.video.deviceId = { exact: this._spec.cameraId };\n\t\t\t\t// 记录 deviceId\n\t\t\t\tthis._specialCameraId = this._spec.cameraId;\n\t\t\t}\n\n\t\t\tnavigator.getUserMedia = navigator.mozGetUserMedia || navigator.webkitGetUserMedia;\n\t\t\treturn new _promise2.default(function (resolve, reject) {\n\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n\t\t\t\t\t// \n\t\t\t\t\tvar tracks = stream.getVideoTracks();\n\t\t\t\t\tif (tracks.length > 0) {\n\t\t\t\t\t\tvar videoTrack = tracks[0];\n\t\t\t\t\t\tif (videoTrack) {\n\t\t\t\t\t\t\tvideoTrack.onended = function (e) {\n\t\t\t\t\t\t\t\tlogger.debug('videoTrack.onended - streamId: ' + _this4.getId() + ' videoTrack.id: ' + videoTrack.id + ' - ' + e.toString());\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tresolve(videoTrack);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject('no video track');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject('no video track');\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\tlogger.warn('_createCameraVideoTrack() getUserMedia fail - ' + error.toString() + ' -- constraints: ' + (0, _stringify2.default)(constraints));\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_speechEvents',\n\n\n\t\t/**\r\n   * @private\r\n   * \r\n   * @param {Any} stream \r\n   */\n\t\tvalue: function _speechEvents(stream) {\n\t\t\tvar _this5 = this;\n\n\t\t\tif (!this._audioCtx) {\n\t\t\t\tvar audioContext = window.AudioContext || window.webkitAudioContext;\n\t\t\t\tthis._audioCtx = new audioContext();\n\t\t\t}\n\n\t\t\tif (!this._audioCtx) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._speach = new hark(stream, {\n\t\t\t\tthreshold: -65,\n\t\t\t\taudioContext: this._audioCtx\n\t\t\t});\n\n\t\t\tthis._speach.on('volume_change', function (volume, threshold) {\n\t\t\t\tif (volume < threshold) _this5._volume = 0;else {\n\t\t\t\t\t_this5._volume = Math.round((volume - threshold) * -100 / threshold); // 0 ~ 100 间取值\n\t\t\t\t\tif (_this5._volume > 100) {\n\t\t\t\t\t\t_this5._volume = 100;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this5.emit('volume-change', {\n\t\t\t\t\tuserID: _this5.userID,\n\t\t\t\t\tvolume: _this5._volume\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis._speach.on('speaking', function () {\n\t\t\t\t_this5.emit('speaking', { userID: _this5.userID });\n\t\t\t});\n\n\t\t\tthis._speach.on('stopped_speaking', function () {\n\t\t\t\t_this5._volume = 0;\n\t\t\t\t// \n\t\t\t\t_this5.emit('stopped-speaking', { userID: _this5.userID });\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'attachAudioTracks',\n\t\tvalue: function attachAudioTracks(opts) {\n\t\t\tvar track = opts.track,\n\t\t\t    autoPlay = opts.autoPlay;\n\n\n\t\t\tif (!track) {\n\t\t\t\tlogger.error('API attachAudioTracks() error - parameter track is NULL');\n\t\t\t\treturn new TypeError('track');\n\t\t\t}\n\n\t\t\tif (track.kind !== 'audio') {\n\t\t\t\tlogger.error('API attachAudioTracks() error - parameter track.kind is node audio');\n\t\t\t\treturn new TypeError('track is not audio kind');\n\t\t\t}\n\n\t\t\tlogger.debug('API attachAudioTracks() - autoPlay: ' + autoPlay + ' this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\tif (this._streamObj !== null) {\n\t\t\t\t// TODO : remove old audioTrack\n\t\t\t\tvar tracks = this._streamObj.getAudioTracks();\n\t\t\t\tif (tracks.length > 0) {\n\t\t\t\t\tvar oldTrack = tracks[0];\n\t\t\t\t\tthis._streamObj.removeTrack(oldTrack);\n\t\t\t\t}\n\n\t\t\t\tthis._streamObj.addTrack(track);\n\t\t\t} else {\n\t\t\t\tlogger.error('API attachAudioTracks() error - this._streamObj is NULL');\n\t\t\t\tthrow new Error('stream object is null.');\n\t\t\t}\n\n\t\t\tthis._speechEvents(this._streamObj);\n\n\t\t\tif (!!this._video) {\n\t\t\t\tthis._video.srcObject = this._streamObj;\n\t\t\t} else {\n\t\t\t\t// logger.error('API attachAudioTracks() error - this._video is NULL');\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Set audio tracks for consumer -- remote audio stream.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'getId',\n\n\n\t\t/**\r\n   * Get stream id.\r\n   * \r\n   * @public\r\n   */\n\t\tvalue: function getId() {\n\t\t\tif (this._isLocalStream) return this._innerStreamID;else {\n\t\t\t\treturn this._customStreamID;\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Get attributes.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'getAttributes',\n\t\tvalue: function getAttributes() {}\n\n\t\t/**\r\n   * Get audio volume\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'getAudioLevel',\n\t\tvalue: function getAudioLevel() {\n\t\t\treturn this._volume;\n\t\t}\n\n\t\t/**\r\n   * Check has video track.\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'hasVideo',\n\t\tvalue: function hasVideo() {\n\t\t\t// checking video presence\n\t\t\tif (this._streamObj === null) return false;\n\n\t\t\treturn this._streamObj.getVideoTracks().length > 0;\n\t\t}\n\n\t\t/**\r\n   * Check has audio track.\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'hasAudio',\n\t\tvalue: function hasAudio() {\n\t\t\t// checking audio presence\n\t\t\tif (this._streamObj === null) return false;\n\n\t\t\treturn this._streamObj.getAudioTracks().length > 0;\n\t\t}\n\n\t\t// \n\n\t}, {\n\t\tkey: 'attachWebcamProducer',\n\t\tvalue: function attachWebcamProducer(producer) {\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API attachWebcamProducer() error - this is not local stream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// TODO : 以 map 管理？\n\t\t\tthis._webcamProducer = producer;\n\t\t}\n\t}, {\n\t\tkey: 'detachWebcamProducer',\n\t\tvalue: function detachWebcamProducer(producer) {\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API detachWebcamProducer() error - this is not local stream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._webcamProducer = null;\n\t\t}\n\n\t\t// \n\n\t}, {\n\t\tkey: 'attachMicProducer',\n\t\tvalue: function attachMicProducer(producer) {\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API attachMicProducer() error - this is not local stream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// TODO : 以 map 管理？\n\t\t\tthis._micProducer = producer;\n\t\t}\n\t}, {\n\t\tkey: 'detachMicProducer',\n\t\tvalue: function detachMicProducer(producer) {\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API detachMicProducer() error - this is not local stream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._micProducer = null;\n\t\t}\n\t}, {\n\t\tkey: 'switchDevice',\n\n\n\t\t/**\r\n   * \r\n   * @param {string} type - 'audio' | 'video'\r\n   * @param {string} deviceId \r\n   * @param {function} onSuccess \r\n   * @param {function} onFailure \r\n   */\n\t\tvalue: function switchDevice(type, deviceId, onSuccess, onFailure) {\n\t\t\tvar _this6 = this;\n\n\t\t\tlogger.debug('API switchDevice() type: ' + type + ' deviceId: ' + deviceId);\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.warn('API switchDevice() error - onSuccess have to be a function.');\n\t\t\t\tthrow TypeError('onSuccess have to be a function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.warn('API switchDevice() error - onFailure have to be a function.');\n\t\t\t\tthrow TypeError('onFailure have to be a function.');\n\t\t\t}\n\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API switchDevice() error - this is not local stream');\n\n\t\t\t\tonFailure('non-localStream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!deviceId || deviceId.trim() == '') {\n\t\t\t\tlogger.warn('API switchDevice() error - deviceId is invalid');\n\n\t\t\t\tonFailure('parameter deviceId is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (type !== 'audio' && type !== 'video') {\n\t\t\t\tlogger.warn('API switchDevice() error - type must be [audio|video]');\n\n\t\t\t\tonFailure('parameter type is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar devId = deviceId.trim();\n\n\t\t\tif (type === 'audio') {\n\t\t\t\tthis._closeMic().then(function () {\n\t\t\t\t\treturn _this6._openMic(devId);\n\t\t\t\t}).then(function () {\n\t\t\t\t\tlogger.debug('API switchDevice() succ - type: ' + type + ' devId: ' + devId);\n\n\t\t\t\t\tonSuccess();\n\t\t\t\t}).catch(function (e) {\n\t\t\t\t\tlogger.warn('API switchDevice() fail - type: ' + type + ' devId: ' + devId + ' - ' + e.toString());\n\n\t\t\t\t\tonFailure(e.toString());\n\t\t\t\t});\n\t\t\t} else if (type === 'video') {\n\t\t\t\tthis._closeCamera().then(function () {\n\t\t\t\t\treturn _this6._openCamera(devId);\n\t\t\t\t}).then(function () {\n\t\t\t\t\tlogger.debug('API switchDevice() succ - type: ' + type + ' devId: ' + devId);\n\n\t\t\t\t\tonSuccess();\n\t\t\t\t}).catch(function (e) {\n\t\t\t\t\tlogger.warn('API switchDevice() fail - type: ' + type + ' devId: ' + devId + ' - ' + e.toString());\n\n\t\t\t\t\tonFailure(e.toString());\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tonFailure('invalid type: ' + type);\n\t\t\t}\n\t\t}\n\n\t\t// 仅当为本地流时\n\n\t}, {\n\t\tkey: '_openCamera',\n\t\tvalue: function _openCamera(cameraId) {\n\t\t\tvar _this7 = this;\n\n\t\t\tif (this.videoType !== 0) // 非 camera\n\t\t\t\t{\n\t\t\t\t\t// 也应 resolve，以便外部流程正常执行\n\t\t\t\t\treturn _promise2.default.resolve(); // \n\t\t\t\t}\n\t\t\t// 只有当 调用过 stream._closeCamera ，才需要调用 stream._openCamera\n\t\t\tif (!this.isVideoTrackClosed) {\n\t\t\t\tlogger.debug('_openCamera() - lack the conditions - this.isVideoTrackClosed: ' + this.isVideoTrackClosed);\n\n\t\t\t\t// 也应 resolve，以便外部流程正常执行\n\t\t\t\treturn _promise2.default.resolve(); // Promise.reject(new Error('lack the conditions'));\n\t\t\t}\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('_openCamera() error - non-localStream');\n\n\t\t\t\treturn _promise2.default.reject(new Error('non-localStream'));\n\t\t\t}\n\n\t\t\t// \n\t\t\treturn _promise2.default.resolve().then((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4() {\n\t\t\t\tvar track;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee4$(_context4) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context4.prev = _context4.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\ttrack = null;\n\n\t\t\t\t\t\t\t\tif (!(_this7.videoType === 0)) {\n\t\t\t\t\t\t\t\t\t_context4.next = 7;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t_context4.next = 4;\n\t\t\t\t\t\t\t\treturn _this7._createCameraVideoTrack(!!cameraId && cameraId.trim() !== '' ? cameraId : _this7._spec.cameraId);\n\n\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\ttrack = _context4.sent;\n\t\t\t\t\t\t\t\t_context4.next = 11;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 7:\n\t\t\t\t\t\t\t\tif (!(_this7.videoType === 1)) {\n\t\t\t\t\t\t\t\t\t_context4.next = 11;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t_context4.next = 10;\n\t\t\t\t\t\t\t\treturn _this7._createScreenVideoTrack();\n\n\t\t\t\t\t\t\tcase 10:\n\t\t\t\t\t\t\t\ttrack = _context4.sent;\n\n\t\t\t\t\t\t\tcase 11:\n\t\t\t\t\t\t\t\t_this7.videoTracks = track;\n\n\t\t\t\t\t\t\t\t_this7._isVideoTrackClosed = false;\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tlogger.debug('_openCamera() localStream - streamId: ' + _this7.getId());\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tif (!!_this7._webcamProducer) {\n\t\t\t\t\t\t\t\t\t_this7._webcamProducer.replaceTrack(track);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context4.abrupt('return', _promise2.default.resolve(track));\n\n\t\t\t\t\t\t\tcase 16:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context4.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee4, _this7);\n\t\t\t}))).catch(function (e) {\n\t\t\t\tlogger.debug('_openCamera() fail - ' + e.toString());\n\t\t\t\treturn _promise2.default.reject(e);\n\t\t\t});\n\t\t}\n\n\t\t// 仅当为本地camera流时\n\n\t}, {\n\t\tkey: '_closeCamera',\n\t\tvalue: function _closeCamera() {\n\t\t\tvar _this8 = this;\n\n\t\t\tif (this.videoType !== 0) // 非 camera\n\t\t\t\t{\n\t\t\t\t\t// 也应 resolve，以便外部流程正常执行\n\t\t\t\t\treturn _promise2.default.resolve(); // \n\t\t\t\t}\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('_closeCamera() error - non-localStream');\n\t\t\t\treturn _promise2.default.reject(new Error('non-localStream'));\n\t\t\t}\n\n\t\t\tif (this._streamObj === null) return _promise2.default.reject(new Error('stream._streamObj is null'));\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!!_this8._streamObj) {\n\t\t\t\t\t_this8._streamObj.getVideoTracks().forEach(function (track) {\n\t\t\t\t\t\tlogger.debug('_closeCamera() track.stop - streamId: ' + _this8.getId() + ' kind: ' + track.kind + ' id: ' + track.id);\n\t\t\t\t\t\ttrack.stop();\n\t\t\t\t\t\t_this8._streamObj.removeTrack(track);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\t_this8._isVideoTrackClosed = true;\n\n\t\t\t\t// \n\t\t\t\tlogger.debug('_closeCamera() localStream - streamId: ' + _this8.getId());\n\n\t\t\t\t// \n\t\t\t\tif (!!_this8._webcamProducer) {\n\t\t\t\t\t_this8._webcamProducer.stopTrack();\n\t\t\t\t}\n\n\t\t\t\treturn _promise2.default.resolve();\n\t\t\t}).catch(function (e) {\n\t\t\t\treturn _promise2.default.reject(e);\n\t\t\t});\n\t\t}\n\n\t\t// 仅当为本地流时\n\n\t}, {\n\t\tkey: '_openMic',\n\t\tvalue: function _openMic(microphoneId) {\n\t\t\tvar _this9 = this;\n\n\t\t\t// \n\t\t\tif (!this._spec.audio) // 如果本流并非 mic，则直接 reject\n\t\t\t\t{\n\t\t\t\t\tlogger.warn('_openMic() error - not mic stream');\n\n\t\t\t\t\treturn _promise2.default.reject(new Error('not mic stream'));\n\t\t\t\t}\n\t\t\t// 只有当 调用过 stream._closeMic ，才需要调用 stream._openMic\n\t\t\tif (!this.isMicClosed) {\n\t\t\t\tlogger.warn('_openMic() error - lack the conditions - this.isMicClosed: ' + this.isMicClosed);\n\n\t\t\t\treturn _promise2.default.reject(new Error('lack the conditions'));\n\t\t\t}\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('_openMic() error - non-localStream');\n\n\t\t\t\treturn _promise2.default.reject(new Error('non-localStream'));\n\t\t\t}\n\n\t\t\t// \n\t\t\treturn _promise2.default.resolve().then((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5() {\n\t\t\t\tvar track;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee5$(_context5) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context5.prev = _context5.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t_context5.next = 2;\n\t\t\t\t\t\t\t\treturn _this9._createAudioTrack(!!microphoneId && microphoneId.trim() !== '' ? microphoneId : _this9._spec.microphoneId);\n\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\ttrack = _context5.sent;\n\n\t\t\t\t\t\t\t\t_this9.audioTracks = track;\n\n\t\t\t\t\t\t\t\t_this9._isMicClosed = false;\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tlogger.debug('_openMic() localStream - streamId: ' + _this9.getId());\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tif (!!_this9._micProducer) {\n\t\t\t\t\t\t\t\t\t_this9._micProducer.replaceTrack(track);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context5.abrupt('return', _promise2.default.resolve(track));\n\n\t\t\t\t\t\t\tcase 8:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context5.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee5, _this9);\n\t\t\t}))).catch(function (e) {\n\t\t\t\treturn _promise2.default.reject(e);\n\t\t\t});\n\t\t}\n\n\t\t// 仅当为本地流时\n\n\t}, {\n\t\tkey: '_closeMic',\n\t\tvalue: function _closeMic() {\n\t\t\tvar _this10 = this;\n\n\t\t\t// \n\t\t\tif (!this._spec.audio) // 如果本流并非 mic，则直接 reject\n\t\t\t\t{\n\t\t\t\t\tlogger.warn('_closeMic() error - not mic stream');\n\n\t\t\t\t\treturn _promise2.default.reject(new Error('not mic stream'));\n\t\t\t\t}\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('_closeMic() error - non-localStream');\n\t\t\t\treturn _promise2.default.reject(new Error('non-localStream'));\n\t\t\t}\n\n\t\t\tif (this._streamObj === null) return _promise2.default.reject(new Error('stream._streamObj is null'));\n\n\t\t\treturn _promise2.default.resolve().then(function () {\n\t\t\t\tif (!!_this10._streamObj) {\n\t\t\t\t\t_this10._streamObj.getAudioTracks().forEach(function (track) {\n\t\t\t\t\t\tlogger.debug('_closeMic() track.stop - streamId: ' + _this10.getId() + ' kind: ' + track.kind + ' id: ' + track.id);\n\t\t\t\t\t\ttrack.stop();\n\t\t\t\t\t\t_this10._streamObj.removeTrack(track);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\t_this10._isMicClosed = true;\n\n\t\t\t\t// \n\t\t\t\tlogger.debug('_closeMic() localStream - streamId: ' + _this10.getId());\n\n\t\t\t\t// \n\t\t\t\tif (!!_this10._micProducer) {\n\t\t\t\t\t_this10._micProducer.stopTrack();\n\t\t\t\t}\n\n\t\t\t\treturn _promise2.default.resolve();\n\t\t\t}).catch(function (e) {\n\t\t\t\treturn _promise2.default.reject(e);\n\t\t\t});\n\t\t}\n\n\t\t/**\r\n   * Enable video track.\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'enableVideo',\n\t\tvalue: function enableVideo() {\n\t\t\tvar _this11 = this;\n\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API enableVideo() error - non-localStream');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API enableVideo() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\t\t\tif (this._published) {\n\t\t\t\t/*\r\n    if (!!global.g_client)\r\n    {\r\n    \tglobal.g_client.resumeWebcam(this);\r\n    }\r\n    else\r\n    {\r\n    \tlogger.warn('API enableVideo() error - global.g_client is NULL');\r\n    }\r\n    */\n\n\t\t\t\tthis.emit('resume-video', { stream: this });\n\t\t\t}\n\t\t\t// \n\t\t\tif (this._video) {\n\t\t\t\ttry {\n\t\t\t\t\tthis._video.play().then(function () {\n\t\t\t\t\t\tlogger.debug('API enableVideo() this._video.play() succ - this._userId: ' + _this11._userId + ' this._innerStreamID: ' + _this11._innerStreamID);\n\t\t\t\t\t}).catch(function (e) {\n\t\t\t\t\t\tlogger.warn('API enableVideo() this._video.play() fail - ' + e.toString() + ' - this._userId: ' + _this11._userId + ' this._innerStreamID: ' + _this11._innerStreamID);\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlogger.warn('API enableVideo() - video.play() fail - ' + e.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Disable video track.\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'disableVideo',\n\t\tvalue: function disableVideo() {\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API disableVideo() error - non-localStream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._published) {\n\t\t\t\tlogger.debug('API disableVideo() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\t\t/*\r\n    if (!!global.g_client)\r\n    {\r\n    \tglobal.g_client.pauseWebcam(this);\r\n    }\r\n    else\r\n    {\r\n    \tlogger.warn('API disableVideo() error - global.g_client is NULL');\r\n    }\r\n    */\n\t\t\t\tthis.emit('pause-video', { stream: this });\n\t\t\t}\n\t\t\t// \n\t\t\tif (this._video) {\n\t\t\t\tthis._video.pause();\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Enable audio track.\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'enableAudio',\n\t\tvalue: function enableAudio() {\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API enableAudio() error - non-localStream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API enableAudio() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\t\t\tif (this._published) {\n\t\t\t\t/*\r\n    if (!!global.g_client)\r\n    {\r\n    \tglobal.g_client.resumeMic(this);\r\n    }\r\n    else\r\n    {\r\n    \tlogger.warn('API enableAudio() error - global.g_client is NULL');\r\n    }\r\n    */\n\t\t\t\tthis.emit('resume-audio', { stream: this });\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Disable audio track.\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'disableAudio',\n\t\tvalue: function disableAudio() {\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API disableAudio() error - non-localStream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API disableAudio() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\tif (this._published) {\n\t\t\t\t/*\r\n    if (!!global.g_client)\r\n    {\r\n    \tglobal.g_client.pauseMic(this);\r\n    }\r\n    else\r\n    {\r\n    \tlogger.warn('API disableAudio() error - global.g_client is NULL');\r\n    }\r\n    */\n\t\t\t\tthis.emit('pause-audio', { stream: this });\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'enableVideoAndAudio',\n\t\tvalue: function enableVideoAndAudio() {\n\t\t\tvar _this12 = this;\n\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API enableVideoAndAudio() error - non-localStream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API enableVideoAndAudio() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\tif (this._published) {\n\t\t\t\t/*\r\n    if (!!global.g_client)\r\n    {\r\n    \tglobal.g_client.resumeMic();\r\n    \tglobal.g_client.resumeWebcam(this);\r\n    }\r\n    else\r\n    {\r\n    \tlogger.warn('API enableVideoAndAudio() error - global.g_client is NULL');\r\n    }\r\n    */\n\t\t\t\tthis.emit('resume-audio', { stream: this });\n\t\t\t\tthis.emit('resume-video', { stream: this });\n\t\t\t}\n\t\t\t// \n\t\t\tif (this._video) {\n\t\t\t\ttry {\n\t\t\t\t\tthis._video.play().then(function () {\n\t\t\t\t\t\tlogger.debug('API enableVideoAndAudio() this._video.play() succ - this._userId: ' + _this12._userId + ' this._innerStreamID: ' + _this12._innerStreamID);\n\t\t\t\t\t}).catch(function (e) {\n\t\t\t\t\t\tlogger.warn('API enableVideoAndAudio() this._video.play() fail - ' + e.toString() + ' - this._userId: ' + _this12._userId + ' this._innerStreamID: ' + _this12._innerStreamID);\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlogger.warn('API enableVideoAndAudio() - video.play() fail - ' + e.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'disableVideoAndAudio',\n\t\tvalue: function disableVideoAndAudio() {\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API disableVideoAndAudio() error - non-localStream');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API disableVideoAndAudio() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\tif (this._published) {\n\t\t\t\t/*\r\n    if (!!global.g_client)\r\n    {\r\n    \tglobal.g_client.pauseMic(this);\r\n    \tglobal.g_client.pauseWebcam(this);\r\n    }\r\n    else\r\n    {\r\n    \tlogger.warn('API disableVideoAndAudio() error - global.g_client is NULL');\r\n    }\r\n    */\n\t\t\t\tthis.emit('pause-audio', { stream: this });\n\t\t\t\tthis.emit('pause-video', { stream: this });\n\t\t\t}\n\t\t\t// \n\t\t\tif (this._video) {\n\t\t\t\tthis._video.pause();\n\t\t\t}\n\t\t}\n\n\t\t// \n\t\t// profile : 音频 profile\n\t\t// 取值 : 'speech_low_quality' | 'speech_standard' | 'music_standard' | 'standard_stereo' | 'high_quality' | 'high_quality_stereo'\n\n\t}, {\n\t\tkey: 'setAudioProfile',\n\t\tvalue: function setAudioProfile(profile) {\n\t\t\tvar isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\t\t\tif (isSafari && profile === 'isac32') {\n\t\t\t\tprofile = 'music_standard';\n\t\t\t}\n\n\t\t\tvar audioProfile = config.audioProfileSpec.get(profile);\n\t\t\tthis._audioProfile = !audioProfile ? null : audioProfile;\n\n\t\t\t// \n\t\t\tlogger.debug('API setAudioProfile() profile: ' + profile + ' ' + (0, _stringify2.default)(this._audioProfile));\n\t\t}\n\n\t\t// \n\n\t}, {\n\t\tkey: 'getAudioProfile',\n\t\tvalue: function getAudioProfile() {\n\t\t\treturn this._audioProfile;\n\t\t}\n\n\t\t/**\r\n   * Set video profile.\r\n   * \r\n   * @public\r\n   * @param {string} videoProfile defined in the config.js.\r\n   * @param {function} onSuccess \r\n   * @param {function} onFailure \r\n   * @param {Any} codecOptions   \r\n   *   {\r\n   *       startBitrate: @type {number},\r\n   *       maxBitrate: @type {number},\r\n   *       minBitrate: @type {number}\r\n   *   }\r\n   */\n\n\t}, {\n\t\tkey: 'setVideoProfile',\n\t\tvalue: function setVideoProfile(videoProfile, onSuccess, onFailure) {\n\t\t\tvar _this13 = this;\n\n\t\t\tvar codecOptions = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.warn('API setVideoProfile() error - onSuccess have to be a function.');\n\t\t\t\tthrow TypeError('onSuccess have to be a function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.warn('API setVideoProfile() error - onFailure have to be a function.');\n\t\t\t\tthrow TypeError('onFailure have to be a function.');\n\t\t\t}\n\n\t\t\tif (!this._isLocalStream) {\n\t\t\t\tlogger.warn('API setVideoProfile() error - non-localStream');\n\t\t\t\tonFailure('only local stream can set video profile.');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('API setVideoProfile() - this._userId: ' + this._userId + ' videoProfile: ' + videoProfile + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\t// check parames.\n\t\t\tif (this._streamObj === null) {\n\t\t\t\tlogger.warn('API setVideoProfile() error - stream is null, please init it at first.');\n\t\t\t\tonFailure('stream is null, please init it at first.');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar tracks = this._streamObj.getVideoTracks();\n\t\t\tif (tracks.length <= 0) {\n\t\t\t\tlogger.warn('API setVideoProfile() error - no video track.');\n\n\t\t\t\tonFailure('no video track.');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (codecOptions) {\n\t\t\t\tif (!codecOptions.minBandwidth || !codecOptions.maxBandwidth || !codecOptions.startBitrate) {\n\t\t\t\t\tlogger.wanr('API setVideoProfile() error - codecOptions parameters invalid.');\n\t\t\t\t\tthrow TypeError(codecOptions);\n\t\t\t\t}\n\n\t\t\t\tif (typeof codecOptions.minBandwidth !== 'number' || typeof codecOptions.maxBandwidth !== 'number' || typeof codecOptions.startBitrate !== 'number') {\n\t\t\t\t\tlogger.warn('API setVideoProfile() error - codecOptions parameters invalid.');\n\t\t\t\t\tthrow TypeError(codecOptions);\n\t\t\t\t}\n\n\t\t\t\tif (codecOptions.minBandwidth >= codecOptions.maxBandwidth) {\n\t\t\t\t\tlogger.warn('API setVideoProfile() error - codecOptions parameters invalid.');\n\t\t\t\t\tthrow TypeError('minBandwidth > = maxBandwidth');\n\t\t\t\t}\n\n\t\t\t\tthis._spec.codecOptions = codecOptions;\n\t\t\t}\n\n\t\t\tvar track = tracks[0];\n\t\t\tvar constraints = void 0;\n\t\t\tvar resolution = this._getResolutionByVideoProfile(videoProfile);\n\t\t\tvar in_width = resolution.width;\n\t\t\tvar in_height = resolution.height;\n\t\t\tconstraints = {\n\t\t\t\twidth: in_width,\n\t\t\t\theight: in_height\n\t\t\t\t// aspectRatio: 3 / 2\n\t\t\t};\n\n\t\t\ttrack.applyConstraints(constraints).then(function () {\n\t\t\t\tlogger.debug('API setVideoProfile() track.applyConstraints ok -- constraints: ' + (0, _stringify2.default)(constraints));\n\n\t\t\t\t// this.replaceTrack(track);\n\n\t\t\t\t// \n\t\t\t\t_this13._videoSetting = track.getSettings();\n\t\t\t\t_this13._setKeyResolution(track);\n\n\t\t\t\tif (_this13._published) {\n\t\t\t\t\t/*\r\n     if (!!global.g_client)\r\n     {\r\n     \tglobal.g_client._updateVideoTrack(this, track, constraints);\r\n     }\r\n     else\r\n     {}\r\n     */\n\t\t\t\t\tif (!!_this13._webcamProducer) {\n\t\t\t\t\t\t// Hard resetting track especial bandwidth.\n\t\t\t\t\t\t_this13._webcamProducer.updateTrack(track, constraints, {\n\t\t\t\t\t\t\tidealBandwidth: _this13.idealBandwidth,\n\t\t\t\t\t\t\tmaxBandwidth: _this13.maxBandwidth,\n\t\t\t\t\t\t\tminBandwidth: _this13.minBandwidth\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t_this13._updateConstraints = constraints;\n\t\t\t\t\t_this13._needUpdateVideoStreamBitrate = true;\n\t\t\t\t}\n\t\t\t\t// \n\n\t\t\t\tonSuccess('applyConstraint success');\n\t\t\t}).catch(function (err) {\n\t\t\t\t//\n\t\t\t\tlogger.warn('API setVideoProfile() error - track.applyConstraints failed - ' + err.toString());\n\n\t\t\t\tonFailure(err);\n\t\t\t});\n\t\t}\n\n\t\t/**\r\n   * Get video profile.\r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'getVideoProfile',\n\t\tvalue: function getVideoProfile() {\n\t\t\tif (!this._streamObj) {\n\t\t\t\tlogger.error('API getVideoProfile() error - this._streamObj is NULL');\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tvar mediaTracks = this._streamObj.getVideoTracks();\n\t\t\tif (mediaTracks.length <= 0) {\n\t\t\t\tlogger.error('API getVideoProfile() error - getVideoProfile: no video track');\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tvar setting = mediaTracks[0].getSettings();\n\t\t\tvar resoultion = {\n\t\t\t\twidth: setting.width,\n\t\t\t\theight: setting.height\n\t\t\t};\n\n\t\t\tlogger.debug('API getVideoProfile() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID + ' resoultion: ' + (0, _stringify2.default)(resoultion));\n\n\t\t\treturn resoultion;\n\t\t}\n\n\t\t/**\r\n   * Set screen profile.\r\n   * TODO.\r\n   */\n\n\t}, {\n\t\tkey: 'setScreenProfile',\n\t\tvalue: function setScreenProfile() {}\n\n\t\t/**\r\n   * \r\n   * @param {string} deviceId  speaker deviceId -- audiooutput\r\n   * @param {function} onSuccess  成功回调\r\n   * @param {function} onFailure  失败回调\r\n   */\n\n\t}, {\n\t\tkey: 'setAudioOutput',\n\t\tvalue: function setAudioOutput(deviceId, onSuccess, onFailure) {\n\t\t\tlogger.debug('API setAudioOutput() deviceId: ' + deviceId);\n\n\t\t\tif (typeof onSuccess !== 'function') {\n\t\t\t\tlogger.warn('API setAudioOutput() error - onSuccess have to be a function.');\n\t\t\t\tthrow TypeError('onSuccess have to be a function.');\n\t\t\t}\n\n\t\t\tif (typeof onFailure !== 'function') {\n\t\t\t\tlogger.warn('API setAudioOutput() error - onFailure have to be a function.');\n\t\t\t\tthrow TypeError('onFailure have to be a function.');\n\t\t\t}\n\n\t\t\tif (!deviceId || deviceId.trim() == '') {\n\t\t\t\tonFailure('parameter deviceId is invalid');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar devId = deviceId.trim();\n\n\t\t\tif (this.type === 'audio') {\n\t\t\t\tif (!this._audio) {\n\t\t\t\t\tlogger.debug('API setAudioOutput() fail - no audio tag');\n\t\t\t\t\tonFailure('no audio tag');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\tthis._audio.setSinkId(devId).then(function () {\n\t\t\t\t\tlogger.debug('Audio output device attached: ' + devId);\n\t\t\t\t\tonSuccess('Audio output device attached: ' + devId);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\tlogger.debug('Audio output device attached fail - ' + error.toString());\n\t\t\t\t\tonFailure('Audio output device attached faile - ' + error.toString());\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (!this._video) {\n\t\t\t\t\tlogger.debug('API setAudioOutput() fail - no video tag');\n\t\t\t\t\tonFailure('no video tag');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\tthis._video.setSinkId(devId).then(function () {\n\t\t\t\t\tlogger.debug('Audio output device attached: ' + devId);\n\t\t\t\t\tonSuccess('Audio output device attached: ' + devId);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\tlogger.debug('Audio output device attached faile - ' + error.toString());\n\t\t\t\t\tonFailure('Audio output device attached faile - ' + error.toString());\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Play stream.\r\n   * \r\n   * @public\r\n   * @param {string} elementID. video|audio tag id\r\n   * @param {string} assetsURL\r\n  * @param {boolen} isControls show control panel \r\n   */\n\n\t}, {\n\t\tkey: 'play',\n\t\tvalue: function play(elementID, isControls, assetsURL) {\n\t\t\tvar _this14 = this;\n\n\t\t\tlogger.debug('API play() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID + ' this.type: ' + this.type);\n\n\t\t\tif (!this._streamObj) {\n\t\t\t\tlogger.error('API play() error - stream is NULL.');\n\t\t\t\tthrow Error('stream is null, please init it at first.');\n\t\t\t}\n\n\t\t\tif (this.type === 'audio') {\n\t\t\t\tif (!this._audio) {\n\t\t\t\t\tthis._audio = new Audio();\n\t\t\t\t\t// \n\t\t\t\t\tif (!this._isLocalStream) {\n\t\t\t\t\t\t// TODO : 1. 对 _audioCtx 应调整为全局，整个应用中只有一个 AudioContext 实例\n\t\t\t\t\t\t// TODO : 2. 音视频流同样也需要 AudioContext -- 目前音视频流时，没有 AudioContext 对象，所以无法控制音量\n\t\t\t\t\t\tif (!this._audioCtx) {\n\t\t\t\t\t\t\tvar audioContext = window.AudioContext || window.webkitAudioContext;\n\t\t\t\t\t\t\tthis._audioCtx = new audioContext();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!!this._audioCtx && !this._gainNode) {\n\t\t\t\t\t\t\t// 音量调节节点\n\t\t\t\t\t\t\tthis._gainNode = this._audioCtx.createGain();\n\t\t\t\t\t\t\tthis._gainNode.gain.value = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// \n\t\t\t\t\t\tthis._audio.onloadedmetadata = function () {\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\tlogger.debug('API play() - this._audio.onloadedmetadata. will connect to GainNode - this._userId: ' + _this14._userId + ' this._innerStreamID: ' + _this14._innerStreamID);\n\n\t\t\t\t\t\t\tif (!!_this14._audioCtx && !!_this14._gainNode) {\n\t\t\t\t\t\t\t\tvar source = _this14._audioCtx.createMediaStreamSource(_this14._streamObj);\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t_this14._audio.play().then(function () {\n\t\t\t\t\t\t\t\t\t\tlogger.debug('API play() this._audio.play() succ - this._userId: ' + _this14._userId + ' this._innerStreamID: ' + _this14._innerStreamID + ' this.type: ' + _this14.type);\n\t\t\t\t\t\t\t\t\t}).catch(function (e) {\n\t\t\t\t\t\t\t\t\t\tlogger.warn('API play() this._audio.play() fail - ' + e.toString() + ' - this._userId: ' + _this14._userId + ' this._innerStreamID: ' + _this14._innerStreamID + ' this.type: ' + _this14.type);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\tlogger.warn('API play() - audio.play() fail - ' + e.toString());\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t_this14._audio.muted = true; // 必须设置为 true，如此 音量控制才可生效\n\n\t\t\t\t\t\t\t\tsource.connect(_this14._gainNode);\n\t\t\t\t\t\t\t\t_this14._gainNode.connect(_this14._audioCtx.destination);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._audio.srcObject = this._streamObj;\n\t\t\t\t}\n\n\t\t\t\t/*\r\n    if (!this._audio)\r\n    {\r\n    \treturn;\r\n    }\r\n    this._audio.muted = false;\r\n    this._audio.play();\r\n    */\n\t\t\t} else {\n\t\t\t\tthis._video = document.getElementById(elementID);\n\t\t\t\tif (!this._video) {\n\t\t\t\t\tlogger.error('API play() error - Not found video -- id: ' + elementID + '.');\n\t\t\t\t\tthrow Error('video id can not find ' + elementID);\n\t\t\t\t}\n\n\t\t\t\tif (!this._streamObj.active) {\n\t\t\t\t\tlogger.debug('API play() - stream active is false');\n\t\t\t\t}\n\n\t\t\t\t// TODO : this._video.muted = Boolean(this._audio);\n\t\t\t\t// \n\t\t\t\tthis._video.muted = Boolean(this._isLocalStream) || Boolean(this._audio);\n\t\t\t\tthis._video.autoplay = true;\n\t\t\t\tthis._video.controls = !!isControls; // false;\n\t\t\t\tthis._video.playsinline = true;\n\t\t\t\tthis._video.srcObject = this._streamObj;\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Stop stream.\r\n   */\n\n\t}, {\n\t\tkey: 'stopPlay',\n\t\tvalue: function stopPlay(elementID) {\n\t\t\tif (this.type === 'audio') {\n\t\t\t\tif (!this._audio) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._audio.muted = true;\n\t\t\t\tthis._audio.pause();\n\t\t\t} else {\n\t\t\t\tthis._video = document.getElementById(elementID);\n\t\t\t\tif (!this._video) {\n\t\t\t\t\tlogger.error('API stopPlay() error - Not found video -- id: ' + elementID + '.');\n\t\t\t\t\tthrow Error('video id can not find ' + elementID);\n\t\t\t\t}\n\n\t\t\t\tthis._video.muted = true;\n\t\t\t\tthis._video.pause();\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Close stream.\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tlogger.debug('API close() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\tif (this._closed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._streamObj) {\n\t\t\t\tlogger.error('API close() error - stream is null, please init it at first.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// TODO : 对 stream 增加 类型（producer、consumer）\n\t\t\t/*\r\n   let client = window.g_client;\r\n   if (client)\r\n   {\r\n   \tlet micProducer = client._mapMicProducers.get(this._innerStreamID),\r\n   \t\twebcamProducer = client._mapWebcamProducers.get(this._innerStreamID);\r\n   \tif (micProducer)\r\n   \t\tmicProducer.pause(); // \r\n   \tif (webcamProducer)\r\n   \t\twebcamProducer.close();\r\n   }\r\n   */\n\t\t\tif (!!this._webcamProducer) {\n\t\t\t\tthis._webcamProducer.close();\n\t\t\t}\n\t\t\tif (!!this._micProducer) {\n\t\t\t\tthis._micProducer.pause();\n\t\t\t}\n\n\t\t\tthis._streamObj.getTracks().forEach(function (track) {\n\t\t\t\treturn track.stop();\n\t\t\t});\n\t\t\tthis._streamObj = null;\n\n\t\t\tthis.removeAllListeners();\n\t\t\t// S_STREAM_MAP.delete(this._innerStreamID);\n\t\t\tthis._closed = true;\n\n\t\t\tif (this._video) {\n\t\t\t\tthis._video.srcObject = null;\n\t\t\t}\n\t\t\tthis._gainNode = null;\n\n\t\t\t//stream.stop() was deprecated.\n\t\t\t//ref: https://stackoverflow.com/questions/34966809/stop-kill-webrtc-media-stream\n\t\t}\n\n\t\t/**\r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: '_startScreenCapture',\n\t\tvalue: function _startScreenCapture() {\n\t\t\tvar videoConstraints = {\n\t\t\t\taspectRatio: config.screenSpec.s_1080p.maxAspectRatio,\n\t\t\t\t// 'deviceId': 'screen:0:0',\n\t\t\t\tframeRate: config.screenSpec.s_frameRate,\n\t\t\t\theight: config.screenSpec.s_1080p.maxHeight,\n\t\t\t\tresizeMode: 'crop-and-scale',\n\t\t\t\twidth: config.screenSpec.s_1080p.maxWidth,\n\t\t\t\tcursor: 'always'\n\t\t\t\t// 'displaySurface': 'monitor',\n\t\t\t\t// logicalSurface: true\n\t\t\t};\n\n\t\t\tvar displayMediaStreamConstraints = {\n\t\t\t\tvideo: videoConstraints\n\t\t\t};\n\n\t\t\tif (navigator.getDisplayMedia) {\n\t\t\t\treturn navigator.getDisplayMedia(displayMediaStreamConstraints);\n\t\t\t} else if (navigator.mediaDevices.getDisplayMedia) {\n\t\t\t\treturn navigator.mediaDevices.getDisplayMedia(displayMediaStreamConstraints);\n\t\t\t} else if (navigator.mediaDevices.getUserMedia) {\n\t\t\t\treturn navigator.mediaDevices.getUserMedia({ video: { mediaSource: 'screen' } });\n\t\t\t} else {\n\t\t\t\tnavigator.getUserMedia = navigator.webkitGetUserMedia || navigator.getUserMedia;\n\t\t\t\treturn new _promise2.default(function (resolve, reject) {\n\t\t\t\t\tif (!navigator.getUserMedia) {\n\t\t\t\t\t\tlogger.warn('_startScreenCapture() fail - unsupported navigator.getUserMedia');\n\t\t\t\t\t\treject('unsupported navigator.getUserMedia');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnavigator.getUserMedia({\n\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\t\tchromeMediaSource: 'screen'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} }, function (success) {\n\t\t\t\t\t\t\tresolve(success);\n\t\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * event: stream track ended.\r\n   *\r\n  * 注：暂未使用\r\n   * @private\r\n   * @param {Any} track \r\n   */\n\n\t}, {\n\t\tkey: '_streamEnded',\n\t\tvalue: function () {\n\t\t\tvar _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6(stream) {\n\t\t\t\tvar _this15 = this;\n\n\t\t\t\tvar track;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee6$(_context6) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context6.prev = _context6.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t_context6.next = 2;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context6.abrupt('return');\n\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\ttrack = stream.getVideoTracks()[0];\n\n\t\t\t\t\t\t\t\tif (track) {\n\t\t\t\t\t\t\t\t\t_context6.next = 5;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context6.abrupt('return');\n\n\t\t\t\t\t\t\tcase 5:\n\n\t\t\t\t\t\t\t\ttrack.onended = function (e) {\n\t\t\t\t\t\t\t\t\tlogger.debug('_streamEnded() track.onended - streamId: ' + _this15.getId() + ' ' + e.toString() + ' - Emit [stream-close]');\n\n\t\t\t\t\t\t\t\t\t_this15.emit('stream-close', { streamId: _this15.streamID, stream: _this15 });\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tcase 6:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context6.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee6, this);\n\t\t\t}));\n\n\t\t\tfunction _streamEnded(_x6) {\n\t\t\t\treturn _ref6.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn _streamEnded;\n\t\t}()\n\n\t\t/**\r\n   * End stream(of screen) track.\r\n   *\r\n   * @private\r\n   * @param {Any} track \r\n   */\n\n\t}, {\n\t\tkey: '_screenStreamEnded',\n\t\tvalue: function () {\n\t\t\tvar _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7(stream) {\n\t\t\t\tvar _this16 = this;\n\n\t\t\t\tvar track;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee7$(_context7) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context7.prev = _context7.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t_context7.next = 2;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context7.abrupt('return');\n\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\ttrack = stream.getVideoTracks()[0];\n\n\t\t\t\t\t\t\t\tif (track) {\n\t\t\t\t\t\t\t\t\t_context7.next = 5;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn _context7.abrupt('return');\n\n\t\t\t\t\t\t\tcase 5:\n\n\t\t\t\t\t\t\t\ttrack.onended = function (e) {\n\t\t\t\t\t\t\t\t\tlogger.debug('_screenStreamEnded() track.onended - streamId: ' + _this16.getId() + ' ' + e.toString() + ' - Emit [screen-close]');\n\n\t\t\t\t\t\t\t\t\t_this16.emit('screen-close', { streamId: _this16.streamID, stream: _this16 });\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tcase 6:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context7.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee7, this);\n\t\t\t}));\n\n\t\t\tfunction _screenStreamEnded(_x7) {\n\t\t\t\treturn _ref7.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn _screenStreamEnded;\n\t\t}()\n\n\t\t/**\r\n   * Take a photo for your playing stream.\r\n   * \r\n   * @public\r\n   * @param {String} retType return type of base64|file\r\n   * @param {String} filename\r\n   * @param {Function} onSuccess the sucess call back.\r\n   */\n\n\t}, {\n\t\tkey: 'capture',\n\t\tvalue: function capture(retType) {\n\t\t\tvar filename = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new Date().toISOString().replace(/[-:TZ.]/g, '') + this._customStreamID;\n\t\t\tvar onSuccess = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new Function();\n\n\t\t\tlogger.debug('API capture() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\tif (!this._streamObj) {\n\t\t\t\tlogger.error('API capture() error - this._streamObj is NULL.');\n\t\t\t\tthrow Error('stream is null, please init it at first.');\n\t\t\t}\n\t\t\tif (!this._video) {\n\t\t\t\tlogger.error('API capture() error - this._video is NULL.');\n\t\t\t\tthrow Error('this stream has not be played: ' + this._streamObj);\n\t\t\t}\n\t\t\tif (!/[\\\\\\/\\*\\:\\<\\>\\|\\?\\\"]/g.test(filename) && filename.length > 255) {\n\t\t\t\tlogger.error('API capture() error - illegal filename.');\n\t\t\t\tthrow Error('illegal filename ');\n\t\t\t}\n\n\t\t\tvar canvas = document.createElement('canvas');\n\t\t\tcanvas.width = this._video.videoWidth;\n\t\t\tcanvas.height = this._video.videoHeight;\n\t\t\tvar context = canvas.getContext('2d');\n\t\t\tcontext.drawImage(this._video, 0, 0, canvas.width, canvas.height);\n\n\t\t\tif (retType === 'file') {\n\t\t\t\tcanvas.toBlob(function (blob) {\n\t\t\t\t\tonSuccess(new File([blob], filename + '.jpeg', { type: 'image/jpeg' }));\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tonSuccess(canvas.toDataURL('image/jpeg'));\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * 调节音量\r\n   * @param {number} volume 音量 [0, 1.5]    0 ----------------> 1 ----------------> 1.5\r\n   *                                        静音                正常                 增大\r\n   */\n\n\t}, {\n\t\tkey: 'setAudioVolume',\n\t\tvalue: function setAudioVolume(volume) {\n\t\t\tif (typeof volume !== 'number') {\n\t\t\t\tlogger.warn('API setAudioVolume() TypeError - volume: ' + volume);\n\t\t\t\treturn; // throw TypeError('Wrong arguments: volume must be number.');\n\t\t\t}\n\t\t\tif (!this._gainNode) {\n\t\t\t\tlogger.warn('API setAudioVolume() error - no gainNode existed.');\n\t\t\t\treturn; // throw Error('setAudioVolume() error - no gainNode existed.');\n\t\t\t}\n\n\t\t\tif (volume < 0) {\n\t\t\t\tvolume = 0;\n\t\t\t} else if (volume > 1.5) {\n\t\t\t\tvolume = 1.5;\n\t\t\t}\n\t\t\tthis._gainNode.gain.value = volume;\n\t\t\tlogger.debug('API setAudioVolume() success - volume: ' + volume);\n\t\t}\n\n\t\t/**\r\n   * 调节输入音量\r\n   * @param {number} volume 音量 [0, 1.5]    0 ----------------> 1 ----------------> 1.5\r\n   *                                        静音                正常                 增大\r\n   */\n\n\t}, {\n\t\tkey: 'setInputVolume',\n\t\tvalue: function setInputVolume(volume) {\n\t\t\tif (typeof volume !== 'number') {\n\t\t\t\tlogger.warn('API setInputVolume() TypeError - volume: ' + volume);\n\t\t\t\tthrow TypeError('Wrong arguments: volume must be number.');\n\t\t\t}\n\t\t\tif (!this._gainNode) {\n\t\t\t\tlogger.warn('API setInputVolume() error - no gainNode existed.');\n\t\t\t\tthrow Error('setInputVolume() error - no gainNode existed.');\n\t\t\t}\n\t\t\tif (volume < 0) {\n\t\t\t\tvolume = 0;\n\t\t\t} else if (volume > 1.5) {\n\t\t\t\tvolume = 1.5;\n\t\t\t}\n\t\t\tthis._gainNode.gain.value = volume;\n\t\t\tlogger.debug('API setInputVolume() success - volume: ' + volume);\n\t\t}\n\n\t\t/**\r\n   * @public\r\n   * @param {Any} track \r\n   */\n\n\t}, {\n\t\tkey: 'addTrack',\n\t\tvalue: function addTrack(track) {}\n\t\t// TODO.\n\n\n\t\t/**\r\n   * @public\r\n   * @param {Any} track \r\n   */\n\n\t}, {\n\t\tkey: 'removeTrack',\n\t\tvalue: function removeTrack(track) {}\n\t\t// TODO.\n\n\n\t\t/**\r\n   * Replace old track with new track.\r\n   * \r\n  * \r\n   * @public\r\n   * @param {MediaStreamTrack} track\r\n   */\n\n\t}, {\n\t\tkey: 'replaceTrack',\n\t\tvalue: function () {\n\t\t\tvar _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee8(track) {\n\t\t\t\tvar tracks, oldTrack;\n\t\t\t\treturn _regenerator2.default.wrap(function _callee8$(_context8) {\n\t\t\t\t\twhile (1) {\n\t\t\t\t\t\tswitch (_context8.prev = _context8.next) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\tlogger.debug('API replaceTrack() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\t\t\t\t\t\tif (track) {\n\t\t\t\t\t\t\t\t\t_context8.next = 4;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlogger.warn('API replaceTrack() error - parameter [trank] is INVALID.');\n\t\t\t\t\t\t\t\tthrow TypeError('track');\n\n\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\ttracks = null;\n\t\t\t\t\t\t\t\toldTrack = null;\n\t\t\t\t\t\t\t\t_context8.t0 = track.kind;\n\t\t\t\t\t\t\t\t_context8.next = _context8.t0 === 'video' ? 9 : _context8.t0 === 'audio' ? 17 : 18;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 9:\n\t\t\t\t\t\t\t\ttracks = this._streamObj.getVideoTracks();\n\t\t\t\t\t\t\t\toldTrack = tracks[0];\n\t\t\t\t\t\t\t\tthis._streamObj.removeTrack(oldTrack);\n\t\t\t\t\t\t\t\tthis.videoTracks = track;\n\n\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\tthis._videoSetting = track.getSettings();\n\t\t\t\t\t\t\t\tthis._setKeyResolution(track);\n\n\t\t\t\t\t\t\t\t/*\r\n        if (!!global.g_client)\r\n        {\r\n        \tawait global.g_client._replaceTrack(this, track);\r\n        }\r\n        else\r\n        {\r\n        \tlogger.error('API replaceTrack() error - global.g_client is NULL.');\r\n        }\r\n        */\n\t\t\t\t\t\t\t\tthis._webcamProducer.replaceTrack(track);\n\t\t\t\t\t\t\t\t// \n\n\t\t\t\t\t\t\t\treturn _context8.abrupt('break', 19);\n\n\t\t\t\t\t\t\tcase 17:\n\t\t\t\t\t\t\t\tthrow TypeError('Cannot support audio track replace now.');\n\n\t\t\t\t\t\t\tcase 18:\n\t\t\t\t\t\t\t\tthrow TypeError('track have no audio or video.');\n\n\t\t\t\t\t\t\tcase 19:\n\t\t\t\t\t\t\tcase 'end':\n\t\t\t\t\t\t\t\treturn _context8.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, _callee8, this);\n\t\t\t}));\n\n\t\t\tfunction replaceTrack(_x10) {\n\t\t\t\treturn _ref8.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn replaceTrack;\n\t\t}()\n\n\t\t/**\r\n   * Properties of audio tracks\r\n   * autoGainControl\r\n   * channelCount\r\n   * echoCancellation\r\n   * latency\r\n   * noiseSuppression\r\n   * sampleRate\r\n   * sampleSize\r\n   * volume\r\n   * \r\n   * Properties of video tracks\r\n   * aspectRatio\r\n   * facingMode\r\n   * {\r\n   *  'user'\r\n   *  'environment'\r\n   *  'left'\r\n   *  'right'\r\n   * }\r\n   * frameRate\r\n   * height\r\n   * width\r\n   * resizeMode\r\n   * {\r\n   *  'none'\r\n   *  'crop-and-scale'\r\n   * }\r\n   * \r\n   * Properties of shared screen tracks\r\n   * cursor\r\n   * {\r\n   *  always\r\n   *  motion\r\n   *  never\r\n   * }\r\n   * displaySurface\r\n   * {\r\n   *  application\r\n   *  browser\r\n   *  monitor\r\n   *  window\r\n   * }\r\n   * logicalSurface\r\n   * \r\n   * More detail information about it please Reference below links.\r\n   * 1: https://www.w3.org/TR/webrtc/#mediatracksupportedconstraints-mediatrackcapabilities-mediatrackconstraints-and-mediatracksettings\r\n   * 2: https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackSettings\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'getVideoTrackSettings',\n\t\tvalue: function getVideoTrackSettings() {\n\t\t\treturn this._videoSetting;\n\t\t}\n\n\t\t/**\r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'getAudioTrackSetting',\n\t\tvalue: function getAudioTrackSetting() {\n\t\t\treturn this._audioSetting;\n\t\t}\n\n\t\t/**\r\n   * The video(track) width normalize.\r\n   * \r\n   * @private\r\n   * @param {MediaStreamTrack} track\r\n   */\n\n\t}, {\n\t\tkey: '_setKeyResolution',\n\t\tvalue: function _setKeyResolution(track) {\n\t\t\tif (!track) throw new TypeError('track');\n\n\t\t\tif (track.kind !== 'video') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar setting = track.getSettings();\n\n\t\t\tif (setting.height <= 80) {\n\t\t\t\tthis._keyResolution = 80;\n\t\t\t} else if (setting.height > 80 && setting.height <= 120) {\n\t\t\t\tthis._keyResolution = 120;\n\t\t\t} else if (setting.height > 120 && setting.height <= 160) {\n\t\t\t\tthis._keyResolution = 160;\n\t\t\t} else if (setting.height > 160 && setting.height <= 200) {\n\t\t\t\tthis._keyResolution = 200;\n\t\t\t} else if (setting.height > 200 && setting.height <= 240) {\n\t\t\t\tthis._keyResolution = 240;\n\t\t\t} else if (setting.height > 240 && setting.height <= 320) {\n\t\t\t\tthis._keyResolution = 320;\n\t\t\t} else if (setting.height > 320 && setting.height <= 360) {\n\t\t\t\tthis._keyResolution = 360;\n\t\t\t} else if (setting.height > 360 && setting.height <= 480) {\n\t\t\t\tthis._keyResolution = 480;\n\t\t\t} else if (setting.height > 480 && setting.height <= 540) {\n\t\t\t\tthis._keyResolution = 540;\n\t\t\t} else if (setting.height > 480 && setting.height <= 720) {\n\t\t\t\tthis._keyResolution = 720;\n\t\t\t} else if (setting.height > 720 && setting.height <= 1080) {\n\t\t\t\tthis._keyResolution = 1080;\n\t\t\t} else if (setting.height > 1080 && setting.height <= 1920) {\n\t\t\t\tthis._keyResolution = 1920;\n\t\t\t} else if (setting.height > 1920) {\n\t\t\t\tthis._keyResolution = 1920;\n\t\t\t} else {\n\t\t\t\tthis._keyResolution = 480;\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Get ideal bandwidth.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: '_getResolutionByVideoProfile',\n\n\n\t\t/**\r\n   * Get video resolution by video's profile.\r\n   * \r\n   * @private\r\n   * @param {string} profile REF: config.js: videoProfile variable. \r\n   */\n\t\tvalue: function _getResolutionByVideoProfile(profile) {\n\t\t\tif (!profile) {\n\t\t\t\tthrow TypeError('profile');\n\t\t\t}\n\n\t\t\tvar resolution = { width: 0, height: 0\n\t\t\t\t// The default resolution is 480p.\n\t\t\t};var in_width = 640;\n\t\t\tvar in_height = 480;\n\t\t\tvar s_in_height = void 0,\n\t\t\t    s_in_width = void 0;\n\t\t\tvar _videoProfile = profile.toLowerCase();\n\t\t\tswitch (_videoProfile) {\n\t\t\t\tcase config.videoProfile.Profile_80p:\n\t\t\t\tcase config.videoProfile.Profile_120p:\n\t\t\t\tcase config.videoProfile.Profile_160p:\n\t\t\t\tcase config.videoProfile.Profile_200p:\n\t\t\t\tcase config.videoProfile.Profile_240p:\n\t\t\t\tcase config.videoProfile.Profile_320p:\n\t\t\t\tcase config.videoProfile.Profile_360p:\n\t\t\t\tcase config.videoProfile.Profile_480p:\n\t\t\t\tcase config.videoProfile.Profile_540p:\n\t\t\t\tcase config.videoProfile.Profile_720p:\n\t\t\t\tcase config.videoProfile.Profile_1080p:\n\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\ts_in_height = _videoProfile.slice(0, -1);\n\t\t\t\t\tin_height = parseInt(s_in_height, 10);\n\t\t\t\t\tin_width = config.videoResolution.get(in_height).width;\n\t\t\t\t\tbreak;\n\t\t\t\tcase config.videoProfile.Profile_3840p:\n\t\t\t\tcase config.videoProfile.Profile_7680p:\n\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\ts_in_width = _videoProfile.slice(0, -1);\n\t\t\t\t\tin_width = parseInt(s_in_width, 10);\n\t\t\t\t\tin_height = config.videoResolution.get(in_width).height;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tlogger.warn('Resolution params error - Using default resolution 640*480. Profile ref: ' + (0, _stringify2.default)(config.videoProfile));\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tresolution.width = in_width;\n\t\t\tresolution.height = in_height;\n\t\t\treturn resolution;\n\t\t}\n\t}, {\n\t\tkey: 'streamObj',\n\n\n\t\t/**\r\n   * @private\r\n   */\n\t\tset: function set(streamObj) {\n\t\t\tthis._streamObj = streamObj;\n\t\t\tif (!streamObj) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Obtain some setting of tracks if is local stream.\n\t\t\tif (this._isLocalStream) {\n\t\t\t\tvar tracks = this.videoTracks;\n\t\t\t\tif (tracks.length > 0) {\n\t\t\t\t\tvar videoTrack = tracks[0];\n\t\t\t\t\tthis._videoSetting = videoTrack.getSettings();\n\t\t\t\t\tthis._setKeyResolution(videoTrack);\n\t\t\t\t}\n\n\t\t\t\ttracks = this.audioTracks;\n\t\t\t\tif (tracks.length > 0) {\n\t\t\t\t\tvar audioTrack = tracks[0];\n\t\t\t\t\tthis._audioSetting = audioTrack.getSettings();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// hark can be created only have audio tracks.\n\t\t\tif (streamObj.getAudioTracks().length > 0) {\n\t\t\t\tthis._speechEvents(streamObj);\n\t\t\t}\n\t\t},\n\n\n\t\t/**\r\n   * Get stream object property\r\n   * \r\n   * @private\r\n   */\n\t\tget: function get() {\n\t\t\treturn this._streamObj;\n\t\t}\n\t}, {\n\t\tkey: 'isLocalStream',\n\t\tget: function get() {\n\t\t\treturn this._isLocalStream;\n\t\t}\n\t}, {\n\t\tkey: 'streamType',\n\t\tget: function get() {\n\t\t\treturn this._streamType;\n\t\t}\n\t}, {\n\t\tkey: 'specialCameraId',\n\t\tget: function get() {\n\t\t\treturn this._specialCameraId;\n\t\t}\n\t}, {\n\t\tkey: 'specialMicId',\n\t\tget: function get() {\n\t\t\treturn this._specialMicId;\n\t\t}\n\n\t\t/**\r\n   * Set stream identity property.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'streamID',\n\t\tset: function set(id) {\n\t\t\tthis._customStreamID = id;\n\t\t}\n\n\t\t/**\r\n   * Get stream identity property.\r\n   * \r\n   * @private\r\n   * \r\n   * stream id is unique identity of stream.\r\n   */\n\t\t,\n\t\tget: function get() {\n\t\t\treturn this._customStreamID;\n\t\t}\n\n\t\t/**\r\n   * Set user identity property.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'userID',\n\t\tset: function set(id) {\n\t\t\tthis._userId = id;\n\t\t}\n\n\t\t/**\r\n   * Get user identity property.\r\n   * @private\r\n   * \r\n   * user id represent witch belong to peer(user). \r\n   */\n\t\t,\n\t\tget: function get() {\n\t\t\treturn this._userId;\n\t\t}\n\n\t\t/**\r\n   * Get inner stream identity property.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'innerStreamID',\n\t\tget: function get() {\n\t\t\tif (this._innerStreamID === '') {\n\t\t\t\tthis._innerStreamID = Stream._getInnerStreamID(this._userId, this.streamID, 0, this, this._isSubStream);\n\t\t\t}\n\n\t\t\treturn this._innerStreamID;\n\t\t}\n\t}, {\n\t\tkey: 'audioTracks',\n\t\tset: function set(track) {\n\t\t\tlogger.debug('API audioTracks() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\t// \n\t\t\tthis.attachAudioTracks({\n\t\t\t\ttrack: track,\n\t\t\t\tautoPlay: false\n\t\t\t});\n\t\t}\n\n\t\t/**\r\n   * Set video tracks property.\r\n   * \r\n   * @private\r\n   */\n\t\t,\n\n\n\t\t/**\r\n   * Get audio tracks property.\r\n   * \r\n   * @private\r\n   */\n\t\tget: function get() {\n\t\t\tif (!this._streamObj) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this._streamObj.getAudioTracks();\n\t\t}\n\n\t\t/**\r\n   * Get video tracks property.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'videoTracks',\n\t\tset: function set(track) {\n\t\t\tlogger.debug('API videoTracks() - this._userId: ' + this._userId + ' this._innerStreamID: ' + this._innerStreamID);\n\n\t\t\tif (!track) {\n\t\t\t\tlogger.error('API videoTracks() error - parameter track is NULL');\n\t\t\t\treturn new TypeError('track');\n\t\t\t}\n\n\t\t\tif (track.kind !== 'video') {\n\t\t\t\tlogger.error('API videoTracks() error - parameter track.kind is node video');\n\t\t\t\treturn new TypeError('track is not video kind');\n\t\t\t}\n\t\t\tif (this._streamObj !== null) {\n\t\t\t\tvar tracks = this._streamObj.getVideoTracks();\n\t\t\t\tif (tracks.length > 0) {\n\t\t\t\t\tvar oldTrack = tracks[0];\n\t\t\t\t\t//\n\t\t\t\t\toldTrack.stop();\n\t\t\t\t\tthis._streamObj.removeTrack(oldTrack);\n\t\t\t\t}\n\t\t\t\t// \n\t\t\t\tthis._streamObj.addTrack(track);\n\t\t\t} else {\n\t\t\t\tlogger.error('API videoTracks() error - this._streamObj is NULL');\n\t\t\t\tthrow new Error('stream object is null.');\n\t\t\t}\n\n\t\t\tif (!!this._video) {\n\t\t\t\tthis._video.srcObject = this._streamObj;\n\t\t\t} else {\n\t\t\t\t// logger.error('API audioTracks() error - this._video is NULL');\n\t\t\t}\n\t\t},\n\t\tget: function get() {\n\t\t\tif (!this._streamObj) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this._streamObj.getVideoTracks();\n\t\t}\n\n\t\t/**\r\n   * Get tracks property.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'tracks',\n\t\tget: function get() {\n\t\t\treturn this._streamObj.getTracks();\n\t\t}\n\n\t\t/**\r\n   * Get track's number property.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'trackNumber',\n\t\tget: function get() {\n\t\t\tif (!this._streamObj) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn this._streamObj.getTracks().length;\n\t\t}\n\n\t\t/**\r\n   * Set subscribed property.\r\n   * \r\n   * @public\r\n   */\n\n\t}, {\n\t\tkey: 'subscribed',\n\t\tset: function set(value) {\n\t\t\tthis._subscribed = value;\n\t\t}\n\n\t\t/**\r\n   * Get subscribed property.\r\n   * \r\n   * @public\r\n   */\n\t\t,\n\t\tget: function get() {\n\t\t\treturn this._subscribed;\n\t\t}\n\n\t\t/**\r\n   * default is video.\r\n   * stream type { video | audio }\r\n   * @returns {boolean}\r\n   */\n\n\t}, {\n\t\tkey: 'type',\n\t\tget: function get() {\n\t\t\treturn this.trackNumber === 1 && this.audioTracks.length > 0 ? 'audio' : 'video';\n\t\t}\n\t}, {\n\t\tkey: 'published',\n\t\tget: function get() {\n\t\t\treturn this._published;\n\t\t}\n\t}, {\n\t\tkey: 'videoType',\n\t\tget: function get() {\n\t\t\treturn this._videoType;\n\t\t}\n\t}, {\n\t\tkey: 'isMicClosed',\n\t\tget: function get() {\n\t\t\treturn this._isMicClosed;\n\t\t}\n\n\t\t// \n\n\t}, {\n\t\tkey: 'isVideoTrackClosed',\n\t\tget: function get() {\n\t\t\treturn this._isVideoTrackClosed;\n\t\t}\n\t}, {\n\t\tkey: 'idealBandwidth',\n\t\tget: function get() {\n\t\t\tif (typeof this._spec.codecOptions !== 'undefined') {\n\t\t\t\tif (typeof this._spec.codecOptions.startBitrate !== 'undefined') {\n\t\t\t\t\tif (typeof this._spec.codecOptions.startBitrate === 'number') {\n\t\t\t\t\t\tlogger.warn('idealBandwidth() error - spec.codecOptions.startBitrate type error');\n\t\t\t\t\t\treturn this._spec.codecOptions.startBitrate;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn config.videoResolution.get(this._keyResolution).bps.ideal / 1000;\n\t\t}\n\n\t\t/**\r\n   * Get Minimum Bandwidth.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'minBandwidth',\n\t\tget: function get() {\n\t\t\tif (typeof this._spec.codecOptions !== 'undefined') {\n\t\t\t\tif (typeof this._spec.codecOptions.minBitrate !== 'undefined') {\n\t\t\t\t\tif (typeof this._spec.codecOptions.minBitrate === 'number') {\n\t\t\t\t\t\tlogger.warn('minBandwidth() error - spec.codecOptions.minBitrate type error');\n\t\t\t\t\t\treturn this._spec.codecOptions.minBitrate;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn config.videoResolution.get(this._keyResolution).bps.min / 1000;\n\t\t}\n\n\t\t/**\r\n   * Get maximum Bandwidth.\r\n   * \r\n   * @private\r\n   */\n\n\t}, {\n\t\tkey: 'maxBandwidth',\n\t\tget: function get() {\n\t\t\tif (typeof this._spec.codecOptions !== 'undefined') {\n\t\t\t\tif (typeof this._spec.codecOptions.maxBitrate !== 'undefined') {\n\t\t\t\t\tif (typeof this._spec.codecOptions.maxBitrate === 'number') {\n\t\t\t\t\t\tlogger.warn('maxBandwidth() error - spec.codecOptions.maxBitrate type error');\n\t\t\t\t\t\treturn this._spec.codecOptions.maxBitrate;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn config.videoResolution.get(this._keyResolution).bps.max / 1000;\n\t\t}\n\t}], [{\n\t\tkey: 'clearStreamIdMap',\n\t\tvalue: function clearStreamIdMap() {\n\t\t\tif (!!S_STREAM_MAP) {\n\t\t\t\tS_STREAM_MAP.clear();\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * Get the inner stream identity.\r\n   * \r\n   * @private\r\n   * @param {string} userID \r\n   * @param {string} streamID \r\n   * @param {string} number \r\n   * @param {Any} stream \r\n   * @param {Boolean} isSubStream \r\n   */\n\n\t}, {\n\t\tkey: '_getInnerStreamID',\n\t\tvalue: function _getInnerStreamID(userID, streamID, number, stream) {\n\t\t\tvar isSubStream = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n\t\t\tif (userID === '') {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tvar s = S_STREAM_MAP.get(streamID);\n\t\t\tif (typeof s === 'undefined') {\n\t\t\t\tS_STREAM_MAP.set(streamID, stream);\n\t\t\t\treturn streamID;\n\t\t\t} else {\n\t\t\t\tif (isSubStream) {\n\t\t\t\t\t// The formation is contract with other Entpoints version's SDK.\n\t\t\t\t\tif (number === 0) {\n\t\t\t\t\t\treturn Stream._getInnerStreamID(userID, userID + ':' + userID + '_low', number + 1, stream);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Stream._getInnerStreamID(userID, userID + ':' + userID + '_' + number + '_low', number + 1, stream);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn Stream._getInnerStreamID(userID, userID + ':' + userID + '_' + (number + 1), number + 1, stream);\n\t\t\t}\n\t\t}\n\t}]);\n\treturn Stream;\n}(_events.EventEmitter);\n\nexports.default = Stream;\n\n/***/ }),\n\n/***/ \"./lib/utils.js\":\n/*!**********************!*\\\n  !*** ./lib/utils.js ***!\n  \\**********************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.getProtooUrl = getProtooUrl;\nexports.uuid = uuid;\nfunction getProtooUrl(peerName, roomId) {\n\tvar appId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n\tvar hostname = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n\tvar port = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 3443;\n\tvar audioPt = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 'isac32';\n\n\tvar url = 'wss://' + hostname + ':' + port + '/?peerName=' + peerName + '&roomId=' + roomId + '_' + appId + '&audioPt=' + audioPt;\n\treturn url;\n}\n\nfunction uuid() {\n\tvar s = [];\n\tvar hexDigits = '0123456789abcdef';\n\tfor (var i = 0; i < 36; i++) {\n\t\ts[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n\t}\n\n\ts[14] = '4'; // bits 12-15 of the time_hi_and_version field to 0010\n\ts[19] = hexDigits.substr(s[19] & 0x3 | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n\ts[8] = s[13] = s[18] = s[23] = '-';\n\n\tvar uuid = s.join('');\n\treturn uuid;\n}\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js\":\n/*!********************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/array/from.js ***!\n  \\********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/array/from */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/array/from.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\":\n/*!**********************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js ***!\n  \\**********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/get-iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/get-iterator.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/is-iterable.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/is-iterable.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/is-iterable */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/is-iterable.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/json/stringify.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/json/stringify */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/json/stringify.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/map.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/map */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/map.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/assign.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/assign.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/object/assign */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/assign.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/create.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/create.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/object/create */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/create.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/define-property.js\":\n/*!********************************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/define-property.js ***!\n  \\********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/object/define-property */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/define-property.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/freeze.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/freeze.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/object/freeze */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/freeze.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js\":\n/*!*********************************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/get-prototype-of.js ***!\n  \\*********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/object/get-prototype-of */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/get-prototype-of.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/keys.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/keys.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/object/keys */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/keys.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/set-prototype-of.js\":\n/*!*********************************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/set-prototype-of.js ***!\n  \\*********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/object/set-prototype-of */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/set-prototype-of.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/promise */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/promise.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/set.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/set */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/set.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/symbol.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/symbol.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/symbol */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/symbol/index.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/symbol/iterator.js\":\n/*!*************************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/symbol/iterator.js ***!\n  \\*************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = { \"default\": __webpack_require__(/*! core-js/library/fn/symbol/iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/fn/symbol/iterator.js\"), __esModule: true };\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/asyncToGenerator.js\":\n/*!**************************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/asyncToGenerator.js ***!\n  \\**************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.__esModule = true;\n\nvar _promise = __webpack_require__(/*! ../core-js/promise */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/promise.js\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (fn) {\n  return function () {\n    var gen = fn.apply(this, arguments);\n    return new _promise2.default(function (resolve, reject) {\n      function step(key, arg) {\n        try {\n          var info = gen[key](arg);\n          var value = info.value;\n        } catch (error) {\n          reject(error);\n          return;\n        }\n\n        if (info.done) {\n          resolve(value);\n        } else {\n          return _promise2.default.resolve(value).then(function (value) {\n            step(\"next\", value);\n          }, function (err) {\n            step(\"throw\", err);\n          });\n        }\n      }\n\n      return step(\"next\");\n    });\n  };\n};\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/classCallCheck.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.__esModule = true;\n\nexports.default = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/createClass.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.__esModule = true;\n\nvar _defineProperty = __webpack_require__(/*! ../core-js/object/define-property */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/define-property.js\");\n\nvar _defineProperty2 = _interopRequireDefault(_defineProperty);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      (0, _defineProperty2.default)(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/extends.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/extends.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.__esModule = true;\n\nvar _assign = __webpack_require__(/*! ../core-js/object/assign */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/assign.js\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = _assign2.default || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/inherits.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.__esModule = true;\n\nvar _setPrototypeOf = __webpack_require__(/*! ../core-js/object/set-prototype-of */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/set-prototype-of.js\");\n\nvar _setPrototypeOf2 = _interopRequireDefault(_setPrototypeOf);\n\nvar _create = __webpack_require__(/*! ../core-js/object/create */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/object/create.js\");\n\nvar _create2 = _interopRequireDefault(_create);\n\nvar _typeof2 = __webpack_require__(/*! ../helpers/typeof */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + (typeof superClass === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(superClass)));\n  }\n\n  subClass.prototype = (0, _create2.default)(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf2.default ? (0, _setPrototypeOf2.default)(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js\":\n/*!***********************************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/possibleConstructorReturn.js ***!\n  \\***********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.__esModule = true;\n\nvar _typeof2 = __webpack_require__(/*! ../helpers/typeof */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && ((typeof call === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(call)) === \"object\" || typeof call === \"function\") ? call : self;\n};\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/slicedToArray.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/slicedToArray.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.__esModule = true;\n\nvar _isIterable2 = __webpack_require__(/*! ../core-js/is-iterable */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/is-iterable.js\");\n\nvar _isIterable3 = _interopRequireDefault(_isIterable2);\n\nvar _getIterator2 = __webpack_require__(/*! ../core-js/get-iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/get-iterator.js\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = (0, _getIterator3.default)(arr), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if ((0, _isIterable3.default)(Object(arr))) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/helpers/typeof.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.__esModule = true;\n\nvar _iterator = __webpack_require__(/*! ../core-js/symbol/iterator */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/symbol/iterator.js\");\n\nvar _iterator2 = _interopRequireDefault(_iterator);\n\nvar _symbol = __webpack_require__(/*! ../core-js/symbol */ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/core-js/symbol.js\");\n\nvar _symbol2 = _interopRequireDefault(_symbol);\n\nvar _typeof = typeof _symbol2.default === \"function\" && typeof _iterator2.default === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof _symbol2.default === \"function\" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? \"symbol\" : typeof obj; };\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = typeof _symbol2.default === \"function\" && _typeof(_iterator2.default) === \"symbol\" ? function (obj) {\n  return typeof obj === \"undefined\" ? \"undefined\" : _typeof(obj);\n} : function (obj) {\n  return obj && typeof _symbol2.default === \"function\" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? \"symbol\" : typeof obj === \"undefined\" ? \"undefined\" : _typeof(obj);\n};\n\n/***/ }),\n\n/***/ \"./node_modules/_babel-runtime@6.26.0@babel-runtime/regenerator/index.js\":\n/*!*******************************************************************************!*\\\n  !*** ./node_modules/_babel-runtime@6.26.0@babel-runtime/regenerator/index.js ***!\n  \\*******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(/*! regenerator-runtime */ \"./node_modules/_regenerator-runtime@0.11.1@regenerator-runtime/runtime-module.js\");\n\n\n/***/ }),\n\n/***/ \"./node_modules/_bowser@1.9.4@bowser/src/bowser.js\":\n/*!*********************************************************!*\\\n  !*** ./node_modules/_bowser@1.9.4@bowser/src/bowser.js ***!\n  \\*********************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/*!\n * Bowser - a browser detector\n * https://github.com/ded/bowser\n * MIT License | (c) Dustin Diaz 2015\n */\n\n!function (root, name, definition) {\n  if (  true && module.exports) module.exports = definition()\n  else if (true) __webpack_require__(/*! !webpack amd define */ \"./node_modules/_webpack@4.41.6@webpack/buildin/amd-define.js\")(name, definition)\n  else {}\n}(this, 'bowser', function () {\n  /**\n    * See useragents.js for examples of navigator.userAgent\n    */\n\n  var t = true\n\n  function detect(ua) {\n\n    function getFirstMatch(regex) {\n      var match = ua.match(regex);\n      return (match && match.length > 1 && match[1]) || '';\n    }\n\n    function getSecondMatch(regex) {\n      var match = ua.match(regex);\n      return (match && match.length > 1 && match[2]) || '';\n    }\n\n    var iosdevice = getFirstMatch(/(ipod|iphone|ipad)/i).toLowerCase()\n      , likeAndroid = /like android/i.test(ua)\n      , android = !likeAndroid && /android/i.test(ua)\n      , nexusMobile = /nexus\\s*[0-6]\\s*/i.test(ua)\n      , nexusTablet = !nexusMobile && /nexus\\s*[0-9]+/i.test(ua)\n      , chromeos = /CrOS/.test(ua)\n      , silk = /silk/i.test(ua)\n      , sailfish = /sailfish/i.test(ua)\n      , tizen = /tizen/i.test(ua)\n      , webos = /(web|hpw)(o|0)s/i.test(ua)\n      , windowsphone = /windows phone/i.test(ua)\n      , samsungBrowser = /SamsungBrowser/i.test(ua)\n      , windows = !windowsphone && /windows/i.test(ua)\n      , mac = !iosdevice && !silk && /macintosh/i.test(ua)\n      , linux = !android && !sailfish && !tizen && !webos && /linux/i.test(ua)\n      , edgeVersion = getSecondMatch(/edg([ea]|ios)\\/(\\d+(\\.\\d+)?)/i)\n      , versionIdentifier = getFirstMatch(/version\\/(\\d+(\\.\\d+)?)/i)\n      , tablet = /tablet/i.test(ua) && !/tablet pc/i.test(ua)\n      , mobile = !tablet && /[^-]mobi/i.test(ua)\n      , xbox = /xbox/i.test(ua)\n      , result\n\n    if (/opera/i.test(ua)) {\n      //  an old Opera\n      result = {\n        name: 'Opera'\n      , opera: t\n      , version: versionIdentifier || getFirstMatch(/(?:opera|opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i)\n      }\n    } else if (/opr\\/|opios/i.test(ua)) {\n      // a new Opera\n      result = {\n        name: 'Opera'\n        , opera: t\n        , version: getFirstMatch(/(?:opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i) || versionIdentifier\n      }\n    }\n    else if (/SamsungBrowser/i.test(ua)) {\n      result = {\n        name: 'Samsung Internet for Android'\n        , samsungBrowser: t\n        , version: versionIdentifier || getFirstMatch(/(?:SamsungBrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/Whale/i.test(ua)) {\n      result = {\n        name: 'NAVER Whale browser'\n        , whale: t\n        , version: getFirstMatch(/(?:whale)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/MZBrowser/i.test(ua)) {\n      result = {\n        name: 'MZ Browser'\n        , mzbrowser: t\n        , version: getFirstMatch(/(?:MZBrowser)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/coast/i.test(ua)) {\n      result = {\n        name: 'Opera Coast'\n        , coast: t\n        , version: versionIdentifier || getFirstMatch(/(?:coast)[\\s\\/](\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/focus/i.test(ua)) {\n      result = {\n        name: 'Focus'\n        , focus: t\n        , version: getFirstMatch(/(?:focus)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/yabrowser/i.test(ua)) {\n      result = {\n        name: 'Yandex Browser'\n      , yandexbrowser: t\n      , version: versionIdentifier || getFirstMatch(/(?:yabrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/ucbrowser/i.test(ua)) {\n      result = {\n          name: 'UC Browser'\n        , ucbrowser: t\n        , version: getFirstMatch(/(?:ucbrowser)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/mxios/i.test(ua)) {\n      result = {\n        name: 'Maxthon'\n        , maxthon: t\n        , version: getFirstMatch(/(?:mxios)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/epiphany/i.test(ua)) {\n      result = {\n        name: 'Epiphany'\n        , epiphany: t\n        , version: getFirstMatch(/(?:epiphany)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/puffin/i.test(ua)) {\n      result = {\n        name: 'Puffin'\n        , puffin: t\n        , version: getFirstMatch(/(?:puffin)[\\s\\/](\\d+(?:\\.\\d+)?)/i)\n      }\n    }\n    else if (/sleipnir/i.test(ua)) {\n      result = {\n        name: 'Sleipnir'\n        , sleipnir: t\n        , version: getFirstMatch(/(?:sleipnir)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/k-meleon/i.test(ua)) {\n      result = {\n        name: 'K-Meleon'\n        , kMeleon: t\n        , version: getFirstMatch(/(?:k-meleon)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (windowsphone) {\n      result = {\n        name: 'Windows Phone'\n      , osname: 'Windows Phone'\n      , windowsphone: t\n      }\n      if (edgeVersion) {\n        result.msedge = t\n        result.version = edgeVersion\n      }\n      else {\n        result.msie = t\n        result.version = getFirstMatch(/iemobile\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/msie|trident/i.test(ua)) {\n      result = {\n        name: 'Internet Explorer'\n      , msie: t\n      , version: getFirstMatch(/(?:msie |rv:)(\\d+(\\.\\d+)?)/i)\n      }\n    } else if (chromeos) {\n      result = {\n        name: 'Chrome'\n      , osname: 'Chrome OS'\n      , chromeos: t\n      , chromeBook: t\n      , chrome: t\n      , version: getFirstMatch(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)\n      }\n    } else if (/edg([ea]|ios)/i.test(ua)) {\n      result = {\n        name: 'Microsoft Edge'\n      , msedge: t\n      , version: edgeVersion\n      }\n    }\n    else if (/vivaldi/i.test(ua)) {\n      result = {\n        name: 'Vivaldi'\n        , vivaldi: t\n        , version: getFirstMatch(/vivaldi\\/(\\d+(\\.\\d+)?)/i) || versionIdentifier\n      }\n    }\n    else if (sailfish) {\n      result = {\n        name: 'Sailfish'\n      , osname: 'Sailfish OS'\n      , sailfish: t\n      , version: getFirstMatch(/sailfish\\s?browser\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/seamonkey\\//i.test(ua)) {\n      result = {\n        name: 'SeaMonkey'\n      , seamonkey: t\n      , version: getFirstMatch(/seamonkey\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/firefox|iceweasel|fxios/i.test(ua)) {\n      result = {\n        name: 'Firefox'\n      , firefox: t\n      , version: getFirstMatch(/(?:firefox|iceweasel|fxios)[ \\/](\\d+(\\.\\d+)?)/i)\n      }\n      if (/\\((mobile|tablet);[^\\)]*rv:[\\d\\.]+\\)/i.test(ua)) {\n        result.firefoxos = t\n        result.osname = 'Firefox OS'\n      }\n    }\n    else if (silk) {\n      result =  {\n        name: 'Amazon Silk'\n      , silk: t\n      , version : getFirstMatch(/silk\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/phantom/i.test(ua)) {\n      result = {\n        name: 'PhantomJS'\n      , phantom: t\n      , version: getFirstMatch(/phantomjs\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/slimerjs/i.test(ua)) {\n      result = {\n        name: 'SlimerJS'\n        , slimer: t\n        , version: getFirstMatch(/slimerjs\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/blackberry|\\bbb\\d+/i.test(ua) || /rim\\stablet/i.test(ua)) {\n      result = {\n        name: 'BlackBerry'\n      , osname: 'BlackBerry OS'\n      , blackberry: t\n      , version: versionIdentifier || getFirstMatch(/blackberry[\\d]+\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (webos) {\n      result = {\n        name: 'WebOS'\n      , osname: 'WebOS'\n      , webos: t\n      , version: versionIdentifier || getFirstMatch(/w(?:eb)?osbrowser\\/(\\d+(\\.\\d+)?)/i)\n      };\n      /touchpad\\//i.test(ua) && (result.touchpad = t)\n    }\n    else if (/bada/i.test(ua)) {\n      result = {\n        name: 'Bada'\n      , osname: 'Bada'\n      , bada: t\n      , version: getFirstMatch(/dolfin\\/(\\d+(\\.\\d+)?)/i)\n      };\n    }\n    else if (tizen) {\n      result = {\n        name: 'Tizen'\n      , osname: 'Tizen'\n      , tizen: t\n      , version: getFirstMatch(/(?:tizen\\s?)?browser\\/(\\d+(\\.\\d+)?)/i) || versionIdentifier\n      };\n    }\n    else if (/qupzilla/i.test(ua)) {\n      result = {\n        name: 'QupZilla'\n        , qupzilla: t\n        , version: getFirstMatch(/(?:qupzilla)[\\s\\/](\\d+(?:\\.\\d+)+)/i) || versionIdentifier\n      }\n    }\n    else if (/chromium/i.test(ua)) {\n      result = {\n        name: 'Chromium'\n        , chromium: t\n        , version: getFirstMatch(/(?:chromium)[\\s\\/](\\d+(?:\\.\\d+)?)/i) || versionIdentifier\n      }\n    }\n    else if (/chrome|crios|crmo/i.test(ua)) {\n      result = {\n        name: 'Chrome'\n        , chrome: t\n        , version: getFirstMatch(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (android) {\n      result = {\n        name: 'Android'\n        , version: versionIdentifier\n      }\n    }\n    else if (/safari|applewebkit/i.test(ua)) {\n      result = {\n        name: 'Safari'\n      , safari: t\n      }\n      if (versionIdentifier) {\n        result.version = versionIdentifier\n      }\n    }\n    else if (iosdevice) {\n      result = {\n        name : iosdevice == 'iphone' ? 'iPhone' : iosdevice == 'ipad' ? 'iPad' : 'iPod'\n      }\n      // WTF: version is not part of user agent in web apps\n      if (versionIdentifier) {\n        result.version = versionIdentifier\n      }\n    }\n    else if(/googlebot/i.test(ua)) {\n      result = {\n        name: 'Googlebot'\n      , googlebot: t\n      , version: getFirstMatch(/googlebot\\/(\\d+(\\.\\d+))/i) || versionIdentifier\n      }\n    }\n    else {\n      result = {\n        name: getFirstMatch(/^(.*)\\/(.*) /),\n        version: getSecondMatch(/^(.*)\\/(.*) /)\n     };\n   }\n\n    // set webkit or gecko flag for browsers based on these engines\n    if (!result.msedge && /(apple)?webkit/i.test(ua)) {\n      if (/(apple)?webkit\\/537\\.36/i.test(ua)) {\n        result.name = result.name || \"Blink\"\n        result.blink = t\n      } else {\n        result.name = result.name || \"Webkit\"\n        result.webkit = t\n      }\n      if (!result.version && versionIdentifier) {\n        result.version = versionIdentifier\n      }\n    } else if (!result.opera && /gecko\\//i.test(ua)) {\n      result.name = result.name || \"Gecko\"\n      result.gecko = t\n      result.version = result.version || getFirstMatch(/gecko\\/(\\d+(\\.\\d+)?)/i)\n    }\n\n    // set OS flags for platforms that have multiple browsers\n    if (!result.windowsphone && (android || result.silk)) {\n      result.android = t\n      result.osname = 'Android'\n    } else if (!result.windowsphone && iosdevice) {\n      result[iosdevice] = t\n      result.ios = t\n      result.osname = 'iOS'\n    } else if (mac) {\n      result.mac = t\n      result.osname = 'macOS'\n    } else if (xbox) {\n      result.xbox = t\n      result.osname = 'Xbox'\n    } else if (windows) {\n      result.windows = t\n      result.osname = 'Windows'\n    } else if (linux) {\n      result.linux = t\n      result.osname = 'Linux'\n    }\n\n    function getWindowsVersion (s) {\n      switch (s) {\n        case 'NT': return 'NT'\n        case 'XP': return 'XP'\n        case 'NT 5.0': return '2000'\n        case 'NT 5.1': return 'XP'\n        case 'NT 5.2': return '2003'\n        case 'NT 6.0': return 'Vista'\n        case 'NT 6.1': return '7'\n        case 'NT 6.2': return '8'\n        case 'NT 6.3': return '8.1'\n        case 'NT 10.0': return '10'\n        default: return undefined\n      }\n    }\n\n    // OS version extraction\n    var osVersion = '';\n    if (result.windows) {\n      osVersion = getWindowsVersion(getFirstMatch(/Windows ((NT|XP)( \\d\\d?.\\d)?)/i))\n    } else if (result.windowsphone) {\n      osVersion = getFirstMatch(/windows phone (?:os)?\\s?(\\d+(\\.\\d+)*)/i);\n    } else if (result.mac) {\n      osVersion = getFirstMatch(/Mac OS X (\\d+([_\\.\\s]\\d+)*)/i);\n      osVersion = osVersion.replace(/[_\\s]/g, '.');\n    } else if (iosdevice) {\n      osVersion = getFirstMatch(/os (\\d+([_\\s]\\d+)*) like mac os x/i);\n      osVersion = osVersion.replace(/[_\\s]/g, '.');\n    } else if (android) {\n      osVersion = getFirstMatch(/android[ \\/-](\\d+(\\.\\d+)*)/i);\n    } else if (result.webos) {\n      osVersion = getFirstMatch(/(?:web|hpw)os\\/(\\d+(\\.\\d+)*)/i);\n    } else if (result.blackberry) {\n      osVersion = getFirstMatch(/rim\\stablet\\sos\\s(\\d+(\\.\\d+)*)/i);\n    } else if (result.bada) {\n      osVersion = getFirstMatch(/bada\\/(\\d+(\\.\\d+)*)/i);\n    } else if (result.tizen) {\n      osVersion = getFirstMatch(/tizen[\\/\\s](\\d+(\\.\\d+)*)/i);\n    }\n    if (osVersion) {\n      result.osversion = osVersion;\n    }\n\n    // device type extraction\n    var osMajorVersion = !result.windows && osVersion.split('.')[0];\n    if (\n         tablet\n      || nexusTablet\n      || iosdevice == 'ipad'\n      || (android && (osMajorVersion == 3 || (osMajorVersion >= 4 && !mobile)))\n      || result.silk\n    ) {\n      result.tablet = t\n    } else if (\n         mobile\n      || iosdevice == 'iphone'\n      || iosdevice == 'ipod'\n      || android\n      || nexusMobile\n      || result.blackberry\n      || result.webos\n      || result.bada\n    ) {\n      result.mobile = t\n    }\n\n    // Graded Browser Support\n    // http://developer.yahoo.com/yui/articles/gbs\n    if (result.msedge ||\n        (result.msie && result.version >= 10) ||\n        (result.yandexbrowser && result.version >= 15) ||\n\t\t    (result.vivaldi && result.version >= 1.0) ||\n        (result.chrome && result.version >= 20) ||\n        (result.samsungBrowser && result.version >= 4) ||\n        (result.whale && compareVersions([result.version, '1.0']) === 1) ||\n        (result.mzbrowser && compareVersions([result.version, '6.0']) === 1) ||\n        (result.focus && compareVersions([result.version, '1.0']) === 1) ||\n        (result.firefox && result.version >= 20.0) ||\n        (result.safari && result.version >= 6) ||\n        (result.opera && result.version >= 10.0) ||\n        (result.ios && result.osversion && result.osversion.split(\".\")[0] >= 6) ||\n        (result.blackberry && result.version >= 10.1)\n        || (result.chromium && result.version >= 20)\n        ) {\n      result.a = t;\n    }\n    else if ((result.msie && result.version < 10) ||\n        (result.chrome && result.version < 20) ||\n        (result.firefox && result.version < 20.0) ||\n        (result.safari && result.version < 6) ||\n        (result.opera && result.version < 10.0) ||\n        (result.ios && result.osversion && result.osversion.split(\".\")[0] < 6)\n        || (result.chromium && result.version < 20)\n        ) {\n      result.c = t\n    } else result.x = t\n\n    return result\n  }\n\n  var bowser = detect(typeof navigator !== 'undefined' ? navigator.userAgent || '' : '')\n\n  bowser.test = function (browserList) {\n    for (var i = 0; i < browserList.length; ++i) {\n      var browserItem = browserList[i];\n      if (typeof browserItem=== 'string') {\n        if (browserItem in bowser) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Get version precisions count\n   *\n   * @example\n   *   getVersionPrecision(\"1.10.3\") // 3\n   *\n   * @param  {string} version\n   * @return {number}\n   */\n  function getVersionPrecision(version) {\n    return version.split(\".\").length;\n  }\n\n  /**\n   * Array::map polyfill\n   *\n   * @param  {Array} arr\n   * @param  {Function} iterator\n   * @return {Array}\n   */\n  function map(arr, iterator) {\n    var result = [], i;\n    if (Array.prototype.map) {\n      return Array.prototype.map.call(arr, iterator);\n    }\n    for (i = 0; i < arr.length; i++) {\n      result.push(iterator(arr[i]));\n    }\n    return result;\n  }\n\n  /**\n   * Calculate browser version weight\n   *\n   * @example\n   *   compareVersions(['1.10.2.1',  '1.8.2.1.90'])    // 1\n   *   compareVersions(['1.010.2.1', '1.09.2.1.90']);  // 1\n   *   compareVersions(['1.10.2.1',  '1.10.2.1']);     // 0\n   *   compareVersions(['1.10.2.1',  '1.0800.2']);     // -1\n   *\n   * @param  {Array<String>} versions versions to compare\n   * @return {Number} comparison result\n   */\n  function compareVersions(versions) {\n    // 1) get common precision for both versions, for example for \"10.0\" and \"9\" it should be 2\n    var precision = Math.max(getVersionPrecision(versions[0]), getVersionPrecision(versions[1]));\n    var chunks = map(versions, function (version) {\n      var delta = precision - getVersionPrecision(version);\n\n      // 2) \"9\" -> \"9.0\" (for precision = 2)\n      version = version + new Array(delta + 1).join(\".0\");\n\n      // 3) \"9.0\" -> [\"000000000\"\", \"000000009\"]\n      return map(version.split(\".\"), function (chunk) {\n        return new Array(20 - chunk.length).join(\"0\") + chunk;\n      }).reverse();\n    });\n\n    // iterate in reverse order by reversed chunks array\n    while (--precision >= 0) {\n      // 4) compare: \"000000009\" > \"000000010\" = false (but \"9\" > \"10\" = true)\n      if (chunks[0][precision] > chunks[1][precision]) {\n        return 1;\n      }\n      else if (chunks[0][precision] === chunks[1][precision]) {\n        if (precision === 0) {\n          // all version chunks are same\n          return 0;\n        }\n      }\n      else {\n        return -1;\n      }\n    }\n  }\n\n  /**\n   * Check if browser is unsupported\n   *\n   * @example\n   *   bowser.isUnsupportedBrowser({\n   *     msie: \"10\",\n   *     firefox: \"23\",\n   *     chrome: \"29\",\n   *     safari: \"5.1\",\n   *     opera: \"16\",\n   *     phantom: \"534\"\n   *   });\n   *\n   * @param  {Object}  minVersions map of minimal version to browser\n   * @param  {Boolean} [strictMode = false] flag to return false if browser wasn't found in map\n   * @param  {String}  [ua] user agent string\n   * @return {Boolean}\n   */\n  function isUnsupportedBrowser(minVersions, strictMode, ua) {\n    var _bowser = bowser;\n\n    // make strictMode param optional with ua param usage\n    if (typeof strictMode === 'string') {\n      ua = strictMode;\n      strictMode = void(0);\n    }\n\n    if (strictMode === void(0)) {\n      strictMode = false;\n    }\n    if (ua) {\n      _bowser = detect(ua);\n    }\n\n    var version = \"\" + _bowser.version;\n    for (var browser in minVersions) {\n      if (minVersions.hasOwnProperty(browser)) {\n        if (_bowser[browser]) {\n          if (typeof minVersions[browser] !== 'string') {\n            throw new Error('Browser version in the minVersion map should be a string: ' + browser + ': ' + String(minVersions));\n          }\n\n          // browser version and min supported version.\n          return compareVersions([version, minVersions[browser]]) < 0;\n        }\n      }\n    }\n\n    return strictMode; // not found\n  }\n\n  /**\n   * Check if browser is supported\n   *\n   * @param  {Object} minVersions map of minimal version to browser\n   * @param  {Boolean} [strictMode = false] flag to return false if browser wasn't found in map\n   * @param  {String}  [ua] user agent string\n   * @return {Boolean}\n   */\n  function check(minVersions, strictMode, ua) {\n    return !isUnsupportedBrowser(minVersions, strictMode, ua);\n  }\n\n  bowser.isUnsupportedBrowser = isUnsupportedBrowser;\n  bowser.compareVersions = compareVersions;\n  bowser.check = check;\n\n  /*\n   * Set our detect method to the main bowser object so we can\n   * reuse it to test other user agents.\n   * This is needed to implement future tests.\n   */\n  bowser._detect = detect;\n\n  /*\n   * Set our detect public method to the main bowser object\n   * This is needed to implement bowser in server side\n   */\n  bowser.detect = detect;\n  return bowser\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/array/from.js\":\n/*!***********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/array/from.js ***!\n  \\***********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.string.iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.string.iterator.js\");\n__webpack_require__(/*! ../../modules/es6.array.from */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.array.from.js\");\nmodule.exports = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Array.from;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/get-iterator.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/get-iterator.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../modules/web.dom.iterable */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/web.dom.iterable.js\");\n__webpack_require__(/*! ../modules/es6.string.iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.string.iterator.js\");\nmodule.exports = __webpack_require__(/*! ../modules/core.get-iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/core.get-iterator.js\");\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/is-iterable.js\":\n/*!************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/is-iterable.js ***!\n  \\************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../modules/web.dom.iterable */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/web.dom.iterable.js\");\n__webpack_require__(/*! ../modules/es6.string.iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.string.iterator.js\");\nmodule.exports = __webpack_require__(/*! ../modules/core.is-iterable */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/core.is-iterable.js\");\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/json/stringify.js\":\n/*!***************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/json/stringify.js ***!\n  \\***************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar core = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\");\nvar $JSON = core.JSON || (core.JSON = { stringify: JSON.stringify });\nmodule.exports = function stringify(it) { // eslint-disable-line no-unused-vars\n  return $JSON.stringify.apply($JSON, arguments);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/map.js\":\n/*!****************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/map.js ***!\n  \\****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../modules/es6.object.to-string */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.to-string.js\");\n__webpack_require__(/*! ../modules/es6.string.iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.string.iterator.js\");\n__webpack_require__(/*! ../modules/web.dom.iterable */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/web.dom.iterable.js\");\n__webpack_require__(/*! ../modules/es6.map */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.map.js\");\n__webpack_require__(/*! ../modules/es7.map.to-json */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.map.to-json.js\");\n__webpack_require__(/*! ../modules/es7.map.of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.map.of.js\");\n__webpack_require__(/*! ../modules/es7.map.from */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.map.from.js\");\nmodule.exports = __webpack_require__(/*! ../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Map;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/assign.js\":\n/*!**************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/object/assign.js ***!\n  \\**************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.object.assign */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.assign.js\");\nmodule.exports = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Object.assign;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/create.js\":\n/*!**************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/object/create.js ***!\n  \\**************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.object.create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.create.js\");\nvar $Object = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Object;\nmodule.exports = function create(P, D) {\n  return $Object.create(P, D);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/define-property.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/object/define-property.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.object.define-property */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.define-property.js\");\nvar $Object = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Object;\nmodule.exports = function defineProperty(it, key, desc) {\n  return $Object.defineProperty(it, key, desc);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/freeze.js\":\n/*!**************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/object/freeze.js ***!\n  \\**************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.object.freeze */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.freeze.js\");\nmodule.exports = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Object.freeze;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/get-prototype-of.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/object/get-prototype-of.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.object.get-prototype-of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.get-prototype-of.js\");\nmodule.exports = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Object.getPrototypeOf;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/keys.js\":\n/*!************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/object/keys.js ***!\n  \\************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.object.keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.keys.js\");\nmodule.exports = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Object.keys;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/object/set-prototype-of.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/object/set-prototype-of.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.object.set-prototype-of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.set-prototype-of.js\");\nmodule.exports = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Object.setPrototypeOf;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/promise.js\":\n/*!********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/promise.js ***!\n  \\********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../modules/es6.object.to-string */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.to-string.js\");\n__webpack_require__(/*! ../modules/es6.string.iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.string.iterator.js\");\n__webpack_require__(/*! ../modules/web.dom.iterable */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/web.dom.iterable.js\");\n__webpack_require__(/*! ../modules/es6.promise */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.promise.js\");\n__webpack_require__(/*! ../modules/es7.promise.finally */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.promise.finally.js\");\n__webpack_require__(/*! ../modules/es7.promise.try */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.promise.try.js\");\nmodule.exports = __webpack_require__(/*! ../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Promise;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/set.js\":\n/*!****************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/set.js ***!\n  \\****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../modules/es6.object.to-string */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.to-string.js\");\n__webpack_require__(/*! ../modules/es6.string.iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.string.iterator.js\");\n__webpack_require__(/*! ../modules/web.dom.iterable */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/web.dom.iterable.js\");\n__webpack_require__(/*! ../modules/es6.set */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.set.js\");\n__webpack_require__(/*! ../modules/es7.set.to-json */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.set.to-json.js\");\n__webpack_require__(/*! ../modules/es7.set.of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.set.of.js\");\n__webpack_require__(/*! ../modules/es7.set.from */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.set.from.js\");\nmodule.exports = __webpack_require__(/*! ../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Set;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/symbol/index.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/symbol/index.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.symbol */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.symbol.js\");\n__webpack_require__(/*! ../../modules/es6.object.to-string */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.to-string.js\");\n__webpack_require__(/*! ../../modules/es7.symbol.async-iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.symbol.async-iterator.js\");\n__webpack_require__(/*! ../../modules/es7.symbol.observable */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.symbol.observable.js\");\nmodule.exports = __webpack_require__(/*! ../../modules/_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").Symbol;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/fn/symbol/iterator.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/fn/symbol/iterator.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ../../modules/es6.string.iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.string.iterator.js\");\n__webpack_require__(/*! ../../modules/web.dom.iterable */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/web.dom.iterable.js\");\nmodule.exports = __webpack_require__(/*! ../../modules/_wks-ext */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-ext.js\").f('iterator');\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_a-function.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_a-function.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = function (it) {\n  if (typeof it != 'function') throw TypeError(it + ' is not a function!');\n  return it;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_add-to-unscopables.js\":\n/*!*************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_add-to-unscopables.js ***!\n  \\*************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = function () { /* empty */ };\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-instance.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_an-instance.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = function (it, Constructor, name, forbiddenField) {\n  if (!(it instanceof Constructor) || (forbiddenField !== undefined && forbiddenField in it)) {\n    throw TypeError(name + ': incorrect invocation!');\n  } return it;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nmodule.exports = function (it) {\n  if (!isObject(it)) throw TypeError(it + ' is not an object!');\n  return it;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-from-iterable.js\":\n/*!**************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_array-from-iterable.js ***!\n  \\**************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar forOf = __webpack_require__(/*! ./_for-of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_for-of.js\");\n\nmodule.exports = function (iter, ITERATOR) {\n  var result = [];\n  forOf(iter, false, result.push, result, ITERATOR);\n  return result;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-includes.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_array-includes.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// false -> Array#indexOf\n// true  -> Array#includes\nvar toIObject = __webpack_require__(/*! ./_to-iobject */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-iobject.js\");\nvar toLength = __webpack_require__(/*! ./_to-length */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-length.js\");\nvar toAbsoluteIndex = __webpack_require__(/*! ./_to-absolute-index */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-absolute-index.js\");\nmodule.exports = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIObject($this);\n    var length = toLength(O.length);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) if (IS_INCLUDES || index in O) {\n      if (O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-methods.js\":\n/*!********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_array-methods.js ***!\n  \\********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 0 -> Array#forEach\n// 1 -> Array#map\n// 2 -> Array#filter\n// 3 -> Array#some\n// 4 -> Array#every\n// 5 -> Array#find\n// 6 -> Array#findIndex\nvar ctx = __webpack_require__(/*! ./_ctx */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\");\nvar IObject = __webpack_require__(/*! ./_iobject */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iobject.js\");\nvar toObject = __webpack_require__(/*! ./_to-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-object.js\");\nvar toLength = __webpack_require__(/*! ./_to-length */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-length.js\");\nvar asc = __webpack_require__(/*! ./_array-species-create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-species-create.js\");\nmodule.exports = function (TYPE, $create) {\n  var IS_MAP = TYPE == 1;\n  var IS_FILTER = TYPE == 2;\n  var IS_SOME = TYPE == 3;\n  var IS_EVERY = TYPE == 4;\n  var IS_FIND_INDEX = TYPE == 6;\n  var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;\n  var create = $create || asc;\n  return function ($this, callbackfn, that) {\n    var O = toObject($this);\n    var self = IObject(O);\n    var f = ctx(callbackfn, that, 3);\n    var length = toLength(self.length);\n    var index = 0;\n    var result = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined;\n    var val, res;\n    for (;length > index; index++) if (NO_HOLES || index in self) {\n      val = self[index];\n      res = f(val, index, O);\n      if (TYPE) {\n        if (IS_MAP) result[index] = res;   // map\n        else if (res) switch (TYPE) {\n          case 3: return true;             // some\n          case 5: return val;              // find\n          case 6: return index;            // findIndex\n          case 2: result.push(val);        // filter\n        } else if (IS_EVERY) return false; // every\n      }\n    }\n    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;\n  };\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-species-constructor.js\":\n/*!********************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_array-species-constructor.js ***!\n  \\********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nvar isArray = __webpack_require__(/*! ./_is-array */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-array.js\");\nvar SPECIES = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('species');\n\nmodule.exports = function (original) {\n  var C;\n  if (isArray(original)) {\n    C = original.constructor;\n    // cross-realm fallback\n    if (typeof C == 'function' && (C === Array || isArray(C.prototype))) C = undefined;\n    if (isObject(C)) {\n      C = C[SPECIES];\n      if (C === null) C = undefined;\n    }\n  } return C === undefined ? Array : C;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-species-create.js\":\n/*!***************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_array-species-create.js ***!\n  \\***************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 9.4.2.3 ArraySpeciesCreate(originalArray, length)\nvar speciesConstructor = __webpack_require__(/*! ./_array-species-constructor */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-species-constructor.js\");\n\nmodule.exports = function (original, length) {\n  return new (speciesConstructor(original))(length);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_classof.js\":\n/*!**************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_classof.js ***!\n  \\**************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// getting tag from 19.1.3.6 Object.prototype.toString()\nvar cof = __webpack_require__(/*! ./_cof */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_cof.js\");\nvar TAG = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('toStringTag');\n// ES3 wrong here\nvar ARG = cof(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (e) { /* empty */ }\n};\n\nmodule.exports = function (it) {\n  var O, T, B;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (T = tryGet(O = Object(it), TAG)) == 'string' ? T\n    // builtinTag case\n    : ARG ? cof(O)\n    // ES3 arguments fallback\n    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_cof.js\":\n/*!**********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_cof.js ***!\n  \\**********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nvar toString = {}.toString;\n\nmodule.exports = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_collection-strong.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_collection-strong.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar dP = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\").f;\nvar create = __webpack_require__(/*! ./_object-create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-create.js\");\nvar redefineAll = __webpack_require__(/*! ./_redefine-all */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_redefine-all.js\");\nvar ctx = __webpack_require__(/*! ./_ctx */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\");\nvar anInstance = __webpack_require__(/*! ./_an-instance */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-instance.js\");\nvar forOf = __webpack_require__(/*! ./_for-of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_for-of.js\");\nvar $iterDefine = __webpack_require__(/*! ./_iter-define */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-define.js\");\nvar step = __webpack_require__(/*! ./_iter-step */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-step.js\");\nvar setSpecies = __webpack_require__(/*! ./_set-species */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-species.js\");\nvar DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\");\nvar fastKey = __webpack_require__(/*! ./_meta */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_meta.js\").fastKey;\nvar validate = __webpack_require__(/*! ./_validate-collection */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_validate-collection.js\");\nvar SIZE = DESCRIPTORS ? '_s' : 'size';\n\nvar getEntry = function (that, key) {\n  // fast case\n  var index = fastKey(key);\n  var entry;\n  if (index !== 'F') return that._i[index];\n  // frozen object case\n  for (entry = that._f; entry; entry = entry.n) {\n    if (entry.k == key) return entry;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function (wrapper, NAME, IS_MAP, ADDER) {\n    var C = wrapper(function (that, iterable) {\n      anInstance(that, C, NAME, '_i');\n      that._t = NAME;         // collection type\n      that._i = create(null); // index\n      that._f = undefined;    // first entry\n      that._l = undefined;    // last entry\n      that[SIZE] = 0;         // size\n      if (iterable != undefined) forOf(iterable, IS_MAP, that[ADDER], that);\n    });\n    redefineAll(C.prototype, {\n      // 23.1.3.1 Map.prototype.clear()\n      // 23.2.3.2 Set.prototype.clear()\n      clear: function clear() {\n        for (var that = validate(this, NAME), data = that._i, entry = that._f; entry; entry = entry.n) {\n          entry.r = true;\n          if (entry.p) entry.p = entry.p.n = undefined;\n          delete data[entry.i];\n        }\n        that._f = that._l = undefined;\n        that[SIZE] = 0;\n      },\n      // 23.1.3.3 Map.prototype.delete(key)\n      // 23.2.3.4 Set.prototype.delete(value)\n      'delete': function (key) {\n        var that = validate(this, NAME);\n        var entry = getEntry(that, key);\n        if (entry) {\n          var next = entry.n;\n          var prev = entry.p;\n          delete that._i[entry.i];\n          entry.r = true;\n          if (prev) prev.n = next;\n          if (next) next.p = prev;\n          if (that._f == entry) that._f = next;\n          if (that._l == entry) that._l = prev;\n          that[SIZE]--;\n        } return !!entry;\n      },\n      // 23.2.3.6 Set.prototype.forEach(callbackfn, thisArg = undefined)\n      // 23.1.3.5 Map.prototype.forEach(callbackfn, thisArg = undefined)\n      forEach: function forEach(callbackfn /* , that = undefined */) {\n        validate(this, NAME);\n        var f = ctx(callbackfn, arguments.length > 1 ? arguments[1] : undefined, 3);\n        var entry;\n        while (entry = entry ? entry.n : this._f) {\n          f(entry.v, entry.k, this);\n          // revert to the last existing entry\n          while (entry && entry.r) entry = entry.p;\n        }\n      },\n      // 23.1.3.7 Map.prototype.has(key)\n      // 23.2.3.7 Set.prototype.has(value)\n      has: function has(key) {\n        return !!getEntry(validate(this, NAME), key);\n      }\n    });\n    if (DESCRIPTORS) dP(C.prototype, 'size', {\n      get: function () {\n        return validate(this, NAME)[SIZE];\n      }\n    });\n    return C;\n  },\n  def: function (that, key, value) {\n    var entry = getEntry(that, key);\n    var prev, index;\n    // change existing entry\n    if (entry) {\n      entry.v = value;\n    // create new entry\n    } else {\n      that._l = entry = {\n        i: index = fastKey(key, true), // <- index\n        k: key,                        // <- key\n        v: value,                      // <- value\n        p: prev = that._l,             // <- previous entry\n        n: undefined,                  // <- next entry\n        r: false                       // <- removed\n      };\n      if (!that._f) that._f = entry;\n      if (prev) prev.n = entry;\n      that[SIZE]++;\n      // add to index\n      if (index !== 'F') that._i[index] = entry;\n    } return that;\n  },\n  getEntry: getEntry,\n  setStrong: function (C, NAME, IS_MAP) {\n    // add .keys, .values, .entries, [@@iterator]\n    // 23.1.3.4, 23.1.3.8, 23.1.3.11, 23.1.3.12, 23.2.3.5, 23.2.3.8, 23.2.3.10, 23.2.3.11\n    $iterDefine(C, NAME, function (iterated, kind) {\n      this._t = validate(iterated, NAME); // target\n      this._k = kind;                     // kind\n      this._l = undefined;                // previous\n    }, function () {\n      var that = this;\n      var kind = that._k;\n      var entry = that._l;\n      // revert to the last existing entry\n      while (entry && entry.r) entry = entry.p;\n      // get next entry\n      if (!that._t || !(that._l = entry = entry ? entry.n : that._t._f)) {\n        // or finish the iteration\n        that._t = undefined;\n        return step(1);\n      }\n      // return step by kind\n      if (kind == 'keys') return step(0, entry.k);\n      if (kind == 'values') return step(0, entry.v);\n      return step(0, [entry.k, entry.v]);\n    }, IS_MAP ? 'entries' : 'values', !IS_MAP, true);\n\n    // add [@@species], 23.1.2.2, 23.2.2.2\n    setSpecies(NAME);\n  }\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_collection-to-json.js\":\n/*!*************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_collection-to-json.js ***!\n  \\*************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// https://github.com/DavidBruant/Map-Set.prototype.toJSON\nvar classof = __webpack_require__(/*! ./_classof */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_classof.js\");\nvar from = __webpack_require__(/*! ./_array-from-iterable */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-from-iterable.js\");\nmodule.exports = function (NAME) {\n  return function toJSON() {\n    if (classof(this) != NAME) throw TypeError(NAME + \"#toJSON isn't generic\");\n    return from(this);\n  };\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_collection.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_collection.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\nvar meta = __webpack_require__(/*! ./_meta */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_meta.js\");\nvar fails = __webpack_require__(/*! ./_fails */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_fails.js\");\nvar hide = __webpack_require__(/*! ./_hide */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js\");\nvar redefineAll = __webpack_require__(/*! ./_redefine-all */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_redefine-all.js\");\nvar forOf = __webpack_require__(/*! ./_for-of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_for-of.js\");\nvar anInstance = __webpack_require__(/*! ./_an-instance */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-instance.js\");\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nvar setToStringTag = __webpack_require__(/*! ./_set-to-string-tag */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-to-string-tag.js\");\nvar dP = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\").f;\nvar each = __webpack_require__(/*! ./_array-methods */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-methods.js\")(0);\nvar DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\");\n\nmodule.exports = function (NAME, wrapper, methods, common, IS_MAP, IS_WEAK) {\n  var Base = global[NAME];\n  var C = Base;\n  var ADDER = IS_MAP ? 'set' : 'add';\n  var proto = C && C.prototype;\n  var O = {};\n  if (!DESCRIPTORS || typeof C != 'function' || !(IS_WEAK || proto.forEach && !fails(function () {\n    new C().entries().next();\n  }))) {\n    // create collection constructor\n    C = common.getConstructor(wrapper, NAME, IS_MAP, ADDER);\n    redefineAll(C.prototype, methods);\n    meta.NEED = true;\n  } else {\n    C = wrapper(function (target, iterable) {\n      anInstance(target, C, NAME, '_c');\n      target._c = new Base();\n      if (iterable != undefined) forOf(iterable, IS_MAP, target[ADDER], target);\n    });\n    each('add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON'.split(','), function (KEY) {\n      var IS_ADDER = KEY == 'add' || KEY == 'set';\n      if (KEY in proto && !(IS_WEAK && KEY == 'clear')) hide(C.prototype, KEY, function (a, b) {\n        anInstance(this, C, KEY);\n        if (!IS_ADDER && IS_WEAK && !isObject(a)) return KEY == 'get' ? undefined : false;\n        var result = this._c[KEY](a === 0 ? 0 : a, b);\n        return IS_ADDER ? this : result;\n      });\n    });\n    IS_WEAK || dP(C.prototype, 'size', {\n      get: function () {\n        return this._c.size;\n      }\n    });\n  }\n\n  setToStringTag(C, NAME);\n\n  O[NAME] = C;\n  $export($export.G + $export.W + $export.F, O);\n\n  if (!IS_WEAK) common.setStrong(C, NAME, IS_MAP);\n\n  return C;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\":\n/*!***********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js ***!\n  \\***********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nvar core = module.exports = { version: '2.6.11' };\nif (typeof __e == 'number') __e = core; // eslint-disable-line no-undef\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_create-property.js\":\n/*!**********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_create-property.js ***!\n  \\**********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar $defineProperty = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\");\nvar createDesc = __webpack_require__(/*! ./_property-desc */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_property-desc.js\");\n\nmodule.exports = function (object, index, value) {\n  if (index in object) $defineProperty.f(object, index, createDesc(0, value));\n  else object[index] = value;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\":\n/*!**********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js ***!\n  \\**********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// optional / simple context binding\nvar aFunction = __webpack_require__(/*! ./_a-function */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_a-function.js\");\nmodule.exports = function (fn, that, length) {\n  aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_defined.js\":\n/*!**************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_defined.js ***!\n  \\**************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n// 7.2.1 RequireObjectCoercible(argument)\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on  \" + it);\n  return it;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !__webpack_require__(/*! ./_fails */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_fails.js\")(function () {\n  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_dom-create.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_dom-create.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nvar document = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\").document;\n// typeof document.createElement is 'object' in old IE\nvar is = isObject(document) && isObject(document.createElement);\nmodule.exports = function (it) {\n  return is ? document.createElement(it) : {};\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_enum-bug-keys.js\":\n/*!********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_enum-bug-keys.js ***!\n  \\********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n// IE 8- don't enum bug keys\nmodule.exports = (\n  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'\n).split(',');\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_enum-keys.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_enum-keys.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// all enumerable object keys, includes symbols\nvar getKeys = __webpack_require__(/*! ./_object-keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys.js\");\nvar gOPS = __webpack_require__(/*! ./_object-gops */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gops.js\");\nvar pIE = __webpack_require__(/*! ./_object-pie */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-pie.js\");\nmodule.exports = function (it) {\n  var result = getKeys(it);\n  var getSymbols = gOPS.f;\n  if (getSymbols) {\n    var symbols = getSymbols(it);\n    var isEnum = pIE.f;\n    var i = 0;\n    var key;\n    while (symbols.length > i) if (isEnum.call(it, key = symbols[i++])) result.push(key);\n  } return result;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar core = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\");\nvar ctx = __webpack_require__(/*! ./_ctx */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\");\nvar hide = __webpack_require__(/*! ./_hide */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js\");\nvar has = __webpack_require__(/*! ./_has */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_has.js\");\nvar PROTOTYPE = 'prototype';\n\nvar $export = function (type, name, source) {\n  var IS_FORCED = type & $export.F;\n  var IS_GLOBAL = type & $export.G;\n  var IS_STATIC = type & $export.S;\n  var IS_PROTO = type & $export.P;\n  var IS_BIND = type & $export.B;\n  var IS_WRAP = type & $export.W;\n  var exports = IS_GLOBAL ? core : core[name] || (core[name] = {});\n  var expProto = exports[PROTOTYPE];\n  var target = IS_GLOBAL ? global : IS_STATIC ? global[name] : (global[name] || {})[PROTOTYPE];\n  var key, own, out;\n  if (IS_GLOBAL) source = name;\n  for (key in source) {\n    // contains in native\n    own = !IS_FORCED && target && target[key] !== undefined;\n    if (own && has(exports, key)) continue;\n    // export native or passed\n    out = own ? target[key] : source[key];\n    // prevent global pollution for namespaces\n    exports[key] = IS_GLOBAL && typeof target[key] != 'function' ? source[key]\n    // bind timers to global for call from export context\n    : IS_BIND && own ? ctx(out, global)\n    // wrap global constructors for prevent change them in library\n    : IS_WRAP && target[key] == out ? (function (C) {\n      var F = function (a, b, c) {\n        if (this instanceof C) {\n          switch (arguments.length) {\n            case 0: return new C();\n            case 1: return new C(a);\n            case 2: return new C(a, b);\n          } return new C(a, b, c);\n        } return C.apply(this, arguments);\n      };\n      F[PROTOTYPE] = C[PROTOTYPE];\n      return F;\n    // make static versions for prototype methods\n    })(out) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;\n    // export proto methods to core.%CONSTRUCTOR%.methods.%NAME%\n    if (IS_PROTO) {\n      (exports.virtual || (exports.virtual = {}))[key] = out;\n      // export proto methods to core.%CONSTRUCTOR%.prototype.%NAME%\n      if (type & $export.R && expProto && !expProto[key]) hide(expProto, key, out);\n    }\n  }\n};\n// type bitmap\n$export.F = 1;   // forced\n$export.G = 2;   // global\n$export.S = 4;   // static\n$export.P = 8;   // proto\n$export.B = 16;  // bind\n$export.W = 32;  // wrap\n$export.U = 64;  // safe\n$export.R = 128; // real proto method for `library`\nmodule.exports = $export;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_fails.js\":\n/*!************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_fails.js ***!\n  \\************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (e) {\n    return true;\n  }\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_for-of.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_for-of.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar ctx = __webpack_require__(/*! ./_ctx */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\");\nvar call = __webpack_require__(/*! ./_iter-call */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-call.js\");\nvar isArrayIter = __webpack_require__(/*! ./_is-array-iter */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-array-iter.js\");\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nvar toLength = __webpack_require__(/*! ./_to-length */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-length.js\");\nvar getIterFn = __webpack_require__(/*! ./core.get-iterator-method */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/core.get-iterator-method.js\");\nvar BREAK = {};\nvar RETURN = {};\nvar exports = module.exports = function (iterable, entries, fn, that, ITERATOR) {\n  var iterFn = ITERATOR ? function () { return iterable; } : getIterFn(iterable);\n  var f = ctx(fn, that, entries ? 2 : 1);\n  var index = 0;\n  var length, step, iterator, result;\n  if (typeof iterFn != 'function') throw TypeError(iterable + ' is not iterable!');\n  // fast case for arrays with default iterator\n  if (isArrayIter(iterFn)) for (length = toLength(iterable.length); length > index; index++) {\n    result = entries ? f(anObject(step = iterable[index])[0], step[1]) : f(iterable[index]);\n    if (result === BREAK || result === RETURN) return result;\n  } else for (iterator = iterFn.call(iterable); !(step = iterator.next()).done;) {\n    result = call(iterator, f, step.value, entries);\n    if (result === BREAK || result === RETURN) return result;\n  }\n};\nexports.BREAK = BREAK;\nexports.RETURN = RETURN;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n  ? window : typeof self != 'undefined' && self.Math == Math ? self\n  // eslint-disable-next-line no-new-func\n  : Function('return this')();\nif (typeof __g == 'number') __g = global; // eslint-disable-line no-undef\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_has.js\":\n/*!**********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_has.js ***!\n  \\**********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nvar hasOwnProperty = {}.hasOwnProperty;\nmodule.exports = function (it, key) {\n  return hasOwnProperty.call(it, key);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js\":\n/*!***********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js ***!\n  \\***********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar dP = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\");\nvar createDesc = __webpack_require__(/*! ./_property-desc */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_property-desc.js\");\nmodule.exports = __webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\") ? function (object, key, value) {\n  return dP.f(object, key, createDesc(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_html.js\":\n/*!***********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_html.js ***!\n  \\***********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar document = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\").document;\nmodule.exports = document && document.documentElement;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ie8-dom-define.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_ie8-dom-define.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = !__webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\") && !__webpack_require__(/*! ./_fails */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_fails.js\")(function () {\n  return Object.defineProperty(__webpack_require__(/*! ./_dom-create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_dom-create.js\")('div'), 'a', { get: function () { return 7; } }).a != 7;\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_invoke.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_invoke.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n// fast apply, http://jsperf.lnkit.com/fast-apply/5\nmodule.exports = function (fn, args, that) {\n  var un = that === undefined;\n  switch (args.length) {\n    case 0: return un ? fn()\n                      : fn.call(that);\n    case 1: return un ? fn(args[0])\n                      : fn.call(that, args[0]);\n    case 2: return un ? fn(args[0], args[1])\n                      : fn.call(that, args[0], args[1]);\n    case 3: return un ? fn(args[0], args[1], args[2])\n                      : fn.call(that, args[0], args[1], args[2]);\n    case 4: return un ? fn(args[0], args[1], args[2], args[3])\n                      : fn.call(that, args[0], args[1], args[2], args[3]);\n  } return fn.apply(that, args);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iobject.js\":\n/*!**************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_iobject.js ***!\n  \\**************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nvar cof = __webpack_require__(/*! ./_cof */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_cof.js\");\n// eslint-disable-next-line no-prototype-builtins\nmodule.exports = Object('z').propertyIsEnumerable(0) ? Object : function (it) {\n  return cof(it) == 'String' ? it.split('') : Object(it);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-array-iter.js\":\n/*!********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_is-array-iter.js ***!\n  \\********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// check on default Array iterator\nvar Iterators = __webpack_require__(/*! ./_iterators */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iterators.js\");\nvar ITERATOR = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('iterator');\nvar ArrayProto = Array.prototype;\n\nmodule.exports = function (it) {\n  return it !== undefined && (Iterators.Array === it || ArrayProto[ITERATOR] === it);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-array.js\":\n/*!***************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_is-array.js ***!\n  \\***************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 7.2.2 IsArray(argument)\nvar cof = __webpack_require__(/*! ./_cof */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_cof.js\");\nmodule.exports = Array.isArray || function isArray(arg) {\n  return cof(arg) == 'Array';\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = function (it) {\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-call.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-call.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// call something on iterator step with safe closing on error\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nmodule.exports = function (iterator, fn, value, entries) {\n  try {\n    return entries ? fn(anObject(value)[0], value[1]) : fn(value);\n  // 7.4.6 IteratorClose(iterator, completion)\n  } catch (e) {\n    var ret = iterator['return'];\n    if (ret !== undefined) anObject(ret.call(iterator));\n    throw e;\n  }\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-create.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-create.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar create = __webpack_require__(/*! ./_object-create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-create.js\");\nvar descriptor = __webpack_require__(/*! ./_property-desc */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_property-desc.js\");\nvar setToStringTag = __webpack_require__(/*! ./_set-to-string-tag */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-to-string-tag.js\");\nvar IteratorPrototype = {};\n\n// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()\n__webpack_require__(/*! ./_hide */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js\")(IteratorPrototype, __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('iterator'), function () { return this; });\n\nmodule.exports = function (Constructor, NAME, next) {\n  Constructor.prototype = create(IteratorPrototype, { next: descriptor(1, next) });\n  setToStringTag(Constructor, NAME + ' Iterator');\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-define.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-define.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar LIBRARY = __webpack_require__(/*! ./_library */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_library.js\");\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\nvar redefine = __webpack_require__(/*! ./_redefine */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_redefine.js\");\nvar hide = __webpack_require__(/*! ./_hide */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js\");\nvar Iterators = __webpack_require__(/*! ./_iterators */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iterators.js\");\nvar $iterCreate = __webpack_require__(/*! ./_iter-create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-create.js\");\nvar setToStringTag = __webpack_require__(/*! ./_set-to-string-tag */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-to-string-tag.js\");\nvar getPrototypeOf = __webpack_require__(/*! ./_object-gpo */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gpo.js\");\nvar ITERATOR = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('iterator');\nvar BUGGY = !([].keys && 'next' in [].keys()); // Safari has buggy iterators w/o `next`\nvar FF_ITERATOR = '@@iterator';\nvar KEYS = 'keys';\nvar VALUES = 'values';\n\nvar returnThis = function () { return this; };\n\nmodule.exports = function (Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED) {\n  $iterCreate(Constructor, NAME, next);\n  var getMethod = function (kind) {\n    if (!BUGGY && kind in proto) return proto[kind];\n    switch (kind) {\n      case KEYS: return function keys() { return new Constructor(this, kind); };\n      case VALUES: return function values() { return new Constructor(this, kind); };\n    } return function entries() { return new Constructor(this, kind); };\n  };\n  var TAG = NAME + ' Iterator';\n  var DEF_VALUES = DEFAULT == VALUES;\n  var VALUES_BUG = false;\n  var proto = Base.prototype;\n  var $native = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT];\n  var $default = $native || getMethod(DEFAULT);\n  var $entries = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined;\n  var $anyNative = NAME == 'Array' ? proto.entries || $native : $native;\n  var methods, key, IteratorPrototype;\n  // Fix native\n  if ($anyNative) {\n    IteratorPrototype = getPrototypeOf($anyNative.call(new Base()));\n    if (IteratorPrototype !== Object.prototype && IteratorPrototype.next) {\n      // Set @@toStringTag to native iterators\n      setToStringTag(IteratorPrototype, TAG, true);\n      // fix for some old engines\n      if (!LIBRARY && typeof IteratorPrototype[ITERATOR] != 'function') hide(IteratorPrototype, ITERATOR, returnThis);\n    }\n  }\n  // fix Array#{values, @@iterator}.name in V8 / FF\n  if (DEF_VALUES && $native && $native.name !== VALUES) {\n    VALUES_BUG = true;\n    $default = function values() { return $native.call(this); };\n  }\n  // Define iterator\n  if ((!LIBRARY || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])) {\n    hide(proto, ITERATOR, $default);\n  }\n  // Plug for library\n  Iterators[NAME] = $default;\n  Iterators[TAG] = returnThis;\n  if (DEFAULT) {\n    methods = {\n      values: DEF_VALUES ? $default : getMethod(VALUES),\n      keys: IS_SET ? $default : getMethod(KEYS),\n      entries: $entries\n    };\n    if (FORCED) for (key in methods) {\n      if (!(key in proto)) redefine(proto, key, methods[key]);\n    } else $export($export.P + $export.F * (BUGGY || VALUES_BUG), NAME, methods);\n  }\n  return methods;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-detect.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-detect.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar ITERATOR = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('iterator');\nvar SAFE_CLOSING = false;\n\ntry {\n  var riter = [7][ITERATOR]();\n  riter['return'] = function () { SAFE_CLOSING = true; };\n  // eslint-disable-next-line no-throw-literal\n  Array.from(riter, function () { throw 2; });\n} catch (e) { /* empty */ }\n\nmodule.exports = function (exec, skipClosing) {\n  if (!skipClosing && !SAFE_CLOSING) return false;\n  var safe = false;\n  try {\n    var arr = [7];\n    var iter = arr[ITERATOR]();\n    iter.next = function () { return { done: safe = true }; };\n    arr[ITERATOR] = function () { return iter; };\n    exec(arr);\n  } catch (e) { /* empty */ }\n  return safe;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-step.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-step.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = function (done, value) {\n  return { value: value, done: !!done };\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iterators.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_iterators.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = {};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_library.js\":\n/*!**************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_library.js ***!\n  \\**************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = true;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_meta.js\":\n/*!***********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_meta.js ***!\n  \\***********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar META = __webpack_require__(/*! ./_uid */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_uid.js\")('meta');\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nvar has = __webpack_require__(/*! ./_has */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_has.js\");\nvar setDesc = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\").f;\nvar id = 0;\nvar isExtensible = Object.isExtensible || function () {\n  return true;\n};\nvar FREEZE = !__webpack_require__(/*! ./_fails */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_fails.js\")(function () {\n  return isExtensible(Object.preventExtensions({}));\n});\nvar setMeta = function (it) {\n  setDesc(it, META, { value: {\n    i: 'O' + ++id, // object ID\n    w: {}          // weak collections IDs\n  } });\n};\nvar fastKey = function (it, create) {\n  // return primitive with prefix\n  if (!isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;\n  if (!has(it, META)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return 'F';\n    // not necessary to add metadata\n    if (!create) return 'E';\n    // add missing metadata\n    setMeta(it);\n  // return object ID\n  } return it[META].i;\n};\nvar getWeak = function (it, create) {\n  if (!has(it, META)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return true;\n    // not necessary to add metadata\n    if (!create) return false;\n    // add missing metadata\n    setMeta(it);\n  // return hash weak collections IDs\n  } return it[META].w;\n};\n// add metadata on freeze-family methods calling\nvar onFreeze = function (it) {\n  if (FREEZE && meta.NEED && isExtensible(it) && !has(it, META)) setMeta(it);\n  return it;\n};\nvar meta = module.exports = {\n  KEY: META,\n  NEED: false,\n  fastKey: fastKey,\n  getWeak: getWeak,\n  onFreeze: onFreeze\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_microtask.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_microtask.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar macrotask = __webpack_require__(/*! ./_task */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_task.js\").set;\nvar Observer = global.MutationObserver || global.WebKitMutationObserver;\nvar process = global.process;\nvar Promise = global.Promise;\nvar isNode = __webpack_require__(/*! ./_cof */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_cof.js\")(process) == 'process';\n\nmodule.exports = function () {\n  var head, last, notify;\n\n  var flush = function () {\n    var parent, fn;\n    if (isNode && (parent = process.domain)) parent.exit();\n    while (head) {\n      fn = head.fn;\n      head = head.next;\n      try {\n        fn();\n      } catch (e) {\n        if (head) notify();\n        else last = undefined;\n        throw e;\n      }\n    } last = undefined;\n    if (parent) parent.enter();\n  };\n\n  // Node.js\n  if (isNode) {\n    notify = function () {\n      process.nextTick(flush);\n    };\n  // browsers with MutationObserver, except iOS Safari - https://github.com/zloirock/core-js/issues/339\n  } else if (Observer && !(global.navigator && global.navigator.standalone)) {\n    var toggle = true;\n    var node = document.createTextNode('');\n    new Observer(flush).observe(node, { characterData: true }); // eslint-disable-line no-new\n    notify = function () {\n      node.data = toggle = !toggle;\n    };\n  // environments with maybe non-completely correct, but existent Promise\n  } else if (Promise && Promise.resolve) {\n    // Promise.resolve without an argument throws an error in LG WebOS 2\n    var promise = Promise.resolve(undefined);\n    notify = function () {\n      promise.then(flush);\n    };\n  // for other environments - macrotask based on:\n  // - setImmediate\n  // - MessageChannel\n  // - window.postMessag\n  // - onreadystatechange\n  // - setTimeout\n  } else {\n    notify = function () {\n      // strange IE + webpack dev server bug - use .call(global)\n      macrotask.call(global, flush);\n    };\n  }\n\n  return function (fn) {\n    var task = { fn: fn, next: undefined };\n    if (last) last.next = task;\n    if (!head) {\n      head = task;\n      notify();\n    } last = task;\n  };\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_new-promise-capability.js\":\n/*!*****************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_new-promise-capability.js ***!\n  \\*****************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n// 25.4.1.5 NewPromiseCapability(C)\nvar aFunction = __webpack_require__(/*! ./_a-function */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_a-function.js\");\n\nfunction PromiseCapability(C) {\n  var resolve, reject;\n  this.promise = new C(function ($$resolve, $$reject) {\n    if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject = $$reject;\n  });\n  this.resolve = aFunction(resolve);\n  this.reject = aFunction(reject);\n}\n\nmodule.exports.f = function (C) {\n  return new PromiseCapability(C);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-assign.js\":\n/*!********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-assign.js ***!\n  \\********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n// 19.1.2.1 Object.assign(target, source, ...)\nvar DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\");\nvar getKeys = __webpack_require__(/*! ./_object-keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys.js\");\nvar gOPS = __webpack_require__(/*! ./_object-gops */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gops.js\");\nvar pIE = __webpack_require__(/*! ./_object-pie */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-pie.js\");\nvar toObject = __webpack_require__(/*! ./_to-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-object.js\");\nvar IObject = __webpack_require__(/*! ./_iobject */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iobject.js\");\nvar $assign = Object.assign;\n\n// should work with symbols and should have deterministic property order (V8 bug)\nmodule.exports = !$assign || __webpack_require__(/*! ./_fails */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_fails.js\")(function () {\n  var A = {};\n  var B = {};\n  // eslint-disable-next-line no-undef\n  var S = Symbol();\n  var K = 'abcdefghijklmnopqrst';\n  A[S] = 7;\n  K.split('').forEach(function (k) { B[k] = k; });\n  return $assign({}, A)[S] != 7 || Object.keys($assign({}, B)).join('') != K;\n}) ? function assign(target, source) { // eslint-disable-line no-unused-vars\n  var T = toObject(target);\n  var aLen = arguments.length;\n  var index = 1;\n  var getSymbols = gOPS.f;\n  var isEnum = pIE.f;\n  while (aLen > index) {\n    var S = IObject(arguments[index++]);\n    var keys = getSymbols ? getKeys(S).concat(getSymbols(S)) : getKeys(S);\n    var length = keys.length;\n    var j = 0;\n    var key;\n    while (length > j) {\n      key = keys[j++];\n      if (!DESCRIPTORS || isEnum.call(S, key)) T[key] = S[key];\n    }\n  } return T;\n} : $assign;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-create.js\":\n/*!********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-create.js ***!\n  \\********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nvar dPs = __webpack_require__(/*! ./_object-dps */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dps.js\");\nvar enumBugKeys = __webpack_require__(/*! ./_enum-bug-keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_enum-bug-keys.js\");\nvar IE_PROTO = __webpack_require__(/*! ./_shared-key */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_shared-key.js\")('IE_PROTO');\nvar Empty = function () { /* empty */ };\nvar PROTOTYPE = 'prototype';\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar createDict = function () {\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = __webpack_require__(/*! ./_dom-create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_dom-create.js\")('iframe');\n  var i = enumBugKeys.length;\n  var lt = '<';\n  var gt = '>';\n  var iframeDocument;\n  iframe.style.display = 'none';\n  __webpack_require__(/*! ./_html */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_html.js\").appendChild(iframe);\n  iframe.src = 'javascript:'; // eslint-disable-line no-script-url\n  // createDict = iframe.contentWindow.Object;\n  // html.removeChild(iframe);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(lt + 'script' + gt + 'document.F=Object' + lt + '/script' + gt);\n  iframeDocument.close();\n  createDict = iframeDocument.F;\n  while (i--) delete createDict[PROTOTYPE][enumBugKeys[i]];\n  return createDict();\n};\n\nmodule.exports = Object.create || function create(O, Properties) {\n  var result;\n  if (O !== null) {\n    Empty[PROTOTYPE] = anObject(O);\n    result = new Empty();\n    Empty[PROTOTYPE] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO] = O;\n  } else result = createDict();\n  return Properties === undefined ? result : dPs(result, Properties);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nvar IE8_DOM_DEFINE = __webpack_require__(/*! ./_ie8-dom-define */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ie8-dom-define.js\");\nvar toPrimitive = __webpack_require__(/*! ./_to-primitive */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-primitive.js\");\nvar dP = Object.defineProperty;\n\nexports.f = __webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\") ? Object.defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPrimitive(P, true);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return dP(O, P, Attributes);\n  } catch (e) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dps.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dps.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar dP = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\");\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nvar getKeys = __webpack_require__(/*! ./_object-keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys.js\");\n\nmodule.exports = __webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\") ? Object.defineProperties : function defineProperties(O, Properties) {\n  anObject(O);\n  var keys = getKeys(Properties);\n  var length = keys.length;\n  var i = 0;\n  var P;\n  while (length > i) dP.f(O, P = keys[i++], Properties[P]);\n  return O;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopd.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopd.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar pIE = __webpack_require__(/*! ./_object-pie */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-pie.js\");\nvar createDesc = __webpack_require__(/*! ./_property-desc */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_property-desc.js\");\nvar toIObject = __webpack_require__(/*! ./_to-iobject */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-iobject.js\");\nvar toPrimitive = __webpack_require__(/*! ./_to-primitive */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-primitive.js\");\nvar has = __webpack_require__(/*! ./_has */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_has.js\");\nvar IE8_DOM_DEFINE = __webpack_require__(/*! ./_ie8-dom-define */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ie8-dom-define.js\");\nvar gOPD = Object.getOwnPropertyDescriptor;\n\nexports.f = __webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\") ? gOPD : function getOwnPropertyDescriptor(O, P) {\n  O = toIObject(O);\n  P = toPrimitive(P, true);\n  if (IE8_DOM_DEFINE) try {\n    return gOPD(O, P);\n  } catch (e) { /* empty */ }\n  if (has(O, P)) return createDesc(!pIE.f.call(O, P), O[P]);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopn-ext.js\":\n/*!**********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopn-ext.js ***!\n  \\**********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window\nvar toIObject = __webpack_require__(/*! ./_to-iobject */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-iobject.js\");\nvar gOPN = __webpack_require__(/*! ./_object-gopn */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopn.js\").f;\nvar toString = {}.toString;\n\nvar windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames\n  ? Object.getOwnPropertyNames(window) : [];\n\nvar getWindowNames = function (it) {\n  try {\n    return gOPN(it);\n  } catch (e) {\n    return windowNames.slice();\n  }\n};\n\nmodule.exports.f = function getOwnPropertyNames(it) {\n  return windowNames && toString.call(it) == '[object Window]' ? getWindowNames(it) : gOPN(toIObject(it));\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopn.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopn.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)\nvar $keys = __webpack_require__(/*! ./_object-keys-internal */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys-internal.js\");\nvar hiddenKeys = __webpack_require__(/*! ./_enum-bug-keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_enum-bug-keys.js\").concat('length', 'prototype');\n\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return $keys(O, hiddenKeys);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gops.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gops.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nexports.f = Object.getOwnPropertySymbols;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gpo.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gpo.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)\nvar has = __webpack_require__(/*! ./_has */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_has.js\");\nvar toObject = __webpack_require__(/*! ./_to-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-object.js\");\nvar IE_PROTO = __webpack_require__(/*! ./_shared-key */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_shared-key.js\")('IE_PROTO');\nvar ObjectProto = Object.prototype;\n\nmodule.exports = Object.getPrototypeOf || function (O) {\n  O = toObject(O);\n  if (has(O, IE_PROTO)) return O[IE_PROTO];\n  if (typeof O.constructor == 'function' && O instanceof O.constructor) {\n    return O.constructor.prototype;\n  } return O instanceof Object ? ObjectProto : null;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys-internal.js\":\n/*!***************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys-internal.js ***!\n  \\***************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar has = __webpack_require__(/*! ./_has */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_has.js\");\nvar toIObject = __webpack_require__(/*! ./_to-iobject */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-iobject.js\");\nvar arrayIndexOf = __webpack_require__(/*! ./_array-includes */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_array-includes.js\")(false);\nvar IE_PROTO = __webpack_require__(/*! ./_shared-key */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_shared-key.js\")('IE_PROTO');\n\nmodule.exports = function (object, names) {\n  var O = toIObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) if (key != IE_PROTO) has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (has(O, key = names[i++])) {\n    ~arrayIndexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 19.1.2.14 / 15.2.3.14 Object.keys(O)\nvar $keys = __webpack_require__(/*! ./_object-keys-internal */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys-internal.js\");\nvar enumBugKeys = __webpack_require__(/*! ./_enum-bug-keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_enum-bug-keys.js\");\n\nmodule.exports = Object.keys || function keys(O) {\n  return $keys(O, enumBugKeys);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-pie.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-pie.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nexports.f = {}.propertyIsEnumerable;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-sap.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_object-sap.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// most Object methods by ES6 should accept primitives\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\nvar core = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\");\nvar fails = __webpack_require__(/*! ./_fails */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_fails.js\");\nmodule.exports = function (KEY, exec) {\n  var fn = (core.Object || {})[KEY] || Object[KEY];\n  var exp = {};\n  exp[KEY] = exec(fn);\n  $export($export.S + $export.F * fails(function () { fn(1); }), 'Object', exp);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_perform.js\":\n/*!**************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_perform.js ***!\n  \\**************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = function (exec) {\n  try {\n    return { e: false, v: exec() };\n  } catch (e) {\n    return { e: true, v: e };\n  }\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_promise-resolve.js\":\n/*!**********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_promise-resolve.js ***!\n  \\**********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nvar newPromiseCapability = __webpack_require__(/*! ./_new-promise-capability */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_new-promise-capability.js\");\n\nmodule.exports = function (C, x) {\n  anObject(C);\n  if (isObject(x) && x.constructor === C) return x;\n  var promiseCapability = newPromiseCapability.f(C);\n  var resolve = promiseCapability.resolve;\n  resolve(x);\n  return promiseCapability.promise;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_property-desc.js\":\n/*!********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_property-desc.js ***!\n  \\********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_redefine-all.js\":\n/*!*******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_redefine-all.js ***!\n  \\*******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar hide = __webpack_require__(/*! ./_hide */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js\");\nmodule.exports = function (target, src, safe) {\n  for (var key in src) {\n    if (safe && target[key]) target[key] = src[key];\n    else hide(target, key, src[key]);\n  } return target;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_redefine.js\":\n/*!***************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_redefine.js ***!\n  \\***************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(/*! ./_hide */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js\");\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-collection-from.js\":\n/*!**************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_set-collection-from.js ***!\n  \\**************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n// https://tc39.github.io/proposal-setmap-offrom/\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\nvar aFunction = __webpack_require__(/*! ./_a-function */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_a-function.js\");\nvar ctx = __webpack_require__(/*! ./_ctx */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\");\nvar forOf = __webpack_require__(/*! ./_for-of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_for-of.js\");\n\nmodule.exports = function (COLLECTION) {\n  $export($export.S, COLLECTION, { from: function from(source /* , mapFn, thisArg */) {\n    var mapFn = arguments[1];\n    var mapping, A, n, cb;\n    aFunction(this);\n    mapping = mapFn !== undefined;\n    if (mapping) aFunction(mapFn);\n    if (source == undefined) return new this();\n    A = [];\n    if (mapping) {\n      n = 0;\n      cb = ctx(mapFn, arguments[2], 2);\n      forOf(source, false, function (nextItem) {\n        A.push(cb(nextItem, n++));\n      });\n    } else {\n      forOf(source, false, A.push, A);\n    }\n    return new this(A);\n  } });\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-collection-of.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_set-collection-of.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n// https://tc39.github.io/proposal-setmap-offrom/\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\n\nmodule.exports = function (COLLECTION) {\n  $export($export.S, COLLECTION, { of: function of() {\n    var length = arguments.length;\n    var A = new Array(length);\n    while (length--) A[length] = arguments[length];\n    return new this(A);\n  } });\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-proto.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_set-proto.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// Works with __proto__ only. Old v8 can't work with null proto objects.\n/* eslint-disable no-proto */\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nvar check = function (O, proto) {\n  anObject(O);\n  if (!isObject(proto) && proto !== null) throw TypeError(proto + \": can't set as prototype!\");\n};\nmodule.exports = {\n  set: Object.setPrototypeOf || ('__proto__' in {} ? // eslint-disable-line\n    function (test, buggy, set) {\n      try {\n        set = __webpack_require__(/*! ./_ctx */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\")(Function.call, __webpack_require__(/*! ./_object-gopd */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopd.js\").f(Object.prototype, '__proto__').set, 2);\n        set(test, []);\n        buggy = !(test instanceof Array);\n      } catch (e) { buggy = true; }\n      return function setPrototypeOf(O, proto) {\n        check(O, proto);\n        if (buggy) O.__proto__ = proto;\n        else set(O, proto);\n        return O;\n      };\n    }({}, false) : undefined),\n  check: check\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-species.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_set-species.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar core = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\");\nvar dP = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\");\nvar DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\");\nvar SPECIES = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('species');\n\nmodule.exports = function (KEY) {\n  var C = typeof core[KEY] == 'function' ? core[KEY] : global[KEY];\n  if (DESCRIPTORS && C && !C[SPECIES]) dP.f(C, SPECIES, {\n    configurable: true,\n    get: function () { return this; }\n  });\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-to-string-tag.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_set-to-string-tag.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar def = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\").f;\nvar has = __webpack_require__(/*! ./_has */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_has.js\");\nvar TAG = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('toStringTag');\n\nmodule.exports = function (it, tag, stat) {\n  if (it && !has(it = stat ? it : it.prototype, TAG)) def(it, TAG, { configurable: true, value: tag });\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_shared-key.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_shared-key.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar shared = __webpack_require__(/*! ./_shared */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_shared.js\")('keys');\nvar uid = __webpack_require__(/*! ./_uid */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_uid.js\");\nmodule.exports = function (key) {\n  return shared[key] || (shared[key] = uid(key));\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_shared.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_shared.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar core = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\");\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || (global[SHARED] = {});\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: core.version,\n  mode: __webpack_require__(/*! ./_library */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_library.js\") ? 'pure' : 'global',\n  copyright: '© 2019 Denis Pushkarev (zloirock.ru)'\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_species-constructor.js\":\n/*!**************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_species-constructor.js ***!\n  \\**************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 7.3.20 SpeciesConstructor(O, defaultConstructor)\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nvar aFunction = __webpack_require__(/*! ./_a-function */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_a-function.js\");\nvar SPECIES = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('species');\nmodule.exports = function (O, D) {\n  var C = anObject(O).constructor;\n  var S;\n  return C === undefined || (S = anObject(C)[SPECIES]) == undefined ? D : aFunction(S);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_string-at.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_string-at.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar toInteger = __webpack_require__(/*! ./_to-integer */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-integer.js\");\nvar defined = __webpack_require__(/*! ./_defined */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_defined.js\");\n// true  -> String#at\n// false -> String#codePointAt\nmodule.exports = function (TO_STRING) {\n  return function (that, pos) {\n    var s = String(defined(that));\n    var i = toInteger(pos);\n    var l = s.length;\n    var a, b;\n    if (i < 0 || i >= l) return TO_STRING ? '' : undefined;\n    a = s.charCodeAt(i);\n    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff\n      ? TO_STRING ? s.charAt(i) : a\n      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;\n  };\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_task.js\":\n/*!***********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_task.js ***!\n  \\***********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar ctx = __webpack_require__(/*! ./_ctx */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\");\nvar invoke = __webpack_require__(/*! ./_invoke */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_invoke.js\");\nvar html = __webpack_require__(/*! ./_html */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_html.js\");\nvar cel = __webpack_require__(/*! ./_dom-create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_dom-create.js\");\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar process = global.process;\nvar setTask = global.setImmediate;\nvar clearTask = global.clearImmediate;\nvar MessageChannel = global.MessageChannel;\nvar Dispatch = global.Dispatch;\nvar counter = 0;\nvar queue = {};\nvar ONREADYSTATECHANGE = 'onreadystatechange';\nvar defer, channel, port;\nvar run = function () {\n  var id = +this;\n  // eslint-disable-next-line no-prototype-builtins\n  if (queue.hasOwnProperty(id)) {\n    var fn = queue[id];\n    delete queue[id];\n    fn();\n  }\n};\nvar listener = function (event) {\n  run.call(event.data);\n};\n// Node.js 0.9+ & IE10+ has setImmediate, otherwise:\nif (!setTask || !clearTask) {\n  setTask = function setImmediate(fn) {\n    var args = [];\n    var i = 1;\n    while (arguments.length > i) args.push(arguments[i++]);\n    queue[++counter] = function () {\n      // eslint-disable-next-line no-new-func\n      invoke(typeof fn == 'function' ? fn : Function(fn), args);\n    };\n    defer(counter);\n    return counter;\n  };\n  clearTask = function clearImmediate(id) {\n    delete queue[id];\n  };\n  // Node.js 0.8-\n  if (__webpack_require__(/*! ./_cof */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_cof.js\")(process) == 'process') {\n    defer = function (id) {\n      process.nextTick(ctx(run, id, 1));\n    };\n  // Sphere (JS game engine) Dispatch API\n  } else if (Dispatch && Dispatch.now) {\n    defer = function (id) {\n      Dispatch.now(ctx(run, id, 1));\n    };\n  // Browsers with MessageChannel, includes WebWorkers\n  } else if (MessageChannel) {\n    channel = new MessageChannel();\n    port = channel.port2;\n    channel.port1.onmessage = listener;\n    defer = ctx(port.postMessage, port, 1);\n  // Browsers with postMessage, skip WebWorkers\n  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'\n  } else if (global.addEventListener && typeof postMessage == 'function' && !global.importScripts) {\n    defer = function (id) {\n      global.postMessage(id + '', '*');\n    };\n    global.addEventListener('message', listener, false);\n  // IE8-\n  } else if (ONREADYSTATECHANGE in cel('script')) {\n    defer = function (id) {\n      html.appendChild(cel('script'))[ONREADYSTATECHANGE] = function () {\n        html.removeChild(this);\n        run.call(id);\n      };\n    };\n  // Rest old browsers\n  } else {\n    defer = function (id) {\n      setTimeout(ctx(run, id, 1), 0);\n    };\n  }\n}\nmodule.exports = {\n  set: setTask,\n  clear: clearTask\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-absolute-index.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_to-absolute-index.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar toInteger = __webpack_require__(/*! ./_to-integer */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-integer.js\");\nvar max = Math.max;\nvar min = Math.min;\nmodule.exports = function (index, length) {\n  index = toInteger(index);\n  return index < 0 ? max(index + length, 0) : min(index, length);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-integer.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_to-integer.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n// 7.1.4 ToInteger\nvar ceil = Math.ceil;\nvar floor = Math.floor;\nmodule.exports = function (it) {\n  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-iobject.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_to-iobject.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// to indexed object, toObject with fallback for non-array-like ES3 strings\nvar IObject = __webpack_require__(/*! ./_iobject */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iobject.js\");\nvar defined = __webpack_require__(/*! ./_defined */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_defined.js\");\nmodule.exports = function (it) {\n  return IObject(defined(it));\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-length.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_to-length.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 7.1.15 ToLength\nvar toInteger = __webpack_require__(/*! ./_to-integer */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-integer.js\");\nvar min = Math.min;\nmodule.exports = function (it) {\n  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-object.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_to-object.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 7.1.13 ToObject(argument)\nvar defined = __webpack_require__(/*! ./_defined */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_defined.js\");\nmodule.exports = function (it) {\n  return Object(defined(it));\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-primitive.js\":\n/*!*******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_to-primitive.js ***!\n  \\*******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 7.1.1 ToPrimitive(input [, PreferredType])\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nmodule.exports = function (it, S) {\n  if (!isObject(it)) return it;\n  var fn, val;\n  if (S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;\n  if (typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it))) return val;\n  if (!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_uid.js\":\n/*!**********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_uid.js ***!\n  \\**********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nvar id = 0;\nvar px = Math.random();\nmodule.exports = function (key) {\n  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_user-agent.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_user-agent.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar navigator = global.navigator;\n\nmodule.exports = navigator && navigator.userAgent || '';\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_validate-collection.js\":\n/*!**************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_validate-collection.js ***!\n  \\**************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nmodule.exports = function (it, TYPE) {\n  if (!isObject(it) || it._t !== TYPE) throw TypeError('Incompatible receiver, ' + TYPE + ' required!');\n  return it;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-define.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-define.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar core = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\");\nvar LIBRARY = __webpack_require__(/*! ./_library */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_library.js\");\nvar wksExt = __webpack_require__(/*! ./_wks-ext */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-ext.js\");\nvar defineProperty = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\").f;\nmodule.exports = function (name) {\n  var $Symbol = core.Symbol || (core.Symbol = LIBRARY ? {} : global.Symbol || {});\n  if (name.charAt(0) != '_' && !(name in $Symbol)) defineProperty($Symbol, name, { value: wksExt.f(name) });\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-ext.js\":\n/*!**************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-ext.js ***!\n  \\**************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nexports.f = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\");\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\":\n/*!**********************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js ***!\n  \\**********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar store = __webpack_require__(/*! ./_shared */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_shared.js\")('wks');\nvar uid = __webpack_require__(/*! ./_uid */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_uid.js\");\nvar Symbol = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\").Symbol;\nvar USE_SYMBOL = typeof Symbol == 'function';\n\nvar $exports = module.exports = function (name) {\n  return store[name] || (store[name] =\n    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : uid)('Symbol.' + name));\n};\n\n$exports.store = store;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/core.get-iterator-method.js\":\n/*!******************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/core.get-iterator-method.js ***!\n  \\******************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar classof = __webpack_require__(/*! ./_classof */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_classof.js\");\nvar ITERATOR = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('iterator');\nvar Iterators = __webpack_require__(/*! ./_iterators */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iterators.js\");\nmodule.exports = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").getIteratorMethod = function (it) {\n  if (it != undefined) return it[ITERATOR]\n    || it['@@iterator']\n    || Iterators[classof(it)];\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/core.get-iterator.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/core.get-iterator.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nvar get = __webpack_require__(/*! ./core.get-iterator-method */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/core.get-iterator-method.js\");\nmodule.exports = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").getIterator = function (it) {\n  var iterFn = get(it);\n  if (typeof iterFn != 'function') throw TypeError(it + ' is not iterable!');\n  return anObject(iterFn.call(it));\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/core.is-iterable.js\":\n/*!**********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/core.is-iterable.js ***!\n  \\**********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar classof = __webpack_require__(/*! ./_classof */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_classof.js\");\nvar ITERATOR = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('iterator');\nvar Iterators = __webpack_require__(/*! ./_iterators */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iterators.js\");\nmodule.exports = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\").isIterable = function (it) {\n  var O = Object(it);\n  return O[ITERATOR] !== undefined\n    || '@@iterator' in O\n    // eslint-disable-next-line no-prototype-builtins\n    || Iterators.hasOwnProperty(classof(O));\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.array.from.js\":\n/*!********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.array.from.js ***!\n  \\********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar ctx = __webpack_require__(/*! ./_ctx */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\");\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\nvar toObject = __webpack_require__(/*! ./_to-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-object.js\");\nvar call = __webpack_require__(/*! ./_iter-call */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-call.js\");\nvar isArrayIter = __webpack_require__(/*! ./_is-array-iter */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-array-iter.js\");\nvar toLength = __webpack_require__(/*! ./_to-length */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-length.js\");\nvar createProperty = __webpack_require__(/*! ./_create-property */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_create-property.js\");\nvar getIterFn = __webpack_require__(/*! ./core.get-iterator-method */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/core.get-iterator-method.js\");\n\n$export($export.S + $export.F * !__webpack_require__(/*! ./_iter-detect */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-detect.js\")(function (iter) { Array.from(iter); }), 'Array', {\n  // 22.1.2.1 Array.from(arrayLike, mapfn = undefined, thisArg = undefined)\n  from: function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {\n    var O = toObject(arrayLike);\n    var C = typeof this == 'function' ? this : Array;\n    var aLen = arguments.length;\n    var mapfn = aLen > 1 ? arguments[1] : undefined;\n    var mapping = mapfn !== undefined;\n    var index = 0;\n    var iterFn = getIterFn(O);\n    var length, result, step, iterator;\n    if (mapping) mapfn = ctx(mapfn, aLen > 2 ? arguments[2] : undefined, 2);\n    // if object isn't iterable or it's array with default iterator - use simple case\n    if (iterFn != undefined && !(C == Array && isArrayIter(iterFn))) {\n      for (iterator = iterFn.call(O), result = new C(); !(step = iterator.next()).done; index++) {\n        createProperty(result, index, mapping ? call(iterator, mapfn, [step.value, index], true) : step.value);\n      }\n    } else {\n      length = toLength(O.length);\n      for (result = new C(length); length > index; index++) {\n        createProperty(result, index, mapping ? mapfn(O[index], index) : O[index]);\n      }\n    }\n    result.length = index;\n    return result;\n  }\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.array.iterator.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.array.iterator.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar addToUnscopables = __webpack_require__(/*! ./_add-to-unscopables */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_add-to-unscopables.js\");\nvar step = __webpack_require__(/*! ./_iter-step */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-step.js\");\nvar Iterators = __webpack_require__(/*! ./_iterators */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iterators.js\");\nvar toIObject = __webpack_require__(/*! ./_to-iobject */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-iobject.js\");\n\n// 22.1.3.4 Array.prototype.entries()\n// 22.1.3.13 Array.prototype.keys()\n// 22.1.3.29 Array.prototype.values()\n// 22.1.3.30 Array.prototype[@@iterator]()\nmodule.exports = __webpack_require__(/*! ./_iter-define */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-define.js\")(Array, 'Array', function (iterated, kind) {\n  this._t = toIObject(iterated); // target\n  this._i = 0;                   // next index\n  this._k = kind;                // kind\n// 22.1.5.2.1 %ArrayIteratorPrototype%.next()\n}, function () {\n  var O = this._t;\n  var kind = this._k;\n  var index = this._i++;\n  if (!O || index >= O.length) {\n    this._t = undefined;\n    return step(1);\n  }\n  if (kind == 'keys') return step(0, index);\n  if (kind == 'values') return step(0, O[index]);\n  return step(0, [index, O[index]]);\n}, 'values');\n\n// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)\nIterators.Arguments = Iterators.Array;\n\naddToUnscopables('keys');\naddToUnscopables('values');\naddToUnscopables('entries');\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.map.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.map.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar strong = __webpack_require__(/*! ./_collection-strong */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_collection-strong.js\");\nvar validate = __webpack_require__(/*! ./_validate-collection */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_validate-collection.js\");\nvar MAP = 'Map';\n\n// 23.1 Map Objects\nmodule.exports = __webpack_require__(/*! ./_collection */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_collection.js\")(MAP, function (get) {\n  return function Map() { return get(this, arguments.length > 0 ? arguments[0] : undefined); };\n}, {\n  // 23.1.3.6 Map.prototype.get(key)\n  get: function get(key) {\n    var entry = strong.getEntry(validate(this, MAP), key);\n    return entry && entry.v;\n  },\n  // 23.1.3.9 Map.prototype.set(key, value)\n  set: function set(key, value) {\n    return strong.def(validate(this, MAP), key === 0 ? 0 : key, value);\n  }\n}, strong, true);\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.assign.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.assign.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 19.1.3.1 Object.assign(target, source)\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\n\n$export($export.S + $export.F, 'Object', { assign: __webpack_require__(/*! ./_object-assign */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-assign.js\") });\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.create.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.create.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\n// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])\n$export($export.S, 'Object', { create: __webpack_require__(/*! ./_object-create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-create.js\") });\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.define-property.js\":\n/*!********************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.define-property.js ***!\n  \\********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\n// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)\n$export($export.S + $export.F * !__webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\"), 'Object', { defineProperty: __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\").f });\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.freeze.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.freeze.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 19.1.2.5 Object.freeze(O)\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nvar meta = __webpack_require__(/*! ./_meta */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_meta.js\").onFreeze;\n\n__webpack_require__(/*! ./_object-sap */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-sap.js\")('freeze', function ($freeze) {\n  return function freeze(it) {\n    return $freeze && isObject(it) ? $freeze(meta(it)) : it;\n  };\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.get-prototype-of.js\":\n/*!*********************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.get-prototype-of.js ***!\n  \\*********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 19.1.2.9 Object.getPrototypeOf(O)\nvar toObject = __webpack_require__(/*! ./_to-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-object.js\");\nvar $getPrototypeOf = __webpack_require__(/*! ./_object-gpo */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gpo.js\");\n\n__webpack_require__(/*! ./_object-sap */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-sap.js\")('getPrototypeOf', function () {\n  return function getPrototypeOf(it) {\n    return $getPrototypeOf(toObject(it));\n  };\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.keys.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.keys.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 19.1.2.14 Object.keys(O)\nvar toObject = __webpack_require__(/*! ./_to-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-object.js\");\nvar $keys = __webpack_require__(/*! ./_object-keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys.js\");\n\n__webpack_require__(/*! ./_object-sap */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-sap.js\")('keys', function () {\n  return function keys(it) {\n    return $keys(toObject(it));\n  };\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.set-prototype-of.js\":\n/*!*********************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.set-prototype-of.js ***!\n  \\*********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// 19.1.3.19 Object.setPrototypeOf(O, proto)\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\n$export($export.S, 'Object', { setPrototypeOf: __webpack_require__(/*! ./_set-proto */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-proto.js\").set });\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.to-string.js\":\n/*!**************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.object.to-string.js ***!\n  \\**************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.promise.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.promise.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar LIBRARY = __webpack_require__(/*! ./_library */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_library.js\");\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar ctx = __webpack_require__(/*! ./_ctx */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_ctx.js\");\nvar classof = __webpack_require__(/*! ./_classof */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_classof.js\");\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nvar aFunction = __webpack_require__(/*! ./_a-function */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_a-function.js\");\nvar anInstance = __webpack_require__(/*! ./_an-instance */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-instance.js\");\nvar forOf = __webpack_require__(/*! ./_for-of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_for-of.js\");\nvar speciesConstructor = __webpack_require__(/*! ./_species-constructor */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_species-constructor.js\");\nvar task = __webpack_require__(/*! ./_task */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_task.js\").set;\nvar microtask = __webpack_require__(/*! ./_microtask */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_microtask.js\")();\nvar newPromiseCapabilityModule = __webpack_require__(/*! ./_new-promise-capability */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_new-promise-capability.js\");\nvar perform = __webpack_require__(/*! ./_perform */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_perform.js\");\nvar userAgent = __webpack_require__(/*! ./_user-agent */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_user-agent.js\");\nvar promiseResolve = __webpack_require__(/*! ./_promise-resolve */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_promise-resolve.js\");\nvar PROMISE = 'Promise';\nvar TypeError = global.TypeError;\nvar process = global.process;\nvar versions = process && process.versions;\nvar v8 = versions && versions.v8 || '';\nvar $Promise = global[PROMISE];\nvar isNode = classof(process) == 'process';\nvar empty = function () { /* empty */ };\nvar Internal, newGenericPromiseCapability, OwnPromiseCapability, Wrapper;\nvar newPromiseCapability = newGenericPromiseCapability = newPromiseCapabilityModule.f;\n\nvar USE_NATIVE = !!function () {\n  try {\n    // correct subclassing with @@species support\n    var promise = $Promise.resolve(1);\n    var FakePromise = (promise.constructor = {})[__webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('species')] = function (exec) {\n      exec(empty, empty);\n    };\n    // unhandled rejections tracking support, NodeJS Promise without it fails @@species test\n    return (isNode || typeof PromiseRejectionEvent == 'function')\n      && promise.then(empty) instanceof FakePromise\n      // v8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=830565\n      // we can't detect it synchronously, so just check versions\n      && v8.indexOf('6.6') !== 0\n      && userAgent.indexOf('Chrome/66') === -1;\n  } catch (e) { /* empty */ }\n}();\n\n// helpers\nvar isThenable = function (it) {\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\nvar notify = function (promise, isReject) {\n  if (promise._n) return;\n  promise._n = true;\n  var chain = promise._c;\n  microtask(function () {\n    var value = promise._v;\n    var ok = promise._s == 1;\n    var i = 0;\n    var run = function (reaction) {\n      var handler = ok ? reaction.ok : reaction.fail;\n      var resolve = reaction.resolve;\n      var reject = reaction.reject;\n      var domain = reaction.domain;\n      var result, then, exited;\n      try {\n        if (handler) {\n          if (!ok) {\n            if (promise._h == 2) onHandleUnhandled(promise);\n            promise._h = 1;\n          }\n          if (handler === true) result = value;\n          else {\n            if (domain) domain.enter();\n            result = handler(value); // may throw\n            if (domain) {\n              domain.exit();\n              exited = true;\n            }\n          }\n          if (result === reaction.promise) {\n            reject(TypeError('Promise-chain cycle'));\n          } else if (then = isThenable(result)) {\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch (e) {\n        if (domain && !exited) domain.exit();\n        reject(e);\n      }\n    };\n    while (chain.length > i) run(chain[i++]); // variable length - can't use forEach\n    promise._c = [];\n    promise._n = false;\n    if (isReject && !promise._h) onUnhandled(promise);\n  });\n};\nvar onUnhandled = function (promise) {\n  task.call(global, function () {\n    var value = promise._v;\n    var unhandled = isUnhandled(promise);\n    var result, handler, console;\n    if (unhandled) {\n      result = perform(function () {\n        if (isNode) {\n          process.emit('unhandledRejection', value, promise);\n        } else if (handler = global.onunhandledrejection) {\n          handler({ promise: promise, reason: value });\n        } else if ((console = global.console) && console.error) {\n          console.error('Unhandled promise rejection', value);\n        }\n      });\n      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should\n      promise._h = isNode || isUnhandled(promise) ? 2 : 1;\n    } promise._a = undefined;\n    if (unhandled && result.e) throw result.v;\n  });\n};\nvar isUnhandled = function (promise) {\n  return promise._h !== 1 && (promise._a || promise._c).length === 0;\n};\nvar onHandleUnhandled = function (promise) {\n  task.call(global, function () {\n    var handler;\n    if (isNode) {\n      process.emit('rejectionHandled', promise);\n    } else if (handler = global.onrejectionhandled) {\n      handler({ promise: promise, reason: promise._v });\n    }\n  });\n};\nvar $reject = function (value) {\n  var promise = this;\n  if (promise._d) return;\n  promise._d = true;\n  promise = promise._w || promise; // unwrap\n  promise._v = value;\n  promise._s = 2;\n  if (!promise._a) promise._a = promise._c.slice();\n  notify(promise, true);\n};\nvar $resolve = function (value) {\n  var promise = this;\n  var then;\n  if (promise._d) return;\n  promise._d = true;\n  promise = promise._w || promise; // unwrap\n  try {\n    if (promise === value) throw TypeError(\"Promise can't be resolved itself\");\n    if (then = isThenable(value)) {\n      microtask(function () {\n        var wrapper = { _w: promise, _d: false }; // wrap\n        try {\n          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));\n        } catch (e) {\n          $reject.call(wrapper, e);\n        }\n      });\n    } else {\n      promise._v = value;\n      promise._s = 1;\n      notify(promise, false);\n    }\n  } catch (e) {\n    $reject.call({ _w: promise, _d: false }, e); // wrap\n  }\n};\n\n// constructor polyfill\nif (!USE_NATIVE) {\n  // 25.4.3.1 Promise(executor)\n  $Promise = function Promise(executor) {\n    anInstance(this, $Promise, PROMISE, '_h');\n    aFunction(executor);\n    Internal.call(this);\n    try {\n      executor(ctx($resolve, this, 1), ctx($reject, this, 1));\n    } catch (err) {\n      $reject.call(this, err);\n    }\n  };\n  // eslint-disable-next-line no-unused-vars\n  Internal = function Promise(executor) {\n    this._c = [];             // <- awaiting reactions\n    this._a = undefined;      // <- checked in isUnhandled reactions\n    this._s = 0;              // <- state\n    this._d = false;          // <- done\n    this._v = undefined;      // <- value\n    this._h = 0;              // <- rejection state, 0 - default, 1 - handled, 2 - unhandled\n    this._n = false;          // <- notify\n  };\n  Internal.prototype = __webpack_require__(/*! ./_redefine-all */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_redefine-all.js\")($Promise.prototype, {\n    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)\n    then: function then(onFulfilled, onRejected) {\n      var reaction = newPromiseCapability(speciesConstructor(this, $Promise));\n      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      reaction.domain = isNode ? process.domain : undefined;\n      this._c.push(reaction);\n      if (this._a) this._a.push(reaction);\n      if (this._s) notify(this, false);\n      return reaction.promise;\n    },\n    // 25.4.5.1 Promise.prototype.catch(onRejected)\n    'catch': function (onRejected) {\n      return this.then(undefined, onRejected);\n    }\n  });\n  OwnPromiseCapability = function () {\n    var promise = new Internal();\n    this.promise = promise;\n    this.resolve = ctx($resolve, promise, 1);\n    this.reject = ctx($reject, promise, 1);\n  };\n  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {\n    return C === $Promise || C === Wrapper\n      ? new OwnPromiseCapability(C)\n      : newGenericPromiseCapability(C);\n  };\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, { Promise: $Promise });\n__webpack_require__(/*! ./_set-to-string-tag */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-to-string-tag.js\")($Promise, PROMISE);\n__webpack_require__(/*! ./_set-species */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-species.js\")(PROMISE);\nWrapper = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\")[PROMISE];\n\n// statics\n$export($export.S + $export.F * !USE_NATIVE, PROMISE, {\n  // 25.4.4.5 Promise.reject(r)\n  reject: function reject(r) {\n    var capability = newPromiseCapability(this);\n    var $$reject = capability.reject;\n    $$reject(r);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * (LIBRARY || !USE_NATIVE), PROMISE, {\n  // 25.4.4.6 Promise.resolve(x)\n  resolve: function resolve(x) {\n    return promiseResolve(LIBRARY && this === Wrapper ? $Promise : this, x);\n  }\n});\n$export($export.S + $export.F * !(USE_NATIVE && __webpack_require__(/*! ./_iter-detect */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-detect.js\")(function (iter) {\n  $Promise.all(iter)['catch'](empty);\n})), PROMISE, {\n  // 25.4.4.1 Promise.all(iterable)\n  all: function all(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var resolve = capability.resolve;\n    var reject = capability.reject;\n    var result = perform(function () {\n      var values = [];\n      var index = 0;\n      var remaining = 1;\n      forOf(iterable, false, function (promise) {\n        var $index = index++;\n        var alreadyCalled = false;\n        values.push(undefined);\n        remaining++;\n        C.resolve(promise).then(function (value) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[$index] = value;\n          --remaining || resolve(values);\n        }, reject);\n      });\n      --remaining || resolve(values);\n    });\n    if (result.e) reject(result.v);\n    return capability.promise;\n  },\n  // 25.4.4.4 Promise.race(iterable)\n  race: function race(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var reject = capability.reject;\n    var result = perform(function () {\n      forOf(iterable, false, function (promise) {\n        C.resolve(promise).then(capability.resolve, reject);\n      });\n    });\n    if (result.e) reject(result.v);\n    return capability.promise;\n  }\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.set.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.set.js ***!\n  \\*************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar strong = __webpack_require__(/*! ./_collection-strong */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_collection-strong.js\");\nvar validate = __webpack_require__(/*! ./_validate-collection */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_validate-collection.js\");\nvar SET = 'Set';\n\n// 23.2 Set Objects\nmodule.exports = __webpack_require__(/*! ./_collection */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_collection.js\")(SET, function (get) {\n  return function Set() { return get(this, arguments.length > 0 ? arguments[0] : undefined); };\n}, {\n  // 23.2.3.1 Set.prototype.add(value)\n  add: function add(value) {\n    return strong.def(validate(this, SET), value = value === 0 ? 0 : value, value);\n  }\n}, strong);\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.string.iterator.js\":\n/*!*************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.string.iterator.js ***!\n  \\*************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar $at = __webpack_require__(/*! ./_string-at */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_string-at.js\")(true);\n\n// 21.1.3.27 String.prototype[@@iterator]()\n__webpack_require__(/*! ./_iter-define */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iter-define.js\")(String, 'String', function (iterated) {\n  this._t = String(iterated); // target\n  this._i = 0;                // next index\n// 21.1.5.2.1 %StringIteratorPrototype%.next()\n}, function () {\n  var O = this._t;\n  var index = this._i;\n  var point;\n  if (index >= O.length) return { value: undefined, done: true };\n  point = $at(O, index);\n  this._i += point.length;\n  return { value: point, done: false };\n});\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.symbol.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es6.symbol.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n// ECMAScript 6 symbols shim\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar has = __webpack_require__(/*! ./_has */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_has.js\");\nvar DESCRIPTORS = __webpack_require__(/*! ./_descriptors */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_descriptors.js\");\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\nvar redefine = __webpack_require__(/*! ./_redefine */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_redefine.js\");\nvar META = __webpack_require__(/*! ./_meta */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_meta.js\").KEY;\nvar $fails = __webpack_require__(/*! ./_fails */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_fails.js\");\nvar shared = __webpack_require__(/*! ./_shared */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_shared.js\");\nvar setToStringTag = __webpack_require__(/*! ./_set-to-string-tag */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-to-string-tag.js\");\nvar uid = __webpack_require__(/*! ./_uid */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_uid.js\");\nvar wks = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\");\nvar wksExt = __webpack_require__(/*! ./_wks-ext */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-ext.js\");\nvar wksDefine = __webpack_require__(/*! ./_wks-define */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-define.js\");\nvar enumKeys = __webpack_require__(/*! ./_enum-keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_enum-keys.js\");\nvar isArray = __webpack_require__(/*! ./_is-array */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-array.js\");\nvar anObject = __webpack_require__(/*! ./_an-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_an-object.js\");\nvar isObject = __webpack_require__(/*! ./_is-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_is-object.js\");\nvar toObject = __webpack_require__(/*! ./_to-object */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-object.js\");\nvar toIObject = __webpack_require__(/*! ./_to-iobject */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-iobject.js\");\nvar toPrimitive = __webpack_require__(/*! ./_to-primitive */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_to-primitive.js\");\nvar createDesc = __webpack_require__(/*! ./_property-desc */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_property-desc.js\");\nvar _create = __webpack_require__(/*! ./_object-create */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-create.js\");\nvar gOPNExt = __webpack_require__(/*! ./_object-gopn-ext */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopn-ext.js\");\nvar $GOPD = __webpack_require__(/*! ./_object-gopd */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopd.js\");\nvar $GOPS = __webpack_require__(/*! ./_object-gops */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gops.js\");\nvar $DP = __webpack_require__(/*! ./_object-dp */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-dp.js\");\nvar $keys = __webpack_require__(/*! ./_object-keys */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-keys.js\");\nvar gOPD = $GOPD.f;\nvar dP = $DP.f;\nvar gOPN = gOPNExt.f;\nvar $Symbol = global.Symbol;\nvar $JSON = global.JSON;\nvar _stringify = $JSON && $JSON.stringify;\nvar PROTOTYPE = 'prototype';\nvar HIDDEN = wks('_hidden');\nvar TO_PRIMITIVE = wks('toPrimitive');\nvar isEnum = {}.propertyIsEnumerable;\nvar SymbolRegistry = shared('symbol-registry');\nvar AllSymbols = shared('symbols');\nvar OPSymbols = shared('op-symbols');\nvar ObjectProto = Object[PROTOTYPE];\nvar USE_NATIVE = typeof $Symbol == 'function' && !!$GOPS.f;\nvar QObject = global.QObject;\n// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173\nvar setter = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;\n\n// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687\nvar setSymbolDesc = DESCRIPTORS && $fails(function () {\n  return _create(dP({}, 'a', {\n    get: function () { return dP(this, 'a', { value: 7 }).a; }\n  })).a != 7;\n}) ? function (it, key, D) {\n  var protoDesc = gOPD(ObjectProto, key);\n  if (protoDesc) delete ObjectProto[key];\n  dP(it, key, D);\n  if (protoDesc && it !== ObjectProto) dP(ObjectProto, key, protoDesc);\n} : dP;\n\nvar wrap = function (tag) {\n  var sym = AllSymbols[tag] = _create($Symbol[PROTOTYPE]);\n  sym._k = tag;\n  return sym;\n};\n\nvar isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  return it instanceof $Symbol;\n};\n\nvar $defineProperty = function defineProperty(it, key, D) {\n  if (it === ObjectProto) $defineProperty(OPSymbols, key, D);\n  anObject(it);\n  key = toPrimitive(key, true);\n  anObject(D);\n  if (has(AllSymbols, key)) {\n    if (!D.enumerable) {\n      if (!has(it, HIDDEN)) dP(it, HIDDEN, createDesc(1, {}));\n      it[HIDDEN][key] = true;\n    } else {\n      if (has(it, HIDDEN) && it[HIDDEN][key]) it[HIDDEN][key] = false;\n      D = _create(D, { enumerable: createDesc(0, false) });\n    } return setSymbolDesc(it, key, D);\n  } return dP(it, key, D);\n};\nvar $defineProperties = function defineProperties(it, P) {\n  anObject(it);\n  var keys = enumKeys(P = toIObject(P));\n  var i = 0;\n  var l = keys.length;\n  var key;\n  while (l > i) $defineProperty(it, key = keys[i++], P[key]);\n  return it;\n};\nvar $create = function create(it, P) {\n  return P === undefined ? _create(it) : $defineProperties(_create(it), P);\n};\nvar $propertyIsEnumerable = function propertyIsEnumerable(key) {\n  var E = isEnum.call(this, key = toPrimitive(key, true));\n  if (this === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return false;\n  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key] ? E : true;\n};\nvar $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key) {\n  it = toIObject(it);\n  key = toPrimitive(key, true);\n  if (it === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return;\n  var D = gOPD(it, key);\n  if (D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key])) D.enumerable = true;\n  return D;\n};\nvar $getOwnPropertyNames = function getOwnPropertyNames(it) {\n  var names = gOPN(toIObject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (!has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META) result.push(key);\n  } return result;\n};\nvar $getOwnPropertySymbols = function getOwnPropertySymbols(it) {\n  var IS_OP = it === ObjectProto;\n  var names = gOPN(IS_OP ? OPSymbols : toIObject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (has(AllSymbols, key = names[i++]) && (IS_OP ? has(ObjectProto, key) : true)) result.push(AllSymbols[key]);\n  } return result;\n};\n\n// 19.4.1.1 Symbol([description])\nif (!USE_NATIVE) {\n  $Symbol = function Symbol() {\n    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor!');\n    var tag = uid(arguments.length > 0 ? arguments[0] : undefined);\n    var $set = function (value) {\n      if (this === ObjectProto) $set.call(OPSymbols, value);\n      if (has(this, HIDDEN) && has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;\n      setSymbolDesc(this, tag, createDesc(1, value));\n    };\n    if (DESCRIPTORS && setter) setSymbolDesc(ObjectProto, tag, { configurable: true, set: $set });\n    return wrap(tag);\n  };\n  redefine($Symbol[PROTOTYPE], 'toString', function toString() {\n    return this._k;\n  });\n\n  $GOPD.f = $getOwnPropertyDescriptor;\n  $DP.f = $defineProperty;\n  __webpack_require__(/*! ./_object-gopn */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-gopn.js\").f = gOPNExt.f = $getOwnPropertyNames;\n  __webpack_require__(/*! ./_object-pie */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_object-pie.js\").f = $propertyIsEnumerable;\n  $GOPS.f = $getOwnPropertySymbols;\n\n  if (DESCRIPTORS && !__webpack_require__(/*! ./_library */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_library.js\")) {\n    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);\n  }\n\n  wksExt.f = function (name) {\n    return wrap(wks(name));\n  };\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, { Symbol: $Symbol });\n\nfor (var es6Symbols = (\n  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14\n  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'\n).split(','), j = 0; es6Symbols.length > j;)wks(es6Symbols[j++]);\n\nfor (var wellKnownSymbols = $keys(wks.store), k = 0; wellKnownSymbols.length > k;) wksDefine(wellKnownSymbols[k++]);\n\n$export($export.S + $export.F * !USE_NATIVE, 'Symbol', {\n  // 19.4.2.1 Symbol.for(key)\n  'for': function (key) {\n    return has(SymbolRegistry, key += '')\n      ? SymbolRegistry[key]\n      : SymbolRegistry[key] = $Symbol(key);\n  },\n  // 19.4.2.5 Symbol.keyFor(sym)\n  keyFor: function keyFor(sym) {\n    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol!');\n    for (var key in SymbolRegistry) if (SymbolRegistry[key] === sym) return key;\n  },\n  useSetter: function () { setter = true; },\n  useSimple: function () { setter = false; }\n});\n\n$export($export.S + $export.F * !USE_NATIVE, 'Object', {\n  // 19.1.2.2 Object.create(O [, Properties])\n  create: $create,\n  // 19.1.2.4 Object.defineProperty(O, P, Attributes)\n  defineProperty: $defineProperty,\n  // 19.1.2.3 Object.defineProperties(O, Properties)\n  defineProperties: $defineProperties,\n  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)\n  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,\n  // 19.1.2.7 Object.getOwnPropertyNames(O)\n  getOwnPropertyNames: $getOwnPropertyNames,\n  // 19.1.2.8 Object.getOwnPropertySymbols(O)\n  getOwnPropertySymbols: $getOwnPropertySymbols\n});\n\n// Chrome 38 and 39 `Object.getOwnPropertySymbols` fails on primitives\n// https://bugs.chromium.org/p/v8/issues/detail?id=3443\nvar FAILS_ON_PRIMITIVES = $fails(function () { $GOPS.f(1); });\n\n$export($export.S + $export.F * FAILS_ON_PRIMITIVES, 'Object', {\n  getOwnPropertySymbols: function getOwnPropertySymbols(it) {\n    return $GOPS.f(toObject(it));\n  }\n});\n\n// 24.3.2 JSON.stringify(value [, replacer [, space]])\n$JSON && $export($export.S + $export.F * (!USE_NATIVE || $fails(function () {\n  var S = $Symbol();\n  // MS Edge converts symbol values to JSON as {}\n  // WebKit converts symbol values to JSON as null\n  // V8 throws on boxed symbols\n  return _stringify([S]) != '[null]' || _stringify({ a: S }) != '{}' || _stringify(Object(S)) != '{}';\n})), 'JSON', {\n  stringify: function stringify(it) {\n    var args = [it];\n    var i = 1;\n    var replacer, $replacer;\n    while (arguments.length > i) args.push(arguments[i++]);\n    $replacer = replacer = args[1];\n    if (!isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined\n    if (!isArray(replacer)) replacer = function (key, value) {\n      if (typeof $replacer == 'function') value = $replacer.call(this, key, value);\n      if (!isSymbol(value)) return value;\n    };\n    args[1] = replacer;\n    return _stringify.apply($JSON, args);\n  }\n});\n\n// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)\n$Symbol[PROTOTYPE][TO_PRIMITIVE] || __webpack_require__(/*! ./_hide */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js\")($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);\n// 19.4.3.5 Symbol.prototype[@@toStringTag]\nsetToStringTag($Symbol, 'Symbol');\n// 20.2.1.9 Math[@@toStringTag]\nsetToStringTag(Math, 'Math', true);\n// 24.3.3 JSON[@@toStringTag]\nsetToStringTag(global.JSON, 'JSON', true);\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.map.from.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.map.from.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// https://tc39.github.io/proposal-setmap-offrom/#sec-map.from\n__webpack_require__(/*! ./_set-collection-from */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-collection-from.js\")('Map');\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.map.of.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.map.of.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// https://tc39.github.io/proposal-setmap-offrom/#sec-map.of\n__webpack_require__(/*! ./_set-collection-of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-collection-of.js\")('Map');\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.map.to-json.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.map.to-json.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// https://github.com/DavidBruant/Map-Set.prototype.toJSON\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\n\n$export($export.P + $export.R, 'Map', { toJSON: __webpack_require__(/*! ./_collection-to-json */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_collection-to-json.js\")('Map') });\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.promise.finally.js\":\n/*!*************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.promise.finally.js ***!\n  \\*************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n// https://github.com/tc39/proposal-promise-finally\n\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\nvar core = __webpack_require__(/*! ./_core */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_core.js\");\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar speciesConstructor = __webpack_require__(/*! ./_species-constructor */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_species-constructor.js\");\nvar promiseResolve = __webpack_require__(/*! ./_promise-resolve */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_promise-resolve.js\");\n\n$export($export.P + $export.R, 'Promise', { 'finally': function (onFinally) {\n  var C = speciesConstructor(this, core.Promise || global.Promise);\n  var isFunction = typeof onFinally == 'function';\n  return this.then(\n    isFunction ? function (x) {\n      return promiseResolve(C, onFinally()).then(function () { return x; });\n    } : onFinally,\n    isFunction ? function (e) {\n      return promiseResolve(C, onFinally()).then(function () { throw e; });\n    } : onFinally\n  );\n} });\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.promise.try.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.promise.try.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n// https://github.com/tc39/proposal-promise-try\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\nvar newPromiseCapability = __webpack_require__(/*! ./_new-promise-capability */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_new-promise-capability.js\");\nvar perform = __webpack_require__(/*! ./_perform */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_perform.js\");\n\n$export($export.S, 'Promise', { 'try': function (callbackfn) {\n  var promiseCapability = newPromiseCapability.f(this);\n  var result = perform(callbackfn);\n  (result.e ? promiseCapability.reject : promiseCapability.resolve)(result.v);\n  return promiseCapability.promise;\n} });\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.set.from.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.set.from.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// https://tc39.github.io/proposal-setmap-offrom/#sec-set.from\n__webpack_require__(/*! ./_set-collection-from */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-collection-from.js\")('Set');\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.set.of.js\":\n/*!****************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.set.of.js ***!\n  \\****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// https://tc39.github.io/proposal-setmap-offrom/#sec-set.of\n__webpack_require__(/*! ./_set-collection-of */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_set-collection-of.js\")('Set');\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.set.to-json.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.set.to-json.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n// https://github.com/DavidBruant/Map-Set.prototype.toJSON\nvar $export = __webpack_require__(/*! ./_export */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_export.js\");\n\n$export($export.P + $export.R, 'Set', { toJSON: __webpack_require__(/*! ./_collection-to-json */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_collection-to-json.js\")('Set') });\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.symbol.async-iterator.js\":\n/*!*******************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.symbol.async-iterator.js ***!\n  \\*******************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ./_wks-define */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-define.js\")('asyncIterator');\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es7.symbol.observable.js\":\n/*!***************************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/es7.symbol.observable.js ***!\n  \\***************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ./_wks-define */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks-define.js\")('observable');\n\n\n/***/ }),\n\n/***/ \"./node_modules/_core-js@2.6.11@core-js/library/modules/web.dom.iterable.js\":\n/*!**********************************************************************************!*\\\n  !*** ./node_modules/_core-js@2.6.11@core-js/library/modules/web.dom.iterable.js ***!\n  \\**********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(/*! ./es6.array.iterator */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/es6.array.iterator.js\");\nvar global = __webpack_require__(/*! ./_global */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_global.js\");\nvar hide = __webpack_require__(/*! ./_hide */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_hide.js\");\nvar Iterators = __webpack_require__(/*! ./_iterators */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_iterators.js\");\nvar TO_STRING_TAG = __webpack_require__(/*! ./_wks */ \"./node_modules/_core-js@2.6.11@core-js/library/modules/_wks.js\")('toStringTag');\n\nvar DOMIterables = ('CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,' +\n  'DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,' +\n  'MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,' +\n  'SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,' +\n  'TextTrackList,TouchList').split(',');\n\nfor (var i = 0; i < DOMIterables.length; i++) {\n  var NAME = DOMIterables[i];\n  var Collection = global[NAME];\n  var proto = Collection && Collection.prototype;\n  if (proto && !proto[TO_STRING_TAG]) hide(proto, TO_STRING_TAG, NAME);\n  Iterators[NAME] = Iterators.Array;\n}\n\n\n/***/ }),\n\n/***/ \"./node_modules/_debug@4.1.1@debug/src/browser.js\":\n/*!********************************************************!*\\\n  !*** ./node_modules/_debug@4.1.1@debug/src/browser.js ***!\n  \\********************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function(process) {/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.log()` when available.\n * No-op when `console.log` is not a \"function\".\n *\n * @api public\n */\nfunction log(...args) {\n\t// This hackery is required for IE8/9, where\n\t// the `console.log` function doesn't have 'apply'\n\treturn typeof console === 'object' &&\n\t\tconsole.log &&\n\t\tconsole.log(...args);\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = __webpack_require__(/*! ./common */ \"./node_modules/_debug@4.1.1@debug/src/common.js\")(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../_process@0.11.10@process/browser.js */ \"./node_modules/_process@0.11.10@process/browser.js\")))\n\n/***/ }),\n\n/***/ \"./node_modules/_debug@4.1.1@debug/src/common.js\":\n/*!*******************************************************!*\\\n  !*** ./node_modules/_debug@4.1.1@debug/src/common.js ***!\n  \\*******************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = __webpack_require__(/*! ms */ \"./node_modules/_ms@2.1.2@ms/index.js\");\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* Active `debug` instances.\n\t*/\n\tcreateDebug.instances = [];\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn match;\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.enabled = createDebug.enabled(namespace);\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = selectColor(namespace);\n\t\tdebug.destroy = destroy;\n\t\tdebug.extend = extend;\n\t\t// Debug.formatArgs = formatArgs;\n\t\t// debug.rawLog = rawLog;\n\n\t\t// env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\tcreateDebug.instances.push(debug);\n\n\t\treturn debug;\n\t}\n\n\tfunction destroy() {\n\t\tconst index = createDebug.instances.indexOf(this);\n\t\tif (index !== -1) {\n\t\t\tcreateDebug.instances.splice(index, 1);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0; i < createDebug.instances.length; i++) {\n\t\t\tconst instance = createDebug.instances[i];\n\t\t\tinstance.enabled = createDebug.enabled(instance.namespace);\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_es5-ext@0.10.53@es5-ext/global.js\":\n/*!*********************************************************!*\\\n  !*** ./node_modules/_es5-ext@0.10.53@es5-ext/global.js ***!\n  \\*********************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nvar naiveFallback = function () {\n\tif (typeof self === \"object\" && self) return self;\n\tif (typeof window === \"object\" && window) return window;\n\tthrow new Error(\"Unable to resolve global `this`\");\n};\n\nmodule.exports = (function () {\n\tif (this) return this;\n\n\t// Unexpected strict mode (may happen if e.g. bundled into ESM module)\n\n\t// Fallback to standard globalThis if available\n\tif (typeof globalThis === \"object\" && globalThis) return globalThis;\n\n\t// Thanks @mathiasbynens -> https://mathiasbynens.be/notes/globalthis\n\t// In all ES5+ engines global object inherits from Object.prototype\n\t// (if you approached one that doesn't please report)\n\ttry {\n\t\tObject.defineProperty(Object.prototype, \"__global__\", {\n\t\t\tget: function () { return this; },\n\t\t\tconfigurable: true\n\t\t});\n\t} catch (error) {\n\t\t// Unfortunate case of updates to Object.prototype being restricted\n\t\t// via preventExtensions, seal or freeze\n\t\treturn naiveFallback();\n\t}\n\ttry {\n\t\t// Safari case (window.__global__ works, but __global__ does not)\n\t\tif (!__global__) return naiveFallback();\n\t\treturn __global__;\n\t} finally {\n\t\tdelete Object.prototype.__global__;\n\t}\n})();\n\n\n/***/ }),\n\n/***/ \"./node_modules/_events@3.1.0@events/events.js\":\n/*!*****************************************************!*\\\n  !*** ./node_modules/_events@3.1.0@events/events.js ***!\n  \\*****************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\n\n/***/ }),\n\n/***/ \"./node_modules/_hark@1.2.3@hark/hark.js\":\n/*!***********************************************!*\\\n  !*** ./node_modules/_hark@1.2.3@hark/hark.js ***!\n  \\***********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar WildEmitter = __webpack_require__(/*! wildemitter */ \"./node_modules/_wildemitter@1.2.1@wildemitter/wildemitter.js\");\n\nfunction getMaxVolume (analyser, fftBins) {\n  var maxVolume = -Infinity;\n  analyser.getFloatFrequencyData(fftBins);\n\n  for(var i=4, ii=fftBins.length; i < ii; i++) {\n    if (fftBins[i] > maxVolume && fftBins[i] < 0) {\n      maxVolume = fftBins[i];\n    }\n  };\n\n  return maxVolume;\n}\n\n\nvar audioContextType;\nif (typeof window !== 'undefined') {\n  audioContextType = window.AudioContext || window.webkitAudioContext;\n}\n// use a single audio context due to hardware limits\nvar audioContext = null;\nmodule.exports = function(stream, options) {\n  var harker = new WildEmitter();\n\n  // make it not break in non-supported browsers\n  if (!audioContextType) return harker;\n\n  //Config\n  var options = options || {},\n      smoothing = (options.smoothing || 0.1),\n      interval = (options.interval || 50),\n      threshold = options.threshold,\n      play = options.play,\n      history = options.history || 10,\n      running = true;\n\n  // Ensure that just a single AudioContext is internally created\n  audioContext = options.audioContext || audioContext || new audioContextType();\n\n  var sourceNode, fftBins, analyser;\n\n  analyser = audioContext.createAnalyser();\n  analyser.fftSize = 512;\n  analyser.smoothingTimeConstant = smoothing;\n  fftBins = new Float32Array(analyser.frequencyBinCount);\n\n  if (stream.jquery) stream = stream[0];\n  if (stream instanceof HTMLAudioElement || stream instanceof HTMLVideoElement) {\n    //Audio Tag\n    sourceNode = audioContext.createMediaElementSource(stream);\n    if (typeof play === 'undefined') play = true;\n    threshold = threshold || -50;\n  } else {\n    //WebRTC Stream\n    sourceNode = audioContext.createMediaStreamSource(stream);\n    threshold = threshold || -50;\n  }\n\n  sourceNode.connect(analyser);\n  if (play) analyser.connect(audioContext.destination);\n\n  harker.speaking = false;\n\n  harker.suspend = function() {\n    return audioContext.suspend();\n  }\n  harker.resume = function() {\n    return audioContext.resume();\n  }\n  Object.defineProperty(harker, 'state', { get: function() {\n    return audioContext.state;\n  }});\n  audioContext.onstatechange = function() {\n    harker.emit('state_change', audioContext.state);\n  }\n\n  harker.setThreshold = function(t) {\n    threshold = t;\n  };\n\n  harker.setInterval = function(i) {\n    interval = i;\n  };\n\n  harker.stop = function() {\n    running = false;\n    harker.emit('volume_change', -100, threshold);\n    if (harker.speaking) {\n      harker.speaking = false;\n      harker.emit('stopped_speaking');\n    }\n    analyser.disconnect();\n    sourceNode.disconnect();\n  };\n  harker.speakingHistory = [];\n  for (var i = 0; i < history; i++) {\n      harker.speakingHistory.push(0);\n  }\n\n  // Poll the analyser node to determine if speaking\n  // and emit events if changed\n  var looper = function() {\n    setTimeout(function() {\n\n      //check if stop has been called\n      if(!running) {\n        return;\n      }\n\n      var currentVolume = getMaxVolume(analyser, fftBins);\n\n      harker.emit('volume_change', currentVolume, threshold);\n\n      var history = 0;\n      if (currentVolume > threshold && !harker.speaking) {\n        // trigger quickly, short history\n        for (var i = harker.speakingHistory.length - 3; i < harker.speakingHistory.length; i++) {\n          history += harker.speakingHistory[i];\n        }\n        if (history >= 2) {\n          harker.speaking = true;\n          harker.emit('speaking');\n        }\n      } else if (currentVolume < threshold && harker.speaking) {\n        for (var i = 0; i < harker.speakingHistory.length; i++) {\n          history += harker.speakingHistory[i];\n        }\n        if (history == 0) {\n          harker.speaking = false;\n          harker.emit('stopped_speaking');\n        }\n      }\n      harker.speakingHistory.shift();\n      harker.speakingHistory.push(0 + (currentVolume > threshold));\n\n      looper();\n    }, interval);\n  };\n  looper();\n\n  return harker;\n}\n\n\n/***/ }),\n\n/***/ \"./node_modules/_ms@2.1.2@ms/index.js\":\n/*!********************************************!*\\\n  !*** ./node_modules/_ms@2.1.2@ms/index.js ***!\n  \\********************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n\n\n/***/ }),\n\n/***/ \"./node_modules/_process@0.11.10@process/browser.js\":\n/*!**********************************************************!*\\\n  !*** ./node_modules/_process@0.11.10@process/browser.js ***!\n  \\**********************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n/***/ }),\n\n/***/ \"./node_modules/_random-number@0.0.9@random-number/index.js\":\n/*!******************************************************************!*\\\n  !*** ./node_modules/_random-number@0.0.9@random-number/index.js ***!\n  \\******************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nvoid function(root){\n\n  function defaults(options){\n    var options = options || {}\n    var min = options.min\n    var max = options.max\n    var integer = options.integer || false\n    if ( min == null && max == null ) {\n      min = 0\n      max = 1\n    } else if ( min == null ) {\n      min = max - 1\n    } else if ( max == null ) {\n      max = min + 1\n    }\n    if ( max < min ) throw new Error('invalid options, max must be >= min')\n    return {\n      min:     min\n    , max:     max\n    , integer: integer\n    }\n  }\n\n  function random(options){\n    options = defaults(options)\n    if ( options.max === options.min ) return options.min\n    var r = Math.random() * (options.max - options.min + Number(!!options.integer)) + options.min\n    return options.integer ? Math.floor(r) : r\n  }\n\n  function generator(options){\n    options = defaults(options)\n    return function(min, max, integer){\n      options.min     = min != null ? min : options.min\n      options.max     = max != null ? max : options.max\n      options.integer = integer != null ? integer : options.integer\n      return random(options)\n    }\n  }\n\n  module.exports =  random\n  module.exports.generator = generator\n  module.exports.defaults = defaults\n}(this)\n\n\n/***/ }),\n\n/***/ \"./node_modules/_regenerator-runtime@0.11.1@regenerator-runtime/runtime-module.js\":\n/*!****************************************************************************************!*\\\n  !*** ./node_modules/_regenerator-runtime@0.11.1@regenerator-runtime/runtime-module.js ***!\n  \\****************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n// This method of obtaining a reference to the global object needs to be\n// kept identical to the way it is obtained in runtime.js\nvar g = (function() { return this })() || Function(\"return this\")();\n\n// Use `getOwnPropertyNames` because not all browsers support calling\n// `hasOwnProperty` on the global `self` object in a worker. See #183.\nvar hadRuntime = g.regeneratorRuntime &&\n  Object.getOwnPropertyNames(g).indexOf(\"regeneratorRuntime\") >= 0;\n\n// Save the old regeneratorRuntime in case it needs to be restored later.\nvar oldRuntime = hadRuntime && g.regeneratorRuntime;\n\n// Force reevalutation of runtime.js.\ng.regeneratorRuntime = undefined;\n\nmodule.exports = __webpack_require__(/*! ./runtime */ \"./node_modules/_regenerator-runtime@0.11.1@regenerator-runtime/runtime.js\");\n\nif (hadRuntime) {\n  // Restore the original runtime.\n  g.regeneratorRuntime = oldRuntime;\n} else {\n  // Remove the global property added by runtime.js.\n  try {\n    delete g.regeneratorRuntime;\n  } catch(e) {\n    g.regeneratorRuntime = undefined;\n  }\n}\n\n\n/***/ }),\n\n/***/ \"./node_modules/_regenerator-runtime@0.11.1@regenerator-runtime/runtime.js\":\n/*!*********************************************************************************!*\\\n  !*** ./node_modules/_regenerator-runtime@0.11.1@regenerator-runtime/runtime.js ***!\n  \\*********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  runtime.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  runtime.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        if (delegate.iterator.return) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // In sloppy mode, unbound `this` refers to the global object, fallback to\n  // Function constructor if we're in global strict mode. That is sadly a form\n  // of indirect eval which violates Content Security Policy.\n  (function() { return this })() || Function(\"return this\")()\n);\n\n\n/***/ }),\n\n/***/ \"./node_modules/_retry@0.12.0@retry/index.js\":\n/*!***************************************************!*\\\n  !*** ./node_modules/_retry@0.12.0@retry/index.js ***!\n  \\***************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(/*! ./lib/retry */ \"./node_modules/_retry@0.12.0@retry/lib/retry.js\");\n\n/***/ }),\n\n/***/ \"./node_modules/_retry@0.12.0@retry/lib/retry.js\":\n/*!*******************************************************!*\\\n  !*** ./node_modules/_retry@0.12.0@retry/lib/retry.js ***!\n  \\*******************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar RetryOperation = __webpack_require__(/*! ./retry_operation */ \"./node_modules/_retry@0.12.0@retry/lib/retry_operation.js\");\n\nexports.operation = function(options) {\n  var timeouts = exports.timeouts(options);\n  return new RetryOperation(timeouts, {\n      forever: options && options.forever,\n      unref: options && options.unref,\n      maxRetryTime: options && options.maxRetryTime\n  });\n};\n\nexports.timeouts = function(options) {\n  if (options instanceof Array) {\n    return [].concat(options);\n  }\n\n  var opts = {\n    retries: 10,\n    factor: 2,\n    minTimeout: 1 * 1000,\n    maxTimeout: Infinity,\n    randomize: false\n  };\n  for (var key in options) {\n    opts[key] = options[key];\n  }\n\n  if (opts.minTimeout > opts.maxTimeout) {\n    throw new Error('minTimeout is greater than maxTimeout');\n  }\n\n  var timeouts = [];\n  for (var i = 0; i < opts.retries; i++) {\n    timeouts.push(this.createTimeout(i, opts));\n  }\n\n  if (options && options.forever && !timeouts.length) {\n    timeouts.push(this.createTimeout(i, opts));\n  }\n\n  // sort the array numerically ascending\n  timeouts.sort(function(a,b) {\n    return a - b;\n  });\n\n  return timeouts;\n};\n\nexports.createTimeout = function(attempt, opts) {\n  var random = (opts.randomize)\n    ? (Math.random() + 1)\n    : 1;\n\n  var timeout = Math.round(random * opts.minTimeout * Math.pow(opts.factor, attempt));\n  timeout = Math.min(timeout, opts.maxTimeout);\n\n  return timeout;\n};\n\nexports.wrap = function(obj, options, methods) {\n  if (options instanceof Array) {\n    methods = options;\n    options = null;\n  }\n\n  if (!methods) {\n    methods = [];\n    for (var key in obj) {\n      if (typeof obj[key] === 'function') {\n        methods.push(key);\n      }\n    }\n  }\n\n  for (var i = 0; i < methods.length; i++) {\n    var method   = methods[i];\n    var original = obj[method];\n\n    obj[method] = function retryWrapper(original) {\n      var op       = exports.operation(options);\n      var args     = Array.prototype.slice.call(arguments, 1);\n      var callback = args.pop();\n\n      args.push(function(err) {\n        if (op.retry(err)) {\n          return;\n        }\n        if (err) {\n          arguments[0] = op.mainError();\n        }\n        callback.apply(this, arguments);\n      });\n\n      op.attempt(function() {\n        original.apply(obj, args);\n      });\n    }.bind(obj, original);\n    obj[method].options = options;\n  }\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_retry@0.12.0@retry/lib/retry_operation.js\":\n/*!*****************************************************************!*\\\n  !*** ./node_modules/_retry@0.12.0@retry/lib/retry_operation.js ***!\n  \\*****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nfunction RetryOperation(timeouts, options) {\n  // Compatibility for the old (timeouts, retryForever) signature\n  if (typeof options === 'boolean') {\n    options = { forever: options };\n  }\n\n  this._originalTimeouts = JSON.parse(JSON.stringify(timeouts));\n  this._timeouts = timeouts;\n  this._options = options || {};\n  this._maxRetryTime = options && options.maxRetryTime || Infinity;\n  this._fn = null;\n  this._errors = [];\n  this._attempts = 1;\n  this._operationTimeout = null;\n  this._operationTimeoutCb = null;\n  this._timeout = null;\n  this._operationStart = null;\n\n  if (this._options.forever) {\n    this._cachedTimeouts = this._timeouts.slice(0);\n  }\n}\nmodule.exports = RetryOperation;\n\nRetryOperation.prototype.reset = function() {\n  this._attempts = 1;\n  this._timeouts = this._originalTimeouts;\n}\n\nRetryOperation.prototype.stop = function() {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n\n  this._timeouts       = [];\n  this._cachedTimeouts = null;\n};\n\nRetryOperation.prototype.retry = function(err) {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n\n  if (!err) {\n    return false;\n  }\n  var currentTime = new Date().getTime();\n  if (err && currentTime - this._operationStart >= this._maxRetryTime) {\n    this._errors.unshift(new Error('RetryOperation timeout occurred'));\n    return false;\n  }\n\n  this._errors.push(err);\n\n  var timeout = this._timeouts.shift();\n  if (timeout === undefined) {\n    if (this._cachedTimeouts) {\n      // retry forever, only keep last error\n      this._errors.splice(this._errors.length - 1, this._errors.length);\n      this._timeouts = this._cachedTimeouts.slice(0);\n      timeout = this._timeouts.shift();\n    } else {\n      return false;\n    }\n  }\n\n  var self = this;\n  var timer = setTimeout(function() {\n    self._attempts++;\n\n    if (self._operationTimeoutCb) {\n      self._timeout = setTimeout(function() {\n        self._operationTimeoutCb(self._attempts);\n      }, self._operationTimeout);\n\n      if (self._options.unref) {\n          self._timeout.unref();\n      }\n    }\n\n    self._fn(self._attempts);\n  }, timeout);\n\n  if (this._options.unref) {\n      timer.unref();\n  }\n\n  return true;\n};\n\nRetryOperation.prototype.attempt = function(fn, timeoutOps) {\n  this._fn = fn;\n\n  if (timeoutOps) {\n    if (timeoutOps.timeout) {\n      this._operationTimeout = timeoutOps.timeout;\n    }\n    if (timeoutOps.cb) {\n      this._operationTimeoutCb = timeoutOps.cb;\n    }\n  }\n\n  var self = this;\n  if (this._operationTimeoutCb) {\n    this._timeout = setTimeout(function() {\n      self._operationTimeoutCb();\n    }, self._operationTimeout);\n  }\n\n  this._operationStart = new Date().getTime();\n\n  this._fn(this._attempts);\n};\n\nRetryOperation.prototype.try = function(fn) {\n  console.log('Using RetryOperation.try() is deprecated');\n  this.attempt(fn);\n};\n\nRetryOperation.prototype.start = function(fn) {\n  console.log('Using RetryOperation.start() is deprecated');\n  this.attempt(fn);\n};\n\nRetryOperation.prototype.start = RetryOperation.prototype.try;\n\nRetryOperation.prototype.errors = function() {\n  return this._errors;\n};\n\nRetryOperation.prototype.attempts = function() {\n  return this._attempts;\n};\n\nRetryOperation.prototype.mainError = function() {\n  if (this._errors.length === 0) {\n    return null;\n  }\n\n  var counts = {};\n  var mainError = null;\n  var mainErrorCount = 0;\n\n  for (var i = 0; i < this._errors.length; i++) {\n    var error = this._errors[i];\n    var message = error.message;\n    var count = (counts[message] || 0) + 1;\n\n    counts[message] = count;\n\n    if (count >= mainErrorCount) {\n      mainError = error;\n      mainErrorCount = count;\n    }\n  }\n\n  return mainError;\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_webpack@4.41.6@webpack/buildin/amd-define.js\":\n/*!***************************************!*\\\n  !*** (webpack)/buildin/amd-define.js ***!\n  \\***************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = function() {\n\tthrow new Error(\"define cannot be used indirect\");\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_webpack@4.41.6@webpack/buildin/global.js\":\n/*!***********************************!*\\\n  !*** (webpack)/buildin/global.js ***!\n  \\***********************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nvar g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_websocket@1.0.31@websocket/lib/browser.js\":\n/*!*****************************************************************!*\\\n  !*** ./node_modules/_websocket@1.0.31@websocket/lib/browser.js ***!\n  \\*****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar _globalThis;\ntry {\n\t_globalThis = __webpack_require__(/*! es5-ext/global */ \"./node_modules/_es5-ext@0.10.53@es5-ext/global.js\");\n} catch (error) {\n} finally {\n\tif (!_globalThis && typeof window !== 'undefined') { _globalThis = window; }\n\tif (!_globalThis) { throw new Error('Could not determine global this'); }\n}\n\nvar NativeWebSocket = _globalThis.WebSocket || _globalThis.MozWebSocket;\nvar websocket_version = __webpack_require__(/*! ./version */ \"./node_modules/_websocket@1.0.31@websocket/lib/version.js\");\n\n\n/**\n * Expose a W3C WebSocket class with just one or two arguments.\n */\nfunction W3CWebSocket(uri, protocols) {\n\tvar native_instance;\n\n\tif (protocols) {\n\t\tnative_instance = new NativeWebSocket(uri, protocols);\n\t}\n\telse {\n\t\tnative_instance = new NativeWebSocket(uri);\n\t}\n\n\t/**\n\t * 'native_instance' is an instance of nativeWebSocket (the browser's WebSocket\n\t * class). Since it is an Object it will be returned as it is when creating an\n\t * instance of W3CWebSocket via 'new W3CWebSocket()'.\n\t *\n\t * ECMAScript 5: http://bclary.com/2004/11/07/#a-13.2.2\n\t */\n\treturn native_instance;\n}\nif (NativeWebSocket) {\n\t['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'].forEach(function(prop) {\n\t\tObject.defineProperty(W3CWebSocket, prop, {\n\t\t\tget: function() { return NativeWebSocket[prop]; }\n\t\t});\n\t});\n}\n\n/**\n * Module exports.\n */\nmodule.exports = {\n    'w3cwebsocket' : NativeWebSocket ? W3CWebSocket : null,\n    'version'      : websocket_version\n};\n\n\n/***/ }),\n\n/***/ \"./node_modules/_websocket@1.0.31@websocket/lib/version.js\":\n/*!*****************************************************************!*\\\n  !*** ./node_modules/_websocket@1.0.31@websocket/lib/version.js ***!\n  \\*****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(/*! ../package.json */ \"./node_modules/_websocket@1.0.31@websocket/package.json\").version;\n\n\n/***/ }),\n\n/***/ \"./node_modules/_websocket@1.0.31@websocket/package.json\":\n/*!***************************************************************!*\\\n  !*** ./node_modules/_websocket@1.0.31@websocket/package.json ***!\n  \\***************************************************************/\n/*! exports provided: name, description, keywords, author, contributors, version, repository, homepage, engines, dependencies, devDependencies, config, scripts, main, directories, browser, license, __npminstall_done, _from, _resolved, default */\n/***/ (function(module) {\n\nmodule.exports = JSON.parse(\"{\\\"name\\\":\\\"websocket\\\",\\\"description\\\":\\\"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.\\\",\\\"keywords\\\":[\\\"websocket\\\",\\\"websockets\\\",\\\"socket\\\",\\\"networking\\\",\\\"comet\\\",\\\"push\\\",\\\"RFC-6455\\\",\\\"realtime\\\",\\\"server\\\",\\\"client\\\"],\\\"author\\\":\\\"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)\\\",\\\"contributors\\\":[\\\"Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)\\\"],\\\"version\\\":\\\"1.0.31\\\",\\\"repository\\\":{\\\"type\\\":\\\"git\\\",\\\"url\\\":\\\"https://github.com/theturtle32/WebSocket-Node.git\\\"},\\\"homepage\\\":\\\"https://github.com/theturtle32/WebSocket-Node\\\",\\\"engines\\\":{\\\"node\\\":\\\">=0.10.0\\\"},\\\"dependencies\\\":{\\\"debug\\\":\\\"^2.2.0\\\",\\\"es5-ext\\\":\\\"^0.10.50\\\",\\\"nan\\\":\\\"^2.14.0\\\",\\\"typedarray-to-buffer\\\":\\\"^3.1.5\\\",\\\"yaeti\\\":\\\"^0.0.6\\\"},\\\"devDependencies\\\":{\\\"buffer-equal\\\":\\\"^1.0.0\\\",\\\"faucet\\\":\\\"^0.0.1\\\",\\\"gulp\\\":\\\"^4.0.2\\\",\\\"gulp-jshint\\\":\\\"^2.0.4\\\",\\\"jshint-stylish\\\":\\\"^2.2.1\\\",\\\"jshint\\\":\\\"^2.0.0\\\",\\\"tape\\\":\\\"^4.9.1\\\"},\\\"config\\\":{\\\"verbose\\\":false},\\\"scripts\\\":{\\\"install\\\":\\\"(node-gyp rebuild 2> builderror.log) || (exit 0)\\\",\\\"test\\\":\\\"faucet test/unit\\\",\\\"gulp\\\":\\\"gulp\\\"},\\\"main\\\":\\\"index\\\",\\\"directories\\\":{\\\"lib\\\":\\\"./lib\\\"},\\\"browser\\\":\\\"lib/browser.js\\\",\\\"license\\\":\\\"Apache-2.0\\\",\\\"__npminstall_done\\\":\\\"Fri Feb 28 2020 14:40:09 GMT+0800 (GMT+08:00)\\\",\\\"_from\\\":\\\"websocket@1.0.31\\\",\\\"_resolved\\\":\\\"https://registry.npm.taobao.org/websocket/download/websocket-1.0.31.tgz\\\"}\");\n\n/***/ }),\n\n/***/ \"./node_modules/_wildemitter@1.2.1@wildemitter/wildemitter.js\":\n/*!********************************************************************!*\\\n  !*** ./node_modules/_wildemitter@1.2.1@wildemitter/wildemitter.js ***!\n  \\********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/*\nWildEmitter.js is a slim little event emitter by @henrikjoreteg largely based\non @visionmedia's Emitter from UI Kit.\n\nWhy? I wanted it standalone.\n\nI also wanted support for wildcard emitters like this:\n\nemitter.on('*', function (eventName, other, event, payloads) {\n\n});\n\nemitter.on('somenamespace*', function (eventName, payloads) {\n\n});\n\nPlease note that callbacks triggered by wildcard registered events also get\nthe event name as the first argument.\n*/\n\nmodule.exports = WildEmitter;\n\nfunction WildEmitter() { }\n\nWildEmitter.mixin = function (constructor) {\n    var prototype = constructor.prototype || constructor;\n\n    prototype.isWildEmitter= true;\n\n    // Listen on the given `event` with `fn`. Store a group name if present.\n    prototype.on = function (event, groupName, fn) {\n        this.callbacks = this.callbacks || {};\n        var hasGroup = (arguments.length === 3),\n            group = hasGroup ? arguments[1] : undefined,\n            func = hasGroup ? arguments[2] : arguments[1];\n        func._groupName = group;\n        (this.callbacks[event] = this.callbacks[event] || []).push(func);\n        return this;\n    };\n\n    // Adds an `event` listener that will be invoked a single\n    // time then automatically removed.\n    prototype.once = function (event, groupName, fn) {\n        var self = this,\n            hasGroup = (arguments.length === 3),\n            group = hasGroup ? arguments[1] : undefined,\n            func = hasGroup ? arguments[2] : arguments[1];\n        function on() {\n            self.off(event, on);\n            func.apply(this, arguments);\n        }\n        this.on(event, group, on);\n        return this;\n    };\n\n    // Unbinds an entire group\n    prototype.releaseGroup = function (groupName) {\n        this.callbacks = this.callbacks || {};\n        var item, i, len, handlers;\n        for (item in this.callbacks) {\n            handlers = this.callbacks[item];\n            for (i = 0, len = handlers.length; i < len; i++) {\n                if (handlers[i]._groupName === groupName) {\n                    //console.log('removing');\n                    // remove it and shorten the array we're looping through\n                    handlers.splice(i, 1);\n                    i--;\n                    len--;\n                }\n            }\n        }\n        return this;\n    };\n\n    // Remove the given callback for `event` or all\n    // registered callbacks.\n    prototype.off = function (event, fn) {\n        this.callbacks = this.callbacks || {};\n        var callbacks = this.callbacks[event],\n            i;\n\n        if (!callbacks) return this;\n\n        // remove all handlers\n        if (arguments.length === 1) {\n            delete this.callbacks[event];\n            return this;\n        }\n\n        // remove specific handler\n        i = callbacks.indexOf(fn);\n        if (i !== -1) {\n            callbacks.splice(i, 1);\n            if (callbacks.length === 0) {\n                delete this.callbacks[event];\n            }\n        }\n        return this;\n    };\n\n    /// Emit `event` with the given args.\n    // also calls any `*` handlers\n    prototype.emit = function (event) {\n        this.callbacks = this.callbacks || {};\n        var args = [].slice.call(arguments, 1),\n            callbacks = this.callbacks[event],\n            specialCallbacks = this.getWildcardCallbacks(event),\n            i,\n            len,\n            item,\n            listeners;\n\n        if (callbacks) {\n            listeners = callbacks.slice();\n            for (i = 0, len = listeners.length; i < len; ++i) {\n                if (!listeners[i]) {\n                    break;\n                }\n                listeners[i].apply(this, args);\n            }\n        }\n\n        if (specialCallbacks) {\n            len = specialCallbacks.length;\n            listeners = specialCallbacks.slice();\n            for (i = 0, len = listeners.length; i < len; ++i) {\n                if (!listeners[i]) {\n                    break;\n                }\n                listeners[i].apply(this, [event].concat(args));\n            }\n        }\n\n        return this;\n    };\n\n    // Helper for for finding special wildcard event handlers that match the event\n    prototype.getWildcardCallbacks = function (eventName) {\n        this.callbacks = this.callbacks || {};\n        var item,\n            split,\n            result = [];\n\n        for (item in this.callbacks) {\n            split = item.split('*');\n            if (item === '*' || (split.length === 2 && eventName.slice(0, split[0].length) === split[0])) {\n                result = result.concat(this.callbacks[item]);\n            }\n        }\n        return result;\n    };\n\n};\n\nWildEmitter.mixin(WildEmitter);\n\n\n/***/ }),\n\n/***/ \"./package.json\":\n/*!**********************!*\\\n  !*** ./package.json ***!\n  \\**********************/\n/*! exports provided: name, version, description, buildDate, main, scripts, author, license, dependencies, devDependencies, files, default */\n/***/ (function(module) {\n\nmodule.exports = JSON.parse(\"{\\\"name\\\":\\\"tttwebsdk\\\",\\\"version\\\":\\\"3.4.21\\\",\\\"description\\\":\\\"webrtc of 3ttech.cn\\\",\\\"buildDate\\\":\\\"Mar_18_2020-1\\\",\\\"main\\\":\\\"lib/TTTRtcWeb.js\\\",\\\"scripts\\\":{\\\"test\\\":\\\"jest\\\",\\\"start\\\":\\\"webpack-dev-server --open\\\",\\\"build:app\\\":\\\"webpack\\\",\\\"build:demo\\\":\\\"webpack --config webpack.config/webpack.config.demo.js\\\",\\\"build:dev\\\":\\\"webpack --config webpack.config/webpack.config.dev.js --mode development\\\",\\\"build:prod\\\":\\\"webpack --config webpack.config/webpack.config.js\\\",\\\"build:proddemo\\\":\\\"webpack --config webpack.config/webpack.config.proddemo.js\\\",\\\"build:demo-multistream\\\":\\\"webpack --config webpack.config/webpack.config.demo_multistream.js\\\",\\\"lint\\\":\\\"eslint -c .eslintrc.js lib/protoo lib/client.js lib/index.js lib/stats.js lib/config.js lib/utils.js lib/stream.js lib/TTTRtcWeb.js\\\",\\\"3.1:test\\\":\\\"webpack --config ./tests/3.1.test.pages/webpack.config.js\\\"},\\\"author\\\":\\\"3ttech.cn\\\",\\\"license\\\":\\\"ISC\\\",\\\"dependencies\\\":{\\\"babel-runtime\\\":\\\"^6.26.0\\\",\\\"bowser\\\":\\\"^1.9.3\\\",\\\"debug\\\":\\\"^4.1.1\\\",\\\"hark\\\":\\\"^1.2.3\\\",\\\"random-number\\\":\\\"^0.0.9\\\",\\\"retry\\\":\\\"^0.12.0\\\",\\\"websocket\\\":\\\"^1.0.28\\\"},\\\"devDependencies\\\":{\\\"babel-core\\\":\\\"^6.26.3\\\",\\\"babel-loader\\\":\\\"^7.1.1\\\",\\\"babel-plugin-transform-runtime\\\":\\\"^6.23.0\\\",\\\"babel-polyfill\\\":\\\"^6.26.0\\\",\\\"babel-preset-env\\\":\\\"^1.7.0\\\",\\\"babel-preset-es2015\\\":\\\"^6.24.1\\\",\\\"babel-preset-stage-0\\\":\\\"^6.24.1\\\",\\\"copy-webpack-plugin\\\":\\\"^5.0.4\\\",\\\"eslint\\\":\\\"^5.16.0\\\",\\\"eslint-plugin-react\\\":\\\"^7.13.0\\\",\\\"html-webpack-plugin\\\":\\\"^3.2.0\\\",\\\"http-server\\\":\\\"^0.11.1\\\",\\\"jest\\\":\\\"^24.9.0\\\",\\\"jest-websocket-mock\\\":\\\"^1.5.0\\\",\\\"mock-socket\\\":\\\"^9.0.0\\\",\\\"sweetalert2\\\":\\\"^8.11.4\\\",\\\"webpack\\\":\\\"^4.41.0\\\",\\\"webpack-cli\\\":\\\"^3.2.3\\\",\\\"webpack-dev-server\\\":\\\"^3.1.14\\\",\\\"webpack-jquery-ui\\\":\\\"^2.0.1\\\"},\\\"files\\\":[\\\"lib/\\\",\\\"screen/\\\",\\\"docs/\\\",\\\"README.md\\\",\\\"CHANGELOG.md\\\"]}\");\n\n/***/ })\n\n/******/ });\n});\n//# sourceMappingURL=tttwebsdk.js.map\n\n//# sourceURL=webpack:///./lib/tttwebsdk.js?");

/***/ }),

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/*! exports provided: name, version, description, main, scripts, author, license, dependencies, devDependencies, default */
/***/ (function(module) {

eval("module.exports = JSON.parse(\"{\\\"name\\\":\\\"tttwebsdkdemo\\\",\\\"version\\\":\\\"1.1.1\\\",\\\"description\\\":\\\"\\\",\\\"main\\\":\\\"index.js\\\",\\\"scripts\\\":{\\\"test\\\":\\\"echo \\\\\\\"Error: no test specified\\\\\\\" && exit 1\\\",\\\"start\\\":\\\"webpack-dev-server --open\\\",\\\"host\\\":\\\"webpack-dev-server --https --host=0.0.0.0 --open --watch --inline --mode=development\\\",\\\"build\\\":\\\"webpack --config webpack.config.js\\\"},\\\"author\\\":\\\"\\\",\\\"license\\\":\\\"ISC\\\",\\\"dependencies\\\":{\\\"tttwebsdk\\\":\\\"^3.4.7\\\"},\\\"devDependencies\\\":{\\\"webpack\\\":\\\"^4.41.0\\\",\\\"webpack-cli\\\":\\\"^3.3.9\\\",\\\"webpack-dev-server\\\":\\\"^3.1.14\\\",\\\"webpack-jquery-ui\\\":\\\"^2.0.1\\\"}}\");\n\n//# sourceURL=webpack:///./package.json?");

/***/ }),

/***/ "./src/websdkdemo.js":
/*!***************************!*\
  !*** ./src/websdkdemo.js ***!
  \***************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/tttwebsdk */ \"./lib/tttwebsdk.js\");\n/* harmony import */ var _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0__);\n // import from local tttwebsdk.js\n// import TTTRtcWeb from 'tttwebsdk'; // npm install tttwebsdk@latest\n\n// \n// TTTRtcWeb.setPrivate(true);\n// TTTRtcWeb.setIpLocationAddress('v1.jkim.ccb.com');\n// TTTRtcWeb.setServerUrl('webmedia7.3ttech.cn');\n// TTTRtcWeb.setServerUrl('v7.jkim.ccb.com');\n// TTTRtcWeb.setServerUrl('gzeduservice.3ttech.cn');\n// TTTRtcWeb.setLogSubmit(false);\n// TTTRtcWeb.setServerUrl('xiaoyao1.3ttech.cn');\n\nconst isSupp = _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.isSystemSupported();\nconsole.log(`isSupp: ${isSupp}`);\n\nlet RTCObj = null;\n\nconst pkg = __webpack_require__(/*! ../package.json */ \"./package.json\");\nlet demoVersion = pkg.version;\n\nlet sdkVersion = _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.getVersion();\n\ndocument.getElementById('sysVersion').innerHTML = `ver: ${demoVersion} - ${sdkVersion}`;\n\n// \nlet client = null;\nlet streams = new Map();\n\nlet hasPublishStream = false;\nlet hasPublishScreen = false;\nlet hasPublishMediaSource = false;\n\nlet gStream = null;\nlet gScreenStream = null;\nlet gMediaSourceStream = null;\n\nlet intv = null;\n\nlet remote_stream = new Map();\n\n// const stream_net_info = document.getElementById('stream_net_info');\nconst text_info = document.getElementById('text_info');\n\nlet sourceMediaStream;\n\nconst videoSelect = document.getElementById(\"cameraDev\");\nconst audioInputSelect = document.getElementById('micDev');\nconst audioOutputSelect = document.getElementById('speakerDev');\nconst userRoleSelect = document.getElementById('userRole');\n\nlet cameraDevId = 'default';\nlet micDevId = 'default';\nlet speakerDevId = 'default';\nlet audioProfile = 'default';\nlet audioCodec = 'isac';\n\nconst appIdEle = document.getElementById('appID');\n\n// \nlet userId = 0;\nif (!!window.localStorage)\n{\n\tuserId = window.localStorage.getItem('tttUserId');\n}\n\nif (!userId || !(parseInt(userId, 10)))\n{\n\tconst rSeed = (Math.random() * 100000000);\n\tuserId = Math.floor(rSeed) + 1;\n\n\twindow.localStorage.setItem('tttUserId', userId);\n}\n\nconst userIdEle = document.getElementById('userid');\nif (!!userIdEle)\n{\n\tuserIdEle.value = userId;\n}\n\nconst roomIdEle = document.getElementById('chanid');\n\nconst rtmpUrlEle = document.getElementById('rtmpUrl');\n// \nlet screenEle = document.getElementById('screen');\nlet videoEle = document.getElementById('video');\n\nlet audioVolumeProgressEle = document.getElementById('audioVolumeProgress');\nlet audioVolumeValueEle = document.getElementById('audioVolumeValue');\n// \nlet userRole = 2;\n\n// \nlet sei = {\n    // ts: '',\n    // ver: '20161227',\n    canvas: {\n        bgrad: [\n            232,\n            230,\n            232\n        ],\n        h: 480,\n        w: 640\n    },\n    mid: '',\n    pos: []\n}\n// \nlet tttStatus = 0;\n\n// \n// url: https://...../?auto=1&r=666777&u=111111&h=webmedia4.3ttech.cn\nlet isAutoPub = getQueryVariable('auto');\nlet xRoomId = getQueryVariable('r');\nif (!!xRoomId)\n{\n\troomIdEle.value = xRoomId;\n}\n\nlet xUserId = getQueryVariable('u');\nif (!!xUserId)\n{\n\tuserIdEle.value = xUserId;\n}\nlet xAppId = 'a967ac491e3acf92eed5e1b5ba641ab7'; // test900572e02867fab8131651339518\nlet xSpecMic = getQueryVariable('m');\nlet xSpecServer = getQueryVariable('h');\n\ngetDevices();\n\nautoPublish();\n\nfunction autoPublish()\n{\n\tconsole.log(`<demo> Load. isAutoPub: ${isAutoPub} roomId: ${roomIdEle.value} userId: ${userIdEle.value}`);\n\n\tif (!!roomIdEle.value && !!userIdEle.value && isAutoPub)\n\t{\n\t\tjoinChan(xAppId, roomIdEle.value, userIdEle.value);\n\t}\n}\n\nfunction getQueryVariable(variable)\n{\n\tvar query = window.location.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++)\n\t{\n\t\tvar pair = vars[i].split('=');\n\t\tif (pair[0] == variable)\n\t\t{\n\t\t\treturn pair[1];\n\t\t}\n\t}\n\treturn(false);\n}\n\nfunction joinChan(appid, chanid, userid)\n{\n\t// \n\tif (tttStatus === 1)\n\t{\n\t\ttext_info.value = text_info.value + '已在房间内，无需重复登录' + '\\n';\n\n\t\treturn;\n    }\n\n\t// \n\tif (!!xSpecServer)\n\t{\n\t\tif (xSpecServer !== '')\n\t\t{\n\t\t\t_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.setServerUrl(xSpecServer);\n\t\t}\n\t}\n\n\tRTCObj = new _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a();\n\n\tconst cdnUrl = (!!rtmpUrlEle) ? rtmpUrlEle.value : '';\n    client = RTCObj.createClient({\n\t\trole: userRole,\n\t\trtmpUrl: cdnUrl,\n\t\tvideoMixerBGIUrl: 'http://3ttech.cn/res/tpl/default/images/test.png',\n\t\taudioCodec\n\t});\n \n    client.init(appid, userid, () => {\n        client.join('', chanid, () => {\n\t\t\ttext_info.value = `<demo> 成功加入房间!! userid: ${userid}` + '\\n';\n\n\t\t\tconsole.log(`<demo> 成功加入房间!! userid: ${userid}`);\n\n\t\t\ttttStatus = 1; // 状态标注为: 登录成功\n\n\t\t\tdocument.getElementById('loginStatus').innerHTML = `<font color=\"green\">登录成功</font>`;\n\t\t\tdocument.getElementById('loginInfo').innerHTML = `-- role: ${userRole}<br>`;\n\n\t\t\t// \n\t\t\tintv = setInterval(() => {\n\t\t\t\t// stream_net_info.value = `${JSON.stringify(client.getNetState())}`;\n\t\t\t\t// \n\t\t\t\tconst rAudioStats = client.remoteAudioStats();\n\t\t\t\trAudioStats.forEach((value, key) => {\n\t\t\t\t\t; // console.log(`<demo> <STAT> audioDownStat -- streamId: ${key} ${JSON.stringify(value)}`);\n\t\t\t\t});\n\n\t\t\t\t// \n\t\t\t\tconst rVideoStats = client.remoteVideoStats();\n\t\t\t\trVideoStats.forEach((value, key) => {\n\t\t\t\t\t; // console.log(`<demo> <STAT> videoDownStat -- streamId: ${key} ${JSON.stringify(value)}`);\n\t\t\t\t});\n\n\t\t\t\t// \n\t\t\t\tconst lAudioStats = client.localAudioStats();\n\t\t\t\tlAudioStats.forEach((value, key) => {\n\t\t\t\t\t; // console.log(`<demo> <STAT> audioUpStat -- streamId: ${key} ${JSON.stringify(value)}`);\n\t\t\t\t});\n\n\t\t\t\t// \n\t\t\t\tconst lVideoStats = client.localVideoStats();\n\t\t\t\tlVideoStats.forEach((value, key) => {\n\t\t\t\t\t; // console.log(`<demo> <STAT> videoUpStat -- streamId: ${key} ${JSON.stringify(value)}`);\n\t\t\t\t});\n\n\t\t\t\t// \n\t\t\t\tconst rtcStats = client.getStats();\n\t\t\t\t; // console.log(`<demo> <STAT> rtcStats -- ${JSON.stringify(rtcStats)}`);\n\n\t\t\t\t// for volume\n\t\t\t\tif (!!gStream)\n\t\t\t\t{\n\t\t\t\t\tconst vol = gStream.getAudioLevel();\n\t\t\t\t\t;// console.log(`<demo> <AUDIO-VOLUME> - local audio: ${vol}`);\n\n\t\t\t\t\t// \n\t\t\t\t\tremote_stream.forEach((item) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!!item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\tconst rVol = item.getAudioLevel();\n\t\t\t\t\t\t\t;// console.log(`<demo> <AUDIO-VOLUME> - remote audio: ${rVol}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\t// for \n\t\t\t}, 2000);\n\n\t\t\t// \n\t\t\tif (isAutoPub)\n\t\t\t{\n\t\t\t\tpublishStream({\n\t\t\t\t\tuserid : userIdEle.value,\n\t\t\t\t\taudio  : true,\n\t\t\t\t\tvideo  : true,\n\t\t\t\t\tscreen : false,\n\t\t\t\t\tmediasource : false\n\t\t\t\t});\n\t\t\t}\n\t\t\t// \n        }, (err) => {\n\t\t\ttttStatus = 0;\n\n\t\t\ttext_info.value = text_info.value + `<demo> login failed. - error: ${JSON.stringify(err)}` + '\\n';\n\n\t\t\tconsole.log(`<demo> login failed. - error: ${JSON.stringify(err)}`);\n\n\t\t\tdocument.getElementById('loginStatus').innerHTML = '<font color=\"red\">登录失败</font>';\n\t\t\tdocument.getElementById('loginInfo').innerHTML = '';\n        });\n    }, (err) => {\n\t\ttext_info.value = text_info.value + `<demo> init failed. - error: ${JSON.stringify(err)}` + '\\n';\n\t\tconsole.log(`<demo> init failed. - error: ${JSON.stringify(err)}`);\n\n\t\treturn;\n\t});\n\n\tclient.on('device-hot-plug', (e) => {\n\t\tconsole.log(`<demo> - event [device-hot-plug] - ${JSON.stringify(e)}`);\n\t})\n\t\n\tclient.on('reinit', () => {\n\t\ttext_info.value = text_info.value + '<demo> - event [reinit]' + '\\n';\n\t\tconsole.log('<demo> - event [reinit]');\n\t\t\n\t\t// \n\t\tremote_stream.forEach((item) =>\n\t\t{\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\t// \n\t\t\t\titem.close();\n\t\t\t}\n\t\t});\n\t\tremote_stream.clear();\n\n\t\t// \n\t\t_innerUnpublishStream({\n\t\t\tvideo       : true,\n\t\t\tscreen      : false,\n\t\t\tmediasource : false\n\t\t});\n\t\t_innerUnpublishStream({\n\t\t\tvideo       : false,\n\t\t\tscreen      : true,\n\t\t\tmediasource : false\n\t\t});\n\t\t_innerUnpublishStream({\n\t\t\tvideo       : false,\n\t\t\tscreen      : false,\n\t\t\tmediasource : true\n\t\t});\n\t});\n\n\tclient.on('connection-state-change', (evt) =>{\n\t\ttext_info.value = text_info.value + `<demo> - event [connection-state-change] - ${JSON.stringify(evt)}` + '\\n';\n\t\tconsole.log(`<demo> - event [connection-state-change] - ${JSON.stringify(evt)}`);\n\t});\n\n\tclient.on('disconnected', () => {\n\t\ttttStatus = 0;\n\n\t\ttext_info.value = text_info.value + '<demo> - event [disconnected]' + '\\n';\n\t\tconsole.log('<demo> - event [disconnected]');\n\t\t\n\t\t_onClose();\n\t});\n\n\tclient.on('kickout', (evt) => {\n\t\ttttStatus = 0;\n\n\t\ttext_info.value = text_info.value + `<demo> - event [kickout] ${JSON.stringify(evt)}` + '\\n';\n\t\tconsole.log(`<demo> - event [kickout] ${JSON.stringify(evt)}`);\n\t\t\n\t\t_onClose();\n\t});\n\n    client.on('peer-join', (evt) => {\n\t\ttext_info.value = text_info.value + `<demo> - event [peer-join] uid: ${evt.userID}` + '\\n';\n\n        console.log(`<demo> - event [peer-join] uid: ${evt.userID}`);\n    });\n\n    client.on('peer-leave', (evt) => {\n\t\ttext_info.value = text_info.value + `<demo> - event [peer-leave] uid: ${evt.userID}` + '\\n';\n        console.log(`<demo> - event [peer-leave] uid: ${evt.userID}`);\n\n        evt.streams.forEach(stream => {\n\t\t\tif (!stream)\n\t\t\t\treturn;\n\n\t\t\tlet obj = document.getElementById('3t_remote' + stream.getId());\n\t\t\tif (obj)\n\t\t\t{\n\t\t\t\tobj.remove();\n\t\t\t}\n\n            // remove stream from map\n            remote_stream.delete(stream.getId());\n\n\t\t\tstream.close();\n        });\n\t});\n\t\n\tclient.on('audio-added', (evt) => {\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\t\t\t\n\t\ttext_info.value = text_info.value + `<demo> - event [audio-added] streamId: ${evt.stream.getId()}` + '\\n';\n\n\t\tconsole.log(`<demo> - event [audio-added] streamId: ${evt.stream.getId()}`);\n\n\t\tremote_stream.set(stream.getId(), stream);\n        let in_stream = remote_stream.get(stream.getId());\n        client.subscribe(in_stream, (event) => {\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe audio ${evt.stream.getId()} type: ${evt.stream.type} succ.` + '\\n';\n            // successful doing someting, like play remote video or audio.\n        }, (err) => {\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe audio ${evt.stream.getId()} type: ${evt.stream.type} failed. - error: ${JSON.stringify(err)}` + '\\n';\n            // info.val(info.val() + 'Subscribe stream failed' + err + '\\n');\n        });\n\t})\n\n\tclient.on('video-added', (evt) => {\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\t\t\t\n\t\ttext_info.value = text_info.value + `<demo> - event [video-added] streamId: ${evt.stream.getId()}` + '\\n';\n\n\t\tconsole.log(`<demo> - event [video-added] streamId: ${evt.stream.getId()}`);\n\n\t\tremote_stream.set(stream.getId(), stream);\n\t\t// \n        let in_stream = remote_stream.get(stream.getId());\n        client.subscribe(in_stream, (event) => {\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe video ${evt.stream.getId()} type: ${evt.stream.type} succ.` + '\\n';\n            // successful doing someting, like play remote video or audio.\n        }, (err) => {\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe video ${evt.stream.getId()} type: ${evt.stream.type} failed. - error: ${JSON.stringify(err)}` + '\\n';\n            // info.val(info.val() + 'Subscribe stream failed' + err + '\\n');\n        });\n\t})\n\n    client.on('stream-subscribed', (evt) => {\n        var stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\t\ttext_info.value = text_info.value + `<demo> - event [stream-subscribed] streamId: ${stream.getId()} stream.type: ${stream.type}` + '\\n';\n\t\tconsole.log(`<demo> - event [stream-subscribed] streamId: ${stream.getId()} stream.type: ${stream.type}`);\n\n\t\tif (stream.hasAudio())\n\t\t{\n\t\t\tstream.on('volume-change', e => {\n\t\t\t\t; // console.log(`<AUDIO-VOLUME> - volume-change -- userID: ${e.userID} volume: ${e.volume}`);\n\t\t\t});\n\t\t}\n\n\t\tif(stream.type === 'audio')\n\t\t{\n            stream.play();\n\t\t}\n\t\telse\n\t\t{\n            var videoId = '3t_remote' + stream.getId();\n\t\t\tif(!!videoEle && !document.getElementById(videoId))\n\t\t\t{\n                let video = document.createElement('video');\n\t\t\t\tvideo.id = videoId;\n\t\t\t\tvideo.muted = false;\n\t\t\t\tvideo.autoplay = true;\n\t\t\t\tvideo.controls = true;\n\t\t\t\tvideo.setAttribute('playsinline', '');\n                video.style.cssText = 'height: 300px; width: 300px; background: black; position:relative; display:inline-block;'\n\t\t\t\tvideoEle.append(video);\n            }\n\n            stream.play('3t_remote' + stream.getId(), true);\n\t\t}\n    });\n\n    client.on('video-mute', (evt) => {\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\ttext_info.value = text_info.value + `<demo> - event [video-mute] streamId: ${stream.getId()}` + '\\n';\n\t\tconsole.log(`<demo> - event [video-mute] streamId: ${stream.getId()}`);\n\n\t\tstream._video.style.backgroundColor = 'transparent';\n\t\t// stream._video.srcObject = null;\n\t\tstream._video.poster = 'http://www.3ttech.cn/favicon.ico';\n\n\t\t// visibility: hidden\n\t\t\n\t});\n\t\n\tclient.on('video-unmute', (evt) => {\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\t\t\t\n\t\ttext_info.value = text_info.value + `<demo> - event [video-unmute] streamId: ${stream.getId()}` + '\\n';\n\t\tconsole.log(`<demo> - event [video-unmute] streamId: ${stream.getId()}`);\n\t\t\n\t\tstream._video.style.backgroundColor = '#000';\n\t\tstream._video.srcObject = stream._streamObj;\n\t\tstream._video.poster = '';\n\t});\n}\n\nfunction leaveChan()\n{\n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + 'leaveChan while tttStatus is not 1?' + '\\n';\n\t\treturn;\n\t}\n\t\n\t_onClose();\n\n\tif (client)\n\t{\n        client.leave(() => { }, () => { });\n        client.close();\n\t}\n\n\ttext_info.value = text_info.value + 'leaveChan OK' + '\\n';\n}\n\nfunction _onClose()\n{\n\t// \n\tremote_stream.forEach((item) =>\n\t{\n\t\tif (!!item)\n\t\t{\n\t\t\t// \n\t\t\tlet obj = document.getElementById('3t_remote' + item.getId());\n\t\t\tif (obj)\n\t\t\t{\n\t\t\t\tobj.remove();\n\t\t\t}\n\t\t\t// \n\t\t\titem.close();\n\t\t}\n\t});\n\tremote_stream.clear();\n\n\t// \n\tunpublishStream({\n\t\tvideo       : true,\n\t\tscreen      : false,\n\t\tmediasource : false\n\t\t});\n\tunpublishStream({\n\t\tvideo       : false,\n\t\tscreen      : true,\n\t\tmediasource : false\n\t\t});\n\tunpublishStream({\n\t\tvideo       : false,\n\t\tscreen      : false,\n\t\tmediasource : true\n\t\t});\n\n\t// \n\tif (intv !== null)\n\t{\n\t\tclearInterval(intv);\n\t\tintv = null;\n\t}\n\n\t// \n\t{\n\t\tlet obj = document.getElementById('3t_local_screen');\n\t\tif (obj)\n\t\t{\n\t\t\tobj.remove();\n\t\t}\n\n\t\t// \n\t\tif (!!gScreenStream)\n\t\t{\n\t\t\tstreams.delete(gScreenStream.getId());\n\t\t\t\n\t\t\tgScreenStream.close();\n\t\t\tgScreenStream = null;\n\t\t}\n\t}\n\n\t// \n\t{\n\t\tlet obj = document.getElementById('3t_local');\n\t\tif (obj)\n\t\t{\n\t\t\tobj.remove();\n\t\t}\n\n\t\t// \n\t\tif (!!gStream)\n\t\t{\n\t\t\tstreams.delete(gStream.getId());\n\t\t\t\n\t\t\tgStream.close();\n\t\t\tgStream = null;\n\t\t}\n\t}\n\t// \n\t\n\ttttStatus = 0;\n\n\t// \n\tdocument.getElementById('loginStatus').innerHTML = '<font color=\"red\">未登录</font>';\n\tdocument.getElementById('loginInfo').innerHTML = '';\n}\n\nfunction setRtmpUrl(url)\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> setRtmpUrl - 请先[加入房间]' + '\\n';\n\n\t\treturn;\n\t}\n\t\n\t// \n\tconst pureAudioEle = document.getElementById('pureAudio');\n\n\tclient.setRtmpUrl({ url, avMode: pureAudioEle.checked ? 'audio' : 'av' } );\n}\n\nlet joinChanEle = document.getElementById('joinChan');\nif (!!joinChanEle)\n{\n\tjoinChanEle.addEventListener('click', () => {\n\t\tlet appId = appIdEle.value;\n\t\tlet rid = roomIdEle.value;\n\t\tlet uid = userIdEle.value;\n\t\tjoinChan(appId, rid, uid);\n\t})\n}\n\nlet leaveChanEle = document.getElementById('leaveChan');\nif (!!leaveChanEle)\n{\n\tleaveChanEle.addEventListener('click', () => {\n\t\tleaveChan();\n\t})\n}\n\nlet setRtmpUrlEle = document.getElementById('setRtmpUrl');\nif (!!setRtmpUrlEle)\n{\n\tsetRtmpUrlEle.addEventListener('click', () => {\n\t\tif (!!rtmpUrlEle)\n\t\t{\n\t\t\tconst cdnUrl = rtmpUrlEle.value;\n\t\t\tsetRtmpUrl(cdnUrl);\n\t\t}\n\t})\n}\n\n// \nfunction setStreamSEI(userid, streamId, type, isScreen)\n{\n\tif(+userRole !== 1)\n\t\treturn;\n\n\tlet sei = {\n\t\tts: '',\n\t\tver: '20161227',\n\t\tcanvas: {\n\t\t\tbgrad: [\n\t\t\t\t232,\n\t\t\t\t230,\n\t\t\t\t232\n\t\t\t],\n\t\t\th: 640,\n\t\t\tw: 368\n\t\t},\n\t\tmid: '',\n\t\tpos: []\n\t}\n\n    sei.mid = userIdEle.value; // userIdEle.value 为 主播ID\n\t// sei.ts = + new Date();\n\n\tlet nCnt = remote_stream.size;\n\n\tif (!!gStream)\n\t{\n\t\tnCnt++;\n\t}\n\t\n\tif (!!gScreenStream)\n\t{\n\t\tnCnt++;\n\t}\n\n\tlet isSplit = nCnt > 1;\n\t\n\tlet nIndex = 0;\n\tif (!!gStream)\n\t{\n\t\tlet position = {};\n\n\t\tposition.id = gStream.getId();\n\t\tposition.x = 0;\n\t\tposition.y = 0;\n\t\tposition.w = isSplit ? 0.5 : 1;\n\t\tposition.h = isSplit ? 0.5 : 1;\n\t\tposition.z = 0;\n\n\t\tsei.pos.push(position);\n\n\t\tnIndex++;\n\t}\n\t\n\tif (!!gScreenStream)\n\t{\n\t\tlet position = {};\n\n\t\tposition.id = gScreenStream.getId();\n\t\tposition.x = (isSplit && nIndex === 1) ? 0.5 : 0;\n\t\tposition.y = 0;\n\t\tposition.w = isSplit ? 0.5 : 1;\n\t\tposition.h = isSplit ? 0.5 : 1;\n\t\tposition.z = 0;\n\n\t\tsei.pos.push(position);\n\n\t\tnIndex++;\n\t}\n\n\t// \n\tremote_stream.forEach((item) =>\n\t{\n\t\tif (Boolean(item))\n\t\t{\n\t\t\tlet position = {};\n\t\t\t// \n\t\t\tposition.id = item.getId();\n\t\t\tposition.x = (isSplit && (nIndex === 3)) ? 0 : 0.5;\n\t\t\tposition.y = (isSplit && nIndex > 0) ? 0.5 : 0;\n\t\t\tposition.w = isSplit ? 0.5 : 1;\n\t\t\tposition.h = isSplit ? 0.5 : 1;\n\t\t\tposition.z = 0;\n\n\t\t\tsei.pos.push(position);\n\t\n\t\t\tnIndex++;\n\t\t}\n\t});\n\n\t// \n    client.setSEI(userid, type, isScreen, sei, streamId);\n};\n\n/*\nfunction setStreamSEI(userid, streamId, type, isScreen)\n {\n\tif(client._role !== '1')\n\t\treturn;\n\n\tlet position = {\n\t\tid: 0,\n\t\th: 0,\n\t\tw: 0,\n\t\tx: 0,\n\t\ty: 0,\n\t\tz: 1\n\t};\n\n    sei.mid = userIdEle.value; // userIdEle.value 为 主播ID\n    // sei.ts = + new Date(); // ts 字段可以忽略\n    position.id = streamId;\n    position.x = 0;\n    position.y = 0;\n    position.w = 1;\n    position.h = 1;\n\tposition.z = 0;\n\t\n\tsei.pos = [];\n\tsei.pos.push(position);\n\n    client.setSEI(userid, type, isScreen, sei, streamId);\n};\n*/\n\nfunction setVideoProfile(prof)\n{\n\tif (gStream === null)\n\t{\n\t\treturn;\n\t}\n\n\t// set video profile\n\tgStream.setVideoProfile(prof, (msg) => {\n\t\ttext_info.value = text_info.value + `<demo> setVideoProfile - gStream.setVideoProfile succ. ${prof}` + '\\n';\n\t\tconsole.log(`<demo> setVideoProfile - gStream.setVideoProfile succ: ${prof}`);\n\t}, (e) => {\n\t\ttext_info.value = text_info.value + `<demo> setVideoProfile - gStream.setVideoProfile failed. - error: ${JSON.stringify(e)}` + '\\n';\n\t\tconsole.log('<demo> setVideoProfile - gStream.setVideoProfile - error: ' + e);\n\t});\n}\n\nfunction createMediaSourceStream()\n{\n\tif (!!sourceMediaStream)\n\t{\n\t\treturn;\n\t}\n\n\t//\n\tconst mediaSource = document.getElementById('mediaSource');\n\tif (!mediaSource)\n\t{\n\t\treturn;\n\t}\n\n\tif (mediaSource.captureStream)\n\t{\n\t\tsourceMediaStream = mediaSource.captureStream();\n\t\tconsole.log('Captured sourceMediaStream from mediaSource with captureStream', sourceMediaStream);\n\t}\n\telse if (mediaSource.mozCaptureStream)\n\t{\n\t\tsourceMediaStream = mediaSource.mozCaptureStream();\n\t\tconsole.log('Captured sourceMediaStream from mediaSource with mozCaptureStream()', sourceMediaStream);\n\t}\n\telse\n\t{\n\t\tconsole.log('captureStream() not supported');\n\t}\n}\n\nfunction previewLocalStream(opts)\n{\n\tif (RTCObj === null)\n\t{\n\t\tRTCObj = new _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a();\n\t}\n\n\tconst {\n\t\tuserid,\n\t\taudio,\n\t\tvideo,\n\t\tscreen,\n\t\tmediasource\n\t} = opts;\n\n\tlet v = (+video) + (+screen) + (+mediasource);\n\tif (v > 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> previewLocalStream() - video/screen/mediasouce 三个参数，仅允许一个取 true' + '\\n';\n\t\treturn;\n\t}\n\n\tlet mediaStream = null;\n\t\n\tif (Boolean(screen))\n\t{\n\t\tmediaStream = gScreenStream;\n\t}\n\telse if (Boolean(mediasource))\n\t{\n\t\tmediaStream = gMediaSourceStream;\n\t}\n\telse if (Boolean(video) || Boolean(audio))\n\t{\n\t\tmediaStream = gStream;\n\t}\n\n\tif (mediaStream === null)\n\t{\n\t\tlet resolutionEle = document.getElementById('resolution');\n\t\tlet specRes = (!!resolutionEle) ? resolutionEle.value : '480p';\n\t\tlet resolution = Boolean(screen) ? '1080p' : specRes;\n\n\t\tconst streamId = Boolean(screen) ? `${userid}-screen` : `${userid}`;\n\n\t\tconsole.log(`<demo> previewLocalStream() userid: ${userid} cameraDevId: ${cameraDevId} micDevId: ${micDevId} resolution: ${resolution}`);\n\n\t\t// \n\t\t// \n\t\tlet audioSource = null;\n\t\tlet videoSource = null;\n\t\tif (mediasource)\n\t\t{\n\t\t\tcreateMediaSourceStream();\n\n\t\t\tif (!!sourceMediaStream)\n\t\t\t{\n\t\t\t\tconst audioTracks = sourceMediaStream.getVideoTracks();\n\t\t\t\tif (audioTracks.length > 0)\n\t\t\t\t\taudioSource = audioTracks[0];\n\t\t\t\tconst videoTracks = sourceMediaStream.getAudioTracks();\n\t\t\t\tif (videoTracks.length > 0)\n\t\t\t\t\tvideoSource = videoTracks[0];\n\t\t\t}\n\t\t}\n\n\t\tmediaStream = RTCObj.createStream({\n\t\t\tstreamId,\n\t\t\tuserId: +userid,\n\t\t\taudio: Boolean(audio),\n\t\t\tvideo: Boolean(video),\n\t\t\tscreen: Boolean(screen),\n\t\t\tmediasource: Boolean(mediasource),\n\t\t\taudioSource,\n\t\t\tvideoSource,\n\t\t\tcameraId: cameraDevId === 'default' ? null : cameraDevId,\n\t\t\tmicrophoneId: micDevId === 'default' ? null : micDevId,\n\t\t\tattributes: { videoProfile : resolution },\n\t\t\topenAudioCtx: true\n\t\t});\n\n\t\tif (!mediaStream)\n\t\t\treturn;\n\n\t\twindow.ls = mediaStream;\n\n\t\t// \n\t\tif (audioProfile !== 'default')\n\t\t{\n\t\t\tmediaStream.setAudioProfile(audioProfile);\n\t\t}\n\n\t\tmediaStream.init(() => {\n\t\t\tif (!Boolean(mediasource) && (Boolean(video) || Boolean(screen)))\n\t\t\t{\n\t\t\t\tconst videoId = Boolean(screen) ? '3t_local_screen' : '3t_local';\n\t\t\t\tlet videoE = document.createElement('video');\n\t\t\t\tvideoE.id = videoId;\n\t\t\t\tvideoE.muted = true;\n\t\t\t\tvideoE.autoplay = true;\n\t\t\t\tvideoE.controls = true;\n\t\t\t\tvideoE.setAttribute('playsinline', '');\n\t\t\t\tvideoE.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;'\n\n\t\t\t\tif (Boolean(screen))\n\t\t\t\t{\n\t\t\t\t\tif (!!screenEle)\n\t\t\t\t\t{\n\t\t\t\t\t\tscreenEle.append(videoE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (!!videoEle)\n\t\t\t\t\t{\n\t\t\t\t\t\tvideoEle.append(videoE);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmediaStream.play(videoId, true);\n\t\t\t}\n\t\t\t// \n\t\t\t\n\t\t\tstreams.set(mediaStream.getId(), mediaStream);\n\n\t\t\tif (Boolean(screen))\n\t\t\t{\n\t\t\t\tgScreenStream = mediaStream;\n\t\t\t}\n\t\t\telse if (Boolean(mediasource))\n\t\t\t{\n\t\t\t\tgMediaSourceStream = mediaStream;\n\t\t\t}\n\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t{\n\t\t\t\tgStream = mediaStream;\n\t\t\t}\n\t\t\t// \n\t\t}, (evt) => {\n\t\t\ttext_info.value = text_info.value + `<demo> publishStream - Stream.init failed. - error: ${JSON.stringify(evt)}` + '\\n';\n\t\t\tconsole.log('<demo> publishStream - Stream.init failed. - error: ' + evt);\n\t\t});\n\t}\n\telse\n\t{\n\t\tconst videoId = Boolean(screen) ? '3t_local_screen' : '3t_local';\n\t\tmediaStream.play(videoId, true);\n\t}\n}\n  \n// \nfunction publishStream(opts)\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> publishStream - 请先[加入房间]' + '\\n';\n\t\treturn;\n\t}\n\n\tconst {\n\t\tuserid,\n\t\taudio,\n\t\tvideo,\n\t\tscreen,\n\t\tmediasource\n\t} = opts;\n\n\tlet v = (+video) + (+screen) + (+mediasource);\n\tif (v > 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> publishStream - video/screen/mediasouce 三个参数，仅允许一个取 true' + '\\n';\n\t\treturn;\n\t}\n\n\tlet mediaStream = null;\n\t\n\tif (Boolean(screen))\n\t{\n\t\tmediaStream = gScreenStream;\n\t}\n\telse if (Boolean(mediasource))\n\t{\n\t\tmediaStream = gMediaSourceStream;\n\t}\n\telse if (Boolean(video) || Boolean(audio))\n\t{\n\t\tmediaStream = gStream;\n\t}\n\n\tif (mediaStream === null)\n\t{\n\t\tlet resolutionEle = document.getElementById('resolution');\n\t\tlet specRes = (!!resolutionEle) ? resolutionEle.value : '480p';\n\t\tlet resolution = Boolean(screen) ? '1080p' : specRes;\n\n\t\tconst streamId = Boolean(screen) ? `${userid}-screen` : `${userid}`;\n\n\t\tconsole.log(`<demo> publishStream() userid: ${userid} video: ${video} cameraDevId: ${cameraDevId} audio: ${audio} micDevId: ${micDevId} resolution: ${resolution}`);\n\n\t\t// \n\t\t// \n\t\tlet audioSource = null;\n\t\tlet videoSource = null;\n\t\tif (mediasource)\n\t\t{\n\t\t\tcreateMediaSourceStream();\n\n\t\t\tif (!!sourceMediaStream)\n\t\t\t{\n\t\t\t\tconst audioTracks = sourceMediaStream.getVideoTracks();\n\t\t\t\tif (audioTracks.length > 0)\n\t\t\t\t\taudioSource = audioTracks[0];\n\t\t\t\tconst videoTracks = sourceMediaStream.getAudioTracks();\n\t\t\t\tif (videoTracks.length > 0)\n\t\t\t\t\tvideoSource = videoTracks[0];\n\t\t\t}\n\t\t}\n\n\t\tmediaStream = RTCObj.createStream({\n\t\t\tstreamId,\n\t\t\tuserId: +userid,\n\t\t\taudio: Boolean(audio),\n\t\t\tvideo: Boolean(video),\n\t\t\tscreen: Boolean(screen),\n\t\t\tmediasource: Boolean(mediasource),\n\t\t\taudioSource,\n\t\t\tvideoSource,\n\t\t\tcameraId: cameraDevId === 'default' ? null : cameraDevId,\n\t\t\tmicrophoneId: micDevId === 'default' ? null : micDevId,\n\t\t\tattributes: { videoProfile : resolution },\n\t\t\topenAudioCtx: true\n\t\t});\n\n\t\tif (!mediaStream)\n\t\t\treturn;\n\n\t\twindow.ls = mediaStream;\n\n\t\t// \n\t\tif (audioProfile !== 'default')\n\t\t{\n\t\t\tmediaStream.setAudioProfile(audioProfile);\n\t\t}\n\n\t\tmediaStream.init(() => {\n\t\t\tmediaStream.on('screen-close', (e) => {\n\t\t\t\tconsole.log(`<demo> event [screen-close] - ${JSON.stringify(e)}`);\n\t\t\t\tunpublishStream({\n\t\t\t\t\tvideo       : false,\n\t\t\t\t\tscreen      : true,\n\t\t\t\t\tmediasource : false\n\t\t\t\t});\n\t\t\t});\n\t\t\t// \n\t\t\tif (!Boolean(mediasource) && (Boolean(video) || Boolean(screen)))\n\t\t\t{\n\t\t\t\tconst videoId = Boolean(screen) ? '3t_local_screen' : '3t_local';\n\t\t\t\tlet videoE = document.createElement('video');\n\t\t\t\tvideoE.id = videoId;\n\t\t\t\tvideoE.muted = true;\n\t\t\t\tvideoE.autoplay = true;\n\t\t\t\tvideoE.controls = true;\n\t\t\t\tvideoE.setAttribute('playsinline', '');\n\t\t\t\tvideoE.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;'\n\n\t\t\t\tif (Boolean(screen))\n\t\t\t\t{\n\t\t\t\t\tif (!!screenEle)\n\t\t\t\t\t{\n\t\t\t\t\t\tscreenEle.append(videoE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (!!videoEle)\n\t\t\t\t\t{\n\t\t\t\t\t\tvideoEle.append(videoE);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmediaStream.play(videoId, true);\n\t\t\t}\n\t\t\t// \n\t\t\t\n\t\t\tlet micPlaybackEle = document.getElementById('micPlayback');\n\t\t\tif (!!micPlaybackEle)\n\t\t\t{\n\t\t\t\tlet micPlayback = micPlaybackEle.checked;\n\t\t\t\tif (Boolean(micPlayback))\n\t\t\t\t{\n\t\t\t\t\tmediaStream.play();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstreams.set(mediaStream.getId(), mediaStream);\n\n\t\t\tif (Boolean(screen))\n\t\t\t{\n\t\t\t\tgScreenStream = mediaStream;\n\t\t\t}\n\t\t\telse if (Boolean(mediasource))\n\t\t\t{\n\t\t\t\tgMediaSourceStream = mediaStream;\n\t\t\t}\n\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t{\n\t\t\t\tgStream = mediaStream;\n\t\t\t}\n\n\t\t\t_publishStream(userid, mediaStream, () => {\n\t\t\t\tif (Boolean(screen))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t\t\thasPublishScreen = true;\n\t\t\t\t}\n\t\t\t\telse if (Boolean(mediasource))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t\t\thasPublishMediaSource = true;\n\t\t\t\t}\n\t\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t\t\thasPublishStream = true;\n\t\t\t\t}\n\t\t\t}, () => {\n\t\t\t\tif (Boolean(screen))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t\t\t}\n\t\t\t\telse if (Boolean(mediasource))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t\t\t}\n\t\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t\t\t}\n\t\t\t});\n\t\t\t// \n\t\t}, (evt) => {\n\t\t\ttext_info.value = text_info.value + `<demo> publishStream - Stream.init failed. - error: ${JSON.stringify(evt)}` + '\\n';\n\t\t\tconsole.log('<demo> publishStream - Stream.init failed. - error: ' + evt);\n\t\t});\n\t}\n\telse\n\t{\n\t\tif (Boolean(screen) && hasPublishScreen)\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> publishStream - hasPublishScreen: ${hasPublishScreen} mediaStream: ${mediaStream.getId()}` + '\\n';\n\t\t\tconsole.log(`<demo> publishStream - hasPublishScreen: ${hasPublishScreen}  mediaStream: ${mediaStream.getId()}`);\n\n\t\t\treturn;\n\t\t}\n\t\telse if (Boolean(mediasource) && hasPublishMediaSource)\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> publishStream - hasPublishMediaSource: ${hasPublishMediaSource} mediaStream: ${mediaStream.getId()}` + '\\n';\n\t\t\tconsole.log(`<demo> publishStream - hasPublishMediaSource: ${hasPublishMediaSource}  mediaStream: ${mediaStream.getId()}`);\n\t\n\t\t\treturn;\n\t\t}\n\t\telse if ((Boolean(video) || Boolean(audio)) && hasPublishStream)\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> publishStream - hasPublishStream: ${hasPublishStream} mediaStream: ${mediaStream.getId()}` + '\\n';\n\t\t\tconsole.log(`<demo> publishStream - hasPublishStream: ${hasPublishStream}  mediaStream: ${mediaStream.getId()}`);\n\t\n\t\t\treturn;\n\t\t}\n\n\t\t// \n\t\t_publishStream(userid, mediaStream, () => {\n\t\t\tif (Boolean(screen))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t\thasPublishScreen = true;\n\t\t\t}\n\t\t\telse if (Boolean(mediasource))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t\thasPublishMediaSource = true;\n\t\t\t}\n\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t\thasPublishStream = true;\n\t\t\t}\n\t\t}, () => {\n\t\t\tif (Boolean(screen))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t\t}\n\t\t\telse if (Boolean(mediasource))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t\t}\n\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t\t}\n\t\t});\n\t}\n\t// \n}\n\nfunction _publishStream(userid, mediaStream, onSuccess, onFailure)\n{\n\tif (!mediaStream)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> _publishStream error - mediaStream is null' + '\\n';\n\t\tconsole.log('<demo> _publishStream error - mediaStream is null');\n\n\t\treturn;\n\t}\n\n\t// \n\tclient.publish(mediaStream, () => {\n\t\t// \n\t\ttext_info.value = text_info.value + `<demo> _publishStream - client.publish succ. mediaStream: ${mediaStream.getId()}` + '\\n';\n\t\tconsole.log(`<demo> _publishStream - client.publish succ. mediaStream: ${mediaStream.getId()}`);\n\n\t\t// \n\t\tonSuccess && onSuccess();\n\n\t\t// \n\t\tconst streamId = mediaStream.getId();\n\t\tsetStreamSEI(userid, streamId, 'add', false);\n\n\t\t// \n\t\tif (mediaStream.hasAudio())\n\t\t{\n\t\t\tmediaStream.on('volume-change', e => {\n\t\t\t\tif (!!audioVolumeProgressEle)\n\t\t\t\t\taudioVolumeProgressEle.value = e.volume;\n\t\t\t\tif (!!audioVolumeValueEle)\n\t\t\t\t\taudioVolumeValueEle.innerHTML = e.volume;\n\t\t\t\t; // console.log(`<AUDIO-VOLUME> - volume-change -- userID: ${e.userID} volume: ${e.volume}`);\n\t\t\t});\n\t\t}\n\t}, (evt) => {\n\t\ttext_info.value = text_info.value + `_publishStream - client.publish failed. - error: ${JSON.stringify(evt)}` + '\\n';\n\t\tconsole.log(`<demo> _publishStream - client.publish failed. - error: ${JSON.stringify(evt)}`);\n\n\t\tonFailure && onFailure();\n\t});\n}\n\nfunction unpublishStream(opts)\n{\n\t_innerUnpublishStream(opts);\n}\n\nfunction _innerUnpublishStream(opts)\n{\n\tconst { video, screen, mediasource } = opts;\n\tlet mediaStream = null;\n\n\tif (Boolean(screen))\n\t{\n\t\tmediaStream = gScreenStream;\n\t\thasPublishScreen = false;\n\t}\n\telse if (Boolean(mediasource))\n\t{\n\t\tmediaStream = gMediaSourceStream;\n\t\thasPublishMediaSource = false;\n\t}\n\telse if (Boolean(video) || Boolean(audio))\n\t{\n\t\tmediaStream = gStream;\n\t\thasPublishStream = false;\n\t}\n\n\tif (mediaStream === null)\n\t{\n\t\ttext_info.value = text_info.value + 'unpublishStream - 当前尚未创建 mediaStream' + '\\n';\n\t\tconsole.log('<demo> 当前尚未创建 mediaStream');\n\t\treturn;\n\t}\n\n    client.unpublish(mediaStream, () => {\n\t\ttext_info.value = text_info.value + `<demo> unpublishStream - client.unpublish local stream ${mediaStream.getId()} success.` + '\\n';\n        console.log(`<demo> unpublishStream - client.unpublish local stream ${mediaStream.getId()} success.`);\n    }, () => {\n\t\ttext_info.value = text_info.value + '<demo> unpublishStream - client.unpublish local stream failed' + '\\n';\n\t\tconsole.log('<demo> unpublishStream - client.unpublish local stream failed');\n\t}, true);\n\n\t//\n\tif (Boolean(screen))\n\t{\n\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t}\n\telse if (Boolean(mediasource))\n\t{\n\t\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t}\n\telse if (Boolean(video) || Boolean(audio))\n\t{\n\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t}\n}\n\n//\nlet previewLocalEle = document.getElementById('previewLocal');\nif (!!previewLocalEle)\n{\n\tpreviewLocalEle.addEventListener('click', () => {\n\t\tpreviewLocalStream({\n\t\t\tuserid : userIdEle.value,\n\t\t\taudio  : true,\n\t\t\tvideo  : true,\n\t\t\tscreen : false,\n\t\t\tmediasource : false\n\t\t});\n\t})\n}\n\n//\nlet publishAudioStreamEle = document.getElementById('publishAudioStream');\nif (!!publishAudioStreamEle)\n{\n\tpublishAudioStreamEle.addEventListener('click', () => {\n\t\tpublishStream({\n\t\t\tuserid : userIdEle.value,\n\t\t\taudio  : true,\n\t\t\tvideo  : false,\n\t\t\tscreen : false,\n\t\t\tmediasource : false\n\t\t});\n\t})\n}\n\n// \nlet publishStreamEle = document.getElementById('publishStream');\nif (!!publishStreamEle)\n{\n\tpublishStreamEle.addEventListener('click', () => {\n\t\tpublishStream({\n\t\t\tuserid : userIdEle.value,\n\t\t\taudio  : true,\n\t\t\tvideo  : true,\n\t\t\tscreen : false,\n\t\t\tmediasource : false\n\t\t});\n\t})\n}\n\nlet unpublishStreamEle = document.getElementById('unpublishStream');\nif (!!unpublishStreamEle)\n{\n\tunpublishStreamEle.addEventListener('click', () => {\n\t\tunpublishStream({\n\t\t\tvideo       : true,\n\t\t\tscreen      : false,\n\t\t\tmediasource : false\n\t\t});\n\t})\n}\n\nlet micPlaybackEle = document.getElementById('micPlayback');\nif (!!micPlaybackEle)\n{\n\tmicPlaybackEle.addEventListener('click', () => {\n\t\tlet micPlayback = document.getElementById('micPlayback').checked;\n\t\tif (Boolean(micPlayback))\n\t\t{\n\t\t\tgStream.play();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgStream.stopPlay();\n\t\t}\n\t});\n}\n\n// \nlet cloneVideoTrack = null;\nlet testMediaStream = null;\nlet testOpenCameraEle = document.getElementById('testOpenCamera');\nif (!!testOpenCameraEle)\n{\n\tconst constraints = {\n\t\taudio: true,\n\t\tvideo: true\n\t}\n\ttestOpenCameraEle.addEventListener('click', () => {\n\t\tnavigator.mediaDevices.getUserMedia(constraints)\n\t\t\t.then(stream => {\n\t\t\t\ttestMediaStream = stream;\n\n\t\t\t\tlet tracks = stream.getVideoTracks();\n\t\t\t\tif (tracks.length > 0)\n\t\t\t\t{\n\t\t\t\t\tcloneVideoTrack = tracks[0].clone();\n\t\t\t\t}\n\t\t\t\t//\n\t\t\t\tconst videoId = 'test_camera';\n\t\t\t\tlet videoE = document.createElement('video');\n\t\t\t\tvideoE.id = videoId;\n\t\t\t\tvideoE.muted = true;\n\t\t\t\tvideoE.autoplay = true;\n\t\t\t\tvideoE.controls = true;\n\t\t\t\tvideoE.setAttribute('playsinline', '');\n\t\t\t\tvideoE.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;';\n\n\t\t\t\tvideoE.srcObject = testMediaStream;\n\n\t\t\t\tif (!!videoEle)\n\t\t\t\t{\n\t\t\t\t\tvideoEle.append(videoE);\n\t\t\t\t}\n\t\t\t});\n\t})\n}\n\nlet testCtrlCameraEle = document.getElementById('testCtrlCamera');\nif (!!testCtrlCameraEle)\n{\n\ttestCtrlCameraEle.addEventListener('click', () => {\n\t\ttestMediaStream.getVideoTracks().forEach((track) => {\n\t\t\ttrack.stop();\n\t\t\ttestMediaStream.removeTrack(track);\n\t\t});\n\n\t\tcloneVideoTrack.stop();\n\t\tcloneVideoTrack.stop();\n\t})\n}\n\n// \nlet isCameraStoped = false;\nlet ctrlCameraEle = document.getElementById('ctrlCamera');\nif (!!ctrlCameraEle)\n{\n\tctrlCameraEle.addEventListener('click', () => {\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isCameraStoped)\n\t\t{\n\t\t\tgStream.openCamera();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgStream.closeCamera();\n\t\t}\n\n\t\tisCameraStoped = !isCameraStoped;\n\n\t\tctrlCameraEle.innerHTML = isCameraStoped ? 'startCamera' : 'stopCamera';\n\t})\n}\n\nlet isVideoPaused = false;\nlet pauseVideoEle = document.getElementById('pauseVideo');\nif (!!pauseVideoEle)\n{\n\tpauseVideoEle.addEventListener('click', () => {\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isVideoPaused)\n\t\t{\n\t\t\tclient.resumeWebcam(gStream, () => {\n\t\t\t\tconsole.log('<demo> client.resumeWebcam succ.');\n\t\t\t}, (e) => {\n\t\t\t\tconsole.log(`<demo> client.resumeWebcam fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclient.pauseWebcam(gStream, false, () => {\n\t\t\t\tconsole.log('<demo> client.pauseWebcam succ.');\n\t\t\t}, (e) => {\n\t\t\t\tconsole.log(`<demo> client.pauseWebcam fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\n\t\tisVideoPaused = !isVideoPaused;\n\n\t\tpauseVideoEle.innerHTML = isVideoPaused ? 'resumeVideo' : 'pauseVideo';\n\t})\n}\n\nlet isAudioPaused = false;\nlet pauseAudioEle = document.getElementById('pauseAudio');\nif (!!pauseAudioEle)\n{\n\tpauseAudioEle.addEventListener('click', () => {\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\n\t\tif (isAudioPaused)\n\t\t{\n\t\t\tclient.resumeMic(gStream, () => {\n\t\t\t\tconsole.log('<demo> client.resumeMic succ.');\n\t\t\t}, (e) => {\n\t\t\t\tconsole.log(`<demo> client.resumeMic fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclient.pauseMic(gStream, () => {\n\t\t\t\tconsole.log('<demo> client.pauseMic succ.');\n\t\t\t}, (e) => {\n\t\t\t\tconsole.log(`<demo> client.pauseMic fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t\n\t\tisAudioPaused = !isAudioPaused;\n\t\n\t\tpauseAudioEle.innerHTML = isAudioPaused ? 'resumeAudio' : 'pauseAudio';\n\t})\t\n}\n\nlet isAudioDisabled = false;\nlet disableAudioEle = document.getElementById('disableAudio');\nif (!!disableAudioEle)\n{\n\tdisableAudioEle.addEventListener('click', () => {\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isAudioDisabled)\n\t\t{\n\t\t\tgStream.enableAudio();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgStream.disableAudio();\n\t\t}\n\n\t\tisAudioDisabled = !isAudioDisabled;\n\n\t\tdisableAudioEle.innerHTML = isAudioDisabled ? 'enableAudio' : 'disableAudio';\n\t})\n}\n\n// \nlet publishScreenEle = document.getElementById('publishScreen');\nif (!!publishScreenEle)\n{\n\tpublishScreenEle.addEventListener('click', () => {\n\t\tpublishStream({\n\t\t\tuserid : userIdEle.value,\n\t\t\taudio  : false,\n\t\t\tvideo  : false,\n\t\t\tscreen : true,\n\t\t\tmediasource : false\n\t\t});\n\t})\t\n}\n\nlet unpublishScreenEle = document.getElementById('unpublishScreen');\nif (!!unpublishScreenEle)\n{\n\tunpublishScreenEle.addEventListener('click', () => {\n\t\tunpublishStream({\n\t\t\tvideo       : false,\n\t\t\tscreen      : true,\n\t\t\tmediasource : false\n\t\t});\n\t})\n}\n\n// \nlet publishMediaSourceEle = document.getElementById('publishMediaSource');\nif (!!publishMediaSourceEle)\n{\n\tpublishMediaSourceEle.addEventListener('click', () => {\n\t\tpublishStream({\n\t\t\tuserid : userIdEle.value,\n\t\t\taudio  : false,\n\t\t\tvideo  : false,\n\t\t\tscreen : false,\n\t\t\tmediasource : true\n\t\t});\n\t})\t\n}\n\nlet unpublishMediaSourceEle = document.getElementById('unpublishMediaSource');\nif (!!unpublishMediaSourceEle)\n{\n\tunpublishMediaSourceEle.addEventListener('click', () => {\n\t\tunpublishStream({\n\t\t\tvideo       : false,\n\t\t\tscreen      : false,\n\t\t\tmediasource : true\n\t\t});\n\t})\n}\n\nlet resolutionEle = document.getElementById('resolution');\nif (!!resolutionEle)\n{\n\tresolutionEle.addEventListener('change', () => {\n\t\tlet prof = resolutionEle.value;\n\t\n\t\tsetVideoProfile(prof);\n\t})\n}\n\nlet micVolumeSliderEle = document.getElementById('micVolumeSlider');\nif (!!micVolumeSliderEle)\n{\n\tmicVolumeSliderEle.addEventListener('change', () => {\n\t\tvar value = (micVolumeSliderEle.value) / 10;\n\t\tlet micVolumeSliderValueEle = document.getElementById('micVolumeSliderValue');\n\t\tif (!!micVolumeSliderValueEle)\n\t\t{\n\t\t\tmicVolumeSliderValueEle.innerHTML = (value);\n\t\t}\n\t\t\n\t\tif (!!gStream)\n\t\t{\n\t\t\tgStream.setInputVolume(+value);\n\t\t}\n\n\t\t// \n\t\tremote_stream.forEach((item) =>\n\t\t{\n\t\t\tif (!!item)\n\t\t\t{\n\t\t\t\t// \n\t\t\t\titem.setAudioVolume(+value);\n\t\t\t}\n\t\t});\n\t})\n}\n\nfunction getDevices()\n{\n\tlet message = '';\n\t\n    _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.listDevices((devices) => {\n\t\t// \n        devices.forEach((deviceInfo) => {\n            message = '<demo> getDevices - ' + deviceInfo.kind + ': ' + deviceInfo.label + ' id: ' + deviceInfo.deviceId + '\\n';\n\t\t\ttext_info.value = text_info.value + message;\n\t\t\tconsole.log(message);\n\n            let option = document.createElement('option');\n            option.value = deviceInfo.deviceId;\n\t\t\tif (deviceInfo.kind === 'audioinput')\n\t\t\t{\n\t\t\t\tif (!!audioInputSelect)\n\t\t\t\t{\n\t\t\t\t\toption.text = deviceInfo.label || `microphone ${audioInputSelect.length + 1}`;\n\t\t\t\t\taudioInputSelect.appendChild(option);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (deviceInfo.kind === 'audiooutput')\n\t\t\t{\n\t\t\t\tif (!!audioOutputSelect)\n\t\t\t\t{\n\t\t\t\t\toption.text = deviceInfo.label || `speaker ${audioOutputSelect.length + 1}`;\n\t\t\t\t\taudioOutputSelect.appendChild(option);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (deviceInfo.kind === 'videoinput')\n\t\t\t{\n\t\t\t\tif (!!videoSelect)\n\t\t\t\t{\n\t\t\t\t\toption.text = deviceInfo.label || `camera ${videoSelect.length + 1}`;\n\t\t\t\t\tvideoSelect.appendChild(option);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n                console.log('<demo> Some other kind of source/device: ', deviceInfo);\n            }\n\t\t});\n\t\t\n\t\tif (!!audioInputSelect)\n\t\t{\n\t\t\t// \n\t\t\tlet option = document.createElement('option');\n\t\t\toption.value = 'default';\n\t\t\toption.text = 'Default';\n\n\t\t\taudioInputSelect.appendChild(option);\n\t\t}\n\n\t\tif (!!audioOutputSelect)\n\t\t{\n\t\t\t// \n\t\t\tlet option = document.createElement('option');\n\t\t\toption.value = 'default';\n\t\t\toption.text = 'Default';\n\n\t\t\taudioOutputSelect.appendChild(option);\n\t\t}\n    }, (err) => {\n\t\tconst errMsg = err.name + err.message + '\\n';\n\t\ttext_info.value = text_info.value + errMsg;\n    });\n}\n\n// \nif (!!videoSelect)\n{\n\tvideoSelect.addEventListener('change', () => {\n\t\tlet index = videoSelect.selectedIndex;\n\t\n\t\tcameraDevId = videoSelect.options[index].value;\n\t\n\t\tconsole.log(`<demo> cameraDev change - cameraDevId: ${cameraDevId}`);\n\n\t\t// switch device for Stream\n\t\tif (!!gStream)\n\t\t{\n\t\t\tgStream.switchDevice('video', cameraDevId, () => {\n\t\t\t\tconsole.log(`<demo> switchDevice succ - deviceId: ${cameraDevId}`);\n\t\t\t}, (e) =>{\n\t\t\t\tconsole.log(`<demo> switchDevice fail - deviceId: ${cameraDevId} - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t})\n}\n\n// \nif (!!audioInputSelect)\n{\n\taudioInputSelect.addEventListener('change', () => {\n\t\tlet index = audioInputSelect.selectedIndex;\n\t\n\t\tmicDevId = audioInputSelect.options[index].value;\n\t\t\n\t\tconsole.log(`<demo> micDev change - micDevId: ${micDevId}`);\n\n\t\t// switch device for Stream\n\t\tif (!!gStream)\n\t\t{\n\t\t\tgStream.switchDevice('audio', micDevId, () => {\n\t\t\t\tconsole.log(`<demo> switchDevice succ - deviceId: ${micDevId}`);\n\t\t\t}, (e) =>{\n\t\t\t\tconsole.log(`<demo> switchDevice fail - deviceId: ${micDevId} - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t})\n}\n\n// \nif (!!audioOutputSelect)\n{\n\taudioOutputSelect.addEventListener('change', () => {\n\t\tlet index = audioOutputSelect.selectedIndex;\n\t\n\t\tspeakerDevId = audioOutputSelect.options[index].value;\n\n\t\t// \n\t\tremote_stream.forEach((item) =>\n\t\t{\n\t\t\tif (!!item)\n\t\t\t{\n\t\t\t\t// \n\t\t\t\titem.setAudioOutput(speakerDevId, (e) => {\n\t\t\t\t\ttext_info.value = text_info.value + `<demo> switch speaker - Stream.setAudioOutput succc - ${JSON.stringify(e)}` + '\\n';\n\t\t\t\t\tconsole.log('<demo> switch speaker - Stream.setAudioOutput succc. - ' + e);\t\n\t\t\t\t}, (e) => {\n\t\t\t\t\ttext_info.value = text_info.value + `<demo> switch speaker - Stream.setAudioOutput fail - ${JSON.stringify(e)}` + '\\n';\n\t\t\t\t\tconsole.log('<demo> switch speaker - Stream.setAudioOutput fail. - ' + e);\t\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconsole.log(`<demo> speakerDev change - speakerDevId: ${speakerDevId}`);\n\t})\n}\n\n// \nlet audioCodecEle = document.getElementById('audioCodec');\nif (!!audioCodecEle)\n{\n\taudioCodecEle.addEventListener('change', () => {\n\t\tlet index = audioCodecEle.selectedIndex;\n\n\t\taudioCodec = audioCodecEle.options[index].value;\n\n\t\tconsole.log(`<demo> audioCodec change - audioCodec: ${audioCodec}`);\n\t})\n}\n// \nlet audioProfileEle = document.getElementById('audioProfile');\nif (!!audioProfileEle)\n{\n\taudioProfileEle.addEventListener('change', () => {\n\t\tlet index = audioProfileEle.selectedIndex;\n\t\n\t\taudioProfile = audioProfileEle.options[index].value;\n\t\t\n\t\tconsole.log(`<demo> audioProfile change - audioProfile: ${audioProfile}`);\n\t})\n}\n\nlet userRoleEle = document.getElementById('userRole');\nif (!!userRoleEle)\n{\n\tuserRoleEle.addEventListener('change', () => {\n\t\tlet index = userRoleSelect.selectedIndex;\n\n\t\tuserRole = userRoleSelect.options[index].value;\n\t\t\n\t\tconsole.log(`<demo> userRole change - userRole: ${userRole}`);\n\n\t\t// \n\t\tif (!!client)\n\t\t{\n\t\t\tclient.setUserRole(userRole, () => {\n\t\t\t\tconsole.log(`<demo> setUserRole() succ. - role: ${userRole}`);\n\t\t\t}, (e) => {\n\t\t\t\tconsole.log(`<demo> setUserRole() fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t})\n}\n\n\n//# sourceURL=webpack:///./src/websdkdemo.js?");

/***/ })

/******/ });