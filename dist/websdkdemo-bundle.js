/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/dist";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/js/websdkdemo.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./lib/tttwebsdk.js":
/*!**************************!*\
  !*** ./lib/tttwebsdk.js ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("!function(e,t){ true?module.exports=t():undefined}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=119)}([function(e,t,r){\"use strict\";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}},function(e,t,r){\"use strict\";t.__esModule=!0;var n,i=r(139),a=(n=i)&&n.__esModule?n:{default:n};t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,a.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},function(e,t,r){e.exports={default:r(137),__esModule:!0}},function(e,t,r){\"use strict\";t.__esModule=!0;var n,i=r(26),a=(n=i)&&n.__esModule?n:{default:n};t.default=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!==(void 0===t?\"undefined\":(0,a.default)(t))&&\"function\"!=typeof t?e:t}},function(e,t,r){\"use strict\";t.__esModule=!0;var n=o(r(151)),i=o(r(155)),a=o(r(26));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+(void 0===t?\"undefined\":(0,a.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=o(r(0)),i=o(r(1)),a=o(r(109));function o(e){return e&&e.__esModule?e:{default:e}}var s=\"mediasoup-client\",c=function(){function e(t){(0,n.default)(this,e),t?(this._debug=(0,a.default)(s+\":\"+t),this._warn=(0,a.default)(s+\":WARN:\"+t),this._error=(0,a.default)(s+\":ERROR:\"+t)):(this._debug=(0,a.default)(s),this._warn=(0,a.default)(s+\":WARN\"),this._error=(0,a.default)(s+\":ERROR\")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return(0,i.default)(e,[{key:\"debug\",get:function(){return this._debug}},{key:\"warn\",get:function(){return this._warn}},{key:\"error\",get:function(){return this._error}}]),e}();t.default=c},function(e,t,r){e.exports={default:r(122),__esModule:!0}},function(e,t){var r=e.exports={version:\"2.6.11\"};\"number\"==typeof __e&&(__e=r)},function(e,t,r){e.exports={default:r(158),__esModule:!0}},function(e,t,r){e.exports={default:r(173),__esModule:!0}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=i(r(17));function i(e){return e&&e.__esModule?e:{default:e}}t.randomNumber=function(){return a()},t.clone=function(e){return JSON.parse((0,n.default)(e))};var a=i(r(115)).default.generator({min:1e7,max:99999999,integer:!0})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=l(r(6)),i=l(r(2)),a=l(r(0)),o=l(r(1)),s=l(r(3)),c=l(r(4)),d=r(30),u=l(r(5));function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){(0,a.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.setMaxListeners(1/0),r._logger=e||new u.default(\"EnhancedEventEmitter\"),r}return(0,c.default)(t,e),(0,o.default)(t,[{key:\"safeEmit\",value:function(e){try{for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error(\"safeEmit() | event listener threw an error [event:%s]:%o\",e,t)}}},{key:\"safeEmitAsPromise\",value:function(e){for(var t=this,r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return new n.default((function(r,n){t.safeEmit.apply(t,[e].concat(i,[function(e){r(e)},function(r){t._logger.error(\"safeEmitAsPromise() | errback called [event:%s]:%o\",e,r),n(r)}]))}))}}]),t}(d.EventEmitter);t.default=p},function(e,t,r){var n=r(14),i=r(7),a=r(27),o=r(29),s=r(34),c=function(e,t,r){var d,u,l,p=e&c.F,f=e&c.G,m=e&c.S,h=e&c.P,v=e&c.B,_=e&c.W,g=f?i:i[t]||(i[t]={}),y=g.prototype,b=f?n:m?n[t]:(n[t]||{}).prototype;for(d in f&&(r=t),r)(u=!p&&b&&void 0!==b[d])&&s(g,d)||(l=u?b[d]:r[d],g[d]=f&&\"function\"!=typeof b[d]?r[d]:v&&u?a(l,n):_&&b[d]==l?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):h&&\"function\"==typeof l?a(Function.call,l):l,h&&((g.virtual||(g.virtual={}))[d]=l,e&c.R&&y&&!y[d]&&o(y,d,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){\"use strict\";var n=r(193),i=r(194);t.write=i,t.parse=n.parse,t.parseFmtpConfig=n.parseFmtpConfig,t.parseParams=n.parseParams,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t){var r=e.exports=\"undefined\"!=typeof window&&window.Math==Math?window:\"undefined\"!=typeof self&&self.Math==Math?self:Function(\"return this\")();\"number\"==typeof __g&&(__g=r)},function(e,t,r){var n=r(73)(\"wks\"),i=r(59),a=r(14).Symbol,o=\"function\"==typeof a;(e.exports=function(e){return n[e]||(n[e]=o&&a[e]||(o?a:i)(\"Symbol.\"+e))}).store=n},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n,i=r(9),a=(n=i)&&n.__esModule?n:{default:n};function o(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,c=function(){var e=s.value,n=(t.rtcpFeedback||[]).find((function(t){return t.type===e.type&&t.parameter===e.parameter}));n&&r.push(n)},d=(0,a.default)(e.rtcpFeedback||[]);!(n=(s=d.next()).done);n=!0)c()}catch(e){i=!0,o=e}finally{try{!n&&d.return&&d.return()}finally{if(i)throw o}}return r}t.getExtendedRtpCapabilities=function(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=!0,i=!1,s=void 0;try{for(var c,d=function(){var t=c.value;if(\"rtx\"===t.name)return\"continue\";var n=(e.codecs||[]).find((function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if(\"video/h264\"===r){var i=(e.parameters||{})[\"packetization-mode\"]||0,a=(t.parameters||{})[\"packetization-mode\"]||0;if(i!==a)return!1}return!0}(e,t)}));if(n){var i={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:n.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:o(n,t),parameters:t.parameters};i.channels||delete i.channels,r.codecs.push(i)}},u=(0,a.default)(t.codecs||[]);!(n=(c=u.next()).done);n=!0)d()}catch(e){i=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw s}}var l=!0,p=!1,f=void 0;try{for(var m,h=function(){var r=m.value,n=(e.codecs||[]).find((function(e){return\"rtx\"===e.name&&e.parameters.apt===r.sendPayloadType})),i=(t.codecs||[]).find((function(e){return\"rtx\"===e.name&&e.parameters.apt===r.recvPayloadType}));n&&i&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=i.preferredPayloadType)},v=(0,a.default)(r.codecs||[]);!(l=(m=v.next()).done);l=!0)h()}catch(e){p=!0,f=e}finally{try{!l&&v.return&&v.return()}finally{if(p)throw f}}var _=!0,g=!1,y=void 0;try{for(var b,I=function(){var t=b.value,n=(e.headerExtensions||[]).find((function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n}));if(n){var i={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(i)}},k=(0,a.default)(t.headerExtensions||[]);!(_=(b=k.next()).done);_=!0)I()}catch(e){g=!0,y=e}finally{try{!_&&k.return&&k.return()}finally{if(g)throw y}}return r},t.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,i=void 0;try{for(var o,s=(0,a.default)(e.codecs);!(r=(o=s.next()).done);r=!0){var c=o.value,d={name:c.name,mimeType:c.mimeType,kind:c.kind,clockRate:c.clockRate,preferredPayloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(d.channels||delete d.channels,t.codecs.push(d),c.recvRtxPayloadType){var u={name:\"rtx\",mimeType:c.kind+\"/rtx\",kind:c.kind,clockRate:c.clockRate,preferredPayloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}var l=!0,p=!1,f=void 0;try{for(var m,h=(0,a.default)(e.headerExtensions);!(l=(m=h.next()).done);l=!0){var v=m.value,_={kind:v.kind,uri:v.uri,preferredId:v.recvId};t.headerExtensions.push(_)}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return t.fecMechanisms=e.fecMechanisms,t},t.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],i=e.codecs,o=r.codecs,s=!0,c=!1,d=void 0;try{for(var u,l=function(){var e=u.value;if(!o.some((function(t){return t.recvPayloadType===e}))){var t=i.find((function(t){return t.preferredPayloadType===e}));if(!t)throw new Error(\"mandatory codec PT \"+e+\" not found in remote codecs\");n.push(t)}},p=(0,a.default)(t);!(s=(u=p.next()).done);s=!0)l()}catch(e){c=!0,d=e}finally{try{!s&&p.return&&p.return()}finally{if(c)throw d}}return n},t.canSend=function(e,t){return t.codecs.some((function(t){return t.kind===e}))},t.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some((function(e){return e.recvPayloadType===r.payloadType}))},t.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,i=!1,o=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(n=(s=c.next()).done);n=!0){var d=s.value;if(d.kind===e){var u={name:d.name,mimeType:d.mimeType,clockRate:d.clockRate,payloadType:d.sendPayloadType,channels:d.channels,rtcpFeedback:d.rtcpFeedback,parameters:d.parameters};if(u.channels||delete u.channels,r.codecs.push(u),d.sendRtxPayloadType){var l={name:\"rtx\",mimeType:d.kind+\"/rtx\",clockRate:d.clockRate,payloadType:d.sendRtxPayloadType,parameters:{apt:d.sendPayloadType}};r.codecs.push(l)}}}}catch(e){i=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,a.default)(t.headerExtensions);!(p=(h=v.next()).done);p=!0){var _=h.value;if(!_.kind||_.kind===e){var g={uri:_.uri,id:_.sendId};r.headerExtensions.push(g)}}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}return r},t.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,i=!1,o=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(n=(s=c.next()).done);n=!0){var d=s.value;if(d.kind===e){var u={name:d.name,mimeType:d.mimeType,clockRate:d.clockRate,payloadType:d.recvPayloadType,channels:d.channels,rtcpFeedback:d.rtcpFeedback,parameters:d.parameters};if(u.channels||delete u.channels,r.codecs.push(u),d.recvRtxPayloadType){var l={name:\"rtx\",mimeType:d.kind+\"/rtx\",clockRate:d.clockRate,payloadType:d.recvRtxPayloadType,parameters:{apt:d.recvPayloadType}};r.codecs.push(l)}}}}catch(e){i=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,a.default)(t.headerExtensions);!(p=(h=v.next()).done);p=!0){var _=h.value;if(!_.kind||_.kind===e){var g={uri:_.uri,id:_.recvId};r.headerExtensions.push(g)}}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}return r}},function(e,t,r){e.exports={default:r(136),__esModule:!0}},function(e,t,r){e.exports={default:r(185),__esModule:!0}},function(e,t){e.exports=function(e){return\"object\"==typeof e?null!==e:\"function\"==typeof e}},function(e,t,r){e.exports={default:r(188),__esModule:!0}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(r(9)),i=s(r(18)),a=s(r(8));t.extractRtpCapabilities=function(e){var t=new a.default,r=[],s=!1,c=!1,d=!0,u=!1,l=void 0;try{for(var p,f=(0,n.default)(e.media);!(d=(p=f.next()).done);d=!0){var m=p.value,h=m.type;switch(h){case\"audio\":if(s)continue;s=!0;break;case\"video\":if(c)continue;c=!0;break;default:continue}var v=!0,_=!1,g=void 0;try{for(var y,b=(0,n.default)(m.rtp);!(v=(y=b.next()).done);v=!0){var I=y.value,k={name:I.codec,mimeType:h+\"/\"+I.codec,kind:h,clockRate:I.rate,preferredPayloadType:I.payload,channels:I.encoding,rtcpFeedback:[],parameters:{}};\"audio\"!==k.kind?delete k.channels:k.channels||(k.channels=1),t.set(k.preferredPayloadType,k)}}catch(e){_=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(_)throw g}}var P=!0,S=!1,w=void 0;try{for(var T,A=(0,n.default)(m.fmtp||[]);!(P=(T=A.next()).done);P=!0){var E=T.value,R=o.default.parseFmtpConfig(E.config),C=t.get(E.payload);C&&(C.parameters=R)}}catch(e){S=!0,w=e}finally{try{!P&&A.return&&A.return()}finally{if(S)throw w}}var O=!0,N=!1,x=void 0;try{for(var L,D=(0,n.default)(m.rtcpFb||[]);!(O=(L=D.next()).done);O=!0){var M=L.value,B=t.get(M.payload);if(B){var V={type:M.type,parameter:M.subtype};V.parameter||delete V.parameter,B.rtcpFeedback.push(V)}}}catch(e){N=!0,x=e}finally{try{!O&&D.return&&D.return()}finally{if(N)throw x}}var j=!0,F=!1,U=void 0;try{for(var G,H=(0,n.default)(m.ext||[]);!(j=(G=H.next()).done);j=!0){var K=G.value,W={kind:h,uri:K.uri,preferredId:K.value};r.push(W)}}catch(e){F=!0,U=e}finally{try{!j&&H.return&&H.return()}finally{if(F)throw U}}}}catch(e){u=!0,l=e}finally{try{!d&&f.return&&f.return()}finally{if(u)throw l}}return{codecs:(0,i.default)(t.values()),headerExtensions:r,fecMechanisms:[]}},t.extractDtlsParameters=function(e){var t=function(e){return(e.media||[]).find((function(e){return e.iceUfrag&&0!==e.port}))}(e),r=t.fingerprint||e.fingerprint,n=void 0;switch(t.setup){case\"active\":n=\"client\";break;case\"passive\":n=\"server\";break;case\"actpass\":n=\"auto\"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}};var o=s(r(13));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){var n=r(25),i=r(87),a=r(70),o=Object.defineProperty;t.f=r(23)?Object.defineProperty:function(e,t,r){if(n(e),t=a(t,!0),n(r),i)try{return o(e,t,r)}catch(e){}if(\"get\"in r||\"set\"in r)throw TypeError(\"Accessors not supported!\");return\"value\"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!r(33)((function(){return 7!=Object.defineProperty({},\"a\",{get:function(){return 7}}).a}))},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=a(r(5)),i=a(r(13));function a(e){return e&&e.__esModule?e:{default:e}}new n.default(\"BandwidthHandler\");function o(e,t,r){return s(e,0,-1,t,r)}function s(e,t,r,n,i){for(var a=-1!==r?r:e.length,o=t;o<a;++o)if(0===e[o].indexOf(n)&&(!i||-1!==e[o].toLowerCase().indexOf(i.toLowerCase())))return o;return null}function c(e){var t=new RegExp(\"a=rtpmap:(\\\\d+) \\\\w+\\\\/\\\\d+\"),r=e.match(t);return r&&2===r.length?r[1]:null}t.default={setBAS:function(e,t,r){return navigator.mozGetUserMedia||!t||(r&&(t.screen?t.screen<300&&console.warn(\"It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail.\"):console.warn(\"It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.\")),t.screen&&r&&(e=(e=e.replace(/b=AS([^\\r\\n]+\\r\\n)/g,\"\")).replace(/a=mid:video\\r\\n/g,\"a=mid:video\\r\\nb=AS:\"+t.screen+\"\\r\\n\")),(t.audio||t.video||t.data)&&(e=e.replace(/b=AS([^\\r\\n]+\\r\\n)/g,\"\")),t.audio&&(e=e.replace(/a=mid:audio\\r\\n/g,\"a=mid:audio\\r\\nb=AS:\"+t.audio+\"\\r\\n\")),t.video&&(e=e.replace(/a=mid:video\\r\\n/g,\"a=mid:video\\r\\nb=AS:\"+(r?t.screen:t.video)+\"\\r\\n\"))),e},setVideoBitrates:function(e,t){if(null==t)return e;if(void 0===t.videoGoogleMinBitrate||void 0===t.videoGoogleMaxBitrate)return e;var r,n=(t=t||{}).videoGoogleMinBitrate,i=t.videoGoogleMaxBitrate,a=t.videoGoogleStartBitrate,d=e.split(\"\\r\\n\"),u=o(d,\"a=rtpmap\",\"H264/90000\");if(u&&(r=c(d[u])),!r)return e;for(var l=\"\",p=void 0,f=0;null!==f&&(null!==(f=s(d,f,-1,\"a=fmtp\",\"profile-level-id=42001f\"))&&(l=\"\",-1===d[f].indexOf(\"x-google-min-bitrate=\")?l+=\";x-google-min-bitrate=\"+(n||\"228\"):(p=new RegExp(\"x-google-min-bitrate=(\\\\d+)\"),d[f]=d[f].replace(p,\"x-google-min-bitrate=\"+(n||\"228\"))),-1===d[f].indexOf(\"x-google-max-bitrate=\")?l+=\";x-google-max-bitrate=\"+(i||\"228\"):(p=new RegExp(\"x-google-max-bitrate=(\\\\d+)\"),d[f]=d[f].replace(p,\"x-google-max-bitrate=\"+(i||\"228\"))),-1===d[f].indexOf(\"x-google-start-bitrate=\")?l+=\";x-google-start-bitrate=\"+(a||\"228\"):(p=new RegExp(\"x-google-start-bitrate=(\\\\d+)\"),d[f]=d[f].replace(p,\"x-google-start-bitrate=\"+(a||\"228\"))),d[f]=d[f].concat(l),e=d.join(\"\\r\\n\")),null!==f);)f+=1;for(f=0;null!==f&&(null!==(f=s(d,f,-1,\"a=fmtp\",\"profile-level-id=42e01f\"))&&(l=\"\",-1===d[f].indexOf(\"x-google-min-bitrate=\")?l+=\";x-google-min-bitrate=\"+(n||\"228\"):(p=new RegExp(\"x-google-min-bitrate=(\\\\d+)\"),d[f]=d[f].replace(p,\"x-google-min-bitrate=\"+(n||\"228\"))),-1===d[f].indexOf(\"x-google-max-bitrate=\")?l+=\";x-google-max-bitrate=\"+(i||\"228\"):(p=new RegExp(\"x-google-max-bitrate=(\\\\d+)\"),d[f]=d[f].replace(p,\"x-google-max-bitrate=\"+(i||\"228\"))),-1===d[f].indexOf(\"x-google-start-bitrate=\")?l+=\";x-google-start-bitrate=\"+(a||\"228\"):(p=new RegExp(\"x-google-start-bitrate=(\\\\d+)\"),d[f]=d[f].replace(p,\"x-google-start-bitrate=\"+(a||\"228\"))),d[f]=d[f].concat(l),e=d.join(\"\\r\\n\")),null!==f);)f+=1;return e},setOpusAttributes:function(e,t){t=t||{};var r,n=e.split(\"\\r\\n\"),i=o(n,\"a=rtpmap\",\"opus/48000\");if(i&&(r=c(n[i])),!r)return e;var a=o(n,\"a=fmtp:\"+r.toString());if(null===a)return e;var s=\"\",d=void 0;return void 0!==t.stereo&&(-1===n[a].indexOf(\"stereo=\")?s+=\";stereo=\"+t.stereo:(d=new RegExp(\"stereo=(\\\\d)\"),n[a]=n[a].replace(d,\"stereo=\"+t.stereo))),void 0!==t[\"sprop-stereo\"]&&(-1===n[a].indexOf(\"sprop-stereo=\")?s+=\";sprop-stereo=\"+t[\"sprop-stereo\"]:(d=new RegExp(\"sprop-stereo=(\\\\d)\"),n[a]=n[a].replace(d,\"sprop-stereo=\"+t[\"sprop-stereo\"]))),void 0!==t.maxaveragebitrate&&(-1==n[a].indexOf(\"maxaveragebitrate=\")?s+=\";maxaveragebitrate=\"+(t.maxaveragebitrate||1048576):(d=new RegExp(\"maxaveragebitrate=(\\\\d+)\"),n[a]=n[a].replace(d,\"maxaveragebitrate=\"+(t.maxaveragebitrate||1048576)))),void 0!==t.maxplaybackrate&&(-1===n[a].indexOf(\"maxplaybackrate=\")?s+=\";maxplaybackrate=\"+(t.maxplaybackrate||48e3):(d=new RegExp(\"maxplaybackrate=(\\\\d+)\"),n[a]=n[a].replace(d,\"maxplaybackrate=\"+(t.maxplaybackrate||48e3)))),void 0!==t.cbr&&(-1===n[a].indexOf(\"cbr=\")?s+=\";cbr=\"+t.cbr:(d=new RegExp(\"cbr=(\\\\d+)\"),n[a]=n[a].replace(d,\"cbr=\"+t.cbr))),void 0!==t.useinbandfec&&(-1===n[a].indexOf(\"useinbandfec=\")?s+=\";useinbandfec=\"+t.useinbandfec:(d=new RegExp(\"useinbandfec=(\\\\d)\"),n[a]=n[a].replace(d,\"useinbandfec=\"+t.useinbandfec))),void 0!==t.usedtx&&(-1===n[a].indexOf(\"usedtx=\")?s+=\";usedtx=\"+t.usedtx:(d=new RegExp(\"usedtx=(\\\\d)\"),n[a]=n[a].replace(d,\"usedtx=\"+t.usedtx))),void 0!==t.maxptime&&(s+=\"\\r\\na=maxptime:\"+t.maxptime),n[a]=n[a].concat(s),e=n.join(\"\\r\\n\")},setSpecialAudioCodec:function(e,t){var r=i.default.parse(e);return r?(r.media.forEach((function(e,n){if(\"audio\"===e.type&&e.rtp){r.media[n].rtp=e.rtp.filter((function(e){return e.codec.toLowerCase()==t||\"CN\"==e.codec||\"telephone-event\"==e.codec}));var i=-1;e.rtp.forEach((function(e,r){e.codec==t&&(i=e.payload)})),r.media[n].payloads=e.rtp.map((function(e){return e.payload})).join(\" \"),e.fmtp&&(r.media[n].fmtp=e.fmtp.filter((function(e){return e.payload==i}))),e.rtcpFb&&(r.media[n].rtcpFb=e.rtcpFb.filter((function(e){return e.payload==i})))}})),e=i.default.write(r)):e}}},function(e,t,r){var n=r(19);e.exports=function(e){if(!n(e))throw TypeError(e+\" is not an object!\");return e}},function(e,t,r){\"use strict\";t.__esModule=!0;var n=o(r(142)),i=o(r(144)),a=\"function\"==typeof i.default&&\"symbol\"==typeof n.default?function(e){return typeof e}:function(e){return e&&\"function\"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?\"symbol\":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default=\"function\"==typeof i.default&&\"symbol\"===a(n.default)?function(e){return void 0===e?\"undefined\":a(e)}:function(e){return e&&\"function\"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?\"symbol\":void 0===e?\"undefined\":a(e)}},function(e,t,r){var n=r(47);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n;n=function(){var e=!0;function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||\"\"}function n(e){var r=t.match(e);return r&&r.length>1&&r[2]||\"\"}var i,o=r(/(ipod|iphone|ipad)/i).toLowerCase(),s=!/like android/i.test(t)&&/android/i.test(t),c=/nexus\\s*[0-6]\\s*/i.test(t),d=!c&&/nexus\\s*[0-9]+/i.test(t),u=/CrOS/.test(t),l=/silk/i.test(t),p=/sailfish/i.test(t),f=/tizen/i.test(t),m=/(web|hpw)(o|0)s/i.test(t),h=/windows phone/i.test(t),v=(/SamsungBrowser/i.test(t),!h&&/windows/i.test(t)),_=!o&&!l&&/macintosh/i.test(t),g=!s&&!p&&!f&&!m&&/linux/i.test(t),y=n(/edg([ea]|ios)\\/(\\d+(\\.\\d+)?)/i),b=r(/version\\/(\\d+(\\.\\d+)?)/i),I=/tablet/i.test(t)&&!/tablet pc/i.test(t),k=!I&&/[^-]mobi/i.test(t),P=/xbox/i.test(t);/opera/i.test(t)?i={name:\"Opera\",opera:e,version:b||r(/(?:opera|opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/opr\\/|opios/i.test(t)?i={name:\"Opera\",opera:e,version:r(/(?:opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i)||b}:/SamsungBrowser/i.test(t)?i={name:\"Samsung Internet for Android\",samsungBrowser:e,version:b||r(/(?:SamsungBrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/Whale/i.test(t)?i={name:\"NAVER Whale browser\",whale:e,version:r(/(?:whale)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/MZBrowser/i.test(t)?i={name:\"MZ Browser\",mzbrowser:e,version:r(/(?:MZBrowser)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/coast/i.test(t)?i={name:\"Opera Coast\",coast:e,version:b||r(/(?:coast)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/focus/i.test(t)?i={name:\"Focus\",focus:e,version:r(/(?:focus)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/yabrowser/i.test(t)?i={name:\"Yandex Browser\",yandexbrowser:e,version:b||r(/(?:yabrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/ucbrowser/i.test(t)?i={name:\"UC Browser\",ucbrowser:e,version:r(/(?:ucbrowser)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/mxios/i.test(t)?i={name:\"Maxthon\",maxthon:e,version:r(/(?:mxios)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/epiphany/i.test(t)?i={name:\"Epiphany\",epiphany:e,version:r(/(?:epiphany)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/puffin/i.test(t)?i={name:\"Puffin\",puffin:e,version:r(/(?:puffin)[\\s\\/](\\d+(?:\\.\\d+)?)/i)}:/sleipnir/i.test(t)?i={name:\"Sleipnir\",sleipnir:e,version:r(/(?:sleipnir)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/k-meleon/i.test(t)?i={name:\"K-Meleon\",kMeleon:e,version:r(/(?:k-meleon)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:h?(i={name:\"Windows Phone\",osname:\"Windows Phone\",windowsphone:e},y?(i.msedge=e,i.version=y):(i.msie=e,i.version=r(/iemobile\\/(\\d+(\\.\\d+)?)/i))):/msie|trident/i.test(t)?i={name:\"Internet Explorer\",msie:e,version:r(/(?:msie |rv:)(\\d+(\\.\\d+)?)/i)}:u?i={name:\"Chrome\",osname:\"Chrome OS\",chromeos:e,chromeBook:e,chrome:e,version:r(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?i={name:\"Microsoft Edge\",msedge:e,version:y}:/vivaldi/i.test(t)?i={name:\"Vivaldi\",vivaldi:e,version:r(/vivaldi\\/(\\d+(\\.\\d+)?)/i)||b}:p?i={name:\"Sailfish\",osname:\"Sailfish OS\",sailfish:e,version:r(/sailfish\\s?browser\\/(\\d+(\\.\\d+)?)/i)}:/seamonkey\\//i.test(t)?i={name:\"SeaMonkey\",seamonkey:e,version:r(/seamonkey\\/(\\d+(\\.\\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(i={name:\"Firefox\",firefox:e,version:r(/(?:firefox|iceweasel|fxios)[ \\/](\\d+(\\.\\d+)?)/i)},/\\((mobile|tablet);[^\\)]*rv:[\\d\\.]+\\)/i.test(t)&&(i.firefoxos=e,i.osname=\"Firefox OS\")):l?i={name:\"Amazon Silk\",silk:e,version:r(/silk\\/(\\d+(\\.\\d+)?)/i)}:/phantom/i.test(t)?i={name:\"PhantomJS\",phantom:e,version:r(/phantomjs\\/(\\d+(\\.\\d+)?)/i)}:/slimerjs/i.test(t)?i={name:\"SlimerJS\",slimer:e,version:r(/slimerjs\\/(\\d+(\\.\\d+)?)/i)}:/blackberry|\\bbb\\d+/i.test(t)||/rim\\stablet/i.test(t)?i={name:\"BlackBerry\",osname:\"BlackBerry OS\",blackberry:e,version:b||r(/blackberry[\\d]+\\/(\\d+(\\.\\d+)?)/i)}:m?(i={name:\"WebOS\",osname:\"WebOS\",webos:e,version:b||r(/w(?:eb)?osbrowser\\/(\\d+(\\.\\d+)?)/i)},/touchpad\\//i.test(t)&&(i.touchpad=e)):/bada/i.test(t)?i={name:\"Bada\",osname:\"Bada\",bada:e,version:r(/dolfin\\/(\\d+(\\.\\d+)?)/i)}:f?i={name:\"Tizen\",osname:\"Tizen\",tizen:e,version:r(/(?:tizen\\s?)?browser\\/(\\d+(\\.\\d+)?)/i)||b}:/qupzilla/i.test(t)?i={name:\"QupZilla\",qupzilla:e,version:r(/(?:qupzilla)[\\s\\/](\\d+(?:\\.\\d+)+)/i)||b}:/chromium/i.test(t)?i={name:\"Chromium\",chromium:e,version:r(/(?:chromium)[\\s\\/](\\d+(?:\\.\\d+)?)/i)||b}:/chrome|crios|crmo/i.test(t)?i={name:\"Chrome\",chrome:e,version:r(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)}:s?i={name:\"Android\",version:b}:/safari|applewebkit/i.test(t)?(i={name:\"Safari\",safari:e},b&&(i.version=b)):o?(i={name:\"iphone\"==o?\"iPhone\":\"ipad\"==o?\"iPad\":\"iPod\"},b&&(i.version=b)):i=/googlebot/i.test(t)?{name:\"Googlebot\",googlebot:e,version:r(/googlebot\\/(\\d+(\\.\\d+))/i)||b}:{name:r(/^(.*)\\/(.*) /),version:n(/^(.*)\\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\\/537\\.36/i.test(t)?(i.name=i.name||\"Blink\",i.blink=e):(i.name=i.name||\"Webkit\",i.webkit=e),!i.version&&b&&(i.version=b)):!i.opera&&/gecko\\//i.test(t)&&(i.name=i.name||\"Gecko\",i.gecko=e,i.version=i.version||r(/gecko\\/(\\d+(\\.\\d+)?)/i)),i.windowsphone||!s&&!i.silk?!i.windowsphone&&o?(i[o]=e,i.ios=e,i.osname=\"iOS\"):_?(i.mac=e,i.osname=\"macOS\"):P?(i.xbox=e,i.osname=\"Xbox\"):v?(i.windows=e,i.osname=\"Windows\"):g&&(i.linux=e,i.osname=\"Linux\"):(i.android=e,i.osname=\"Android\");var S=\"\";i.windows?S=function(e){switch(e){case\"NT\":return\"NT\";case\"XP\":return\"XP\";case\"NT 5.0\":return\"2000\";case\"NT 5.1\":return\"XP\";case\"NT 5.2\":return\"2003\";case\"NT 6.0\":return\"Vista\";case\"NT 6.1\":return\"7\";case\"NT 6.2\":return\"8\";case\"NT 6.3\":return\"8.1\";case\"NT 10.0\":return\"10\";default:return}}(r(/Windows ((NT|XP)( \\d\\d?.\\d)?)/i)):i.windowsphone?S=r(/windows phone (?:os)?\\s?(\\d+(\\.\\d+)*)/i):i.mac?S=(S=r(/Mac OS X (\\d+([_\\.\\s]\\d+)*)/i)).replace(/[_\\s]/g,\".\"):o?S=(S=r(/os (\\d+([_\\s]\\d+)*) like mac os x/i)).replace(/[_\\s]/g,\".\"):s?S=r(/android[ \\/-](\\d+(\\.\\d+)*)/i):i.webos?S=r(/(?:web|hpw)os\\/(\\d+(\\.\\d+)*)/i):i.blackberry?S=r(/rim\\stablet\\sos\\s(\\d+(\\.\\d+)*)/i):i.bada?S=r(/bada\\/(\\d+(\\.\\d+)*)/i):i.tizen&&(S=r(/tizen[\\/\\s](\\d+(\\.\\d+)*)/i)),S&&(i.osversion=S);var w=!i.windows&&S.split(\".\")[0];return I||d||\"ipad\"==o||s&&(3==w||w>=4&&!k)||i.silk?i.tablet=e:(k||\"iphone\"==o||\"ipod\"==o||s||c||i.blackberry||i.webos||i.bada)&&(i.mobile=e),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.vivaldi&&i.version>=1||i.chrome&&i.version>=20||i.samsungBrowser&&i.version>=4||i.whale&&1===a([i.version,\"1.0\"])||i.mzbrowser&&1===a([i.version,\"6.0\"])||i.focus&&1===a([i.version,\"1.0\"])||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(\".\")[0]>=6||i.blackberry&&i.version>=10.1||i.chromium&&i.version>=20?i.a=e:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(\".\")[0]<6||i.chromium&&i.version<20?i.c=e:i.x=e,i}var r=t(\"undefined\"!=typeof navigator&&navigator.userAgent||\"\");function n(e){return e.split(\".\").length}function i(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function a(e){for(var t=Math.max(n(e[0]),n(e[1])),r=i(e,(function(e){var r=t-n(e);return i((e+=new Array(r+1).join(\".0\")).split(\".\"),(function(e){return new Array(20-e.length).join(\"0\")+e})).reverse()}));--t>=0;){if(r[0][t]>r[1][t])return 1;if(r[0][t]!==r[1][t])return-1;if(0===t)return 0}}function o(e,n,i){var o=r;\"string\"==typeof n&&(i=n,n=void 0),void 0===n&&(n=!1),i&&(o=t(i));var s=\"\"+o.version;for(var c in e)if(e.hasOwnProperty(c)&&o[c]){if(\"string\"!=typeof e[c])throw new Error(\"Browser version in the minVersion map should be a string: \"+c+\": \"+String(e));return a([s,e[c]])<0}return n}return r.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if(\"string\"==typeof n&&n in r)return!0}return!1},r.isUnsupportedBrowser=o,r.compareVersions=a,r.check=function(e,t,r){return!o(e,t,r)},r._detect=t,r.detect=t,r},e.exports?e.exports=n():r(181)(\"bowser\",n)},function(e,t,r){var n=r(22),i=r(48);e.exports=r(23)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){\"use strict\";var n,i=\"object\"==typeof Reflect?Reflect:null,a=i&&\"function\"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&\"function\"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function d(e){if(\"function\"!=typeof e)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var i,a,o,s;if(d(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit(\"newListener\",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if(\"function\"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error(\"Possible EventEmitter memory leak detected. \"+o.length+\" \"+String(t)+\" listeners added. Use emitter.setMaxListeners() to increase limit\");c.name=\"MaxListenersExceededWarning\",c.emitter=e,c.type=t,c.count=o.length,s=c,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=p.bind(n);return i.listener=r,n.wrapFn=i,i}function m(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:\"function\"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):v(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if(\"function\"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,\"defaultMaxListeners\",{enumerable:!0,get:function(){return c},set:function(e){if(\"number\"!=typeof e||e<0||o(e))throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received '+e+\".\");c=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if(\"number\"!=typeof e||e<0||o(e))throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received '+e+\".\");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=\"error\"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error(\"Unhandled error.\"+(o?\" (\"+o.message+\")\":\"\"));throw s.context=o,s}var c=i[e];if(void 0===c)return!1;if(\"function\"==typeof c)a(c,this,t);else{var d=c.length,u=v(c,d);for(r=0;r<d;++r)a(u[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return d(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,a,o;if(d(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit(\"removeListener\",e,r.listener||t));else if(\"function\"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit(\"removeListener\",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)\"removeListener\"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners(\"removeListener\"),this._events=Object.create(null),this._eventsCount=0,this}if(\"function\"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return m(this,e,!0)},s.prototype.rawListeners=function(e){return m(this,e,!1)},s.listenerCount=function(e,t){return\"function\"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=d(r(17)),i=d(r(26)),a=d(r(0)),o=d(r(1)),s=d(r(109)),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(42));function d(e){return e&&e.__esModule?e:{default:e}}var u=r(84),l=c.logLevel,p=\"WEB-STAT\",f=\"tttwebsdk\",m=l.LOG_TRACE,h=!0,v=!1,_=function(){function t(e){(0,a.default)(this,t),this._userAgent=navigator.userAgent,this._isMobile=/mobile/i.test(this._userAgent),this._evename=\"FUNCLOGS\",e?(this._prefix=\"\"+e,this._debug=(0,s.default)(f+\":\"+e),this._warn=(0,s.default)(f+\":WARN:\"+e),this._error=(0,s.default)(f+\":ERROR:\"+e)):(this._prefix=\"\",this._debug=(0,s.default)(f),this._warn=(0,s.default)(f+\":WARN\"),this._error=(0,s.default)(f+\":ERROR\")),this._funLog=this._fun_Log.bind(this),this._clbLog=this._clb_Log.bind(this),this._stat=this._log_stat.bind(this),this._debug=this._log_debug.bind(this),this._warn=this._log_warn.bind(this),this._error=this._log_error.bind(this)}return(0,o.default)(t,[{key:\"setLoggerLevel\",value:function(e){t.logLevel=e}},{key:\"_log_stat\",value:function(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.logLevel<=l.LOG_INFO){var o=\"[\"+this._prefix+\"]\";[].slice.apply(r).forEach((function(e){\"object\"===(void 0===e?\"undefined\":(0,i.default)(e))?o+=\" \"+(0,n.default)(e):o+=\" \"+e})),console.log(o)}this._log.apply(this,[p].concat(r))}},{key:\"_log_debug\",value:function(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.logLevel<=l.LOG_INFO){var o=\"[\"+this._prefix+\"]\";[].slice.apply(r).forEach((function(e){\"object\"===(void 0===e?\"undefined\":(0,i.default)(e))?o+=\" \"+(0,n.default)(e):o+=\" \"+e})),console.log(o)}this._log.apply(this,[f].concat(r))}},{key:\"_log_error\",value:function(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.logLevel<=l.LOG_ERROR){var o=\"[\"+this._prefix+\"]\";[].slice.apply(r).forEach((function(e){\"object\"===(void 0===e?\"undefined\":(0,i.default)(e))?o+=\" \"+(0,n.default)(e):o+=\" \"+e})),console.error(o)}this._log.apply(this,[f].concat(r))}},{key:\"_log_warn\",value:function(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.logLevel<=l.LOG_WARN){var o=\"[\"+this._prefix+\"]\";[].slice.apply(r).forEach((function(e){\"object\"===(void 0===e?\"undefined\":(0,i.default)(e))?o+=\" \"+(0,n.default)(e):o+=\" \"+e})),console.warn(o)}this._log.apply(this,[f].concat(r))}},{key:\"_fun_Log\",value:function(){this._evename=\"FUNCLOGS\",this._logger.apply(this,arguments)}},{key:\"_clb_Log\",value:function(){this._evename=\"CALLBACKLOGS\",this._logger.apply(this,arguments)}},{key:\"_log\",value:function(r){if(t.logSubmit){for(var a=this._isMobile?\"web_mobile\":\"web\",o=\"module:\"+this._prefix+\", appid:\"+e.g_appid+\", roomid:\"+e.g_roomid+\", userid:\"+e.g_userid+\", role:\"+e.g_role+\", cid:\"+e.g_connectId+\", sid:\"+e.g_sessionId+\", uuid:\"+e.g_clientUuid+\", server:\"+e.g_server+\", myip:\"+e.g_myPublicIP+\", dev:\"+a+\"-\"+u.version+\"_\"+u.buildDate+\", time:\"+new Date,s=arguments.length,d=Array(s>1?s-1:0),l=1;l<s;l++)d[l-1]=arguments[l];[].slice.apply(d).forEach((function(e){\"object\"===(void 0===e?\"undefined\":(0,i.default)(e))?o+=\" \"+(0,n.default)(e):o+=\" \"+e})),fetch(c.logserver_url,{method:\"POST\",mode:\"no-cors\",cache:\"no-cache\",headers:{\"Content-Type\":\"text/plain; charset=utf-8\"},redirect:\"follow\",referrer:\"no-referrer\",body:\"event=\"+r+\" \"+o+\" * ua:\"+this._userAgent}).catch((function(e){return console.warn(\"Error:\",e)})).then((function(e){return(0,n.default)(e)}))}}},{key:\"_logger\",value:function(){for(var r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];if(t.logSubmit){var o=function(){var e=new Date;return e.getFullYear()+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate()+\" \"+(e.getHours()<10?\"0\"+e.getHours():e.getHours())+\":\"+(e.getMinutes()<10?\"0\"+e.getMinutes():e.getMinutes())+\":\"+(e.getSeconds()<10?\"0\"+e.getSeconds():e.getSeconds())+\".\"+e.getMilliseconds()},s=this._isMobile?\"web_mobile\":\"web\",d={aid:e.g_appid,uid:e.g_userid,rid:e.g_roomid,sid:e.g_sessionId,cid:e.g_connectId,os:s,t:o(),r:+e.g_role,fcs:i};d=(0,n.default)(d).replace(/\\\\*/g,\"\"),fetch(c.logserver_url,{method:\"POST\",mode:\"no-cors\",cache:\"no-cache\",headers:{\"Content-Type\":\"text/plain; charset=utf-8\"},redirect:\"follow\",referrer:\"no-referrer\",body:\"event=\"+this._evename+\" \"+d}).catch((function(e){return console.warn(\"Error:\",e)})).then((function(e){return(0,n.default)(e)}))}}},{key:\"funLog\",get:function(){return this._funLog}},{key:\"clbLog\",get:function(){return this._clbLog}},{key:\"stat\",get:function(){return this._stat}},{key:\"debug\",get:function(){return this._debug}},{key:\"warn\",get:function(){return this._warn}},{key:\"error\",get:function(){return this._error}}],[{key:\"privateCloud\",get:function(){return v},set:function(e){v=Boolean(e)}},{key:\"logSubmit\",get:function(){return h},set:function(e){h=Boolean(e)}},{key:\"logLevel\",get:function(){return m},set:function(e){switch(e){case\"LOG_NONE\":m=l.LOG_NONE;break;case\"LOG_ERROR\":m=l.LOG_ERROR;break;case\"LOG_WARN\":m=l.LOG_WARN;break;case\"LOG_INFO\":m=l.LOG_INFO;break;case\"LOG_DEBUG\":m=l.LOG_DEBUG;break;case\"LOG_TRACE\":m=l.LOG_TRACE;break;default:throw TypeError(\"parameter error. must be: LOG_NONE, LOG_ERROR, LOG_WARN, LOG_INFO, LOG_DEBUG, LOG_TRACE\")}}}]),t}();t.default=_}).call(this,r(38))},function(e,t,r){\"use strict\";var n=r(123)(!0);r(68)(String,\"String\",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})}))},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(67);e.exports=function(e){return Object(n(e))}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(r(54)),i=s(r(8)),a=s(r(20)),o=s(r(9));function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t,r){var n=void 0;if(null!=r){if(r=String(r),!(n=(e.media||[]).find((function(e){return String(e.mid)===r}))))throw new Error(\"SDP section with mid=\"+r+\" not found\")}else if(!(n=(e.media||[]).find((function(e){return e.type===t.kind&&e.msid&&e.msid.split(\" \")[1]===t.id}))))throw new Error(\"SDP section with a=msid containing track.id=\"+t.id+\" not found\");return n}t.fillRtpParametersForTrack=function(e,t,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},d=s.mid,u=void 0===d?null:d,l=s.planBSimulcast,p=void 0!==l&&l,f=c(t,r,u);null!=u&&(e.muxId=String(u));e.rtcp={cname:null,reducedSize:!0,mux:!0};var m=(f.ssrcs||[]).find((function(e){return\"cname\"===e.attribute}));if(!m)throw new Error(\"CNAME value not found\");if(e.rtcp.cname=m.value,p){var h=void 0,v=new a.default,_=!0,g=!1,y=void 0;try{for(var b,I=(0,o.default)(f.ssrcs||[]);!(_=(b=I.next()).done);_=!0){var k=b.value;if(\"msid\"===k.attribute){var P=k.id;v.add(P),h||(h=P)}}}catch(e){g=!0,y=e}finally{try{!_&&I.return&&I.return()}finally{if(g)throw y}}if(0===v.size)throw new Error(\"no a=ssrc lines found\");var S=new i.default,w=!0,T=!1,A=void 0;try{for(var E,R=(0,o.default)(f.ssrcGroups||[]);!(w=(E=R.next()).done);w=!0){var C=E.value;if(\"FID\"===C.semantics){var O=C.ssrcs.split(/\\s+/),N=(0,n.default)(O,2),x=N[0],L=N[1];x=Number(x),L=Number(L),v.has(x)&&(v.delete(x),v.delete(L),S.set(x,L))}}}catch(e){T=!0,A=e}finally{try{!w&&R.return&&R.return()}finally{if(T)throw A}}var D=!0,M=!1,B=void 0;try{for(var V,j=(0,o.default)(v);!(D=(V=j.next()).done);D=!0){var F=V.value;S.set(F,null)}}catch(e){M=!0,B=e}finally{try{!D&&j.return&&j.return()}finally{if(M)throw B}}e.encodings=[];var U=S.size>1,G=[\"low\",\"medium\",\"high\"],H=!0,K=!1,W=void 0;try{for(var z,X=(0,o.default)(S);!(H=(z=X.next()).done);H=!0){var q=(0,n.default)(z.value,2),Y=q[0],J=(L=q[1],{ssrc:Y});L&&(J.rtx={ssrc:L}),U&&(J.profile=G.shift()),e.encodings.push(J)}}catch(e){K=!0,W=e}finally{try{!H&&X.return&&X.return()}finally{if(K)throw W}}}else{var Q=m.id,$=[],Z=!0,ee=!1,te=void 0;try{for(var re,ne=(0,o.default)(f.rids||[]);!(Z=(re=ne.next()).done);Z=!0){var ie=re.value;\"send\"===ie.direction&&(/^low/.test(ie.id)?$.push({rid:ie.id,profile:\"low\"}):/^medium/.test(ie.id)&&$.push({rid:ie.id,profile:\"medium\"}),/^high/.test(ie.id)&&$.push({rid:ie.id,profile:\"high\"}))}}catch(e){ee=!0,te=e}finally{try{!Z&&ne.return&&ne.return()}finally{if(ee)throw te}}if(e.encodings=[],0===$.length){var ae={ssrc:Q};e.encodings.push(ae)}else{var oe=!0,se=!1,ce=void 0;try{for(var de,ue=(0,o.default)($);!(oe=(de=ue.next()).done);oe=!0){var le=de.value,pe={encodingId:le.rid,profile:le.profile};e.encodings.push(pe)}}catch(e){se=!0,ce=e}finally{try{!oe&&ue.return&&ue.return()}finally{if(se)throw ce}}}}},t.addPlanBSimulcast=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.mid,i=void 0===n?null:n,a=c(e,t,i),o=(a.ssrcs||[]).find((function(e){return\"msid\"===e.attribute}));if(!o)throw new Error(\"a=ssrc line with msid information not found\");var s=o.id,d=o.value.split(\" \")[0],u=void 0;(a.ssrcGroups||[]).some((function(e){if(\"FID\"===e.semantics){var t=e.ssrcs.split(/\\s+/);return Number(t[0])===s?(u=Number(t[1]),!0):void 0}}));var l=a.ssrcs.find((function(e){return\"cname\"===e.attribute&&e.id===s}));if(!l)throw new Error(\"CNAME line not found\");var p=l.value,f=s+1,m=s+2;if(a.ssrcGroups=[],a.ssrcs=[],a.ssrcGroups.push({semantics:\"SIM\",ssrcs:s+\" \"+f+\" \"+m}),a.ssrcs.push({id:s,attribute:\"cname\",value:p}),a.ssrcs.push({id:s,attribute:\"msid\",value:d+\" \"+t.id}),a.ssrcs.push({id:f,attribute:\"cname\",value:p}),a.ssrcs.push({id:f,attribute:\"msid\",value:d+\" \"+t.id}),a.ssrcs.push({id:m,attribute:\"cname\",value:p}),a.ssrcs.push({id:m,attribute:\"msid\",value:d+\" \"+t.id}),u){var h=u+1,v=u+2;a.ssrcGroups.push({semantics:\"FID\",ssrcs:s+\" \"+u}),a.ssrcs.push({id:u,attribute:\"cname\",value:p}),a.ssrcs.push({id:u,attribute:\"msid\",value:d+\" \"+t.id}),a.ssrcGroups.push({semantics:\"FID\",ssrcs:f+\" \"+h}),a.ssrcs.push({id:h,attribute:\"cname\",value:p}),a.ssrcs.push({id:h,attribute:\"msid\",value:d+\" \"+t.id}),a.ssrcGroups.push({semantics:\"FID\",ssrcs:m+\" \"+v}),a.ssrcs.push({id:v,attribute:\"cname\",value:p}),a.ssrcs.push({id:v,attribute:\"msid\",value:d+\" \"+t.id})}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(43)),i=f(r(9)),a=f(r(2)),o=f(r(3)),s=f(r(4)),c=f(r(0)),d=f(r(1)),u=f(r(13)),l=f(r(5)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default(\"RemoteUnifiedPlanSdp\"),h=function(){function e(t){(0,c.default)(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:p.randomNumber(),version:0}}return(0,d.default)(e,[{key:\"setTransportLocalParameters\",value:function(e){m.debug(\"setTransportLocalParameters() [transportLocalParameters:%o]\",e),this._transportLocalParameters=e}},{key:\"setTransportRemoteParameters\",value:function(e){m.debug(\"setTransportRemoteParameters() [transportRemoteParameters:%o]\",e),this._transportRemoteParameters=e}},{key:\"updateTransportRemoteIceParameters\",value:function(e){m.debug(\"updateTransportRemoteIceParameters() [remoteIceParameters:%o]\",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:\"createAnswerSdp\",value:function(e){if(m.debug(\"createAnswerSdp()\"),!this._transportLocalParameters)throw new Error(\"no transport local parameters\");if(!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,o={},s=(e.media||[]).filter((function(e){return e.hasOwnProperty(\"mid\")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,o.version=0,o.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},o.name=\"-\",o.timing={start:0,stop:0},o.icelite=t.iceLite?\"ice-lite\":null,o.msidSemantic={semantic:\"WMS\",token:\"*\"},s.length>0&&(o.groups=[{type:\"BUNDLE\",mids:s.join(\" \")}]),o.media=[];var c=a.fingerprints.length;o.fingerprint={type:a.fingerprints[c-1].algorithm,hash:a.fingerprints[c-1].value};var d=!0,l=!1,p=void 0;try{for(var f,h=(0,i.default)(e.media||[]);!(d=(f=h.next()).done);d=!0){var v=f.value,_=\"inactive\"===v.direction,g=v.type,y=this._rtpParametersByKind[g].codecs,b=this._rtpParametersByKind[g].headerExtensions,I={};I.type=v.type,I.port=7,I.protocol=\"RTP/SAVPF\",I.connection={ip:\"127.0.0.1\",version:4},I.mid=v.mid,I.iceUfrag=t.usernameFragment,I.icePwd=t.password,I.candidates=[];var k=!0,P=!1,S=void 0;try{for(var w,T=(0,i.default)(r);!(k=(w=T.next()).done);k=!0){var A=w.value,E={component:1};E.foundation=A.foundation,E.ip=A.ip,E.port=A.port,E.priority=A.priority,E.transport=A.protocol,E.type=A.type,A.tcpType&&(E.tcptype=A.tcpType),I.candidates.push(E)}}catch(e){P=!0,S=e}finally{try{!k&&T.return&&T.return()}finally{if(P)throw S}}switch(I.endOfCandidates=\"end-of-candidates\",I.iceOptions=\"renomination\",a.role){case\"client\":I.setup=\"active\";break;case\"server\":I.setup=\"passive\"}switch(v.direction){case\"sendrecv\":case\"sendonly\":I.direction=\"recvonly\";break;case\"recvonly\":case\"inactive\":I.direction=\"inactive\"}I.rtp=[],I.rtcpFb=[],I.fmtp=[];var R=!0,C=!1,O=void 0;try{for(var N,x=(0,i.default)(y);!(R=(N=x.next()).done);R=!0){var L=N.value,D={payload:L.payloadType,codec:L.name,rate:L.clockRate};if(L.channels>1&&(D.encoding=L.channels),I.rtp.push(D),L.parameters){var M={payload:L.payloadType,config:\"\"},B=!0,V=!1,j=void 0;try{for(var F,U=(0,i.default)((0,n.default)(L.parameters));!(B=(F=U.next()).done);B=!0){var G=F.value;M.config&&(M.config+=\";\"),M.config+=G+\"=\"+L.parameters[G]}}catch(e){V=!0,j=e}finally{try{!B&&U.return&&U.return()}finally{if(V)throw j}}M.config&&I.fmtp.push(M)}if(L.rtcpFeedback){var H=!0,K=!1,W=void 0;try{for(var z,X=(0,i.default)(L.rtcpFeedback);!(H=(z=X.next()).done);H=!0){var q=z.value;I.rtcpFb.push({payload:L.payloadType,type:q.type,subtype:q.parameter||\"\"})}}catch(e){K=!0,W=e}finally{try{!H&&X.return&&X.return()}finally{if(K)throw W}}}}}catch(e){C=!0,O=e}finally{try{!R&&x.return&&x.return()}finally{if(C)throw O}}if(I.payloads=y.map((function(e){return e.payloadType})).join(\" \"),!_){I.ext=[];var Y=!0,J=!1,Q=void 0;try{for(var $,Z=function(){var e=$.value;if(!(v.ext||[]).find((function(t){return t.uri===e.uri})))return\"continue\";I.ext.push({uri:e.uri,value:e.id})},ee=(0,i.default)(b);!(Y=($=ee.next()).done);Y=!0)Z()}catch(e){J=!0,Q=e}finally{try{!Y&&ee.return&&ee.return()}finally{if(J)throw Q}}}if(v.simulcast){I.simulcast={dir1:\"recv\",list1:v.simulcast.list1},I.rids=[];var te=!0,re=!1,ne=void 0;try{for(var ie,ae=(0,i.default)(v.rids||[]);!(te=(ie=ae.next()).done);te=!0){var oe=ie.value;\"send\"===oe.direction&&I.rids.push({id:oe.id,direction:\"recv\"})}}catch(e){re=!0,ne=e}finally{try{!te&&ae.return&&ae.return()}finally{if(re)throw ne}}}else if(v.simulcast_03){I.simulcast_03={value:v.simulcast_03.value.replace(/send/g,\"recv\")},I.rids=[];var se=!0,ce=!1,de=void 0;try{for(var ue,le=(0,i.default)(v.rids||[]);!(se=(ue=le.next()).done);se=!0){var pe=ue.value;\"send\"===pe.direction&&I.rids.push({id:pe.id,direction:\"recv\"})}}catch(e){ce=!0,de=e}finally{try{!se&&le.return&&le.return()}finally{if(ce)throw de}}}I.rtcpMux=\"rtcp-mux\",I.rtcpRsize=\"rtcp-rsize\",o.media.push(I)}}catch(e){l=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(l)throw p}}return u.default.write(o)}}]),t}(h),_=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:\"createOfferSdp\",value:function(e){if(m.debug(\"createOfferSdp()\"),!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,o={},s=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,o.version=0,o.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},o.name=\"-\",o.timing={start:0,stop:0},o.icelite=t.iceLite?\"ice-lite\":null,o.msidSemantic={semantic:\"WMS\",token:\"*\"},s.length>0&&(o.groups=[{type:\"BUNDLE\",mids:s.join(\" \")}]),o.media=[];var c=a.fingerprints.length;o.fingerprint={type:a.fingerprints[c-1].algorithm,hash:a.fingerprints[c-1].value};var d=!0,l=!1,p=void 0;try{for(var f,h=(0,i.default)(e);!(d=(f=h.next()).done);d=!0){var v=f.value,_=v.closed,g=v.kind,y=void 0,b=void 0;\"application\"!==v.kind&&(y=this._rtpParametersByKind[g].codecs,b=this._rtpParametersByKind[g].headerExtensions);var I={};\"application\"!==v.kind?(I.type=g,I.port=7,I.protocol=\"RTP/SAVPF\",I.connection={ip:\"127.0.0.1\",version:4},I.mid=v.mid,I.msid=v.streamId+\" \"+v.trackId):(I.type=g,I.port=9,I.protocol=\"DTLS/SCTP\",I.connection={ip:\"127.0.0.1\",version:4},I.mid=v.mid),I.iceUfrag=t.usernameFragment,I.icePwd=t.password,I.candidates=[];var k=!0,P=!1,S=void 0;try{for(var w,T=(0,i.default)(r);!(k=(w=T.next()).done);k=!0){var A=w.value,E={component:1};E.foundation=A.foundation,E.ip=A.ip,E.port=A.port,E.priority=A.priority,E.transport=A.protocol,E.type=A.type,A.tcpType&&(E.tcptype=A.tcpType),I.candidates.push(E)}}catch(e){P=!0,S=e}finally{try{!k&&T.return&&T.return()}finally{if(P)throw S}}if(I.endOfCandidates=\"end-of-candidates\",I.iceOptions=\"renomination\",I.setup=\"actpass\",\"application\"!==v.kind){I.direction=_?\"inactive\":\"sendonly\",I.rtp=[],I.rtcpFb=[],I.fmtp=[];var R=!0,C=!1,O=void 0;try{for(var N,x=(0,i.default)(y);!(R=(N=x.next()).done);R=!0){var L=N.value,D={payload:L.payloadType,codec:L.name,rate:L.clockRate};if(L.channels>1&&(D.encoding=L.channels),I.rtp.push(D),L.parameters){var M={payload:L.payloadType,config:\"\"},B=!0,V=!1,j=void 0;try{for(var F,U=(0,i.default)((0,n.default)(L.parameters));!(B=(F=U.next()).done);B=!0){var G=F.value;M.config&&(M.config+=\";\"),M.config+=G+\"=\"+L.parameters[G]}}catch(e){V=!0,j=e}finally{try{!B&&U.return&&U.return()}finally{if(V)throw j}}M.config&&I.fmtp.push(M)}if(L.rtcpFeedback){var H=!0,K=!1,W=void 0;try{for(var z,X=(0,i.default)(L.rtcpFeedback);!(H=(z=X.next()).done);H=!0){var q=z.value;I.rtcpFb.push({payload:L.payloadType,type:q.type,subtype:q.parameter||\"\"})}}catch(e){K=!0,W=e}finally{try{!H&&X.return&&X.return()}finally{if(K)throw W}}}}}catch(e){C=!0,O=e}finally{try{!R&&x.return&&x.return()}finally{if(C)throw O}}if(I.payloads=y.map((function(e){return e.payloadType})).join(\" \"),!_){I.ext=[];var Y=!0,J=!1,Q=void 0;try{for(var $,Z=(0,i.default)(b);!(Y=($=Z.next()).done);Y=!0){var ee=$.value;\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==ee.uri&&I.ext.push({uri:ee.uri,value:ee.id})}}catch(e){J=!0,Q=e}finally{try{!Y&&Z.return&&Z.return()}finally{if(J)throw Q}}}I.rtcpMux=\"rtcp-mux\",I.rtcpRsize=\"rtcp-rsize\",_||(I.ssrcs=[],I.ssrcGroups=[],I.ssrcs.push({id:v.ssrc,attribute:\"cname\",value:v.cname}),v.rtxSsrc&&(I.ssrcs.push({id:v.rtxSsrc,attribute:\"cname\",value:v.cname}),I.ssrcGroups.push({semantics:\"FID\",ssrcs:v.ssrc+\" \"+v.rtxSsrc})))}else I.payloads=5e3,I.sctpmap={app:\"webrtc-datachannel\",maxMessageSize:256,sctpmapNumber:5e3};o.media.push(I)}}catch(e){l=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(l)throw p}}return u.default.write(o)}}]),t}(h);t.default=function e(t,r){switch((0,c.default)(this,e),m.debug(\"constructor() [direction:%s, rtpParametersByKind:%o]\",t,r),t){case\"send\":return new v(r);case\"recv\":return new _(r)}}},function(e,t){var r;r=function(){return this}();try{r=r||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports={}},function(e,t,r){var n=r(71),i=r(67);e.exports=function(e){return n(i(e))}},function(e,t,r){r(128);for(var n=r(14),i=r(29),a=r(39),o=r(15)(\"toStringTag\"),s=\"CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList\".split(\",\"),c=0;c<s.length;c++){var d=s[c],u=n[d],l=u&&u.prototype;l&&!l[o]&&i(l,o,d),a[d]=a.Array}},function(e,t,r){\"use strict\";var n,i=r(8),a=(n=i)&&n.__esModule?n:{default:n};var o=new a.default([[1,{code:\"TTT_SUCCESS\",reason:\"success\"}],[2,{code:\"TTT_FAIL\",reason:\"auth lock dog - noresource\"}],[4,{code:\"TTT_FAIL\",reason:\"already in channel\"}],[5,{code:\"TTT_FAIL\",reason:\"param invalid\"}],[6,{code:\"TTT_NO_SERVER_AVAILABLE\",reason:\"no server available\"}],[9,{code:\"TTT_FAIL\",reason:\"already login\"}],[10,{code:\"TTT_OVERMAX\",reason:\"overmax\"}],[11,{code:\"TTT_AUDIO_TIMEOUT\",reason:\"audio timeout\"}],[12,{code:\"TTT_VIDEO_TIMEOUT\",reason:\"video timeout\"}],[13,{code:\"TTT_LIVE_NOT_START\",reason:\"live not start\"}],[14,{code:\"TTT_TIMEOUT\",reason:\"timeout\"}],[15,{code:\"TTT_FAIL\",reason:\"update user media message\"}],[16,{code:\"TTT_NO_CHAIR\",reason:\"no-chair\"}],[17,{code:\"TTT_USER_NON_EXIST\",reason:\"user non-exist\"}],[18,{code:\"TTT_RECORD_ERROR\",reason:\"record error\"}],[19,{code:\"TTT_AUDIOMIXER_ERROR\",reason:\"audiomixer error\"}],[20,{code:\"TTT_DBOPER_ERROR\",reason:\"dboper error\"}],[21,{code:\"TTT_CHAIR_PASSWORD_ERROR\",reason:\"chair password error\"}],[22,{code:\"TTT_PASSWORD_ERROR\",reason:\"password error\"}],[23,{code:\"TTT_NO_PASSWORD\",reason:\"no password\"}],[24,{code:\"TTT_CHANNEL_NON_EXIST\",reason:\"channel is not exist\"}],[25,{code:\"INVALID_APPID\",reason:\"invalid appid\"}],[26,{code:\"TTT_RTMP_CONNECT\",reason:\"rtmp connect\"}],[27,{code:\"TTT_AUTHENTICATION\",reason:\"authentication\"}],[30,{code:\"TTT_CONNECT_TIMEOUT\",reason:\"connect timeout\"}]]),s=new a.default([[\"80p\",{width:110,height:80,bps:{ideal:55e3,min:3e4,max:7e4}}],[\"120p\",{width:160,height:120,bps:{ideal:65e3,min:4e4,max:8e4}}],[\"120p_3\",{width:120,height:120,bps:{ideal:5e4,min:4e4,max:7e4}}],[\"160p\",{width:210,height:160,bps:{ideal:12e4,min:5e4,max:15e4}}],[\"180p\",{width:320,height:180,bps:{ideal:14e4,min:6e4,max:2e5}}],[\"180p_3\",{width:180,height:180,bps:{ideal:1e5,min:6e4,max:16e4}}],[\"180p_4\",{width:240,height:180,bps:{ideal:12e4,min:6e4,max:16e4}}],[\"200p\",{width:270,height:200,bps:{ideal:14e4,min:6e4,max:2e5}}],[\"240p\",{width:320,height:240,bps:{ideal:2e5,min:6e4,max:26e4}}],[\"320p\",{width:420,height:320,bps:{ideal:25e4,min:8e4,max:3e5}}],[\"360p\",{width:480,height:360,bps:{ideal:25e4,min:8e4,max:36e4}}],[\"360p_1\",{width:640,height:360,bps:{ideal:3e5,min:8e4,max:4e5}}],[\"480p\",{width:640,height:480,bps:{ideal:4e5,min:12e4,max:45e4}}],[\"480p_8\",{width:848,height:480,bps:{ideal:5e5,min:12e4,max:45e4}}],[\"540p\",{width:720,height:540,bps:{ideal:6e5,min:2e5,max:7e5}}],[\"720p\",{width:1280,height:720,bps:{ideal:113e4,min:5e5,max:2e6}}],[\"720p_5\",{width:960,height:720,bps:{ideal:8e5,min:5e5,max:16e5}}],[\"720p_6\",{width:960,height:720,bps:{ideal:1e6,min:8e5,max:2e6}}],[\"1080p\",{width:1920,height:1080,bps:{ideal:16e5,min:8e5,max:24e5}}],[\"2k\",{width:2560,height:1440,bps:{ideal:12e5,min:8e5,max:3e6}}],[\"4k\",{width:3840,height:2160,bps:{ideal:2e6,min:1e6,max:8e6}}],[\"8k\",{width:7680,height:4320,bps:{ideal:4e6,min:2e6,max:1e7}}]]),c=new a.default([[\"80p\",{width:110,height:80,bps:{ideal:99e3,min:54e3,max:112e3}}],[\"120p\",{width:160,height:120,bps:{ideal:117e3,min:72e3,max:128e3}}],[\"120p_3\",{width:120,height:120,bps:{ideal:9e4,min:72e3,max:112e3}}],[\"160p\",{width:210,height:160,bps:{ideal:216e3,min:9e4,max:24e4}}],[\"180p\",{width:320,height:180,bps:{ideal:252e3,min:108e3,max:32e4}}],[\"180p_3\",{width:180,height:180,bps:{ideal:18e4,min:108e3,max:256e3}}],[\"180p_4\",{width:240,height:180,bps:{ideal:216e3,min:108e3,max:256e3}}],[\"200p\",{width:270,height:200,bps:{ideal:252e3,min:108e3,max:32e4}}],[\"240p\",{width:320,height:240,bps:{ideal:36e4,min:108e3,max:416e3}}],[\"320p\",{width:420,height:320,bps:{ideal:45e4,min:144e3,max:48e4}}],[\"360p\",{width:480,height:360,bps:{ideal:45e4,min:144e3,max:576e3}}],[\"360p_1\",{width:640,height:360,bps:{ideal:54e4,min:144e3,max:64e4}}],[\"480p\",{width:640,height:480,bps:{ideal:72e4,min:216e3,max:72e4}}],[\"480p_8\",{width:848,height:480,bps:{ideal:9e5,min:216e3,max:72e4}}],[\"540p\",{width:720,height:540,bps:{ideal:108e4,min:36e4,max:112e4}}],[\"720p\",{width:1280,height:720,bps:{ideal:2034e3,min:9e5,max:32e5}}],[\"720p_5\",{width:960,height:720,bps:{ideal:144e4,min:9e5,max:256e4}}],[\"720p_6\",{width:960,height:720,bps:{ideal:18e5,min:144e4,max:32e5}}],[\"1080p\",{width:1920,height:1080,bps:{ideal:288e4,min:144e4,max:384e4}}],[\"2k\",{width:2560,height:1440,bps:{ideal:216e4,min:144e4,max:48e5}}],[\"4k\",{width:3840,height:2160,bps:{ideal:36e5,min:18e5,max:128e5}}],[\"8k\",{width:7680,height:4320,bps:{ideal:72e5,min:36e5,max:16e6}}]]),d=new a.default([[\"720p\",{width:1280,height:720,bps:{ideal:12e5,min:8e5,max:15e5}}],[\"1080p\",{width:1920,height:1080,bps:{ideal:15e5,min:12e5,max:24e5}}],[\"2k\",{width:2560,height:1440,bps:{ideal:2e6,min:15e5,max:3e6}}],[\"4k\",{width:3840,height:2160,bps:{ideal:24e5,min:18e5,max:4e6}}],[\"8k\",{width:7680,height:4320,bps:{ideal:3e6,min:24e5,max:6e6}}]]),u=new a.default([[\"720p\",{width:1280,height:720,bps:{ideal:18e5,min:12e5,max:225e4}}],[\"1080p\",{width:1920,height:1080,bps:{ideal:225e4,min:18e5,max:36e5}}],[\"2k\",{width:2560,height:1440,bps:{ideal:3e6,min:225e4,max:45e5}}],[\"4k\",{width:3840,height:2160,bps:{ideal:36e5,min:27e5,max:6e6}}],[\"8k\",{width:7680,height:4320,bps:{ideal:45e5,min:36e5,max:9e6}}]]),l=new a.default([[\"isac32\",{codec:\"isac\",maxplaybackrate:32e3,stereo:0,maxaveragebitrate:40960}],[\"speech_low_quality\",{codec:\"opus\",maxplaybackrate:16e3,stereo:0,maxaveragebitrate:24576}],[\"speech_standard\",{codec:\"opus\",maxplaybackrate:32e3,stereo:0,maxaveragebitrate:24576}],[\"music_standard\",{codec:\"opus\",maxplaybackrate:48e3,stereo:0,maxaveragebitrate:40960}],[\"standard_stereo\",{codec:\"opus\",maxplaybackrate:48e3,stereo:1,maxaveragebitrate:65536}],[\"high_quality\",{codec:\"opus\",maxplaybackrate:48e3,stereo:0,maxaveragebitrate:131072}],[\"high_quality_stereo\",{codec:\"opus\",maxplaybackrate:48e3,stereo:1,maxaveragebitrate:196608}]]);e.exports={logLevel:{LOG_NONE:6,LOG_ERROR:5,LOG_WARN:4,LOG_INFO:3,LOG_DEBUG:2,LOG_TRACE:1},audioProfileSpec:l,audioSpec:{sampleRate:{min:4e3,max:48e3,ideal:8e3},channelCount:{min:1,max:2,ideal:1}},videoSpec:{width:{min:80,ideal:640,max:1920},height:{min:60,ideal:480,max:1080},bitrate:{min:80,ideal:400,max:2e3},frameRate:{min:10,ideal:15,max:30},aspectRatio:4/3},mediaServerAddress:\"\",PUBLISH_STATE:{IDLE:0,PUBLISHING:1,PUBLISHED:2},tttErrCode:{ERROR_UNDEFINED:1e3,IPLOC_FAIL:1001,SERVER_FAIL:1002,INVALID_APPID:1003,INVALID_USERID:1004,INVALID_CHANNELID:1005,INVALID_PARAM:1006,INVALID_PARAM_STREAM:1007,NOT_READY:1008,CLIENT_HAS_ALREADY_INIT:1009,STREAM_HAS_ALREADY_INIT:1010,NONSUPPORT:1099,SYS_EXCEPTION:1100,CALL_IMPROPER:1101,TASK_FAIL:2e3,TASK_PROCEEDING:2001,JOIN_FAIL:2002,CONNECT_BROKEN:2003,NOT_LOGIN:2004,PERMISSION_DENIED:2005,PUBLISH_FAIL:2006,AUDIO_NOPUBLISH:2007,VIDEO_NOPUBLISH:2008,STREAM_HASPUBLISHED:2010,DEVICE_EXCEPTION:2020,AUDIO_PLAY_FAIL:2021,VIDEO_PLAY_FAIL:2022,STREAM_HAS_NOAUDIO:2023,STREAM_HAS_NOVIDEO:2024,STREAM_HAS_NOMEDIA:2025,STREAM_AUDIO_OFF:2026,STREAM_VIDEO_OFF:2027,RTMP_URL_ALREADY_EXIST:2028,BGURL_SET_FAIL:2089},tttErrMsg:o,logserver_url:\"https://logst.3ttech.cn:15200\",iplocationAddress:\"webdispatch.3ttech.cn\",iplocationPort:443,videoResolution:s,videoResolutionH:c,screenResolution:d,screenResolutionH:u,videoAttributes:{sif:[320,240],vga:[640,480],hd720p:[1280,720]}}},function(e,t,r){e.exports={default:r(168),__esModule:!0}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(r(54)),i=s(r(9)),a=s(r(8)),o=s(r(20));function s(e){return e&&e.__esModule?e:{default:e}}t.fillRtpParametersForTrack=function(e,t,r){var s=r.kind,c={cname:null,reducedSize:!0,mux:!0},d=(t.media||[]).find((function(e){return e.type===s}));if(!d)throw new Error(\"m=\"+s+\" section not found\");var u=void 0,l=new o.default,p=!0,f=!1,m=void 0;try{for(var h,v=(0,i.default)(d.ssrcs||[]);!(p=(h=v.next()).done);p=!0){var _=h.value;if(\"msid\"===_.attribute)if(_.value.split(\" \")[1]===r.id){var g=_.id;l.add(g),u||(u=g)}}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}if(0===l.size)throw new Error(\"a=ssrc line not found for local track [track.id:\"+r.id+\"]\");var y=new a.default,b=!0,I=!1,k=void 0;try{for(var P,S=(0,i.default)(d.ssrcGroups||[]);!(b=(P=S.next()).done);b=!0){var w=P.value;if(\"FID\"===w.semantics){var T=w.ssrcs.split(/\\s+/),A=(0,n.default)(T,2),E=A[0],R=A[1];E=Number(E),R=Number(R),l.has(E)&&(l.delete(E),l.delete(R),y.set(E,R))}}}catch(e){I=!0,k=e}finally{try{!b&&S.return&&S.return()}finally{if(I)throw k}}var C=!0,O=!1,N=void 0;try{for(var x,L=(0,i.default)(l);!(C=(x=L.next()).done);C=!0){var D=x.value;y.set(D,null)}}catch(e){O=!0,N=e}finally{try{!C&&L.return&&L.return()}finally{if(O)throw N}}var M=d.ssrcs.find((function(e){return\"cname\"===e.attribute&&e.id===u}));M&&(c.cname=M.value);e.rtcp=c,e.encodings=[];var B=y.size>1,V=[\"low\",\"medium\",\"high\"],j=!0,F=!1,U=void 0;try{for(var G,H=(0,i.default)(y);!(j=(G=H.next()).done);j=!0){var K=(0,n.default)(G.value,2),W=K[0],z=(R=K[1],{ssrc:W});R&&(z.rtx={ssrc:R}),B&&(z.profile=V.shift()),e.encodings.push(z)}}catch(e){F=!0,U=e}finally{try{!j&&H.return&&H.return()}finally{if(F)throw U}}},t.addSimulcastForTrack=function(e,t){var r=t.kind,n=(e.media||[]).find((function(e){return e.type===r}));if(!n)throw new Error(\"m=\"+r+\" section not found\");var i=void 0,a=void 0,o=void 0;if(!(n.ssrcs||[]).find((function(e){return\"msid\"===e.attribute&&(e.value.split(\" \")[1]===t.id?(i=e.id,o=e.value.split(\" \")[0],!0):void 0)})))throw new Error(\"a=ssrc line not found for local track [track.id:\"+t.id+\"]\");(n.ssrcGroups||[]).some((function(e){if(\"FID\"===e.semantics){var t=e.ssrcs.split(/\\s+/);return Number(t[0])===i?(a=Number(t[1]),!0):void 0}}));var s=n.ssrcs.find((function(e){return\"cname\"===e.attribute&&e.id===i}));if(!s)throw new Error(\"CNAME line not found for local track [track.id:\"+t.id+\"]\");var c=s.value,d=i+1,u=i+2;if(n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.push({semantics:\"SIM\",ssrcs:i+\" \"+d+\" \"+u}),n.ssrcs.push({id:d,attribute:\"cname\",value:c}),n.ssrcs.push({id:d,attribute:\"msid\",value:o+\" \"+t.id}),n.ssrcs.push({id:u,attribute:\"cname\",value:c}),n.ssrcs.push({id:u,attribute:\"msid\",value:o+\" \"+t.id}),a){var l=a+1,p=a+2;n.ssrcGroups.push({semantics:\"FID\",ssrcs:d+\" \"+l}),n.ssrcs.push({id:l,attribute:\"cname\",value:c}),n.ssrcs.push({id:l,attribute:\"msid\",value:o+\" \"+t.id}),n.ssrcGroups.push({semantics:\"FID\",ssrcs:u+\" \"+p}),n.ssrcs.push({id:p,attribute:\"cname\",value:c}),n.ssrcs.push({id:p,attribute:\"msid\",value:o+\" \"+t.id})}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(43)),i=f(r(9)),a=f(r(2)),o=f(r(3)),s=f(r(4)),c=f(r(0)),d=f(r(1)),u=f(r(13)),l=f(r(5)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default(\"RemotePlanBSdp\"),h=function(){function e(t){(0,c.default)(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:p.randomNumber(),version:0}}return(0,d.default)(e,[{key:\"setTransportLocalParameters\",value:function(e){m.debug(\"setTransportLocalParameters() [transportLocalParameters:%o]\",e),this._transportLocalParameters=e}},{key:\"setTransportRemoteParameters\",value:function(e){m.debug(\"setTransportRemoteParameters() [transportRemoteParameters:%o]\",e),this._transportRemoteParameters=e}},{key:\"updateTransportRemoteIceParameters\",value:function(e){m.debug(\"updateTransportRemoteIceParameters() [remoteIceParameters:%o]\",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:\"createAnswerSdp\",value:function(e){if(m.debug(\"createAnswerSdp()\"),!this._transportLocalParameters)throw new Error(\"no transport local parameters\");if(!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,o={},s=(e.media||[]).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,o.version=0,o.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},o.name=\"-\",o.timing={start:0,stop:0},o.icelite=t.iceLite?\"ice-lite\":null,o.msidSemantic={semantic:\"WMS\",token:\"*\"},o.groups=[{type:\"BUNDLE\",mids:s.join(\" \")}],o.media=[];var c=a.fingerprints.length;o.fingerprint={type:a.fingerprints[c-1].algorithm,hash:a.fingerprints[c-1].value};var d=!0,l=!1,p=void 0;try{for(var f,h=(0,i.default)(e.media||[]);!(d=(f=h.next()).done);d=!0){var v=f.value,_=v.type,g=this._rtpParametersByKind[_].codecs,y=this._rtpParametersByKind[_].headerExtensions,b={};b.type=v.type,b.port=7,b.protocol=\"RTP/SAVPF\",b.connection={ip:\"127.0.0.1\",version:4},b.mid=v.mid,b.iceUfrag=t.usernameFragment,b.icePwd=t.password,b.candidates=[];var I=!0,k=!1,P=void 0;try{for(var S,w=(0,i.default)(r);!(I=(S=w.next()).done);I=!0){var T=S.value,A={component:1};A.foundation=T.foundation,A.ip=T.ip,A.port=T.port,A.priority=T.priority,A.transport=T.protocol,A.type=T.type,T.tcpType&&(A.tcptype=T.tcpType),b.candidates.push(A)}}catch(e){k=!0,P=e}finally{try{!I&&w.return&&w.return()}finally{if(k)throw P}}switch(b.endOfCandidates=\"end-of-candidates\",b.iceOptions=\"renomination\",a.role){case\"client\":b.setup=\"active\";break;case\"server\":b.setup=\"passive\"}switch(v.direction){case\"sendrecv\":case\"sendonly\":b.direction=\"recvonly\";break;case\"recvonly\":case\"inactive\":b.direction=\"inactive\"}\"video\"===_&&(b.xGoogleFlag=\"conference\"),b.rtp=[],b.rtcpFb=[],b.fmtp=[];var E=!0,R=!1,C=void 0;try{for(var O,N=(0,i.default)(g);!(E=(O=N.next()).done);E=!0){var x=O.value,L={payload:x.payloadType,codec:x.name,rate:x.clockRate};if(x.channels>1&&(L.encoding=x.channels),b.rtp.push(L),x.parameters){var D={payload:x.payloadType,config:\"\"},M=!0,B=!1,V=void 0;try{for(var j,F=(0,i.default)((0,n.default)(x.parameters));!(M=(j=F.next()).done);M=!0){var U=j.value;D.config&&(D.config+=\";\"),D.config+=U+\"=\"+x.parameters[U]}}catch(e){B=!0,V=e}finally{try{!M&&F.return&&F.return()}finally{if(B)throw V}}D.config&&b.fmtp.push(D)}if(x.rtcpFeedback){var G=!0,H=!1,K=void 0;try{for(var W,z=(0,i.default)(x.rtcpFeedback);!(G=(W=z.next()).done);G=!0){var X=W.value;b.rtcpFb.push({payload:x.payloadType,type:X.type,subtype:X.parameter||\"\"})}}catch(e){H=!0,K=e}finally{try{!G&&z.return&&z.return()}finally{if(H)throw K}}}}}catch(e){R=!0,C=e}finally{try{!E&&N.return&&N.return()}finally{if(R)throw C}}b.payloads=g.map((function(e){return e.payloadType})).join(\" \"),b.ext=[];var q=!0,Y=!1,J=void 0;try{for(var Q,$=function(){var e=Q.value;if(!(v.ext||[]).find((function(t){return t.uri===e.uri})))return\"continue\";b.ext.push({uri:e.uri,value:e.id})},Z=(0,i.default)(y);!(q=(Q=Z.next()).done);q=!0)$()}catch(e){Y=!0,J=e}finally{try{!q&&Z.return&&Z.return()}finally{if(Y)throw J}}b.rtcpMux=\"rtcp-mux\",b.rtcpRsize=\"rtcp-rsize\",o.media.push(b)}}catch(e){l=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(l)throw p}}return u.default.write(o)}}]),t}(h),_=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:\"createOfferSdp\",value:function(e,t){var r=this;if(m.debug(\"createOfferSdp()\"),!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var a=this._transportRemoteParameters.iceParameters,o=this._transportRemoteParameters.iceCandidates,s=this._transportRemoteParameters.dtlsParameters,c={},d=e;this._sdpGlobalFields.version++,c.version=0,c.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},c.name=\"-\",c.timing={start:0,stop:0},c.icelite=a.iceLite?\"ice-lite\":null,c.msidSemantic={semantic:\"WMS\",token:\"*\"},c.groups=[{type:\"BUNDLE\",mids:d.join(\" \")}],c.media=[];var l=s.fingerprints.length;c.fingerprint={type:s.fingerprints[l-1].algorithm,hash:s.fingerprints[l-1].value};var p=!0,f=!1,h=void 0;try{for(var v,_=function(){var e=v.value,s=r._rtpParametersByKind[e].codecs,d=r._rtpParametersByKind[e].headerExtensions,u={};u.type=e,u.port=7,u.protocol=\"RTP/SAVPF\",u.connection={ip:\"127.0.0.1\",version:4},u.mid=e,u.iceUfrag=a.usernameFragment,u.icePwd=a.password,u.candidates=[];var l=!0,p=!1,f=void 0;try{for(var m,h=(0,i.default)(o);!(l=(m=h.next()).done);l=!0){var _=m.value,g={component:1};g.foundation=_.foundation,g.ip=_.ip,g.port=_.port,g.priority=_.priority,g.transport=_.protocol,g.type=_.type,_.tcpType&&(g.tcptype=_.tcpType),u.candidates.push(g)}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}u.endOfCandidates=\"end-of-candidates\",u.iceOptions=\"renomination\",u.setup=\"actpass\",t.some((function(t){return t.kind===e}))?u.direction=\"sendonly\":u.direction=\"inactive\",u.rtp=[],u.rtcpFb=[],u.fmtp=[];var y=!0,b=!1,I=void 0;try{for(var k,P=(0,i.default)(s);!(y=(k=P.next()).done);y=!0){var S=k.value,w={payload:S.payloadType,codec:S.name,rate:S.clockRate};if(S.channels>1&&(w.encoding=S.channels),u.rtp.push(w),S.parameters){var T={payload:S.payloadType,config:\"\"},A=!0,E=!1,R=void 0;try{for(var C,O=(0,i.default)((0,n.default)(S.parameters));!(A=(C=O.next()).done);A=!0){var N=C.value;T.config&&(T.config+=\";\"),T.config+=N+\"=\"+S.parameters[N]}}catch(e){E=!0,R=e}finally{try{!A&&O.return&&O.return()}finally{if(E)throw R}}T.config&&u.fmtp.push(T)}if(S.rtcpFeedback){var x=!0,L=!1,D=void 0;try{for(var M,B=(0,i.default)(S.rtcpFeedback);!(x=(M=B.next()).done);x=!0){var V=M.value;u.rtcpFb.push({payload:S.payloadType,type:V.type,subtype:V.parameter||\"\"})}}catch(e){L=!0,D=e}finally{try{!x&&B.return&&B.return()}finally{if(L)throw D}}}}}catch(e){b=!0,I=e}finally{try{!y&&P.return&&P.return()}finally{if(b)throw I}}u.payloads=s.map((function(e){return e.payloadType})).join(\" \"),u.ext=[];var j=!0,F=!1,U=void 0;try{for(var G,H=(0,i.default)(d);!(j=(G=H.next()).done);j=!0){var K=G.value;\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==K.uri&&u.ext.push({uri:K.uri,value:K.id})}}catch(e){F=!0,U=e}finally{try{!j&&H.return&&H.return()}finally{if(F)throw U}}u.rtcpMux=\"rtcp-mux\",u.rtcpRsize=\"rtcp-rsize\",u.ssrcs=[],u.ssrcGroups=[];var W=!0,z=!1,X=void 0;try{for(var q,Y=(0,i.default)(t);!(W=(q=Y.next()).done);W=!0){var J=q.value;J.kind===e&&(u.ssrcs.push({id:J.ssrc,attribute:\"msid\",value:J.streamId+\" \"+J.trackId}),u.ssrcs.push({id:J.ssrc,attribute:\"mslabel\",value:J.streamId}),u.ssrcs.push({id:J.ssrc,attribute:\"label\",value:J.trackId}),u.ssrcs.push({id:J.ssrc,attribute:\"cname\",value:J.cname}),J.rtxSsrc&&(u.ssrcs.push({id:J.rtxSsrc,attribute:\"msid\",value:J.streamId+\" \"+J.trackId}),u.ssrcs.push({id:J.rtxSsrc,attribute:\"mslabel\",value:J.streamId}),u.ssrcs.push({id:J.rtxSsrc,attribute:\"label\",value:J.trackId}),u.ssrcs.push({id:J.rtxSsrc,attribute:\"cname\",value:J.cname}),u.ssrcGroups.push({semantics:\"FID\",ssrcs:J.ssrc+\" \"+J.rtxSsrc})))}}catch(e){z=!0,X=e}finally{try{!W&&Y.return&&Y.return()}finally{if(z)throw X}}c.media.push(u)},g=(0,i.default)(e);!(p=(v=g.next()).done);p=!0)_()}catch(e){f=!0,h=e}finally{try{!p&&g.return&&g.return()}finally{if(f)throw h}}return u.default.write(c)}}]),t}(h);t.default=function e(t,r){switch((0,c.default)(this,e),m.debug(\"constructor() [direction:%s, rtpParametersByKind:%o]\",t,r),t){case\"send\":return new v(r);case\"recv\":return new _(r)}}},function(e,t){e.exports=!0},function(e,t){e.exports=function(e){if(\"function\"!=typeof e)throw TypeError(e+\" is not a function!\");return e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(89),i=r(74);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(22).f,i=r(34),a=r(15)(\"toStringTag\");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t,r){var n=r(27),i=r(93),a=r(94),o=r(25),s=r(58),c=r(76),d={},u={};(t=e.exports=function(e,t,r,l,p){var f,m,h,v,_=p?function(){return e}:c(e),g=n(r,l,t?2:1),y=0;if(\"function\"!=typeof _)throw TypeError(e+\" is not iterable!\");if(a(_)){for(f=s(e.length);f>y;y++)if((v=t?g(o(m=e[y])[0],m[1]):g(e[y]))===d||v===u)return v}else for(h=_.call(e);!(m=h.next()).done;)if((v=i(h,g,m.value,t))===d||v===u)return v}).BREAK=d,t.RETURN=u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n,i=r(26),a=(n=i)&&n.__esModule?n:{default:n};t.getProtooUrl=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"\",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:\"\",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3443,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:\"\",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:\"isac32\",s=\"\";s=\"\"===a.length?\"wss://\"+n+\":\"+i+\"/?peerName=\"+e+\"&roomId=\"+t+\"_\"+r+\"&audioPt=\"+o:\"wss://\"+n+\":\"+i+a+\"/?peerName=\"+e+\"&roomId=\"+t+\"_\"+r+\"&audioPt=\"+o;return s},t.uuid=function(){for(var e=[],t=0;t<36;t++)e[t]=\"0123456789abcdef\".substr(Math.floor(16*Math.random()),1);return e[14]=\"4\",e[19]=\"0123456789abcdef\".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]=\"-\",e.join(\"\")},t.clone=function e(t){if(!t||\"object\"!==(void 0===t?\"undefined\":(0,a.default)(t)))return t;if(t instanceof Date){var r=new Date;return r.setTime(t.getTime()),r}if(t instanceof Array){for(var n=[],i=t.length,o=0;o<i;++o)n[o]=e(t[o]);return n}if(t instanceof Object){var s={};for(var c in t)t.hasOwnProperty(c)&&(s[c]=e(t[c]));return s}throw new Error(\"Unable to copy obj! Its type isn't supported.\")},t.getNowTime=function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours()<10?\"0\"+e.getHours():e.getHours(),a=e.getMinutes()<10?\"0\"+e.getMinutes():e.getMinutes(),o=e.getSeconds()<10?\"0\"+e.getSeconds():e.getSeconds(),s=e.getMilliseconds();return t+\"-\"+r+\"-\"+n+\" \"+i+\":\"+a+\":\"+o+\".\"+s}},function(e,t,r){\"use strict\";t.__esModule=!0;var n=a(r(170)),i=a(r(9));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,n.default)(Object(e)))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=(0,i.default)(e);!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.UnsupportedError=t.TimeoutError=t.InvalidStateError=void 0;var n=s(r(2)),i=s(r(0)),a=s(r(3)),o=s(r(4));function s(e){return e&&e.__esModule?e:{default:e}}t.InvalidStateError=function(e){function t(e){(0,i.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.name=\"InvalidStateError\",Error.hasOwnProperty(\"captureStackTrace\")?Error.captureStackTrace(r,t):r.stack=new Error(e).stack,r}return(0,o.default)(t,e),t}(Error),t.TimeoutError=function(e){function t(e){(0,i.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.name=\"TimeoutError\",Error.hasOwnProperty(\"captureStackTrace\")?Error.captureStackTrace(r,t):r.stack=new Error(e).stack,r}return(0,o.default)(t,e),t}(Error),t.UnsupportedError=function(e){function t(e,r){(0,i.default)(this,t);var o=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return o.name=\"UnsupportedError\",Error.hasOwnProperty(\"captureStackTrace\")?Error.captureStackTrace(o,t):o.stack=new Error(e).stack,o.data=r,o}return(0,o.default)(t,e),t}(Error)},function(e,t){},function(e,t,r){var n=r(25),i=r(125),a=r(74),o=r(72)(\"IE_PROTO\"),s=function(){},c=function(){var e,t=r(69)(\"iframe\"),n=a.length;for(t.style.display=\"none\",r(90).appendChild(t),t.src=\"javascript:\",(e=t.contentWindow.document).open(),e.write(\"<script>document.F=Object<\\/script>\"),e.close(),c=e.F;n--;)delete c.prototype[a[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[o]=e):r=c(),void 0===t?r:i(r,t)}},function(e,t,r){var n=r(66),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return\"Symbol(\".concat(void 0===e?\"\":e,\")_\",(++r+n).toString(36))}},function(e,t,r){var n=r(50),i=r(15)(\"toStringTag\"),a=\"Arguments\"==n(function(){return arguments}());e.exports=function(e){var t,r,o;return void 0===e?\"Undefined\":null===e?\"Null\":\"string\"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:a?n(t):\"Object\"==(o=n(t))&&\"function\"==typeof t.callee?\"Arguments\":o}},function(e,t,r){var n=r(59)(\"meta\"),i=r(19),a=r(34),o=r(22).f,s=0,c=Object.isExtensible||function(){return!0},d=!r(33)((function(){return c(Object.preventExtensions({}))})),u=function(e){o(e,n,{value:{i:\"O\"+ ++s,w:{}}})},l=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return\"symbol\"==typeof e?e:(\"string\"==typeof e?\"S\":\"P\")+e;if(!a(e,n)){if(!c(e))return\"F\";if(!t)return\"E\";u(e)}return e[n].i},getWeak:function(e,t){if(!a(e,n)){if(!c(e))return!0;if(!t)return!1;u(e)}return e[n].w},onFreeze:function(e){return d&&l.NEED&&c(e)&&!a(e,n)&&u(e),e}}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){e.exports={default:r(202),__esModule:!0}},function(e,t,r){e.exports=r(120)},function(e,t,r){\"use strict\";t.__esModule=!0;var n,i=r(6),a=(n=i)&&n.__esModule?n:{default:n};t.default=function(e){return function(){var t=e.apply(this,arguments);return new a.default((function(e,r){return function n(i,o){try{var s=t[i](o),c=s.value}catch(e){return void r(e)}if(!s.done)return a.default.resolve(c).then((function(e){n(\"next\",e)}),(function(e){n(\"throw\",e)}));e(c)}(\"next\")}))}}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError(\"Can't call method on  \"+e);return e}},function(e,t,r){\"use strict\";var n=r(46),i=r(12),a=r(88),o=r(29),s=r(39),c=r(124),d=r(51),u=r(91),l=r(15)(\"iterator\"),p=!([].keys&&\"next\"in[].keys()),f=function(){return this};e.exports=function(e,t,r,m,h,v,_){c(r,t,m);var g,y,b,I=function(e){if(!p&&e in w)return w[e];switch(e){case\"keys\":case\"values\":return function(){return new r(this,e)}}return function(){return new r(this,e)}},k=t+\" Iterator\",P=\"values\"==h,S=!1,w=e.prototype,T=w[l]||w[\"@@iterator\"]||h&&w[h],A=T||I(h),E=h?P?I(\"entries\"):A:void 0,R=\"Array\"==t&&w.entries||T;if(R&&(b=u(R.call(new e)))!==Object.prototype&&b.next&&(d(b,k,!0),n||\"function\"==typeof b[l]||o(b,l,f)),P&&T&&\"values\"!==T.name&&(S=!0,A=function(){return T.call(this)}),n&&!_||!p&&!S&&w[l]||o(w,l,A),s[t]=A,s[k]=f,h)if(g={values:P?A:I(\"values\"),keys:v?A:I(\"keys\"),entries:E},_)for(y in g)y in w||a(w,y,g[y]);else i(i.P+i.F*(p||S),t,g);return g}},function(e,t,r){var n=r(19),i=r(14).document,a=n(i)&&n(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,r){var n=r(19);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&\"function\"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if(\"function\"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&\"function\"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError(\"Can't convert object to primitive value\")}},function(e,t,r){var n=r(50);e.exports=Object(\"z\").propertyIsEnumerable(0)?Object:function(e){return\"String\"==n(e)?e.split(\"\"):Object(e)}},function(e,t,r){var n=r(73)(\"keys\"),i=r(59);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t,r){var n=r(7),i=r(14),a=i[\"__core-js_shared__\"]||(i[\"__core-js_shared__\"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})(\"versions\",[]).push({version:n.version,mode:r(46)?\"pure\":\"global\",copyright:\"© 2019 Denis Pushkarev (zloirock.ru)\"})},function(e,t){e.exports=\"constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf\".split(\",\")},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+\": incorrect invocation!\");return e}},function(e,t,r){var n=r(60),i=r(15)(\"iterator\"),a=r(39);e.exports=r(7).getIteratorMethod=function(e){if(null!=e)return e[i]||e[\"@@iterator\"]||a[n(e)]}},function(e,t,r){\"use strict\";var n=r(47);function i(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError(\"Bad Promise constructor\");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new i(e)}},function(e,t,r){var n=r(29);e.exports=function(e,t,r){for(var i in t)r&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},function(e,t,r){var n=r(12),i=r(7),a=r(33);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],o={};o[e]=t(r),n(n.S+n.F*a((function(){r(1)})),\"Object\",o)}},function(e,t,r){t.f=r(15)},function(e,t,r){var n=r(14),i=r(7),a=r(46),o=r(80),s=r(22).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:n.Symbol||{});\"_\"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(19);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError(\"Incompatible receiver, \"+t+\" required!\");return e}},function(e){e.exports=JSON.parse('{\"name\":\"tttwebsdk\",\"version\":\"3.4.51\",\"description\":\"webrtc of 3ttech.cn\",\"buildDate\":\"Jul_29_2020-1\",\"main\":\"lib/tttrtcweb.js\",\"scripts\":{\"start\":\"webpack-dev-server --open\",\"build:app\":\"webpack\",\"test\":\"webpack-dev-server --watch --config tests/webpack.config.js\",\"host\":\"webpack-dev-server --https --host=0.0.0.0 --open --watch  --config tests/webpack.config.js --inline --mode=development\",\"build:dev\":\"webpack --config webpack.config/webpack.config.dev.js --mode development\",\"build:prod\":\"webpack --config webpack.config/webpack.config.js\",\"build:test\":\"webpack --config tests/webpack.config.js\",\"lint\":\"eslint -c .eslintrc.js lib/protoo lib/client.js lib/stats.js lib/config.js lib/utils.js lib/stream.js lib/tttrtcweb.js\"},\"author\":\"3ttech.cn\",\"license\":\"ISC\",\"dependencies\":{\"babel-runtime\":\"^6.26.0\",\"bowser\":\"^1.9.3\",\"debug\":\"^4.1.1\",\"hark\":\"^1.2.3\",\"random-number\":\"^0.0.9\",\"retry\":\"^0.12.0\",\"websocket\":\"^1.0.28\"},\"devDependencies\":{\"babel-core\":\"^6.26.3\",\"babel-loader\":\"^7.1.1\",\"babel-plugin-transform-runtime\":\"^6.23.0\",\"babel-polyfill\":\"^6.26.0\",\"babel-preset-env\":\"^1.7.0\",\"babel-preset-es2015\":\"^6.24.1\",\"babel-preset-stage-0\":\"^6.24.1\",\"copy-webpack-plugin\":\"^5.0.4\",\"eslint\":\"^5.16.0\",\"eslint-plugin-react\":\"^7.13.0\",\"html-webpack-plugin\":\"^3.2.0\",\"http-server\":\"^0.11.1\",\"jest\":\"^24.9.0\",\"jest-websocket-mock\":\"^1.5.0\",\"mock-socket\":\"^9.0.0\",\"sweetalert2\":\"^8.11.4\",\"webpack\":\"^4.41.0\",\"webpack-cli\":\"^3.2.3\",\"webpack-dev-server\":\"^3.1.14\",\"webpack-jquery-ui\":\"^2.0.1\"},\"files\":[\"lib/\",\"screen/\",\"docs/\",\"README.md\",\"CHANGELOG.md\"]}')},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=g(r(0)),i=g(r(1)),a=g(r(28)),o=g(r(5)),s=g(r(184)),c=g(r(195)),d=g(r(196)),u=g(r(197)),l=(g(r(198)),g(r(199))),p=g(r(200)),f=g(r(201)),m=g(r(205)),h=g(r(206)),v=g(r(207)),_=g(r(209));function g(e){return e&&e.__esModule?e:{default:e}}var y=new o.default(\"Device\"),b=function(){function t(){(0,n.default)(this,t)}return(0,i.default)(t,null,[{key:\"setHandler\",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t._detected=!0,t._handlerClass=e,t._flag=r.flag,t._name=r.name,t._version=r.version,t._bowser=r.bowser||{}}},{key:\"getFlag\",value:function(){return t._detected||t._detect(),t._flag}},{key:\"getName\",value:function(){return t._detected||t._detect(),t._name}},{key:\"getVersion\",value:function(){return t._detected||t._detect(),t._version}},{key:\"getBowser\",value:function(){return t._detected||t._detect(),t._bowser}},{key:\"isSupported\",value:function(){return t._detected||t._detect(),Boolean(t._handlerClass)}},{key:\"_detect\",value:function(){if(t._detected=!0,e.navigator&&\"ReactNative\"===e.navigator.product)t._flag=\"react-native\",t._name=\"ReactNative\",t._version=void 0,t._bowser={},t._handlerClass=_.default;else if(e.navigator&&\"string\"==typeof e.navigator.userAgent){var r=e.navigator.userAgent,n=a.default.detect(r);if(t._flag=void 0,t._name=n.name||void 0,t._version=n.version||void 0,t._bowser=n,t._handlerClass=null,a.default.check({chrome:\"70\",chromium:\"70\"},!0,r))t._flag=\"chrome\",t._handlerClass=s.default;else if(a.default.check({chrome:\"69\",chromium:\"69\"},!0,r))t._flag=\"chrome\",t._handlerClass=c.default;else if(a.default.check({chrome:\"67\",chromium:\"67\"},!0,r))t._flag=\"chrome\",t._handlerClass=d.default;else if(a.default.check({chrome:\"55\",chromium:\"55\"},!0,r))t._flag=\"chrome\",t._handlerClass=u.default;else if(a.default.check({chrome:\"49\",chromium:\"49\"},!0,r)&&e.adapter)t._flag=\"chrome\",t._handlerClass=u.default;else if(a.default.check({firefox:\"65\"},!0,r))t._flag=\"firefox\",t._handlerClass=f.default;else if(a.default.check({firefox:\"59\"},!0,r))t._flag=\"firefox\",t._handlerClass=m.default;else if(a.default.check({firefox:\"50\"},!0,r))t._flag=\"firefox\",t._handlerClass=h.default;else if(a.default.check({safari:\"12.1\"},!0,r)&&\"undefined\"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty(\"currentDirection\"))t._flag=\"safari\",t._handlerClass=l.default;else if(a.default.check({safari:\"11\"},!0,r))t._flag=\"safari\",t._handlerClass=p.default;else if(a.default.check({msedge:\"11\"},!0,r))t._flag=\"msedge\",t._handlerClass=v.default;else if(a.default.check({opera:\"57\"},!0,r))t._flag=\"opera\",t._handlerClass=s.default;else if(a.default.check({opera:\"44\"},!0,r))t._flag=\"opera\",t._handlerClass=u.default;else if(n.chromium||n.blink||n.webkit){y.debug('best effort Chrome based browser detection [name:\"%s\"]',n.name),t._flag=\"chrome\";var i=r.match(/(?:(?:Chrome|Chromium))[ /](\\w+)/i);if(i){var o=Number(i[1]);t._handlerClass=o>=70?s.default:o>=69?c.default:o>=67?d.default:u.default}else t._handlerClass=s.default}t.isSupported()?y.debug('browser supported [flag:%s, name:\"%s\", version:%s, handler:%s]',t._flag,t._name,t._version,t._handlerClass.tag):y.warn(\"browser not supported [name:%s, version:%s]\",t._name,t._version)}else y.warn(\"device not supported\")}},{key:\"Handler\",get:function(){return t._detected||t._detect(),t._handlerClass}}]),t}();t.default=b,b._detected=!1,b._flag=void 0,b._name=void 0,b._version=void 0,b._bowser=void 0,b._handlerClass=null}).call(this,r(38))},function(e,t,r){\"use strict\";t.__esModule=!0;var n,i=r(63),a=(n=i)&&n.__esModule?n:{default:n};t.default=a.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},function(e,t,r){e.exports=!r(23)&&!r(33)((function(){return 7!=Object.defineProperty(r(69)(\"div\"),\"a\",{get:function(){return 7}}).a}))},function(e,t,r){e.exports=r(29)},function(e,t,r){var n=r(34),i=r(40),a=r(126)(!1),o=r(72)(\"IE_PROTO\");e.exports=function(e,t){var r,s=i(e),c=0,d=[];for(r in s)r!=o&&n(s,r)&&d.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~a(d,r)||d.push(r));return d}},function(e,t,r){var n=r(14).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(34),i=r(35),a=r(72)(\"IE_PROTO\"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,a)?e[a]:\"function\"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(25);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var a=e.return;throw void 0!==a&&n(a.call(e)),t}}},function(e,t,r){var n=r(39),i=r(15)(\"iterator\"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[i]===e)}},function(e,t,r){var n=r(25),i=r(47),a=r(15)(\"species\");e.exports=function(e,t){var r,o=n(e).constructor;return void 0===o||null==(r=n(o)[a])?t:i(r)}},function(e,t,r){var n,i,a,o=r(27),s=r(131),c=r(90),d=r(69),u=r(14),l=u.process,p=u.setImmediate,f=u.clearImmediate,m=u.MessageChannel,h=u.Dispatch,v=0,_={},g=function(){var e=+this;if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}},y=function(e){g.call(e.data)};p&&f||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return _[++v]=function(){s(\"function\"==typeof e?e:Function(e),t)},n(v),v},f=function(e){delete _[e]},\"process\"==r(50)(l)?n=function(e){l.nextTick(o(g,e,1))}:h&&h.now?n=function(e){h.now(o(g,e,1))}:m?(a=(i=new m).port2,i.port1.onmessage=y,n=o(a.postMessage,a,1)):u.addEventListener&&\"function\"==typeof postMessage&&!u.importScripts?(n=function(e){u.postMessage(e+\"\",\"*\")},u.addEventListener(\"message\",y,!1)):n=\"onreadystatechange\"in d(\"script\")?function(e){c.appendChild(d(\"script\")).onreadystatechange=function(){c.removeChild(this),g.call(e)}}:function(e){setTimeout(o(g,e,1),0)}),e.exports={set:p,clear:f}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(25),i=r(19),a=r(77);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=a.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){\"use strict\";var n=r(14),i=r(7),a=r(22),o=r(23),s=r(15)(\"species\");e.exports=function(e){var t=\"function\"==typeof i[e]?i[e]:n[e];o&&t&&!t[s]&&a.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(15)(\"iterator\"),i=!1;try{var a=[7][n]();a.return=function(){i=!0},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var a=[7],o=a[n]();o.next=function(){return{done:r=!0}},a[n]=function(){return o},e(a)}catch(e){}return r}},function(e,t,r){var n=r(50);e.exports=Array.isArray||function(e){return\"Array\"==n(e)}},function(e,t,r){var n=r(89),i=r(74).concat(\"length\",\"prototype\");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=r(62),i=r(48),a=r(40),o=r(70),s=r(34),c=r(87),d=Object.getOwnPropertyDescriptor;t.f=r(23)?d:function(e,t){if(e=a(e),t=o(t,!0),c)try{return d(e,t)}catch(e){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t,r){\"use strict\";var n=r(22).f,i=r(57),a=r(78),o=r(27),s=r(75),c=r(52),d=r(68),u=r(92),l=r(99),p=r(23),f=r(61).fastKey,m=r(83),h=p?\"_s\":\"size\",v=function(e,t){var r,n=f(t);if(\"F\"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,d){var u=e((function(e,n){s(e,u,t,\"_i\"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[h]=0,null!=n&&c(n,r,e[d],e)}));return a(u.prototype,{clear:function(){for(var e=m(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[h]=0},delete:function(e){var r=m(this,t),n=v(r,e);if(n){var i=n.n,a=n.p;delete r._i[n.i],n.r=!0,a&&(a.n=i),i&&(i.p=a),r._f==n&&(r._f=i),r._l==n&&(r._l=a),r[h]--}return!!n},forEach:function(e){m(this,t);for(var r,n=o(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!v(m(this,t),e)}}),p&&n(u.prototype,\"size\",{get:function(){return m(this,t)[h]}}),u},def:function(e,t,r){var n,i,a=v(e,t);return a?a.v=r:(e._l=a={i:i=f(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=a),n&&(n.n=a),e[h]++,\"F\"!==i&&(e._i[i]=a)),e},getEntry:v,setStrong:function(e,t,r){d(e,t,(function(e,r){this._t=m(e,t),this._k=r,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?u(0,\"keys\"==e?t.k:\"values\"==e?t.v:[t.k,t.v]):(this._t=void 0,u(1))}),r?\"entries\":\"values\",!r,!0),l(t)}}},function(e,t,r){\"use strict\";var n=r(14),i=r(12),a=r(61),o=r(33),s=r(29),c=r(78),d=r(52),u=r(75),l=r(19),p=r(51),f=r(22).f,m=r(160)(0),h=r(23);e.exports=function(e,t,r,v,_,g){var y=n[e],b=y,I=_?\"set\":\"add\",k=b&&b.prototype,P={};return h&&\"function\"==typeof b&&(g||k.forEach&&!o((function(){(new b).entries().next()})))?(b=t((function(t,r){u(t,b,e,\"_c\"),t._c=new y,null!=r&&d(r,_,t[I],t)})),m(\"add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON\".split(\",\"),(function(e){var t=\"add\"==e||\"set\"==e;e in k&&(!g||\"clear\"!=e)&&s(b.prototype,e,(function(r,n){if(u(this,b,e),!t&&g&&!l(r))return\"get\"==e&&void 0;var i=this._c[e](0===r?0:r,n);return t?this:i}))})),g||f(b.prototype,\"size\",{get:function(){return this._c.size}})):(b=v.getConstructor(t,e,_,I),c(b.prototype,r),a.NEED=!0),p(b,e),P[e]=b,i(i.G+i.W+i.F,P),g||v.setStrong(b,e,_),b}},function(e,t,r){var n=r(60),i=r(164);e.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+\"#toJSON isn't generic\");return i(this)}}},function(e,t,r){\"use strict\";var n=r(12);e.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,r){\"use strict\";var n=r(12),i=r(47),a=r(27),o=r(52);e.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,s,c=arguments[1];return i(this),(t=void 0!==c)&&i(c),null==e?new this:(r=[],t?(n=0,s=a(c,arguments[2],2),o(e,!1,(function(e){r.push(s(e,n++))}))):o(e,!1,r.push,r),new this(r))}})}},function(e,t,r){(function(n){t.log=function(...e){return\"object\"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?\"%c\":\"\")+this.namespace+(this.useColors?\" %c\":\" \")+t[0]+(this.useColors?\"%c \":\" \")+\"+\"+e.exports.humanize(this.diff),!this.useColors)return;const r=\"color: \"+this.color;t.splice(1,0,r,\"color: inherit\");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,e=>{\"%%\"!==e&&(n++,\"%c\"===e&&(i=n))}),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem(\"debug\",e):t.storage.removeItem(\"debug\")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem(\"debug\")}catch(e){}!e&&void 0!==n&&\"env\"in n&&(e=n.env.DEBUG);return e},t.useColors=function(){if(\"undefined\"!=typeof window&&window.process&&(\"renderer\"===window.process.type||window.process.__nwjs))return!0;if(\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/))return!1;return\"undefined\"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||\"undefined\"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=[\"#0000CC\",\"#0000FF\",\"#0033CC\",\"#0033FF\",\"#0066CC\",\"#0066FF\",\"#0099CC\",\"#0099FF\",\"#00CC00\",\"#00CC33\",\"#00CC66\",\"#00CC99\",\"#00CCCC\",\"#00CCFF\",\"#3300CC\",\"#3300FF\",\"#3333CC\",\"#3333FF\",\"#3366CC\",\"#3366FF\",\"#3399CC\",\"#3399FF\",\"#33CC00\",\"#33CC33\",\"#33CC66\",\"#33CC99\",\"#33CCCC\",\"#33CCFF\",\"#6600CC\",\"#6600FF\",\"#6633CC\",\"#6633FF\",\"#66CC00\",\"#66CC33\",\"#9900CC\",\"#9900FF\",\"#9933CC\",\"#9933FF\",\"#99CC00\",\"#99CC33\",\"#CC0000\",\"#CC0033\",\"#CC0066\",\"#CC0099\",\"#CC00CC\",\"#CC00FF\",\"#CC3300\",\"#CC3333\",\"#CC3366\",\"#CC3399\",\"#CC33CC\",\"#CC33FF\",\"#CC6600\",\"#CC6633\",\"#CC9900\",\"#CC9933\",\"#CCCC00\",\"#CCCC33\",\"#FF0000\",\"#FF0033\",\"#FF0066\",\"#FF0099\",\"#FF00CC\",\"#FF00FF\",\"#FF3300\",\"#FF3333\",\"#FF3366\",\"#FF3399\",\"#FF33CC\",\"#FF33FF\",\"#FF6600\",\"#FF6633\",\"#FF9900\",\"#FF9933\",\"#FFCC00\",\"#FFCC33\"],e.exports=r(176)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return\"[UnexpectedJSONParseError]: \"+e.message}}}).call(this,r(175))},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=m(r(17)),i=m(r(2)),a=m(r(0)),o=m(r(1)),s=m(r(3)),c=m(r(4)),d=r(30),u=f(r(53)),l=m(r(31)),p=f(r(42));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}var h=new l.default(\"IPLocation\"),v=null,_=p.iplocationPort,g=p.mediaServerAddress,y=!1,b=r(111),I=b.operation({retries:4,factor:2,minTimeout:1e3,maxTimeout:2e3,randomize:!0}),k=function(e){function t(e,r,n,o,c){(0,a.default)(this,t);var d=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));d._uuid=u.uuid(),h.debug(\"constructor >> this._uuid: \"+d._uuid);var l=\"\";return\"\"===(l=t.privateCloud?v?v.trim():\"\":p.iplocationAddress.trim())?(h.debug(\"constructor << fail - this._uuid: \"+d._uuid+\" - iplocationAddress(\"+l+\") is invalid\"),c({code:-1,message:\"INVALID iplocation address - need set IplocationAddress\"}),(0,s.default)(d)):(d._appId=e,d._url=\"wss://\"+l+\":\"+_+\"/iplocation/\",h.debug(\"constructor - this._uuid: \"+d._uuid+\" this._url: \"+d._url),d._wsjson={eType:1,sSEQID:\"111111111\",mProtocolMsg:{sVersion:\"Test_4.2.0.777\",bLoadBalance:!1,bReConnect:!1,bVipUser:!1,sIDentify:\"7B4FCDBC0914E7182B8EC357F07498F1\",sSecret:\"c052cd055acfabc5\",sVerifyCode:\"abcd\",sAppID:e,nUserID:+r,sClientVer:\"web_3.4\",sConnectID:n,mIpAddrMsg:{bFec:!1,sIp:l,nPort:0}}},d._ws=null,d._closed=!1,d._successcb=o,d._failcb=c,d.reconnectTimes=1,d.firstConnectTime=Date.now(),d.connectedTime=0,d._hasSolve=!1,d._sendRetry={retry:5,timer:0},d._setWebSocket(),h.debug(\"constructor << this._uuid: \"+d._uuid+\" this._url: \"+d._url),d)}return(0,c.default)(t,e),(0,o.default)(t,[{key:\"getIpLocationVar\",value:function(){return this.svcHost}},{key:\"close\",value:function(){this._closed||(h.debug(\"close() - this._uuid: \"+this._uuid),this._closed=!0,null!==this._ws&&(this._ws.close(),this._ws=null))}},{key:\"_setWebSocket\",value:function(){var e=this,t=b.operation(I),r=!1;t.attempt((function(i){e._closed?t.stop():(h.debug(\"_setWebSocket() - this._uuid: \"+e._uuid+\" - connecting... [currentAttempt: \"+i),e._ws=new WebSocket(e._url),e._ws&&(e._ws.onopen=function(){e._closed||(r=!0,e.connectedTime=Date.now(),e._ws.send((0,n.default)(e._wsjson)),e._sendRetry.timer=setInterval((function(){if(!e._hasSolve){if(0===e._sendRetry.retry)return e._ws&&e._ws.close(),t.retry(!0),clearInterval(e._sendRetry.timer),void h.debug(\"this._uuid: \"+e._uuid+\"- iplocation failed - this._sendRetry.retry: \"+e._sendRetry.retry+\" - no more retry\");e._ws&&(h.debug(\"this._uuid: \"+e._uuid+\" - this._ws.send(...) - this._sendRetry.retry: \"+e._sendRetry.retry),e._ws.send((0,n.default)(e._wsjson))),--e._sendRetry.retry}}),500),h.debug(\"this._uuid: \"+e._uuid+\" - WebSocket event [open]\"))},e._ws.onclose=function(n){if(!e._closed)if(h.warn(\"this._uuid: \"+e._uuid+\" - WebSocket event [close] - \"+n.code+\" \"+n.reason),4e3===n.code)e._closed=!0;else{if(r){if(t.stop(),e._closed)return;return void e._setWebSocket()}if(e._closed)return;t.retry(!0)&&++e.reconnectTimes}},e._ws.onerror=function(t){e._closed||h.error(\"this._uuid: \"+e._uuid+\" - WebSocket event [error] - error \"+t.name+\" \"+t.message+\" - nothing todo\")},e._ws.onmessage=function(t){if(!e._closed){var r=JSON.parse(t.data);if(1!==r.eResult)return h.error(\"this._uuid: \"+e._uuid+\" - WebSocket event [onmessage] - iplocation fail - event.data: \"+t.data),e._failcb({code:r.eResult,message:\"\"}),void e.close();var n=r.mProtocolMsg.mIpAddrMsg,i=\"\";i=\"string\"==typeof n.sDomain&&\"\"!==n.sDomain.trim()?n.sDomain:n.sIp.replace(new RegExp(\"[.]\",\"gi\"),\"-\"),e.svcHost={ip:n.sIp,domain:i,port:n.nPort},\"\"!==g&&(e.svcHost={ip:n.sIp,domain:g,port:n.nPort}),e._sendRetry.timer&&(clearInterval(e._sendRetry.timer),e._sendRetry.timer=0),e._hasSolve=!0,h.debug(\"this._uuid: \"+e._uuid+\" - WebSocket event [onmessage] - iplocation succ - event.data: \"+t.data+\" this.svcHost: \"+e.svcHost),e._successcb(e.svcHost,r.mProtocolMsg.mGWIpAddrMsgList),e.close()}}))}))}},{key:\"privateCloud\",get:function(){return y},set:function(e){y=Boolean(e)}},{key:\"info\",get:function(){return{reconnectTimes:this.reconnectTimes,connectedTime:this.connectedTime,firstConnectTime:this.firstConnectTime}}}],[{key:\"iplocTimeout\",set:function(e){if(e){var t=Number(e);t>0&&t<120&&1e3*t}}},{key:\"IplocationAddress\",set:function(e){h.debug(\"this._uuid: \"+this._uuid+\" - set IplocationAddress: \"+e),v=e},get:function(){return v}},{key:\"IplocationPort\",set:function(e){h.debug(\"this._uuid: \"+this._uuid+\" - set IplocationPort: \"+e),/^[1-9][0-9]{2,4}$/.test(e)&&(_=e)},get:function(){return _}},{key:\"MediaServerAddress\",set:function(e){g=e},get:function(){return g}}]),t}(d.EventEmitter);t.default=k},function(e,t,r){e.exports=r(178)},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=I(r(54)),i=I(r(9)),a=I(r(6)),o=I(r(64)),s=I(r(65)),c=I(r(17)),d=I(r(2)),u=I(r(0)),l=I(r(1)),p=I(r(3)),f=I(r(4)),m=I(r(8)),h=I(r(31)),v=r(30),_=b(r(42)),g=b(r(53)),y=b(r(180));function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function I(e){return e&&e.__esModule?e:{default:e}}var k=r(28),P=r(182),S=new h.default(\"Stream\"),w=!1,T=new m.default;e.screen=y;var A=function(t){function r(e){(0,u.default)(this,r);var t=(0,p.default)(this,(r.__proto__||(0,d.default)(r)).call(this)),n=\"\";e.userId?(e.userId=e.userId+\"\",n=e.userId.trim()):e.userID?(e.userID=e.userID+\"\",n=e.userID.trim()):n=\"\",e.userId=n;var i=\"\";if(e.streamId?(e.streamId=e.streamId+\"\",i=e.streamId.trim()):e.streamID?(e.streamID=e.streamID+\"\",i=e.streamID.trim()):i=\"\",e.streamId=i,t._spec=e,t._isMobile=!!k.mobile,t._isSafari=\"safari\"===k.name.toLowerCase(),t._isChrome=\"chrome\"===k.name.toLowerCase(),t._videoMode=t._isChrome?\"clear\":\"smooth\",Boolean(t._spec.codecOptions)&&\"string\"==typeof t._spec.codecOptions.videoMode){var a=t._spec.codecOptions.videoMode.trim();\"smooth\"!==a&&\"clear\"!==a||(t._videoMode=a)}return Boolean(t._spec.codecOptions)&&\"smooth\"!==t._videoMode&&\"clear\"!==t._videoMode&&(\"number\"!=typeof t._spec.codecOptions.minBandwidth||\"number\"!=typeof t._spec.codecOptions.maxBandwidth||\"number\"!=typeof t._spec.codecOptions.startBitrate||t._spec.codecOptions.minBandwidth>=t._spec.codecOptions.maxBandwidth)&&(t._spec.codecOptions=null),S.debug(\"constructor() -- this._spec: \"+(0,c.default)(t._spec)+\" - browser: \"+k.name.toLowerCase()+\"-\"+k.version),t._streamObj=null,t._streamType=\"\",t._spec.streamType&&(t._streamType=t._spec.streamType),t._appData=e.appData?JSON.parse((0,c.default)(e.appData)):{},t._inited=!1,t._uuid=g.uuid(),t._innerStreamID=\"\",t._customStreamID=t._spec.streamId,t._userId=n,t._volume=0,t._isLocalStream=!1,t._webcamProducer=null,t._micProducer=null,t._isAudioOn=!0,t._isVideoOn=!0,t._isAudioPaused=!1,t._isVideoPaused=!1,t._consumerAudio=!1,t._consumerVideo=!1,t._audioPlaying=!1,t._audioPlayStatus=0,t._audio=null,t._videoPlaying=!1,t._videoPlayStatus=0,t._video=null,t._isMicClosed=!1,t._isVideoTrackClosed=!1,t._mediaSourceAudio=!1,t._mediaSourceVideo=!1,t._audioSource=null,t._spec.audioSource&&(t._audioSource=t._spec.audioSource,t._mediaSourceAudio=!0,t._spec.audio=!1),t._videoSource=null,t._spec.videoSource&&(t._videoSource=t._spec.videoSource,t._mediaSourceVideo=!0,t._spec.video=!1,t._spec.screen=!1),t._consumers=new m.default,t._source=t._spec.source,t._subscribed=!1,t._audioSubscribed=!1,t._videoSubscribed=!1,t._ended=!1,t._closed=!1,t._closing=!1,t._default=!1,t._isSubStream=!!t._spec.subStream&&t._spec.subStream,t._keyResolution=\"480p\",t._published=!1,t._publishState=_.PUBLISH_STATE.IDLE,t._videoType=-1,void 0!==t._spec.videoType&&(t._videoType=t._spec.videoType),t._needUpdateVideoStreamBitrate=!1,t._updateConstraints={},t._videoSpec=null,t._specialCameraId=\"\",t._specialMicId=\"\",t._audioProfile=null,t._enableAudioCtx=!1,t._audioCtx=null,t._gainNode=null,t}var h,v,y,b,I,A,E,R;return(0,f.default)(r,t),(0,l.default)(r,[{key:\"init\",value:(R=(0,s.default)(o.default.mark((function t(n,i){var a,d,u,l,p,f,m,h=this;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(S.debug(\"API init() >> this._userId: \"+this._userId+\" this._spec: \"+(0,c.default)(this._spec)),S.funLog({f:\"init\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),\"function\"==typeof n){t.next=5;break}throw S.warn(\"API init() error - onSuccess have to be a function.\"),TypeError(\"onSuccess have to be a function.\");case 5:if(\"function\"==typeof i){t.next=8;break}throw S.warn(\"API init() error - onFailure have to be a function.\"),TypeError(\"onFailure have to be a function.\");case 8:if(\"consumer\"!==this._streamType){t.next=12;break}return S.warn(\"API init() << error - [NONSUPPORT] - this._inited: \"+this._inited+\" - this.userId: \"+this.userId+\" Stream is for [consumer]\"),i(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:\"\",message:\"Stream is for [consumer]\"}),t.abrupt(\"return\");case 12:if(!this._inited){t.next=16;break}return S.warn(\"API init() << error - [STREAM_HAS_ALREADY_INIT] - this._inited: \"+this._inited+\" - this.userId: \"+this.userId+\" Stream is init-ing or inited\"),i(\"STREAM_HAS_ALREADY_INIT\",{code:_.tttErrCode.STREAM_HAS_ALREADY_INIT,name:\"STREAM_HAS_ALREADY_INIT\",origin:\"\",message:\"Stream has Already initialized or init-ing\"}),t.abrupt(\"return\");case 16:if(a=Boolean(this._spec.video),d=Boolean(this._spec.screen),!(+a+ +d>1)){t.next=23;break}return S.warn(\"API init() << error - [INVALID_PARAM] - this.userId: \"+this.userId+\" video/screen: only one can be set as true\"),i(\"INVALID_PARAM\",{code:_.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"Param of createStream: video/screen - only one can be set as true\"}),t.abrupt(\"return\");case 23:if(!k.mobile||!d){t.next=27;break}return S.warn(\"API init() << error - [NONSUPPORT] - screen - this.userId: \"+this.userId+\" Nonsupport on mobile\"),i(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:\"\",message:\"screen - Nonsupport on mobile\"}),t.abrupt(\"return\");case 27:if(this._inited=!0,this._streamType=\"producer\",this._isLocalStream=!0,(Boolean(this._spec.video)||Boolean(this._spec.screen)||Boolean(this._videoSource))&&(this._enableVideoTrack=!0),this._videoType=-1,this._spec.video?this._videoType=0:this._spec.screen?this._videoType=1:this._mediaSourceVideo&&(this._videoType=2),!w){t.next=44;break}if(!this._enableVideoTrack){t.next=41;break}this._audioSource=null,this._mediaSourceAudio=!1,this._spec.audio=!1,S.warn(\"API init() -- this.userId: \"+this.userId+\" hasDefaultStreamOn: \"+w+\" - so Mandatory correction this._spec.audio to false\"),t.next=44;break;case 41:return S.warn(\"API init() << error - [NONSUPPORT] - this.userId: \"+this.userId+\" Only one Audio Producer permissible\"),i(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:\"\",message:\"Only one Audio Producer permissible\"}),t.abrupt(\"return\");case 44:if(this._videoSpec={width:{min:_.videoSpec.width.min,ideal:_.videoSpec.width.ideal,max:_.videoSpec.width.max},height:{min:_.videoSpec.height.min,ideal:_.videoSpec.height.ideal,max:_.videoSpec.height.max},frameRate:{min:_.videoSpec.frameRate.min,ideal:_.videoSpec.frameRate.ideal,max:_.videoSpec.frameRate.max}},u=!1,Boolean(k.mobile)&&void 0!==this._spec.useBackCam&&(this._videoSpec.facingMode=this._spec.useBackCam?{exact:\"environment\"}:\"user\",u=!0),this._spec.attributes&&(this._spec.attributes.resolution&&(\"HD720P\"===this._spec.attributes.resolution.toUpperCase()&&(this._videoSpec.width.ideal=_.videoAttributes.hd720p[0],this._videoSpec.height.ideal=_.videoAttributes.hd720p[1]),\"VGA\"===this._spec.attributes.resolution.toUpperCase()&&(this._videoSpec.width.ideal=_.videoAttributes.vga[0],this._videoSpec.height.ideal=_.videoAttributes.vga[1]),\"SIF\"===this._spec.attributes.resolution.toUpperCase()&&(this._videoSpec.width.ideal=_.videoAttributes.sif[0],this._videoSpec.height.ideal=_.videoAttributes.sif[1]),void 0!==this._spec.attributes.width&&void 0!==this._spec.attributes.height&&(this._videoSpec.width.ideal=this._spec.attributes.width,this._videoSpec.height.ideal=this._spec.attributes.height)),this._spec.attributes.minFrameRate&&this._spec.attributes.maxFrameRate&&(this._videoSpec.frameRate.min=this._spec.attributes.minFrameRate,this._videoSpec.frameRate.max=this._spec.attributes.maxFrameRate,void 0!==this._spec.attributes.idealFrameRate?this._videoSpec.frameRate.ideal=this._spec.attributes.idealFrameRate:this._videoSpec.frameRate.ideal=Math.floor((this._spec.attributes.maxFrameRate-this._spec.attributes.minFrameRate)/2+this._spec.attributes.minFrameRate)),this._spec.attributes.videoProfile&&(l=this._getResolutionByVideoProfile(this._spec.attributes.videoProfile),this._videoSpec.width.ideal=l.width,this._videoSpec.height.ideal=l.height)),p=null,!this._spec.video||!this._spec.audio){t.next=55;break}p={video:this._videoSpec},this._spec.microphoneId&&\"\"!==this._spec.microphoneId.trim()?(p.audio={deviceId:{exact:this._spec.microphoneId.trim()},sampleRate:_.audioSpec.sampleRate,channelCount:_.audioSpec.channelCount},this._specialMicId=this._spec.microphoneId.trim()):p.audio=!0,!u&&this._spec.cameraId&&\"\"!==this._spec.cameraId.trim()?(p.video.deviceId={exact:this._spec.cameraId.trim()},delete p.video.facingMode,this._specialCameraId=this._spec.cameraId.trim()):delete p.video.deviceId,t.next=75;break;case 55:if(!this._spec.audio||this._spec.screen||this._spec.video){t.next=60;break}p={video:!1},this._spec.microphoneId&&\"\"!==this._spec.microphoneId.trim()?(p.audio={deviceId:{exact:this._spec.microphoneId.trim()},sampleRate:_.audioSpec.sampleRate,channelCount:_.audioSpec.channelCount},this._specialMicId=this._spec.microphoneId.trim()):p.audio=!0,t.next=75;break;case 60:if(!this._spec.video||this._spec.audio||this._spec.screen){t.next=65;break}p={audio:!1,video:this._videoSpec},!u&&this._spec.cameraId&&\"\"!==this._spec.cameraId.trim()?(p.video.deviceId={exact:this._spec.cameraId.trim()},delete p.video.facingMode,this._specialCameraId=this._spec.cameraId.trim()):delete p.video.deviceId,t.next=75;break;case 65:if(!this._spec.screen){t.next=75;break}if(f=!0,\"chrome\"===k.name.toLowerCase()&&parseInt(k.version,10)<72&&(f=!1),!f){t.next=73;break}return t.next=71,this._startScreenCapture().then(function(){var e=(0,s.default)(o.default.mark((function e(t){var a;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h.streamObj=t,h._onEventScreenStreamEnded(t),!Boolean(h._spec.audio)||w){e.next=15;break}return e.prev=3,e.next=6,h._createAudioTrack(h._spec.microphoneId);case 6:a=e.sent,h.audioTracks=a,e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(3),S.warn(\"API init() << fail - [DEVICE_EXCEPTION] - _startScreenCapture() error - this.userId: \"+h.userId+\" _createAudioTrack fail - \"+e.t0.name+\" \"+e.t0.message),i(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.t0.name,message:e.t0.name+\" \"+e.t0.message}),e.abrupt(\"return\");case 15:return h._innerStreamID=r._genStreamId(!h.hasAudio(),h.userId,h.userId+\":\"+h.userId+\"_0\",0,h,h._isSubStream),w||(w=\"\"+h.getId()==\"\"+h.userId),S.debug(\"API init() _startScreenCapture() << success - this.userId: \"+h.userId+\" this.streamId: \"+h.getId()),n(),e.abrupt(\"return\");case 20:case\"end\":return e.stop()}}),e,h,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){S.warn(\"API init() _startScreenCapture() << error - [DEVICE_EXCEPTION] - this.userId: \"+h.userId+\" \"+e.name+\" \"+e.message),i(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.name,message:e.name+\" \"+e.message})}));case 71:t.next=74;break;case 73:window.getScreenId?window.getScreenId((function(e,t,a){if(S.debug(\"API init() getScreenId() - this.userId: \"+h.userId+\" sourceId: \"+t+\" screen_constraints: \"+(0,c.default)(a)),\"firefox\"!==t){if(a={video:{mandatory:{chromeMediaSource:\"screen\",maxWidth:1920,maxHeight:1080,minAspectRatio:1.77}}},\"permission-denied\"===e)return S.debug(\"API init() getScreenId() << fail - [PERMISSION_DENIED] - this.userId: \"+h.userId+\" Permission is denied\"),void i(\"PERMISSION_DENIED\",{code:_.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:e,message:\"getScreen - Permission is denied\"});if(\"not-chrome\"===e)return S.debug(\"API init() getScreenId() << fail - [NONSUPPORT] - this.userId: \"+h.userId+\" Please use chrome\"),void i(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:e,message:\"Please use chrome\"});!e&&t&&(a.video.mandatory.chromeMediaSource=\"desktop\",a.video.mandatory.chromeMediaSourceId=t)}var d;navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia(a,(d=(0,s.default)(o.default.mark((function e(t){var s;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h.streamObj=t,h._onEventScreenStreamEnded(t),!Boolean(h._spec.audio)||w){e.next=15;break}return e.prev=3,e.next=6,h._createAudioTrack(h._spec.microphoneId);case 6:s=e.sent,h.audioTracks=s,e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(3),S.warn(\"API init() getScreenId() << error - [DEVICE_EXCEPTION] - this.userId: \"+h.userId+\" \"+e.t0.name+\" \"+e.t0.messsage),i(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.t0.name,message:e.t0.name+\" \"+e.t0.message}),e.abrupt(\"return\");case 15:return h._innerStreamID=r._genStreamId(!h.hasAudio(),h.userId,h.userId+\":\"+h.userId+\"_0\",0,h,h._isSubStream),w||(w=\"\"+h.getId()==\"\"+h.userId),S.debug(\"API init() getScreenId() << success - this.userId: \"+h.userId+\" this.streamId: \"+h.getId()+\" screen_constraints: \"+(0,c.default)(a)),n(),e.abrupt(\"return\");case 20:case\"end\":return e.stop()}}),e,h,[[3,10]])}))),function(e){return d.apply(this,arguments)}),(function(e){S.warn(\"API init() getScreenId() << fail - [DEVICE_EXCEPTION] - this.userId: \"+h.userId+\" \"+e.name+\" \"+e.message+\" -- constraints: \"+(0,c.default)(a)),i(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.name,message:e.name+\" \"+e.message})}))}),this._spec.audio):S.warn(\"API init() << fail - getScreenId is undefined\");case 74:return t.abrupt(\"return\");case 75:if(!this._spec.video&&!this._spec.audio){t.next=80;break}return navigator.mediaDevices.getUserMedia(p).then((function(e){if(h._enableAudioCtx&&!h._isSafari){var t=e.getVideoTracks();if(e.getAudioTracks().length>0){if(!h._audioCtx){var i=window.AudioContext||window.webkitAudioContext;h._audioCtx=new i}if(h._audioCtx&&!h._gainNode&&(h._gainNode=h._audioCtx.createGain(),h._gainNode.gain.value=1),h._audioCtx&&h._gainNode){var a=h._audioCtx.createMediaStreamSource(e);h.target=h._audioCtx.createMediaStreamDestination(),a.connect(h._gainNode),h._gainNode.connect(h.target),t.length>0&&h.target.stream.addTrack(t[0]),h.streamObj=h.target.stream}else h.streamObj=e}else h.streamObj=e}else h.streamObj=e;h._onEventStreamEnded(h.streamObj),h._innerStreamID=r._genStreamId(!h.hasAudio(),h.userId,h.userId+\":\"+h.userId+\"_0\",0,h,h._isSubStream),w||(w=\"\"+h.getId()==\"\"+h.userId),S.debug(\"API init() getUserMedia() << success - this.userId: \"+h.userId+\" this.streamId: \"+h.getId()+\" constraints: \"+(0,c.default)(p)),n()})).catch((function(e){S.warn(\"API init() getUserMedia << fail - [DEVICE_EXCEPTION] - this.userId: \"+h.userId+\" \"+e.name+\" \"+e.message+\" -- constraints: \"+(0,c.default)(p)),i(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.name,message:e.name+\" \"+e.message})})),t.abrupt(\"return\");case 80:if(!this._mediaSourceAudio&&!this._mediaSourceVideo){t.next=84;break}return m={audio:!0,video:!1},navigator.mediaDevices.getUserMedia(m).then((function(e){h._onEventStreamEnded(e);var t=e.getAudioTracks(),i=null;t.length>0&&(i=t[0])&&(i.onended=null,S.debug(\"API init() <WARN> - oldTrack.kind: \"+i.kind+\" streamId: \"+h.getId()+\" - call oldTrack.stop()\"),i.stop(),e.removeTrack(i)),h._audioSource&&e.addTrack(h._audioSource),h._videoSource&&e.addTrack(h._videoSource),h.streamObj=e,h._innerStreamID=r._genStreamId(!h.hasAudio(),h.userId,h.userId+\":\"+h.userId+\"_0\",0,h,h._isSubStream),w||(w=\"\"+h.getId()==\"\"+h.userId),S.debug(\"API init() getUserMedia() for [mediasource] << success - this.userId: \"+h.userId+\" this.streamId: \"+h.getId()+\" constraints: \"+(0,c.default)(m)),n()})).catch((function(e){S.warn(\"API init() getUserMedia() for [mediasource] << fail - [DEVICE_EXCEPTION] - getUserMedia fail - this.userId: \"+h.userId+\" \"+e.name+\" \"+e.message+\" -- constraints: \"+(0,c.default)(m)),i(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.name,message:e.name+\" \"+e.message})})),t.abrupt(\"return\");case 84:case\"end\":return t.stop()}}),t,this)}))),function(e,t){return R.apply(this,arguments)})},{key:\"_createAudioTrack\",value:function(e){var t=this;if(!this._isLocalStream)return a.default.reject(new Error(\"_createAudioTrack - non-localStream\"));var r={video:!1};return e&&\"\"!==e.trim()?(this._spec.microphoneId=e.trim(),r.audio={deviceId:{exact:this._spec.microphoneId},sampleRate:_.audioSpec.sampleRate,channelCount:_.audioSpec.channelCount},this._specialMicId=this._spec.microphoneId):r.audio=!0,navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,new a.default((function(e,n){navigator.mediaDevices.getUserMedia(r).then((function(r){if(t._enableAudioCtx&&!t._isSafari){if(!t._audioCtx){var n=window.AudioContext||window.webkitAudioContext;t._audioCtx=new n}if(t._audioCtx&&!t._gainNode&&(t._gainNode=t._audioCtx.createGain(),t._gainNode.gain.value=1),t._audioCtx&&t._gainNode){var i=t._audioCtx.createMediaStreamSource(r);t.target=t._audioCtx.createMediaStreamDestination(),i.connect(t._gainNode),t._gainNode.connect(t.target);var a=t.target.stream.getAudioTracks()[0];e(a)}else{var o=r.getAudioTracks()[0];e(o)}}else{var s=r.getAudioTracks()[0];e(s)}})).catch((function(e){n(e)}))}))}},{key:\"_createCameraVideoTrack\",value:function(e){var t=this;if(!this._isLocalStream)return a.default.reject(new Error(\"non-localStream\"));var r={audio:!1,video:this._videoSpec};return e&&\"\"!==e.trim()&&(this._spec.cameraId=e.trim(),r.video.deviceId={exact:this._spec.cameraId},delete r.video.facingMode,this._specialCameraId=this._spec.cameraId),navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,new a.default((function(e,n){navigator.mediaDevices.getUserMedia(r).then((function(r){var i=r.getVideoTracks();if(i&&i.length>0){var a=i[0];a?(t._onEventStreamEnded(r),e(a)):n(new Error(\"no video track\"))}else n(new Error(\"no video track\"))})).catch((function(e){n(e)}))}))}},{key:\"_createScreenVideoTrack\",value:function(){var e,t=this,r=!0;return\"chrome\"===k.name.toLowerCase()&&parseInt(k.version,10)<72&&(r=!1),r?this._startScreenCapture().then((e=(0,s.default)(o.default.mark((function e(r){var n,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=r.getVideoTracks())&&n.length>0)){e.next=11;break}if(!(i=n[0])){e.next=8;break}return t._onEventScreenStreamEnded(r),e.abrupt(\"return\",a.default.resolve(i));case 8:return e.abrupt(\"return\",a.default.reject(new Error(\"no video track\")));case 9:e.next=12;break;case 11:return e.abrupt(\"return\",a.default.reject(new Error(\"no video track\")));case 12:case\"end\":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)})).catch((function(e){return a.default.reject(new Error(\"_createScreenVideoTrack() error - \"+e.name+\" \"+e.message))})):new a.default((function(e,r){if(!window.getScreenId)return r(new Error(\"_createScreenVideoTrack() getScreenId is undefined\"));window.getScreenId((function(n,i,a){if(S.debug(\"_createScreenVideoTrack() - sourceId: \"+i+\" screen_constraints: \"+(0,c.default)(a)),\"firefox\"!==i){if(a={video:{mandatory:{chromeMediaSource:\"screen\",maxWidth:1920,maxHeight:1080,minAspectRatio:1.77}}},\"permission-denied\"===n)return r(new Error(\"_createScreenVideoTrack() - Permission is denied\"));if(\"not-chrome\"===n)return r(new Error(\"_createScreenVideoTrack() - Please use chrome\"));!n&&i&&(a.video.mandatory.chromeMediaSource=\"desktop\",a.video.mandatory.chromeMediaSourceId=i)}var d;navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia(a,(d=(0,s.default)(o.default.mark((function n(i){var a,s;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((a=i.getVideoTracks())&&a.length>0)){n.next=11;break}if(!(s=a[0])){n.next=8;break}return t._onEventScreenStreamEnded(i),n.abrupt(\"return\",e(s));case 8:return n.abrupt(\"return\",r(new Error(\"no video track\")));case 9:n.next=12;break;case 11:return n.abrupt(\"return\",r(new Error(\"no video track\")));case 12:case\"end\":return n.stop()}}),n,t)}))),function(e){return d.apply(this,arguments)}),(function(e){return r(e)}))}),!1)}))}},{key:\"_speechEvents\",value:function(e){var t=this;if(!this._audioCtx){var r=window.AudioContext||window.webkitAudioContext;this._audioCtx=new r}this._audioCtx&&(this._speach=new P(e,{threshold:-65,audioContext:this._audioCtx}),this._speach.on(\"volume_change\",(function(e,r){e<r?t._volume=0:(t._volume=Math.round(-100*(e-r)/r),t._volume>100&&(t._volume=100)),t.emit(\"volume-change\",{userID:t.userID,volume:t._volume})})),this._speach.on(\"speaking\",(function(){t.emit(\"speaking\",{userID:t.userID})})),this._speach.on(\"stopped_speaking\",(function(){t._volume=0,t.emit(\"stopped-speaking\",{userID:t.userID})})))}},{key:\"getId\",value:function(){return this._isLocalStream?this._innerStreamID:this._customStreamID}},{key:\"hasConsumer\",value:function(){return this._consumers.size>0}},{key:\"hasAudioConsumer\",value:function(){var e=!0,t=!1,r=void 0;try{for(var a,o=(0,i.default)(this._consumers);!(e=(a=o.next()).done);e=!0){var s=(0,n.default)(a.value,2);s[0];if(\"audio\"===s[1].kind)return!0}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}return!1}},{key:\"attachAudioConsumer\",value:function(e){var t=this;if(e){this._consumerAudio=!0,this._consumers.set(e.id,e),this.audioTracks=e.track;var r={id:e.track.id,label:e.track.label,kind:e.track.kind,enabled:e.track.enabled,muted:e.track.muted,readyState:e.track.readyState};e.track.onended=function(r){S.debug(\"consumer.track.onended - streamId: \"+t.getId()+\" consumer.track.kind: \"+e.track.kind+\" - \"+r.name+\" \"+r.message);var n=(new Error).stack;S.debug(\"consumer.track.onended - stack: \"+n)},S.debug(\"attachAudioConsumer() - streamId: \"+this.getId()+\" consumer.kind: \"+e.kind+\" consumer.id: \"+e.id+\" consumer.track-info: \"+(0,c.default)(r)+\" - this._consumers: \"+this._consumers.size)}}},{key:\"detachAudioConsumer\",value:function(e){e&&(this._audioPlaying=!1,this._audioPlayStatus=0,this._consumerAudio=!1,this._consumers.delete(e.id),S.debug(\"detachAudioConsumer() - streamId: \"+this.getId()+\" consumer.kind: \"+e.kind+\" consumer.id: \"+e.id+\" - this._consumers: \"+this._consumers.size))}},{key:\"hasVideoConsumer\",value:function(){var e=!0,t=!1,r=void 0;try{for(var a,o=(0,i.default)(this._consumers);!(e=(a=o.next()).done);e=!0){var s=(0,n.default)(a.value,2);s[0];if(\"video\"===s[1].kind)return!0}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}return!1}},{key:\"attachVideoConsumer\",value:function(e){var t=this;if(e){this._consumerVideo=!0,this._consumers.set(e.id,e),this.videoTracks=e.track;var r={id:e.track.id,label:e.track.label,kind:e.track.kind,enabled:e.track.enabled,muted:e.track.muted,readyState:e.track.readyState};e.track.onended=function(r){S.debug(\"consumer.track.onended - streamId: \"+t.getId()+\" consumer.track.kind: \"+e.track.kind+\" - \"+r.name+\" \"+r.message)},S.debug(\"attachVideoConsumer() - streamId: \"+this.getId()+\" consumer.kind: \"+e.kind+\" consumer.id: \"+e.id+\" consumer.track-info: \"+(0,c.default)(r)+\" - this._consumers: \"+this._consumers.size)}}},{key:\"detachVideoConsumer\",value:function(e){e&&(this._videoPlaying=!1,this._videoPlayStatus=0,this._consumerVideo=!1,this._consumers.delete(e.id),S.debug(\"detachVideoConsumer() - streamId: \"+this.getId()+\" consumer.kind: \"+e.kind+\" consumer.id: \"+e.id+\" - this._consumers: \"+this._consumers.size))}},{key:\"getAttributes\",value:function(){}},{key:\"getAudioLevel\",value:function(){return this._volume}},{key:\"hasVideo\",value:function(){return!!this._streamObj&&this._streamObj.getVideoTracks().length>0}},{key:\"hasAudio\",value:function(){return!!this._streamObj&&this._streamObj.getAudioTracks().length>0}},{key:\"attachVideoProducer\",value:function(e){this._isLocalStream?this._webcamProducer=e:S.warn(\"API attachVideoProducer() error - streamId: \"+this.getId()+\" This is not local stream\")}},{key:\"detachVideoProducer\",value:function(){this._isLocalStream?this._webcamProducer=null:S.warn(\"API detachVideoProducer() error - streamId: \"+this.getId()+\" This is not local stream\")}},{key:\"attachAudioProducer\",value:function(e){this._isLocalStream?this._micProducer=e:S.warn(\"API attachAudioProducer() error - streamId: \"+this.getId()+\" This is not local stream\")}},{key:\"detachAudioProducer\",value:function(){this._isLocalStream?this._micProducer=null:S.warn(\"API detachAudioProducer() error - streamId: \"+this.getId()+\" This is not local stream\")}},{key:\"switchDevice\",value:function(t,r,n,i){var a=this;if(S.debug(\"API switchDevice() >> streamId: \"+this.getId()+\" type: \"+t+\" deviceId: \"+r),S.funLog({f:\"switchDevice\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"type-\"+t+\",deviceId-\"+r}),\"function\"!=typeof n)throw S.warn(\"API switchDevice() << error - onSuccess have to be a function.\"),TypeError(\"onSuccess have to be a function.\");if(\"function\"!=typeof i)throw S.warn(\"API switchDevice() << error - onFailure have to be a function.\"),TypeError(\"onFailure have to be a function.\");if(!this._isLocalStream)return S.warn(\"API switchDevice() << error - [NONSUPPORT] - streamId: \"+this.getId()+\" This is not local stream\"),void i(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:\"\",message:\"This is not localStream\"});if(!r||\"\"==r.trim())return S.warn(\"API switchDevice() << error - [INVALID_PARAM] - streamId: \"+this.getId()+\" DeviceId is invalid\"),void i(\"INVALID_PARAM\",{code:_.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [deviceId] is invalid\"});if(\"audio\"!==t&&\"video\"!==t)return S.warn(\"API switchDevice() << error - [INVALID_PARAM] - streamId: \"+this.getId()+\" type must be [audio|video]\"),void i(\"INVALID_PARAM\",{code:_.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [type] is invalid - must be : audio or video\"});var o=r.trim();\"audio\"!==t?\"video\"!==t||this._closeVideo().then((function(){return a._openVideo(o)})).then((function(){S.debug(\"API switchDevice() << succ - streamId: \"+a.getId()+\" type: \"+t+\" devId: \"+o),n()})).catch((function(e){S.warn(\"API switchDevice() << fail - [DEVICE_EXCEPTION] - streamId: \"+a.getId()+\" type: \"+t+\" devId: \"+o+\" - \"+e.name+\" \"+e.message),i(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.name,message:e.name+\" \"+e.message})})):this._closeMic().then((function(){return a._openMic(o)})).then((function(){S.debug(\"API switchDevice() << succ - streamId: \"+a.getId()+\" type: \"+t+\" devId: \"+o),n()})).catch((function(e){S.warn(\"API switchDevice() << fail - [DEVICE_EXCEPTION] - streamId: \"+a.getId()+\" type: \"+t+\" devId: \"+o+\" - \"+e.name+\" \"+e.message),i(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.name,message:e.name+\" \"+e.message})}))}},{key:\"_openVideo\",value:function(e){var t=this;return this.isVideoTrackClosed?this._isLocalStream?a.default.resolve().then((0,s.default)(o.default.mark((function r(){var n;return o.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=null,0!==t.videoType){r.next=7;break}return r.next=4,t._createCameraVideoTrack(e&&\"\"!==e.trim()?e:t._spec.cameraId);case 4:n=r.sent,r.next=14;break;case 7:if(1!==t.videoType){r.next=13;break}return r.next=10,t._createScreenVideoTrack();case 10:n=r.sent,r.next=14;break;case 13:return r.abrupt(\"return\",a.default.resolve());case 14:if(t.videoTracks=n,t._isVideoTrackClosed=!1,!t._webcamProducer){r.next=19;break}return r.next=19,t._webcamProducer.replaceTrack(n);case 19:return r.abrupt(\"return\",a.default.resolve());case 20:case\"end\":return r.stop()}}),r,t)})))).catch((function(e){return a.default.reject(e)})):a.default.reject(new Error(\"non-localStream\")):a.default.resolve()}},{key:\"_closeVideo\",value:function(){var e=this;return this._isLocalStream?this._streamObj?a.default.resolve().then((function(){return 0!==e.videoType&&1!==e.videoType||(e._streamObj&&e._streamObj.getVideoTracks().forEach((function(t){t.onended=null,S.debug(\"_closeVideo() <WARN> - track.kind: \"+t.kind+\" streamId: \"+e.getId()+\" - call track.stop()\"),t.stop(),e._streamObj.removeTrack(t)})),e._isVideoTrackClosed=!0,e._webcamProducer&&e._webcamProducer.stopTrack()),a.default.resolve()})).catch((function(e){return a.default.reject(e)})):a.default.reject(new Error(\"stream._streamObj is null\")):a.default.reject(new Error(\"non-localStream\"))}},{key:\"_openMic\",value:function(e){var t=this;return this._spec.audio?this.isMicClosed?this._isLocalStream?a.default.resolve().then((0,s.default)(o.default.mark((function r(){var n;return o.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._createAudioTrack(e&&\"\"!==e.trim()?e:t._spec.microphoneId);case 2:if(n=r.sent,t.audioTracks=n,t._isMicClosed=!1,!t._micProducer){r.next=14;break}return r.prev=6,r.next=9,t._micProducer.replaceTrack(n);case 9:r.next=14;break;case 11:return r.prev=11,r.t0=r.catch(6),r.abrupt(\"return\",a.default.reject(r.t0));case 14:return r.abrupt(\"return\",a.default.resolve(n));case 15:case\"end\":return r.stop()}}),r,t,[[6,11]])})))).catch((function(e){return a.default.reject(e)})):a.default.reject(new Error(\"non-localStream\")):a.default.reject(new Error(\"lack the conditions\")):a.default.reject(new Error(\"not mic stream\"))}},{key:\"_closeMic\",value:function(){var e=this;return this._spec.audio?this._isLocalStream?this._streamObj?a.default.resolve().then((function(){return e._streamObj&&e._streamObj.getAudioTracks().forEach((function(t){t.onended=null,S.debug(\"_closeMic() <WARN> - track.kind: \"+t.kind+\" streamId: \"+e.getId()+\" - call track.stop()\"),t.stop(),e._streamObj.removeTrack(t)})),e._isMicClosed=!0,e._micProducer&&e._micProducer.stopTrack(),a.default.resolve()})).catch((function(e){return a.default.reject(e)})):a.default.reject(new Error(\"stream._streamObj is null\")):a.default.reject(new Error(\"non-localStream\")):a.default.reject(new Error(\"not mic stream\"))}},{key:\"enableVideo\",value:(E=(0,s.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(S.debug(\"API enableVideo() >> this._userId: \"+this._userId+\" streamId: \"+this.getId()),S.funLog({f:\"enableVideo\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),this._isLocalStream){t.next=5;break}return S.warn(\"API enableVideo() << error - streamId: \"+this.getId()+\" non-localStream\"),t.abrupt(\"return\");case 5:if(this._isVideoOn=!0,this._published&&(S.clbLog({f:\"resume-video\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+this.streamId}),this.emit(\"resume-video\",{stream:this})),!this._video){t.next=16;break}return t.prev=8,t.next=11,this._video.play();case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(8),S.warn(\"API enableVideo() << fail - this._video.play() error - \"+t.t0.name+\" \"+t.t0.message+\" - this._userId: \"+this._userId+\" streamId: \"+this.getId());case 16:case\"end\":return t.stop()}}),t,this,[[8,13]])}))),function(){return E.apply(this,arguments)})},{key:\"disableVideo\",value:function(){S.debug(\"API disableVideo() >> this._userId: \"+this._userId+\" streamId: \"+this.getId()),S.funLog({f:\"disableVideo\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),this._isLocalStream?(this._video&&this._video.pause(),this._isVideoOn=!1,this._published&&(S.clbLog({f:\"pause-video\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+this.streamId}),this.emit(\"pause-video\",{stream:this}),S.debug(\"API disableVideo() << success this._userId: \"+this._userId+\" streamId: \"+this.getId()))):S.warn(\"API disableVideo() << error - streamId: \"+this.getId()+\" non-localStream\")}},{key:\"enableAudio\",value:function(){S.debug(\"API enableAudio() >> this._userId: \"+this._userId+\" streamId: \"+this.getId()),S.funLog({f:\"enableAudio\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),this._isLocalStream?(this._isAudioOn=!0,this._published&&(S.clbLog({f:\"resume-audio\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+this.streamId}),this.emit(\"resume-audio\",{stream:this}))):S.warn(\"API enableAudio() << error - streamId: \"+this.getId()+\" non-localStream\")}},{key:\"disableAudio\",value:function(){S.debug(\"API disableAudio() >> this._userId: \"+this._userId+\" streamId: \"+this.getId()+\" this._published: \"+this._published),S.funLog({f:\"enableAudio\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),this._isLocalStream?(this._isAudioOn=!1,this._published&&(S.clbLog({f:\"pause-audio\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+this.streamId}),this.emit(\"pause-audio\",{stream:this}))):S.warn(\"API disableAudio() << error - streamId: \"+this.getId()+\" non-localStream\")}},{key:\"enableVideoAndAudio\",value:(A=(0,s.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(S.debug(\"API enableVideoAndAudio() >> this._userId: \"+this._userId+\" streamId: \"+this.getId()),S.funLog({f:\"enableVideoAndAudio\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),this._isLocalStream){t.next=5;break}return S.warn(\"API enableVideoAndAudio() << error - non-localStream\"),t.abrupt(\"return\");case 5:if(this._isAudioOn=!0,this._isVideoOn=!0,!this._video){t.next=16;break}return t.prev=8,t.next=11,this._video.play();case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(8),S.warn(\"API enableVideoAndAudio() << fail - this._video.play() error - \"+t.t0.name+\" \"+t.t0.message+\" - this._userId: \"+this._userId+\" streamId: \"+this.getId());case 16:this._published&&(S.clbLog({f:\"resume-audio,resume-video\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+this.streamId}),this.emit(\"resume-audio\",{stream:this}),this.emit(\"resume-video\",{stream:this}));case 17:case\"end\":return t.stop()}}),t,this,[[8,13]])}))),function(){return A.apply(this,arguments)})},{key:\"disableVideoAndAudio\",value:function(){S.debug(\"API disableVideoAndAudio() >> this._userId: \"+this._userId+\" streamId: \"+this.getId()),S.funLog({f:\"disableVideoAndAudio\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),this._isLocalStream?(this._isAudioOn=!1,this._isVideoOn=!1,this._video&&this._video.pause(),this._published&&(S.clbLog({f:\"pause-audio,pause-video\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+this.streamId}),this.emit(\"pause-audio\",{stream:this}),this.emit(\"pause-video\",{stream:this}))):S.warn(\"API disableVideoAndAudio() << error - non-localStream\")}},{key:\"setAudioProfile\",value:function(t){(this._isMobile||this._isSafari)&&\"isac32\"===t&&(t=\"music_standard\");var r=_.audioProfileSpec.get(t);this._audioProfile=r||null,S.debug(\"API setAudioProfile() - streamId: \"+this.getId()+\" profile: \"+t+\" \"+(0,c.default)(this._audioProfile)),S.funLog({f:\"setAudioProfile\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"profile-\"+t})}},{key:\"getAudioProfile\",value:function(){return this._audioProfile}},{key:\"setVideoProfile\",value:function(t,r,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(\"function\"!=typeof r)throw S.warn(\"API setVideoProfile() error - onSuccess have to be a function.\"),TypeError(\"onSuccess have to be a function.\");if(\"function\"!=typeof n)throw S.warn(\"API setVideoProfile() error - onFailure have to be a function.\"),TypeError(\"onFailure have to be a function.\");if(S.debug(\"API setVideoProfile() >> this._userId: \"+this._userId+\" streamId: \"+this.getId()+\" videoProfile: \"+t),S.funLog({f:\"setVideoProfile\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"videoProfile-\"+t}),!this._isLocalStream)return S.warn(\"API setVideoProfile() << error - [NONSUPPORT] - streamId: \"+this.getId()+\" non-localStream\"),void n(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:\"\",message:\"only local stream can set video profile\"});if(!this._streamObj)return S.warn(\"API setVideoProfile() << error - [NOT_READY] - streamId: \"+this.getId()+\" this._streamObj is null, please init it at first\"),void n(\"NOT_READY\",{code:_.tttErrCode.NOT_READY,name:\"NOT_READY\",origin:\"\",message:\"stream is null, please init it at first\"});var d=this._streamObj.getVideoTracks();if(d.length<=0||!d[0])return S.warn(\"API setVideoProfile() << error - [NONSUPPORT] - streamId: \"+this.getId()+\" No video track\"),void n(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:\"\",message:\"there is no video track\"});var u=d[0],l=void 0,p=this._getResolutionByVideoProfile(t),f=p.width,m=p.height;if(l={width:f,height:m},a){if(this._videoMode=\"\",Boolean(this._spec.codecOptions)&&\"string\"==typeof this._spec.codecOptions.videoMode){var h=this._spec.codecOptions.videoMode.trim();\"smooth\"!==h&&\"clear\"!==h||(this._videoMode=h)}var v=!1;if(v=\"number\"==typeof a.minBandwidth&&\"number\"==typeof a.maxBandwidth&&\"number\"==typeof a.startBitrate&&!(a.minBandwidth>=a.maxBandwidth),\"smooth\"!==this._videoMode&&\"clear\"!==this._videoMode&&!v)return S.warn(\"API setVideoProfile() << error - [INVALID_PARAM] - streamId: \"+this.getId()+\" codecOptions parameters invalid\"),void n(\"INVALID_PARAM\",{code:_.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [codecOptions] is invalid - minBandwidth > = maxBandwidth\"});v?(this._spec.codecOptions.minBitrate=a.minBitrate,this._spec.codecOptions.startBitrate=a.startBitrate,this._spec.codecOptions.maxBitrate=a.maxBitrate):(this._spec.codecOptions.minBitrate=0,this._spec.codecOptions.startBitrate=0,this._spec.codecOptions.maxBitrate=0)}u.applyConstraints(l).then((0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i._videoSetting=u.getSettings(),i._getVideoActualResolution(i._videoSetting),!i._published){e.next=8;break}if(!i._webcamProducer){e.next=6;break}return e.next=6,i._webcamProducer.updateTrack(u,l,{idealBandwidth:i.idealBandwidth,maxBandwidth:i.maxBandwidth,minBandwidth:i.minBandwidth});case 6:e.next=10;break;case 8:i._updateConstraints=l,i._needUpdateVideoStreamBitrate=!0;case 10:return S.debug(\"API setVideoProfile() << success - track.applyConstraints ok -- constraints: \"+(0,c.default)(l)),r(\"applyConstraint success\"),e.abrupt(\"return\");case 13:case\"end\":return e.stop()}}),e,i)})))).catch((function(e){S.warn(\"API setVideoProfile() << error - [DEVICE_EXCEPTION] - track.applyConstraints fail - \"+e.name+\" \"+e.message),n(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.name,message:e.name+\" \"+e.message})}))}},{key:\"getVideoProfile\",value:function(){return this.videoResolution}},{key:\"setScreenProfile\",value:function(){}},{key:\"setAudioOutput\",value:function(t,r,n){var i=this;if(S.debug(\"API setAudioOutput() - streamId: \"+this.getId()+\" deviceId: \"+t),S.funLog({f:\"setAudioOutput\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"deviceId-\"+t}),\"function\"!=typeof r)throw S.warn(\"API setAudioOutput() error - onSuccess have to be a function.\"),TypeError(\"onSuccess have to be a function.\");if(\"function\"!=typeof n)throw S.warn(\"API setAudioOutput() error - onFailure have to be a function.\"),TypeError(\"onFailure have to be a function.\");if(!t||\"\"==t.trim())return S.debug(\"API setAudioOutput() fail - [INVALID_PARAM] - streamId: \"+this.getId()+\" No audio tag\"),void n(\"INVALID_PARAM\",{code:_.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"parameter [deviceId] is invalid\"});if(!this._audio)return S.debug(\"API setAudioOutput() fail - [NONSUPPORT] - streamId: \"+this.getId()+\" No audio tag\"),void n(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:\"\",message:\"there is no audio tag\"});var a=t.trim();this._audio&&this._audio.setSinkId(a).then((function(){S.debug(\"Audio output device attached succ - \"+a+\" streamId: \"+i.getId()+\" \"),r(\"Audio output device attached - \"+a)})).catch((function(e){S.debug(\"Audio output device attached fail - [DEVICE_EXCEPTION] - streamId: \"+i.getId()+\" \"+e.name+\" \"+e.message),n(\"DEVICE_EXCEPTION\",{code:_.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.name,message:e.name+\" \"+e.message})}))}},{key:\"play\",value:(I=(0,s.default)(o.default.mark((function t(r,n,i,a){var s,d,u,l=this;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(S.debug(\"API play() >> elementID: \"+r+\" opts: \"+(0,c.default)(n)+\" this._userId: \"+this._userId+\" streamId: \"+this.getId()+\" this._isLocalStream: \"+this._isLocalStream+\" this.hasAudio: \"+this.hasAudio()+\" this.hasVideo: \"+this.hasVideo()),S.funLog({f:\"play\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"elementID-\"+r}),this._streamObj){t.next=6;break}return S.warn(\"API play() << error - [INVALID_PARAM] - streamId: \"+this.getId()+\" this._streamObj is NULL\"),\"function\"==typeof a&&a(\"INVALID_PARAM\",{code:_.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"parameter [stream._streamObj] is invalid\"}),t.abrupt(\"return\");case 6:this.hasVideo()&&((s=document.getElementById(r))?(this._video!==s&&(this._video=s,S.debug(\"API play() - play Video - this._userId: \"+this._userId+\" streamId: \"+this.getId()+\" this._videoPlaying: \"+this._videoPlaying),this._video.autoplay=!0,this._video.muted=!0,this._video.controls=!!n&&!!n.isControls,this._video.playsinline=!0,this._video.srcObject=this._streamObj,this._videoPlaying=!1),Boolean(this._video.paused)&&!this._videoPlaying&&(this._videoPlaying=!0,void 0!==(d=this._video.play())&&d.then((function(){l._videoPlayStatus=1,S.debug(\"API play() - play Video succ - this._video.paused: \"+l._video.paused)})).catch((function(e){l._videoPlayStatus=0,l._videoPlaying=!1,S.debug(\"API play() - play Video fail - \"+e.name+\" \"+e.message)})))):S.warn(\"API play() - play Video error - elementID: \"+r+\" not found\")),Boolean(this._consumerAudio)&&this.hasAudio()&&!this._isLocalStream&&(S.debug(\"API play() - play Audio - this._userId: \"+this._userId+\" streamId: \"+this.getId()+\" this._audioPlaying: \"+this._audioPlaying),this._audio||(this._audio=new Audio,this._audio&&(this._audio.srcObject=this._streamObj,this._audio.muted=!1,this._audio.autoplay=!0)),this._audio&&Boolean(this._audio.paused)&&!this._audioPlaying&&(this._audioPlaying=!0,void 0!==(u=this._audio.play())&&u.then((function(){l._audioPlayStatus=1,S.debug(\"API play() - play Audio succ - this._audio.paused: \"+l._audio.paused)})).catch((function(e){l._audioPlayStatus=0,l._audioPlaying=!1,S.warn(\"API play() << error - [AUDIO_PLAY_FAIL] - play Audio error - \"+e.name+\" \"+e.message),\"function\"==typeof a&&a(\"AUDIO_PLAY_FAIL\",{code:_.tttErrCode.AUDIO_PLAY_FAIL,name:\"AUDIO_PLAY_FAIL\",origin:\"\"+e.name,message:\"_audio.play error - \"+e.name+\" \"+e.message})})))),S.debug(\"API play() << end - streamId: \"+this.getId()),\"function\"==typeof i&&i();case 10:case\"end\":return t.stop()}}),t,this)}))),function(e,t,r,n){return I.apply(this,arguments)})},{key:\"resume\",value:function(){if(S.funLog({f:\"resume\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),S.debug(\"API resume()\"),this._video)try{this._video.play()}catch(e){}if(this._audio)try{this._audio.play()}catch(e){}}},{key:\"resumeLocalVideo\",value:function(){if(this._isLocalStream&&Boolean(this._video)&&Boolean(this._video.paused))try{this._video.play()}catch(e){}}},{key:\"resumeAudioPlay\",value:function(){if(S.debug(\"API resumeAudioPlay() streamId: \"+this.getId()),!this._isLocalStream&&Boolean(this._audio)&&Boolean(this._audio.paused)){this._audio.muted=!1;try{this._audio.play()}catch(e){}}}},{key:\"resumeVideoPlay\",value:function(){if(S.debug(\"API resumeVideoPlay() streamId: \"+this.getId()),!this._isLocalStream&&Boolean(this._video)&&Boolean(this._video.paused)){this._video.muted=!0;try{this._video.play()}catch(e){}}}},{key:\"pauseAudioPlay\",value:function(){S.debug(\"API pauseAudioPlay() streamId: \"+this.getId()),this._isLocalStream||Boolean(this._audio)&&!this._audio.paused&&(this._audio.muted=!0,this._audio.pause())}},{key:\"pauseVideoPlay\",value:function(){S.debug(\"API pauseVideoPlay() streamId: \"+this.getId()),this._isLocalStream||Boolean(this._video)&&!this._video.paused&&(this._video.muted=!0,this._video.pause())}},{key:\"close\",value:(b=(0,s.default)(o.default.mark((function t(r,n){var i=this;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(S.debug(\"API close() >> this._userId: \"+this._userId+\" streamId: \"+this.getId()),S.funLog({f:\"close\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),!this._closed&&!this._closing){t.next=5;break}return\"function\"==typeof n&&r(),t.abrupt(\"return\");case 5:if(this._isLocalStream){t.next=9;break}return S.warn(\"API close() << error - [NONSUPPORT] - streamId: \"+this.getId()+\" This is not localStream\"),\"function\"==typeof n&&n(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:\"\",message:\"Stream.close() is nonsupport on remote stream\"}),t.abrupt(\"return\");case 9:\"\"+this.getId()==\"\"+this.userId&&(w=!1),T.delete(this.getId()),this._closing=!0,this.emit(\"@close\",this._isLocalStream,{streamId:this.getId(),stream:this,audioProducerId:this.audioProducerId,videoProducerId:this.videoProducerId}),this._streamObj&&this._streamObj.getTracks().forEach((function(e){S.debug(\"API close() <WARN> - track.kind: \"+e.kind+\" streamId: \"+i.getId()+\" - call track.stop()\"),e.stop()})),this._streamObj=null,S.debug(\"API close() - streamId: \"+this.getId()+\" - Emit [stream-close]\"),this.emit(\"stream-close\",{streamId:this.streamID,stream:this}),this._video&&(this._video.srcObject=null),this._audio&&(this._audio.srcObject=null),this._gainNode=null,this._closed=!0,this._closing=!1,this.removeAllListeners(),S.debug(\"API close() << success - streamId: \"+this.getId()),\"function\"==typeof n&&r();case 25:case\"end\":return t.stop()}}),t,this)}))),function(e,t){return b.apply(this,arguments)})},{key:\"_startScreenCapture\",value:function(){var e={video:{aspectRatio:1.77,frameRate:15,width:1920,height:1080,resizeMode:\"crop-and-scale\",cursor:\"always\"}};return navigator.getDisplayMedia?navigator.getDisplayMedia(e):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(e):navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{mediaSource:\"screen\"}}):(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.getUserMedia,new a.default((function(e,t){navigator.getUserMedia?navigator.getUserMedia({video:{mandatory:{chromeMediaSource:\"screen\"}}},(function(t){e(t)}),(function(e){t(e)})):t(new Error(\"unsupported navigator.getUserMedia\"))})))}},{key:\"_onEventStreamEnded\",value:(y=(0,s.default)(o.default.mark((function e(t){var r,n,i=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt(\"return\");case 2:if((r=t.getVideoTracks())&&!(r.length<=0)){e.next=5;break}return e.abrupt(\"return\");case 5:if(n=r[0]){e.next=8;break}return e.abrupt(\"return\");case 8:n.onended=function(e){S.debug(\"_onEventStreamEnded() track.onended - streamId: \"+i.getId()+\" \"+e.name+\" \"+e.message+\" - Emit [stream-close]\"),i._isVideoTrackClosed=!0,i._ended=!0,setTimeout((function(){i.emit(\"stream-close\",{streamId:i.streamID,stream:i})}))};case 9:case\"end\":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:\"_onEventScreenStreamEnded\",value:(v=(0,s.default)(o.default.mark((function e(t){var r,n,i=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt(\"return\");case 2:if((r=t.getVideoTracks())&&!(r.length<=0)){e.next=5;break}return e.abrupt(\"return\");case 5:if(n=r[0]){e.next=8;break}return e.abrupt(\"return\");case 8:n.onended=function(e){S.debug(\"_onEventScreenStreamEnded() track.onended - streamId: \"+i.getId()+\" \"+e.name+\" \"+e.message+\" - Emit [stream-close]\"),i._isVideoTrackClosed=!0,i._ended=!0,setTimeout((function(){i.emit(\"stream-close\",{streamId:i.streamID,stream:i}),i.emit(\"screen-close\",{streamId:i.streamID,stream:i})}))};case 9:case\"end\":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:\"capture\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).toISOString().replace(/[-:TZ.]/g,\"\")+this._customStreamID,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Function;if(S.debug(\"API capture() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),!this._streamObj)throw S.warn(\"API capture() error - this._streamObj is NULL.\"),Error(\"stream is null, please init it at first.\");if(!this._video)throw S.warn(\"API capture() error - this._video is NULL.\"),Error(\"this stream has not be played: \"+this._streamObj);var n=document.createElement(\"canvas\");n.width=this._video.videoWidth,n.height=this._video.videoHeight;var i=n.getContext(\"2d\");i.drawImage(this._video,0,0,n.width,n.height),\"file\"===e?n.toBlob((function(e){r(new File([e],t+\".jpeg\",{type:\"image/jpeg\"}))})):r(n.toDataURL(\"image/jpeg\"))}},{key:\"setAudioVolume\",value:function(t){\"number\"==typeof t?this._gainNode?(t<0?t=0:t>1.5&&(t=1.5),this._gainNode.gain.value=t,S.debug(\"API setAudioVolume() success - streamId: \"+this.getId()+\" volume: \"+t),S.funLog({f:\"setAudioVolume\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"volume-\"+t})):S.warn(\"API setAudioVolume() error - no gainNode existed.\"):S.warn(\"API setAudioVolume() TypeError - volume: \"+t)}},{key:\"setInputVolume\",value:function(t){\"number\"==typeof t?this._gainNode?(t<0?t=0:t>1.5&&(t=1.5),this._gainNode.gain.value=t,S.debug(\"API setInputVolume() success - streamId: \"+this.getId()+\" volume: \"+t),S.funLog({f:\"setInputVolume\",t:g.getNowTime(),i:e.g_OrderCount+=1,p:\"volume-\"+t})):S.warn(\"API setInputVolume() error - no gainNode existed.\"):S.warn(\"API setInputVolume() TypeError - volume: \"+t)}},{key:\"addTrack\",value:function(e){}},{key:\"removeTrack\",value:function(e){}},{key:\"replaceTrack\",value:(h=(0,s.default)(o.default.mark((function e(t,r,n){var i,a;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof r){e.next=3;break}throw S.warn(\"API replaceTrack() error - onSuccess have to be a function.\"),TypeError(\"onSuccess have to be a function.\");case 3:if(\"function\"==typeof n){e.next=6;break}throw S.warn(\"API replaceTrack() error - onFailure have to be a function.\"),TypeError(\"onFailure have to be a function.\");case 6:if(S.debug(\"API replaceTrack() >> this._userId: \"+this._userId+\" streamId: \"+this.getId()),this._isLocalStream){e.next=11;break}return S.warn(\"API replaceTrack() << error - [NONSUPPORT] - streamId: \"+this.getId()+\" This is not localStream\"),\"function\"==typeof n&&n(\"NONSUPPORT\",{code:_.tttErrCode.NONSUPPORT,name:\"NONSUPPORT\",origin:\"\",message:\"Stream.replaceTrack() is nonsupport on remote stream\"}),e.abrupt(\"return\");case 11:if(t){e.next=15;break}return S.warn(\"API replaceTrack() << error - [INVALID_PARAM] - streamId: \"+this.getId()+\" parameter [track] is INVALID\"),n(\"INVALID_PARAM\",{code:_.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"parameter [track] is INVALID\"}),e.abrupt(\"return\");case 15:i=null,a=null,e.t0=t.kind,e.next=\"video\"===e.t0?20:\"audio\"===e.t0?41:60;break;case 20:if(e.prev=20,!((i=this._streamObj.getVideoTracks())&&i.length>0)){e.next=30;break}if(a=i[0],t!==a){e.next=26;break}return e.abrupt(\"return\");case 26:a&&(a.onended=null,S.debug(\"API replaceTrack() <WARN> - track.kind: \"+t.kind+\" streamId: \"+this.getId()+\" - call oldTrack.stop()\"),a.stop(),this._streamObj.removeTrack(a)),this.videoTracks=t,this._videoSetting=t.getSettings(),this._getVideoActualResolution(this._videoSetting);case 30:if(!this._webcamProducer){e.next=33;break}return e.next=33,this._webcamProducer.replaceTrack(t);case 33:e.next=40;break;case 35:return e.prev=35,e.t1=e.catch(20),S.warn(\"API replaceTrack() << error - [SYS_EXCEPTION] - streamId: \"+this.getId()+\" \"+e.t1.name+\" \"+e.t1.message),n(\"SYS_EXCEPTION\",{code:_.tttErrCode.SYS_EXCEPTION,name:\"SYS_EXCEPTION\",origin:\"\"+e.t1.name,message:e.t1.name+\" \"+e.t1.message}),e.abrupt(\"return\");case 40:return e.abrupt(\"break\",63);case 41:if(e.prev=41,!((i=this._streamObj.getAudioTracks())&&i.length>0)){e.next=49;break}if(a=i[0],t!==a){e.next=47;break}return e.abrupt(\"return\");case 47:a&&(a.onended=null,S.debug(\"API replaceTrack() <WARN> - track.kind: \"+t.kind+\" streamId: \"+this.getId()+\" - call oldTrack.stop()\"),a.stop(),this._streamObj.removeTrack(a)),this.audioTracks=t;case 49:if(!this._micProducer){e.next=52;break}return e.next=52,this._micProducer.replaceTrack(t);case 52:e.next=59;break;case 54:return e.prev=54,e.t2=e.catch(41),S.warn(\"API replaceTrack() << error - [SYS_EXCEPTION] - streamId: \"+this.getId()+\" \"+e.t2.name+\" \"+e.t2.message),n(\"SYS_EXCEPTION\",{code:_.tttErrCode.SYS_EXCEPTION,name:\"SYS_EXCEPTION\",origin:\"\"+e.t2.name,message:e.t2.name+\" \"+e.t2.message}),e.abrupt(\"return\");case 59:return e.abrupt(\"break\",63);case 60:return S.warn(\"API replaceTrack() << error - streamId: \"+this.getId()+\" Invalid track type\"),n(\"INVALID_PARAM\",{code:_.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"invalid track type\"}),e.abrupt(\"return\");case 63:S.debug(\"API replaceTrack() << succ - this._userId: \"+this._userId+\" streamId: \"+this.getId());case 64:case\"end\":return e.stop()}}),e,this,[[20,35],[41,54]])}))),function(e,t,r){return h.apply(this,arguments)})},{key:\"getVideoTrackSettings\",value:function(){return this._videoSetting}},{key:\"getAudioTrackSetting\",value:function(){return this._audioSetting}},{key:\"_getVideoActualResolution\",value:function(e){e?e.height<=80?this._keyResolution=\"80p\":e.height>80&&e.height<=120?this._keyResolution=\"120p\":e.height>120&&e.height<=160?this._keyResolution=\"160p\":e.height>160&&e.height<=200?this._keyResolution=\"200p\":e.height>200&&e.height<=240?this._keyResolution=\"240p\":e.height>240&&e.height<=320?this._keyResolution=\"320p\":e.height>320&&e.height<=360?this._keyResolution=\"360p\":e.height>360&&e.height<=480?this._keyResolution=\"480p\":e.height>480&&e.height<=540?this._keyResolution=\"540p\":e.height>480&&e.height<=720?this._keyResolution=\"720p\":e.height>720&&e.height<=1080?this._keyResolution=\"1080p\":e.width>1920&&e.width<=2560?this._keyResolution=\"2k\":e.width>2560&&e.width<=3840?this._keyResolution=\"4k\":e.width>3840?this._keyResolution=\"8k\":this._keyResolution=\"480p\":this._keyResolution=\"480p\"}},{key:\"_getResolutionByVideoProfile\",value:function(e){var t={width:640,height:480};if(!e||\"string\"!=typeof e)return t;var r=e.toLowerCase(),n=_.videoResolution.get(r);return n&&(t.width=n.width,t.height=n.height),t}},{key:\"streamObj\",set:function(e){if(this._streamObj=e,e){if(this._isLocalStream){var t=this.videoTracks;if(t&&t.length>0){var r=t[0];this._videoSetting=r.getSettings(),this._getVideoActualResolution(this._videoSetting)}if((t=this.audioTracks)&&t.length>0){var n=t[0];this._audioSetting=n.getSettings()}}e.getAudioTracks().length>0&&this._speechEvents(e)}},get:function(){return this._streamObj}},{key:\"isLocalStream\",get:function(){return this._isLocalStream}},{key:\"isAudioOn\",get:function(){return this._isAudioOn}},{key:\"isVideoOn\",get:function(){return this._isVideoOn}},{key:\"isAudioPaused\",get:function(){return this._isAudioPaused},set:function(e){this._isAudioPaused=e}},{key:\"isVideoPaused\",get:function(){return this._isVideoPaused},set:function(e){this._isVideoPaused=e}},{key:\"streamType\",get:function(){return this._streamType}},{key:\"specialCameraId\",get:function(){return this._specialCameraId}},{key:\"specialMicId\",get:function(){return this._specialMicId}},{key:\"appData\",get:function(){return this._appData}},{key:\"uuid\",get:function(){return this._uuid}},{key:\"closed\",get:function(){return this._closed}},{key:\"default\",get:function(){return this._default},set:function(e){this._isLocalStream&&this.hasVideo()||(this._default=!1),this._default=e}},{key:\"streamID\",set:function(e){this._customStreamID=e},get:function(){return this._isLocalStream?this._innerStreamID:this._customStreamID}},{key:\"streamId\",get:function(){return this._isLocalStream?this._innerStreamID:this._customStreamID}},{key:\"userID\",set:function(e){this._userId=e},get:function(){return this._userId}},{key:\"userId\",get:function(){return this._userId}},{key:\"trackEnded\",get:function(){return this._ended}},{key:\"consumers\",get:function(){return this._consumers}},{key:\"isConsumerMedia\",get:function(){return this._consumerAudio||this._consumerVideo}},{key:\"audioTracks\",set:function(e){if(!e)throw new TypeError(\"parameter [track] is invalid\");if(\"audio\"!==e.kind)throw new TypeError(\"[track] is not audio\");if(!this._streamObj)throw new Error(\"stream._streamObj is null.\");var t=this._streamObj.getAudioTracks();if(t&&t.length>0){var r=t[0];if(e===r)return;r&&(this._isLocalStream&&(r.onended=null),S.debug(\"audioTracks() <WARN> - oldTrack.kind: \"+r.kind+\" streamId: \"+this.getId()+\" - call oldTrack.stop()\"),r.stop(),this._streamObj.removeTrack(r))}this._streamObj.addTrack(e),this._speechEvents(this._streamObj),!this._isLocalStream&&this._audio&&(this._audio.srcObject=this._streamObj)},get:function(){return this._streamObj?this._streamObj.getAudioTracks():null}},{key:\"audioTrackStatus\",get:function(){if(!this._streamObj)return{};var e=this._streamObj.getAudioTracks();if(e&&e.length>0){var t=\"\";return Boolean(this._audio)&&Boolean(this._audio.error)&&(t=this._audio.error.code+\" \"+this._audio.error.message),{local:Boolean(this._isLocalStream),id:e[0].id,label:e[0].label,kind:e[0].kind,enabled:e[0].enabled,muted:e[0].muted,readyState:e[0].readyState,audioEle:Boolean(this._isLocalStream)?{}:{autoplay:this._audio?this._audio.autoplay:\"non-audio\",ended:this._audio?this._audio.ended:\"non-audio\",paused:this._audio?this._audio.paused:\"non-audio\",muted:this._audio?this._audio.muted:\"non-audio\",readyState:this._audio?this._audio._readyState:\"non-audio\",error:t,playStatus:this._audioPlayStatus,volume:this._volume}}}return{}}},{key:\"videoTracks\",set:function(e){if(!e)throw new TypeError(\"parameter [track] is invalid\");if(\"video\"!==e.kind)throw new TypeError(\"[track] is not video\");if(!this._streamObj)throw new Error(\"stream._streamObj is null.\");var t=this._streamObj.getVideoTracks();if(t&&t.length>0){var r=t[0];if(e===r)return;r&&(this._isLocalStream&&(r.onended=null),S.debug(\"videoTracks() <WARN> - oldTrack.kind: \"+r.kind+\" streamId: \"+this.getId()+\" - call oldTrack.stop()\"),r.stop(),this._streamObj.removeTrack(r))}this._streamObj.addTrack(e),this._video&&(this._video.srcObject=this._streamObj)},get:function(){return this._streamObj?this._streamObj.getVideoTracks():null}},{key:\"videoTrackStatus\",get:function(){if(!this._streamObj)return{};var e=this._streamObj.getVideoTracks();if(e&&e.length>0){var t=\"\";return Boolean(this._video)&&Boolean(this._video.error)&&(t=this._video.error.code+\" \"+this._video.error.message),{local:Boolean(this._isLocalStream),id:e[0].id,label:e[0].label,kind:e[0].kind,enabled:e[0].enabled,muted:e[0].muted,readyState:e[0].readyState,videoEle:{autoplay:this._video?this._video.autoplay:\"non-video\",ended:this._video?this._video.ended:\"non-video\",paused:this._video?this._video.paused:\"non-video\",muted:this._video?this._video.muted:\"non-video\",error:t,playStatus:this._videoPlayStatus,width:this._video?this._video.width:\"non-video\",height:this._video?this._video.height:\"non-video\"}}}return{}}},{key:\"tracks\",get:function(){return this._streamObj?this._streamObj.getTracks():null}},{key:\"trackNumber\",get:function(){return this._streamObj?this._streamObj.getTracks().length:0}},{key:\"audioSubscribed\",set:function(e){this._audioSubscribed=e},get:function(){return this._audioSubscribed}},{key:\"videoSubscribed\",set:function(e){this._videoSubscribed=e},get:function(){return this._videoSubscribed}},{key:\"subscribed\",set:function(e){this._subscribed=e},get:function(){return this._subscribed}},{key:\"type\",get:function(){return 1===this.trackNumber&&this.audioTracks&&this.audioTracks.length>0?\"audio\":\"video\"}},{key:\"published\",get:function(){return this._published},set:function(e){return this._published=e}},{key:\"publishState\",set:function(e){this._publishState=e}},{key:\"videoType\",set:function(e){this._videoType=+e},get:function(){return this._videoType}},{key:\"videoProducerId\",get:function(){if(this._isLocalStream&&this._webcamProducer)return this._webcamProducer.id}},{key:\"audioProducerId\",get:function(){if(this._isLocalStream&&this._micProducer)return this._micProducer.id}},{key:\"isMicClosed\",get:function(){return this._isMicClosed}},{key:\"isVideoTrackClosed\",get:function(){return this._isVideoTrackClosed}},{key:\"videoResolution\",get:function(){if(!this._streamObj)return{};var e=this._streamObj.getVideoTracks();if(e.length<=0)return{};var t=e[0].getSettings();return{width:Number(t.width),height:Number(t.height)}}},{key:\"idealBandwidth\",get:function(){if(this._spec.codecOptions&&this._spec.codecOptions.startBitrate)return S.debug(\"API <BW> idealBandwidth() - streamId: \"+this.getId()+\" idealKbps: \"+this._spec.codecOptions.startBitrate),this._spec.codecOptions.startBitrate;var e=null,t=400;return(e=\"clear\"===this._videoMode?1===this._videoType?_.screenResolutionH.get(this._keyResolution):_.videoResolutionH.get(this._keyResolution):1===this._videoType?_.screenResolution.get(this._keyResolution):_.videoResolution.get(this._keyResolution))&&e.bps&&(t=e.bps.ideal/1e3),S.debug(\"API <BW> idealBandwidth() - streamId: \"+this.getId()+\" idealKbps: \"+t),t>0?t:400}},{key:\"minBandwidth\",get:function(){if(this._spec.codecOptions&&this._spec.codecOptions.minBitrate)return S.debug(\"API <BW> minBandwidth() - streamId: \"+this.getId()+\" minKbps: \"+this._spec.codecOptions.minBitrate),this._spec.codecOptions.minBitrate;var e=null,t=300;return(e=\"clear\"===this._videoMode?1===this._videoType?_.screenResolutionH.get(this._keyResolution):_.videoResolutionH.get(this._keyResolution):1===this._videoType?_.screenResolution.get(this._keyResolution):_.videoResolution.get(this._keyResolution))&&e.bps&&(t=e.bps.min/1e3),S.debug(\"API <BW> minBandwidth() - streamId: \"+this.getId()+\" minKbps: \"+t),t>0?t:300}},{key:\"maxBandwidth\",get:function(){if(this._spec.codecOptions&&this._spec.codecOptions.maxBitrate)return S.debug(\"API <BW> maxBandwidth() - streamId: \"+this.getId()+\" maxKbps: \"+this._spec.codecOptions.maxBitrate),this._spec.codecOptions.maxBitrate;var e=null,t=500;return(e=\"clear\"===this._videoMode?1===this._videoType?_.screenResolutionH.get(this._keyResolution):_.videoResolutionH.get(this._keyResolution):1===this._videoType?_.screenResolution.get(this._keyResolution):_.videoResolution.get(this._keyResolution))&&e.bps&&(t=e.bps.max/1e3),S.debug(\"API <BW> maxBandwidth() - streamId: \"+this.getId()+\" maxKbps: \"+t),t>0?t:500}}],[{key:\"resetDefaultStreamOn\",value:function(){w=!1}},{key:\"clearStreamIdMap\",value:function(){T&&T.clear()}},{key:\"_genStreamId\",value:function(e,t,n,i,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(\"\"===t)return\"\";if(!e)return t;var s=T.get(\"\"+n);return!s||s.closed?(T.set(\"\"+n,a),n):o?0===i?r._genStreamId(e,t,t+\":\"+t+\"_low\",i+1,a):r._genStreamId(e,t,t+\":\"+t+\"_\"+i+\"_low\",i+1,a):r._genStreamId(e,t,t+\":\"+t+\"_\"+(i+1),i+1,a)}}]),r}(v.EventEmitter);t.default=A}).call(this,r(38))},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.internals=t.Room=void 0;var n=d(r(6));t.setDeviceHandler=function(e,t){a.default.setHandler(e,t)},t.isDeviceSupported=function(){return a.default.isSupported()},t.getDeviceInfo=function(){return{flag:a.default.getFlag(),name:a.default.getName(),version:a.default.getVersion(),bowser:a.default.getBowser()}},t.checkCapabilitiesForRoom=function(e){return a.default.isSupported()?a.default.Handler.getNativeRtpCapabilities().then((function(t){var r=i.getExtendedRtpCapabilities(t,e);return{audio:i.canSend(\"audio\",r),video:i.canSend(\"video\",r)}})):n.default.reject(new Error(\"current browser/device not supported\"))};var i=c(r(16)),a=d(r(85)),o=d(r(210)),s=c(r(216));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}t.Room=o.default,t.internals=s},function(e,t,r){\"use strict\";var n,i=r(43),a=(n=i)&&n.__esModule?n:{default:n};var o=e.exports={v:[{name:\"version\",reg:/^(\\d*)$/}],o:[{name:\"origin\",reg:/^(\\S*) (\\d*) (\\d*) (\\S*) IP(\\d) (\\S*)/,names:[\"username\",\"sessionId\",\"sessionVersion\",\"netType\",\"ipVer\",\"address\"],format:\"%s %s %d %s IP%d %s\"}],s:[{name:\"name\"}],i:[{name:\"description\"}],u:[{name:\"uri\"}],e:[{name:\"email\"}],p:[{name:\"phone\"}],z:[{name:\"timezones\"}],r:[{name:\"repeats\"}],t:[{name:\"timing\",reg:/^(\\d*) (\\d*)/,names:[\"start\",\"stop\"],format:\"%d %d\"}],c:[{name:\"connection\",reg:/^IN IP(\\d) (\\S*)/,names:[\"version\",\"ip\"],format:\"IN IP%d %s\"}],b:[{push:\"bandwidth\",reg:/^(TIAS|AS|CT|RR|RS):(\\d*)/,names:[\"type\",\"limit\"],format:\"%s:%s\"}],m:[{reg:/^(\\w*) (\\d*) ([\\w\\/]*)(?: (.*))?/,names:[\"type\",\"port\",\"protocol\",\"payloads\"],format:\"%s %d %s %s\"}],a:[{push:\"rtp\",reg:/^rtpmap:(\\d*) ([\\w\\-\\.]*)(?:\\s*\\/(\\d*)(?:\\s*\\/(\\S*))?)?/,names:[\"payload\",\"codec\",\"rate\",\"encoding\"],format:function(e){return e.encoding?\"rtpmap:%d %s/%s/%s\":e.rate?\"rtpmap:%d %s/%s\":\"rtpmap:%d %s\"}},{push:\"fmtp\",reg:/^fmtp:(\\d*) ([\\S| ]*)/,names:[\"payload\",\"config\"],format:\"fmtp:%d %s\"},{name:\"control\",reg:/^control:(.*)/,format:\"control:%s\"},{name:\"rtcp\",reg:/^rtcp:(\\d*)(?: (\\S*) IP(\\d) (\\S*))?/,names:[\"port\",\"netType\",\"ipVer\",\"address\"],format:function(e){return null!=e.address?\"rtcp:%d %s IP%d %s\":\"rtcp:%d\"}},{push:\"rtcpFbTrrInt\",reg:/^rtcp-fb:(\\*|\\d*) trr-int (\\d*)/,names:[\"payload\",\"value\"],format:\"rtcp-fb:%d trr-int %d\"},{push:\"rtcpFb\",reg:/^rtcp-fb:(\\*|\\d*) ([\\w-_]*)(?: ([\\w-_]*))?/,names:[\"payload\",\"type\",\"subtype\"],format:function(e){return null!=e.subtype?\"rtcp-fb:%s %s %s\":\"rtcp-fb:%s %s\"}},{push:\"ext\",reg:/^extmap:(\\d+)(?:\\/(\\w+))? (\\S*)(?: (\\S*))?/,names:[\"value\",\"direction\",\"uri\",\"config\"],format:function(e){return\"extmap:%d\"+(e.direction?\"/%s\":\"%v\")+\" %s\"+(e.config?\" %s\":\"\")}},{push:\"crypto\",reg:/^crypto:(\\d*) ([\\w_]*) (\\S*)(?: (\\S*))?/,names:[\"id\",\"suite\",\"config\",\"sessionConfig\"],format:function(e){return null!=e.sessionConfig?\"crypto:%d %s %s %s\":\"crypto:%d %s %s\"}},{name:\"setup\",reg:/^setup:(\\w*)/,format:\"setup:%s\"},{name:\"mid\",reg:/^mid:([^\\s]*)/,format:\"mid:%s\"},{name:\"msid\",reg:/^msid:(.*)/,format:\"msid:%s\"},{name:\"ptime\",reg:/^ptime:(\\d*)/,format:\"ptime:%d\"},{name:\"maxptime\",reg:/^maxptime:(\\d*)/,format:\"maxptime:%d\"},{name:\"direction\",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:\"icelite\",reg:/^(ice-lite)/},{name:\"iceUfrag\",reg:/^ice-ufrag:(\\S*)/,format:\"ice-ufrag:%s\"},{name:\"icePwd\",reg:/^ice-pwd:(\\S*)/,format:\"ice-pwd:%s\"},{name:\"fingerprint\",reg:/^fingerprint:(\\S*) (\\S*)/,names:[\"type\",\"hash\"],format:\"fingerprint:%s %s\"},{push:\"candidates\",reg:/^candidate:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?(?: network-id (\\d*))?(?: network-cost (\\d*))?/,names:[\"foundation\",\"component\",\"transport\",\"priority\",\"ip\",\"port\",\"type\",\"raddr\",\"rport\",\"tcptype\",\"generation\",\"network-id\",\"network-cost\"],format:function(e){var t=\"candidate:%s %d %s %d %s %d typ %s\";return t+=null!=e.raddr?\" raddr %s rport %d\":\"%v%v\",t+=null!=e.tcptype?\" tcptype %s\":\"%v\",null!=e.generation&&(t+=\" generation %d\"),t+=null!=e[\"network-id\"]?\" network-id %d\":\"%v\",t+=null!=e[\"network-cost\"]?\" network-cost %d\":\"%v\"}},{name:\"endOfCandidates\",reg:/^(end-of-candidates)/},{name:\"remoteCandidates\",reg:/^remote-candidates:(.*)/,format:\"remote-candidates:%s\"},{name:\"iceOptions\",reg:/^ice-options:(\\S*)/,format:\"ice-options:%s\"},{push:\"ssrcs\",reg:/^ssrc:(\\d*) ([\\w_-]*)(?::(.*))?/,names:[\"id\",\"attribute\",\"value\"],format:function(e){var t=\"ssrc:%d\";return null!=e.attribute&&(t+=\" %s\",null!=e.value&&(t+=\":%s\")),t}},{push:\"ssrcGroups\",reg:/^ssrc-group:([\\x21\\x23\\x24\\x25\\x26\\x27\\x2A\\x2B\\x2D\\x2E\\w]*) (.*)/,names:[\"semantics\",\"ssrcs\"],format:\"ssrc-group:%s %s\"},{name:\"msidSemantic\",reg:/^msid-semantic:\\s?(\\w*) (\\S*)/,names:[\"semantic\",\"token\"],format:\"msid-semantic: %s %s\"},{push:\"groups\",reg:/^group:(\\w*) (.*)/,names:[\"type\",\"mids\"],format:\"group:%s %s\"},{name:\"rtcpMux\",reg:/^(rtcp-mux)/},{name:\"rtcpRsize\",reg:/^(rtcp-rsize)/},{name:\"sctpmap\",reg:/^sctpmap:([\\w_\\/]*) (\\S*)(?: (\\S*))?/,names:[\"sctpmapNumber\",\"app\",\"maxMessageSize\"],format:function(e){return null!=e.maxMessageSize?\"sctpmap:%s %s %s\":\"sctpmap:%s %s\"}},{name:\"xGoogleFlag\",reg:/^x-google-flag:([^\\s]*)/,format:\"x-google-flag:%s\"},{push:\"rids\",reg:/^rid:([\\d\\w]+) (\\w+)(?: ([\\S| ]*))?/,names:[\"id\",\"direction\",\"params\"],format:function(e){return e.params?\"rid:%s %s %s\":\"rid:%s %s\"}},{push:\"imageattrs\",reg:new RegExp(\"^imageattr:(\\\\d+|\\\\*)[\\\\s\\\\t]+(send|recv)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*)(?:[\\\\s\\\\t]+(recv|send)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*))?\"),names:[\"pt\",\"dir1\",\"attrs1\",\"dir2\",\"attrs2\"],format:function(e){return\"imageattr:%s %s %s\"+(e.dir2?\" %s %s\":\"\")}},{name:\"simulcast\",reg:new RegExp(\"^simulcast:(send|recv) ([a-zA-Z0-9\\\\-_~;,]+)(?:\\\\s?(send|recv) ([a-zA-Z0-9\\\\-_~;,]+))?$\"),names:[\"dir1\",\"list1\",\"dir2\",\"list2\"],format:function(e){return\"simulcast:%s %s\"+(e.dir2?\" %s %s\":\"\")}},{name:\"simulcast_03\",reg:/^simulcast:[\\s\\t]+([\\S+\\s\\t]+)$/,names:[\"value\"],format:\"simulcast: %s\"},{name:\"framerate\",reg:/^framerate:(\\d+(?:$|\\.\\d+))/,format:\"framerate:%s\"},{name:\"sourceFilter\",reg:/^source-filter: *(excl|incl) (\\S*) (IP4|IP6|\\*) (\\S*) (.*)/,names:[\"filterMode\",\"netType\",\"addressTypes\",\"destAddress\",\"srcList\"],format:\"source-filter: %s %s %s %s %s\"},{name:\"bundleOnly\",reg:/^(bundle-only)/},{name:\"label\",reg:/^label:(.+)/,format:\"label:%s\"},{name:\"sctpPort\",reg:/^sctp-port:(\\d+)$/,format:\"sctp-port:%s\"},{name:\"maxMessageSize\",reg:/^max-message-size:(\\d+)$/,format:\"max-message-size:%s\"},{push:\"invalid\",names:[\"value\"]}]};(0,a.default)(o).forEach((function(e){o[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format=\"%s\")}))}))},function(e,t){!function(t){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error(\"invalid options, max must be >= min\");return{min:t,max:r,integer:n}}function n(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}e.exports=n,e.exports.generator=function(e){return e=r(e),function(t,r,i){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=i?i:e.integer,n(e)}},e.exports.defaults=r}()},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=c(r(26)),i=c(r(0)),a=c(r(1)),o=c(r(31)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(117));function c(e){return e&&e.__esModule?e:{default:e}}var d=new o.default(\"protooMessage\"),u=function(){function e(){(0,i.default)(this,e)}return(0,a.default)(e,null,[{key:\"parse\",value:function(e){var t=void 0,r={};try{t=JSON.parse(e)}catch(e){return void d.error(\"parse() | invalid JSON: %s\",e)}if(\"object\"===(void 0===t?\"undefined\":(0,n.default)(t))&&!Array.isArray(t)){if(t.request){if(r.request=!0,\"string\"!=typeof t.method)return void d.error(\"parse() | missing/invalid method field\");if(\"number\"!=typeof t.id)return void d.error(\"parse() | missing/invalid id field\");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,\"number\"!=typeof t.id)return void d.error(\"parse() | missing/invalid id field\");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void d.error(\"parse() | missing request/response field\");if(r.notification=!0,\"string\"!=typeof t.method)return void d.error(\"parse() | missing/invalid method field\");r.method=t.method,r.data=t.data||{}}return r}d.error(\"parse() | not an object\")}},{key:\"requestFactory\",value:function(e,t){return{request:!0,id:s.randomNumberGenerator(),method:e,data:t||{}}}},{key:\"successResponseFactory\",value:function(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}},{key:\"errorResponseFactory\",value:function(e,t,r){return{response:!0,id:e.id,errorCode:t,errorReason:r}}},{key:\"notificationFactory\",value:function(e,t){return{notification:!0,method:e,data:t||{}}}}]),e}();t.default=u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=r(115);t.randomNumberGenerator=n.generator({min:1e6,max:9999999,integer:!0})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(17)),i=f(r(6)),a=f(r(2)),o=f(r(0)),s=f(r(1)),c=f(r(3)),d=f(r(4)),u=r(30),l=f(r(31)),p=f(r(116));function f(e){return e&&e.__esModule?e:{default:e}}var m=r(221).w3cwebsocket,h=r(111),v=new l.default(\"protooWebSocketTransport\"),_={retries:10,factor:2,minTimeout:1e3,maxTimeout:4e3},g=function(e){function t(e,r){(0,o.default)(this,t),v.debug(\"constructor() - url: \"+e);var n=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));n.setMaxListeners(1/0);var i=Date.parse(new Date),s=Math.round(1e9*Math.random());return n._origUrl=e+\"&sid=\"+i+\"-\"+s,n._url=n._origUrl,n._options=r||{},n._ws=null,n._closed=!1,n._connected=!1,n._operation=null,n._setWebSocket(),n}return(0,d.default)(t,e),(0,s.default)(t,[{key:\"reconnect\",value:function(e){this.emit(\"@conn-interrupt\",e)}},{key:\"send\",value:function(e){if(this._closed||!this._ws)return i.default.reject(new Error(\"transport closed\"));try{return this._ws.send((0,n.default)(e)),i.default.resolve()}catch(t){return v.warn(\"send() messge: \"+(0,n.default)(e)+\" error - \"+t.name+\" \"+t.message),i.default.reject(t)}}},{key:\"close\",value:function(){if(v.debug(\"close()\"),!this._closed){this._operation&&this._operation.stop(),this._closed=!0,this.emit(\"close\",{code:1e3,reason:\"Normal close\"});try{if(!this._ws)throw new Error(\"this._ws is null\");this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close(1e3,\"Abnormal close from client\")}catch(e){v.warn(\"close() error - closing the WebSocket: \"+e.name+\" \"+e.message)}}}},{key:\"_setWebSocket\",value:function(){var e=this;this.removeAllListeners(\"@conn-interrupt\"),this.on(\"@conn-interrupt\",(function(t){v.warn(\"event - [@conn-interrupt] code: \"+t.code+\" reason: \"+t.reason),e._handleConnInterrupt(t)}));var t=this._options;this._operation=h.operation(this._options.retry||_),this._connected=!1,this._operation.attempt((function(r){if(e._closed)e._operation.stop();else{e._ws&&(e._ws.onopen=null,e._ws.onclose=null,e._ws.onerror=null,e._ws.onmessage=null,e._ws.close(4006,\"Clean up the left rubbish\"),e._ws=null),v.debug(\"_setWebSocket() - currentAttempt: \"+r);try{if(e._ws=new m(e._url,\"protoo\",t.origin,t.headers,t.requestOptions,t.clientConfig),!e._ws)return void v.warn(\"_setWebSocket() - new W3CWebSocket except - this._ws is null\")}catch(e){return void v.warn(\"_setWebSocket() - new W3CWebSocket except - \"+e.name+\" \"+e.message)}e.emit(\"connecting\",r),e._ws.onopen=function(t){if(!e._closed){e._connected=!0;-1!==e._url.indexOf(\"retry=true\",e._url.length-\"retry=true\".length)?e.emit(\"conn-reconn\",t):e.emit(\"open\",t)}},e._ws.onclose=function(t){e._closed||e.emit(\"@conn-interrupt\",t)},e._ws.onerror=function(t){e._closed||(v.warn(\"WebSocket event [error] - \"+(0,n.default)(t)+\" - nothing todo\"),e.emit(\"conn-error\",t))},e._ws.onmessage=function(t){if(!e._closed){var r=p.default.parse(t.data);r&&(0!==e.listenerCount(\"message\")?e.emit(\"message\",r):v.warn(\"no listeners for WebSocket event [message] - ignoring received message\"))}}}}))}},{key:\"_handleConnInterrupt\",value:function(e){if(this.emit(\"conn-interrupt\",e),4e3!==e.code){var t=3003===e.code;if(this._connected||t){if(this._operation.stop(),this._closed)return;return void(t?this.emit(\"close\",e):(this._url=this._origUrl+\"&timestamp=\"+ +new Date+\"&retry=true\",this._setWebSocket()))}if(this._closed)return;if(this._operation.retry(!0))return;this._operation.stop(),this.emit(\"close\",e)}else this._url=this._origUrl+\"&timestamp=\"+ +new Date,this._closed=!0,this.emit(\"close\",e)}},{key:\"connected\",get:function(){return this._connected}},{key:\"closed\",get:function(){return this._closed}}]),t}(u.EventEmitter);t.default=g},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=b(r(64)),i=b(r(65)),a=b(r(17)),o=b(r(2)),s=b(r(0)),c=b(r(1)),d=b(r(3)),u=b(r(4)),l=r(30),p=y(r(42)),f=y(r(53)),m=b(r(167)),h=b(r(112)),v=b(r(31)),_=b(r(110)),g=y(r(113));function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function b(e){return e&&e.__esModule?e:{default:e}}var I=r(28),k=r(84),P=new v.default(\"TTTRtcWeb\");e.g_client=null,e.g_OrderCount=0,e.g_PreFun=[];var S=function(t){function r(){(0,s.default)(this,r);var t=(0,d.default)(this,(r.__proto__||(0,o.default)(r)).call(this));P.debug(\"constructor() - browser: \"+I.name+\"-\"+I.version+\" os: \"+I.osname+\"-\"+I.osversion+\" bowser.mobile: \"+!!I.mobile+\" \"),h.default.clearStreamIdMap(),h.default.resetDefaultStreamOn();try{r.listDevices((function(e){P.debug(\"TTTRtcWeb.listDevices - devices: \"+(0,a.default)(e))}),(function(e){var t=e.name+e.message+\"\\n\";P.warn(\"TTTRtcWeb.listDevices error - \"+t)})),P.debug(\"constructor succ.\")}catch(e){P.warn(\"constructor() fail - \"+e.name+\" \"+e.message)}return e.g_tttRtcWeb=t,t._client=null,e.g_OrderCount=0,e.g_PreFun=[],t}var l,y;return(0,u.default)(r,t),(0,c.default)(r,[{key:\"checkSystemRequirements\",value:function(){var e=g.isDeviceSupported(),t=Boolean(RTCPeerConnection)&&Boolean(navigator.mediaDevices.getUserMedia)&&Boolean(e);return P.debug(\"isSystemSupported() - RTCPeerConnection: \"+Boolean(RTCPeerConnection)+\" navigator.mediaDevices.getUserMedia: \"+Boolean(navigator.mediaDevices.getUserMedia)+\" isDeviceSupported: \"+Boolean(e)),t}},{key:\"getDevices\",value:(y=(0,i.default)(n.default.mark((function t(r,i){var a,o;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(\"function\"==typeof r){t.next=3;break}return P.error(\"API getDevices() error - parameter: onSuccess invalid\"),t.abrupt(\"return\");case 3:if(\"function\"==typeof i){t.next=6;break}return P.error(\"API getDevices() error - parameter: onFailure invalid\"),t.abrupt(\"return\");case 6:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){t.next=9;break}return P.error(\"API getDevices() error - enumerateDevices() not supported\"),t.abrupt(\"return\");case 9:return t.prev=9,t.next=12,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 12:a=t.sent,(o=a.getTracks())&&o.forEach((function(e){e.stop()})),t.next=19;break;case 17:t.prev=17,t.t0=t.catch(9);case 19:e.g_PreFun.push({f:\"getDevices\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),navigator.mediaDevices.enumerateDevices().then((function(e){r(e)})).catch((function(e){i(\"DEVICE_EXCEPTION\",{code:p.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\",message:\"getDevices fail - \"+e.name+\" \"+e.message})}));case 21:case\"end\":return t.stop()}}),t,this,[[9,17]])}))),function(e,t){return y.apply(this,arguments)})},{key:\"createStream\",value:function(t){if(!r.isSystemSupported())return P.warn(\"createStream() - isSystemSupported not supported\"),null;if(this._client&&!this._client.isLocalStreamAllowed)return P.warn(\"createStream() - Client.isLocalStreamAllowed is false\"),null;P.debug(\"createStream() - spec: \"+(0,a.default)(t)),P.funLog({f:\"createStream\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"spec-\"+(0,a.default)(t)});var n=new h.default(t);return n||null}},{key:\"createClient\",value:function(t){return r.isSystemSupported()?(e.g_PreFun.push({f:\"createClient\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"\"+(0,a.default)(t)}),e.g_client&&(e.g_client.close(),e.g_client=null),this._client=new m.default(t),e.g_client=this._client,h.default.resetDefaultStreamOn(),P.debug(\"createClient() succ - config: \"+(0,a.default)(t)),this._client):(P.error(\"createClient() - isSystemSupported not supported.\"),null)}},{key:\"getStats\",value:function(){return null==this._client?{}:this._client.getNetState()}},{key:\"version\",get:function(){return k.version+\"-\"+k.buildDate}}],[{key:\"isSystemSupported\",value:function(){var e=g.isDeviceSupported(),t=Boolean(RTCPeerConnection)&&Boolean(navigator.mediaDevices.getUserMedia)&&Boolean(e);return P.debug(\"isSystemSupported() - RTCPeerConnection: \"+Boolean(RTCPeerConnection)+\" navigator.mediaDevices.getUserMedia: \"+Boolean(navigator.mediaDevices.getUserMedia)+\" isDeviceSupported: \"+Boolean(e)),t}},{key:\"listDevices\",value:(l=(0,i.default)(n.default.mark((function t(r,i){var a,o;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(\"function\"==typeof r){t.next=3;break}return P.error(\"API listDevices() error - parameter: onSuccess invalid\"),t.abrupt(\"return\");case 3:if(\"function\"==typeof i){t.next=6;break}return P.error(\"API listDevices() error - parameter: onFailure invalid\"),t.abrupt(\"return\");case 6:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){t.next=9;break}return P.error(\"API listDevices() error - enumerateDevices() not supported\"),t.abrupt(\"return\");case 9:return t.prev=9,t.next=12,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 12:a=t.sent,(o=a.getTracks())&&o.forEach((function(e){e.stop()})),t.next=19;break;case 17:t.prev=17,t.t0=t.catch(9);case 19:e.g_PreFun.push({f:\"listDevices\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),navigator.mediaDevices.enumerateDevices().then((function(e){r(e)})).catch((function(e){i(\"DEVICE_EXCEPTION\",{code:p.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\",message:\"listDevices fail - \"+e.name+\" \"+e.message})}));case 21:case\"end\":return t.stop()}}),t,this,[[9,17]])}))),function(e,t){return l.apply(this,arguments)})},{key:\"setSignalTimeout\",value:function(e){e&&(_.default.iplocTimeout=e,m.default.signalTimeout=e)}},{key:\"setLogLevel\",value:function(t){e.g_PreFun.push({f:\"setLogLevel\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"\"+t}),v.default.logLevel=t}},{key:\"setLogSubmit\",value:function(e){v.default.logSubmit=Boolean(e)}},{key:\"setLogStat\",value:function(t){e.g_PreFun.push({f:\"setLogStat\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"\"+t}),m.default.logStat=Boolean(t)}},{key:\"setPrivate\",value:function(t){e.g_PreFun.push({f:\"setPrivate\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"\"+t}),v.default.privateCloud=t,_.default.privateCloud=t}},{key:\"getVersion\",value:function(){return k.version+\"-\"+k.buildDate}},{key:\"setIpLocationAddress\",value:function(t){t&&\"\"!==t.trim()&&(e.g_PreFun.push({f:\"setIpLocationAddress\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"\"+t}),P.debug(\"setIpLocationAddress() - iplocation: \"+t),_.default.IplocationAddress=t)}},{key:\"setIpLocationPort\",value:function(t){e.g_PreFun.push({f:\"setIpLocationPort\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"\"+t}),P.debug(\"setIpLocationPort() - port: \"+t),_.default.IplocationPort=t}},{key:\"setServerUrl\",value:function(t){t&&\"\"!==t.trim()?_.default.MediaServerAddress=t.trim():_.default.MediaServerAddress=\"\",e.g_PreFun.push({f:\"setServerUrl\",t:f.getNowTime(),i:e.g_OrderCount+=1,p:\"\"+t}),P.debug(\"setServerUrl() - IPLocation.MediaServerAddress: \"+_.default.MediaServerAddress)}},{key:\"setTurnServers\",value:function(e){m.default.TurnConf=e}}]),r}(l.EventEmitter);t.default=S}).call(this,r(38))},function(e,t,r){var n=function(){return this}()||Function(\"return this\")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf(\"regeneratorRuntime\")>=0,a=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(121),i)n.regeneratorRuntime=a;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){\"use strict\";var r=Object.prototype,n=r.hasOwnProperty,i=\"function\"==typeof Symbol?Symbol:{},a=i.iterator||\"@@iterator\",o=i.asyncIterator||\"@@asyncIterator\",s=i.toStringTag||\"@@toStringTag\",c=\"object\"==typeof e,d=t.regeneratorRuntime;if(d)c&&(e.exports=d);else{(d=t.regeneratorRuntime=c?e.exports:{}).wrap=h;var u={},l={};l[a]=function(){return this};var p=Object.getPrototypeOf,f=p&&p(p(T([])));f&&f!==r&&n.call(f,a)&&(l=f);var m=y.prototype=_.prototype=Object.create(l);g.prototype=m.constructor=y,y.constructor=g,y[s]=g.displayName=\"GeneratorFunction\",d.isGeneratorFunction=function(e){var t=\"function\"==typeof e&&e.constructor;return!!t&&(t===g||\"GeneratorFunction\"===(t.displayName||t.name))},d.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s in e||(e[s]=\"GeneratorFunction\")),e.prototype=Object.create(m),e},d.awrap=function(e){return{__await:e}},b(I.prototype),I.prototype[o]=function(){return this},d.AsyncIterator=I,d.async=function(e,t,r,n){var i=new I(h(e,t,r,n));return d.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(m),m[s]=\"Generator\",m[a]=function(){return this},m.toString=function(){return\"[object Generator]\"},d.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},d.values=T,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method=\"next\",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)\"t\"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if(\"throw\"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type=\"throw\",o.arg=e,t.next=r,n&&(t.method=\"next\",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if(\"root\"===a.tryLoc)return r(\"end\");if(a.tryLoc<=this.prev){var s=n.call(a,\"catchLoc\"),c=n.call(a,\"finallyLoc\");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error(\"try statement without catch or finally\");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,\"finallyLoc\")&&this.prev<i.finallyLoc){var a=i;break}}a&&(\"break\"===e||\"continue\"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method=\"next\",this.next=a.finallyLoc,u):this.complete(o)},complete:function(e,t){if(\"throw\"===e.type)throw e.arg;return\"break\"===e.type||\"continue\"===e.type?this.next=e.arg:\"return\"===e.type?(this.rval=this.arg=e.arg,this.method=\"return\",this.next=\"end\"):\"normal\"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if(\"throw\"===n.type){var i=n.arg;S(r)}return i}}throw new Error(\"illegal catch attempt\")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},\"next\"===this.method&&(this.arg=void 0),u}}}function h(e,t,r,n){var i=t&&t.prototype instanceof _?t:_,a=Object.create(i.prototype),o=new w(n||[]);return a._invoke=function(e,t,r){var n=\"suspendedStart\";return function(i,a){if(\"executing\"===n)throw new Error(\"Generator is already running\");if(\"completed\"===n){if(\"throw\"===i)throw a;return A()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=k(o,r);if(s){if(s===u)continue;return s}}if(\"next\"===r.method)r.sent=r._sent=r.arg;else if(\"throw\"===r.method){if(\"suspendedStart\"===n)throw n=\"completed\",r.arg;r.dispatchException(r.arg)}else\"return\"===r.method&&r.abrupt(\"return\",r.arg);n=\"executing\";var c=v(e,t,r);if(\"normal\"===c.type){if(n=r.done?\"completed\":\"suspendedYield\",c.arg===u)continue;return{value:c.arg,done:r.done}}\"throw\"===c.type&&(n=\"completed\",r.method=\"throw\",r.arg=c.arg)}}}(e,r,o),a}function v(e,t,r){try{return{type:\"normal\",arg:e.call(t,r)}}catch(e){return{type:\"throw\",arg:e}}}function _(){}function g(){}function y(){}function b(e){[\"next\",\"throw\",\"return\"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function I(e){var t;this._invoke=function(r,i){function a(){return new Promise((function(t,a){!function t(r,i,a,o){var s=v(e[r],e,i);if(\"throw\"!==s.type){var c=s.arg,d=c.value;return d&&\"object\"==typeof d&&n.call(d,\"__await\")?Promise.resolve(d.__await).then((function(e){t(\"next\",e,a,o)}),(function(e){t(\"throw\",e,a,o)})):Promise.resolve(d).then((function(e){c.value=e,a(c)}),o)}o(s.arg)}(r,i,t,a)}))}return t=t?t.then(a,a):a()}}function k(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,\"throw\"===t.method){if(e.iterator.return&&(t.method=\"return\",t.arg=void 0,k(e,t),\"throw\"===t.method))return u;t.method=\"throw\",t.arg=new TypeError(\"The iterator does not provide a 'throw' method\")}return u}var n=v(r,e.iterator,t.arg);if(\"throw\"===n.type)return t.method=\"throw\",t.arg=n.arg,t.delegate=null,u;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,\"return\"!==t.method&&(t.method=\"next\",t.arg=void 0),t.delegate=null,u):i:(t.method=\"throw\",t.arg=new TypeError(\"iterator result is not an object\"),t.delegate=null,u)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type=\"normal\",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:\"root\"}],e.forEach(P,this),this.reset(!0)}function T(e){if(e){var t=e[a];if(t)return t.call(e);if(\"function\"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}}(function(){return this}()||Function(\"return this\")())},function(e,t,r){r(56),r(32),r(41),r(130),r(134),r(135),e.exports=r(7).Promise},function(e,t,r){var n=r(66),i=r(67);e.exports=function(e){return function(t,r){var a,o,s=String(i(t)),c=n(r),d=s.length;return c<0||c>=d?e?\"\":void 0:(a=s.charCodeAt(c))<55296||a>56319||c+1===d||(o=s.charCodeAt(c+1))<56320||o>57343?e?s.charAt(c):a:e?s.slice(c,c+2):o-56320+(a-55296<<10)+65536}}},function(e,t,r){\"use strict\";var n=r(57),i=r(48),a=r(51),o={};r(29)(o,r(15)(\"iterator\"),(function(){return this})),e.exports=function(e,t,r){e.prototype=n(o,{next:i(1,r)}),a(e,t+\" Iterator\")}},function(e,t,r){var n=r(22),i=r(25),a=r(49);e.exports=r(23)?Object.defineProperties:function(e,t){i(e);for(var r,o=a(t),s=o.length,c=0;s>c;)n.f(e,r=o[c++],t[r]);return e}},function(e,t,r){var n=r(40),i=r(58),a=r(127);e.exports=function(e){return function(t,r,o){var s,c=n(t),d=i(c.length),u=a(o,d);if(e&&r!=r){for(;d>u;)if((s=c[u++])!=s)return!0}else for(;d>u;u++)if((e||u in c)&&c[u]===r)return e||u||0;return!e&&-1}}},function(e,t,r){var n=r(66),i=Math.max,a=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):a(e,t)}},function(e,t,r){\"use strict\";var n=r(129),i=r(92),a=r(39),o=r(40);e.exports=r(68)(Array,\"Array\",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,\"keys\"==t?r:\"values\"==t?e[r]:[r,e[r]])}),\"values\"),a.Arguments=a.Array,n(\"keys\"),n(\"values\"),n(\"entries\")},function(e,t){e.exports=function(){}},function(e,t,r){\"use strict\";var n,i,a,o,s=r(46),c=r(14),d=r(27),u=r(60),l=r(12),p=r(19),f=r(47),m=r(75),h=r(52),v=r(95),_=r(96).set,g=r(132)(),y=r(77),b=r(97),I=r(133),k=r(98),P=c.TypeError,S=c.process,w=S&&S.versions,T=w&&w.v8||\"\",A=c.Promise,E=\"process\"==u(S),R=function(){},C=i=y.f,O=!!function(){try{var e=A.resolve(1),t=(e.constructor={})[r(15)(\"species\")]=function(e){e(R,R)};return(E||\"function\"==typeof PromiseRejectionEvent)&&e.then(R)instanceof t&&0!==T.indexOf(\"6.6\")&&-1===I.indexOf(\"Chrome/66\")}catch(e){}}(),N=function(e){var t;return!(!p(e)||\"function\"!=typeof(t=e.then))&&t},x=function(e,t){if(!e._n){e._n=!0;var r=e._c;g((function(){for(var n=e._v,i=1==e._s,a=0,o=function(t){var r,a,o,s=i?t.ok:t.fail,c=t.resolve,d=t.reject,u=t.domain;try{s?(i||(2==e._h&&M(e),e._h=1),!0===s?r=n:(u&&u.enter(),r=s(n),u&&(u.exit(),o=!0)),r===t.promise?d(P(\"Promise-chain cycle\")):(a=N(r))?a.call(r,c,d):c(r)):d(n)}catch(e){u&&!o&&u.exit(),d(e)}};r.length>a;)o(r[a++]);e._c=[],e._n=!1,t&&!e._h&&L(e)}))}},L=function(e){_.call(c,(function(){var t,r,n,i=e._v,a=D(e);if(a&&(t=b((function(){E?S.emit(\"unhandledRejection\",i,e):(r=c.onunhandledrejection)?r({promise:e,reason:i}):(n=c.console)&&n.error&&n.error(\"Unhandled promise rejection\",i)})),e._h=E||D(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},M=function(e){_.call(c,(function(){var t;E?S.emit(\"rejectionHandled\",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},B=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),x(t,!0))},V=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw P(\"Promise can't be resolved itself\");(t=N(e))?g((function(){var n={_w:r,_d:!1};try{t.call(e,d(V,n,1),d(B,n,1))}catch(e){B.call(n,e)}})):(r._v=e,r._s=1,x(r,!1))}catch(e){B.call({_w:r,_d:!1},e)}}};O||(A=function(e){m(this,A,\"Promise\",\"_h\"),f(e),n.call(this);try{e(d(V,this,1),d(B,this,1))}catch(e){B.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(78)(A.prototype,{then:function(e,t){var r=C(v(this,A));return r.ok=\"function\"!=typeof e||e,r.fail=\"function\"==typeof t&&t,r.domain=E?S.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&x(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new n;this.promise=e,this.resolve=d(V,e,1),this.reject=d(B,e,1)},y.f=C=function(e){return e===A||e===o?new a(e):i(e)}),l(l.G+l.W+l.F*!O,{Promise:A}),r(51)(A,\"Promise\"),r(99)(\"Promise\"),o=r(7).Promise,l(l.S+l.F*!O,\"Promise\",{reject:function(e){var t=C(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!O),\"Promise\",{resolve:function(e){return k(s&&this===o?A:this,e)}}),l(l.S+l.F*!(O&&r(100)((function(e){A.all(e).catch(R)}))),\"Promise\",{all:function(e){var t=this,r=C(t),n=r.resolve,i=r.reject,a=b((function(){var r=[],a=0,o=1;h(e,!1,(function(e){var s=a++,c=!1;r.push(void 0),o++,t.resolve(e).then((function(e){c||(c=!0,r[s]=e,--o||n(r))}),i)})),--o||n(r)}));return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=C(t),n=r.reject,i=b((function(){h(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}})},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(14),i=r(96).set,a=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,c=\"process\"==r(50)(o);e.exports=function(){var e,t,r,d=function(){var n,i;for(c&&(n=o.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){o.nextTick(d)};else if(!a||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var u=s.resolve(void 0);r=function(){u.then(d)}}else r=function(){i.call(n,d)};else{var l=!0,p=document.createTextNode(\"\");new a(d).observe(p,{characterData:!0}),r=function(){p.data=l=!l}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){var n=r(14).navigator;e.exports=n&&n.userAgent||\"\"},function(e,t,r){\"use strict\";var n=r(12),i=r(7),a=r(14),o=r(95),s=r(98);n(n.P+n.R,\"Promise\",{finally:function(e){var t=o(this,i.Promise||a.Promise),r=\"function\"==typeof e;return this.then(r?function(r){return s(t,e()).then((function(){return r}))}:e,r?function(r){return s(t,e()).then((function(){throw r}))}:e)}})},function(e,t,r){\"use strict\";var n=r(12),i=r(77),a=r(97);n(n.S,\"Promise\",{try:function(e){var t=i.f(this),r=a(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t,r){var n=r(7),i=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,r){r(138),e.exports=r(7).Object.getPrototypeOf},function(e,t,r){var n=r(35),i=r(91);r(79)(\"getPrototypeOf\",(function(){return function(e){return i(n(e))}}))},function(e,t,r){e.exports={default:r(140),__esModule:!0}},function(e,t,r){r(141);var n=r(7).Object;e.exports=function(e,t,r){return n.defineProperty(e,t,r)}},function(e,t,r){var n=r(12);n(n.S+n.F*!r(23),\"Object\",{defineProperty:r(22).f})},function(e,t,r){e.exports={default:r(143),__esModule:!0}},function(e,t,r){r(32),r(41),e.exports=r(80).f(\"iterator\")},function(e,t,r){e.exports={default:r(145),__esModule:!0}},function(e,t,r){r(146),r(56),r(149),r(150),e.exports=r(7).Symbol},function(e,t,r){\"use strict\";var n=r(14),i=r(34),a=r(23),o=r(12),s=r(88),c=r(61).KEY,d=r(33),u=r(73),l=r(51),p=r(59),f=r(15),m=r(80),h=r(81),v=r(147),_=r(101),g=r(25),y=r(19),b=r(35),I=r(40),k=r(70),P=r(48),S=r(57),w=r(148),T=r(103),A=r(82),E=r(22),R=r(49),C=T.f,O=E.f,N=w.f,x=n.Symbol,L=n.JSON,D=L&&L.stringify,M=f(\"_hidden\"),B=f(\"toPrimitive\"),V={}.propertyIsEnumerable,j=u(\"symbol-registry\"),F=u(\"symbols\"),U=u(\"op-symbols\"),G=Object.prototype,H=\"function\"==typeof x&&!!A.f,K=n.QObject,W=!K||!K.prototype||!K.prototype.findChild,z=a&&d((function(){return 7!=S(O({},\"a\",{get:function(){return O(this,\"a\",{value:7}).a}})).a}))?function(e,t,r){var n=C(G,t);n&&delete G[t],O(e,t,r),n&&e!==G&&O(G,t,n)}:O,X=function(e){var t=F[e]=S(x.prototype);return t._k=e,t},q=H&&\"symbol\"==typeof x.iterator?function(e){return\"symbol\"==typeof e}:function(e){return e instanceof x},Y=function(e,t,r){return e===G&&Y(U,t,r),g(e),t=k(t,!0),g(r),i(F,t)?(r.enumerable?(i(e,M)&&e[M][t]&&(e[M][t]=!1),r=S(r,{enumerable:P(0,!1)})):(i(e,M)||O(e,M,P(1,{})),e[M][t]=!0),z(e,t,r)):O(e,t,r)},J=function(e,t){g(e);for(var r,n=v(t=I(t)),i=0,a=n.length;a>i;)Y(e,r=n[i++],t[r]);return e},Q=function(e){var t=V.call(this,e=k(e,!0));return!(this===G&&i(F,e)&&!i(U,e))&&(!(t||!i(this,e)||!i(F,e)||i(this,M)&&this[M][e])||t)},$=function(e,t){if(e=I(e),t=k(t,!0),e!==G||!i(F,t)||i(U,t)){var r=C(e,t);return!r||!i(F,t)||i(e,M)&&e[M][t]||(r.enumerable=!0),r}},Z=function(e){for(var t,r=N(I(e)),n=[],a=0;r.length>a;)i(F,t=r[a++])||t==M||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===G,n=N(r?U:I(e)),a=[],o=0;n.length>o;)!i(F,t=n[o++])||r&&!i(G,t)||a.push(F[t]);return a};H||(s((x=function(){if(this instanceof x)throw TypeError(\"Symbol is not a constructor!\");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===G&&t.call(U,r),i(this,M)&&i(this[M],e)&&(this[M][e]=!1),z(this,e,P(1,r))};return a&&W&&z(G,e,{configurable:!0,set:t}),X(e)}).prototype,\"toString\",(function(){return this._k})),T.f=$,E.f=Y,r(102).f=w.f=Z,r(62).f=Q,A.f=ee,a&&!r(46)&&s(G,\"propertyIsEnumerable\",Q,!0),m.f=function(e){return X(f(e))}),o(o.G+o.W+o.F*!H,{Symbol:x});for(var te=\"hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables\".split(\",\"),re=0;te.length>re;)f(te[re++]);for(var ne=R(f.store),ie=0;ne.length>ie;)h(ne[ie++]);o(o.S+o.F*!H,\"Symbol\",{for:function(e){return i(j,e+=\"\")?j[e]:j[e]=x(e)},keyFor:function(e){if(!q(e))throw TypeError(e+\" is not a symbol!\");for(var t in j)if(j[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),o(o.S+o.F*!H,\"Object\",{create:function(e,t){return void 0===t?S(e):J(S(e),t)},defineProperty:Y,defineProperties:J,getOwnPropertyDescriptor:$,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});var ae=d((function(){A.f(1)}));o(o.S+o.F*ae,\"Object\",{getOwnPropertySymbols:function(e){return A.f(b(e))}}),L&&o(o.S+o.F*(!H||d((function(){var e=x();return\"[null]\"!=D([e])||\"{}\"!=D({a:e})||\"{}\"!=D(Object(e))}))),\"JSON\",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(y(t)||void 0!==e)&&!q(e))return _(t)||(t=function(e,t){if(\"function\"==typeof r&&(t=r.call(this,e,t)),!q(t))return t}),n[1]=t,D.apply(L,n)}}),x.prototype[B]||r(29)(x.prototype,B,x.prototype.valueOf),l(x,\"Symbol\"),l(Math,\"Math\",!0),l(n.JSON,\"JSON\",!0)},function(e,t,r){var n=r(49),i=r(82),a=r(62);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var o,s=r(e),c=a.f,d=0;s.length>d;)c.call(e,o=s[d++])&&t.push(o);return t}},function(e,t,r){var n=r(40),i=r(102).f,a={}.toString,o=\"object\"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&\"[object Window]\"==a.call(e)?function(e){try{return i(e)}catch(e){return o.slice()}}(e):i(n(e))}},function(e,t,r){r(81)(\"asyncIterator\")},function(e,t,r){r(81)(\"observable\")},function(e,t,r){e.exports={default:r(152),__esModule:!0}},function(e,t,r){r(153),e.exports=r(7).Object.setPrototypeOf},function(e,t,r){var n=r(12);n(n.S,\"Object\",{setPrototypeOf:r(154).set})},function(e,t,r){var n=r(19),i=r(25),a=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+\": can't set as prototype!\")};e.exports={set:Object.setPrototypeOf||(\"__proto__\"in{}?function(e,t,n){try{(n=r(27)(Function.call,r(103).f(Object.prototype,\"__proto__\").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return a(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:a}},function(e,t,r){e.exports={default:r(156),__esModule:!0}},function(e,t,r){r(157);var n=r(7).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){var n=r(12);n(n.S,\"Object\",{create:r(57)})},function(e,t,r){r(56),r(32),r(41),r(159),r(163),r(165),r(166),e.exports=r(7).Map},function(e,t,r){\"use strict\";var n=r(104),i=r(83);e.exports=r(105)(\"Map\",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=n.getEntry(i(this,\"Map\"),e);return t&&t.v},set:function(e,t){return n.def(i(this,\"Map\"),0===e?0:e,t)}},n,!0)},function(e,t,r){var n=r(27),i=r(71),a=r(35),o=r(58),s=r(161);e.exports=function(e,t){var r=1==e,c=2==e,d=3==e,u=4==e,l=6==e,p=5==e||l,f=t||s;return function(t,s,m){for(var h,v,_=a(t),g=i(_),y=n(s,m,3),b=o(g.length),I=0,k=r?f(t,b):c?f(t,0):void 0;b>I;I++)if((p||I in g)&&(v=y(h=g[I],I,_),e))if(r)k[I]=v;else if(v)switch(e){case 3:return!0;case 5:return h;case 6:return I;case 2:k.push(h)}else if(u)return!1;return l?-1:d||u?u:k}}},function(e,t,r){var n=r(162);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(19),i=r(101),a=r(15)(\"species\");e.exports=function(e){var t;return i(e)&&(\"function\"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(12);n(n.P+n.R,\"Map\",{toJSON:r(106)(\"Map\")})},function(e,t,r){var n=r(52);e.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},function(e,t,r){r(107)(\"Map\")},function(e,t,r){r(108)(\"Map\")},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=E(r(43)),i=E(r(26)),a=E(r(6)),o=E(r(54)),s=E(r(64)),c=E(r(65)),d=E(r(9)),u=E(r(17)),l=E(r(8)),p=E(r(2)),f=E(r(0)),m=E(r(1)),h=E(r(3)),v=E(r(4)),_=E(r(31)),g=E(r(110)),y=A(r(53)),b=E(r(112)),I=A(r(113)),k=r(30),P=A(r(42)),S=A(r(219)),w=A(r(117)),T=E(r(225));function A(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function E(e){return e&&e.__esModule?e:{default:e}}var R=r(28),C=r(229),O=new _.default(\"Client\"),N={},x=!0,L=\"DISCONNECTED\",D=\"CONNECTING\",M=\"CONNECTED\",B=\"DISCONNECTING\",V=function(t){function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,f.default)(this,r);var n=(0,h.default)(this,(r.__proto__||(0,p.default)(r)).call(this));n._spy=!1,n._devices=null,n._mapVideoProducers=new l.default,n._audioProducer=null,n._mapVideoSendTransports=new l.default,n._sendTransport=null,n._recvTransport=null,n._publishStreams=new l.default,n._remoteStreams=new l.default,n._remoteAudios=new l.default,n._remoteVideos=new l.default,n._publishs=new l.default,n._subscribes=new l.default,n._protooTransportStat=!1,n._protooSessionId=\"\",n._protooPeer=null,n._room=null,n._screenProducer=null,n._screenTransport=null,n._iceSendDisconnectedCnt=0,n._iceRecvDisconnectedCnt=0,n._peers=new l.default,n._stats=new T.default,n._transportInfo={recvTransport:{localIp:\"\",localPort:\"\",remoteIp:\"\",remotePort:\"\"},sendTransport:{}},n._rtmpUrls=new l.default,n._interval=3e3,n._hostPath=\"\",n._ip=\"\",n._port=3443,n._path=\"\",n._token=null,n._spec=JSON.parse((0,u.default)(t)),n._useSimulcast=!1,n._tryJoin=0,n._joinTimer=null,n._joinTrying=!1,n._ipLocation=null,n._iplocTimer=null,n._iplocResoved=!1,n._hasInit=!1,n._closed=!1,n._closing=!1,n._connState=L,n._joined=!1,n._uuid=y.uuid(),n._connectId=y.uuid(),n._appId=\"\",n._uid=\"\",n._roomId=\"\",e.g_appid=\"\",e.g_clientUuid=n._uuid,e.g_myPublicIP=\"\",e.g_userid=\"\",e.g_role=\"\",e.g_roomid=\"\",e.g_server=\"\",e.g_connectId=\"\",e.g_sessionId=\"\";var i=!!R.mobile,a=\"safari\"===R.name.toLowerCase(),o=\"firefox\"===R.name.toLowerCase(),s=(R.name.toLowerCase(),\"string\"==typeof t.audioCodec&&\"\"!==t.audioCodec.trim()?t.audioCodec.trim():\"isac\");if(n._audioCodec=a||i||o?\"opus\":s,n._h264ProfileLevelId=\"string\"==typeof t.h264ProfileLevelId&&\"\"!==t.h264ProfileLevelId.trim()?t.h264ProfileLevelId.trim():\"42e01f\",n._disableRtmpVideo=Boolean(t.disableRtmpVideo),n._allRtmpLiveMixerLayout=new l.default,n._timesOfLinkGW=1,n._linkGWTime=0,n._sendGWTime=void 0,n._sendEnterTime=void 0,n._defaultRtmpUrl=\"\",n._validRtmpUrl=\"\",\"string\"==typeof t.rtmpUrl&&(n._validRtmpUrl=t.rtmpUrl.trim()),\"string\"==typeof t.videoMixerBGIUrl&&\"\"!==t.videoMixerBGIUrl.trim()?n._videoMixerBGIUrl=t.videoMixerBGIUrl.trim():(t.videoMixerBGIUrl=\"http://3ttech.cn/res/tpl/default/images/bk.png\",n._videoMixerBGIUrl=t.videoMixerBGIUrl),!/^[123]$/.test(t.role))throw O.warn(\"API createClient() error - spec: role must be set as 1: master, 2: vice 3: audience.\"),new TypeError(\"role must be set as 1: master, 2: vice 3: audience\");return n._role=t.role+\"\",e.g_role=n._role,n._statsInterval=null,n._networkQualityInterval=null,n}var _,k,A,E,V,j,F,U,G,H,K,W,z,X,q,Y,J,Q,$,Z,ee,te,re,ne,ie;return(0,v.default)(r,t),(0,m.default)(r,[{key:\"getServer\",value:function(){return this._hostPath}},{key:\"_startNetworkQualityInterval\",value:function(){var e=this;this._stopNetworkQualityInterval(),this._networkQualityInterval=setInterval((function(){e._NetworkQuality()}),2e3)}},{key:\"_stopNetworkQualityInterval\",value:function(){this._networkQualityInterval&&(clearInterval(this._networkQualityInterval),this._networkQualityInterval=null)}},{key:\"_startStatInterval\",value:function(){var e=this;this._statsInterval=setInterval((function(){if(x){var t=[];e._publishs.forEach((function(e,r){if(e){var n=e.stream?e.stream.audioTrackStatus:{},i=e.stream?e.stream.videoTrackStatus:{},a={streamId:e.streamId,published:e.published,audioTrackStatus:n,videoTrackStatus:i,status:e.status};t.push(a)}}));var r=[];e._subscribes.forEach((function(e,t){if(e){var n=e.stream?e.stream.audioTrackStatus:{},i=e.stream?e.stream.videoTrackStatus:{},a={userId:e.userId,streamId:e.streamId,audioSubscribed:e.audioSubscribed,audioTrackStatus:n,videoSubscribed:e.videoSubscribed,videoTrackStatus:i};r.push(a)}}));var n=[];e._remoteAudios.forEach((function(e,t){n.push(e)}));var i=[];e._remoteVideos.forEach((function(e,t){i.push(e)}));var a={host:e._ip,appId:e._appId,userId:e._uid,role:e._role,roomId:e._roomId,connState:e._connState,joined:e._joined,iceSendTransport:{state:e._sendTransport?e._sendTransport.connectionState:\"idle\",retryTimeTotal:e._sendTransport?e._sendTransport.retryTimeTotal:0,disconnCnt:e._iceSendDisconnectedCnt},iceRecvTransport:{state:e._recvTransport?e._recvTransport.connectionState:\"idle\",retryTimeTotal:e._recvTransport?e._recvTransport.retryTimeTotal:0,disconnCnt:e._iceRecvDisconnectedCnt},audioCodec:e._audioCodec,publishs:t,subscribes:r,remoteAudios:n,remoteVideos:i};O.stat(\"clientStat:\"+(0,u.default)(a));var o=e.getNetState();O.stat(\"netState:\"+(0,u.default)(o));var s=e.localAudioStats();O.stat(\"localAudioStats:\"+(0,u.default)(s));var c=e.remoteAudioStats();O.stat(\"remoteAudioStats:\"+(0,u.default)(c));var d=e.localVideoStats();O.stat(\"localVideoStats:\"+(0,u.default)(d));var l=e.remoteVideoStats();O.stat(\"remoteVideoStats:\"+(0,u.default)(l))}}),15e3)}},{key:\"_stopStatInterval\",value:function(){null!==this._statsInterval&&(clearInterval(this._statsInterval),this._statsInterval=null)}},{key:\"init\",value:function(t,r,n,i){var a=this;if(\"function\"!=typeof n)throw O.error(\"API init() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess parameter must be a function.\");if(\"function\"!=typeof i)throw O.error(\"API init() error - parameter: onFailure invalid\"),new TypeError(\"onFailure parameter must be a function.\");if(this._hasInit)return O.error(\"API init() error - [CLIENT_HAS_ALREADY_INIT] - Client has Already initialized\"),void i(\"CLIENT_HAS_ALREADY_INIT\",{code:P.tttErrCode.CLIENT_HAS_ALREADY_INIT,name:\"CLIENT_HAS_ALREADY_INIT\",origin:\"\",message:\"Client has Already initialized - please client.close() at first\"});if(!t||\"\"===(\"\"+t).trim())return O.warn(\"API init() error - [INVALID_APPID] - parameter: appId invalid\"),void i(\"INVALID_APPID\",{code:P.tttErrCode.INVALID_APPID,name:\"INVALID_APPID\",origin:\"\",message:\"invalid appId\"});if(!/^[1-9][0-9]{0,18}$/.test(r))return O.warn(\"API init() error - [INVALID_USERID] - parameter: userId invalid - uid: \"+r),void i(\"INVALID_USERID\",{code:P.tttErrCode.INVALID_USERID,name:\"INVALID_USERID\",origin:\"\",message:\"userId must be valid number - [1 ~ 9007199254740991]\"});if(r>Math.pow(2,53)-1)return O.warn(\"API init() error - [INVALID_USERID] - parameter: userId number is out of range - [1 ~ 9007199254740991]\"),void i(\"INVALID_USERID\",{code:P.tttErrCode.INVALID_USERID,name:\"INVALID_USERID\",origin:\"\",message:\"userId must be valid number - [1 ~ 9007199254740991]\"});this._joinTrying=!1,this._uid=\"\"+r,e.g_appid=t,e.g_userid=this._uid,this._appId=t,this._stats.setAppid(t),O.debug(\"API init() appId: \"+t+\" uid: \"+r+\" this._spec: \"+(0,u.default)(this._spec)),e.g_PreFun.push({f:\"init\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"appId-\"+t+\",uid-\"+r}),this._startStatInterval();var o=g.default.MediaServerAddress;if(o&&\"\"!==o.trim())return o=o.trim(),this._hostPath=o,this._parseMsHost(o),this._ip&&\"\"!==this._ip?(this._stats.setDomain(this._ip),O.debug(\"API init() success - special media server: \"+this._hostPath),this._watchDeviceChange(),this._hasInit=!0,n()):i(\"IPLOC_FAIL\",{code:P.tttErrCode.IPLOC_FAIL,name:\"IPLOC_FAIL\",origin:\"\",message:\"iplocation error - msHost: \"+o});this._iplocResoved=!1,this._iplocTimer=setTimeout((function(){a._iplocTimer&&(clearTimeout(a._iplocTimer),a._iplocTimer=null),a._ipLocation&&(a._ipLocation.close(),a._ipLocation=null),a._closed=!0,a._iplocResoved||i(\"IPLOC_FAIL\",{code:P.tttErrCode.IPLOC_FAIL,name:\"IPLOC_FAIL\",origin:\"\",message:\"iplocation error - TIMEOUT\"})}),4e3),this._ipLocation=new g.default(t,+r,this._connectId,(function(e,t){return O.debug(\"API init() success - iplocation alloc server: \"+e.domain),a._hostPath=e.domain,a._parseMsHost(e.domain),a._stats.setDomain(a._ip),a._stats.setGWInfo(t),a._stats.setIPlocationInfo(a._ipLocation.info),a._watchDeviceChange(),a._iplocResoved=!0,a._hasInit=!0,a._iplocTimer&&(clearTimeout(a._iplocTimer),a._iplocTimer=null),a._ipLocation&&(a._ipLocation.close(),a._ipLocation=null),n()}),(function(e){a._stopStatInterval(),a._iplocTimer&&(clearTimeout(a._iplocTimer),a._iplocTimer=null),a._ipLocation&&(a._ipLocation.close(),a._ipLocation=null),a._closed||(O.warn(\"API init() fail - [IPLOC_FAIL] - iplocation error - \"+e.code+\" \"+e.message),i(\"IPLOC_FAIL\",{code:e.code,name:\"IPLOC_FAIL\",origin:\"\"+e.code,message:\"iplocation error - \"+e.message+\"}\"}))}))}},{key:\"_parseMsHost\",value:function(e){var t=/^(wss?:\\/\\/)?([0-9a-z.\\-_]+)(:[0-9]+)?([/0-9a-z.\\-_]+)?(\\?[0-9a-z&=]+)?(#[0-9-a-z]+)?/i.exec(e);if(t&&t[2]){var r=t[2];this._ip=r.trim()}if(t&&t[3]){var n=t[3],i=parseInt(n.slice(1));i&&(this._port=i)}else this._port=3443;if(t&&t[4]){var a=t[4];this._path=a.trim()}O.debug(\"_parseHost msHost: \"+e+\" this._ip: \"+this._ip+\" this._port: \"+this._port+\" this._path: \"+this._path)}},{key:\"_watchDeviceChange\",value:function(){var t=this;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then((function(r){t._devices=JSON.parse((0,u.default)(r));var n=!1;navigator.mediaDevices.ondevicechange=function(r){setTimeout((function(){n||(n=!0,navigator.mediaDevices.enumerateDevices().then((function(r){O.debug(\"_watchDeviceChange() ondevicechange -- updated-devices: \"+(0,u.default)(r)+\" - this._devices: \"+(0,u.default)(t._devices));var n=[];t._devices.forEach((function(e,t){var i=!1;r.forEach((function(t,r){e.deviceId==t.deviceId&&e.kind==t.kind&&e.label==t.label&&e.groupId==t.groupId&&(i=!0)})),i||\"communications\"!==e.deviceId&&\"default\"!==e.deviceId&&n.push(JSON.parse((0,u.default)(e)))}));var i=[];if(r.forEach((function(e,r){var n=!1;t._devices.forEach((function(t,r){e.deviceId==t.deviceId&&e.kind==t.kind&&e.label==t.label&&e.groupId==t.groupId&&(n=!0)})),n||\"communications\"!==e.deviceId&&\"default\"!==e.deviceId&&i.push(JSON.parse((0,u.default)(e)))})),t._devices=JSON.parse((0,u.default)(r)),i.length>0||n.length>0){var a={plugDevices:i,pullDevices:n};O.debug(\"_watchDeviceChange() - Emit [device-hot-plug] to APP - \"+(0,u.default)(a)),O.clbLog({f:\"device-hot-plug\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"evt-\"+(0,u.default)(a)}),t.emit(\"device-hot-plug\",a)}})).catch((function(e){O.warn(\"_watchDeviceChange() fail - \"+e.name+\" \"+e.message)})).finally((function(){n=!1})))}),500)},O.debug(\"_watchDeviceChange() -- devices: \"+(0,u.default)(t._devices))})).catch((function(e){O.warn(\"_watchDeviceChange() fail - \"+e.name+\" \"+e.message)}))}},{key:\"_onClientClose\",value:function(e){this._protooTransportStat=!1,O.warn(\"_onClientClose() - \"+e.code+\" \"+e.reason+\" -- call this.close()\"),this.close(e)}},{key:\"_NetworkQuality\",value:function(){var e=0,t=0;if(this._stats){var r=0,n=this._stats.summarize.rtt;n<0||n>1e3?r=5:n<=100?r=1:n<=200?r=2:n<=500?r=3:n<=1e3&&(r=4);var i=0,a=this._stats.summarize.upFractionLost;a>.2?i=5:a<=.02?i=1:a<=.05?i=2:a<=.1?i=3:a<=.2&&(i=4),e=i>r?i:r;var o=0,s=this._stats.summarize.downFractionLost;s>.2?o=5:s<=.02?o=1:s<=.05?o=2:s<=.1?o=3:s<=.2&&(o=4),t=o>r?o:r}var c=\"failed\"===this._sendTransport.connectionState||\"disconnected\"===this._sendTransport.connectionState,d={downlinkNetworkQuality:\"failed\"===this._recvTransport.connectionState||\"disconnected\"===this._recvTransport.connectionState?\"6\":\"\"+t,uplinkNetworkQuality:c?\"6\":\"\"+e};this.emit(\"network-quality\",d)}},{key:\"_ChangeConnStat\",value:function(t){var r=t.event,n=t.state,i=this._connState;this._connState=n;var a={prevState:i,curState:this._connState,description:\"\"+r};O.debug(\"_ChangeConnStat() event: \"+r+\" - Emit [connection-state-change] \"+(0,u.default)(a)+\" to APP\"),O.clbLog({f:\"connection-state-change\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"notify-\"+(0,u.default)(a)}),this.emit(\"connection-state-change\",a)}},{key:\"join\",value:function(t,r,n,i){var a=this;if(\"function\"!=typeof n)throw O.error(\"API join() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess parameter must be a function.\");if(\"function\"!=typeof i)throw O.error(\"API join() error - parameter: onFailure invalid\"),new TypeError(\"onFailure parameter must be a function.\");if(this._connState===D)return O.warn(\"clientConnState.CONNECTING - [TASK_PROCEEDING] - join is running...\"),i(\"TASK_PROCEEDING\",{code:P.tttErrCode.TASK_PROCEEDING,name:\"TASK_PROCEEDING\",origin:\"\",message:\"clientConnState.CONNECTING - join is running...\"});if(!/^[1-9][0-9]{0,18}$/.test(r))return O.warn(\"API join() error - [INVALID_CHANNELID] - parameter: roomId invalid - roomId: \"+r),i(\"INVALID_CHANNELID\",{code:P.tttErrCode.INVALID_CHANNELID,name:\"INVALID_CHANNELID\",origin:\"\",message:\"roomId number is out of range - [1 ~ 9007199254740991]\"});if(r>Math.pow(2,53)-1)return O.warn(\"API join() error - [INVALID_CHANNELID] - parameter: roomId number is out of range - [1 ~ 9007199254740991]\"),i(\"INVALID_CHANNELID\",{code:P.tttErrCode.INVALID_CHANNELID,name:\"INVALID_CHANNELID\",origin:\"\",message:\"roomId number is out of range - [1 ~ 9007199254740991]\"});e.g_roomid=r,e.g_server=this._hostPath,O.debug(\"API join() >> this._hostPath: \"+this._hostPath+\" - params roomId: \"+r+\" role: \"+this._role+\" - tryJoin: \"+this._tryJoin),e.g_PreFun.push({f:\"join\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"token-\"+t+\",roomId-\"+r}),O.funLog(e.g_PreFun),this._token=\"string\"==typeof t&&\"\"!==t?t:null,r+=\"\",this._roomId=r,this._stats.setRoomId(r),this._stats.setUserId(this._uid),this._stats.setRoleType(+this._role);I.getDeviceInfo();var o=y.getProtooUrl(this._uid,r,this._appId,this._ip,this._port,this._path);if(this._linkGWTime=Date.now(),this._protooSessionId=w.randomNumberGenerator(),this._protooPeer&&this._protooPeer.close(),this._protooPeer=new S.Peer(o,this._protooSessionId,this._spec.retries),!this._protooPeer)return this._innerClose({code:4009,reason:\"protoo[except]\"}),O.warn(\"API join() << error - [OBJECT_FAIL] - new protooClient.Peer fail\"),void i(\"OBJECT_FAIL\",{code:P.tttErrCode.OBJECT_FAIL,name:\"OBJECT_FAIL\",origin:\"\",message:\"create protooClient.Peer fail\"});this.removeAllListeners(\"@join-success\"),this.on(\"@join-success\",(function(e){a._joinTrying=!1,O.debug(\"API join() << succ - [@join-success] - connectId: \"+e.connectId+\" -- Emit [enter] to APP\"),a.emit(\"enter\"),a._startNetworkQualityInterval(),n(\"You are join the room\")})),this.removeAllListeners(\"@join-failure\"),this.on(\"@join-failure\",(function(e){O.warn(\"API join() << fail - [JOIN_FAIL] - \"+e),i(\"JOIN_FAIL\",{code:P.tttErrCode.JOIN_FAIL,name:\"JOIN_FAIL\",origin:\"\",message:\"join-failure: \"+e})})),this._joinTimer=setTimeout((function(){if(a._joined)return a._joinTimer&&clearTimeout(a._joinTimer),void(a._joinTimer=null);a._tryJoin++,O.warn(\"_joinTimer - this._tryJoin: \"+a._tryJoin),+a._tryJoin<3?(a._joinTrying=!0,a._innerClose({code:3007,reason:\"join timeout - will retry\"}),a._room=null,a._protooPeer&&(a._protooPeer.close(),a._protooPeer=null),setTimeout((function(){a.join(a._token,a._roomId,n,i)}))):(O.warn(\"API join() << fail - [JOIN_FAIL] - join room timeout\"),a._joinTimer=null,a._joinTrying=!1,a._tryJoin=0,a.close({code:5e3,reason:\"join timeout\"}),a._stats.sendTimeOutLog(a._timesOfLinkGW,12e3),i(\"JOIN_FAIL\",{code:P.tttErrCode.JOIN_FAIL,name:\"JOIN_FAIL\",origin:\"\",message:\"join timeout\"}))}),4e3),this._handleProtooEvent(),this._ChangeConnStat({event:\"joining\",state:D})}},{key:\"_joinRoom\",value:function(){var t=this;O.debug(\"_joinRoom() try to join room...\");this._room=new I.Room({requestTimeout:3e4,transportOptions:{udp:!0,tcp:Boolean(!1)},spy:this._spy,iceTransportPolicy:N.iceTransportPolicy||\"all\",enableTurn:!!N.enableTurn,h264ProfileLevelId:this._h264ProfileLevelId,turnServers:N.iceServers||[]}),this._room.removeAllListeners(),this._room.removeAllListeners(\"close\"),this._room.on(\"close\",(function(e,r){\"remote\"===e&&(O.warn(\"room event -- [close] mediasoup Peer/Room remotely closed -- appData: \"+(0,u.default)(r)),t._stats.stopHeartBeat())})),this._room.removeAllListeners(\"request\"),this._room.on(\"request\",(function(e,r,n){O.debug(\"room event -- [request:\"+e.method+\"] sending to mediasoup \"),t._protooPeer&&t._protooPeer.send(\"mediasoup-request\",e).then(r).catch(n)})),this._room.removeAllListeners(\"notify\"),this._room.on(\"notify\",(function(e){t._closed||t._protooPeer&&t._protooPeer.send(\"mediasoup-notification\",e).catch((function(e){O.warn(\"Send mediasoup notification fail - \"+e.name+\" \"+e.message)}))})),this._room.removeAllListeners(\"newpeer\"),this._room.on(\"newpeer\",(function(e){O.debug(\"room event -- [newpeer] userId: \"+e.name),t._peers.set(\"\"+e.name,e),t._handlePeer(e)}));var r={displayName:this._uid,device:\"webcam\",role:this._role,connectId:this._connectId,audioCodec:this._audioCodec};\"string\"==typeof this._token&&\"\"!==this._token&&(r.token=this._token),1==+this._role&&(this._defaultRtmpUrl=\"rtmp://\"+this._ip+\":11936/sdk/\"+this._appId+\"-\"+this._roomId+\"-\"+this._uid+\"-\"+this._connectId,\"\"===this._validRtmpUrl&&(this._validRtmpUrl=this._defaultRtmpUrl),\"\"!==this._validRtmpUrl&&(r.rtmpUrl=this._validRtmpUrl,r.disableRtmpVideo=this._disableRtmpVideo),this._rtmpUrls.set(this._validRtmpUrl,{url:this._validRtmpUrl,state:\"init\"}),r.videoMixerBGIUrl=this._videoMixerBGIUrl),O.debug(\"_joinRoom() - _room.join: \"+(0,u.default)(r)),this._room.join(this._uid,r).then((function(){t._spy||(t._sendTransport=t._room.createTransport(\"send\",{media:\"SEND_MIC_WEBCAM\"}),t._sendTransport.removeAllListeners(\"close\"),t._sendTransport.on(\"close\",(function(e){O.debug(\"_sendTransport event -- [close] originator: \"+(0,u.default)(e)),delete t._transportInfo.sendTransport[t._sendTransport.id]})),t._sendTransport.removeAllListeners(\"restart-ice-trying\"),t._sendTransport.on(\"restart-ice-trying\",(function(e){O.debug(\"_sendTransport event -- [restart-ice-trying] - \"+(0,u.default)(e))})),t._sendTransport.removeAllListeners(\"restart-ice-fail\"),t._sendTransport.on(\"restart-ice-fail\",(function(e){O.debug(\"_sendTransport event -- [restart-ice-fail] - \"+(0,u.default)(e)),t._onClientClose({code:94003,reason:\"_sendTransport event [restart-ice-fail]\"})})),t._sendTransport.removeAllListeners(\"icegatheringstatechange\"),t._sendTransport.on(\"icegatheringstatechange\",(function(e){O.debug(\"_sendTransport event -- [icegatheringstatechange] \"+(0,u.default)(e))})),t._sendTransport.removeAllListeners(\"icecandidate\"),t._sendTransport.on(\"icecandidate\",(function(e){O.debug(\"_sendTransport event -- [icecandidate] \"+(0,u.default)(e))})),t._sendTransport.removeAllListeners(\"icecandidateerror\"),t._sendTransport.on(\"icecandidateerror\",(function(e){O.debug(\"_sendTransport event -- [icecandidateerror] \"+(0,u.default)(e))})),t._sendTransport.removeAllListeners(\"connectionstatechange\"),t._sendTransport.on(\"connectionstatechange\",(function(r){O.debug(\"_sendTransport event -- [connectionstatechange] connectionstat: \"+r),\"disconnected\"===r?(t._iceSendDisconnectedCnt++,O.warn(\"_sendTransport event -- [connectionstatechange:disconnected] - will restart ice after 500ms\"),setTimeout((function(){t._sendTransport&&t._sendTransport.attemptRestartIce()}),500)):\"failed\"===r?(O.warn(\"_sendTransport event -- [connectionstatechange:failed] - will restart ice\"),t._sendTransport&&t._sendTransport.attemptRestartIce()):\"connected\"===r&&(O.debug(\"_sendTransport event -- [connectionstatechange:connected]\"),C(t._sendTransport._handler._pc,(function(r){if(r&&t._sendTransport){if(Boolean(r.connectionType)&&Boolean(r.connectionType.local)&&Boolean(r.connectionType.remote)){var n={localIp:r.connectionType.local.ipAddress,localPort:r.connectionType.local.portNumber,remoteIp:r.connectionType.remote.ipAddress,remotePort:r.connectionType.remote.portNumber};t._transportInfo.sendTransport[t._sendTransport.id]=n,\"string\"==typeof r.connectionType.local.ipAddress&&\"\"!==r.connectionType.local.ipAddress.trim()&&(e.g_myPublicIP=r.connectionType.local.ipAddress)}t._stats.setWebrtcInternalSendStats(t._sendTransport.id,r)}}),2e3,\"send\"))}))),t._recvTransport=t._room.createTransport(\"recv\",{media:\"RECV\"}),t._recvTransport.removeAllListeners(\"close\"),t._recvTransport.on(\"close\",(function(e){O.debug(\"_recvTransport event -- [close] originator: \"+(0,u.default)(e))})),t._recvTransport.removeAllListeners(\"restart-ice-trying\"),t._recvTransport.on(\"restart-ice-trying\",(function(e){O.debug(\"_recvTransport event -- [restart-ice-trying] - \"+(0,u.default)(e))})),t._recvTransport.removeAllListeners(\"restart-ice-fail\"),t._recvTransport.on(\"restart-ice-fail\",(function(e){O.debug(\"_recvTransport event -- [restart-ice-fail] - \"+(0,u.default)(e)),t._onClientClose({code:94004,reason:\"recvTransport event [restart-ice-fail]\"})})),t._recvTransport.removeAllListeners(\"icegatheringstatechange\"),t._recvTransport.on(\"icegatheringstatechange\",(function(e){O.debug(\"_recvTransport event -- [icegatheringstatechange] \"+(0,u.default)(e))})),t._recvTransport.removeAllListeners(\"icecandidate\"),t._recvTransport.on(\"icecandidate\",(function(e){O.debug(\"_recvTransport event -- [icecandidate] \"+(0,u.default)(e))})),t._recvTransport.removeAllListeners(\"icecandidateerror\"),t._recvTransport.on(\"icecandidateerror\",(function(e){O.debug(\"_recvTransport event -- [icecandidateerror] \"+(0,u.default)(e))})),t._recvTransport.removeAllListeners(\"connectionstatechange\"),t._recvTransport.on(\"connectionstatechange\",(function(r){O.debug(\"_recvTransport event -- [connectionstatechange] connectionstate: \"+r),\"disconnected\"===r?(t._iceRecvDisconnectedCnt++,O.warn(\"_recvTransport event -- [connectionstatechange:disconnected] - will restart ice after 500ms\"),setTimeout((function(){t._recvTransport&&t._recvTransport.attemptRestartIce()}),500)):\"failed\"===r?(O.warn(\"_recvTransport event -- [connectionstatechange:failed] - will restart ice\"),t._recvTransport&&t._recvTransport.attemptRestartIce()):\"connected\"===r&&(O.debug(\"_recvTransport event -- [connectionstatechange:connected]\"),C(t._recvTransport._handler._pc,(function(r){r&&(Boolean(r.connectionType)&&Boolean(r.connectionType.local)&&Boolean(r.connectionType.remote)&&(t._transportInfo.recvTransport.localIp=r.connectionType.local.ipAddress,t._transportInfo.recvTransport.localPort=r.connectionType.local.portNumber,t._transportInfo.recvTransport.remoteIp=r.connectionType.remote.ipAddress,t._transportInfo.recvTransport.remotePort=r.connectionType.remote.portNumber,\"string\"==typeof r.connectionType.local.ipAddress&&\"\"!==r.connectionType.local.ipAddress.trim()&&(e.g_myPublicIP=r.connectionType.local.ipAddress)),t._stats.setWebrtcInternalRecvStats(r))}),2e3,\"recv\"))}))})).then((function(){O.debug(\"_room.join() mediasoup response.\");var e=t._room.peers,r=!0,n=!1,i=void 0;try{for(var a,o=(0,d.default)(e);!(r=(a=o.next()).done);r=!0){var s=a.value;t._handlePeer(s,{notify:!1})}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}t._stats.startHeartBeat()})).catch((function(e){O.warn(\"_room.join() fail - \"+e.name+\" \"+e.message)}))}},{key:\"_handleProtooEvent\",value:function(){var t=this;this._protooPeer&&(this._protooPeer.removeAllListeners(\"open\"),this._protooPeer.on(\"open\",(function(e){e.sid===t._protooSessionId&&(O.debug(\"protooPeer event -- [open] - sid: \"+e.sid+\" - \"+e.code+\" \"+e.reason+\" - will _joinRoom...\"),t._protooTransportStat=!0,t._sendGWTime=Date.now(),t._linkGWTime=t._sendGWTime-t._linkGWTime,t._joinRoom())})),this._protooPeer.removeAllListeners(\"conn-reconn\"),this._protooPeer.on(\"conn-reconn\",(function(e){e.sid===t._protooSessionId&&(O.debug(\"protooPeer event -- [conn-reconn] - sid: \"+e.sid+\" - \"+e.code+\" \"+e.reason),t._protooTransportStat=!0,t._ChangeConnStat({event:\"protoo[conn-reconn]\",state:M}))})),this._protooPeer.removeAllListeners(\"conn-interrupt\"),this._protooPeer.on(\"conn-interrupt\",(function(e){e.sid===t._protooSessionId&&(O.warn(\"protooPeer event -- [conn-interrupt] - sid: \"+e.sid+\" - \"+e.code+\" \"+e.reason),t._protooTransportStat=!1)})),this._protooPeer.removeAllListeners(\"conn-error\"),this._protooPeer.on(\"conn-error\",(function(e){O.warn(\"protooPeer event -- [conn-error] - sid: \"+e.sid+\" - \"+e.code+\" \"+e.reason)})),this._protooPeer.removeAllListeners(\"reinit\"),this._protooPeer.on(\"reinit\",(function(e){e.sid===t._protooSessionId&&(O.warn(\"protooPeer event -- [reinit] - sid: \"+e.sid+\" - \"+e.code+\" \"+e.reason),t._onClientClose({code:e.code,reason:\"protoo event [reinit] - \"+e.reason}))})),this._protooPeer.removeAllListeners(\"connecting\"),this._protooPeer.on(\"connecting\",(function(e){e.sid===t._protooSessionId&&(O.warn(\"protooPeer event -- [connecting] - sid: \"+e.sid+\" - \"+e.code+\" \"+e.reason),t._ChangeConnStat({event:\"protoo[connecting]\",state:D}))})),this._protooPeer.removeAllListeners(\"close\"),this._protooPeer.on(\"close\",(function(e){e.sid===t._protooSessionId&&(O.warn(\"protooPeer event -- [close] - sid: \"+e.sid+\" - \"+e.code+\" \"+e.reason),t._onClientClose({code:e.code,reason:\"protoo event [close] - \"+e.reason}))})),this._protooPeer.removeAllListeners(\"request\"),this._protooPeer.on(\"request\",(function(e,r,n,i){if(e.sid===t._protooSessionId)switch(r.method){case\"mediasoup-notification\":n();var a=r.data;null!==t._room&&t._room.receiveNotification(a);break;case\"display-name-changed\":n();break;case\"3T_applySpeak\":n(),t._protooPeer.send(\"approveSpeak\",r.data);break;case\"active-speaker\":n();break;default:O.warn(\"protoo.requst event -- [\"+r.method+\"] unknown protoo method\"),i(404,\"unknown method\")}})),this._protooPeer.removeAllListeners(\"notification\"),this._protooPeer.on(\"notification\",(function(r,n){if(r.sid===t._protooSessionId)switch(n.method){case\"3T_sessionid\":var i=n.data.sessionId;O.debug(\"protooPeer event -- [notification:3T_sessionid] - \"+i),t._stats.setSessionId(i),e.g_sessionId=i;break;case\"3T_connectid\":var a=n.data.connectId;t._stats.setConnectionId(a),e.g_connectId=a,O.debug(\"protooPeer event -- [notification:3T_connectid] - \"+a),t._joined=!0,t._joinTimer&&(clearTimeout(t._joinTimer),t._joinTimer=null),t._ChangeConnStat({event:\"join-success\",state:M}),t.emit(\"@join-success\",{connectId:a});break;case\"3T_kickout\":O.debug(\"API protooPeer event -- [notification:3T_kickout] - Emit [kickout] to APP - \"+(0,u.default)(n.data)),t.close({code:93001,reason:(0,u.default)(n.data)});break;case\"3T_CDN_URL\":var o=n.data.CDN_url;O.debug(\"API protooPeer event -- [notification:3T_CDN_URL] url: \"+o+\" - Emit [CDN_url] to APP\"),t.emit({CDN_url:o});break;case\"active-speaker\":n.data.peerName;break;case\"3T_audiencevisible\":var s=n.data.peerId;O.warn(\"API protooPeer event -- [notification:3T_audiencevisible] peerId: \"+s+\" - Nothing to do\");break;case\"3T_changerole\":var c=n.data,d=c.peerId,l=c.role;O.debug(\"API protooPeer event -- [notification:3T_changerole] peerId: \"+d+\" - role: \"+l);var p=t._peers.get(\"\"+d);p.appData.role=l.toString(),p&&(\"2\"===p.appData.role?(O.debug(\"API protooPeer event -- [notification:3T_changerole] peerId: \"+d+\" role: \"+l+\" - Emit [peer-join] to APP\"),O.clbLog({f:\"peer-join\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"userId-\"+d}),t.emit(\"peer-join\",{userId:d,userID:d,peer:p})):\"3\"===p.appData.role&&(O.debug(\"API protooPeer event -- [notification:3T_changerole] peerId: \"+d+\" role: \"+l+\" - Emit [peer-leave] to APP\"),O.clbLog({f:\"peer-leave\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"userId-\"+d}),t._removeStatsInfo(d),t.emit(\"peer-leave\",{userId:d,userID:d,streams:[]})));break;case\"3T_rtmpfailure\":var f=n.data,m=f.roomId,h=f.url,v=f.errData;O.debug(\"API protooPeer event -- [notification:3T_rtmpfailure] url: \"+h+\" - Emit [rtmp-failure] to APP -\"+v.reason.toString()),O.clbLog({f:\"rtmp-failure\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"url-\"+h+\",channelId-\"+m}),t._rtmpUrls.set(h,{url:h,state:\"fail\"}),t.emit(\"rtmp-failure\",{url:h,channelId:m,reason:Boolean(v)&&Boolean(v.reason)?v.reason.toString():\"\"});break;case\"3T_rtmpsuccess\":var _=n.data,g=_.roomId,b=_.url;O.debug(\"API protooPeer event -- [notification:3T_rtmpsuccess] url: \"+b+\" - Emit [rtmp-success] to APP\"),O.clbLog({f:\"rtmp-success\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"url-\"+b+\",channelId-\"+g}),t._rtmpUrls.set(b,{url:b,state:\"success\"}),t.emit(\"rtmp-success\",{url:b,channelId:g});break;case\"3T_updatevideostatus\":var I=n.data,k=I.peerId,P=I.devId,S=I.videoType;O.debug(\"API protooPeer event -- [notification:3T_updatevideostatus] peerId: \"+k+\" devId: \"+P+\" videoType: \"+S+\" - Emit [video-update] to APP\"),t.emit(\"video-update\",{userId:k,streamId:P,videoType:S});break;case\"3T_needrefreshtoken\":O.debug(\"API protooPeer event -- [notification:3T_needrefreshtoken] - Emit [onTokenPrivilegeWillExpire] to APP\"),t.emit(\"onTokenPrivilegeWillExpire\");break;default:O.warn(\"protoo.requst event -- [\"+n.method+\"] unknown protoo method\")}})))}},{key:\"leave\",value:(ie=(0,c.default)(s.default.mark((function e(t,r){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof t){e.next=3;break}throw O.error(\"API leave() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not a fucntion.\");case 3:if(\"function\"==typeof r){e.next=6;break}throw O.error(\"API leave() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not a fucntion.\");case 6:this._protooTransportStat||O.warn(\"API leave() error - protooTransport broken\");try{this.close({code:1e3,reason:\"Normal exit\"}),O.debug(\"API leave() success\")}catch(e){O.warn(\"API leave() error - \"+e.name+\" \"+e.message)}finally{O.debug(\"API leave() finish.\"),t()}case 8:case\"end\":return e.stop()}}),e,this)}))),function(e,t){return ie.apply(this,arguments)})},{key:\"_removeStatsInfo\",value:function(e){var t=this;this._subscribes.forEach((function(r,n){r&&\"\"+r.userId==\"\"+e&&t._subscribes.delete(n)})),this._remoteStreams.forEach((function(r,n){r&&\"\"+r.userId==\"\"+e&&t._remoteStreams.delete(n)})),this._remoteVideos.forEach((function(r,n){r&&\"\"+r.userId==\"\"+e&&t._remoteVideos.delete(n)})),this._remoteAudios.forEach((function(r,n){r&&\"\"+r.userId==\"\"+e&&t._remoteAudios.delete(n)}))}},{key:\"publish\",value:(ne=(0,c.default)(s.default.mark((function t(r,n,i){var a,o,c,d,u,l,p,f,m,h,v=this;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(\"function\"==typeof n){t.next=3;break}throw O.error(\"API publish() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess parameter must be a function.\");case 3:if(\"function\"==typeof i){t.next=6;break}throw O.error(\"API publish() error - parameter: onFailure invalid\"),new TypeError(\"onFailure parameter must be a function.\");case 6:if(r){t.next=10;break}return O.warn(\"API publish() error - [INVALID_PARAM_STREAM] - stream is null\"),i(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}),t.abrupt(\"return\");case 10:if(r.streamObj){t.next=14;break}return O.warn(\"API publish() error - [INVALID_PARAM_STREAM] - stream.streamObj is null\"),i(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}),t.abrupt(\"return\");case 14:if(!r.closed){t.next=18;break}return O.debug(\"API publish() error - [INVALID_PARAM_STREAM] - Stream is closed\"),i(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] stream is closed\"}),t.abrupt(\"return\");case 18:if(a=!!this._room&&this._room.canSend(\"video\"),o=!!this._room&&this._room.canSend(\"audio\"),c=r.hasVideo(),d=r.hasAudio(),u=r.isVideoTrackClosed,l=r.isMicClosed,O.debug(\"API publish() >> streamId: \"+r.getId()+\" stream.isVideoTrackClosed: \"+u+\" stream.hasVideo: \"+c+\" canSendVideo: \"+a+\" stream.isMicClosed: \"+l+\" stream.hasAudio: \"+d+\" canSendAudio: \"+o),r.hasAudio()||r.hasVideo()){t.next=29;break}return O.debug(\"API publish() << error - [INVALID_PARAM_STREAM] - audioTrack or videoTrack non-exist.\"),i(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] - has no audio or video\"}),t.abrupt(\"return\");case 29:if(this._protooTransportStat){t.next=33;break}return O.warn(\"API publish() << error - [CONNECT_BROKEN] - protooTransport is broken\"),i(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),t.abrupt(\"return\");case 33:if(this._joined){t.next=38;break}return O.warn(\"API publish() << error - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"publish\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+r.streamId}),i(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),t.abrupt(\"return\");case 38:if(O.funLog({f:\"publish\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+r.streamId}),!this._spy){t.next=43;break}return O.warn(\"API publish() << error - [PERMISSION_DENIED] - forbidden: user is _spy\"),i(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied\"}),t.abrupt(\"return\");case 43:if(3!=+this._role){t.next=47;break}return O.warn(\"API publish() << error - [PERMISSION_DENIED] - forbidden: Audience No permission\"),i(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Audience Not allowed publish\"}),t.abrupt(\"return\");case 47:if(!r.published){t.next=51;break}return O.warn(\"API publish() << error - [STREAM_HASPUBLISHED] - stream.published is true - nothing to do\"),i(\"STREAM_HASPUBLISHED\",{code:P.tttErrCode.STREAM_HASPUBLISHED,name:\"STREAM_HASPUBLISHED\",origin:\"\",message:\"stream has been published\"}),t.abrupt(\"return\");case 51:if(r.publishState!==P.PUBLISH_STATE.PUBLISHING){t.next=55;break}return O.warn(\"API publish() << error - [TASK_PROCEEDING] - config.PUBLISH_STATE.PUBLISHING - publish is running...\"),i(\"TASK_PROCEEDING\",{code:P.tttErrCode.TASK_PROCEEDING,name:\"TASK_PROCEEDING\",origin:\"\",message:\"publish is proceeding...\"}),t.abrupt(\"return\");case 55:if(r.publishState=P.PUBLISH_STATE.PUBLISHING,r.userID=this._uid,p=!1,!r.hasAudio()||!this._room.canSend(\"audio\")){t.next=94;break}if(!this._audioProducer){t.next=78;break}if(this._audioProducer.resume({method:\"publish\"}),t.prev=61,!((f=r.audioTracks)&&f.length>0)){t.next=66;break}return t.next=66,this._audioProducer.replaceTrack(f[0]);case 66:p=!0,t.next=76;break;case 69:return t.prev=69,t.t0=t.catch(61),p=!1,r.publishState=P.PUBLISH_STATE.IDLE,O.warn(\"API publish() << <EXCEPTION> - [PUBLISH_FAIL] - this._audioProducer.replaceTrack \"+t.t0.name+\" \"+t.t0.message),i(\"PUBLISH_FAIL\",{code:P.tttErrCode.PUBLISH_FAIL,name:\"PUBLISH_FAIL\",origin:\"\"+t.t0.name,message:\"publish fail - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 76:t.next=92;break;case 78:return t.prev=78,t.next=81,this._setMicProducer(r);case 81:this._stats.audioOpen=!0,p=!0,t.next=92;break;case 85:return t.prev=85,t.t1=t.catch(78),p=!1,r.publishState=P.PUBLISH_STATE.IDLE,O.warn(\"API publish() << <EXCEPTION> - [PUBLISH_FAIL] - _setMicProducer() \"+t.t1.name+\" \"+t.t1.message),i(\"PUBLISH_FAIL\",{code:P.tttErrCode.PUBLISH_FAIL,name:\"PUBLISH_FAIL\",origin:\"\"+t.t1.name,message:\"publish fail - \"+t.t1.name+\" \"+t.t1.message}),t.abrupt(\"return\");case 92:t.next=95;break;case 94:p=!0;case 95:return t.prev=95,t.next=98,r._openVideo();case 98:t.next=102;break;case 100:t.prev=100,t.t2=t.catch(95);case 102:if(m=!1,!r.hasVideo()||!this._room.canSend(\"video\")){t.next=138;break}if(!(h=this._mapVideoProducers.get(r.videoProducerId))){t.next=121;break}t.prev=106,h.resume({method:\"publish\"}),r._needUpdateVideoStreamBitrate&&(this._updateVideoTrack(r,r.videoTracks,r._updateConstraints),r._needUpdateVideoStreamBitrate=!1),m=!0,t.next=119;break;case 112:return t.prev=112,t.t3=t.catch(106),m=!1,r.publishState=P.PUBLISH_STATE.IDLE,O.warn(\"API publish() << fail - [PUBLISH_FAIL] - stream._openVideo() error - \"+t.t3.name+\" \"+t.t3.message),i(\"PUBLISH_FAIL\",{code:P.tttErrCode.PUBLISH_FAIL,name:\"PUBLISH_FAIL\",origin:\"\"+t.t3.name,message:\"publish fail - \"+t.t3.name+\" \"+t.t3.message}),t.abrupt(\"return\");case 119:t.next=135;break;case 121:return t.prev=121,t.next=124,this._setWebcamProducer(r);case 124:this._stats.videoOpen=!0,m=!0,t.next=135;break;case 128:return t.prev=128,t.t4=t.catch(121),m=!1,r.publishState=P.PUBLISH_STATE.IDLE,O.warn(\"API publish() << fail - [PUBLISH_FAIL] - _setWebcamProducer() error - \"+t.t4.name+\" \"+t.t4.message),i(\"PUBLISH_FAIL\",{code:P.tttErrCode.PUBLISH_FAIL,name:\"PUBLISH_FAIL\",origin:\"\"+t.t4.name,message:\"publish fail - \"+t.t4.name+\" \"+t.t4.message}),t.abrupt(\"return\");case 135:r.resumeLocalVideo(),t.next=139;break;case 138:m=!0;case 139:if(r.removeAllListeners(\"@close\"),r.on(\"@close\",(function(e,t){t&&(e?(O.debug(\"stream.on('@close') - streamId: \"+t.streamId),v.unpublish(t.stream,(function(){}),(function(){}))):O.debug(\"stream.on('@close') - streamId: \"+t.streamId+\" -- isLocal: \"+e+\" is impossible here. WHAT HAPPENED??\"))})),r.removeAllListeners(\"pause-video\"),r.on(\"pause-video\",(function(e){if(e){var t=e.stream;v.pauseWebcam(t)}})),r.removeAllListeners(\"pause-audio\"),r.on(\"pause-audio\",(function(e){if(e){var t=e.stream;v.pauseMic(t)}})),r.removeAllListeners(\"resume-audio\"),r.on(\"resume-audio\",(function(e){if(e){var t=e.stream;v.resumeMic(t)}})),r.removeAllListeners(\"resume-video\"),r.on(\"resume-video\",(function(e){if(e){var t=e.stream;v.resumeWebcam(t)}})),!p||!m){t.next=158;break}return r.published=!0,r.publishState=P.PUBLISH_STATE.PUBLISHED,this._publishs.set(r.uuid,{streamId:r.getId(),stream:r}),O.debug(\"API publish() << success - streamId: \"+r.getId()+\" - Emit [stream-published] to APP\"),O.clbLog({f:\"stream-published\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"streamId-\"+r.streamId+\",stream\"}),this.emit(\"stream-published\",{streamId:r.getId(),stream:r}),n(),t.abrupt(\"return\");case 158:return t.abrupt(\"return\");case 159:case\"end\":return t.stop()}}),t,this,[[61,69],[78,85],[95,100],[106,112],[121,128]])}))),function(e,t,r){return ne.apply(this,arguments)})},{key:\"_unpublishAudio\",value:(re=(0,c.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt(\"return\");case 2:if(t.hasAudio()){e.next=4;break}return e.abrupt(\"return\");case 4:this._audioProducer&&this._audioProducer.pause({method:\"unpublish\"}),this._stats.audioOpen=!1;case 6:case\"end\":return e.stop()}}),e,this)}))),function(e){return re.apply(this,arguments)})},{key:\"_unpublishVideo\",value:(te=(0,c.default)(s.default.mark((function e(t,r){var n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt(\"return\");case 2:if(t.hasVideo()){e.next=4;break}return e.abrupt(\"return\");case 4:if(!(n=this._mapVideoProducers.get(t.videoProducerId))){e.next=25;break}return t.detachVideoProducer(),this._mapVideoProducers.delete(t.videoProducerId),e.prev=8,e.next=11,n.close();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),O.warn(\"<EXCEPTION> - _unpublishVideo() \"+e.t0.name+\" \"+e.t0.message);case 16:if(!r){e.next=25;break}return e.prev=17,e.next=20,t._closeVideo();case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(17),O.warn(\"<EXCEPTION> - _unpublishVideo() stream._closeVideo - \"+e.t1.name+\" \"+e.t1.message);case 25:this._stats.videoOpen=!1;case 26:case\"end\":return e.stop()}}),e,this,[[8,13],[17,22]])}))),function(e,t){return te.apply(this,arguments)})},{key:\"unpublish\",value:(ee=(0,c.default)(s.default.mark((function t(r,n,i,a){return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(\"function\"==typeof n){t.next=3;break}throw O.error(\"API unpublish() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess parameter must be a function.\");case 3:if(\"function\"==typeof i){t.next=6;break}throw O.error(\"API unpublish() error - parameter: onFailure invalid\"),new TypeError(\"onFailure parameter must be a function.\");case 6:if(r){t.next=10;break}return O.warn(\"API unpublish() error - [INVALID_PARAM_STREAM] - stream is null\"),i(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}),t.abrupt(\"return\");case 10:if(O.debug(\"API unpublish() >> streamId: \"+r.getId()),O.funLog({f:\"unpublish\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+r.streamId}),this._protooTransportStat){t.next=16;break}return O.warn(\"API unpublish() << error - [CONNECT_BROKEN] - protooTransport is broken\"),i(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),t.abrupt(\"return\");case 16:if(r.published){t.next=20;break}return O.warn(\"API unpublish() << error - stream.published is false - nothing to do - onSuccess\"),n(\"stream.published is false - nothing to do\"),t.abrupt(\"return\");case 20:r.removeAllListeners(\"@close\"),r.removeAllListeners(\"pause-video\"),r.removeAllListeners(\"pause-audio\"),r.removeAllListeners(\"resume-audio\"),r.removeAllListeners(\"resume-video\"),this._unpublishAudio(r),this._unpublishVideo(r,a),r.published=!1,r.publishState=P.PUBLISH_STATE.IDLE,this._publishs.delete(r.uuid),O.debug(\"API unpublish() << success - streamId: \"+r.getId()+\" - Emit [stream-unpublished] to APP\"),O.clbLog({f:\"stream-unpublished\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"streamId-\"+r.streamId+\",stream\"}),this.emit(\"stream-unpublished\",{streamId:r.getId(),stream:r}),n();case 34:case\"end\":return t.stop()}}),t,this)}))),function(e,t,r,n){return ee.apply(this,arguments)})},{key:\"publishScreen\",value:(Z=(0,c.default)(s.default.mark((function t(r,n,i){var a=this;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(\"function\"==typeof n){t.next=3;break}throw O.error(\"API publishScreen() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof i){t.next=6;break}throw O.error(\"API publishScreen() error - parameter: onFailure invalid\"),new TypeError(\"onFailure is not function.\");case 6:if(r){t.next=10;break}return O.warn(\"API publishScreen() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid\"),i(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}),t.abrupt(\"return\");case 10:if(O.debug(\"API publishScreen() >> streamId: \"+r.getId()),r.streamObj){t.next=15;break}return O.warn(\"API publishScreen() << error - [INVALID_PARAM_STREAM] - parameter: stream.streamObj is invalid\"),i(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}),t.abrupt(\"return\");case 15:if(!r.published){t.next=19;break}return O.warn(\"API publishScreen() << error - [STREAM_HASPUBLISHED] - stream.published is true - nothing to do\"),i(\"STREAM_HASPUBLISHED\",{code:P.tttErrCode.STREAM_HASPUBLISHED,name:\"STREAM_HASPUBLISHED\",origin:\"\",message:\"stream has been published\"}),t.abrupt(\"return\");case 19:if(!r.closed){t.next=23;break}return O.debug(\"API publishScreen() << error - [INVALID_PARAM_STREAM] - Stream is closed\"),i(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] stream is closed\"}),t.abrupt(\"return\");case 23:if(this._protooTransportStat){t.next=27;break}return O.warn(\"API publishScreen() << error - [CONNECT_BROKEN] - protooTransport broken\"),i(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),t.abrupt(\"return\");case 27:if(this._joined){t.next=32;break}return O.warn(\"API publishScreen() << error - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"publishScreen\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+r.streamId}),i(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),t.abrupt(\"return\");case 32:if(O.funLog({f:\"publishScreen\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+r.streamId}),!this._spy){t.next=37;break}return O.warn(\"API publishScreen() << error - [PERMISSION_DENIED] - user is _spy\"),i(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied\"}),t.abrupt(\"return\");case 37:if(1==+this._role){t.next=41;break}return O.warn(\"API publishScreen() << error - [PERMISSION_DENIED] - Only for Master\"),i(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Must be Master(role=1)\"}),t.abrupt(\"return\");case 41:if(r.userID=this._uid,!this._screenProducer){t.next=49;break}return this.resumeScreen(),O.debug(\"API publishScreen() << success - streamId: \"+r.getId()+\" - Emit [screen-published] to APP\"),O.clbLog({f:\"screen-published\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"streamId-\"+r.streamId+\",stream\"}),this.emit(\"screen-published\",{streamId:r.getId(),stream:r}),n(),t.abrupt(\"return\");case 49:if(this._room.canSend(\"video\")){t.next=53;break}return O.warn(\"API publishScreen() << error - video cannot Send\"),i(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - video cannot Send\"}),t.abrupt(\"return\");case 53:return r.removeAllListeners(\"@close\"),r.on(\"@close\",(function(e,t){t&&(e?(O.debug(\"stream.on('@close') - streamId: \"+t.streamId),a.unpublishScreen(t.stream,(function(){}),(function(){}))):O.debug(\"stream.on('@close') - streamId: \"+t.streamId+\" -- isLocal: \"+e+\" is impossible here. WHAT HAPPENED??\"))})),t.prev=55,t.next=58,this._setScreenProducer(r);case 58:return r.published=!0,r.publishState=P.PUBLISH_STATE.PUBLISHED,this._publishs.set(r.uuid,{streamId:r.getId(),stream:r}),O.debug(\"API publishScreen() << success - streamId: \"+r.getId()+\" - Emit [screen-published] to APP\"),this.emit(\"screen-published\",{streamId:r.getId(),stream:r}),n(),t.abrupt(\"return\");case 67:return t.prev=67,t.t0=t.catch(55),O.warn(\"API publishScreen() << fail - [PUBLISH_FAIL] - _setScreenProducer() error - \"+t.t0.name+\" \"+t.t0.message),i(\"PUBLISH_FAIL\",{code:P.tttErrCode.PUBLISH_FAIL,name:\"PUBLISH_FAIL\",origin:\"\"+t.t0.name,message:\"publishScreen fail - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 72:case\"end\":return t.stop()}}),t,this,[[55,67]])}))),function(e,t,r){return Z.apply(this,arguments)})},{key:\"unpublishScreen\",value:($=(0,c.default)(s.default.mark((function t(r,n,i){return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(\"function\"==typeof n){t.next=3;break}throw O.error(\"API unpublishScreen() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof i){t.next=6;break}throw O.error(\"API unpublishScreen() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(r){t.next=10;break}return O.warn(\"API unpublishScreen() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid\"),i(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}),t.abrupt(\"return\");case 10:if(O.debug(\"API unpublishScreen() >> streamId: \"+r.getId()),O.funLog({f:\"unpublishScreen\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+r.streamId}),this._protooTransportStat){t.next=16;break}return O.warn(\"API unpublishScreen() << error - [CONNECT_BROKEN] - protooTransport broken\"),i(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),t.abrupt(\"return\");case 16:if(r.published){t.next=20;break}return O.warn(\"API unpublishScreen() << error - stream.published is false - nothing to do - onSuccess\"),n(\"stream.published is false - nothing to do\"),t.abrupt(\"return\");case 20:if(r.removeAllListeners(\"@close\"),!this._screenProducer){t.next=29;break}return t.prev=22,t.next=25,this._screenProducer.close();case 25:t.next=29;break;case 27:t.prev=27,t.t0=t.catch(22);case 29:this._screenProducer=null,r.published=!1,r.publishState=P.PUBLISH_STATE.IDLE,this._publishs.delete(r.uuid),O.debug(\"API unpublishScreen() << success - streamId: \"+r.getId()+\" - Emit [screen-unpublished] to APP\"),O.clbLog({f:\"screen-unpublished\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"streamId-\"+r.streamId+\",stream\"}),this.emit(\"screen-unpublished\",{streamId:r.getId(),stream:r}),n();case 37:case\"end\":return t.stop()}}),t,this,[[22,27]])}))),function(e,t,r){return $.apply(this,arguments)})},{key:\"subscribeAudio\",value:function(t,r,n){if(\"function\"!=typeof r)throw O.error(\"API subscribeAudio() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof n)throw O.error(\"API subscribeAudio() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!t)return O.warn(\"API subscribeAudio() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid\"),void n(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"});if(O.debug(\"API subscribeAudio() >> streamId: \"+t.getId()),!this._protooTransportStat)return O.warn(\"API subscribeAudio() << error - [CONNECT_BROKEN] - protooTransport broken\"),void n(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"});if(!this._joined)return O.warn(\"API subscribeAudio() << error - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"subscribeAudio\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),void n(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"});O.funLog({f:\"subscribeAudio\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId});var i=!1,a=!0,s=!1,c=void 0;try{for(var u,l=(0,d.default)(t.consumers);!(a=(u=l.next()).done);a=!0){var p=(0,o.default)(u.value,2),f=(p[0],p[1]);f&&\"audio\"===f.kind&&(f.resume(),t.audioSubscribed=!0,i=!0)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return i?(O.debug(\"API subscribeAudio() << success - streamId: \"+t.getId()+\" - Emit [stream-audio-subscribed] to APP\"),O.clbLog({f:\"stream-audio-subscribed\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),this.emit(\"stream-audio-subscribed\",{stream:t}),void r(t)):(O.warn(\"API subscribeAudio() << error - [STREAM_HAS_NOAUDIO] - STREAM_HAS_NOAUDIO\"),void n(\"STREAM_HAS_NOAUDIO\",{code:P.tttErrCode.STREAM_HAS_NOAUDIO,name:\"STREAM_HAS_NOAUDIO\",origin:\"\",message:\"stream has non-audio\"}))}},{key:\"unsubscribeAudio\",value:function(t,r,n){if(\"function\"!=typeof r)throw O.error(\"API unsubscribeAudio() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof n)throw O.error(\"API unsubscribeAudio() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!t)return O.warn(\"API unsubscribeAudio() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid\"),void n(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"});if(O.debug(\"API unsubscribeAudio() >> streamId: \"+t.getId()),O.funLog({f:\"unsubscribeAudio\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),!this._protooTransportStat)return O.warn(\"API unsubscribeAudio() << error - [CONNECT_BROKEN] - protooTransport broken\"),void n(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"});var i=!1,a=!0,s=!1,c=void 0;try{for(var u,l=(0,d.default)(t.consumers);!(a=(u=l.next()).done);a=!0){var p=(0,o.default)(u.value,2),f=(p[0],p[1]);f&&\"audio\"===f.kind&&(f.pause(),t.audioSubscribed=!1,i=!0)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return i?(O.debug(\"API unsubscribeAudio() << success - streamId: \"+t.getId()+\" - Emit [stream-audio-unsubscribed] to APP\"),O.clbLog({f:\"stream-audio-unsubscribed\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),this.emit(\"stream-audio-unsubscribed\",{stream:t}),void r(t)):(O.warn(\"API unsubscribeAudio() << error - [STREAM_HAS_NOAUDIO] - STREAM_HAS_NOAUDIO\"),void n(\"STREAM_HAS_NOAUDIO\",{code:P.tttErrCode.STREAM_HAS_NOAUDIO,name:\"STREAM_HAS_NOAUDIO\",origin:\"\",message:\"stream has non-audio\"}))}},{key:\"subscribeVideo\",value:function(t,r,n){if(\"function\"!=typeof r)throw O.error(\"API subscribeVideo() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof n)throw O.error(\"API subscribeVideo() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!t)return O.warn(\"API subscribeVideo() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid\"),void n(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"});if(O.debug(\"API subscribeVideo() >> streamId: \"+t.getId()),!this._protooTransportStat)return O.warn(\"API subscribeVideo() << error - [CONNECT_BROKEN] - protooTransport broken\"),void n(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"});if(!this._joined)return O.warn(\"API subscribeVideo() << error - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"subscribeVideo\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),void n(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"});O.funLog({f:\"subscribeVideo\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId});var i=!1,a=!0,s=!1,c=void 0;try{for(var u,l=(0,d.default)(t.consumers);!(a=(u=l.next()).done);a=!0){var p=(0,o.default)(u.value,2),f=(p[0],p[1]);f&&\"video\"===f.kind&&(f.resume(),t.videoSubscribed=!0,i=!0)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return i?(O.debug(\"API subscribeVideo() << success - streamId: \"+t.getId()+\" - Emit [stream-video-subscribed] to APP\"),O.clbLog({f:\"stream-video-subscribed\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),this.emit(\"stream-video-subscribed\",{stream:t}),void r(t)):(O.warn(\"API subscribeVideo() << error - [STREAM_HAS_NOVIDEO] - STREAM_HAS_NOVIDEO\"),void n(\"STREAM_HAS_NOVIDEO\",{code:P.tttErrCode.STREAM_HAS_NOVIDEO,name:\"STREAM_HAS_NOVIDEO\",origin:\"\",message:\"stream has non-video\"}))}},{key:\"unsubscribeVideo\",value:function(t,r,n){if(\"function\"!=typeof r)throw O.error(\"API unsubscribeVideo() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof n)throw O.error(\"API unsubscribeVideo() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!t)return O.warn(\"API unsubscribeVideo() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid\"),void n(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"});if(O.debug(\"API unsubscribeVideo() >> streamId: \"+t.getId()),O.funLog({f:\"unsubscribeVideo\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),!this._protooTransportStat)return O.warn(\"API unsubscribeVideo() << error - [CONNECT_BROKEN] - protooTransport broken\"),void n(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"});var i=!1,a=!0,s=!1,c=void 0;try{for(var u,l=(0,d.default)(t.consumers);!(a=(u=l.next()).done);a=!0){var p=(0,o.default)(u.value,2),f=(p[0],p[1]);f&&\"video\"===f.kind&&(f.pause(),t.videoSubscribed=!1,i=!0)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return i?(O.debug(\"API unsubscribeVideo() << success - streamId: \"+t.getId()+\" - Emit [stream-video-unsubscribed] to APP\"),O.clbLog({f:\"stream-video-unsubscribed\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),this.emit(\"stream-video-unsubscribed\",{stream:t}),void r(t)):(O.warn(\"API unsubscribeVideo() << error - [STREAM_HAS_NOVIDEO] - STREAM_HAS_NOVIDEO\"),void n(\"STREAM_HAS_NOVIDEO\",{code:P.tttErrCode.STREAM_HAS_NOVIDEO,name:\"STREAM_HAS_NOVIDEO\",origin:\"\",message:\"stream has non-video\"}))}},{key:\"subscribe\",value:function(t,r,n){if(\"function\"!=typeof r)throw O.error(\"API subscribe() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof n)throw O.error(\"API subscribe() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!t)return O.warn(\"API subscribe() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid\"),void n(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"});if(O.debug(\"API subscribe() >> streamId: \"+t.getId()+\" hasVideoConsumer: \"+t.hasVideoConsumer()+\" hasAudioConsumer: \"+t.hasAudioConsumer()),!this._protooTransportStat)return O.warn(\"API subscribe() << error - [CONNECT_BROKEN] - protooTransport broken\"),void n(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"});if(!this._joined)return O.warn(\"API subscribe() << error - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"subscribe\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),void n(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"});O.funLog({f:\"subscribe\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId});var i=\"\",a=!1,s=!0,c=!1,u=void 0;try{for(var l,p=(0,d.default)(t.consumers);!(s=(l=p.next()).done);s=!0){var f=(0,o.default)(l.value,2),m=(f[0],f[1]);if(m){if(i=i+\" | kind[\"+m.kind+\"] consumerId[\"+m.id+\"]\",\"video\"===m.kind)t.videoSubscribed=!0;else{if(\"audio\"!==m.kind)continue;t.audioSubscribed=!0}m.resume(),a=!0}}}catch(e){c=!0,u=e}finally{try{!s&&p.return&&p.return()}finally{if(c)throw u}}return O.debug(\"API subscribe() - streamId: \"+t.getId()+\" uuid: \"+t.uuid+\" - consumers: \"+i),a?(t.subscribed=!0,this._subscribes.set(t.uuid,{userId:t.userID,streamId:t.getId(),stream:t}),O.debug(\"API subscribe() << success - streamId: \"+t.getId()+\" - Emit [stream-subscribed] to APP\"),O.clbLog({f:\"stream-subscribed\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),this.emit(\"stream-subscribed\",{stream:t}),void r(t)):(O.warn(\"API subscribe() << error - [STREAM_HAS_NOMEDIA] - STREAM_HAS_NOMEDIA\"),void n(\"STREAM_HAS_NOMEDIA\",{code:P.tttErrCode.STREAM_HAS_NOMEDIA,name:\"STREAM_HAS_NOMEDIA\",origin:\"\",message:\"stream has non-media(audio | video)\"}))}},{key:\"unsubscribe\",value:function(t,r,n){if(\"function\"!=typeof r)throw O.error(\"API unsubscribe() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof n)throw O.error(\"API unsubscribe() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!t)return O.warn(\"API unsubscribe() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid\"),void n(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"});if(O.debug(\"API unsubscribe() >> streamId: \"+t.getId()),O.funLog({f:\"unsubscribe\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),!this._protooTransportStat)return O.warn(\"API unsubscribe() << error - [CONNECT_BROKEN] - protooTransport broken\"),void n(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"});var i=!1,a=!0,s=!1,c=void 0;try{for(var u,l=(0,d.default)(t.consumers);!(a=(u=l.next()).done);a=!0){var p=(0,o.default)(u.value,2),f=(p[0],p[1]);if(f){if(\"video\"===f.kind)t.videoSubscribed=!1;else{if(\"audio\"!==f.kind)continue;t.audioSubscribed=!1}f.pause(),i=!0}}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return i?(this._subscribes.delete(t.uuid),t.subscribed=!1,O.debug(\"API unsubscribe() << success - streamId: \"+t.getId()+\" - Emit [stream-unsubscribed] to APP\"),O.clbLog({f:\"stream-unsubscribed\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),this.emit(\"stream-unsubscribed\",{stream:t}),void r(t)):(O.warn(\"API unsubscribe() << error - [STREAM_HAS_NOMEDIA] - STREAM_HAS_NOMEDIA\"),void n(\"STREAM_HAS_NOMEDIA\",{code:P.tttErrCode.STREAM_HAS_NOMEDIA,name:\"STREAM_HAS_NOMEDIA\",origin:\"\",message:\"stream has non-media(audio | video)\"}))}},{key:\"pauseMic\",value:function(t,r,n){if(!t)return O.warn(\"API pauseMic() error - [INVALID_PARAM_STREAM] - Param: invalid stream\"),void(\"function\"==typeof n&&n(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}));if(O.debug(\"API pauseMic() >> streamId: \"+t.getId()),O.funLog({f:\"pauseMic\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),!t.published)return O.warn(\"API pauseMic() << error - [AUDIO_NOPUBLISH] - no-published\"),void(\"function\"==typeof n&&n(\"AUDIO_NOPUBLISH\",{code:P.tttErrCode.AUDIO_NOPUBLISH,name:\"AUDIO_NOPUBLISH\",origin:\"\",message:\"audio no-published\"}));var i=this._audioProducer;if(!i)return O.warn(\"API pauseMic() << fail - [AUDIO_NOPUBLISH] - non mic producer.\"),void(\"function\"==typeof n&&n(\"AUDIO_NOPUBLISH\",{code:P.tttErrCode.AUDIO_NOPUBLISH,name:\"AUDIO_NOPUBLISH\",origin:\"\",message:\"non mic producer\"}));O.debug(\"API pauseMic() << sucess - streamId: \"+t.getId()),i.pause({method:\"pause\"}),t.isAudioPaused=!0,\"function\"==typeof r&&r()}},{key:\"resumeMic\",value:function(t,r,n){if(!t)return O.warn(\"API resumeMic() error - [INVALID_PARAM_STREAM] - Param: invalid stream\"),void(\"function\"==typeof n&&n(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}));if(O.debug(\"API resumeMic() >> streamId: \"+t.getId()),O.funLog({f:\"resumeMic\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),!t.published)return O.warn(\"API resumeMic() << error - [AUDIO_NOPUBLISH] - no-published\"),void(\"function\"==typeof n&&n(\"AUDIO_NOPUBLISH\",{code:P.tttErrCode.AUDIO_NOPUBLISH,name:\"AUDIO_NOPUBLISH\",origin:\"\",message:\"audio no-published\"}));var i=this._audioProducer;if(!i)return O.warn(\"API resumeMic() << fail - [AUDIO_NOPUBLISH] - non mic producer\"),void(\"function\"==typeof n&&n(\"AUDIO_NOPUBLISH\",{code:P.tttErrCode.AUDIO_NOPUBLISH,name:\"AUDIO_NOPUBLISH\",origin:\"\",message:\"non mic producer\"}));O.debug(\"API resumeMic() << sucess - streamId: \"+t.getId()),i.resume({method:\"resume\"}),t.isAudioPaused=!1,\"function\"==typeof r&&r()}},{key:\"pauseWebcam\",value:(Q=(0,c.default)(s.default.mark((function t(r,n,i,a){var o;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=4;break}return O.warn(\"API pauseWebcam() error - [INVALID_PARAM_STREAM] - Param: invalid stream\"),\"function\"==typeof a&&a(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}),t.abrupt(\"return\");case 4:if(O.debug(\"API pauseWebcam() >> streamId: \"+r.getId()),O.funLog({f:\"pauseWebcam\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+r.streamId}),r.published){t.next=10;break}return O.warn(\"API pauseWebcam() << fail - [VIDEO_NOPUBLISH] - no-published\"),\"function\"==typeof a&&a(\"VIDEO_NOPUBLISH\",{code:P.tttErrCode.VIDEO_NOPUBLISH,name:\"VIDEO_NOPUBLISH\",origin:\"\",message:\"video no-published\"}),t.abrupt(\"return\");case 10:if(o=this._mapVideoProducers.get(r.videoProducerId)){t.next=17;break}return O.warn(\"API pauseWebcam() << fail - [VIDEO_NOPUBLISH] - non webcam producer.\"),\"function\"==typeof a&&a(\"VIDEO_NOPUBLISH\",{code:P.tttErrCode.VIDEO_NOPUBLISH,name:\"VIDEO_NOPUBLISH\",origin:\"\",message:\"non webcam producer\"}),t.abrupt(\"return\");case 17:try{o.pause({method:\"pause\"}),O.debug(\"API pauseWebcam() << success - streamId: \"+r.getId())}catch(e){O.warn(\"APi pauseWebcam() << fail - \"+e.name+\" \"+e.message)}if(r.isVideoPaused=!0,!n){t.next=22;break}return t.next=22,r._closeVideo();case 22:\"function\"==typeof i&&i();case 23:case\"end\":return t.stop()}}),t,this)}))),function(e,t,r,n){return Q.apply(this,arguments)})},{key:\"resumeWebcam\",value:function(t,r,n){if(!t)return O.warn(\"API resumeWebcam() error - [INVALID_PARAM_STREAM] - Param: invalid stream\"),void(\"function\"==typeof n&&n(\"INVALID_PARAM_STREAM\",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:\"INVALID_PARAM_STREAM\",origin:\"\",message:\"param [stream] is invalid\"}));if(O.debug(\"API resumeWebcam() >> streamId: \"+t.getId()),O.funLog({f:\"resumeWebcam\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+t.streamId}),!t.published)return O.warn(\"API resumeWebcam() << fail - [VIDEO_NOPUBLISH] - no-published\"),void(\"function\"==typeof n&&n(\"VIDEO_NOPUBLISH\",{code:P.tttErrCode.VIDEO_NOPUBLISH,name:\"VIDEO_NOPUBLISH\",origin:\"\",message:\"video no-published\"}));var i=this._mapVideoProducers.get(t.videoProducerId);if(!i)return O.warn(\"API resumeWebcam() << fail - [VIDEO_NOPUBLISH] - non webcam producer\"),void(\"function\"==typeof n&&n(\"VIDEO_NOPUBLISH\",{code:P.tttErrCode.VIDEO_NOPUBLISH,name:\"VIDEO_NOPUBLISH\",origin:\"\",message:\"non webcam producer\"}));t._openVideo().then((function(){try{i.resume({method:\"resume\"}),O.debug(\"API resumeWebcam() << success - stream._openVideo() - streamId: \"+t.getId())}catch(e){O.warn(\"API resumeWebcam() <EXCEPTION> - \"+e.name+\" \"+e.message)}t.isVideoPaused=!1,\"function\"==typeof r&&r()})).catch((function(e){O.warn(\"API resumeWebcam() << fail - [DEVICE_EXCEPTION] - stream._openVideo() error - \"+e.name+\" \"+e.message),\"function\"==typeof n&&n(\"DEVICE_EXCEPTION\",{code:P.tttErrCode.DEVICE_EXCEPTION,name:\"DEVICE_EXCEPTION\",origin:\"\"+e.name,message:\"stream._openVideo fail - \"+e.name+\" \"+e.message})}))}},{key:\"pauseScreen\",value:function(){O.debug(\"API pauseScreen() >> \"),O.funLog({f:\"pauseScreen\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),this._screenProducer&&this._screenProducer.pause(),O.debug(\"API pauseScreen() << success \")}},{key:\"resumeScreen\",value:function(){O.debug(\"API resumeScreen() >> \"),O.funLog({f:\"resumeScreen\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"\"}),this._screenProducer&&this._screenProducer.resume(),O.debug(\"API resumeScreen() << success \")}},{key:\"_updateVideoTrack\",value:(J=(0,c.default)(s.default.mark((function e(t,r,n){var i;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt(\"return\");case 2:if(i=this._mapVideoProducers.get(t.videoProducerId)){e.next=5;break}return e.abrupt(\"return\");case 5:return e.prev=5,e.next=8,i.updateTrack(r,n,{idealBandwidth:t.idealBandwidth,maxBandwidth:t.maxBandwidth,minBandwidth:t.minBandwidth});case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(5);case 12:case\"end\":return e.stop()}}),e,this,[[5,10]])}))),function(e,t,r){return J.apply(this,arguments)})},{key:\"_replaceTrack\",value:(Y=(0,c.default)(s.default.mark((function e(t,r){var n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt(\"return\");case 2:if(n=this._mapVideoProducers.get(t.videoProducerId)){e.next=5;break}return e.abrupt(\"return\");case 5:return e.prev=5,e.next=8,n.replaceTrack(r);case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(5);case 12:case\"end\":return e.stop()}}),e,this,[[5,10]])}))),function(e,t){return Y.apply(this,arguments)})},{key:\"renewChannelKey\",value:function(e,t,r){}},{key:\"enableDualStream\",value:function(){}},{key:\"setRemoteVideoStreamType\",value:function(e,t){}},{key:\"setLowStreamParameter\",value:function(){}},{key:\"disableDualStream\",value:function(e,t){}},{key:\"setProxyServer\",value:function(e){}},{key:\"setEncryptionSecret\",value:function(){}},{key:\"setEncryptionMode\",value:function(){}},{key:\"closeStream\",value:(q=(0,c.default)(s.default.mark((function e(t){var r,n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return O.warn(\"API closeStream() error - parameter [stream] is INVALID.\"),e.abrupt(\"return\");case 3:if(O.debug(\"API closeStream() >> streamId: \"+t.getId()),!(r=this._audioProducer)){e.next=14;break}return e.prev=6,e.next=9,r.close();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),O.warn(\"API closeStream() << <EXCEPTION> - close micProducer error - \"+e.t0.name+\" \"+e.t0.message);case 14:if(!(n=this._mapVideoProducers.get(t.videoProducerId))){e.next=24;break}return e.prev=16,e.next=19,n.close();case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(16),O.warn(\"API closeStream() << <EXCEPTION> - close webcamProducer error - \"+e.t1.name+\" \"+e.t1.message);case 24:O.debug(\"API closeStream() << success - streamId: \"+t.getId());case 25:case\"end\":return e.stop()}}),e,this,[[6,11],[16,21]])}))),function(e){return q.apply(this,arguments)})},{key:\"_innerClose\",value:(X=(0,c.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connState!==B){e.next=2;break}return e.abrupt(\"return\");case 2:if(this._joined=!1,this._ChangeConnStat({event:t.code+\" \"+t.reason,state:B}),e.prev=4,!this._room){e.next=10;break}return e.next=8,this._room.leave();case 8:this._room&&this._room.removeAllListeners(),this._room=null;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4);case 15:this._joinTimer&&(clearTimeout(this._joinTimer),this._joinTimer=null),this._stopStatInterval(),this._stopNetworkQualityInterval(),this._remoteAudios.clear(),this._remoteVideos.clear(),this._publishs.clear(),this._subscribes.clear(),this._audioProducer&&this._audioProducer.close(),this._mapVideoProducers.forEach((function(e,t){e&&e.close()})),this._mapVideoProducers.clear(),this._sendTransport&&(this._sendTransport.close(),this._sendTransport=null),this._screenTransport&&(this._screenTransport.close(),this._screenTransport=null),this._screenProducer&&(this._screenProducer.close(),this._screenProducer=null),this._mapVideoSendTransports.forEach((function(e,t){e&&e.close()})),this._mapVideoSendTransports.clear(),this._recvTransport&&(this._recvTransport.close(),this._recvTransport=null),this._peers.clear();case 32:case\"end\":return e.stop()}}),e,this,[[4,12]])}))),function(e){return X.apply(this,arguments)})},{key:\"close\",value:function(t){if(!this._closed&&!this._closing&&!this._joinTrying){this._iplocTimer&&(clearTimeout(this._iplocTimer),this._iplocTimer=null),this._ipLocation&&(this._ipLocation.close(),this._ipLocation=null),this._closing=!0;var r=t?\"API close() - \"+t.reason:\"API close()\";O.debug(r),O.funLog({f:\"close\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:(0,u.default)(t)}),this._innerClose({code:t?t.code:1e3,reason:r}),this._hasInit=!1,this._ChangeConnStat({event:r,state:L}),this._joined=!1,this._protooPeer&&(this._protooPeer.close(),this._protooPeer=null),navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=null),this._stats.stopHeartBeat(),this._closed=!0,this._closing=!1,t&&93001===t.code&&(O.debug(\"API close() - Emit [kickout] to APP\"),O.clbLog({f:\"kickout\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:t.reason}),this.emit(\"kickout\",t.reason)),O.debug(\"API close() - Emit [disconnected] to APP\"),O.clbLog({f:\"disconnected\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"code-\"+(t?t.code:1e3)}),this.emit(\"disconnected\",{code:t?t.code:1e3}),this.removeAllListeners(),O.debug(\"API close() << end\")}}},{key:\"_handlePeer\",value:function(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.notify;O.debug(\"_handlePeer() - Emit [peer-join] to APP\"),O.clbLog({f:\"peer-join\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"userId-\"+t.name}),this.emit(\"peer-join\",{userId:t.name,userID:t.name,peer:t}),this._peers.set(\"\"+t.name,t);var i=!0,a=!1,o=void 0;try{for(var s,c=(0,d.default)(t.consumers);!(i=(s=c.next()).done);i=!0){var l=s.value;this._handleConsumer(l,t.name)}}catch(e){a=!0,o=e}finally{try{!i&&c.return&&c.return()}finally{if(a)throw o}}t.on(\"close\",(function(n){r._peers.delete(\"\"+t.name),r._closed||(r._removeStatsInfo(t.name),O.debug(\"peer event -- [close] - userId: \"+t.name+\" - Emit [peer-leave] to APP\"),O.clbLog({f:\"peer-leave\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"userId-\"+t.name}),r.emit(\"peer-leave\",{userId:t.name,userID:t.name,peer:t}))})),t.on(\"newconsumer\",(function(e){O.debug(\"peer event -- [newconsumer] - userId: \"+t.name+\" consumer.appData: \"+(0,u.default)(e.appData)),r._handleConsumer(e,t.name)}))}},{key:\"_handleConsumer\",value:(z=(0,c.default)(s.default.mark((function t(r,n){var i=this;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.appData){t.next=3;break}return O.debug(\"_handleConsumer() error - userId: \"+n+\" consumer.appData is invalid\"),t.abrupt(\"return\");case 3:if(\"screen\"!==r.appData.source){t.next=5;break}return t.abrupt(\"return\");case 5:r.on(\"trackStop\",(function(e,t){O.debug(\"consumer event -- [trackStop] - method: \"+e+\" appData: \"+t+\" - userId: \"+n+\" consumer.kind: \"+r.kind)})),r.on(\"handled\",(function(){O.debug(\"consumer event -- [handled] - userId: \"+n+\" consumer.kind: \"+r.kind)})),r.on(\"unhandled\",(function(){O.debug(\"consumer event -- [unhandled] - userId: \"+n+\" consumer.kind: \"+r.kind)})),r.on(\"close\",(function(t){r.disableStats(),i._stats.removeStreamById(\"consumer_\"+r.id),O.debug(\"consumer event -- [close] - originator: \"+t+\" - userId: \"+n+\" consumer.kind: \"+r.kind);var a=r.appData?r.appData.streamID:r.peer.name,o=i._remoteStreams.get(\"\"+a);o&&(o.isConsumerMedia||i._remoteStreams.delete(\"\"+a),\"video\"===r.kind?(o.detachVideoConsumer(r),o.hasConsumer()||(o.subscribed=!1),i._remoteVideos.delete(o.uuid),O.debug(\"consumer event -- [close] - userId: \"+n+\" uuid: \"+o.uuid+\" streamId: \"+o.getId()+\" - Emit [video-removed] to APP\"),O.clbLog({f:\"video-removed\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"streamId-\"+a+\",stream\"}),i.emit(\"video-removed\",{streamId:a,stream:o})):\"audio\"===r.kind&&(o.detachAudioConsumer(r),o.hasConsumer()||(o.subscribed=!1),O.debug(\"consumer event -- [close] - userId: \"+n+\" uuid: \"+o.uuid+\" streamId: \"+o.getId()+\" - Emit [audio-removed] to APP\"),O.clbLog({f:\"audio-removed\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"streamId-\"+a+\",stream\"}),i.emit(\"audio-removed\",{streamId:a,stream:o})))})),r.on(\"pause\",(function(t,a){if(i._stats.actStreamSSRCPairs(\"consumer_\"+r.id,!1),O.debug(\"event -- [pause] - consumer.id: \"+r.id+\" originator: \"+t+\" - userId: \"+n+\" consumer.kind: \"+r.kind),\"remote\"===t){var o=\"\";\"audio\"===r.kind?Boolean(a)&&\"string\"==typeof a.method?\"pause\"===a.method?o=\"audio-mute\":\"unpublish\"===a.method&&(o=\"audio-removed\"):o=\"audio-mute\":\"video\"===r.kind&&(o=\"video-mute\");var s=i._remoteStreams.get(\"\"+r.appData.streamID);s?(\"audio-removed\"===o&&(s.detachAudioConsumer(r),s.hasConsumer()||(s.subscribed=!1)),O.debug(\"consumer event -- [pause] - userId: \"+n+\" uuid: \"+s.uuid+\" streamId: \"+s.getId()+\" appData: \"+(0,u.default)(a)+\" - Emit [\"+o+\"] to APP\"),O.clbLog({f:o,t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+s.streamId}),i.emit(o,{streamId:s.getId(),stream:s})):O.warn(\"<EXCEPTION> - consumer event -- [pause] - userId: \"+n+\" consumerId: \"+r.id+\" - non-stream\")}})),r.on(\"resume\",(function(t,a){i._stats.actStreamSSRCPairs(\"consumer_\"+r.id,!0),O.debug(\"consumer event -- [resume] - consumer.id: \"+r.id+\" originator: \"+t+\" - userId: \"+n+\" consumer.kind: \"+r.kind);var o=\"\";if(\"audio\"===r.kind?Boolean(a)&&\"string\"==typeof a.method?\"resume\"===a.method?o=\"audio-unmute\":\"publish\"===a.method&&(o=\"audio-added\"):o=\"audio-unmute\":\"video\"===r.kind&&(o=\"video-unmute\"),\"remote\"===t){var s=r.appData?i._remoteStreams.get(\"\"+r.appData.streamID):null;s?(s.subscribed||r.pause(),\"video-unmute\"!==o||i._remoteVideos.has(s.uuid)?\"audio-unmute\"===o&&!i._remoteAudios.has(s.uuid)||\"audio-added\"===o?(s.attachAudioConsumer(r),O.debug(\"consumer event -- [resume] - userId: \"+n+\" uuid: \"+s.uuid+\" streamId: \"+s.getId()+\" appData: \"+(0,u.default)(a)+\" - Emit [audio-added] to APP\"),O.clbLog({f:\"audio-added\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+s.streamId+\",stream\"}),i.emit(\"audio-added\",{stream:s}),i._remoteAudios.set(s.uuid,{userId:r.peer.name,streamId:s.getId()})):(O.debug(\"consumer event -- [resume] - userId: \"+n+\" uuid: \"+s.uuid+\" streamId: \"+s.getId()+\" appData: \"+(0,u.default)(a)+\" - Emit [\"+o+\"] to APP\"),O.clbLog({f:o,t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+s.streamId}),i.emit(o,{stream:s})):(s.attachVideoConsumer(r),O.debug(\"consumer event -- [resume] - userId: \"+n+\" uuid: \"+s.uuid+\" streamId: \"+s.getId()+\" appData: \"+(0,u.default)(a)+\" - Emit [video-added] to APP\"),O.clbLog({f:\"video-added\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+s.streamId+\",stream\"}),i.emit(\"video-added\",{stream:s}),i._remoteVideos.set(s.uuid,{userId:r.peer.name,streamId:s.getId()}))):O.warn(\"<EXCEPTION> - consumer event -- [resume] - userId: \"+n+\" consumerId: \"+r.id+\" - non-stream\")}})),r.on(\"stats\",(function(e){r.getStats().then((function(t){var n={};if(r.track&&\"video\"===r.track.kind&&(n=i._extractResolution(t)),r.peer){var a=r.appData?r.appData.streamID:r.peer.name;i._stats.setConsumeStats(e,n,r.peer.name,r.id,a)}})).catch((function(e){}))})),r.on(\"internalStats\",(function(e){if(r.peer){var t=i._internalStats(\"receiverStats\",e,r.peer.name,r.id);i._stats.pushLoggerToServer(null,t)}})),setTimeout((function(){if(r.supported){var t=r.appData?r.appData.streamID:r.peer.name,a=i._remoteStreams.get(\"\"+t);a||((a=new b.default({userId:r.peer.name,source:r.appData.source,streamId:t,videoType:r.appData.videoType,streamType:\"consumer\",openAudioCtx:!0})).streamObj=new MediaStream,i._remoteStreams.set(\"\"+t,a),a.on(\"@close\",(function(e,t){e?O.debug(\"stream.on('@close') - streamId: \"+t.streamId+\" -- isLocal: \"+e+\" is impossible here. WHAT HAPPENED??\"):O.debug(\"stream.on('@close') - streamId: \"+t.streamId)}))),a&&\"video\"===r.kind&&void 0!==r.appData.videoType&&(a.videoType=r.appData.videoType),O.debug(\"Will consumer.receive - consumer.kind: \"+r.kind+\" consumer.id: \"+r.id+\" userId: \"+n+\" stream.uuid: \"+a.uuid+\" streamId: \"+a.getId()),r.receive(i._recvTransport).then((function(t){if(\"audio\"===t.kind)try{a.attachAudioConsumer(r),r.remotelyPaused||(O.debug(\"consumer [audio] - userId: \"+n+\" stream.uuid: \"+a.uuid+\" streamId: \"+a.getId()+\" - Emit [audio-added] to APP\"),O.clbLog({f:\"audio-added\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+a.streamId+\",stream\"}),i.emit(\"audio-added\",{stream:a}),i._remoteAudios.set(a.uuid,{userId:r.peer.name,streamId:a.getId()}))}catch(e){O.debug(\"consumer [audio] - userId: \"+n+\" stream.uuid: \"+a.uuid+\" streamId: \"+a.getId()+\" - execpt: \"+e.name+\" \"+e.message)}else if(\"video\"===t.kind)try{a.attachVideoConsumer(r),r.remotelyPaused||(O.debug(\"consumer [video] - userId: \"+n+\" stream.uuid: \"+a.uuid+\" streamId: \"+a.getId()+\" - Emit [video-added] to APP\"),O.clbLog({f:\"video-added\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"stream-\"+a.streamId+\",stream\"}),i.emit(\"video-added\",{stream:a}),i.emit(\"video-update\",{userId:r.peer.name,streamId:a.getId(),videoType:a.videoType}),i._remoteVideos.set(a.uuid,{userId:r.peer.name,streamId:a.getId()}))}catch(e){O.debug(\"consumer [video] - userId: \"+n+\" stream.uuid: \"+a.uuid+\" streamId: \"+a.getId()+\" - execpt: \"+e.name+\" \"+e.message)}i._stats.setStreamSSRCPairs(\"consumer_\"+r.id,r.kind,0,a,!0),1===a.trackNumber&&(O.debug(\"consumer [\"+a.type+\"] - userId: \"+n+\" streamId: \"+a.getId()+\" - Emit [stream-added] to APP\"),i.emit(\"stream-added\",{stream:a,type:a.type})),r.transport.handler._pc.getStats(t).then((function(e){e.forEach((function(e){\"inbound-rtp\"===e.type&&(O.debug(\"<WEBRTC-STAT> - userId: \"+n+\" streamId: \"+a.getId()+\" consumer.kind: \"+r.kind+\" - \"+(0,u.default)(e)),i._stats.updateStreamSSRCPairs(\"consumer_\"+r.id,e.ssrc))}))}))})).catch((function(e){O.warn(\"_handleConsumer() error - userId: \"+n+\" consumer.kind: \"+r.kind+\" - unexpected error while receiving a new Consumer: \"+e.name+\" \"+e.message)})),a.subscribed||r.pause(),r.enableStats(i._interval)}else O.warn(\"<EXCEPTION> - _handleConsumer() - consumer.peer.name: \"+r.peer.name+\" consumer.kind: \"+r.kind+\" consumer.supported: \"+r.supported)}),200);case 14:case\"end\":return t.stop()}}),t,this)}))),function(e,t){return z.apply(this,arguments)})},{key:\"_setMicProducer\",value:function(e){var t=this;if(!e)return a.default.reject(new Error(\"INVALID parameter [stream]\"));if(!this._room.canSend(\"audio\"))return a.default.reject(new Error(\"cannot send audio\"));var r=null;return a.default.resolve().then((function(){var n=e.streamObj.getAudioTracks();if(n.length<=0)return a.default.reject(new Error(\"Audio track non-exist\"));var i=n[0],o=t._audioCodec.toLowerCase(),s=e.getAudioProfile();(s?s.codec.toLowerCase():\"\")!==o&&e.setAudioProfile(\"opus\"===o?\"music_standard\":\"isac32\");var c=e.getAudioProfile();return(r=t._room.createProducer(i,{audioProfile:c},{source:\"mic_\"+e.streamID,streamID:e.getId(),userID:e.userID})).send(t._sendTransport)})).then((function(){e.attachAudioProducer(r),t._audioProducer=r,r.enableStats(t._interval),r.on(\"close\",(function(n){O.debug(\"micProducer event -- [close] - [originator:\"+n+\"]\"),\"remote\"===n&&O.debug(\"producer close\"),t._audioProducer=null,e.detachAudioProducer(),r.disableStats()})),r.on(\"pause\",(function(e){O.debug(\"micProducer event -- [pause] - [originator:\"+e+\"]\")})),r.on(\"resume\",(function(e){O.debug(\"micProducer event -- [resume] - [originator:\"+e+\"]\")})),r.on(\"internalStats\",(function(e){var r=t._internalStats(\"senderStats\",e);t._stats.pushLoggerToServer(null,r)}))})).catch((function(n){throw r&&(t._audioProducer=null,e.detachAudioProducer(),r.close()),n}))}},{key:\"_setWebcamProducer\",value:function(e){var t=this;if(!e)return a.default.reject(new Error(\"INVALID parameter [stream]\"));if(!this._room.canSend(\"video\"))return a.default.reject(new Error(\"cannot send video\"));var r=void 0;return a.default.resolve().then((0,c.default)(s.default.mark((function n(){var i,o,c,d,u,l;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((i=e.streamObj.getVideoTracks()).length<=0)){n.next=5;break}return n.abrupt(\"return\",a.default.reject(new Error(\"Video track non-exist\")));case 5:if(o=i[0],c=t._audioCodec.toLowerCase(),d=e.getAudioProfile(),(d?d.codec.toLowerCase():\"\")!==c&&e.setAudioProfile(\"opus\"===c?\"music_standard\":\"isac32\"),u=e.getAudioProfile(),r=t._room.createProducer(o,{simulcast:t._useSimulcast,audioProfile:u,codecOptions:{videoGoogleStartBitrate:e.idealBandwidth,videoGoogleMaxBitrate:e.maxBandwidth,videoGoogleMinBitrate:e.minBandwidth}},{source:\"webcam_\"+e.streamID,streamID:e.getId(),userID:e.userID,videoType:e.videoType,defaultDev:e.isDefault})){n.next=16;break}return n.abrupt(\"return\",a.default.reject(new Error(\"createProducer fail\")));case 16:if(l=void 0,!t._sendTransport.hasVideoProducer){n.next=24;break}return n.next=20,t._newTransport(\"send\",\"web_cam\");case 20:l=n.sent,t._mapVideoSendTransports.set(e.getId(),l),n.next=25;break;case 24:l=t._sendTransport;case 25:return n.abrupt(\"return\",r.send(l));case 26:case\"end\":return n.stop()}}),n,t)})))).then((function(){t._mapVideoProducers.set(r.id,r),e.attachVideoProducer(r),r.enableStats(t._interval),r.on(\"close\",(function(n){t._stats.removeStreamById(\"producer_\"+r.id),O.debug(\"webcamProducer event -- [close] - [originator:\"+n+\"]\"),r.disableStats(),t._mapVideoProducers.delete(r.id),e.detachVideoProducer();var i=t._mapVideoSendTransports.get(e.getId());void 0!==i&&(i.close(),i.removeAllListeners(),t._mapVideoSendTransports.delete(e.getId()))})),r.on(\"pause\",(function(e){t._stats.actStreamSSRCPairs(\"producer_\"+r.id,!1),O.debug(\"webcamProducer event -- [pause] - [originator:\"+e+\"]\")})),r.on(\"resume\",(function(e){t._stats.actStreamSSRCPairs(\"producer_\"+r.id,!0),O.debug(\"webcamProducer event -- [resume] [originator:\"+e+\"]\")})),r.on(\"internalStats\",(function(e){var r=t._internalStats(\"senderStats\",e);t._stats.pushLoggerToServer(null,r)}))})).then((function(){t._stats.setStreamSSRCPairs(\"producer_\"+r.id,r.kind,0,e,!0),r.transport.handler._pc.getStats(r.track).then((function(e){e.forEach((function(e){\"outbound-rtp\"===e.type&&(O.debug(\"<WEBRTC-STAT> producer kind: \"+r.kind+\" - \"+(0,u.default)(e)),t._stats.updateStreamSSRCPairs(\"producer_\"+r.id,e.ssrc))}))}))})).catch((function(n){throw r&&(t._mapVideoProducers.delete(r.id),e.detachVideoProducer(),r.close()),n}))}},{key:\"_setScreenProducer\",value:function(e){var t=this;if(!e)return a.default.reject(new Error(\"INVALID parameter [stream]\"));if(!this._room.canSend(\"video\"))return a.default.reject(new Error(\"cannot send video\"));if(this._screenProducer)return a.default.reject(new Error(\"screen Producer already exists\"));var r=void 0;return a.default.resolve().then((0,c.default)(s.default.mark((function n(){var i;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.streamObj.getVideoTracks()[0],r=t._room.createProducer(i,{simulcast:t._useSimulcast,codecOptions:{videoGoogleStartBitrate:e.idealBandwidth,videoGoogleMaxBitrate:e.maxBandwidth,videoGoogleMinBitrate:e.minBandwidth}},{source:\"screen\",streamID:e.getId(),mode:\"only-cdn\"}),n.next=4,t._newTransport(\"send\",\"screen\");case 4:return t._screenTransport=n.sent,n.abrupt(\"return\",r.send(t._screenTransport));case 6:case\"end\":return n.stop()}}),n,t)})))).then((function(){t._screenProducer=r,t._screenProducer.enableStats(t._interval),r.on(\"close\",(function(e){t._stats.removeStreamById(\"producer_\"+r.id),O.debug(\"screenProducer event -- [close] - [originator:\"+e+\"]\"),t._screenProducer=null,t._screenTransport.close(),t._screenTransport.removeAllListeners(),t._screenTransport=null,r.disableStats()})),r.on(\"pause\",(function(e){t._stats.actStreamSSRCPairs(\"producer_\"+r.id,!1),O.debug(\"screenProducer event -- [pause] - [originator:\"+e+\"]\")})),r.on(\"resume\",(function(e){t._stats.actStreamSSRCPairs(\"producer_\"+r.id,!0),O.debug(\"screenProducer event -- [resume] - [originator:\"+e+\"]\")})),r.on(\"internalStats\",(function(e){var r=t._internalStats(\"senderStats\",e);t._stats.pushLoggerToServer(null,r)}))})).then((function(){t._stats.setStreamSSRCPairs(\"producer_\"+r.id,r.kind,0,e,!0),r.transport.handler._pc.getStats(r.track).then((function(e){e.forEach((function(e){\"outbound-rtp\"===e.type&&(O.debug(\"<WEBRTC-STAT> producer kind: \"+r.kind+\" - \"+(0,u.default)(e)),t._stats.updateStreamSSRCPairs(\"producer_\"+r.id,e.ssrc))}))}))})).catch((function(e){throw r&&(r.close(),t._screenProducer=null),e}))}},{key:\"_delay\",value:function(e){var t,r,n=new a.default((function(n,i){t=setTimeout(n,e),r=i}));return n.cancel=function(){clearTimeout(t),r(Error(\"Cancelled\"))},n}},{key:\"getStats\",value:function(){return this.getNetState()}},{key:\"getNetState\",value:function(){return{iceSendTransport:this._sendTransport?this._sendTransport.connectionState:\"fault\",iceRecvTransport:this._recvTransport?this._recvTransport.connectionState:\"fault\",websocketTransport:this._protooPeer&&this._protooPeer._transport?this._protooPeer._transport.connected?\"online\":\"offline\":\"fault\",loginStatus:this._joined?\"online\":\"offline\",stats:this._stats?this._stats.summarize:{}}}},{key:\"getRemoteAudioStats\",value:function(e){if(\"function\"!=typeof e)throw O.warn(\"API getRemoteAudioStats() error - parameter: callback invalid\"),new TypeError(\"callback is not function.\");e(this._stats.audioDownStat)}},{key:\"remoteAudioStats\",value:function(){return this._stats.audioDownStat}},{key:\"getRemoteVideoStats\",value:function(e){if(\"function\"!=typeof e)throw O.warn(\"API getRemoteVideoStats() error - parameter: callback invalid\"),new TypeError(\"callback is not function.\");e(this._stats.videoDownStat)}},{key:\"remoteVideoStats\",value:function(){return this._stats.videoDownStat}},{key:\"getLocalAudioStats\",value:function(e){if(\"function\"!=typeof e)throw O.warn(\"API getLocalAudioStats() error - parameter: callback invalid\"),new TypeError(\"callback is not function.\");e(this._stats.audioUpStat)}},{key:\"localAudioStats\",value:function(){return this._stats.audioUpStat}},{key:\"getLocalVideoStats\",value:function(e){if(\"function\"!=typeof e)throw O.warn(\"API getLocalVideoStats() error - parameter: callback invalid\"),new TypeError(\"callback is not function.\");e(this._stats.videoUpStat)}},{key:\"localVideoStats\",value:function(){return this._stats.videoUpStat}},{key:\"setLiveMixerLayout\",value:(W=(0,c.default)(s.default.mark((function t(r,n,a){var o,c,d,l,p,f,m,h,v,_,g,b,I,k,S,w,T,A;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(\"function\"==typeof n){t.next=3;break}throw O.error(\"API setLiveMixerLayout() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof a){t.next=6;break}throw O.error(\"API setLiveMixerLayout() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(r&&r.users){t.next=10;break}return O.warn(\"API setLiveMixerLayout() error - [INVALID_PARAM] - param [liveMixerLayout] invalid\"),a(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [liveMixerLayout] - liveMixerLayout invalid\"}),t.abrupt(\"return\");case 10:if(O.debug(\"API setLiveMixerLayout() >> liveMixerLayout: \"+(0,u.default)(r)),this._protooTransportStat&&this._protooPeer){t.next=15;break}return O.warn(\"API setLiveMixerLayout() << fail - [CONNECT_BROKEN] - protooTransport broken\"),a(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),t.abrupt(\"return\");case 15:if(this._joined){t.next=20;break}return O.warn(\"API setLiveMixerLayout() << fail - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"setLiveMixerLayout\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"liveMixerLayout-\"+(0,u.default)(r)}),a(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),t.abrupt(\"return\");case 20:if(O.funLog({f:\"setLiveMixerLayout\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"liveMixerLayout-\"+(0,u.default)(r)}),1==+this._role){t.next=25;break}return O.warn(\"API setLiveMixerLayout() << fail - [PERMISSION_DENIED] - Must be master - this._role: \"+this._role),a(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Must be Master(role=1)\"}),t.abrupt(\"return\");case 25:if(\"default\"!==(o=\"string\"==typeof r.url?r.url.trim():\"default\")&&\"\"!==o||(o=this._validRtmpUrl),this._rtmpUrls.has(o)){t.next=31;break}return O.warn(\"API setLiveMixerLayout() << fail - invalid rtmpUrl: \"+o),a(\"RTMP_CURRENT\",{code:P.tttErrCode.RTMP_CURRENT,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Invalid rtmpUrl\"}),t.abrupt(\"return\");case 31:if(c=[],d=null,(d=this._allRtmpLiveMixerLayout.has(o)?this._allRtmpLiveMixerLayout.get(o):null)&&d.users)for(l=0;l<r.users.length;l++)for(p=0;p<d.users.length;p++)d.users[p].streamId===r.users[l].streamId&&c.push(d.users[p]);f=[],d&&d.users&&(f=d.users.filter((function(e){return!c.find((function(t){return e.streamId===t.streamId}))}))),m=r.users.filter((function(e){return!c.find((function(t){return e.streamId===t.streamId}))})),O.debug(\"API setLiveMixerLayout() - liveMixerLayout: \"+(0,u.default)(r)+\" - layout: \"+(0,u.default)(d)+\" - addUser: \"+(0,u.default)(m)+\" delUser: \"+(0,u.default)(f)),t.prev=38,h=\"\",v=0,v=0;case 42:if(!(v<f.length)){t.next=51;break}if(!f[v]){t.next=48;break}return _={type:\"del\",peerId:\"\"+f[v].userId,devId:\"\"+f[v].streamId||\"\",rtmpUrl:o},h=h+\" - \"+(0,u.default)(_),t.next=48,this._protooPeer.send(\"setMixer\",_);case 48:v++,t.next=42;break;case 51:\"\"!==h&&O.debug(\"API setLiveMixerLayout() - type: del - setMixer: \"+h),h=\"\",v=0;case 54:if(!(v<m.length)){t.next=63;break}if(!m[v]){t.next=60;break}return g={type:\"add\",peerId:\"\"+m[v].userId,devId:\"\"+m[v].streamId||\"\",rtmpUrl:o},h=h+\" - \"+(0,u.default)(g),t.next=60,this._protooPeer.send(\"setMixer\",g);case 60:v++,t.next=54;break;case 63:return\"\"!==h&&O.debug(\"API setLiveMixerLayout() - type: add - setMixer: \"+h),b=232,I=230,k=232,S=r.backgroundColor?r.backgroundColor.toString(16):\"00000000\",(w=S.length)<=2?k=parseInt(\"0x\"+S.slice(0)):w<=4?(k=parseInt(\"0x\"+S.slice(w-2)),I=parseInt(\"0x\"+S.slice(0,w-2))):(k=parseInt(\"0x\"+S.slice(w-2)),I=parseInt(\"0x\"+S.slice(w-4,w-2)),b=parseInt(\"0x\"+S.slice(0,w-4))),T=(new Date).getTime(),A={ts:\"\"+T,ver:\"20161227\",canvas:{bgrad:[b,I,k],h:r.height?r.height:480,w:r.width?r.width:640},mid:\"\"+this._uid,pos:[]},r.users.forEach((function(e){if(e&&\"object\"===(void 0===e?\"undefined\":(0,i.default)(e))){var t={};t.id=\"\"+e.streamId,t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t.z=e.z,t.renderMode=e.renderMode,A.pos.push(t)}})),t.next=75,this._protooPeer.send(\"setSEI\",{sei:A,rtmpUrl:o});case 75:return d=y.clone(r),this._allRtmpLiveMixerLayout.set(o,d),O.debug(\"API setLiveMixerLayout() << success - sei: \"+(0,u.default)(A)+\" - layout: \"+(0,u.default)(d)),n(),t.abrupt(\"return\");case 82:return t.prev=82,t.t0=t.catch(38),O.warn(\"API setLiveMixerLayout() << fail - [TASK_FAIL] - \"+t.t0.name+\" \"+t.t0.message),a(\"TASK_FAIL\",{code:P.tttErrCode.TASK_FAIL,name:\"TASK_FAIL\",origin:\"\"+t.t0.name,message:\"setLiveMixerLayout fail - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 87:case\"end\":return t.stop()}}),t,this,[[38,82]])}))),function(e,t,r){return W.apply(this,arguments)})},{key:\"startLiveStreaming\",value:(K=(0,c.default)(s.default.mark((function t(r,n,i){var a,o,c;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=4;break}return O.warn(\"API startLiveStreaming() error - [INVALID_PARAM] - opts\"),\"function\"==typeof i&&i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"Param [opts] is invalid\"}),t.abrupt(\"return\");case 4:if(1==+this._role){t.next=8;break}return O.warn(\"API startLiveStreaming() error - [PERMISSION_DENIED] - Must be master - this._role: \"+this._role),\"function\"==typeof i&&i(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Must be master\"}),t.abrupt(\"return\");case 8:if(a=\"string\"==typeof r.url?r.url.trim():\"\"){t.next=13;break}return O.warn(\"API startLiveStreaming() except - [INVALID_PARAM] - \"+a),\"function\"==typeof i&&i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"startLiveStreaming INVALID_PARAM - \"+a}),t.abrupt(\"return\");case 13:if(a!==this._validRtmpUrl){t.next=17;break}return O.warn(\"API startLiveStreaming() except - [INVALID_PARAM] - \"+a),\"function\"==typeof i&&i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"startLiveStreaming INVALID_PARAM - \"+a}),t.abrupt(\"return\");case 17:if(!this._rtmpUrls.has(a)){t.next=21;break}return O.warn(\"API startLiveStreaming() except - [RTMP_URL_ALREADY_EXIST] - \"+a),\"function\"==typeof i&&i(\"RTMP_URL_ALREADY_EXIST\",{code:P.tttErrCode.RTMP_URL_ALREADY_EXIST,name:\"RTMP_URL_ALREADY_EXIST\",origin:\"\",message:\"startLiveStreaming RTMP_URL_ALREADY_EXIST - \"+a}),t.abrupt(\"return\");case 21:if(o=r.avMode,c=0,c=void 0!==o&&\"audio\"===o?1:2,this._joined){t.next=29;break}return O.warn(\"API startLiveStreaming() << fail - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"startLiveStreaming\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"rtmpUrl-\"+(0,u.default)(a)+\", mediaType-\"+(0,u.default)(c)}),i(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),t.abrupt(\"return\");case 29:return O.funLog({f:\"startLiveStreaming\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"opts-\"+(0,u.default)(r)}),t.prev=30,t.next=33,this._protooPeer.send(\"createMixer\",{rtmpUrl:a,mediaType:c});case 33:this._rtmpUrls.set(a,{url:a,state:\"init\"}),O.debug(\"API startLiveStreaming() success - \"+a+\" mediaType: \"+c),\"function\"==typeof n&&n(),t.next=43;break;case 38:return t.prev=38,t.t0=t.catch(30),O.warn(\"API startLiveStreaming() except - [SYS_EXCEPTION] - \"+t.t0.name+\" \"+t.t0.message),\"function\"==typeof i&&i(\"SYS_EXCEPTION\",{code:P.tttErrCode.SYS_EXCEPTION,name:\"SYS_EXCEPTION\",origin:\"\"+t.t0.name,message:\"startLiveStreaming except - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 43:case\"end\":return t.stop()}}),t,this,[[30,38]])}))),function(e,t,r){return K.apply(this,arguments)})},{key:\"stopLiveStreaming\",value:(H=(0,c.default)(s.default.mark((function t(r,n,i){var a;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=\"string\"==typeof r?r.trim():\"\"){t.next=5;break}return O.warn(\"API stopLiveStreaming() except - [INVALID_PARAM] - \"+a),\"function\"==typeof i&&i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"stopLiveStreaming INVALID_PARAM - \"+a}),t.abrupt(\"return\");case 5:if(a!==this._validRtmpUrl){t.next=9;break}return O.warn(\"API stopLiveStreaming() except - [INVALID_PARAM] - rtmpUrl: \"+a+\" === this._validRtmpUrl\"),\"function\"==typeof i&&i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"stopLiveStreaming INVALID_PARAM - \"+a}),t.abrupt(\"return\");case 9:if(1==+this._role){t.next=13;break}return O.warn(\"API stopLiveStreaming() error - [PERMISSION_DENIED] - Must be master - this._role: \"+this._role),\"function\"==typeof i&&i(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Must be master\"}),t.abrupt(\"return\");case 13:if(this._joined){t.next=18;break}return O.warn(\"API stopLiveStreaming() << fail - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"stopLiveStreaming\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"url-\"+(0,u.default)(r)}),i(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),t.abrupt(\"return\");case 18:return O.funLog({f:\"stopLiveStreaming\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"url-\"+r}),t.prev=19,t.next=22,this._protooPeer.send(\"destroyMixer\",{rtmpUrl:a});case 22:this._rtmpUrls.delete(a),O.debug(\"API stopLiveStreaming() success - \"+a),this._allRtmpLiveMixerLayout.has(a)&&this._allRtmpLiveMixerLayout.delete(a),\"function\"==typeof n&&n(),t.next=33;break;case 28:return t.prev=28,t.t0=t.catch(19),O.warn(\"API stopLiveStreaming() except - [SYS_EXCEPTION] - \"+t.t0.name+\" \"+t.t0.message),\"function\"==typeof i&&i(\"SYS_EXCEPTION\",{code:P.tttErrCode.SYS_EXCEPTION,name:\"SYS_EXCEPTION\",origin:\"\"+t.t0.name,message:\"stopLiveStreaming except - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 33:case\"end\":return t.stop()}}),t,this,[[19,28]])}))),function(e,t,r){return H.apply(this,arguments)})},{key:\"setSEI\",value:(G=(0,c.default)(s.default.mark((function t(r,n,i,a,o,c,d){var l,p;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._protooTransportStat&&this._protooPeer){t.next=4;break}return O.warn(\"API setSEI() error - [CONNECT_BROKEN] - protooTransport broken\"),\"function\"==typeof d&&d(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),t.abrupt(\"return\");case 4:if(this._joined){t.next=9;break}return O.warn(\"API setSEI() error - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"setSEI\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"uid-\"+r+\", type-\"+n+\", isScreen-\"+i+\", sei-\"+a+\", devId-\"+o}),\"function\"==typeof d&&d(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),t.abrupt(\"return\");case 9:if(O.funLog({f:\"setSEI\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"uid-\"+r+\", type-\"+n+\", isScreen-\"+i+\", sei-\"+a+\", devId-\"+o}),1==+this._role){t.next=14;break}return O.warn(\"API setSEI() error - [PERMISSION_DENIED] - Must be master - this._role: \"+this._role),\"function\"==typeof d&&d(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Must be master\"}),t.abrupt(\"return\");case 14:if(l=\"\",\"add\"===n.toLocaleLowerCase()?l=\"add\":\"del\"===n.toLocaleLowerCase()&&(l=\"del\"),\"\"!==l){t.next=20;break}return O.warn(\"setSEI() error - [INVALID_PARAM] - parameter [type] type: \"+n+\" is INVALID\"),\"function\"==typeof d&&d(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [type] is invalid\"}),t.abrupt(\"return\");case 20:return p={type:l,peerId:\"\"+r,devId:o||\"\"},i&&(p.devId=r+\":screen\",a.pos=a.pos.map((function(e){return e.id===o&&(e.id=r+\":screen\"),e}))),O.debug(\"API setSEI() - uid: \"+r+\" type: \"+n+\" isScreen: \"+i+\" sType: \"+(0,u.default)(p)+\" sei: \"+(0,u.default)(a)+\" devId: \"+o),t.prev=23,t.next=26,this._protooPeer.send(\"setMixer\",p);case 26:return t.next=28,this._protooPeer.send(\"setSEI\",{sei:a});case 28:return O.debug(\"API setSEI() success\"),\"function\"==typeof c&&c(),t.abrupt(\"return\");case 33:return t.prev=33,t.t0=t.catch(23),O.warn(\"API setSEI() fail - [ERROR_UNDEFINED] - this._protooPeer.send - \"+t.t0.name+\" \"+t.t0.message),\"function\"==typeof d&&d(\"ERROR_UNDEFINED\",{code:P.tttErrCode.ERROR_UNDEFINED,name:\"ERROR_UNDEFINED\",origin:\"\"+t.t0.name,message:\"setSEI fail - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 38:case\"end\":return t.stop()}}),t,this,[[23,33]])}))),function(e,t,r,n,i,a,o){return G.apply(this,arguments)})},{key:\"subscribeOtherRoom\",value:(U=(0,c.default)(s.default.mark((function e(t,r,n){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof r){e.next=3;break}throw O.error(\"API subscribeOtherRoom() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof n){e.next=6;break}throw O.error(\"API subscribeOtherRoom() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(t){e.next=10;break}return O.warn(\"API subscribeOtherRoom() error - [INVALID_PARAM] - parameter: subscribeRoomId invalid\"),n(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [subscribeRoomId] is invalid\"}),e.abrupt(\"return\");case 10:if(O.warn(\"API subscribeOtherRoom() >> subscribeRoomId: \"+t),this._protooTransportStat&&this._protooPeer){e.next=15;break}return O.warn(\"API subscribeOtherRoom() << fail - [CONNECT_BROKEN] - protooTransport broken\"),n(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),e.abrupt(\"return\");case 15:if(this._joined){e.next=19;break}return O.warn(\"API subscribeOtherRoom() << fail - [NOT_LOGIN] - non-joined\"),n(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),e.abrupt(\"return\");case 19:if(1==+this._role){e.next=23;break}return O.warn(\"API subscribeOtherRoom() << fail - [PERMISSION_DENIED] - Must be master - this._role: \"+this._role),n(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Must be Master(role=1)\"}),e.abrupt(\"return\");case 23:return e.prev=23,e.next=26,this._protooPeer.send(\"subscribeOtherRoom\",{subscribeRoomId:t});case 26:return O.warn(\"API subscribeOtherRoom() << success - subscribeRoomId: \"+t),r(),e.abrupt(\"return\");case 31:return e.prev=31,e.t0=e.catch(23),O.warn(\"API subscribeOtherRoom() << fail - [TASK_FAIL] - subscribeRoomId: \"+t),n(\"TASK_FAIL\",{code:P.tttErrCode.TASK_FAIL,name:\"TASK_FAIL\",origin:\"\",message:\"subscribeOtherRoom except - \"+e.t0.name+\" \"+e.t0.message}),e.abrupt(\"return\");case 36:case\"end\":return e.stop()}}),e,this,[[23,31]])}))),function(e,t,r){return U.apply(this,arguments)})},{key:\"unsubscribeOtherRoom\",value:(F=(0,c.default)(s.default.mark((function e(t,r,n){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof r){e.next=3;break}throw O.error(\"API unsubscribeOtherRoom() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof n){e.next=6;break}throw O.error(\"API unsubscribeOtherRoom() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(t){e.next=10;break}return O.warn(\"API unsubscribeOtherRoom() error - [INVALID_PARAM] - parameter: unsubscribeRoomId invalid\"),n(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [unsubscribeRoomId] is invalid\"}),e.abrupt(\"return\");case 10:if(O.warn(\"API unsubscribeOtherRoom() >> unsubscribeRoomId: \"+t),this._protooTransportStat&&this._protooPeer){e.next=15;break}return O.warn(\"API unsubscribeOtherRoom() << fail - [CONNECT_BROKEN] - protooTransport broken\"),n(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),e.abrupt(\"return\");case 15:if(this._joined){e.next=19;break}return O.warn(\"API unsubscribeOtherRoom() << fail - [NOT_LOGIN] - non-joined\"),n(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),e.abrupt(\"return\");case 19:if(1==+this._role){e.next=23;break}return O.warn(\"API unsubscribeOtherRoom() << fail - [PERMISSION_DENIED] - Must be master - this._role: \"+this._role),n(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Must be Master(role=1)\"}),e.abrupt(\"return\");case 23:return e.prev=23,e.next=26,this._protooPeer.send(\"unsubscribeOtherRoom\",{unsubscribeRoomId:t});case 26:O.warn(\"API unsubscribeOtherRoom() >> success - subscribeRoomId: \"+t),r(),e.next=35;break;case 30:return e.prev=30,e.t0=e.catch(23),O.warn(\"API unsubscribeOtherRoom() >> fail - [TASK_FAIL] - subscribeRoomId: \"+t),n(\"TASK_FAIL\",{code:P.tttErrCode.TASK_FAIL,name:\"TASK_FAIL\",origin:\"\"+e.t0.name,message:\"unsubscribeOtherRoom except - \"+e.t0.name+\" \"+e.t0.message}),e.abrupt(\"return\");case 35:case\"end\":return e.stop()}}),e,this,[[23,30]])}))),function(e,t,r){return F.apply(this,arguments)})},{key:\"setUserRole\",value:(j=(0,c.default)(s.default.mark((function t(r,n,i){var a;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(\"function\"==typeof n){t.next=3;break}throw O.error(\"API setUserRole() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof i){t.next=6;break}throw O.error(\"API setUserRole() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(r){t.next=10;break}return O.warn(\"API setUserRole() error - [INVALID_PARAM] - parameter [role] is INVALID.\"),i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [role] is invalid\"}),t.abrupt(\"return\");case 10:if(a=+r,!this._joined){t.next=50;break}if(this._protooTransportStat){t.next=16;break}return O.warn(\"API setUserRole() error - [CONNECT_BROKEN] - protooTransport broken\"),i(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),t.abrupt(\"return\");case 16:if(3!==a||!this.isPublish){t.next=20;break}return O.warn(\"API setUserRole() error - [ERROR_UNDEFINED] - unpublish all the stream before setUserRole\"),i(\"ERROR_UNDEFINED\",{code:P.tttErrCode.ERROR_UNDEFINED,name:\"ERROR_UNDEFINED\",origin:\"\",message:\"Please unpublish all stream\"}),t.abrupt(\"return\");case 20:if(+this._role!==a){t.next=23;break}return n(),t.abrupt(\"return\");case 23:if(2===a||3===a){t.next=27;break}return O.warn(\"API setUserRole() error - [CONNECT_BROKEN] - Role: Only allowed between 2 | 3\"),i(\"INVALID_PARAM\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"INVALID_PARAM\",origin:\"\",message:\"param [role] is invalid - Role: Only allowed between 2 | 3\"}),t.abrupt(\"return\");case 27:if(1!=+this._role){t.next=31;break}return O.warn(\"API setUserRole() error - [CONNECT_BROKEN] - Role: Only allowed between 2 | 3\"),i(\"INVALID_PARAM\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"INVALID_PARAM\",origin:\"\",message:\"param [role] is invalid - Role: Only allowed between 2 | 3\"}),t.abrupt(\"return\");case 31:return O.debug(\"API setUserRole() - role: \"+a),t.prev=32,t.next=35,this._protooPeer.send(\"changeRole\",{role:a});case 35:return O.debug(\"API setUserRole() success\"),O.funLog({f:\"setUserRole\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"role-\"+r}),this._role=a+\"\",e.g_role=this._role,n(),t.abrupt(\"return\");case 43:return t.prev=43,t.t0=t.catch(32),O.warn(\"API setUserRole() fail - [TASK_FAIL] - \"+t.t0.name+\" \"+t.t0.message),i(\"TASK_FAIL\",{code:P.tttErrCode.TASK_FAIL,name:\"TASK_FAIL\",origin:\"\"+t.t0.name,message:\"setUserRole except - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 48:t.next=59;break;case 50:if(!(a>3||a<1)){t.next=54;break}return O.warn(\"API setUserRole() error - [INVALID_PARAM] - parameter [role] is INVALID.\"),i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [role] is invalid - Role: Only allowed between 1 | 2 | 3\"}),t.abrupt(\"return\");case 54:O.debug(\"API setUserRole() - role: \"+r),e.g_PreFun.push({f:\"setUserRole\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"role-\"+r}),this._role=r+\"\",e.g_role=this._role,n();case 59:case\"end\":return t.stop()}}),t,this,[[32,43]])}))),function(e,t,r){return j.apply(this,arguments)})},{key:\"setVideoMixerBGIUrl\",value:(V=(0,c.default)(s.default.mark((function t(r,n,a){var o,c;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(\"function\"==typeof n){t.next=3;break}throw O.error(\"API setVideoMixerBGIUrl() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof a){t.next=6;break}throw O.error(\"API setVideoMixerBGIUrl() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(r){t.next=10;break}return O.warn(\"API setVideoMixerBGIUrl() error - [INVALID_PARAM] - opts\"),\"function\"==typeof a&&a(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"Param [opts] is invalid\"}),t.abrupt(\"return\");case 10:if(this._joined){t.next=15;break}return O.warn(\"API setVideoMixerBGIUrl() << fail - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"setVideoMixerBGIUrl\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"opts-\"+(0,u.default)(r)}),a(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),t.abrupt(\"return\");case 15:if(o=\"\",c=\"\",\"string\"==typeof r?c=r.trim():\"object\"===(void 0===r?\"undefined\":(0,i.default)(r))&&(o=\"string\"==typeof r.rtmpUrl?r.rtmpUrl.trim():\"\",c=\"string\"==typeof r.imgUrl?r.imgUrl.trim():\"\"),\"default\"!==o&&\"\"!==o||(o=this._validRtmpUrl),this._rtmpUrls.has(o)){t.next=23;break}return O.warn(\"API setVideoMixerBGIUrl() error - [BGURL_SET_FAIL] - rtmpUrl not-ready\"),a(\"BGURL_SET_FAIL\",{code:P.tttErrCode.BGURL_SET_FAIL,name:\"BGURL_SET_FAIL\",origin:\"\",message:\"BGURL_SET_FAIL,  - rtmpUrl : \"+o+\" state is init\"}),t.abrupt(\"return\");case 23:if(\"string\"==typeof c&&\"\"!==c.trim()){t.next=27;break}return O.warn(\"API setVideoMixerBGIUrl() error - [INVALID_PARAM] - imgUrl: \"+c),a(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [imgUrl] is invalid\"}),t.abrupt(\"return\");case 27:return t.prev=27,O.funLog({f:\"setVideoMixerBGIUrl\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"rtmpUrl-\"+o+\", imgUrl-\"+c}),t.next=31,this._protooPeer.send(\"setMixerBkImg\",{imgUrl:c,rtmpUrl:o});case 31:O.debug(\"API setVideoMixerBGIUrl() success - rtmpUrl: \"+o+\" imgUrl: \"+c),n(),t.next=40;break;case 35:return t.prev=35,t.t0=t.catch(27),O.warn(\"API setVideoMixerBGIUrl() error - [BGURL_SET_FAIL] except - \"+t.t0.name+\" \"+t.t0.message),a(\"BGURL_SET_FAIL\",{code:P.tttErrCode.BGURL_SET_FAIL,name:\"BGURL_SET_FAIL\",origin:\"\",message:\"setVideoMixerBGIUrl except - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 40:case\"end\":return t.stop()}}),t,this,[[27,35]])}))),function(e,t,r){return V.apply(this,arguments)})},{key:\"setRtmpUrl\",value:(E=(0,c.default)(s.default.mark((function t(r,n,i){var a,o,c,d,l;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=4;break}return O.warn(\"API setRtmpUrl() error - [INVALID_PARAM] - opts\"),\"function\"==typeof i&&i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"Param [opts] is invalid\"}),t.abrupt(\"return\");case 4:if(O.debug(\"API setRtmpUrl() >> opts: \"+(0,u.default)(r)),a=r.avMode,o=0,o=void 0!==a&&\"audio\"===a?1:2,1==+this._role){t.next=12;break}return O.warn(\"API setRtmpUrl() error - [PERMISSION_DENIED] - Must be master - this._role: \"+this._role),\"function\"==typeof i&&i(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Must be master\"}),t.abrupt(\"return\");case 12:if(c=\"string\"==typeof r.url?r.url.trim():\"\",d=\"string\"==typeof r.rtmpUrl?r.rtmpUrl.trim():\"\",c){t.next=18;break}return O.warn(\"API setRtmpUrl() except - [INVALID_PARAM] - \"+c),\"function\"==typeof i&&i(\"INVALID_PARAM\",{code:P.tttErrCode.SYS_EXCEPTION,name:\"INVALID_PARAM\",origin:\"\",message:\"setRtmpUrl except - param [url] is invalid\"}),t.abrupt(\"return\");case 18:if(\"default\"===c&&(c=this._defaultRtmpUrl),l=!1,\"default\"!==d&&\"\"!==d||(l=!0,d=this._validRtmpUrl),!this._joined){t.next=42;break}if(t.prev=22,this._rtmpUrls.has(d)){t.next=27;break}return O.warn(\"API setRtmpUrl() except - [INVALID_PARAM] - \"+d+\" non-exist\"),i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"setRtmpUrl() except - [INVALID_PARAM] - \"+d+\" non-exist\"}),t.abrupt(\"return\");case 27:return t.next=29,this._protooPeer.send(\"updateRtmpUrl\",{roomId:this._roomId,url:c,mediaType:o,rtmpUrl:d});case 29:c!==d&&(this._rtmpUrls.delete(d),this._rtmpUrls.set(c,{url:c,state:\"init\"}),this._allRtmpLiveMixerLayout.has(d)&&(this._allRtmpLiveMixerLayout.set(c,this._allRtmpLiveMixerLayout.get(d)),this._allRtmpLiveMixerLayout.delete(d))),l&&(this._validRtmpUrl=c.trim()),O.debug(\"API setRtmpUrl() success - \"+d+\" update to \"+c+\" mediaType: \"+o),O.funLog({f:\"setRtmpUrl\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"opts-\"+(0,u.default)(r)}),t.next=40;break;case 35:return t.prev=35,t.t0=t.catch(22),O.warn(\"API setRtmpUrl() except - [SYS_EXCEPTION] - \"+t.t0.name+\" \"+t.t0.message),\"function\"==typeof i&&i(\"SYS_EXCEPTION\",{code:P.tttErrCode.SYS_EXCEPTION,name:\"SYS_EXCEPTION\",origin:\"\"+t.t0.name,message:\"setRtmpUrl except - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 40:t.next=43;break;case 42:e.g_PreFun.push({f:\"setRtmpUrl\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"opts-\"+(0,u.default)(r)});case 43:\"function\"==typeof n&&n();case 44:case\"end\":return t.stop()}}),t,this,[[22,35]])}))),function(e,t,r){return E.apply(this,arguments)})},{key:\"renewToken\",value:(A=(0,c.default)(s.default.mark((function e(t,r,n){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof r){e.next=3;break}throw O.error(\"API renewToken() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof n){e.next=6;break}throw O.error(\"API renewToken() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(this._joined){e.next=10;break}return O.warn(\"you should join room first - [NOT_LOGIN]\"),n(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),e.abrupt(\"return\");case 10:if(\"string\"!=typeof t){e.next=23;break}return e.prev=11,e.next=14,this._protooPeer.send(\"refreshToken\",{token:t});case 14:O.debug(\"API renewToken() success\"),e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(11),n(\"SYS_EXCEPTION\",{code:P.tttErrCode.SYS_EXCEPTION,name:\"SYS_EXCEPTION\",origin:\"\"+e.t0.name,message:\"except - \"+e.t0.name+\" \"+e.t0.message}),e.abrupt(\"return\");case 21:e.next=26;break;case 23:return O.debug(\"API renewToken() error - [INVALID_PARAM] - Param error - token is invalid\"),n(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"Param [token] is invalid\"}),e.abrupt(\"return\");case 26:case\"end\":return e.stop()}}),e,this,[[11,17]])}))),function(e,t,r){return A.apply(this,arguments)})},{key:\"kickOut\",value:(k=(0,c.default)(s.default.mark((function t(r,n,i){var a;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._protooTransportStat){t.next=4;break}return O.warn(\"API kickOut() error - [CONNECT_BROKEN] - protooTransport broken\"),\"function\"==typeof i&&i(\"CONNECT_BROKEN\",{code:P.tttErrCode.CONNECT_BROKEN,name:\"CONNECT_BROKEN\",origin:\"\",message:\"protooTransport is broken\"}),t.abrupt(\"return\");case 4:if(this._joined){t.next=9;break}return O.warn(\"API kickOut() error - [NOT_LOGIN] - non-joined\"),e.g_PreFun.push({f:\"kickOut\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"userId-\"+r}),\"function\"==typeof i&&i(\"NOT_LOGIN\",{code:P.tttErrCode.NOT_LOGIN,name:\"NOT_LOGIN\",origin:\"\",message:\"client is not login\"}),t.abrupt(\"return\");case 9:if(O.funLog({f:\"kickOut\",t:y.getNowTime(),i:e.g_OrderCount+=1,p:\"userId-\"+r}),r){t.next=14;break}return O.warn(\"API kickOut() error - [INVALID_PARAM] - parameter [userId] is INVALID.\"),\"function\"==typeof i&&i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [userId] is invalid\"}),t.abrupt(\"return\");case 14:if(\"\"!==(a=(a=r+\"\").trim())){t.next=20;break}return O.warn(\"API kickOut() error - [INVALID_PARAM] - parameter [userId] is INVALID.\"),\"function\"==typeof i&&i(\"INVALID_PARAM\",{code:P.tttErrCode.INVALID_PARAM,name:\"INVALID_PARAM\",origin:\"\",message:\"param [userId] is invalid\"}),t.abrupt(\"return\");case 20:if(1==+this._role){t.next=24;break}return O.warn(\"API kickOut() error - [PERMISSION_DENIED] - Must be master - this._role: \"+this._role),\"function\"==typeof i&&i(\"PERMISSION_DENIED\",{code:P.tttErrCode.PERMISSION_DENIED,name:\"PERMISSION_DENIED\",origin:\"\",message:\"Permission denied - Must be master\"}),t.abrupt(\"return\");case 24:if(this._peers.get(\"\"+a)){t.next=28;break}return O.warn(\"API kickOut() error - [ERROR_UNDEFINED] - userId: \"+a+\" not found.\"),\"function\"==typeof i&&i(\"ERROR_UNDEFINED\",{code:P.tttErrCode.ERROR_UNDEFINED,name:\"ERROR_UNDEFINED\",origin:\"\",message:\"peer: \"+a+\" not found\"}),t.abrupt(\"return\");case 28:return t.prev=28,t.next=31,this._protooPeer.send(\"kickout\",{peerId:a});case 31:return O.debug(\"API kickOut() sucess - userId: \"+a),\"function\"==typeof n&&n(),t.abrupt(\"return\");case 36:return t.prev=36,t.t0=t.catch(28),O.warn(\"API kickOut() fail - [SYS_EXCEPTION] - \"+t.t0.name+\" \"+t.t0.message),i(\"SYS_EXCEPTION\",{code:P.tttErrCode.SYS_EXCEPTION,name:\"SYS_EXCEPTION\",origin:\"\"+t.t0.name,message:\"kickOut except - \"+t.t0.name+\" \"+t.t0.message}),t.abrupt(\"return\");case 41:case\"end\":return t.stop()}}),t,this,[[28,36]])}))),function(e,t,r){return k.apply(this,arguments)})},{key:\"getTransportStatus\",value:function(){return{iceSendTransport:this._sendTransport?this._sendTransport.connectionState:\"fault\",iceRecvTransport:this._recvTransport?this._recvTransport.connectionState:\"fault\",websocketTransport:this._protooPeer&&this._protooPeer._transport?this._protooPeer._transport.connected:\"fault\",loginStatus:this._joined?\"online\":\"offline\"}}},{key:\"_extractResolution\",value:function(e){var t={frameHeight:0,frameWidth:0},r={};return e.forEach((function(e){(0,n.default)(e).forEach((function(r){\"frameheight\"===r.toLocaleLowerCase()&&(t.frameHeight=e[r]),\"framewidth\"===r.toLocaleLowerCase()&&(t.frameWidth=e[r])}));try{if(0!==t.frameWidth)throw r}catch(e){if(e!==r)throw e}})),t}},{key:\"_newTransport\",value:(_=(0,c.default)(s.default.mark((function t(r,n){var i,a,o=this;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=\"\",r){t.next=3;break}return t.abrupt(\"return\");case 3:if(\"send\"===r||\"recv\"===r){t.next=5;break}return t.abrupt(\"return\");case 5:i=n&&\"\"!==n?n:\"SEND_MIC_WEBCAM\",a=null,t.prev=7,a=this._room.createTransport(\"send\",{media:i}),t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(7),O.warn(\"_newTransport() this._room.createTransport fail - direction: \"+n+\" type: \"+n+\" \"+t.t0.name+\" \"+t.t0.message),t.abrupt(\"return\");case 15:return O.debug(\"_newTransport() createTransport succ - direction: \"+n+\" type: \"+n),a.on(\"close\",(function(e){O.debug(\"sendTransport event -- [close] - [originator: \"+e+\"]\"),delete o._transportInfo.sendTransport[a.id]})),a.on(\"connectionstatechange\",function(){var t=(0,c.default)(s.default.mark((function t(r){return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:\"disconnected\"===r?(o._iceSendDisconnectedCnt++,O.warn(\"sendTransport event -- [connectionstatechange:disconnected] will retryRestartIce after 500ms\"),setTimeout((function(){a&&a.attemptRestartIce()}),500)):\"failed\"===r?(O.warn(\"sendTransport event -- [connectionstatechange:failed] will retryRestartIce...\"),a.attemptRestartIce()):\"connected\"===r&&C(a._handler._pc,(function(t){if(t&&a){if(Boolean(t.connectionType)&&Boolean(t.connectionType.local)&&Boolean(t.connectionType.remote)){var r={localIp:t.connectionType.local.ipAddress,localPort:t.connectionType.local.portNumber,remoteIp:t.connectionType.remote.ipAddress,remotePort:t.connectionType.remote.portNumber};o._transportInfo.sendTransport[a.id]=r,\"string\"==typeof t.connectionType.local.ipAddress&&\"\"!==t.connectionType.local.ipAddress.trim()&&(e.g_myPublicIP=t.connectionType.local.ipAddress)}o._stats.setWebrtcInternalSendStats(a.id,t)}}),2e3,\"send\"),O.debug(\"sendTransport connectionstatechange: \"+r);case 2:case\"end\":return t.stop()}}),t,o)})));return function(e){return t.apply(this,arguments)}}()),t.abrupt(\"return\",a);case 19:case\"end\":return t.stop()}}),t,this,[[7,11]])}))),function(e,t){return _.apply(this,arguments)})},{key:\"_internalStats\",value:function(e,t,r,n){var i={appId:this._appId,userId:this._uid,roomId:this._roomId,stats:\"internalStats\",direction:e,\"media-source\":[],certificate:[],codec:[],\"candidate-pair\":[],\"local-candidate\":[],\"remote-candidate\":[],\"inbound-rtp\":[],\"outbound-rtp\":[],\"remote-inbound-rtp\":[],track:[],stream:[],\"peer-connection\":[],transport:[]};return t.forEach((function(e){e.type,\"codec\"===e.type&&i.codec.push(e),\"candidate-pair\"===e.type&&i[\"candidate-pair\"].push(e),\"local-candidate\"===e.type&&i[\"local-candidate\"].push(e),\"inbound-rtp\"===e.type&&i[\"inbound-rtp\"].push(e),\"track\"===e.type&&i.track.push(e),\"stream\"===e.type&&i.stream.push(e),\"peer-connection\"===e.type&&i[\"peer-connection\"].push(e),\"transport\"===e.type&&i.transport.push(e),\"media-source\"===e.type&&i[\"media-source\"].push(e),\"transport\"===e.type&&i.transport.push(e)})),\"receiverStats\"===e&&(i.consumerPeerId=r,i.consumer=n),i}},{key:\"producerStreams\",get:function(){var e=[];return this._publishStreams.forEach((function(t,r){if(t){var n={streamId:t.streamID,type:t.streamType,userId:t.userID,specialCameraId:t.specialCameraId,specialMicId:t.specialMicId,hasVideo:t.hasVideo(),hasAudio:t.hasAudio()};e.push(n)}})),e}},{key:\"consumerStreams\",get:function(){var e=[];return this._peers.forEach((function(t,r){t.streams&&t.streams.forEach((function(t,r){if(t){var n={streamId:t.streamID,type:t.streamType,userId:t.userID,specialCameraId:t.specialCameraId,specialMicId:t.specialMicId,hasVideo:t.hasVideo(),hasAudio:t.hasAudio()};e.push(n)}}))})),e}},{key:\"micProducers\",get:function(){var e=[];return this._audioProducer&&e.push({id:this._audioProducer.id,appData:this._audioProducer.appData}),e}},{key:\"webcamProducers\",get:function(){var e=[];return this._mapVideoProducers.forEach((function(t,r){var n={id:r,appData:t.appData};e.push(n)})),e}},{key:\"screenProducers\",get:function(){var e=[];if(null!=this._screenProducer){var t={streamId:\"x_screen\",appData:this._screenProducer.appData};e.push(t)}return e}},{key:\"isLocalStreamAllowed\",get:function(){var e=+this._role;return 1===e||2===e}},{key:\"isPublish\",get:function(){return!!this._publishs&&this._publishs.size>0}},{key:\"closed\",get:function(){return this._closed}},{key:\"uuid\",get:function(){return this._uuid}}],[{key:\"signalTimeout\",set:function(e){if(e){var t=Number(e);t>0&&t<120&&1e3*t}}},{key:\"logStat\",set:function(e){x=e}},{key:\"TurnConf\",set:function(e){if(!e)throw new TypeError(\"Invalid parameter\");try{N=JSON.parse((0,u.default)(e))}catch(e){throw e}}}]),r}(k.EventEmitter);t.default=V}).call(this,r(38))},function(e,t,r){r(169),e.exports=r(7).Object.keys},function(e,t,r){var n=r(35),i=r(49);r(79)(\"keys\",(function(){return function(e){return i(n(e))}}))},function(e,t,r){e.exports={default:r(171),__esModule:!0}},function(e,t,r){r(41),r(32),e.exports=r(172)},function(e,t,r){var n=r(60),i=r(15)(\"iterator\"),a=r(39);e.exports=r(7).isIterable=function(e){var t=Object(e);return void 0!==t[i]||\"@@iterator\"in t||a.hasOwnProperty(n(t))}},function(e,t,r){r(41),r(32),e.exports=r(174)},function(e,t,r){var n=r(25),i=r(76);e.exports=r(7).getIterator=function(e){var t=i(e);if(\"function\"!=typeof t)throw TypeError(e+\" is not iterable!\");return n(t.call(e))}},function(e,t){var r,n,i=e.exports={};function a(){throw new Error(\"setTimeout has not been defined\")}function o(){throw new Error(\"clearTimeout has not been defined\")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r=\"function\"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n=\"function\"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c,d=[],u=!1,l=-1;function p(){u&&c&&(u=!1,c.length?d=c.concat(d):l=-1,d.length&&f())}function f(){if(!u){var e=s(p);u=!0;for(var t=d.length;t;){for(c=d,d=[];++l<t;)c&&c[l].run();l=-1,t=d.length}c=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new m(e,t)),1!==d.length||u||s(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title=\"browser\",i.browser=!0,i.env={},i.argv=[],i.version=\"\",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error(\"process.binding is not supported\")},i.cwd=function(){return\"/\"},i.chdir=function(e){throw new Error(\"process.chdir is not supported\")},i.umask=function(){return 0}},function(e,t,r){e.exports=function(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let r;function o(...e){if(!o.enabled)return;const t=o,i=Number(new Date),a=i-(r||i);t.diff=a,t.prev=r,t.curr=i,r=i,e[0]=n.coerce(e[0]),\"string\"!=typeof e[0]&&e.unshift(\"%O\");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,i)=>{if(\"%%\"===r)return r;s++;const a=n.formatters[i];if(\"function\"==typeof a){const n=e[s];r=a.call(t,n),e.splice(s,1),s--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return o.namespace=e,o.enabled=n.enabled(e),o.useColors=n.useColors(),o.color=t(e),o.destroy=i,o.extend=a,\"function\"==typeof n.init&&n.init(o),n.instances.push(o),o}function i(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function a(e,t){const r=n(this.namespace+(void 0===t?\":\":t)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\\.\\*\\?$/,\"*\")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(o),...n.skips.map(o).map(e=>\"-\"+e)].join(\",\");return n.enable(\"\"),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=(\"string\"==typeof e?e:\"\").split(/[\\s,]+/),i=r.length;for(t=0;t<i;t++)r[t]&&(\"-\"===(e=r[t].replace(/\\*/g,\".*?\"))[0]?n.skips.push(new RegExp(\"^\"+e.substr(1)+\"$\")):n.names.push(new RegExp(\"^\"+e+\"$\")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if(\"*\"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=r(177),Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n}},function(e,t){var r=1e3,n=6e4,i=36e5,a=24*i;function o(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+\" \"+n+(i?\"s\":\"\")}e.exports=function(e,t){t=t||{};var s=typeof e;if(\"string\"===s&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||\"ms\").toLowerCase()){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return 315576e5*o;case\"weeks\":case\"week\":case\"w\":return 6048e5*o;case\"days\":case\"day\":case\"d\":return o*a;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return o*i;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return o*n;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return o*r;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return o;default:return}}(e);if(\"number\"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=a)return o(e,t,a,\"day\");if(t>=i)return o(e,t,i,\"hour\");if(t>=n)return o(e,t,n,\"minute\");if(t>=r)return o(e,t,r,\"second\");return e+\" ms\"}(e):function(e){var t=Math.abs(e);if(t>=a)return Math.round(e/a)+\"d\";if(t>=i)return Math.round(e/i)+\"h\";if(t>=n)return Math.round(e/n)+\"m\";if(t>=r)return Math.round(e/r)+\"s\";return e+\"ms\"}(e);throw new Error(\"val is not a non-empty string or a valid number. val=\"+JSON.stringify(e))}},function(e,t,r){var n=r(179);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error(\"minTimeout is greater than maxTimeout\");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],e)\"function\"==typeof e[i]&&n.push(i);for(var a=0;a<n.length;a++){var o=n[a],s=e[o];e[o]=function(n){var i=t.operation(r),a=Array.prototype.slice.call(arguments,1),o=a.pop();a.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),o.apply(this,arguments))})),i.attempt((function(){n.apply(e,a)}))}.bind(e,s),e[o].options=r}}},function(e,t){function r(e,t){\"boolean\"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error(\"RetryOperation timeout occurred\")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,i=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&i.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log(\"Using RetryOperation.try() is deprecated\"),this.attempt(e)},r.prototype.start=function(e){console.log(\"Using RetryOperation.start() is deprecated\"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],a=i.message,o=(e[a]||0)+1;e[a]=o,o>=r&&(t=i,r=o)}return t}},function(e,t,r){\"use strict\";!function(){function e(e,t,r){var n={audio:!1,video:{mandatory:{chromeMediaSource:e?\"screen\":\"desktop\",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return r&&(n.audio={mandatory:{chromeMediaSource:e?\"screen\":\"desktop\"},optional:[]}),t&&(n.video.mandatory.chromeMediaSourceId=t,n.audio&&n.audio.mandatory&&(n.audio.mandatory.chromeMediaSourceId=t)),n}function t(e){r?r.isLoaded?e?e.forEach?r.contentWindow.postMessage({captureCustomSourceId:e},\"*\"):r.contentWindow.postMessage({captureSourceIdWithAudio:!0},\"*\"):r.contentWindow.postMessage({captureSourceId:!0},\"*\"):setTimeout((function(){t(e)}),100):n((function(){t(e)}))}var r;function n(e){r?e():((r=document.createElement(\"iframe\")).onload=function(){r.isLoaded=!0,e()},r.src=\"https://www.webrtc-experiment.com/getSourceId/\",r.style.display=\"none\",(document.body||document.documentElement).appendChild(r))}function i(){r?r.isLoaded?r.contentWindow.postMessage({getChromeExtensionStatus:!0},\"*\"):setTimeout(i,100):n(i)}window.getScreenId=function(r,n){-1===navigator.userAgent.indexOf(\"Edge\")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob?navigator.mozGetUserMedia?r(null,\"firefox\",{video:{mozMediaSource:\"window\",mediaSource:\"window\"}}):(window.addEventListener(\"message\",(function t(n){if(!n.data)return;n.data.chromeMediaSourceId&&(\"PermissionDeniedError\"===n.data.chromeMediaSourceId?r(\"permission-denied\"):r(null,n.data.chromeMediaSourceId,e(null,n.data.chromeMediaSourceId,n.data.canRequestAudioTrack)),window.removeEventListener(\"message\",t));n.data.chromeExtensionStatus&&(r(n.data.chromeExtensionStatus,null,e(n.data.chromeExtensionStatus)),window.removeEventListener(\"message\",t))})),n?setTimeout((function(){t(n)}),100):setTimeout(t,100)):r({video:!0})},window.getScreenConstraints=function(e){n((function(){getScreenId((function(t,r,n){n||(n={video:!0}),e(t,n.video)}))}))},window.getChromeExtensionStatus=function(e){navigator.mozGetUserMedia?e(\"installed-enabled\"):(window.addEventListener(\"message\",(function t(r){if(!r.data)return;r.data.chromeExtensionStatus&&(e(r.data.chromeExtensionStatus),window.removeEventListener(\"message\",t))})),setTimeout(i,100))}}()},function(e,t){e.exports=function(){throw new Error(\"define cannot be used indirect\")}},function(e,t,r){var n,i=r(183);\"undefined\"!=typeof window&&(n=window.AudioContext||window.webkitAudioContext);var a=null;e.exports=function(e,t){var r=new i;if(!n)return r;var o,s,c,d=(t=t||{}).smoothing||.1,u=t.interval||50,l=t.threshold,p=t.play,f=t.history||10,m=!0;a=t.audioContext||a||new n,(c=a.createAnalyser()).fftSize=512,c.smoothingTimeConstant=d,s=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(o=a.createMediaElementSource(e),void 0===p&&(p=!0),l=l||-50):(o=a.createMediaStreamSource(e),l=l||-50),o.connect(c),p&&c.connect(a.destination),r.speaking=!1,r.suspend=function(){return a.suspend()},r.resume=function(){return a.resume()},Object.defineProperty(r,\"state\",{get:function(){return a.state}}),a.onstatechange=function(){r.emit(\"state_change\",a.state)},r.setThreshold=function(e){l=e},r.setInterval=function(e){u=e},r.stop=function(){m=!1,r.emit(\"volume_change\",-100,l),r.speaking&&(r.speaking=!1,r.emit(\"stopped_speaking\")),c.disconnect(),o.disconnect()},r.speakingHistory=[];for(var h=0;h<f;h++)r.speakingHistory.push(0);var v=function(){setTimeout((function(){if(m){var e=function(e,t){var r=-1/0;e.getFloatFrequencyData(t);for(var n=4,i=t.length;n<i;n++)t[n]>r&&t[n]<0&&(r=t[n]);return r}(c,s);r.emit(\"volume_change\",e,l);var t=0;if(e>l&&!r.speaking){for(var n=r.speakingHistory.length-3;n<r.speakingHistory.length;n++)t+=r.speakingHistory[n];t>=2&&(r.speaking=!0,r.emit(\"speaking\"))}else if(e<l&&r.speaking){for(n=0;n<r.speakingHistory.length;n++)t+=r.speakingHistory[n];0==t&&(r.speaking=!1,r.emit(\"stopped_speaking\"))}r.speakingHistory.shift(),r.speakingHistory.push(0+(e>l)),v()}}),u)};return v(),r}},function(e,t){function r(){}e.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,r){this.callbacks=this.callbacks||{};var n=3===arguments.length,i=n?arguments[1]:void 0,a=n?arguments[2]:arguments[1];return a._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(a),this},t.once=function(e,t,r){var n=this,i=3===arguments.length,a=i?arguments[1]:void 0,o=i?arguments[2]:arguments[1];function s(){n.off(e,s),o.apply(this,arguments)}return this.on(e,a,s),this},t.releaseGroup=function(e){var t,r,n,i;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(r=0,n=(i=this.callbacks[t]).length;r<n;r++)i[r]._groupName===e&&(i.splice(r,1),r--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(-1!==(r=n.indexOf(t))&&(n.splice(r,1),0===n.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,r,n,i=[].slice.call(arguments,1),a=this.callbacks[e],o=this.getWildcardCallbacks(e);if(a)for(t=0,r=(n=a.slice()).length;t<r&&n[t];++t)n[t].apply(this,i);if(o)for(r=o.length,t=0,r=(n=o.slice()).length;t<r&&n[t];++t)n[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,r,n=[];for(t in this.callbacks)r=t.split(\"*\"),(\"*\"===t||2===r.length&&e.slice(0,r[0].length)===r[0])&&(n=n.concat(this.callbacks[t]));return n}},r.mixin(r)},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=P(r(18)),i=P(r(8)),a=P(r(6)),o=P(r(20)),s=P(r(17)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(36)),b=P(r(37)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}r(28);var S=new m.default(\"Chrome70\"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"unified-plan\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),S.debug(\"Handler::constructor() direction: \"+e+\" settings: \"+(0,s.default)(n)+\" configure: \"+(0,s.default)(a)),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener(\"icecandidate\",(function(e){var t={candidate:\"\",type:\"\"};Boolean(e)&&Boolean(e.candidate)&&(t.candidate=e.candidate.candidate,t.type=e.candidate.type),i.emit(\"@icecandidate\",t)})),i._pc.addEventListener(\"icecandidateerror\",(function(e){i.emit(\"@icecandidateerror\",\"icecandidateerror\")})),i._pc.addEventListener(\"icegatheringstatechange\",(function(e){i.emit(\"@icegatheringstatechange\",{iceGatheringState:i._pc.iceGatheringState})})),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){S.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){S.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._trackIds=new o.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(S.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._trackIds.has(r.id))return a.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(S.debug(\"addProducer() [id:%s, kind:%s, trackId:%s] producer.audioProfile: %o\",e.id,e.kind,r.id,e.audioProfile),n=e.audioProfile.codec.toLowerCase());var i=void 0,o=void 0;return this._trackIds.add(r.id),a.default.resolve().then((function(){if(i=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&\"inactive\"===e.direction})))return S.debug(\"addProducer() | reusing an inactive transceiver\"),i.direction=\"sendonly\",i.sender.replaceTrack(r);i=t._pc.addTransceiver(r,{direction:\"sendonly\"})})).then((function(){return t._pc.createOffer()})).then((function(a){if(a.sdp=I.default.setVideoBitrates(a.sdp,e.videoBitrateOptions),a.sdp=I.default.setOpusAttributes(a.sdp,e.audioProfile),a.sdp=I.default.setSpecialAudioCodec(a.sdp,n),e.simulcast){S.debug(\"addProducer() | enabling simulcast\");var o=f.default.parse(a.sdp);y.addPlanBSimulcast(o,r,{mid:i.mid}),a={type:\"offer\",sdp:f.default.write(o)}}return S.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",a),t._pc.setLocalDescription(a)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){o=f.default.parse(t._pc.localDescription.sdp),S.debug(\"addProducer() | this._pc.localDescription.sdp: \",o,\" - producer.videoBitrateOptions: \",e.videoBitrateOptions);var r=t._remoteSdp.createAnswerSdp(o);r=I.default.setVideoBitrates(r,e.videoBitrateOptions),r=I.default.setOpusAttributes(r,e.audioProfile);var i={type:\"answer\",sdp:r=I.default.setSpecialAudioCodec(r,n)};return S.debug(\"addProducer() | calling pc.setRemoteDescription() remoteSdp: \",r),t._pc.setRemoteDescription(i)})).then((function(){var a=v.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&a.codecs.splice(t,1)})),S.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],a)),y.fillRtpParametersForTrack(a,o,r,{mid:i.mid,planBSimulcast:!0}),a})).catch((function(e){try{i.direction=\"inactive\"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return a.default.reject(new Error(\"track not found\"));var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),S.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),a.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=f.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=I.default.setVideoBitrates(i,e.videoBitrateOptions),i=I.default.setOpusAttributes(i,e.audioProfile);var a={type:\"answer\",sdp:i=I.default.setSpecialAudioCodec(i,n)};return S.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;S.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return a.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n,i=this;S.debug(\"update Track() [trackId:%s]\",t.id);var o=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(o=e.audioProfile.codec.toLowerCase()),a.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,o),e.simulcast){S.debug(\"updateTrack() | enabling simulcast\");var a=f.default.parse(r.sdp);y.addPlanBSimulcast(a,t,{mid:n.mid}),r={type:\"offer\",sdp:f.default.write(a)}}return S.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),i._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r);t=I.default.setVideoBitrates(t,e.videoBitrateOptions),t=I.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=I.default.setSpecialAudioCodec(t,o)};return S.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),i._pc.setRemoteDescription(n)})).then((function(){var a=v.clone(i._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+o&&a.codecs.splice(t,1)})),S.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",i._rtpParametersByKind[e.kind],a)),y.fillRtpParametersForTrack(a,r,t,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new i.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(S.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error(\"Consumer already added - consumer.id: \"+e.id+\" consumer.kind: \"+e.kind+\" consumer.appData: \"+(0,s.default)(e.appData)));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,o={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var r={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return S.debug(\"addConsumer() | calling pc.setRemoteDescription() kind:%s [offer:%o]\",e.kind,r),t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(r){return S.debug(\"addConsumer() | calling pc.setLocalDescription() kind:%s [answer:%o]\",e.kind,r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;S.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return S.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error(\"Consumer not found - consumer.id: \"+e.id+\" consumer.kind: \"+e.kind+\" consumer.appData: \"+(0,s.default)(e.appData)))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),a.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){S.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(w),E=function(){function e(t,r,n){(0,d.default)(this,e),S.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var i=void 0;switch(t){case\"send\":return i={audio:_.getSendingRtpParameters(\"audio\",r),video:_.getSendingRtpParameters(\"video\",r)},new T(i,n);case\"recv\":return i={audio:_.getReceivingFullRtpParameters(\"audio\",r),video:_.getReceivingFullRtpParameters(\"video\",r)},new A(i,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){S.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"unified-plan\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=f.default.parse(t.sdp);return g.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome70\"}}]),e}();t.default=E},function(e,t,r){r(32),r(186),e.exports=r(7).Array.from},function(e,t,r){\"use strict\";var n=r(27),i=r(12),a=r(35),o=r(93),s=r(94),c=r(58),d=r(187),u=r(76);i(i.S+i.F*!r(100)((function(e){Array.from(e)})),\"Array\",{from:function(e){var t,r,i,l,p=a(e),f=\"function\"==typeof this?this:Array,m=arguments.length,h=m>1?arguments[1]:void 0,v=void 0!==h,_=0,g=u(p);if(v&&(h=n(h,m>2?arguments[2]:void 0,2)),null==g||f==Array&&s(g))for(r=new f(t=c(p.length));t>_;_++)d(r,_,v?h(p[_],_):p[_]);else for(l=g.call(p),r=new f;!(i=l.next()).done;_++)d(r,_,v?o(l,h,[i.value,_],!0):i.value);return r.length=_,r}})},function(e,t,r){\"use strict\";var n=r(22),i=r(48);e.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},function(e,t,r){r(56),r(32),r(41),r(189),r(190),r(191),r(192),e.exports=r(7).Set},function(e,t,r){\"use strict\";var n=r(104),i=r(83);e.exports=r(105)(\"Set\",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return n.def(i(this,\"Set\"),e=0===e?0:e,e)}},n)},function(e,t,r){var n=r(12);n(n.P+n.R,\"Set\",{toJSON:r(106)(\"Set\")})},function(e,t,r){r(107)(\"Set\")},function(e,t,r){r(108)(\"Set\")},function(e,t,r){\"use strict\";var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))}(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=r(114),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\\r\\n|\\r|\\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);\"m\"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(o))return i(c,n,o)}})),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/\\;\\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(\" \").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(\" \").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(\" \").map((function(e){return e.substring(1,e.length-1).split(\",\").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(\";\").map((function(e){return e.split(\",\").map((function(e){var t,r=!1;return\"~\"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){\"use strict\";var n=r(114),i=/%[sdv%]/g,a=function(e){var t=1,r=arguments,n=r.length;return e.replace(i,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case\"%%\":return\"%\";case\"%s\":return String(i);case\"%d\":return Number(i);case\"%v\":return\"\"}}))},o=function(e,t,r){var n=[e+\"=\"+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return a.apply(null,n)},s=[\"v\",\"o\",\"s\",\"i\",\"u\",\"e\",\"p\",\"c\",\"b\",\"t\",\"r\",\"z\",\"a\"],c=[\"i\",\"c\",\"b\",\"a\"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=\" \"),e.media.forEach((function(e){null==e.payloads&&(e.payloads=\"\")}));var r=t.outerOrder||s,i=t.innerOrder||c,a=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(o(t,r,e))}))}))})),e.media.forEach((function(e){a.push(o(\"m\",n.m[0],e)),i.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(o(t,r,e))}))}))}))})),a.join(\"\\r\\n\")+\"\\r\\n\"}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=k(r(18)),i=k(r(8)),a=k(r(20)),o=k(r(6)),s=k(r(2)),c=k(r(0)),d=k(r(1)),u=k(r(3)),l=k(r(4)),p=k(r(13)),f=k(r(5)),m=k(r(11)),h=I(r(10)),v=I(r(16)),_=I(r(21)),g=I(r(44)),y=k(r(45)),b=k(r(24));function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function k(e){return e&&e.__esModule?e:{default:e}}r(28);var P=new f.default(\"Chrome69\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new y.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),w=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,a=void 0;return o.default.resolve().then((function(){return t._stream.addTrack(r),i=t._pc.addTrack(r,t._stream),t._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,r),i={type:\"offer\",sdp:p.default.write(a)}}return P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var i={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&i.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,a,r),i})).catch((function(e){try{t._pc.removeTrack(i)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track,n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),o.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn(\"removeProducer() | ignoring expected error due no sending tracks - \"+e.name+\" \"+e.message)})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=b.default.setVideoBitrates(i,e.videoBitrateOptions),i=b.default.setOpusAttributes(i,e.audioProfile);var a={type:\"answer\",sdp:i=b.default.setSpecialAudioCodec(i,n)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),i=_.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;P.debug(\"update Track() [trackId:%s]\",t.id);var i=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var a=p.default.parse(r.sdp);g.addSimulcastForTrack(a,t),r={type:\"offer\",sdp:p.default.write(a)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var a={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",a),n._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(n._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+i&&a.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",n._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,r,t),a})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new i.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===a.trackId}));if(!e)throw new Error(\"remote track not found\");return e.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;return P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),A=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var i=void 0;switch(t){case\"send\":return i={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new w(i,n);case\"recv\":return i={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(i,n)}}return(0,d.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome69\"}}]),e}();t.default=A},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=k(r(18)),i=k(r(8)),a=k(r(20)),o=k(r(6)),s=k(r(2)),c=k(r(0)),d=k(r(1)),u=k(r(3)),l=k(r(4)),p=k(r(13)),f=k(r(5)),m=k(r(11)),h=I(r(10)),v=I(r(16)),_=I(r(21)),g=I(r(44)),y=k(r(45)),b=k(r(24));function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function k(e){return e&&e.__esModule?e:{default:e}}r(28);var P=new f.default(\"Chrome67\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new y.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),w=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0;return o.default.resolve().then((function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,r),i={type:\"offer\",sdp:p.default.write(a)}}return P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var a={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&a.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,i,r),a})).catch((function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn(\"removeProducer() | ignoring expected error due no sending tracks - \"+e.name+\" \"+e.message)})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=b.default.setVideoBitrates(i,e.videoBitrateOptions),i=b.default.setOpusAttributes(i,e.audioProfile);var a={type:\"answer\",sdp:i=b.default.setSpecialAudioCodec(i,n)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),i=_.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;P.debug(\"update Track() [trackId:%s]\",t.id);var i=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var a=p.default.parse(r.sdp);g.addSimulcastForTrack(a,t),r={type:\"offer\",sdp:p.default.write(a)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var a={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",a),n._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(n._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+i&&a.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",n._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,r,t),a})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new i.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===a.streamId})).getTrackById(a.trackId);if(!e)throw new Error(\"remote track not found\");return e}))}},{key:\"removeConsumer\",value:function(e){var t=this;return P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),A=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var i=void 0;switch(t){case\"send\":return i={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new w(i,n);case\"recv\":return i={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(i,n)}}return(0,d.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome67\"}}]),e}();t.default=A},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=k(r(18)),i=k(r(8)),a=k(r(20)),o=k(r(6)),s=k(r(2)),c=k(r(0)),d=k(r(1)),u=k(r(3)),l=k(r(4)),p=k(r(13)),f=k(r(5)),m=k(r(11)),h=I(r(10)),v=I(r(16)),_=I(r(21)),g=I(r(44)),y=k(r(45)),b=k(r(24));function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function k(e){return e&&e.__esModule?e:{default:e}}r(28);var P=new f.default(\"Chrome55\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new y.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),w=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0;return o.default.resolve().then((function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,r),i={type:\"offer\",sdp:p.default.write(a)}}return P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var a={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&a.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,i,r),a})).catch((function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn(\"removeProducer() | ignoring expected error due no sending tracks - \"+e.name+\" \"+e.message)})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=b.default.setVideoBitrates(i,e.videoBitrateOptions),i=b.default.setOpusAttributes(i,e.audioProfile);var a={type:\"answer\",sdp:i=b.default.setSpecialAudioCodec(i,n)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=e.track,a=void 0;return o.default.resolve().then((function(){return r._stream.removeTrack(i),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,t),i={type:\"offer\",sdp:p.default.write(a)}}return P.debug(\"replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]\",i),r._pc.setLocalDescription(i)})).then((function(){a=p.default.parse(r._pc.localDescription.sdp);var t=r._remoteSdp.createAnswerSdp(a);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var i={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,n)};return P.debug(\"replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]\",i),r._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(r._rtpParametersByKind[e.kind]);i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&i.codecs.splice(t,1)})),P.debug(\"replaceProducerTrack() _rtpParametersByKind: %o - rtpParameters: %o\",r._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,a,t),r.safeEmit(\"@needupdateproducer\",e,i)})).catch((function(e){throw r._stream.removeTrack(t),r._stream.addTrack(i),r._pc.addStream(r._stream),e}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),i=_.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;P.debug(\"update Track() [trackId:%s]\",t.id);var i=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var a=p.default.parse(r.sdp);g.addSimulcastForTrack(a,t),r={type:\"offer\",sdp:p.default.write(a)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var a={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",a),n._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(n._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+i&&a.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",n._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,r,t),a})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new i.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===a.streamId})).getTrackById(a.trackId);if(!e)throw new Error(\"remote track not found\");return e}))}},{key:\"removeConsumer\",value:function(e){var t=this;return P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),A=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var i=void 0;switch(t){case\"send\":return i={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new w(i,n);case\"recv\":return i={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(i,n)}}return(0,d.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome55\"}}]),e}();t.default=A},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=S(r(9)),i=S(r(18)),a=S(r(17)),o=S(r(8)),s=S(r(6)),c=S(r(20)),d=S(r(2)),u=S(r(0)),l=S(r(1)),p=S(r(3)),f=S(r(4)),m=S(r(13)),h=S(r(5)),v=S(r(11)),_=P(r(10)),g=P(r(16)),y=P(r(21)),b=P(r(36)),I=S(r(37)),k=S(r(24));function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}var w=new h.default(\"Safari13\"),T=function(e){function t(e,r,n){(0,u.default)(this,t);var i=(0,p.default)(this,(t.__proto__||(0,d.default)(t)).call(this,w)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new I.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,f.default)(t,e),(0,l.default)(t,[{key:\"close\",value:function(){w.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){w.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(v.default),A=function(e){function t(e,r){(0,u.default)(this,t);var n=(0,p.default)(this,(t.__proto__||(0,d.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._trackIds=new c.default,n}return(0,f.default)(t,e),(0,l.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(w.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._trackIds.has(r.id))return s.default.reject(new Error(\"track already added\"));var n=void 0,i=void 0;return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),this._trackIds.add(r.id),s.default.resolve().then((function(){if(n=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&\"inactive\"===e.direction})))return w.debug(\"addProducer() | reusing an inactive transceiver\"),n.direction=\"sendonly\",n.sender.replaceTrack(r);n=t._pc.addTransceiver(r,{direction:\"sendonly\"})})).then((function(){return t._pc.createOffer()})).then((function(i){if(i.sdp=k.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),e.simulcast){w.debug(\"addProducer() | enabling simulcast\");var a=m.default.parse(i.sdp);b.addPlanBSimulcast(a,r,{mid:n.mid}),i={type:\"offer\",sdp:m.default.write(a)}}return w.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=m.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i),n={type:\"answer\",sdp:r=k.default.setVideoBitrates(r,e.videoBitrateOptions)};return w.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",n),t._pc.setRemoteDescription(n)})).then((function(){var a=_.clone(t._rtpParametersByKind[e.kind]);return b.fillRtpParametersForTrack(a,i,r,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){try{n.direction=\"inactive\"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return s.default.reject(new Error(\"track not found\"));w.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=k.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),w.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=m.default.parse(t._pc.localDescription.sdp),n=t._remoteSdp.createAnswerSdp(r),i={type:\"answer\",sdp:n=k.default.setVideoBitrates(n,e.videoBitrateOptions)};return w.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;w.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return s.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return w.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return w.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=m.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return w.debug(\"_setupTransport()\"),s.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=m.default.parse(r),i=y.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n,i=this;w.debug(\"update Track() [trackId:%s]\",t.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=k.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),e.simulcast){w.debug(\"updateTrack() | enabling simulcast\");var a=m.default.parse(r.sdp);b.addPlanBSimulcast(a,t,{mid:n.mid}),r={type:\"offer\",sdp:m.default.write(a)}}return w.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),i._pc.setLocalDescription(r)})).then((function(){r=m.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r),n={type:\"answer\",sdp:t=k.default.setVideoBitrates(t,e.videoBitrateOptions)};return w.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),i._pc.setRemoteDescription(n)})).then((function(){var a=_.clone(i._rtpParametersByKind[e.kind]);return b.fillRtpParametersForTrack(a,r,t,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){throw e}))}}]),t}(T),E=function(e){function t(e,r){(0,u.default)(this,t);var n=(0,p.default)(this,(t.__proto__||(0,d.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new o.default,n}return(0,f.default)(t,e),(0,l.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(w.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return s.default.reject(new Error(\"Consumer already added - consumer.id: \"+e.id+\" consumer.kind: \"+e.kind+\" consumer.appData: \"+(0,a.default)(e.appData)));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),s.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return w.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;w.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,s.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return w.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):s.default.reject(new Error(\"Consumer not found - consumer.id: \"+e.id+\" consumer.kind: \"+e.kind+\" consumer.appData: \"+(0,a.default)(e.appData)))}},{key:\"restartIce\",value:function(e){var t=this;return w.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return w.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return w.debug(\"_setupTransport()\"),s.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){w.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=m.default.parse(e),r={dtlsParameters:y.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(T),R=function(){function e(t,r,i){(0,u.default)(this,e),w.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":if(!(a={audio:g.getSendingRtpParameters(\"audio\",r),video:g.getSendingRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var o=!0,s=!1,c=void 0;try{for(var d,l=(0,n.default)(a.video.codecs);!(o=(d=l.next()).done);o=!0){var p=d.value;\"video/H264\"===p.mimeType&&\"42001f\"===p.parameters[\"profile-level-id\"]&&(p.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new A(a,i);case\"recv\":if(!(a={audio:g.getReceivingFullRtpParameters(\"audio\",r),video:g.getReceivingFullRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var f=!0,m=!1,h=void 0;try{for(var v,_=(0,n.default)(a.video.codecs);!(f=(v=_.next()).done);f=!0){var y=v.value;\"video/H264\"===y.mimeType&&\"42001f\"===y.parameters[\"profile-level-id\"]&&(y.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){m=!0,h=e}finally{try{!f&&_.return&&_.return()}finally{if(m)throw h}}}return new E(a,i)}}return(0,l.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){w.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=m.default.parse(t.sdp);return y.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Safari13\"}}]),e}();t.default=R},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=P(r(9)),i=P(r(18)),a=P(r(8)),o=P(r(6)),s=P(r(20)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(36)),b=P(r(37)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default(\"Safari12\"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){S.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){S.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._trackIds=new s.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(S.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._trackIds.has(r.id))return o.default.reject(new Error(\"track already added\"));var n=void 0,i=void 0;return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),this._trackIds.add(r.id),o.default.resolve().then((function(){if(n=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&\"inactive\"===e.direction})))return S.debug(\"addProducer() | reusing an inactive transceiver\"),n.direction=\"sendonly\",n.sender.replaceTrack(r);n=t._pc.addTransceiver(r,{direction:\"sendonly\"})})).then((function(){return t._pc.createOffer()})).then((function(i){if(i.sdp=I.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),e.simulcast){S.debug(\"addProducer() | enabling simulcast\");var a=f.default.parse(i.sdp);y.addPlanBSimulcast(a,r,{mid:n.mid}),i={type:\"offer\",sdp:f.default.write(a)}}return S.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=f.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i),n={type:\"answer\",sdp:r=I.default.setVideoBitrates(r,e.videoBitrateOptions)};return S.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",n),t._pc.setRemoteDescription(n)})).then((function(){var a=v.clone(t._rtpParametersByKind[e.kind]);return y.fillRtpParametersForTrack(a,i,r,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){try{n.direction=\"inactive\"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return o.default.reject(new Error(\"track not found\"));S.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),o.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),S.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=f.default.parse(t._pc.localDescription.sdp),n=t._remoteSdp.createAnswerSdp(r),i={type:\"answer\",sdp:n=I.default.setVideoBitrates(n,e.videoBitrateOptions)};return S.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;S.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n,i=this;S.debug(\"update Track() [trackId:%s]\",t.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),o.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),e.simulcast){S.debug(\"updateTrack() | enabling simulcast\");var a=f.default.parse(r.sdp);y.addPlanBSimulcast(a,t,{mid:n.mid}),r={type:\"offer\",sdp:f.default.write(a)}}return S.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),i._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r),n={type:\"answer\",sdp:t=I.default.setVideoBitrates(t,e.videoBitrateOptions)};return S.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),i._pc.setRemoteDescription(n)})).then((function(){var a=v.clone(i._rtpParametersByKind[e.kind]);return y.fillRtpParametersForTrack(a,r,t,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(S.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,a={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===a.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;S.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){S.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(w),E=function(){function e(t,r,i){(0,d.default)(this,e),S.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":if(!(a={audio:_.getSendingRtpParameters(\"audio\",r),video:_.getSendingRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var o=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(a.video.codecs);!(o=(u=l.next()).done);o=!0){var p=u.value;\"video/H264\"===p.mimeType&&\"42001f\"===p.parameters[\"profile-level-id\"]&&(p.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new T(a,i);case\"recv\":if(!(a={audio:_.getReceivingFullRtpParameters(\"audio\",r),video:_.getReceivingFullRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var f=!0,m=!1,h=void 0;try{for(var v,g=(0,n.default)(a.video.codecs);!(f=(v=g.next()).done);f=!0){var y=v.value;\"video/H264\"===y.mimeType&&\"42001f\"===y.parameters[\"profile-level-id\"]&&(y.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){m=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}}return new A(a,i)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){S.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=f.default.parse(t.sdp);return g.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Safari12\"}}]),e}();t.default=E},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=P(r(9)),i=P(r(18)),a=P(r(8)),o=P(r(20)),s=P(r(6)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(44)),b=P(r(45)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default(\"Safari11\"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){S.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){S.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(S.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return s.default.reject(new Error(\"track already added\"));var n=void 0,i=void 0;return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){return t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),S.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=f.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i),n={type:\"answer\",sdp:r=I.default.setVideoBitrates(r,e.videoBitrateOptions)};return S.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",n),t._pc.setRemoteDescription(n)})).then((function(){var n=v.clone(t._rtpParametersByKind[e.kind]);return y.fillRtpParametersForTrack(n,i,r),n})).catch((function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;S.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),S.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;S.warn(\"removeProducer() | ignoring expected error due no sending tracks - \"+e.name+\" \"+e.message)})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=f.default.parse(t._pc.localDescription.sdp),n=t._remoteSdp.createAnswerSdp(r),i={type:\"answer\",sdp:n=I.default.setVideoBitrates(n,e.videoBitrateOptions)};return S.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;S.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return s.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),s.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;S.debug(\"update Track() [trackId:%s]\",t.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),e.simulcast){S.debug(\"updateTrack() | enabling simulcast\");var i=f.default.parse(r.sdp);y.addSimulcastForTrack(i,t),r={type:\"offer\",sdp:f.default.write(i)}}return S.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r),i={type:\"answer\",sdp:t=I.default.setVideoBitrates(t,e.videoBitrateOptions)};return S.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",i),n._pc.setRemoteDescription(i)})).then((function(){var i=v.clone(n._rtpParametersByKind[e.kind]);return y.fillRtpParametersForTrack(i,r,t),i})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new o.default,n._consumerInfos=new a.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(S.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return s.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),s.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._kinds),(0,i.default)(t._consumerInfos.values()))};return S.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===a.trackId}));if(!e)throw new Error(\"remote track not found\");return e.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;return S.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),s.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._kinds),(0,i.default)(t._consumerInfos.values()))};return S.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):s.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._kinds),(0,i.default)(t._consumerInfos.values()))};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),s.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){S.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(w),E=function(){function e(t,r,i){(0,d.default)(this,e),S.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":if(!(a={audio:_.getSendingRtpParameters(\"audio\",r),video:_.getSendingRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var o=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(a.video.codecs);!(o=(u=l.next()).done);o=!0){var p=u.value;\"video/H264\"===p.mimeType&&\"42001f\"===p.parameters[\"profile-level-id\"]&&(p.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new T(a,i);case\"recv\":if(!(a={audio:_.getReceivingFullRtpParameters(\"audio\",r),video:_.getReceivingFullRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var f=!0,m=!1,h=void 0;try{for(var v,g=(0,n.default)(a.video.codecs);!(f=(v=g.next()).done);f=!0){var y=v.value;\"video/H264\"===y.mimeType&&\"42001f\"===y.parameters[\"profile-level-id\"]&&(y.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){m=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}}return new A(a,i)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){S.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=f.default.parse(t.sdp);return g.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Safari11\"}}]),e}();t.default=E},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(9)),i=w(r(18)),a=w(r(17)),o=w(r(8)),s=w(r(86)),c=w(r(6)),d=w(r(20)),u=w(r(2)),l=w(r(0)),p=w(r(1)),f=w(r(3)),m=w(r(4)),h=w(r(13)),v=w(r(5)),_=w(r(11)),g=S(r(10)),y=S(r(16)),b=S(r(21)),I=S(r(36)),k=w(r(37)),P=w(r(24));function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var T=new v.default(\"Firefox65\"),A=function(e){function t(e,r,n){(0,l.default)(this,t);var i=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,T)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new k.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,m.default)(t,e),(0,p.default)(t,[{key:\"close\",value:function(){T.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){T.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(_.default),E=function(e){function t(e,r){(0,l.default)(this,t);var n=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._trackIds=new d.default,n._nextRid=1,n}return(0,m.default)(t,e),(0,p.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(T.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._trackIds.has(r.id))return c.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,a=void 0;return this._trackIds.add(r.id),c.default.resolve().then((function(){if(i=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&\"inactive\"===e.direction})))return T.debug(\"addProducer() | reusing an inactive transceiver\"),i.direction=\"sendonly\",i.sender.replaceTrack(r);i=t._pc.addTransceiver(r,{direction:\"sendonly\"})})).then((function(){var r=i.sender,n=[];e.simulcast&&(T.debug(\"addProducer() | enabling simulcast\"),e.simulcast.high&&n.push({rid:\"high\"+t._nextRid,active:!0,priority:\"low\",maxBitrate:e.simulcast.high}),e.simulcast.medium&&n.push({rid:\"medium\"+t._nextRid,active:!0,priority:\"medium\",maxBitrate:e.simulcast.medium}),e.simulcast.low&&n.push({rid:\"low\"+t._nextRid,active:!0,priority:\"high\",maxBitrate:e.simulcast.low}),t._nextRid++);var a=r.getParameters();return r.setParameters((0,s.default)({},a,{encodings:n}))})).then((function(){return t._pc.createOffer()})).then((function(r){return r.sdp=P.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=P.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=P.default.setSpecialAudioCodec(r.sdp,n),T.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=h.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=P.default.setVideoBitrates(r,e.videoBitrateOptions),r=P.default.setOpusAttributes(r,e.audioProfile);var i={type:\"answer\",sdp:r=P.default.setSpecialAudioCodec(r,n)};return T.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)})).then((function(){var o=g.clone(t._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&o.codecs.splice(t,1)})),T.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],o)),I.fillRtpParametersForTrack(o,a,r,{mid:i.mid}),o})).catch((function(e){try{i.direction=\"inactive\"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return c.default.reject(new Error(\"track not found\"));T.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),c.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=P.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=P.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=P.default.setSpecialAudioCodec(r.sdp,n),T.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=h.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=P.default.setVideoBitrates(i,e.videoBitrateOptions),i=P.default.setOpusAttributes(i,e.audioProfile);var a={type:\"answer\",sdp:i=P.default.setSpecialAudioCodec(i,n)};return T.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;T.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return c.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return T.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),c.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return T.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=h.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return T.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return T.debug(\"_setupTransport()\"),c.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=h.default.parse(r),i=b.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"updateTrack\",value:function(e,t){var r,n,i=this;T.debug(\"update Track() [trackId:%s]\",t.id);var a=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),c.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=P.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=P.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=P.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){T.debug(\"updateTrack() | enabling simulcast\");var o=h.default.parse(r.sdp);I.addPlanBSimulcast(o,t,{mid:n.mid}),r={type:\"offer\",sdp:h.default.write(o)}}return T.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),i._pc.setLocalDescription(r)})).then((function(){r=h.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r);t=P.default.setVideoBitrates(t,e.videoBitrateOptions),t=P.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=P.default.setSpecialAudioCodec(t,a)};return T.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),i._pc.setRemoteDescription(n)})).then((function(){var o=g.clone(i._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+a&&o.codecs.splice(t,1)})),T.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",i._rtpParametersByKind[e.kind],o)),I.fillRtpParametersForTrack(o,r,t,{mid:n.mid,planBSimulcast:!0}),o})).catch((function(e){throw e}))}}]),t}(A),R=function(e){function t(e,r){(0,l.default)(this,t);var n=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new o.default,n}return(0,m.default)(t,e),(0,p.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(T.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return c.default.reject(new Error(\"Consumer already added - consumer.id: \"+e.id+\" consumer.kind: \"+e.kind+\" consumer.appData: \"+(0,a.default)(e.appData)));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),c.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return T.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return T.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;T.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,c.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return T.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return T.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):c.default.reject(new Error(\"Consumer not found - consumer.id: \"+e.id+\" consumer.kind: \"+e.kind+\" consumer.appData: \"+(0,a.default)(e.appData)))}},{key:\"restartIce\",value:function(e){var t=this;return T.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),c.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return T.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return T.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return T.debug(\"_setupTransport()\"),c.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){T.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=h.default.parse(e),r={dtlsParameters:b.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(A),C=function(){function e(t,r,i){(0,l.default)(this,e),T.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":if(!(a={audio:y.getSendingRtpParameters(\"audio\",r),video:y.getSendingRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var o=!0,s=!1,c=void 0;try{for(var d,u=(0,n.default)(a.video.codecs);!(o=(d=u.next()).done);o=!0){var p=d.value;\"video/H264\"===p.mimeType&&\"42001f\"===p.parameters[\"profile-level-id\"]&&(p.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){s=!0,c=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw c}}}return new E(a,i);case\"recv\":if(!(a={audio:y.getReceivingFullRtpParameters(\"audio\",r),video:y.getReceivingFullRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var f=!0,m=!1,h=void 0;try{for(var v,_=(0,n.default)(a.video.codecs);!(f=(v=_.next()).done);f=!0){var g=v.value;\"video/H264\"===g.mimeType&&\"42001f\"===g.parameters[\"profile-level-id\"]&&(g.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){m=!0,h=e}finally{try{!f&&_.return&&_.return()}finally{if(m)throw h}}}return new R(a,i)}}return(0,p.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){T.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),t=document.createElement(\"canvas\");t.getContext(\"2d\");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:\"RID1\",maxBitrate:4e4},{rid:\"RID2\",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var i=h.default.parse(r.sdp);return b.extractRtpCapabilities(i)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:\"tag\",get:function(){return\"Firefox65\"}}]),e}();t.default=C},function(e,t,r){r(203),e.exports=r(7).Object.assign},function(e,t,r){var n=r(12);n(n.S+n.F,\"Object\",{assign:r(204)})},function(e,t,r){\"use strict\";var n=r(23),i=r(49),a=r(82),o=r(62),s=r(35),c=r(71),d=Object.assign;e.exports=!d||r(33)((function(){var e={},t={},r=Symbol(),n=\"abcdefghijklmnopqrst\";return e[r]=7,n.split(\"\").forEach((function(e){t[e]=e})),7!=d({},e)[r]||Object.keys(d({},t)).join(\"\")!=n}))?function(e,t){for(var r=s(e),d=arguments.length,u=1,l=a.f,p=o.f;d>u;)for(var f,m=c(arguments[u++]),h=l?i(m).concat(l(m)):i(m),v=h.length,_=0;v>_;)f=h[_++],n&&!p.call(m,f)||(r[f]=m[f]);return r}:d},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=P(r(9)),i=P(r(18)),a=P(r(8)),o=P(r(86)),s=P(r(6)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(36)),b=P(r(37)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default(\"Firefox59\"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){S.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){S.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(S.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return s.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,a=void 0;return s.default.resolve().then((function(){t._stream.addTrack(r),i=t._pc.addTrack(r,t._stream)})).then((function(){var r=[];e.simulcast&&(S.debug(\"addProducer() | enabling simulcast\"),e.simulcast.high&&r.push({rid:\"high\"+t._nextRid,active:!0,priority:\"low\",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:\"medium\"+t._nextRid,active:!0,priority:\"medium\",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:\"low\"+t._nextRid,active:!0,priority:\"high\",maxBitrate:e.simulcast.low}),t._nextRid++);var n=i.getParameters();return i.setParameters((0,o.default)({},n,{encodings:r}))})).then((function(){return t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=f.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=I.default.setVideoBitrates(r,e.videoBitrateOptions),r=I.default.setOpusAttributes(r,e.audioProfile);var i={type:\"answer\",sdp:r=I.default.setSpecialAudioCodec(r,n)};return S.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)})).then((function(){var i=v.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&i.codecs.splice(t,1)})),S.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],i)),y.fillRtpParametersForTrack(i,a,r),i})).catch((function(e){try{t._pc.removeTrack(i)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;S.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),s.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=f.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=I.default.setVideoBitrates(i,e.videoBitrateOptions),i=I.default.setOpusAttributes(i,e.audioProfile);var a={type:\"answer\",sdp:i=I.default.setSpecialAudioCodec(i,n)};return S.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;S.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return s.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),s.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"updateTrack\",value:function(e,t){var r,n,i=this;S.debug(\"update Track() [trackId:%s]\",t.id);var a=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),s.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){S.debug(\"updateTrack() | enabling simulcast\");var o=f.default.parse(r.sdp);y.addPlanBSimulcast(o,t,{mid:n.mid}),r={type:\"offer\",sdp:f.default.write(o)}}return S.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),i._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r);t=I.default.setVideoBitrates(t,e.videoBitrateOptions),t=I.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=I.default.setSpecialAudioCodec(t,a)};return S.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),i._pc.setRemoteDescription(n)})).then((function(){var o=v.clone(i._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+a&&o.codecs.splice(t,1)})),S.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",i._rtpParametersByKind[e.kind],o)),y.fillRtpParametersForTrack(o,r,t,{mid:n.mid,planBSimulcast:!0}),o})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(S.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return s.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,a={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),s.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){var t=e.receiver;return!!t&&(!!t.track&&e.mid===a.mid)}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;S.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,s.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):s.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),s.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){S.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(w),E=function(){function e(t,r,i){(0,d.default)(this,e),S.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":if(!(a={audio:_.getSendingRtpParameters(\"audio\",r),video:_.getSendingRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var o=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(a.video.codecs);!(o=(u=l.next()).done);o=!0){var p=u.value;\"video/H264\"===p.mimeType&&\"42001f\"===p.parameters[\"profile-level-id\"]&&(p.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new T(a,i);case\"recv\":if(!(a={audio:_.getReceivingFullRtpParameters(\"audio\",r),video:_.getReceivingFullRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var f=!0,m=!1,h=void 0;try{for(var v,g=(0,n.default)(a.video.codecs);!(f=(v=g.next()).done);f=!0){var y=v.value;\"video/H264\"===y.mimeType&&\"42001f\"===y.parameters[\"profile-level-id\"]&&(y.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){m=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}}return new A(a,i)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){S.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),t=document.createElement(\"canvas\");t.getContext(\"2d\");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:\"RID1\",maxBitrate:4e4},{rid:\"RID2\",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var i=f.default.parse(r.sdp);return g.extractRtpCapabilities(i)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:\"tag\",get:function(){return\"Firefox59\"}}]),e}();t.default=E},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=P(r(9)),i=P(r(18)),a=P(r(8)),o=P(r(86)),s=P(r(6)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(36)),b=P(r(37)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default(\"Firefox50\"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){S.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){S.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(S.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return s.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,a=void 0;return s.default.resolve().then((function(){t._stream.addTrack(r),i=t._pc.addTrack(r,t._stream)})).then((function(){var r=[];e.simulcast&&(S.debug(\"addProducer() | enabling simulcast\"),e.simulcast.high&&r.push({rid:\"high\"+t._nextRid,active:!0,priority:\"low\",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:\"medium\"+t._nextRid,active:!0,priority:\"medium\",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:\"low\"+t._nextRid,active:!0,priority:\"high\",maxBitrate:e.simulcast.low}),t._nextRid++);var n=i.getParameters();return i.setParameters((0,o.default)({},n,{encodings:r}))})).then((function(){return t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=f.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=I.default.setVideoBitrates(r,e.videoBitrateOptions),r=I.default.setOpusAttributes(r,e.audioProfile);var i={type:\"answer\",sdp:r=I.default.setSpecialAudioCodec(r,n)};return S.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)})).then((function(){var i=v.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&i.codecs.splice(t,1)})),S.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],i)),y.fillRtpParametersForTrack(i,a,r),i})).catch((function(e){try{t._pc.removeTrack(i)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;S.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),s.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=f.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=I.default.setVideoBitrates(i,e.videoBitrateOptions),i=I.default.setOpusAttributes(i,e.audioProfile);var a={type:\"answer\",sdp:i=I.default.setSpecialAudioCodec(i,n)};return S.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;S.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return s.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),s.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"updateTrack\",value:function(e,t){var r,n,i=this;S.debug(\"update Track() [trackId:%s]\",t.id);var a=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),s.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){S.debug(\"updateTrack() | enabling simulcast\");var o=f.default.parse(r.sdp);y.addPlanBSimulcast(o,t,{mid:n.mid}),r={type:\"offer\",sdp:f.default.write(o)}}return S.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),i._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r);t=I.default.setVideoBitrates(t,e.videoBitrateOptions),t=I.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=I.default.setSpecialAudioCodec(t,a)};return S.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),i._pc.setRemoteDescription(n)})).then((function(){var o=v.clone(i._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+a&&o.codecs.splice(t,1)})),S.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",i._rtpParametersByKind[e.kind],o)),y.fillRtpParametersForTrack(o,r,t,{mid:n.mid,planBSimulcast:!0}),o})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"recv\",e,r));n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default;return n._consumerInfos.set(555,{mid:\"fake-dc\",kind:\"application\",closed:!1,cname:null}),n}return(0,p.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(S.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return s.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,a={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),s.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===a.trackId}));if(!e)throw new Error(\"remote track not found\");return e.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;S.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,s.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):s.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),s.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){S.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(w),E=function(){function e(t,r,i){(0,d.default)(this,e),S.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":if(!(a={audio:_.getSendingRtpParameters(\"audio\",r),video:_.getSendingRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var o=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(a.video.codecs);!(o=(u=l.next()).done);o=!0){var p=u.value;\"video/H264\"===p.mimeType&&\"42001f\"===p.parameters[\"profile-level-id\"]&&(p.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new T(a,i);case\"recv\":if(!(a={audio:_.getReceivingFullRtpParameters(\"audio\",r),video:_.getReceivingFullRtpParameters(\"video\",r)}).video.codecs.find((function(e){return\"42e01f\"===e.parameters[\"profile-level-id\"]}))){var f=!0,m=!1,h=void 0;try{for(var v,g=(0,n.default)(a.video.codecs);!(f=(v=g.next()).done);f=!0){var y=v.value;\"video/H264\"===y.mimeType&&\"42001f\"===y.parameters[\"profile-level-id\"]&&(y.parameters[\"profile-level-id\"]=\"42e01f\")}}catch(e){m=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}}return new A(a,i)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){S.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),t=document.createElement(\"canvas\");t.getContext(\"2d\");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:\"RID1\",maxBitrate:4e4},{rid:\"RID2\",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var i=f.default.parse(r.sdp);return g.extractRtpCapabilities(i)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:\"tag\",get:function(){return\"Firefox50\"}}]),e}();t.default=E},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=_(r(9)),i=_(r(8)),a=_(r(2)),o=_(r(6)),s=_(r(0)),c=_(r(3)),d=_(r(1)),u=_(r(4)),l=_(r(5)),p=_(r(11)),f=v(r(10)),m=v(r(16)),h=v(r(208));function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _(e){return e&&e.__esModule?e:{default:e}}var g=\"CNAME-EDGE-\"+f.randomNumber(),y=new l.default(\"Edge11\"),b=function(e){function t(e,r,n){(0,s.default)(this,t);var o=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this,y));return y.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",e,r),o._rtpParametersByKind={audio:m.getSendingRtpParameters(\"audio\",r),video:m.getSendingRtpParameters(\"video\",r)},o._transportReady=!1,o._iceGatherer=null,o._iceTransport=null,o._dtlsTransport=null,o._rtpSenders=new i.default,o._rtpReceivers=new i.default,o._transportRemoteParameters=null,o._setIceGatherer(n),o._setIceTransport(),o._setDtlsTransport(),o}return(0,u.default)(t,e),(0,d.default)(t,null,[{key:\"getNativeRtpCapabilities\",value:function(){return y.debug(\"getNativeRtpCapabilities()\"),o.default.resolve(h.getCapabilities())}},{key:\"tag\",get:function(){return\"Edge11\"}}]),(0,d.default)(t,[{key:\"close\",value:function(){y.debug(\"close()\");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var i,a=(0,n.default)(this._rtpSenders.values());!(e=(i=a.next()).done);e=!0){var o=i.value;try{o.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw r}}var s=!0,c=!1,d=void 0;try{for(var u,l=(0,n.default)(this._rtpReceivers.values());!(s=(u=l.next()).done);s=!0){var p=u.value;try{p.stop()}catch(e){}}}catch(e){c=!0,d=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw d}}}},{key:\"remoteClosed\",value:function(){y.debug(\"remoteClosed()\"),this._transportReady=!1}},{key:\"addProducer\",value:function(e){var t=this,r=e.track;return y.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?o.default.reject(new Error(\"Producer already added\")):o.default.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){y.debug(\"addProducer() | calling new RTCRtpSender()\");var n=new RTCRtpSender(r,t._dtlsTransport),i=f.clone(t._rtpParametersByKind[e.kind]),a={ssrc:f.randomNumber()};i.codecs.some((function(e){return\"rtx\"===e.name}))&&(a.rtx={ssrc:f.randomNumber()}),i.encodings.push(a),i.rtcp={cname:g,reducedSize:!0,mux:!0};var o=h.mangleRtpParameters(i);return y.debug(\"addProducer() | calling rtpSender.send() [params:%o]\",o),n.send(o),t._rtpSenders.set(e.id,n),i}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return y.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),o.default.resolve().then((function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error(\"RTCRtpSender not found\");t._rtpSenders.delete(e.id);try{y.debug(\"removeProducer() | calling rtpSender.stop()\"),r.stop()}catch(e){y.warn(\"rtpSender.stop() failed:%o\",e)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;return y.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id),o.default.resolve().then((function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error(\"RTCRtpSender not found\");n.setTrack(t)}))}},{key:\"addConsumer\",value:function(e){var t=this;return y.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._rtpReceivers.has(e.id)?o.default.reject(new Error(\"Consumer already added\")):o.default.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){y.debug(\"addConsumer() | calling new RTCRtpReceiver()\");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener(\"error\",(function(e){y.error('iceGatherer \"error\" event [event:%o]',e)}));var n=h.mangleRtpParameters(e.rtpParameters);return n.headerExtensions=n.headerExtensions.filter((function(e){return\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==e.uri})),y.debug(\"addConsumer() | calling rtpReceiver.receive() [params:%o]\",n),r.receive(n),t._rtpReceivers.set(e.id,r),r.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;return y.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),o.default.resolve().then((function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error(\"RTCRtpReceiver not found\");t._rtpReceivers.delete(e.id);try{y.debug(\"removeConsumer() | calling rtpReceiver.stop()\"),r.stop()}catch(e){y.warn(\"rtpReceiver.stop() failed:%o\",e)}}))}},{key:\"restartIce\",value:function(e){var t=this;y.debug(\"restartIce()\"),o.default.resolve().then((function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;y.debug(\"restartIce() | calling iceTransport.start()\"),t._iceTransport.start(t._iceGatherer,e,\"controlling\");var i=!0,a=!1,o=void 0;try{for(var s,c=(0,n.default)(r);!(i=(s=c.next()).done);i=!0){var d=s.value;t._iceTransport.addRemoteCandidate(d)}}catch(e){a=!0,o=e}finally{try{!i&&c.return&&c.return()}finally{if(a)throw o}}t._iceTransport.addRemoteCandidate({})}))}},{key:\"_setIceGatherer\",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:e.iceTransportPolicy});t.addEventListener(\"error\",(function(e){y.error('iceGatherer \"error\" event [event:%o]',e)}));try{t.gather()}catch(e){y.debug(\"iceGatherer.gather() failed - \"+e.name+\" \"+e.message)}this._iceGatherer=t}},{key:\"_setIceTransport\",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener(\"statechange\",(function(){switch(t.state){case\"checking\":e.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":e.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":e.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":e.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":e.emit(\"@connectionstatechange\",\"closed\")}})),t.addEventListener(\"icestatechange\",(function(){switch(t.state){case\"checking\":e.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":e.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":e.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":e.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":e.emit(\"@connectionstatechange\",\"closed\")}})),t.addEventListener(\"candidatepairchange\",(function(e){y.debug('iceTransport \"candidatepairchange\" event [pair:%o]',e.pair)})),this._iceTransport=t}},{key:\"_setDtlsTransport\",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener(\"statechange\",(function(){y.debug('dtlsTransport \"statechange\" event [state:%s]',t.state)})),t.addEventListener(\"dtlsstatechange\",(function(){y.debug('dtlsTransport \"dtlsstatechange\" event [state:%s]',t.state),\"closed\"===t.state&&e.emit(\"@connectionstatechange\",\"closed\")})),t.addEventListener(\"error\",(function(e){y.error('dtlsTransport \"error\" event [event:%o]',e)})),this._dtlsTransport=t}},{key:\"_setupTransport\",value:function(){var e=this;return y.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role=\"server\",t.dtlsParameters=r,e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._transportRemoteParameters=t;var r=t.iceParameters,i=t.iceCandidates,a=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,\"controlling\");var o=!0,s=!1,c=void 0;try{for(var d,u=(0,n.default)(i);!(o=(d=u.next()).done);o=!0){var l=d.value;e._iceTransport.addRemoteCandidate(l)}}catch(e){s=!0,c=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw c}}e._iceTransport.addRemoteCandidate({}),a.fingerprints=a.fingerprints.filter((function(e){return\"sha-256\"===e.algorithm||\"sha-384\"===e.algorithm||\"sha-512\"===e.algorithm})),e._dtlsTransport.start(a),e._transportReady=!0}))}}]),t}(p.default);t.default=b},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n,i=r(9),a=(n=i)&&n.__esModule?n:{default:n};t.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=o.clone(e),r=!0,n=!1,i=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(r=(s=c.next()).done);r=!0){var d=s.value;if(d.channels=d.numChannels,delete d.numChannels,\"audio\"!==d.kind?delete d.channels:d.channels||(d.channels=1),d.mimeType=d.kind+\"/\"+d.name,d.parameters){var u=d.parameters;u.apt&&(u.apt=Number(u.apt)),u[\"packetization-mode\"]&&(u[\"packetization-mode\"]=Number(u[\"packetization-mode\"]))}var l=!0,p=!1,f=void 0;try{for(var m,h=(0,a.default)(d.rtcpFeedback||[]);!(l=(m=h.next()).done);l=!0){var v=m.value;v.parameter||delete v.parameter}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}}}catch(e){n=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw i}}return t},t.mangleRtpParameters=function(e){var t=o.clone(e),r=!0,n=!1,i=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(r=(s=c.next()).done);r=!0){var d=s.value;d.channels&&(d.numChannels=d.channels,delete d.channels),delete d.mimeType}}catch(e){n=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw i}}return t};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10))},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=k(r(18)),i=k(r(8)),a=k(r(6)),o=k(r(20)),s=k(r(2)),c=k(r(0)),d=k(r(1)),u=k(r(3)),l=k(r(4)),p=k(r(13)),f=k(r(5)),m=k(r(11)),h=I(r(10)),v=I(r(16)),_=I(r(21)),g=I(r(44)),y=k(r(45)),b=k(r(24));function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function k(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"ReactNative\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P)),a={bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new y.default(e,r),i._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(i._pc.iceConnectionState){case\"checking\":i.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":i.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":i.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":i.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":i.emit(\"@connectionstatechange\",\"closed\")}})),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),w=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._tracks=new o.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._tracks.has(r))return a.default.reject(new Error(\"track already added\"));if(!r.streamReactTag)return a.default.reject(new Error(\"no track.streamReactTag property\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,o=void 0;return a.default.resolve().then((function(){return t._tracks.add(r),(i=new MediaStream(r.streamReactTag)).addTrack(r),t._pc.addStream(i),t._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,r),i={type:\"offer\",sdp:p.default.write(a)}}P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",i);var o=new RTCSessionDescription(i);return t._pc.setLocalDescription(o)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){o=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(o);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var i={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",i);var a=new RTCSessionDescription(i);return t._pc.setRemoteDescription(a)})).then((function(){var i=h.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&i.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,o,r),i})).catch((function(e){throw t._tracks.delete(r),i.removeTrack(r),t._pc.removeStream(i),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),!r.streamReactTag)return a.default.reject(new Error(\"no track.streamReactTag property\"));var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),a.default.resolve().then((function(){t._tracks.delete(r);var e=new MediaStream(r.streamReactTag);return e.addTrack(r),t._pc.removeStream(e),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._tracks.size)throw e;P.warn(\"removeProducer() | ignoring expected error due no sending tracks - \"+e.name+\" \"+e.message)})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=b.default.setVideoBitrates(i,e.videoBitrateOptions),i=b.default.setOpusAttributes(i,e.audioProfile);var a={type:\"answer\",sdp:i=b.default.setSpecialAudioCodec(i,n)};P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a);var o=new RTCSessionDescription(a);return t._pc.setRemoteDescription(o)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;if(P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id),!t.streamReactTag)return a.default.reject(new Error(\"no track.streamReactTag property\"));var n=e.track,i=void 0,o=void 0,s=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(s=e.audioProfile.codec.toLowerCase()),a.default.resolve().then((function(){return r._tracks.add(t),r._tracks.delete(n),(i=new MediaStream(t.streamReactTag)).addTrack(t),i.removeTrack(n),r._pc.addStream(i),r._pc.createOffer()})).then((function(n){if(n.sdp=b.default.setVideoBitrates(n.sdp,e.videoBitrateOptions),n.sdp=b.default.setOpusAttributes(n.sdp,e.audioProfile),n.sdp=b.default.setSpecialAudioCodec(n.sdp,s),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var i=p.default.parse(n.sdp);g.addSimulcastForTrack(i,t),n={type:\"offer\",sdp:p.default.write(i)}}P.debug(\"replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]\",n);var a=new RTCSessionDescription(n);return r._pc.setLocalDescription(a)})).then((function(){o=p.default.parse(r._pc.localDescription.sdp);var t=r._remoteSdp.createAnswerSdp(o);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,s)};P.debug(\"replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]\",n);var i=new RTCSessionDescription(n);return r._pc.setRemoteDescription(i)})).then((function(){var n=h.clone(r._rtpParametersByKind[e.kind]);n&&n.codecs&&(n.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+s&&n.codecs.splice(t,1)})),P.debug(\"replaceProducerTrack() _rtpParametersByKind: %o - rtpParameters: %o\",r._rtpParametersByKind[e.kind],n)),g.fillRtpParametersForTrack(n,o,t),r.safeEmit(\"@needupdateproducer\",e,n)})).catch((function(e){throw r._tracks.delete(t),i.removeTrack(t),r._pc.addStream(i),e}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),i=_.extractDtlsParameters(n);return i.role=\"server\",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;P.debug(\"update Track() [trackId:%s]\",t.id);var i=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),a.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var a=p.default.parse(r.sdp);g.addSimulcastForTrack(a,t),r={type:\"offer\",sdp:p.default.write(a)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var a={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",a),n._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(n._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+i&&a.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",n._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,r,t),a})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new o.default,n._consumerInfos=new i.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===o.streamId})),r=e.getTrackById(o.trackId);if(r.streamReactTag=e.reactTag,!r)throw new Error(\"remote track not found\");return r}))}},{key:\"removeConsumer\",value:function(e){var t=this;return P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),a.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(S),A=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var i=void 0;switch(t){case\"send\":return i={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new w(i,n);case\"recv\":return i={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(i,n)}}return(0,d.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"ReactNative\"}}]),e}();t.default=A},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=P(r(18)),i=P(r(63)),a=P(r(26)),o=P(r(9)),s=P(r(6)),c=P(r(8)),d=P(r(2)),u=P(r(0)),l=P(r(1)),p=P(r(3)),f=P(r(4)),m=P(r(5)),h=P(r(11)),v=r(55),_=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(16)),g=P(r(85)),y=P(r(211)),b=P(r(213)),I=P(r(214)),k=P(r(215));function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default(\"Room\"),w=\"new\",T=\"joining\",A=\"joined\",E=\"closed\",R=function(e){function t(e){(0,u.default)(this,t);var r=(0,p.default)(this,(t.__proto__||(0,d.default)(t)).call(this,S));if(S.debug(\"constructor() [options:%o]\",e),!g.default.isSupported())throw new Error(\"current browser/device not supported\");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||3e4,transportOptions:e.transportOptions||{},enableTurn:e.enableTurn,h264ProfileLevelId:e.h264ProfileLevelId,turnServers:e.turnServers||[],iceTransportPolicy:e.iceTransportPolicy||\"all\",spy:Boolean(e.spy)},r._state=w,r._peerName=null,r._transports=new c.default,r._producers=new c.default,r._peers=new c.default,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}return(0,f.default)(t,e),(0,l.default)(t,[{key:\"getTransportById\",value:function(e){return this._transports.get(e)}},{key:\"getProducerById\",value:function(e){return this._producers.get(e)}},{key:\"getPeerByName\",value:function(e){return this._peers.get(e)}},{key:\"join\",value:function(e,t){var r=this;if(\"string\"!=typeof e)return s.default.reject(new TypeError(\"Room.join - invalid peerName\"));if(S.debug('join() [peerName:\"%s\"]',e),this._state!==w&&this._state!==E)return s.default.reject(new v.InvalidStateError('Room.join - invalid state \"'+this._state+'\"'));this._peerName=e,this._state=T;var n=void 0;return s.default.resolve().then((function(){return r._settings.roomSettings?void(n=r._settings.roomSettings):r._sendRequest(\"queryRoom\",{target:\"room\"}).then((function(e){n=e,S.debug(\"join() | got Room settings:%o\",n)}))})).then((function(){return g.default.Handler.getNativeRtpCapabilities()})).then((function(e){S.debug(\"join() | native RTP capabilities:%o\",e),r._extendedRtpCapabilities=_.getExtendedRtpCapabilities(e,n.rtpCapabilities),S.debug(\"join() | extended RTP capabilities:%o\",r._extendedRtpCapabilities);var i=_.getUnsupportedCodecs(n.rtpCapabilities,n.mandatoryCodecPayloadTypes,r._extendedRtpCapabilities);if(i.length>0)throw S.error(\"%s mandatory room codecs not supported:%o\",i.length,i),new v.UnsupportedError(\"mandatory room codecs not supported\",i);r._canSendByKind.audio=_.canSend(\"audio\",r._extendedRtpCapabilities),r._canSendByKind.video=_.canSend(\"video\",r._extendedRtpCapabilities);var a=_.getRtpCapabilities(r._extendedRtpCapabilities);S.debug(\"join() | effective local RTP capabilities for receiving:%o\",a);var o={target:\"room\",peerName:r._peerName,rtpCapabilities:a,spy:r._settings.spy,appData:t};return r._sendRequest(\"join\",o).then((function(e){return e.peers}))})).then((function(e){var t=!0,n=!1,i=void 0;try{for(var a,s=(0,o.default)(e||[]);!(t=(a=s.next()).done);t=!0){var c=a.value;try{r._handlePeerData(c)}catch(e){S.error(\"join() | error handling Peer:%o\",e)}}}catch(e){n=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw i}}return r._state=A,S.debug(\"join() | joined the Room\"),r.peers})).catch((function(e){throw r._state=w,e}))}},{key:\"leave\",value:function(e){if(S.debug(\"leave()\"),!this.closed){this._sendNotification(\"leave\",{appData:e}),this._state=E,this.safeEmit(\"close\",\"local\",e);var t=!0,r=!1,n=void 0;try{for(var i,a=(0,o.default)(this._transports.values());!(t=(i=a.next()).done);t=!0){i.value.close()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var s=!0,c=!1,d=void 0;try{for(var u,l=(0,o.default)(this._producers.values());!(s=(u=l.next()).done);s=!0){u.value.close()}}catch(e){c=!0,d=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw d}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,o.default)(this._peers.values());!(p=(h=v.next()).done);p=!0){h.value.close()}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}}}},{key:\"remoteClose\",value:function(e){if(S.debug(\"remoteClose()\"),!this.closed){this._state=E,this.safeEmit(\"close\",\"remote\",e);var t=!0,r=!1,n=void 0;try{for(var i,a=(0,o.default)(this._transports.values());!(t=(i=a.next()).done);t=!0){i.value.remoteClose(null,{destroy:!0})}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var s=!0,c=!1,d=void 0;try{for(var u,l=(0,o.default)(this._producers.values());!(s=(u=l.next()).done);s=!0){u.value.remoteClose()}}catch(e){c=!0,d=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw d}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,o.default)(this._peers.values());!(p=(h=v.next()).done);p=!0){h.value.remoteClose()}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}}}},{key:\"canSend\",value:function(e){if(\"audio\"!==e&&\"video\"!==e)throw new TypeError('invalid kind \"'+e+'\"');return!(!this.joined||this._settings.spy)&&this._canSendByKind[e]}},{key:\"createTransport\",value:function(e,t){var r=this;if(S.debug(\"createTransport() [direction:%s]\",e),!this.joined)throw new v.InvalidStateError('invalid state \"'+this._state+'\"');if(\"send\"!==e&&\"recv\"!==e)throw new TypeError('invalid direction \"'+e+'\"');if(\"send\"===e&&this._settings.spy)throw new TypeError(\"a spy peer cannot send media to the room\");var n=new y.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on(\"@request\",(function(e,t,n,i){r._sendRequest(e,t).then(n).catch(i)})),n.on(\"@notify\",(function(e,t){r._sendNotification(e,t)})),n.on(\"@close\",(function(){r._transports.delete(n.id)})),n}},{key:\"createProducer\",value:function(e,t,r){var n=this;if(S.debug(\"createProducer() [track:%o, options:%o]\",e,t),!this.joined)throw new v.InvalidStateError('invalid state \"'+this._state+'\"');if(this._settings.spy)throw new Error(\"a spy peer cannot send media to the room\");if(!e)throw new TypeError(\"no track given\");if(!this._canSendByKind[e.kind])throw new Error(\"cannot send \"+e.kind);if(\"ended\"===e.readyState)throw new Error('track.readyState is \"ended\"');t=t||{};var i=new b.default(e,t,r);return this._producers.set(i.id,i),i.on(\"@close\",(function(){n._producers.delete(i.id)})),i}},{key:\"restartIce\",value:function(e,t){if(this.joined){var r=!0,n=!1,i=void 0;try{for(var a,s=(0,o.default)(this._transports.values());!(r=(a=s.next()).done);r=!0){a.value.restartIce(e,t)}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}}else S.warn('restartIce() | invalid state \"'+this._state+'\"')}},{key:\"receiveNotification\",value:function(e){var t=this;if(this.closed)return s.default.reject(new v.InvalidStateError(\"Room closed\"));if(\"object\"!==(void 0===e?\"undefined\":(0,a.default)(e)))return s.default.reject(new TypeError(\"wrong notification Object\"));if(!0!==e.notification)return s.default.reject(new TypeError(\"not a notification\"));if(\"string\"!=typeof e.method)return s.default.reject(new TypeError(\"wrong/missing notification method\"));var r=e.method;return\"producerStats\"!==r&&\"consumerStats\"!==r&&S.debug(\"receiveNotification() [method:%s, notification:%o]\",r,e),s.default.resolve().then((function(){switch(r){case\"closed\":var n=e.appData;t.remoteClose(n);break;case\"transportClosed\":var i=e.id,a=e.appData,o=t._transports.get(i);if(!o)throw new Error('Transport not found [id:\"'+i+'\"]');o.remoteClose(a,{destroy:!1});break;case\"transportStats\":var s=e.id,c=e.stats,d=t._transports.get(s);if(!d)throw new Error(\"Transport not found [id:\"+s+\"]\");d.remoteStats(c);break;case\"newPeer\":var u=e.name;if(t._peers.has(u))throw new Error('Peer already exists [name:\"'+u+'\"]');var l=e;t._handlePeerData(l);break;case\"peerClosed\":var p=e.name,f=e.appData,m=t._peers.get(p);if(!m)throw new Error('no Peer found [name:\"'+p+'\"]');m.remoteClose(f);break;case\"producerPaused\":var h=e.id,v=e.appData,_=t._producers.get(h);if(!_)throw new Error(\"Producer not found [id:\"+h+\"]\");_.remotePause(v);break;case\"producerResumed\":var g=e.id,y=e.appData,b=t._producers.get(g);if(!b)throw new Error(\"Producer not found [id:\"+g+\"]\");b.remoteResume(y);break;case\"producerClosed\":var I=e.id,k=e.appData,P=t._producers.get(I);if(!P)throw new Error(\"Producer not found [id:\"+I+\"]\");P.remoteClose(k);break;case\"producerStats\":var S=e.id,w=e.stats,T=t._producers.get(S);if(!T)throw new Error(\"Producer not found [id:\"+S+\"]\");T.remoteStats(w);break;case\"newConsumer\":var A=e.peerName,E=t._peers.get(A);if(!E)throw new Error('no Peer found [name:\"'+A+'\"]');var R=e;t._handleConsumerData(R,E);break;case\"consumerClosed\":var C=e.id,O=e.peerName,N=e.appData,x=t._peers.get(O);if(!x)throw new Error('no Peer found [name:\"'+O+'\"]');var L=x.getConsumerById(C);if(!L)throw new Error(\"Consumer not found [id:\"+C+\"]\");L.remoteClose(N);break;case\"consumerPaused\":var D=e.id,M=e.peerName,B=e.appData,V=t._peers.get(M);if(!V)throw new Error('no Peer found [name:\"'+M+'\"]');var j=V.getConsumerById(D);if(!j)throw new Error(\"Consumer not found [id:\"+D+\"]\");j.remotePause(B);break;case\"consumerResumed\":var F=e.id,U=e.peerName,G=e.appData,H=t._peers.get(U);if(!H)throw new Error('no Peer found [name:\"'+U+'\"]');var K=H.getConsumerById(F);if(!K)throw new Error(\"Consumer not found [id:\"+F+\"]\");K.remoteResume(G);break;case\"consumerPreferredProfileSet\":var W=e.id,z=e.peerName,X=e.profile,q=t._peers.get(z);if(!q)throw new Error('no Peer found [name:\"'+z+'\"]');var Y=q.getConsumerById(W);if(!Y)throw new Error(\"Consumer not found [id:\"+W+\"]\");Y.remoteSetPreferredProfile(X);break;case\"consumerEffectiveProfileChanged\":var J=e.id,Q=e.peerName,$=e.profile,Z=t._peers.get(Q);if(!Z)throw new Error('no Peer found [name:\"'+Q+'\"]');var ee=Z.getConsumerById(J);if(!ee)throw new Error(\"Consumer not found [id:\"+J+\"]\");ee.remoteEffectiveProfileChanged($);break;case\"consumerStats\":var te=e.id,re=e.peerName,ne=e.stats,ie=t._peers.get(re);if(!ie)throw new Error('no Peer found [name:\"'+re+'\"]');var ae=ie.getConsumerById(te);if(!ae)throw new Error(\"Consumer not found [id:\"+te+\"]\");ae.remoteStats(ne);break;default:throw new Error('unknown notification method \"'+r+'\"')}})).catch((function(t){S.error(\"receiveNotification() failed [notification:%o]: %s\",e,t)}))}},{key:\"_sendRequest\",value:function(e,t){var r=this,n=(0,i.default)({method:e,target:\"peer\"},t);return this.closed?(S.error(\"_sendRequest() | Room closed [method:%s, request:%o]\",e,n),s.default.reject(new v.InvalidStateError(\"Room closed\"))):(S.debug(\"_sendRequest() [method:%s, request:%o]\",e,n),new s.default((function(t,i){var a=!1,o=setTimeout((function(){S.error(\"request failed [method:%s]: timeout\",e),a=!0,i(new v.TimeoutError(\"timeout\"))}),r._settings.requestTimeout);r.safeEmit(\"request\",n,(function(n){if(!a){if(a=!0,clearTimeout(o),r.closed)return S.error(\"request failed [method:%s]: Room closed\",e),void i(new Error(\"Room closed\"));S.debug(\"request succeeded [method:%s, response:%o]\",e,n),t(n)}}),(function(t){if(!a){if(a=!0,clearTimeout(o),r.closed)return S.error(\"request failed [method:%s]: Room closed\",e),void i(new Error(\"Room closed\"));t instanceof Error||(t=new Error(String(t))),S.error(\"request failed [method:%s]:%o\",e,t),i(t)}}))})))}},{key:\"_sendNotification\",value:function(e,t){if(!this.closed){var r=(0,i.default)({method:e,target:\"peer\",notification:!0},t);S.debug(\"_sendNotification() [method:%s, notification:%o]\",e,r),this.safeEmit(\"notify\",r)}}},{key:\"_handlePeerData\",value:function(e){var t=this,r=e.name,n=e.consumers,i=e.appData,a=this._peers.get(r);a?a.appData=i:a=new I.default(r,i),this._peers.set(a.name,a),a.on(\"@close\",(function(){t._peers.delete(a.name)}));var s=!0,c=!1,d=void 0;try{for(var u,l=(0,o.default)(n);!(s=(u=l.next()).done);s=!0){var p=u.value;try{this._handleConsumerData(p,a)}catch(e){S.error(\"error handling existing Consumer in Peer:%o\",e)}}}catch(e){c=!0,d=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw d}}this.joined&&this.safeEmit(\"newpeer\",a)}},{key:\"_handleConsumerData\",value:function(e,t){var r=e.id,n=e.kind,i=e.rtpParameters,a=e.paused,o=e.appData,s=new k.default(r,n,i,t,o);_.canReceive(s.rtpParameters,this._extendedRtpCapabilities)&&s.setSupported(!0),a&&s.remotePause(),t.addConsumer(s)}},{key:\"joined\",get:function(){return this._state===A}},{key:\"closed\",get:function(){return this._state===E}},{key:\"peerName\",get:function(){return this._peerName}},{key:\"transports\",get:function(){return(0,n.default)(this._transports.values())}},{key:\"producers\",get:function(){return(0,n.default)(this._producers.values())}},{key:\"peers\",get:function(){return(0,n.default)(this._peers.values())}}]),t}(h.default);t.default=R},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=g(r(54)),i=g(r(9)),a=g(r(6)),o=g(r(8)),s=g(r(2)),c=g(r(0)),d=g(r(1)),u=g(r(3)),l=g(r(4)),p=g(r(5)),f=g(r(11)),m=r(55),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10)),v=g(r(85)),_=g(r(212));function g(e){return e&&e.__esModule?e:{default:e}}var y=new p.default(\"Transport\"),b=function(e){function t(e,r,n,i){(0,c.default)(this,t);var a=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,y));return y.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",e,r),a._id=h.randomNumber(),a._closed=!1,a._direction=e,a._settings=n,a._appData=i,a._statsEnabled=!1,a._commandQueue=new _.default,a._handler=new v.default.Handler(e,r,n),a._retryTimeTotal=0,a._retryTime=0,a._iceRestartInterval=null,a._connectionState=\"new\",a._producers=new o.default,a._commandQueue.on(\"exec\",a._execCommand.bind(a)),a._handleHandler(),a}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"close\",value:function(e){y.debug(\"close()\"),this._closed||(this._retryTime=0,this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit(\"@notify\",\"closeTransport\",{id:this._id,appData:e}),this.emit(\"@close\"),this.safeEmit(\"close\",\"local\",e),this._destroy())}},{key:\"remoteClose\",value:function(e,t){var r=t.destroy;y.debug(\"remoteClose() [destroy:%s]\",r),this._closed||(r?(this._retryTime=0,this._closed=!0,this.emit(\"@close\"),this.safeEmit(\"close\",\"remote\",e),this._destroy()):this._handler.remoteClosed())}},{key:\"_destroy\",value:function(){this._closeRestartIce(),this._commandQueue.close(),this._handler.close()}},{key:\"_closeRestartIce\",value:function(){this._iceRestartInterval&&clearInterval(this._iceRestartInterval),this._iceRestartInterval=null}},{key:\"attemptRestartIce\",value:function(){var e=this;\"connected\"!==this.connectionState&&(this.closed||(this._closeRestartIce(),this._retryTime=0,this._iceRestartInterval=setInterval((function(){return Boolean(e.closed)||\"connected\"===e.connectionState?(e._closeRestartIce(),void y.debug(\"attemptRestartIce() - id: \"+e.id+\" [FIN-END] _retryTime: \"+e._retryTime+\" closed: \"+e.closed+\" connectionState: \"+e.connectionState)):(e._retryTimeTotal++,++e._retryTime>=15?(e._closeRestartIce(),y.debug(\"attemptRestartIce() - id: \"+e.id+\" [FIN-END] _retryTime: \"+e._retryTime+\" closed: \"+e.closed+\" connectionState: \"+e.connectionState),void e.safeEmit(\"restart-ice-fail\",{retryTime:e._retryTime})):(y.debug(\"attemptRestartIce() - retrying ... id: \"+e.id+\" _retryTime: \"+e._retryTime),void e.restartIce(null,(function(t){y.warn(\"attemptRestartIce() fail - id: \"+e.id+\" error - \"+t.name+\" \"+t.message)}))))}),3e3)))}},{key:\"restartIce\",value:function(e,t){var r=this;y.debug(\"restartIce()\"),this._closed||\"new\"!==this._connectionState&&a.default.resolve().then((function(){r.safeEmit(\"restart-ice-trying\",{retryTime:r._retryTime,error:\"\"});var e={id:r._id};return r.safeEmitAsPromise(\"@request\",\"restartTransport\",e)})).then((function(e){var t=e.iceParameters;return r._commandQueue.push(\"restartIce\",{remoteIceParameters:t})})).catch((function(e){t&&t(e),r.safeEmit(\"restart-ice-trying\",{retryTime:r._retryTime,error:e.name+\" \"+e.message}),y.warn(\"restartIce() | fail - \"+e.name+\" \"+e.message)}))}},{key:\"enableStats\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;y.debug(\"enableStats() [interval:%s]\",e),(\"number\"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit(\"@notify\",\"enableTransportStats\",t)}},{key:\"disableStats\",value:function(){y.debug(\"disableStats()\"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit(\"@notify\",\"disableTransportStats\",e)}},{key:\"_handleHandler\",value:function(){var e=this,t=this._handler;t.on(\"@icegatheringstatechange\",(function(t){e._closed||e.safeEmit(\"icegatheringstatechange\",t)})),t.on(\"@icecandidate\",(function(t){e._closed||e.safeEmit(\"icecandidate\",t)})),t.on(\"@icecandidateerror\",(function(t){e._closed||e.safeEmit(\"icecandidateerror\",t)})),t.on(\"@connectionstatechange\",(function(t){\"connected\"===t&&(e._retryTime=0),e._connectionState!==t&&(y.debug(\"Transport connection state changed to [\"+t+\"]\"),e._connectionState=t,e._closed||e.safeEmit(\"connectionstatechange\",t))})),t.on(\"@needcreatetransport\",(function(t,r,n){var i={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(t.dtlsParameters?i.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(i.plainRtpParameters=t.plainRtpParameters)),e.safeEmit(\"@request\",\"createTransport\",i,r,n)})),t.on(\"@needupdatetransport\",(function(t){var r={id:e._id};t&&(t.dtlsParameters?r.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(r.plainRtpParameters=t.plainRtpParameters)),e.safeEmit(\"@notify\",\"updateTransport\",r)})),t.on(\"@needupdateproducer\",(function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit(\"@notify\",\"updateProducer\",n)}))}},{key:\"addProducer\",value:function(e){return y.debug(\"addProducer() [producer:%o]\",e),this._closed?a.default.reject(new m.InvalidStateError(\"Transport closed\")):\"send\"!==this._direction?a.default.reject(new Error(\"not a sending Transport\")):(this._producers.set(e.id,e),this._commandQueue.push(\"addProducer\",{producer:e}))}},{key:\"removeProducer\",value:function(e,t,r){y.debug(\"removeProducer() [producer:%o]\",e),this._producers.delete(e.id),this._closed||this._commandQueue.push(\"removeProducer\",{producer:e}).catch((function(t){y.warn(\"removeProducer() [producer: \"+e.id+\"] fail - \"+t.name+\" \"+t.message)})),\"local\"===t&&this.safeEmit(\"@notify\",\"closeProducer\",{id:e.id,appData:r})}},{key:\"pauseProducer\",value:function(e,t){y.debug(\"pauseProducer() [producer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"pauseProducer\",r)}},{key:\"resumeProducer\",value:function(e,t){y.debug(\"resumeProducer() [producer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"resumeProducer\",r)}},{key:\"replaceProducerTrack\",value:function(e,t){return y.debug(\"replaceProducerTrack() [producer:%o]\",e),this._commandQueue.push(\"replaceProducerTrack\",{producer:e,track:t})}},{key:\"enableProducerStats\",value:function(e,t){y.debug(\"enableProducerStats() [producer:%o]\",e);var r={id:e.id,interval:t};this.safeEmit(\"@notify\",\"enableProducerStats\",r)}},{key:\"disableProducerStats\",value:function(e){y.debug(\"disableProducerStats() [producer:%o]\",e);var t={id:e.id};this.safeEmit(\"@notify\",\"disableProducerStats\",t)}},{key:\"addConsumer\",value:function(e){return y.debug(\"addConsumer() [consumer:%o]\",e),this._closed?a.default.reject(new m.InvalidStateError(\"Transport closed\")):\"recv\"!==this._direction?a.default.reject(new Error(\"not a receiving Transport\")):this._commandQueue.push(\"addConsumer\",{consumer:e})}},{key:\"removeConsumer\",value:function(e){y.debug(\"removeConsumer() [consumer:%o]\",e),this._commandQueue.push(\"removeConsumer\",{consumer:e}).catch((function(t){y.warn(\"removeConsumer() [consumer: \"+e.id+\"] fail - \"+t.name+\" \"+t.message)}))}},{key:\"pauseConsumer\",value:function(e,t){y.debug(\"pauseConsumer() [consumer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"pauseConsumer\",r)}},{key:\"resumeConsumer\",value:function(e,t){y.debug(\"resumeConsumer() [consumer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"resumeConsumer\",r)}},{key:\"setConsumerPreferredProfile\",value:function(e,t){y.debug(\"setConsumerPreferredProfile() [consumer:%o]\",e);var r={id:e.id,profile:t};this.safeEmit(\"@notify\",\"setConsumerPreferredProfile\",r)}},{key:\"enableConsumerStats\",value:function(e,t){y.debug(\"enableConsumerStats() [consumer:%o]\",e);var r={id:e.id,interval:t};this.safeEmit(\"@notify\",\"enableConsumerStats\",r)}},{key:\"disableConsumerStats\",value:function(e){y.debug(\"disableConsumerStats() [consumer:%o]\",e);var t={id:e.id};this.safeEmit(\"@notify\",\"disableConsumerStats\",t)}},{key:\"remoteStats\",value:function(e){this.safeEmit(\"stats\",e)}},{key:\"getStats\",value:function(e){return this._handler.getPCStats(e)}},{key:\"removeTrack\",value:function(e){return this._handler.removeTrack(e)}},{key:\"updateTrack\",value:function(e,t){return this._handler.updateTrack(e,t)}},{key:\"_execCommand\",value:function(e,t){var r=void 0;try{switch(e.method){case\"addProducer\":var n=e.producer;r=this._execAddProducer(n);break;case\"removeProducer\":var i=e.producer;r=this._execRemoveProducer(i);break;case\"replaceProducerTrack\":var o=e.producer,s=e.track;r=this._execReplaceProducerTrack(o,s);break;case\"addConsumer\":var c=e.consumer;r=this._execAddConsumer(c);break;case\"removeConsumer\":var d=e.consumer;r=this._execRemoveConsumer(d);break;case\"restartIce\":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=a.default.reject(new Error('unknown command method \"'+e.method+'\"'))}}catch(e){r=a.default.reject(e)}t.promise=r}},{key:\"_execAddProducer\",value:function(e){var t=this;y.debug(\"_execAddProducer()\");var r=void 0;return a.default.resolve().then((function(){return t._handler.addProducer(e)})).then((function(n){r=n;var i={id:e.id,kind:e.kind,transportId:t._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return t.safeEmitAsPromise(\"@request\",\"createProducer\",i)})).then((function(){e.setRtpParameters(r)}))}},{key:\"_execRemoveProducer\",value:function(e){return y.debug(\"_execRemoveProducer()\"),this._handler.removeProducer(e)}},{key:\"_execReplaceProducerTrack\",value:function(e,t){return y.debug(\"_execReplaceProducerTrack()\"),this._handler.replaceProducerTrack(e,t)}},{key:\"_execAddConsumer\",value:function(e){var t=this;y.debug(\"_execAddConsumer()\");var r=void 0;return a.default.resolve().then((function(){return t._handler.addConsumer(e)})).then((function(n){r=n;var i={id:e.id,transportId:t.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return t.safeEmitAsPromise(\"@request\",\"enableConsumer\",i)})).then((function(t){var n=t.paused,i=t.preferredProfile,a=t.effectiveProfile;return n&&e.remotePause(),i&&e.remoteSetPreferredProfile(i),a&&e.remoteEffectiveProfileChanged(a),r}))}},{key:\"_execRemoveConsumer\",value:function(e){return y.debug(\"_execRemoveConsumer()\"),this._handler.removeConsumer(e)}},{key:\"_execRestartIce\",value:function(e){return y.debug(\"_execRestartIce()\"),this._handler.restartIce(e)}},{key:\"id\",get:function(){return this._id}},{key:\"closed\",get:function(){return this._closed}},{key:\"direction\",get:function(){return this._direction}},{key:\"appData\",get:function(){return this._appData}},{key:\"connectionState\",get:function(){return this._connectionState}},{key:\"retryTimeTotal\",get:function(){return this._retryTimeTotal}},{key:\"handler\",get:function(){return this._handler}},{key:\"hasAudioProducer\",get:function(){if(!this._producers)return!1;var e=!0,t=!1,r=void 0;try{for(var a,o=(0,i.default)(this._producers);!(e=(a=o.next()).done);e=!0){var s=(0,n.default)(a.value,2);s[0];if(\"audio\"===s[1].kind)return!0}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}return!1}},{key:\"hasVideoProducer\",get:function(){if(!this._producers)return!1;var e=!0,t=!1,r=void 0;try{for(var a,o=(0,i.default)(this._producers);!(e=(a=o.next()).done);e=!0){var s=(0,n.default)(a.value,2);s[0];if(\"video\"===s[1].kind)return!0}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}return!1}}]),t}(f.default);t.default=b},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(6)),i=f(r(63)),a=f(r(2)),o=f(r(0)),s=f(r(1)),c=f(r(3)),d=f(r(4)),u=r(30),l=f(r(5)),p=r(55);function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default(\"CommandQueue\"),h=function(e){function t(){(0,o.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return e.setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}return(0,d.default)(t,e),(0,s.default)(t,[{key:\"close\",value:function(){this._closed=!0}},{key:\"push\",value:function(e,t){var r=this,a=(0,i.default)({method:e},t);return m.debug(\"push() [method:%s]\",e),new n.default((function(e,t){var n=r._queue;a.resolve=e,a.reject=t,n.push(a),r._handlePendingCommands()}))}},{key:\"_handlePendingCommands\",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then((function(){e._busy=!1,t.shift(),e._handlePendingCommands()})))}}},{key:\"_handleCommand\",value:function(e){var t=this;if(m.debug(\"_handleCommand() [method:%s]\",e.method),this._closed)return e.reject(new p.InvalidStateError(\"closed\")),n.default.resolve();var r={promise:null};return this.emit(\"exec\",e,r),n.default.resolve().then((function(){return r.promise})).then((function(r){m.debug(\"_handleCommand() | command succeeded [method:%s]\",e.method),t._closed?e.reject(new p.InvalidStateError(\"closed\")):e.resolve(r)})).catch((function(t){m.warn(\"_handleCommand() | command failed [method:%s]: %o\",e.method,t),e.reject(t)}))}}]),t}(u.EventEmitter);t.default=h},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=v(r(17)),i=v(r(6)),a=v(r(63)),o=v(r(26)),s=v(r(2)),c=v(r(0)),d=v(r(1)),u=v(r(3)),l=v(r(4)),p=v(r(5)),f=v(r(11)),m=r(55),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10));function v(e){return e&&e.__esModule?e:{default:e}}var _={low:1e5,medium:3e5,high:15e5},g=new p.default(\"Producer\"),y=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,g));i._id=h.randomNumber(),i._closed=!1,i._originalTrack=e;try{i._track=e.clone()}catch(t){i._track=e}return i._appData=n,i._simulcast=!1,\"object\"===(0,o.default)(r.simulcast)?i._simulcast=(0,a.default)({},_,r.simulcast):!0===r.simulcast&&(i._simulcast=(0,a.default)({},_)),i._audioProfile=null,\"object\"==(0,o.default)(r.audioProfile)&&(i._audioProfile=r.audioProfile),i._videoBitrateOptions=null,\"object\"===(0,o.default)(r.codecOptions)&&(i._videoBitrateOptions=r.codecOptions),i._transport=null,i._rtpParameters=null,i._locallyPaused=!i._track.enabled,i._remotelyPaused=!1,i._statsEnabled=!1,i._statsInterval=1e3,i._handleTrack(),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"close\",value:function(e){g.debug(\"close()\"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,\"local\",e),this._destroy(),this.emit(\"@close\",\"local\",e),this.safeEmit(\"close\",\"local\",e))}},{key:\"remoteClose\",value:function(e){g.debug(\"remoteClose()\"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,\"remote\",e),this._destroy(),this.emit(\"@close\",\"remote\",e),this.safeEmit(\"close\",\"remote\",e))}},{key:\"_destroy\",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:\"send\",value:function(e){var t=this;return g.debug(\"send() [transport:%o]\",e),this._closed?i.default.reject(new m.InvalidStateError(\"Producer closed\")):this._transport?i.default.reject(new Error(\"already handled by a Transport\")):\"object\"!==(void 0===e?\"undefined\":(0,o.default)(e))?i.default.reject(new TypeError(\"invalid Transport\")):(this._transport=e,e.addProducer(this).then((function(){e.once(\"@close\",(function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,\"local\"),t._transport=null,t._rtpParameters=null,t.safeEmit(\"unhandled\"))})),t.safeEmit(\"handled\"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)})).catch((function(e){throw t._transport=null,e})))}},{key:\"pause\",value:function(e){return g.debug(\"pause()\"),!this._closed&&(!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit(\"pause\",\"local\",e),this.paused))}},{key:\"remotePause\",value:function(e){g.debug(\"remotePause()\"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit(\"pause\",\"remote\",e))}},{key:\"resume\",value:function(e){return g.debug(\"resume()\"),!this._closed&&(!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit(\"resume\",\"local\",e),!this.paused))}},{key:\"remoteResume\",value:function(e){g.debug(\"remoteResume()\"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit(\"resume\",\"remote\",e))}},{key:\"stopTrack\",value:function(){g.debug(\"stopTrack() \");try{this._track.onended=null,this._track.stop()}catch(e){g.debug(\"stopTrack() fail - \"+e.name+\" \"+e.message)}}},{key:\"replaceTrack\",value:function(e){var t=this;if(g.debug(\"replaceTrack() [track:%o]\",e),this._closed)return i.default.reject(new m.InvalidStateError(\"Producer closed\"));if(!e)return i.default.reject(new TypeError(\"no track given\"));if(\"ended\"===e.readyState)return i.default.reject(new Error(\"track.readyState is [ended]\"));var r=void 0;try{r=e.clone()}catch(t){r=e}return i.default.resolve().then((function(){if(t._transport)return t._transport.replaceProducerTrack(t,r)})).then((function(){try{t._track.onended=null,t._track.stop()}catch(e){g.debug(\"replaceTrack() fail - \"+e.name+\" \"+e.message)}return t.paused?r.enabled=!1:r.enabled=!0,t._originalTrack=e,t._track=r,t._handleTrack(),t._track}))}},{key:\"updateTrack\",value:function(e,t,r){var i=this;this._track.applyConstraints(t).then((function(){g.debug(\"updateTrack() track.applyConstraints ok -- constraints: \"+(0,n.default)(t)),i.setCodecOption(r),i._transport.updateTrack(i,e)})).catch((function(e){g.warn(\"updateTrack() error - track.applyConstraints failed - \"+e.name+\" \"+e.message)}))}},{key:\"setCodecOption\",value:function(e){this._videoBitrateOptions={videoGoogleStartBitrate:e.idealBandwidth,videoGoogleMaxBitrate:e.maxBandwidth,videoGoogleMinBitrate:e.minBandwidth}}},{key:\"setRtpParameters\",value:function(e){this._rtpParameters=e}},{key:\"enableStats\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;g.debug(\"enableStats() [interval:%s]\",e),this._closed||this._statsEnabled||(this._statsInterval=\"number\"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:\"disableStats\",value:function(){this._closed||this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:\"enableInternalStats\",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;g.debug(\"enableInternalStats() [interval:%s]\",t),this._closed||this._internalStatsEnabled||(\"number\"!=typeof t||t<1e3?this._interanlStatsInterval=1e3:this._statsInterval=t,this._internalStatsEnabled=!0,this._transport&&(this._internalTimer=setInterval((function(){return e.getStats().then((function(t){e.emit(\"internalStats\",t)}))}),t)))}},{key:\"disableInternalStats\",value:function(){this._internalStatsEnabled&&clearInterval(this._internalTimer),this._internalTimer=null,this._internalStatsEnabled=!1}},{key:\"remoteStats\",value:function(e){this.safeEmit(\"stats\",e)}},{key:\"getStats\",value:function(){return this.transport.getStats(this.track)}},{key:\"_handleTrack\",value:function(){var e=this;this._track.onended=function(){e._closed||(g.warn('track \"ended\" event'),e.safeEmit(\"trackended\"))}}},{key:\"id\",get:function(){return this._id}},{key:\"closed\",get:function(){return this._closed}},{key:\"kind\",get:function(){return this._track.kind}},{key:\"track\",get:function(){return this._track}},{key:\"originalTrack\",get:function(){return this._originalTrack}},{key:\"simulcast\",get:function(){return this._simulcast}},{key:\"appData\",get:function(){return this._appData}},{key:\"transport\",get:function(){return this._transport}},{key:\"rtpParameters\",get:function(){return this._rtpParameters}},{key:\"locallyPaused\",get:function(){return this._locallyPaused}},{key:\"remotelyPaused\",get:function(){return this._remotelyPaused}},{key:\"paused\",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:\"videoBitrateOptions\",get:function(){return this._videoBitrateOptions}},{key:\"audioProfile\",get:function(){return this._audioProfile}}]),t}(f.default);t.default=y},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=m(r(18)),i=m(r(9)),a=m(r(8)),o=m(r(17)),s=m(r(2)),c=m(r(0)),d=m(r(1)),u=m(r(3)),l=m(r(4)),p=m(r(5)),f=m(r(11));function m(e){return e&&e.__esModule?e:{default:e}}var h=new p.default(\"Peer\"),v=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,h));return n._name=e,n._closed=!1,n._appData=JSON.parse((0,o.default)(r)),n._consumers=new a.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:\"close\",value:function(){if(h.debug(\"close()\"),!this._closed){this._closed=!0,this.emit(\"@close\"),this.safeEmit(\"close\",\"local\");var e=!0,t=!1,r=void 0;try{for(var n,a=(0,i.default)(this._consumers.values());!(e=(n=a.next()).done);e=!0){n.value.close()}}catch(e){t=!0,r=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw r}}}}},{key:\"remoteClose\",value:function(e){if(h.debug(\"remoteClose()\"),!this._closed){this._closed=!0,this.emit(\"@close\"),this.safeEmit(\"close\",\"remote\",e);var t=!0,r=!1,n=void 0;try{for(var a,o=(0,i.default)(this._consumers.values());!(t=(a=o.next()).done);t=!0){a.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}}}},{key:\"getConsumerById\",value:function(e){return this._consumers.get(e)}},{key:\"addConsumer\",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error(\"Consumer already exists [id:\"+e.id+\"]\");this._consumers.set(e.id,e),e.on(\"@close\",(function(){t._consumers.delete(e.id)})),this.safeEmit(\"newconsumer\",e)}},{key:\"name\",get:function(){return this._name}},{key:\"closed\",get:function(){return this._closed}},{key:\"appData\",get:function(){return this._appData},set:function(e){e&&(this._appData=JSON.parse((0,o.default)(e)))}},{key:\"consumers\",get:function(){return(0,n.default)(this._consumers.values())}}]),t}(f.default);t.default=v},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=m(r(26)),i=m(r(6)),a=m(r(2)),o=m(r(0)),s=m(r(1)),c=m(r(3)),d=m(r(4)),u=m(r(20)),l=m(r(5)),p=m(r(11)),f=r(55);function m(e){return e&&e.__esModule?e:{default:e}}var h=new u.default([\"default\",\"low\",\"medium\",\"high\"]),v=new l.default(\"Consumer\"),_=function(e){function t(e,r,n,i,s){(0,o.default)(this,t);var d=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this,v));return d._id=e,d._closed=!1,d._kind=r,d._rtpParameters=n,d._peer=i,d._appData=s,d._supported=!1,d._transport=null,d._track=null,d._locallyPaused=!1,d._remotelyPaused=!1,d._statsEnabled=!1,d._statsInterval=1e3,d._preferredProfile=\"default\",d._effectiveProfile=null,d}return(0,d.default)(t,e),(0,s.default)(t,[{key:\"close\",value:function(){v.debug(\"close()\"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit(\"@close\"),this.safeEmit(\"close\",\"local\"),this._destroy())}},{key:\"remoteClose\",value:function(){v.debug(\"remoteClose()\"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit(\"@close\"),this.safeEmit(\"close\",\"remote\"))}},{key:\"_destroy\",value:function(){this._transport=null;try{this.safeEmit(\"trackStop\",\"destroy\",\"debug\"),this._track.stop()}catch(e){}this._track=null}},{key:\"receive\",value:function(e){var t=this;return v.debug(\"receive() [transport:%o]\",e),this._closed?i.default.reject(new f.InvalidStateError(\"Consumer closed\")):this._supported?this._transport?i.default.reject(new Error(\"already handled by a Transport\")):\"object\"!==(void 0===e?\"undefined\":(0,n.default)(e))?i.default.reject(new TypeError(\"invalid Transport\")):(this._transport=e,e.addConsumer(this).then((function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once(\"@close\",(function(){if(!t._closed&&t._transport===e){t._transport=null;try{t.safeEmit(\"trackStop\",\"transport@close\",\"debug\"),t._track.stop()}catch(e){}t._track=null,t.safeEmit(\"unhandled\")}})),t.safeEmit(\"handled\"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r})).catch((function(e){throw t._transport=null,e}))):i.default.reject(new Error(\"unsupported codecs\"))}},{key:\"pause\",value:function(e){return v.debug(\"pause()\"),!this._closed&&(!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit(\"pause\",\"local\",e),this.paused))}},{key:\"remotePause\",value:function(e){v.debug(\"remotePause()\"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit(\"pause\",\"remote\",e))}},{key:\"resume\",value:function(e){return v.debug(\"resume()\"),!this._closed&&(!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit(\"resume\",\"local\",e),!this.paused))}},{key:\"remoteResume\",value:function(e){v.debug(\"remoteResume()\"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit(\"resume\",\"remote\",e))}},{key:\"setPreferredProfile\",value:function(e){v.debug(\"setPreferredProfile() [profile:%s]\",e),this._closed?v.warn(\"setPreferredProfile() | Consumer closed\"):e!==this._preferredProfile&&(h.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):v.error('setPreferredProfile() | invalid profile \"%s\"',e))}},{key:\"remoteSetPreferredProfile\",value:function(e){v.debug(\"remoteSetPreferredProfile() [profile:%s]\",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:\"remoteEffectiveProfileChanged\",value:function(e){v.debug(\"remoteEffectiveProfileChanged() [profile:%s]\",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit(\"effectiveprofilechange\",this._effectiveProfile))}},{key:\"enableStats\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;v.debug(\"enableStats() [interval:%s]\",e),this._closed||this._statsEnabled||(this._statsInterval=\"number\"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:\"disableStats\",value:function(){this._closed||this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:\"setSupported\",value:function(e){this._supported=e}},{key:\"remoteStats\",value:function(e){this.safeEmit(\"stats\",e)}},{key:\"getStats\",value:function(e){return this.transport.getStats(e)}},{key:\"enableInternalStats\",value:function(e){var t=this,r=e>0&&void 0!==e?e:1e3;this._closed||this._internalStatsEnabled||(this._interanlStatsInterval=\"number\"!=typeof r||r<1e3?1e3:r,this._internalStatsEnabled=!0,this._transport&&(this._internalTimer=setInterval((function(){return t.getStats().then((function(e){t.emit(\"internalStats\",e)}))}),r)))}},{key:\"disableInternalStats\",value:function(){this._internalStatsEnabled&&clearInterval(this._internalTimer),this._internalTimer=null,this._internalStatsEnabled=!1}},{key:\"id\",get:function(){return this._id}},{key:\"closed\",get:function(){return this._closed}},{key:\"kind\",get:function(){return this._kind}},{key:\"rtpParameters\",get:function(){return this._rtpParameters}},{key:\"peer\",get:function(){return this._peer}},{key:\"appData\",get:function(){return this._appData}},{key:\"supported\",get:function(){return this._supported}},{key:\"transport\",get:function(){return this._transport}},{key:\"track\",get:function(){return this._track}},{key:\"locallyPaused\",get:function(){return this._locallyPaused}},{key:\"remotelyPaused\",get:function(){return this._remotelyPaused}},{key:\"paused\",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:\"preferredProfile\",get:function(){return this._preferredProfile}},{key:\"effectiveProfile\",get:function(){return this._effectiveProfile}}]),t}(p.default);t.default=_},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.RemotePlainRtpSdp=t.RemotePlanBSdp=t.RemoteUnifiedPlanSdp=t.sdpPlainRtpUtils=t.sdpPlanBUtils=t.sdpUnifiedPlanUtils=t.sdpCommonUtils=t.ortc=t.utils=t.EnhancedEventEmitter=t.Logger=void 0;var n=h(r(5)),i=h(r(11)),a=m(r(10)),o=m(r(16)),s=m(r(21)),c=m(r(36)),d=m(r(44)),u=m(r(217)),l=h(r(37)),p=h(r(45)),f=h(r(218));function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function h(e){return e&&e.__esModule?e:{default:e}}t.Logger=n.default,t.EnhancedEventEmitter=i.default,t.utils=a,t.ortc=o,t.sdpCommonUtils=s,t.sdpUnifiedPlanUtils=c,t.sdpPlanBUtils=d,t.sdpPlainRtpUtils=u,t.RemoteUnifiedPlanSdp=l.default,t.RemotePlanBSdp=p.default,t.RemotePlainRtpSdp=f.default},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.extractPlainRtpParametersByKind=function(e,t){var r=(e.media||[]).find((function(e){return e.type===t}));if(!r)throw new Error(\"m=\"+t+\" section not found\");return{ip:e.connection.ip,port:r.port}},t.fillRtpParametersForKind=function(e,t,r){var n={cname:null,reducedSize:!0,mux:!0},i=(t.media||[]).find((function(e){return e.type===r}));if(!i)throw new Error(\"m=\"+r+\" section not found\");var a=(i.ssrcs||[]).find((function(e){return\"cname\"===e.attribute})),o=void 0;a&&(o=a.id,n.cname=a.value);e.rtcp=n,e.encodings=[];var s={ssrc:o};e.encodings.push(s)}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(43)),i=f(r(9)),a=f(r(2)),o=f(r(3)),s=f(r(4)),c=f(r(0)),d=f(r(1)),u=f(r(13)),l=f(r(5)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default(\"RemotePlainRtpSdp\"),h=function(){function e(t){(0,c.default)(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:p.randomNumber(),version:0}}return(0,d.default)(e,[{key:\"setTransportLocalParameters\",value:function(e){m.debug(\"setTransportLocalParameters() [transportLocalParameters:%o]\",e),this._transportLocalParameters=e}},{key:\"setTransportRemoteParameters\",value:function(e){m.debug(\"setTransportRemoteParameters() [transportRemoteParameters:%o]\",e),this._transportRemoteParameters=e}}]),e}(),v=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:\"createAnswerSdp\",value:function(e){if(m.debug(\"createAnswerSdp()\"),!this._transportLocalParameters)throw new Error(\"no transport local parameters\");if(!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.plainRtpParameters,r={},a=(e.media||[]).filter((function(e){return e.hasOwnProperty(\"mid\")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},r.name=\"-\",r.timing={start:0,stop:0},r.msidSemantic={semantic:\"WMS\",token:\"*\"},a.length>0&&(r.groups=[{type:\"BUNDLE\",mids:a.join(\" \")}]),r.media=[];var o=!0,s=!1,c=void 0;try{for(var d,l=(0,i.default)(e.media||[]);!(o=(d=l.next()).done);o=!0){var p=d.value,f=\"inactive\"===p.direction,h=p.type,v=this._rtpParametersByKind[h].codecs,_=this._rtpParametersByKind[h].headerExtensions,g={};switch(g.type=p.type,g.port=t.port,g.protocol=\"RTP/AVP\",g.connection={ip:t.ip,version:t.version},g.mid=p.mid,p.direction){case\"sendrecv\":case\"sendonly\":g.direction=\"recvonly\";break;case\"recvonly\":case\"inactive\":g.direction=\"inactive\"}g.rtp=[],g.rtcpFb=[],g.fmtp=[];var y=!0,b=!1,I=void 0;try{for(var k,P=(0,i.default)(v);!(y=(k=P.next()).done);y=!0){var S=k.value,w={payload:S.payloadType,codec:S.name,rate:S.clockRate};if(S.channels>1&&(w.encoding=S.channels),g.rtp.push(w),S.parameters){var T={payload:S.payloadType,config:\"\"},A=!0,E=!1,R=void 0;try{for(var C,O=(0,i.default)((0,n.default)(S.parameters));!(A=(C=O.next()).done);A=!0){var N=C.value;T.config&&(T.config+=\";\"),T.config+=N+\"=\"+S.parameters[N]}}catch(e){E=!0,R=e}finally{try{!A&&O.return&&O.return()}finally{if(E)throw R}}T.config&&g.fmtp.push(T)}if(S.rtcpFeedback){var x=!0,L=!1,D=void 0;try{for(var M,B=(0,i.default)(S.rtcpFeedback);!(x=(M=B.next()).done);x=!0){var V=M.value;g.rtcpFb.push({payload:S.payloadType,type:V.type,subtype:V.parameter||\"\"})}}catch(e){L=!0,D=e}finally{try{!x&&B.return&&B.return()}finally{if(L)throw D}}}}}catch(e){b=!0,I=e}finally{try{!y&&P.return&&P.return()}finally{if(b)throw I}}if(g.payloads=v.map((function(e){return e.payloadType})).join(\" \"),!f){g.ext=[];var j=!0,F=!1,U=void 0;try{for(var G,H=function(){var e=G.value;if(!(p.ext||[]).find((function(t){return t.uri===e.uri})))return\"continue\";g.ext.push({uri:e.uri,value:e.id})},K=(0,i.default)(_);!(j=(G=K.next()).done);j=!0)H()}catch(e){F=!0,U=e}finally{try{!j&&K.return&&K.return()}finally{if(F)throw U}}}if(p.simulcast_03){g.simulcast_03={value:p.simulcast_03.value.replace(/send/g,\"recv\")},g.rids=[];var W=!0,z=!1,X=void 0;try{for(var q,Y=(0,i.default)(p.rids||[]);!(W=(q=Y.next()).done);W=!0){var J=q.value;\"send\"===J.direction&&g.rids.push({id:J.id,direction:\"recv\"})}}catch(e){z=!0,X=e}finally{try{!W&&Y.return&&Y.return()}finally{if(z)throw X}}}g.rtcpMux=\"rtcp-mux\",g.rtcpRsize=\"rtcp-rsize\",r.media.push(g)}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}return u.default.write(r)}}]),t}(h),_=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:\"createOfferSdp\",value:function(e){if(m.debug(\"createOfferSdp()\"),!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.plainRtpParameters,r={},a=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},r.name=\"-\",r.timing={start:0,stop:0},r.msidSemantic={semantic:\"WMS\",token:\"*\"},a.length>0&&(r.groups=[{type:\"BUNDLE\",mids:a.join(\" \")}]),r.media=[];var o=!0,s=!1,c=void 0;try{for(var d,l=(0,i.default)(e);!(o=(d=l.next()).done);o=!0){var p=d.value,f=p.closed,h=p.kind,v=this._rtpParametersByKind[h].codecs,_=this._rtpParametersByKind[h].headerExtensions,g={};g.type=h,g.mid=p.mid,g.msid=p.streamId+\" \"+p.trackId,g.port=t.port,g.protocol=\"RTP/AVP\",g.connection={ip:t.ip,version:t.version},g.direction=f?\"inactive\":\"sendonly\",g.rtp=[],g.rtcpFb=[],g.fmtp=[];var y=!0,b=!1,I=void 0;try{for(var k,P=(0,i.default)(v);!(y=(k=P.next()).done);y=!0){var S=k.value,w={payload:S.payloadType,codec:S.name,rate:S.clockRate};if(S.channels>1&&(w.encoding=S.channels),g.rtp.push(w),S.parameters){var T={payload:S.payloadType,config:\"\"},A=!0,E=!1,R=void 0;try{for(var C,O=(0,i.default)((0,n.default)(S.parameters));!(A=(C=O.next()).done);A=!0){var N=C.value;T.config&&(T.config+=\";\"),T.config+=N+\"=\"+S.parameters[N]}}catch(e){E=!0,R=e}finally{try{!A&&O.return&&O.return()}finally{if(E)throw R}}T.config&&g.fmtp.push(T)}if(S.rtcpFeedback){var x=!0,L=!1,D=void 0;try{for(var M,B=(0,i.default)(S.rtcpFeedback);!(x=(M=B.next()).done);x=!0){var V=M.value;g.rtcpFb.push({payload:S.payloadType,type:V.type,subtype:V.parameter||\"\"})}}catch(e){L=!0,D=e}finally{try{!x&&B.return&&B.return()}finally{if(L)throw D}}}}}catch(e){b=!0,I=e}finally{try{!y&&P.return&&P.return()}finally{if(b)throw I}}if(g.payloads=v.map((function(e){return e.payloadType})).join(\" \"),!f){g.ext=[];var j=!0,F=!1,U=void 0;try{for(var G,H=(0,i.default)(_);!(j=(G=H.next()).done);j=!0){var K=G.value;\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==K.uri&&g.ext.push({uri:K.uri,value:K.id})}}catch(e){F=!0,U=e}finally{try{!j&&H.return&&H.return()}finally{if(F)throw U}}}g.rtcpMux=\"rtcp-mux\",g.rtcpRsize=\"rtcp-rsize\",f||(g.ssrcs=[],g.ssrcGroups=[],g.ssrcs.push({id:p.ssrc,attribute:\"cname\",value:p.cname}),p.rtxSsrc&&(g.ssrcs.push({id:p.rtxSsrc,attribute:\"cname\",value:p.cname}),g.ssrcGroups.push({semantics:\"FID\",ssrcs:p.ssrc+\" \"+p.rtxSsrc}))),r.media.push(g)}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}return u.default.write(r)}}]),t}(h);t.default=function e(t,r){switch((0,c.default)(this,e),m.debug(\"constructor() [direction:%s, rtpParametersByKind:%o]\",t,r),t){case\"send\":return new v(r);case\"recv\":return new _(r)}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WebSocketTransport=t.Peer=void 0;var n=a(r(220)),i=a(r(118));function a(e){return e&&e.__esModule?e:{default:e}}t.Peer=n.default,t.WebSocketTransport=i.default},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=m(r(6)),i=m(r(8)),a=m(r(1)),o=m(r(2)),s=m(r(0)),c=m(r(3)),d=m(r(4)),u=r(30),l=m(r(31)),p=m(r(116)),f=m(r(118));function m(e){return e&&e.__esModule?e:{default:e}}var h=new l.default(\"protooPeer\"),v=function(e){function t(e,r){(0,s.default)(this,t);var n=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return n.cause=r,n.name=\"TimeoutError\",n}return(0,d.default)(t,e),t}(Error),_=function(e){function t(e,r,n){(0,s.default)(this,t),h.debug(\"constructor() protooUrl: \"+e);var a=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));a.setMaxListeners(1/0),a._sessionId=r,a._protooUrl=e;var d={retries:n||10,factor:2,minTimeout:1e3,maxTimeout:4e3};return a._transport=new f.default(e,{retry:d}),a._pingInterval=null,a._lastPongTick=0,a._closed=!1,a._connected=!1,a._data={},a._requestHandlers=new i.default,a._handleTransport(),a}return(0,d.default)(t,e),(0,a.default)(t,[{key:\"_startPingInterval\",value:function(){var e=this,t=new Date;this._lastPongTick=t.getTime(),this._stopPingInterval(),this._pingInterval=setInterval((function(){e.send(\"ping\",{appData:\"\"}).then((function(t){var r=new Date;e._lastPongTick=r.getTime()})).catch((function(t){var r=(new Date).getTime();\"TimeoutError\"===t.name&&r-e._lastPongTick>6e3&&(e._lastPongTick=r,h.debug(\"_pingInterval - some error occur: \"+t.name+\" \"+t.code+\" - curTS: \"+r+\" this._lastPongTick: \"+e._lastPongTick),setTimeout((function(){e._stopPingInterval(),e._transport.reconnect({code:4001,reason:\"Heartbeat timeout\"})})))}))}),2e3)}},{key:\"_stopPingInterval\",value:function(){this._pingInterval&&clearInterval(this._pingInterval),this._pingInterval=null}},{key:\"send\",value:function(e,t){var r=this;if(this.connected){var i=p.default.requestFactory(e,t);return this._transport.send(i).then((function(){return new n.default((function(e,t){var n={resolve:function(t){r._requestHandlers.delete(i.id)&&(n.timer&&clearTimeout(n.timer),n.timer=null,e(t))},reject:function(e){r._requestHandlers.delete(i.id)&&(n.timer&&clearTimeout(n.timer),n.timer=null,t(e))},timer:setTimeout((function(){r._requestHandlers.delete(i.id)&&(r.closed||(n.timer&&clearTimeout(n.timer),n.timer=null,t(new v(\"request timeout\"))))}),5e3),close:function(){n.timer&&clearTimeout(n.timer),n.timer=null}};r._requestHandlers.set(i.id,n)}))}))}}},{key:\"notify\",value:function(e,t){if(this.connected){var r=p.default.notificationFactory(e,t);return this._transport.send(r)}}},{key:\"close\",value:function(){h.debug(\"close()\"),this._closed||(this._stopPingInterval(),this._closed=!0,this._transport.close(),this._requestHandlers.forEach((function(e){return e.close()})),this.emit(\"close\",{code:1e3,reason:\"Normal close\",sid:this._sessionId}))}},{key:\"_handleTransport\",value:function(){var e=this;if(this._transport.closed)return this._closed=!0,void setTimeout((function(){e.emit(\"close\",{code:1e3,reason:\"Normal close\",sid:e._sessionId})}));this._transport.removeAllListeners(\"connecting\"),this._transport.on(\"connecting\",(function(t){e.emit(\"connecting\",{sid:e._sessionId,currentAttempt:t})})),this._transport.removeAllListeners(\"open\"),this._transport.on(\"open\",(function(t){e._closed||(e._connected=!0,e._startPingInterval(),e.emit(\"open\",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners(\"conn-reconn\"),this._transport.on(\"conn-reconn\",(function(t){e._closed||(e._connected=!0,e._startPingInterval(),e.emit(\"conn-reconn\",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners(\"conn-interrupt\"),this._transport.on(\"conn-interrupt\",(function(t){e._closed||(e._stopPingInterval(),e._connected=!1,e.emit(\"conn-interrupt\",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners(\"conn-error\"),this._transport.on(\"conn-error\",(function(t){e._closed||(e._stopPingInterval(),e.emit(\"conn-error\",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners(\"reinit\"),this._transport.on(\"reinit\",(function(t){e._closed||(e._connected=!0,e.emit(\"reinit\",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners(\"close\"),this._transport.on(\"close\",(function(t){e._closed||(e._stopPingInterval(),e._closed=!0,e._connected=!1,e.emit(\"close\",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners(\"message\"),this._transport.on(\"message\",(function(t){e.closed||(t.request?e._handleRequest(t):t.response?e._handleResponse(t):t.notification&&e._handleNotification(t))}))}},{key:\"_handleRequest\",value:function(e){var t=this;this.emit(\"request\",{sid:this._sessionId},e,(function(r){var n=p.default.successResponseFactory(e,r);t._transport.send(n).catch((function(e){h.warn(\"_handleRequest() accept() _transport.send error - \"+e.name+\" \"+e.message)}))}),(function(r,n){r instanceof Error?(n=r.toString(),r=500):\"number\"==typeof r&&n instanceof Error&&(n=n.toString());var i=p.default.errorResponseFactory(e,r,n);t._transport.send(i).catch((function(e){h.warn(\"_handleRequest() reject() error - \"+e.name+\" \"+e.message)}))}))}},{key:\"_handleResponse\",value:function(e){var t=this._requestHandlers.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else h.error(\"_handleResponse() received response does not match any sent request\")}},{key:\"_handleNotification\",value:function(e){this.emit(\"notification\",{sid:this._sessionId},e)}},{key:\"data\",get:function(){return this._data},set:function(e){this._data=e||{}}},{key:\"closed\",get:function(){return this._closed}},{key:\"connected\",get:function(){return this._connected}}]),t}(u.EventEmitter);t.default=_},function(e,t,r){var n;try{n=r(222)}catch(e){}finally{if(n||\"undefined\"==typeof window||(n=window),!n)throw new Error(\"Could not determine global this\")}var i=n.WebSocket||n.MozWebSocket,a=r(223);function o(e,t){return t?new i(e,t):new i(e)}i&&[\"CONNECTING\",\"OPEN\",\"CLOSING\",\"CLOSED\"].forEach((function(e){Object.defineProperty(o,e,{get:function(){return i[e]}})})),e.exports={w3cwebsocket:i?o:null,version:a}},function(e,t){var r=function(){if(\"object\"==typeof self&&self)return self;if(\"object\"==typeof window&&window)return window;throw new Error(\"Unable to resolve global `this`\")};e.exports=function(){if(this)return this;if(\"object\"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,\"__global__\",{get:function(){return this},configurable:!0})}catch(e){return r()}try{return __global__||r()}finally{delete Object.prototype.__global__}}()},function(e,t,r){e.exports=r(224).version},function(e){e.exports=JSON.parse('{\"name\":\"websocket\",\"description\":\"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.\",\"keywords\":[\"websocket\",\"websockets\",\"socket\",\"networking\",\"comet\",\"push\",\"RFC-6455\",\"realtime\",\"server\",\"client\"],\"author\":\"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)\",\"contributors\":[\"Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)\"],\"version\":\"1.0.31\",\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/theturtle32/WebSocket-Node.git\"},\"homepage\":\"https://github.com/theturtle32/WebSocket-Node\",\"engines\":{\"node\":\">=0.10.0\"},\"dependencies\":{\"debug\":\"^2.2.0\",\"es5-ext\":\"^0.10.50\",\"nan\":\"^2.14.0\",\"typedarray-to-buffer\":\"^3.1.5\",\"yaeti\":\"^0.0.6\"},\"devDependencies\":{\"buffer-equal\":\"^1.0.0\",\"faucet\":\"^0.0.1\",\"gulp\":\"^4.0.2\",\"gulp-jshint\":\"^2.0.4\",\"jshint-stylish\":\"^2.2.1\",\"jshint\":\"^2.0.0\",\"tape\":\"^4.9.1\"},\"config\":{\"verbose\":false},\"scripts\":{\"install\":\"(node-gyp rebuild 2> builderror.log) || (exit 0)\",\"test\":\"faucet test/unit\",\"gulp\":\"gulp\"},\"main\":\"index\",\"directories\":{\"lib\":\"./lib\"},\"browser\":\"lib/browser.js\",\"license\":\"Apache-2.0\",\"__npminstall_done\":\"Fri Feb 28 2020 14:40:09 GMT+0800 (GMT+08:00)\",\"_from\":\"websocket@1.0.31\",\"_resolved\":\"https://registry.npm.taobao.org/websocket/download/websocket-1.0.31.tgz\"}')},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=p(r(17)),i=p(r(8)),a=p(r(0)),o=p(r(1)),s=p(r(226)),c=p(r(31)),d=l(r(42)),u=l(r(53));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}var f=r(28),m=r(84),h=(0,s.default)({HEART_BEAT:\"event=sdkHeartbeat\",ENTER_FAIL:\"event=ENTER_FAIL\",ENTER_TIMEOUT:\"event=ENTER_TIMEOUT\"}),v=new c.default(\"Stats\"),_=function(){function e(){(0,a.default)(this,e),this._appId=\"\",this._roomId=\"\",this._sessionId=\"\",this._userId=\"\",this._connectionId=\"\",this._roleType=\"\",this._domain=\"\",this._signalReconnectTimes=0,this._netType=\"\",this._isMobile=!!f.mobile,this._outputAdjustVolume=1,this._micAdjustVolume=1,this._presetAudioBitrate=0,this._isAudioOpen=!1,this._isVideoOpen=!1,this._webrtcInternalSendStats=new i.default,this._webrtcInternalRecvStats=new Array,this._reportInterval=null,this._webrtcStats=[],this._audioRecvStats=new i.default,this._videoRecvStats=new i.default,this._audioSendStats=new i.default,this._videoSendStats=new i.default,this._sendRTT=0,this._recvRTT=0,this._upStatHelper=new i.default,this._summarizeUpLostHelper=new Array,this._summarizeDownLostHelper=new Array,this._summarize={rtt:0,networkType:\"\",upSpeed:0,upFractionLost:0,downSpeed:0,downFractionLost:0},this._cstat={peerId:\"\",appId:\"\",connectionId:\"\",roomId:\"\",consumer:\"\",stat:[]},this._streamSsrcPairs=new i.default,this.STATS_INTERVAL=4e3,this.STATS_INTERVAL_S=2e3,this._gwInfo={},this._iplocationInfo={},this.setNetworkType()}return(0,o.default)(e,[{key:\"stop\",value:function(){this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=null),this._webrtcInternalSendStats.clear(),this._webrtcInternalRecvStats.clear()}},{key:\"getAudioUpStat\",value:function(e){return this._audioSendStats?this._audioSendStats.get(e):null}},{key:\"getVideoUpStat\",value:function(e){return this._videoSendStats?this._videoSendStats.get(e):null}},{key:\"getAudioDownStat\",value:function(e){return this._audioRecvStats?this._audioRecvStats.get(e):null}},{key:\"getVideoDownStat\",value:function(e){return this._videoRecvStats?this._videoRecvStats.get(e):null}},{key:\"setStreamSSRCPairs\",value:function(e,t,r,n,i){var a={ssrc:Number(r),type:\"\"+t,active:\"\"+i,stream:n};this._streamSsrcPairs.set(e,a)}},{key:\"removeStreamById\",value:function(e){this._streamSsrcPairs.delete(e)}},{key:\"updateStreamSSRCPairs\",value:function(e,t){v.debug(\"updateStreamSSRCPairs - id: \"+e+\" ssrc: \"+t);var r=this._streamSsrcPairs.get(e);r&&(r.ssrc=Number(t))}},{key:\"actStreamSSRCPairs\",value:function(e,t){var r=this._streamSsrcPairs.get(e);r&&(r.active=t)}},{key:\"isActStreamSSRCPairs\",value:function(e){var t=this._streamSsrcPairs.get(e);return!!t&&t.active}},{key:\"getStreamPropertyBySSRC\",value:function(e,t){var r=\"\",n=!1,i=\"\";return this._streamSsrcPairs.forEach((function(a,o){!n&&a&&a.ssrc===Number(e)&&(r=o,i=a.stream[t],n=!0)})),{id:r,value:i}}},{key:\"setAppid\",value:function(e){this._appId=e,this._cstat.appId=e}},{key:\"setRoomId\",value:function(e){this._roomId=e,this._cstat.roomId=e}},{key:\"setSessionId\",value:function(e){this._sessionId=e}},{key:\"setUserId\",value:function(e){this._userId=e,this._cstat.peerId=e}},{key:\"setConnectionId\",value:function(e){this._connectionId=e,this._cstat.connectionId=e}},{key:\"setRoleType\",value:function(e){this._roleType=\"\"+e}},{key:\"setOutputAdjustVolume\",value:function(e){this._outputAdjustVolume=e}},{key:\"setMicAdjustVolume\",value:function(e){this._micAdjustVolume=e}},{key:\"setPresetAudioBitrate\",value:function(e){this._presetAudioBitrate=e}},{key:\"setSignalReconnectTimes\",value:function(e){this._signalReconnectTimes=e}},{key:\"setDomain\",value:function(e){this._domain=e}},{key:\"setGWInfo\",value:function(e){this._gwInfo=e[0]}},{key:\"setIPlocationInfo\",value:function(e){this._iplocationInfo=JSON.parse((0,n.default)(e))}},{key:\"setNetworkType\",value:function(){try{switch((navigator.connection||navigator.mozConnection||navigator.webkitConnection).type){case\"wifi\":this._netType=\"0\";break;case\"ethernet\":default:this._netType=\"4\"}}catch(e){}}},{key:\"_reportWebrtcStats\",value:function(){var e=this;if(this._webrtcInternalSendStats||this._webrtcInternalRecvStats){var t=0;this._webrtcInternalSendStats.forEach((function(e){Boolean(e)&&e.length>t&&(t=e.length)}));var r=this._webrtcInternalRecvStats.length,n=Math.min(Math.max(t,r),5);this._webrtcStats=[];for(var i=function(t){var r={};r.appId=\"\"+e._appId,r.roomId=\"\"+e._roomId,r.sessionId=\"\"+e._sessionId,r.userId=\"\"+e._userId,r.connectionId=\"\"+e._connectionId,r.roleType=\"\"+e._roleType,r.signalReconnectTimes=e._signalReconnectTimes,r.equipInfo={sdkVersion:m.version+\"_\"+m.buildDate,netType:\"\"+e._netType,equipModel:e._isMobile?\"web_mobile\":\"web\",inBackground:0,systemVersion:\"web\",publicVersion:\"3T_Web_SDK_V\"+m.version+\"_\"+m.buildDate},r.audioInfo={},r.audioInfo.A_SENT={},r.audioInfo.A_RECV=[],r.videoInfo={},r.videoInfo.V_SENT=[],r.videoInfo.V_RECV=[];var n=\"\",i=0,a=0;e._webrtcInternalSendStats.forEach((function(t){if(t&&t.item){var o=t.item.shift();if(o){o.connectionType&&o.connectionType.remote&&(n=o.connectionType.remote.ipAddress,i=o.connectionType.remote.portNumber),r.logTime=t.statTimeTick;var s=o.bandwidth.rtt;o.audio.ssrc.forEach((function(t){var n=t;if(o.audio&&o.audio[n]){var i=o.audio[n].upSpeedKBPS?o.audio[n].upSpeedKBPS:0;r.audioInfo.A_SENT.A_BR=parseInt(i,10),r.audioInfo.A_SENT.A_SSRC=n,r.audioInfo.A_SENT.A_RTT=s,r.audioInfo.A_SENT.A_MUTED=e._isAudioOpen?0:1;var a=o.audio[n].helper?o.audio[n].helper.fractionLost:0;r.audioInfo.A_SENT.A_FRACTIONLOST=parseFloat(a.toFixed(2)),r.audioInfo.A_SENT.A_RECV=0,r.audioInfo.A_SENT.A_SENT=o.audio[n].bytesSent?o.audio[n].bytesSent:0,r.audioInfo.A_SENT.A_RECONNECT={},r.audioInfo.A_SENT.A_LEVELSUM=1,r.audioInfo.A_SENT.A_PRELEVELSUM=1,r.audioInfo.A_SENT.A_MIC_VOL=e._micAdjustVolume,r.audioInfo.A_SENT.A_CAP_STAT=1,r.audioInfo.A_SENT.A_SPEAKING=1,r.audioInfo.A_SENT.A_BITRATE=e._presetAudioBitrate}})),o.video.ssrc.forEach((function(t){var n,i=t,c=e.getStreamPropertyBySSRC(i,\"streamId\"),d=c.id,u=c.value;if(e.isActStreamSSRCPairs(d)&&(n=u,o.video&&o.video[i])){r.videoInfo.V_SENT[a]={},r.videoInfo.V_SENT[a].DEVID=\"\"+n,r.videoInfo.V_SENT[a].V_SSRC=+i;var l=o.video[i].upSpeedKBPS?o.video[i].upSpeedKBPS:0;r.videoInfo.V_SENT[a].V_VBR=parseInt(l,10),r.videoInfo.V_SENT[a].V_FPS=15,r.videoInfo.V_SENT[a].V_SENDBYTES=o.video[i].bytesSent?o.video[i].bytesSent:0,r.videoInfo.V_SENT[a].V_SENDCOUNT=o.video[i].packetsSentTotal?o.video[i].packetsSentTotal:0;var p=o.video[i].helper?o.video[i].helper.fractionLost:0;r.videoInfo.V_SENT[a].V_SENDFRACTIONLOST=parseFloat(p.toFixed(2)),r.videoInfo.V_SENT[a].V_RTT=s,r.videoInfo.V_SENT[a].V_RECV=0,r.videoInfo.V_SENT[a].V_SEND=o.video[i].bytesSent?o.video[i].bytesSent:0,r.videoInfo.V_SENT[a].V_LOSS=0,r.videoInfo.V_SENT[a].V_RECONNECT={},r.videoInfo.V_SENT[a].V_MUTED=e._isVideoOpen?0:1,r.videoInfo.V_SENT[a].V_QP=36,r.videoInfo.V_SENT[a].V_SFPS=15,a++}}))}}}));var o=e._webrtcInternalRecvStats.shift();if(o){o.connectionType&&o.connectionType.remote&&(n=o.connectionType.remote.ipAddress,i=o.connectionType.remote.portNumber),r.logTime=o.statTimeTick;var s=0,c=0,d=o.bandwidth.rtt;o.audio.ssrc.forEach((function(t){var n=t,i=e.getStreamPropertyBySSRC(n,\"userId\"),a=i.id,s=i.value;if(e.isActStreamSSRCPairs(a)){var u=s;if(\"\"!==u&&o.audio&&o.audio[n]){r.audioInfo.A_RECV[c]={},r.audioInfo.A_RECV[c].RECVUID=u,r.audioInfo.A_RECV[c].A_SSRC=n;var l=o.audio[n].downSpeedKBPS?o.audio[n].downSpeedKBPS:0;r.audioInfo.A_RECV[c].A_RECVBR=parseInt(l,10),r.audioInfo.A_RECV[c].A_RECVBYTES=o.audio[n].bytesReceived;var p=parseInt(o.audio[n].packetsLost?o.audio[n].packetsLost:0,10),f=o.audio[n].helper?o.audio[n].helper.fractionLost:0;r.audioInfo.A_RECV[c].A_LOSTRATE=parseFloat(f.toFixed(2)),r.audioInfo.A_RECV[c].A_BUFFERDURATION=o.audio[n].jitterBufferMs,r.audioInfo.A_RECV[c].A_RECVFRACTIONLOST=parseFloat(f.toFixed(2)),r.audioInfo.A_RECV[c].A_RTT=d,r.audioInfo.A_RECV[c].A_DELAY=parseInt(o.audio[n].latency?o.audio[n].latency:0,10),r.audioInfo.A_RECV[c].A_AVJMS=0,r.audioInfo.A_RECV[c].A_MAXJMS=0,r.audioInfo.A_RECV[c].A_DISCARDEDPKTS=p,r.audioInfo.A_RECV[c].A_VOLUME=e._outputAdjustVolume,r.audioInfo.A_RECV[c].A_LEVELSUM=1,r.audioInfo.A_RECV[c].A_MUTE=0,c++}}})),o.video.ssrc.forEach((function(t){var n,i=t,a=e.getStreamPropertyBySSRC(i,\"userId\"),c=a.id,u=a.value;if(e.isActStreamSSRCPairs(c)&&\"\"!==(n=u)){var l,p=e.getStreamPropertyBySSRC(i,\"streamId\");p.id;if(l=p.value,o.video&&o.video[i]){r.videoInfo.V_RECV[s]={},r.videoInfo.V_RECV[s].RECVUID=\"\"+n,r.videoInfo.V_RECV[s].RECVID=\"\"+l,r.videoInfo.V_RECV[s].V_SSRC=+i,r.videoInfo.V_RECV[s].V_FPS=15;var f=o.video[i].recv.resolutions?o.video[i].recv.resolutions.width:0,m=o.video[i].recv.resolutions?o.video[i].recv.resolutions.height:0;r.videoInfo.V_RECV[s].V_WIDTH=f,r.videoInfo.V_RECV[s].V_HEIGHT=m;var h=o.video[i].downSpeedKBPS?o.video[i].downSpeedKBPS:0;r.videoInfo.V_RECV[s].V_RECVBR=parseInt(h,10),r.videoInfo.V_RECV[s].V_RECVBYTES=o.video[i].bytesReceived,r.videoInfo.V_RECV[s].V_RECVCOUNT=o.video[i].packetsReceivedTotal;var v=o.video[i].helper?o.video[i].helper.fractionLost:0;r.videoInfo.V_RECV[s].V_LOSTRATE=parseFloat(v.toFixed(2)),r.videoInfo.V_RECV[s].V_RTT=d,r.videoInfo.V_RECV[s].V_JITTER=o.video[i].jitterBufferMs,r.videoInfo.V_RECV[s].V_RECVFRAMECOUNT=o.video[i].framesDecoded;var _=o.video[i].latency?o.video[i].latency:0;r.videoInfo.V_RECV[s].V_DELAY=parseInt(_,10),r.videoInfo.V_RECV[s].V_FRACTIONLOST=parseFloat(v.toFixed(2)),r.videoInfo.V_RECV[s].V_MUTED=1,r.videoInfo.V_RECV[s].V_TARGETVBR=parseInt(h,10),s++}}}))}r.mediaServerInfo={aIp:n,audio_port:i,aSid:\"\",vIp:n,vPort:i,vSid:\"\"},e._webrtcStats.push(r)},a=0;a<n;a++)i();n>0&&this.pushLoggerToServer(h.HEART_BEAT,this._webrtcStats),Math.max(t,r)>5&&this._reportWebrtcStats()}}},{key:\"setWebrtcInternalSendStats\",value:function(e,t){var r=this,i=(new Date).getTime(),a=JSON.parse((0,n.default)(t));this._sendRTT=a.bandwidth?Number(a.bandwidth.rtt):0,this._summarize.rtt=this._sendRTT?this._sendRTT:0,this._summarize.networkType=a.connectionType.local.networkType;var o=0;a.audio&&a.audio.ssrc&&a.audio.ssrc.length>0&&(a.audio.ssrc.forEach((function(e,t){i-a.audio[e].statTS>3e3&&delete a.audio.ssrc[t]})),a.audio.ssrc=a.audio.ssrc.filter((function(e,t,r){return!!e})),a.audio.ssrc.forEach((function(e,t){var n=e;if(a.audio[n]){var s=\"\"+r._userId,c={};c.statTS=i,c.streamId=s,c.ssrc=n,c.timestamp=i,c.bitrate=a.audio[n].upSpeedKBPS?Number(a.audio[n].upSpeedKBPS):0,c.packetCount=a.audio[n].packetsSent?Number(a.audio[n].packetsSent):0,c.packetLost=a.audio[n].packetsLost?Number(a.audio[n].packetsLost):0;var d=c.packetCount>0?c.packetLost/c.packetCount:0;a.audio[n].helper||(a.audio[n].helper={},a.audio[n].helper.his=[]);var u=1,l=d>1?1:d;a.audio[n].helper.his.forEach((function(e){e&&(l+=e,u++)})),a.audio[n].helper.his.push(d),a.audio[n].helper.his.length>5&&a.audio[n].helper.his.shift();var p=l/u;a.audio[n].helper.fractionLost=p,c.fractionLost=p?parseFloat(p.toFixed(2)):0,c.rtt=r._sendRTT?Number(r._sendRTT):0,c.availableSendBandwidth=a.bandwidth.availableSendBandwidth,r._audioSendStats.set(s,c),o=c.fractionLost}})));var s=0;a.video&&a.video.ssrc&&a.video.ssrc.length>0&&(a.video.ssrc.forEach((function(e,t){i-a.video[e].statTS>3e3&&delete a.video.ssrc[t]})),a.video.ssrc=a.video.ssrc.filter((function(e,t,r){return!!e})),a.video.ssrc.forEach((function(e,t){var n=e,o=r.getStreamPropertyBySSRC(n,\"streamId\"),c=o.id,d=o.value;if(r.isActStreamSSRCPairs(c)&&Boolean(a.video[n])){var u=\"\"+d,l={};l.statTS=i,l.streamId=u,l.ssrc=n,l.timestamp=i,l.bitrate=a.video[n].upSpeedKBPS?Number(a.video[n].upSpeedKBPS):0,l.packetCount=a.video[n].packetsSent?Number(a.video[n].packetsSent):0,l.packetLost=a.video[n].packetsLost?Number(a.video[n].packetsLost):0;var p=l.packetCount>0?l.packetLost/l.packetCount:0;a.video[n].helper||(a.video[n].helper={},a.video[n].helper.his=[]);var f=1,m=p>1?1:p;a.video[n].helper.his.forEach((function(e){e&&(m+=e,f++)})),a.video[n].helper.his.push(p),a.video[n].helper.his.length>5&&a.video[n].helper.his.shift();var h=m/f;a.video[n].helper.fractionLost=h,l.fractionLost=h?parseFloat(h.toFixed(2)):0,l.rtt=r._sendRTT?Number(r._sendRTT):0,l.availableSendBandwidth=a.bandwidth.availableSendBandwidth,r._videoSendStats.set(u,l),s=l.fractionLost}})));var c=s>o?s:o,d=1,u=c;this._summarizeUpLostHelper.forEach((function(e){e&&(u+=e,d++)})),this._summarizeUpLostHelper.push(c),this._summarizeUpLostHelper.length>3&&this._summarizeUpLostHelper.shift();var l=a.bandwidth?Number(a.bandwidth.upSpeed):0,p=this._upStatHelper.get(e);if(p?(p.statTS=i,p.upSpeed=l,p.upFractionLost=u/d):this._upStatHelper.set(e,{statTS:i,upSpeed:l,upFractionLost:u/d}),this._webrtcInternalSendStats){a.statTimeTick=i;var f=this._webrtcInternalSendStats.get(e);f&&f.item||(f={item:new Array,statTimeTick:i},this._webrtcInternalSendStats.set(e,f)),Boolean(f)&&Boolean(f.item)&&f.item.push(a)}}},{key:\"setWebrtcInternalRecvStats\",value:function(e){var t=this,r=JSON.parse((0,n.default)(e));this._recvRTT=r.bandwidth?Number(r.bandwidth.rtt):0,this._summarize.rtt=this._recvRTT?this._recvRTT:0,this._summarize.downSpeed=r.bandwidth?Number(r.bandwidth.downSpeed):0,this._summarize.networkType=r.connectionType.local.networkType;var i=0,a=(new Date).getTime();r.audio&&r.audio.ssrc&&r.audio.ssrc.length>0&&(r.audio.ssrc.forEach((function(e,t){a-r.audio[e].statTS>3e3&&delete r.audio.ssrc[t]})),r.audio.ssrc=r.audio.ssrc.filter((function(e,t,r){return!!e})),r.audio.ssrc.forEach((function(e,n){var o=e,s=(t._streamSsrcPairs,t.getStreamPropertyBySSRC(o,\"userId\")),c=s.id,d=s.value;if(t.isActStreamSSRCPairs(c)&&Boolean(r.audio[o])){var u=\"\"+d,l={};l.statTS=a,l.streamId=u,l.ssrc=o,l.timestamp=a,l.bitrate=r.audio[o].downSpeedKBPS?Number(r.audio[o].downSpeedKBPS):0,l.packetCount=r.audio[o].packetsReceived?Number(r.audio[o].packetsReceived):0,l.packetLost=r.audio[o].packetsLost?Number(r.audio[o].packetsLost):0;var p=l.packetCount>0?l.packetLost/(l.packetCount+l.packetLost):0;r.audio[o].helper||(r.audio[o].helper={},r.audio[o].helper.his=[]);var f=1,m=p>1?1:p;r.audio[o].helper.his.forEach((function(e){e&&(m+=e,f++)})),r.audio[o].helper.his.push(p),r.audio[o].helper.his.length>5&&r.audio[o].helper.his.shift();var h=m/f;r.audio[o].helper.fractionLost=h,l.fractionLost=h?parseFloat(h.toFixed(2)):0,l.latency=r.audio[o].latency?Number(r.audio[o].latency):0,l.rtt=t._recvRTT?Number(t._recvRTT):0,l.availableRecvBandwidth=r.bandwidth.availableRecvBandwidth,t._audioRecvStats.set(u,l),i=l.fractionLost}})));var o=0;r.video&&r.video.ssrc&&r.video.ssrc.length>0&&(r.video.ssrc.forEach((function(e,t){a-r.video[e].statTS>3e3&&delete r.video.ssrc[t]})),r.video.ssrc=r.video.ssrc.filter((function(e,t,r){return!!e})),r.video.ssrc.forEach((function(e,n){var i=e,s=(t._streamSsrcPairs,t.getStreamPropertyBySSRC(i,\"streamId\")),c=s.id,d=s.value;if(t.isActStreamSSRCPairs(c)&&Boolean(r.video[i])){var u=\"\"+d,l={};l.statTS=a,l.streamId=u,l.ssrc=i,l.timestamp=a,l.bitrate=r.video[i].downSpeedKBPS?Number(r.video[i].downSpeedKBPS):0,l.packetCount=r.video[i].packetsReceived?Number(r.video[i].packetsReceived):0,l.packetLost=r.video[i].packetsLost?Number(r.video[i].packetsLost):0;var p=l.packetCount>0?l.packetLost/(l.packetCount+l.packetLost):0;r.video[i].helper||(r.video[i].helper={},r.video[i].helper.his=[]);var f=1,m=p>1?1:p;r.video[i].helper.his.forEach((function(e){e&&(m+=e,f++)})),r.video[i].helper.his.push(p),r.video[i].helper.his.length>5&&r.video[i].helper.his.shift();var h=m/f;r.video[i].helper.fractionLost=h,l.fractionLost=h?parseFloat(h.toFixed(2)):0,l.latency=r.video[i].latency?Number(r.video[i].latency):0,l.rtt=t._recvRTT?Number(t._recvRTT):0,l.availableRecvBandwidth=r.bandwidth.availableRecvBandwidth,t._videoRecvStats.set(u,l),o=l.fractionLost}})));var s=o>i?o:i,c=1,d=s;this._summarizeDownLostHelper.forEach((function(e){e&&(d+=e,c++)})),this._summarizeDownLostHelper.push(s),this._summarizeDownLostHelper.length>3&&this._summarizeDownLostHelper.shift(),this._summarize.downFractionLost=d/c,this._webrtcInternalRecvStats&&(r.statTimeTick=a,this._webrtcInternalRecvStats.push(r))}},{key:\"setConsumeStats\",value:function(e,t,r,n,i){this._cstat.consumer=n,this._cstat.stat=e,this._cstat.stat.forEach((function(e){\"video\"===e.kind&&\"outbound-rtp\"===e.type&&(e.resolution=t)})),this.consumerState(this._cstat)}},{key:\"startHeartBeat\",value:function(){var e=this;this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=null),this._reportInterval=setInterval((function(){e._reportWebrtcStats()}),1e4)}},{key:\"stopHeartBeat\",value:function(){this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=null)}},{key:\"pushLoggerToServer\",value:function(e,t){if(c.default.logSubmit){var r=\"\";r=e?e+\" \"+(0,n.default)(t):(0,n.default)(t),fetch(d.logserver_url,{method:\"POST\",mode:\"no-cors\",cache:\"no-cache\",headers:{\"Content-Type\":\"text/plain; charset=utf-8\"},redirect:\"follow\",referrer:\"no-referrer\",body:r}).catch((function(e){})).then((function(e){}))}}},{key:\"consumerState\",value:function(e){c.default.privateCloud||fetch(\"https://\"+this._domain+\"/stats/\",{method:\"POST\",mode:\"no-cors\",cache:\"no-cache\",headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\"},redirect:\"follow\",referrer:\"no-referrer\",body:(0,n.default)(e)}).catch((function(e){})).then((function(e){}))}},{key:\"sendTimeOutLog\",value:function(e){var t=e.timesOfLinkGW,r=e.linkGWTime,n=e.sendGWTime,i=e.sendEnterTime,a={glbId:u.uuid(),appId:this._appId,userId:this._userId,roomId:this._roomId,connectId:this._connectionId,os:\"WEB\",logTime:(new Date).toISOString().replace(/a-z/gi,\" \"),timesOfLinkIplocal:this._iplocationInfo.reconnectTimes,timesOfLinkGW:t,linkIplocalTime:this._iplocationInfo.connectedTime-this._iplocationInfo.firstConnectTime,sendIplocalTime:this._iplocationInfo.connectedTime,linkGWTime:r,sendGWTime:n,sendEnterTime:i,gwIp:this._gwInfo.sIp};this.pushLoggerToServer(h.ENTER_TIMEOUT,a)}},{key:\"sendFailLog\",value:function(e){var t=e.timesOfLinkGW,r=e.linkGWTime,n=e.sendGWTime,i=e.sendEnterTime,a=e.role,o=e.result,s={glbId:u.uuid(),appId:this._appId,userId:this._userId,roomId:this._roomId,connectId:this._connectionId,os:\"WEB\",role:a,result:o,logTime:(new Date).toISOString().replace(/a-z/gi,\" \"),timesOfLinkIplocal:this._iplocationInfo.reconnectTimes,timesOfLinkGW:t,linkIplocalTime:this._iplocationInfo.connectedTime-this._iplocationInfo.firstConnectTime,sendIplocalTime:this._iplocationInfo.connectedTime,linkGWTime:r,sendGWTime:n,sendEnterTime:i,innerDiff:0,totalDiff:0,gwIp:this._gwInfo.sIp};this.pushLoggerToServer(h.ENTER_FAIL,s)}},{key:\"audioUpStat\",get:function(){var e=this,t=(new Date).getTime();return this._audioSendStats.forEach((function(r,n){t-r.statTS>3e3&&e._audioSendStats.delete(n)})),this._audioSendStats}},{key:\"videoUpStat\",get:function(){var e=this,t=(new Date).getTime();return this._videoSendStats.forEach((function(r,n){t-r.statTS>3e3&&e._videoSendStats.delete(n)})),this._videoSendStats}},{key:\"audioDownStat\",get:function(){var e=this,t=(new Date).getTime();return this._audioRecvStats.forEach((function(r,n){t-r.statTS>3e3&&e._audioRecvStats.delete(n)})),this._audioRecvStats}},{key:\"videoDownStat\",get:function(){var e=this,t=(new Date).getTime();return this._videoRecvStats.forEach((function(r,n){t-r.statTS>3e3&&e._videoRecvStats.delete(n)})),this._videoRecvStats}},{key:\"summarize\",get:function(){var e=this,t=0,r=0,n=(new Date).getTime();return this._upStatHelper.forEach((function(i,a){n-i.statTS>2e3?e._upStatHelper.delete(a):(t+=i.upSpeed,r=r>i.upFractionLost?r:i.upFractionLost)})),this._summarize.upSpeed=t?Number(t):0,this._summarize.upFractionLost=r||0,this._summarize}},{key:\"audioOpen\",set:function(e){this._isAudioOpen=e}},{key:\"videoOpen\",set:function(e){this._isVideoOpen=e}}]),e}();t.default=_},function(e,t,r){e.exports={default:r(227),__esModule:!0}},function(e,t,r){r(228),e.exports=r(7).Object.freeze},function(e,t,r){var n=r(19),i=r(61).onFreeze;r(79)(\"freeze\",(function(e){return function(t){return e&&n(t)?e(i(t)):t}}))},function(e,t,r){\"use strict\";(function(n){var i,a=c(r(26)),o=c(r(43)),s=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var d=1e3,u=function(e,t,r,i){var c,u=\"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45\";(c=void 0!==n?n:null)&&\"undefined\"==typeof window&&void 0!==n&&(n.navigator={userAgent:u,getUserMedia:function(){}},n.console||(n.console={}),void 0!==n.console.log&&void 0!==n.console.error||(n.console.error=n.console.log=n.console.log||function(){console.log(arguments)}),\"undefined\"==typeof document&&(c.document={documentElement:{appendChild:function(){return\"\"}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return\"\"}};return e},c.HTMLVideoElement=function(){}),\"undefined\"==typeof location&&(c.location={protocol:\"file:\",href:\"\",hash:\"\"}),\"undefined\"==typeof screen&&(c.screen={width:0,height:0}),\"undefined\"==typeof URL&&(c.URL={createObjectURL:function(){return\"\"},revokeObjectURL:function(){return\"\"}}),\"undefined\"==typeof MediaStreamTrack&&(c.MediaStreamTrack=function(){}),void 0===l&&(c.RTCPeerConnection=function(){}),c.window=n);var l=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;\"undefined\"==typeof MediaStreamTrack&&(MediaStreamTrack={});var p=((navigator.connection||{}).type||\"unknown\").toString().toLowerCase(),f={isSafari:!1,encryption:\"sha-256\",audio:{ssrc:[]},video:{ssrc:[]},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{prevBytesReceived:0,prevBytesSent:0},upSpeed:0,downSpeed:0,rtt:0},connectionType:{systemNetworkType:p,local:{candidateType:\"\",transport:\"\",ipAddress:\"\",portNumber:\"\",networkType:\"\"},remote:{candidateType:\"\",transport:\"\",ipAddress:\"\",portNumber:\"\"}},internal:{activeConnection:{localCandidate:\"\",remoteCandidate:\"\"},audio:{},video:{}},nomore:function(){_=!0}};console.log(\"getStatsResult: \"+(0,s.default)(f));var m={checkIfOfferer:function(e){\"googLibjingleSession\"===e.type&&(f.isOfferer=e.googInitiator)}},h=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);f.isSafari=h;var v=this;if(!(arguments[0]instanceof l))throw\"1st argument is not instance of RTCPeerConnection.\";v=arguments[0],arguments[1]instanceof MediaStreamTrack&&(e=arguments[1],t=arguments[2],r=arguments[3]),+r<1e3&&(r=1e3),d=r;var _=!1;function g(){y((function(e){if(e&&e.forEach){e.forEach((function(e){\"function\"==typeof m.candidatePair&&m.candidatePair(e)})),e.forEach((function(e){(0,o.default)(m).forEach((function(t){if(\"candidatePair\"!==t&&\"function\"==typeof m[t])try{e.tttdir=i,m[t](e)}catch(e){console.warn(e.message,e.stack,e)}}))}));try{-1!==v.iceConnectionState.search(/failed|closed|disconnected/gi)&&(_=!0)}catch(e){_=!0}!0===_&&(f.datachannel&&(f.datachannel.state=\"close\"),f.ended=!0),f.audio.ssrc.forEach((function(e){})),f.video.ssrc.forEach((function(e){})),t(f),_||null!=(void 0===r?\"undefined\":(0,a.default)(r))&&r&&setTimeout(g,r||1e3)}}))}function y(e){void 0!==window.InstallTrigger||h?v.getStats(window.mediaStreamTrack||null).then((function(t){var r=[];t.forEach((function(e){r.push(e)})),e(r)})).catch(e):v.getStats((function(t){var r=[];t.result().forEach((function(e){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)})),e(r)}))}m.datachannel=function(e){\"datachannel\"===e.type&&(f.datachannel={state:e.state})},m.googCertificate=function(e){\"googCertificate\"==e.type&&(f.encryption=e.googFingerprintAlgorithm),\"certificate\"==e.type&&(f.encryption=e.fingerprintAlgorithm)},m.checkAudioTracks=function(e){if(\"ssrc\"===e.type&&\"audio\"===e.mediaType){var t=e.ssrc,r=e.id.split(\"_\").pop();if(!0===e.isRemote?r=\"recv\":!1===e.isRemote&&(r=\"send\"),r){-1===f.audio.ssrc.indexOf(\"\"+t)&&f.audio.ssrc.push(\"\"+t),f.audio[t]||(f.audio[t]={},f.audio[t][r]={},f.audio[t][r].codecs=[],f.audio[t][r].tracks=[]),e.googCodecName&&\"\"!==e.googCodecName&&-1===f.audio[t][r].codecs.indexOf(e.googCodecName)&&f.audio[t][r].codecs.push(e.googCodecName);var n=(new Date).getTime();f.audio[t].statTS=n,f.internal.audio[t]||(f.internal.audio[t]={}),f.internal.audio[t][r]||(f.internal.audio[t][r]={});var i=0,a=0;\"send\"===r&&void 0!==e.bytesSent&&(f.internal.audio[t][r].prevBytesSent||(f.internal.audio[t][r].prevBytesSent=0),i=e.bytesSent-f.internal.audio[t][r].prevBytesSent,f.internal.audio[t][r].prevBytesSent=e.bytesSent,(a=8*i/1024)>1e3&&(a=1e3),f.audio[t][r].availableBandwidth=parseInt(a,10),f.audio[t].upSpeedKBPS=parseInt(a,10),f.audio[t].bytesSent=e.bytesSent),\"recv\"===r&&void 0!==e.bytesReceived&&(f.internal.audio[t][r].prevBytesReceived||(f.internal.audio[t][r].prevBytesReceived=0),i=e.bytesReceived-f.internal.audio[t][r].prevBytesReceived,f.internal.audio[t][r].prevBytesReceived=e.bytesReceived,(a=8*i/1024)>1e3&&(a=1e3),f.audio[t].downSpeedKBPS=parseInt(a,10),f.audio[t].bytesReceived=e.bytesReceived),void 0!==e.googJitterBufferMs&&(f.audio[t].jitterBufferMs=e.googJitterBufferMs),e.googTrackId&&-1===f.audio[t][r].tracks.indexOf(e.googTrackId)&&f.audio[t][r].tracks.push(e.googTrackId),void 0!==e.googCurrentDelayMs&&(f.internal.audio[t].googCurrentDelayMs=e.googCurrentDelayMs,f.audio[t].latency=parseInt(e.googCurrentDelayMs,10),f.audio[t].latency<0&&(f.audio[t].latency=0));var o=0;if(\"recv\"===r&&void 0!==e.packetsReceived&&(f.internal.audio[t].prevPacketsReceived||(f.internal.audio[t].prevPacketsReceived=0),o=e.packetsReceived-f.internal.audio[t].prevPacketsReceived,f.internal.audio[t].prevPacketsReceived=e.packetsReceived,f.audio[t].packetsReceived=parseInt(o,10),f.audio[t].packetsReceivedTotal=e.packetsReceived,f.audio[t].packetsReceived<0&&(f.audio[t].packetsReceived=0)),\"send\"===r&&void 0!==e.packetsSent&&(f.internal.audio[t].prevPacketsSent||(f.internal.audio[t].prevPacketsSent=0),o=e.packetsSent-f.internal.audio[t].prevPacketsSent,f.internal.audio[t].prevPacketsSent=e.packetsSent,f.audio[t].packetsSent=parseInt(o,10),f.audio[t].packetsSentTotal=e.packetsSent,f.audio[t].packetsSent<0&&(f.audio[t].packetsSent=0)),void 0!==e.packetsLost){f.internal.audio[t].prevPacketsLost||(f.internal.audio[t].prevPacketsLost=0);var s=e.packetsLost-f.internal.audio[t].prevPacketsLost;f.internal.audio[t].prevPacketsLost=e.packetsLost,f.audio[t].packetsLost=parseInt(s,10),f.audio[t].packetsLost<0&&(f.audio[t].packetsLost=0)}}}},m.checkVideoTracks=function(e){if(\"ssrc\"===e.type&&\"video\"===e.mediaType){var t=e.ssrc,r=e.id.split(\"_\").pop();if(!0===e.isRemote?r=\"recv\":!1===e.isRemote&&(r=\"send\"),r){-1===f.video.ssrc.indexOf(\"\"+t)&&f.video.ssrc.push(\"\"+t),f.video[t]||(f.video[t]={},f.video[t][r]={},f.video[t][r].codecs=[],f.video[t][r].tracks=[],f.video[t][r].resolutions={}),-1===f.video[t][r].codecs.indexOf(e.googCodecName||\"VP8\")&&f.video[t][r].codecs.push(e.googCodecName||\"VP8\");var n=(new Date).getTime();f.video[t].statTS=n,f.internal.video[t]||(f.internal.video[t]={},f.internal.video[t][r]={}),f.internal.video[t][r]||(f.internal.video[t][r]={});var i=0,a=0;\"send\"===r&&void 0!==e.bytesSent&&(f.internal.video[t][r].prevBytesSent||(f.internal.video[t][r].prevBytesSent=0),i=e.bytesSent-f.internal.video[t][r].prevBytesSent,f.internal.video[t][r].prevBytesSent=e.bytesSent,(a=8*i/1024)>8e3&&(a=8e3),f.video[t][r].availableBandwidth=parseInt(a,10),f.video[t].upSpeedKBPS=parseInt(a,10),f.video[t].bytesSent=e.bytesSent),\"recv\"===r&&void 0!==e.bytesReceived&&(f.internal.video[t][r].prevBytesReceived||(f.internal.video[t][r].prevBytesReceived=0),i=e.bytesReceived-f.internal.video[t][r].prevBytesReceived,f.internal.video[t][r].prevBytesReceived=e.bytesReceived,(a=8*i/1024)>8e3&&(a=8e3),f.video[t].downSpeedKBPS=parseInt(a,10),f.video[t].bytesReceived=e.bytesReceived),void 0!==e.framesDecoded&&(f.video[t].framesDecoded=e.framesDecoded),void 0!==e.googJitterBufferMs&&(f.video[t].jitterBufferMs=e.googJitterBufferMs),e.googFrameHeightReceived&&e.googFrameWidthReceived&&(f.video[t][r].resolutions.width=e.googFrameWidthReceived,f.video[t][r].resolutions.height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(f.video[t][r].resolutions.width=e.googFrameWidthSent,f.video[t][r].resolutions.height=e.googFrameHeightSent),e.googTrackId&&-1===f.video[t][r].tracks.indexOf(e.googTrackId)&&f.video[t][r].tracks.push(e.googTrackId),void 0!==e.googCurrentDelayMs&&(f.internal.video[t].googCurrentDelayMs=e.googCurrentDelayMs,f.video[t].latency=Boolean(e.googCurrentDelayMs)?parseInt(e.googCurrentDelayMs,10):0,f.video[t].latency<0&&(f.video[t].latency=0));var o=0;if(\"recv\"===r&&void 0!==e.packetsReceived&&(f.internal.video[t].prevPacketsReceived||(f.internal.video[t].prevPacketsReceived=0),o=e.packetsReceived-f.internal.video[t].prevPacketsReceived,f.internal.video[t].prevPacketsReceived=e.packetsReceived,f.video[t].packetsReceived=parseInt(o,10),f.video[t].packetsReceivedTotal=e.packetsReceived,f.video[t].packetsReceived<0&&(f.video[t].packetsReceived=0)),\"send\"===r&&void 0!==e.packetsSent&&(f.internal.video[t].prevPacketsSent||(f.internal.video[t].prevPacketsSent=0),o=e.packetsSent-f.internal.video[t].prevPacketsSent,f.internal.video[t].prevPacketsSent=e.packetsSent,f.video[t].packetsSent=parseInt(o,10),f.video[t].packetsSentTotal=e.packetsSent,f.video[t].packetsSent<0&&(f.video[t].packetsSent=0)),void 0!==e.packetsLost){f.internal.video[t].prevPacketsLost||(f.internal.video[t].prevPacketsLost=0);var s=e.packetsLost-f.internal.video[t].prevPacketsLost;f.internal.video[t].prevPacketsLost=e.packetsLost,f.video[t].packetsLost=parseInt(s,10),f.video[t].packetsLost<0&&(f.video[t].packetsLost=0)}}}},m.bweforvideo=function(e){\"VideoBwe\"===e.type&&(f.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,f.bandwidth.availableRecvBandwidth=e.googAvailableReceiveBandwidth,f.bandwidth.googActualEncBitrate=e.googActualEncBitrate,f.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,f.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,f.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,f.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,f.bandwidth.googBucketDelay=e.googBucketDelay,f.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},m.candidatePair=function(e){if(\"googCandidatePair\"===e.type||\"candidate-pair\"===e.type||\"local-candidate\"===e.type||\"remote-candidate\"===e.type)if(h){if(\"candidate-pair\"!==e.type||!0!==e.nominated||\"succeeded\"!==e.state)return;var t=\"\";if(\"recv\"===e.tttdir?t=\"recv\":\"send\"===e.tttdir&&(t=\"send\"),f.internal.activeConnection.remoteCandidate=e.remoteCandidateId,f.internal.activeConnection.localCandidate=e.localCandidateId,f.bandwidth.rtt=1e3*e.currentRoundTripTime,\"send\"===t&&void 0!==e.bytesSent){var r=1e3*(e.bytesSent-f.bandwidth.helper.prevBytesSent)*8/d;f.bandwidth.helper.prevBytesSent=e.bytesSent,r=r>0?r/1024:0,f.bandwidth.upSpeed=parseInt(r,10)}else if(\"recv\"===t&&void 0!==e.bytesReceived){var n=1e3*(e.bytesReceived-f.bandwidth.helper.prevBytesReceived)*8/d;f.bandwidth.helper.prevBytesReceived=e.bytesReceived,n=n>0?n/1024:0,f.bandwidth.downSpeed=parseInt(n,10)}\"send\"===t&&void 0!==e.availableOutgoingBitrate?f.bandwidth.availableSendBandwidth=e.availableOutgoingBitrate:\"recv\"===t&&void 0!==e.availableIncomingBitrate&&(f.bandwidth.availableRecvBandwidth=e.availableIncomingBitrate)}else if(\"true\"==e.googActiveConnection){f.internal.activeConnection.remoteCandidate=e.remoteCandidateId,f.internal.activeConnection.localCandidate=e.localCandidateId,f.connectionType.transport=e.googTransportType,f.bandwidth.rtt=e.googRtt;var i=1e3*(e.bytesReceived-f.bandwidth.helper.prevBytesReceived)*8/d,a=1e3*(e.bytesSent-f.bandwidth.helper.prevBytesSent)*8/d;f.bandwidth.helper.prevBytesReceived=e.bytesReceived,f.bandwidth.helper.prevBytesSent=e.bytesSent,a=a>0?a/1024:0,i=i>0?i/1024:0,f.bandwidth.upSpeed=parseInt(a,10),f.bandwidth.downSpeed=parseInt(i,10)}},m.localcandidate=function(e){if((\"localcandidate\"===e.type||\"local-candidate\"===e.type)&&e.id){var t={candidateType:e.candidateType,ipAddress:e.ipAddress,portNumber:e.portNumber,networkType:e.networkType,priority:e.priority,transport:e.transport,timestamp:e.timestamp,id:e.id,type:e.type};t.id===f.internal.activeConnection.localCandidate&&(f.connectionType.local.candidateType=t.candidateType,f.connectionType.local.ipAddress=t.ipAddress,f.connectionType.local.portNumber=t.portNumber,f.connectionType.local.networkType=t.networkType,f.connectionType.local.transport=t.transport)}},m.remotecandidate=function(e){if((\"remotecandidate\"===e.type||\"remote-candidate\"===e.type)&&e.id){var t={candidateType:e.candidateType,ipAddress:e.ipAddress,portNumber:e.portNumber,networkType:e.networkType,priority:e.priority,transport:e.transport,timestamp:e.timestamp,id:e.id,type:e.type};t.id===f.internal.activeConnection.remoteCandidate&&(f.connectionType.remote.candidateType=t.candidateType,f.connectionType.remote.ipAddress=t.ipAddress,f.connectionType.remote.portNumber=t.portNumber,f.connectionType.remote.transport=t.transport)}},m.inboundrtp=function(e){if(h&&\"inbound-rtp\"===e.type){var t=e.mediaType||\"\";0;var r=e.ssrc;-1===f[t].ssrc.indexOf(\"\"+r)&&f[t].ssrc.push(\"\"+r),f[t][r]||(f[t][r]={},f[t][r].recv={},f[t][r].recv.resolutions={});var n=(new Date).getTime();if(f[t][r].statTS=n,f.internal[t][r]||(f.internal[t][r]={},f.internal[t][r].recv={}),f.internal[t][r].recv||(f.internal[t][r].recv={}),void 0!==e.bytesReceived){var i=0;f.internal[t][r].recv.prevBytesReceived||(f.internal[t][r].recv.prevBytesReceived=0);var a=e.bytesReceived-f.internal[t][r].recv.prevBytesReceived;f.internal[t][r].recv.prevBytesReceived=e.bytesReceived,(i=8*a/1024)>8e3&&(i=8e3),f[t][r].downSpeedKBPS=parseInt(i,10),f[t][r].bytesReceived=e.bytesReceived}void 0!==e.framesDecoded&&(f[t][r].framesDecoded=e.framesDecoded),void 0!==e.jitter&&(f[t][r].jitterBufferMs=e.jitter,f.internal[t][r].jitter=e.jitter,f[t][r].latency=Boolean(e.jitter)?parseInt(e.jitter,10):0,f[t][r].latency+=Number(f.bandwidth.rtt),f[t][r].latency<0&&(f[t][r].latency=0)),void 0!==e.trackId&&(f[t][r].trackId=e.trackId);var o=0;if(void 0!==e.packetsReceived&&(f.internal[t][r].prevPacketsReceived||(f.internal[t][r].prevPacketsReceived=0),o=e.packetsReceived-f.internal[t][r].prevPacketsReceived,f.internal[t][r].prevPacketsReceived=e.packetsReceived,f[t][r].packetsReceived=parseInt(o,10),f[t][r].packetsReceivedTotal=e.packetsReceived,f[t][r].packetsReceived<0&&(f[t][r].packetsReceived=0)),void 0!==e.packetsLost){f.internal[t][r].prevPacketsLost||(f.internal[t][r].prevPacketsLost=0);var s=e.packetsLost-f.internal[t][r].prevPacketsLost;f.internal[t][r].prevPacketsLost=e.packetsLost,f[t][r].packetsLost=parseInt(s,10),f[t][r].packetsLost<0&&(f[t][r].packetsLost=0)}}},m.outboundrtp=function(e){if(h&&\"outbound-rtp\"===e.type){var t=e.mediaType||\"\";0;var r=e.ssrc;-1===f[t].ssrc.indexOf(\"\"+r)&&f[t].ssrc.push(\"\"+r),f[t][r]||(f[t][r]={},f[t][r].send={},f[t][r].send.resolutions={});var n=(new Date).getTime();if(f[t][r].statTS=n,f.internal[t][r]||(f.internal[t][r]={},f.internal[t][r].send={}),f.internal[t][r].send||(f.internal[t][r].send={}),void 0!==e.bytesSent){var i=0;f.internal[t][r].send.prevBytesSent||(f.internal[t][r].send.prevBytesSent=0);var a=e.bytesSent-f.internal[t][r].send.prevBytesSent;f.internal[t][r].send.prevBytesSent=e.bytesSent,(i=8*a/1024)>8e3&&(i=8e3),f[t][r].send.availableBandwidth=parseInt(i,10),f[t][r].upSpeedKBPS=parseInt(i,10),f[t][r].bytesSent=e.bytesSent}var o=0;if(void 0!==e.packetsSent&&(f.internal[t][r].prevPacketsSent||(f.internal[t][r].prevPacketsSent=0),o=e.packetsSent-f.internal[t][r].prevPacketsSent,f.internal[t][r].prevPacketsSent=e.packetsSent,f[t][r].packetsSent=parseInt(o,10),f[t][r].packetsSentTotal=e.packetsSent,f[t][r].packetsSent<0&&(f[t][r].packetsSent=0)),void 0!==e.packetsLost){f.internal[t][r].prevPacketsLost||(f.internal[t][r].prevPacketsLost=0);var s=e.packetsLost-f.internal[t][r].prevPacketsLost;f.internal[t][r].prevPacketsLost=e.packetsLost,f[t][r].packetsLost=parseInt(s,10),f[t][r].packetsLost<0&&(f[t][r].packetsLost=0)}}},m.track=function(e){if(h&&\"track\"===e.type&&void 0!==e.frameHeight&&void 0!==e.frameWidth){var t=!0===e.remoteSource?\"send\":\"recv\";f.video.ssrc.forEach((function(r){var n=r;f.video[n]&&f.video[n].trackId===e.id&&(f.video[n][t]||(f.video[n][t]={},f.video[n][t].resolutions={}),f.video[n][t].resolutions||(f.video[n][t].resolutions={}),f.video[n][t].resolutions.width=e.frameWidth,f.video[n][t].resolutions.height=e.frameHeight)}))}};var b={audio:{send:[],recv:[]},video:{send:[],recv:[]}};m.ssrc=function(e){if(e.googCodecName&&(\"video\"===e.mediaType||\"audio\"===e.mediaType)&&\"ssrc\"===e.type){var t=e.id.split(\"_\").pop();-1===b[e.mediaType][t].indexOf(e.ssrc)&&b[e.mediaType][t].push(e.ssrc)}},g()};e.exports=u,void 0===(i=function(){return u}.apply(t,[]))||(e.exports=i)}).call(this,r(38))}])}));\n//# sourceMappingURL=tttwebsdk.js.map\n\n//# sourceURL=webpack:///./lib/tttwebsdk.js?");

/***/ }),

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/*! exports provided: name, version, description, main, scripts, author, license, dependencies, devDependencies, default */
/***/ (function(module) {

eval("module.exports = JSON.parse(\"{\\\"name\\\":\\\"tttwebsdkdemo\\\",\\\"version\\\":\\\"1.1.2\\\",\\\"description\\\":\\\"\\\",\\\"main\\\":\\\"index.js\\\",\\\"scripts\\\":{\\\"test\\\":\\\"webpack-dev-server --open\\\",\\\"host\\\":\\\"webpack-dev-server --https --host=0.0.0.0 --open --watch --inline --mode=development\\\",\\\"build:test\\\":\\\"webpack --config webpack.config.js\\\",\\\"build:wrap\\\":\\\"webpack --config webpack.wrap.config.js\\\",\\\"build:test:av_screen_cdn\\\":\\\"webpack --config webpack.test.av_screen_cdn.config.js\\\"},\\\"author\\\":\\\"\\\",\\\"license\\\":\\\"ISC\\\",\\\"dependencies\\\":{\\\"tttwebsdk\\\":\\\"^3.4.7\\\"},\\\"devDependencies\\\":{\\\"webpack\\\":\\\"^4.41.0\\\",\\\"webpack-cli\\\":\\\"^3.3.9\\\",\\\"webpack-dev-server\\\":\\\"^3.1.14\\\",\\\"webpack-jquery-ui\\\":\\\"^2.0.1\\\"}}\");\n\n//# sourceURL=webpack:///./package.json?");

/***/ }),

/***/ "./src/js/websdkdemo.js":
/*!******************************!*\
  !*** ./src/js/websdkdemo.js ***!
  \******************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/tttwebsdk */ \"./lib/tttwebsdk.js\");\n/* harmony import */ var _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0__);\n // import from local tttwebsdk.js\n// import TTTRtcWeb from 'tttwebsdk'; // npm install tttwebsdk@latest\n\n// \n//TTTRtcWeb.setPrivate(true);\n//TTTRtcWeb.setIpLocationAddress('xxx.xxx.cn');\n//TTTRtcWeb.setIpLocationPort(8443);\n// TTTRtcWeb.setIpLocationAddress('v1.jkim.ccb.com');\n// TTTRtcWeb.setServerUrl('114_115_172_21.3ttech.cn'); \n// TTTRtcWeb.setServerUrl('v7.jkim.ccb.com');\n// TTTRtcWeb.setServerUrl('gzeduservice.3ttech.cn');\n// TTTRtcWeb.setLogSubmit(false);\n// TTTRtcWeb.setServerUrl('xiaoyao1.3ttech.cn');\n// TTTRtcWeb.setServerUrl('114_115_172_21.3ttech.cn'); \n// TTTRtcWeb.setServerUrl('webmedia3.3ttech.cn'); \n\nconst pkg = __webpack_require__(/*! ../../package.json */ \"./package.json\");\nconst demoVersion = pkg.version;\n\nconst sdkVersion = _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.getVersion();\nconst isSupp = _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.isSystemSupported();\n\n\ndocument.getElementById('sysVersion').innerHTML = `ver: ${demoVersion} - ${sdkVersion} -- isSupp: ${isSupp}`;\n\n// \nlet RTCObj = new _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a();\nlet client = null;\nlet streams = new Map();\n\nlet gScreenCDNStream = null; // this.publishScreen() 所使用的 stream\nlet gStream = null;\nlet gScreenStream = null;\nlet gMediaSourceStream = null;\n\nlet intv = null;\n\nlet remote_stream = new Map();\n\n// const stream_net_info = document.getElementById('stream_net_info');\nconst text_info = document.getElementById('text_info');\n\nlet sourceMediaStream;\n\nconst videoSelect = document.getElementById(\"cameraDev\");\nconst audioInputSelect = document.getElementById('micDev');\nconst audioOutputSelect = document.getElementById('speakerDev');\nconst userRoleSelect = document.getElementById('userRole');\n\nlet cameraDevId = 'default';\nlet micDevId = 'default';\nlet speakerDevId = 'default';\nlet audioProfile = 'default';\nlet audioCodec = 'isac';\n\nlet xAppID = 'a967ac491e3acf92eed5e1b5ba641ab7';\nconst appIdSelect = document.getElementById('appID');\nif (!!appIdSelect)\n{\n\tappIdSelect.addEventListener('change', () =>\n\t{\n\t\tlet index = appIdSelect.selectedIndex;\n\t\txAppID = appIdSelect.options[index].value;\n\t})\n}\n\n// \nlet userId = 0;\nif (!!window.localStorage)\n{\n\tuserId = window.localStorage.getItem('tttUserId');\n}\n\nif (!userId || !(parseInt(userId, 10)))\n{\n\tconst rSeed = (Math.random() * 100000000);\n\tuserId = Math.floor(rSeed) + 1;\n\n\twindow.localStorage.setItem('tttUserId', userId);\n}\n\nconst userIdEle = document.getElementById('userid');\nif (!!userIdEle)\n{\n\tuserIdEle.value = userId;\n}\n\nconst roomIdEle = document.getElementById('chanid');\n\nconst rtmpUrlEle = document.getElementById('rtmpUrl');\n// \nlet videoEle = document.getElementById('video');\nlet screenEle = document.getElementById('screen');\nlet screenRecEle = document.getElementById('screenRec');\n\nlet audioVolumeProgressEle = document.getElementById('audioVolumeProgress');\nlet audioVolumeValueEle = document.getElementById('audioVolumeValue');\n// \nlet userRole = 2;\n\n// \nlet tttStatus = 0;\n\n// \n// url: https://...../?auto=1&r=666777&u=111111&h=webmedia4.3ttech.cn\nlet xRoomId = getQueryVariable('r');\nif (!!xRoomId)\n{\n\troomIdEle.value = xRoomId;\n}\n\nlet xUserId = getQueryVariable('u');\nif (!!xUserId)\n{\n\tuserIdEle.value = xUserId;\n}\n\nlet xAppId = 'a967ac491e3acf92eed5e1b5ba641ab7'; // test900572e02867fab8131651339518\nlet xSpecMic = getQueryVariable('m');\nlet xSpecServer = getQueryVariable('h');\nlet xSpecIploc = getQueryVariable('l');\nlet xSpecIplocPort = getQueryVariable('p');\n// \nif (!!xSpecIploc)\n{\n\tif (xSpecIploc !== '')\n\t{\n\t\t_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.setPrivate(true);\n\t\t_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.setIpLocationAddress(xSpecIploc);\n\t}\n}\n// \nif (!!xSpecIplocPort)\n{\n\tconst port = parseInt(xSpecIplocPort, 10);\n\tif (!!port)\n\t{\n\t\t_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.setIpLocationPort(port);\n\t}\n}\n\nfunction getQueryVariable(variable)\n{\n\tvar query = window.location.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++)\n\t{\n\t\tvar pair = vars[i].split('=');\n\t\tif (pair[0] == variable)\n\t\t{\n\t\t\treturn pair[1];\n\t\t}\n\t}\n\treturn (false);\n}\n\n// 登录\nlet joinChanEle = document.getElementById('joinChan');\nif (!!joinChanEle)\n{\n\tjoinChanEle.addEventListener('click', () =>\n\t{\n\t\tlet appId = xAppID;\n\t\tlet rid = roomIdEle.value;\n\t\tlet uid = userIdEle.value;\n\t\tjoinChan(appId, rid, uid);\n\t})\n}\n\nfunction joinChan(appid, chanid, userid)\n{\n\t// \n\tif (tttStatus === 1)\n\t{\n\t\ttext_info.value = text_info.value + '已在房间内，无需重复登录' + '\\n';\n\n\t\treturn;\n\t}\n\n\t// \n\tif (!!xSpecServer)\n\t{\n\t\tif (xSpecServer !== '')\n\t\t{\n\t\t\t_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.setServerUrl(xSpecServer);\n\t\t}\n\t}\n\n\t// \n\t_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.setLogSubmit(true);\n\n\t// \n\t\n\tconst cdnUrl = (!!rtmpUrlEle) ? rtmpUrlEle.value : '';\n\tclient = RTCObj.createClient({\n\t\trole: userRole,\n\t\trtmpUrl: cdnUrl,\n\t\tvideoMixerBGIUrl: 'http://3ttech.cn/res/tpl/default/images/black.jpg',\n\t\taudioCodec\n\t});\n\n\tclient.init(appid, userid, () =>\n\t{\n\t\tclient.join('', chanid, () =>\n\t\t{\n\t\t\ttext_info.value = `<demo> 成功加入房间!! userid: ${userid}` + '\\n';\n\t\t\tconsole.log(`<demo> 成功加入房间!! userid: ${userid}`);\n\n\t\t\tdocument.getElementById('loginStatus').innerHTML = `<font color=\"green\">登录成功</font>`;\n\t\t\tdocument.getElementById('loginInfo').innerHTML = `-- role: ${userRole}<br>`;\n\n\n\t\t\ttttStatus = 1; // 状态标注为: 登录成功\n\t\t\t// \n\t\t\tintv = setInterval(() =>\n\t\t\t{\n\t\t\t\t_printStats();\n\t\t\t\t// for \n\t\t\t}, 2000);\n\t\t}, (err) =>\n\t\t{\n\t\t\ttttStatus = 0;\n\n\t\t\ttext_info.value = text_info.value + `<demo> login fail - ${err}` + '\\n';\n\t\t\tconsole.log(`<demo> login fail - ${err}`);\n\n\t\t\tdocument.getElementById('loginStatus').innerHTML = '<font color=\"red\">登录失败</font>';\n\t\t\tdocument.getElementById('loginInfo').innerHTML = '';\n\t\t});\n\t}, (err) =>\n\t{\n\t\ttext_info.value = text_info.value + `<demo> init fail - ${err}` + '\\n';\n\t\tconsole.log(`<demo> init fail - ${err}`);\n\n\t\treturn;\n\t});\n\n\tclient.on('device-hot-plug', (e) =>\n\t{\n\t\tconsole.log(`<demo> - event [device-hot-plug] - ${JSON.stringify(e)}`);\n\t})\n\n\tclient.on('connection-state-change', (evt) =>\n\t{\n\t\tconsole.log(`<demo> - event [connection-state-change] - ${JSON.stringify(evt)}`);\n\t});\n\n\tclient.on('disconnected', (e) =>\n\t{\n\t\ttttStatus = 0;\n\n\t\tconsole.log('<demo> - event [disconnected]');\n\n\t\t_onClose();\n\t});\n\n\tclient.on('kickout', (evt) =>\n\t{\n\t\ttttStatus = 0;\n\n\t\tconsole.log(`<demo> - event [kickout] ${JSON.stringify(evt)}`);\n\n\t\t_onClose();\n\t});\n\n\tclient.on('peer-join', (evt) =>\n\t{\n\t\tconsole.log(`<demo> - event [peer-join] uid: ${evt.userID}`);\n\t});\n\n\tclient.on('peer-leave', (evt) =>\n\t{\n\t\tconsole.log(`<demo> - event [peer-leave] uid: ${evt.userID}`);\n\n\t\tevt.streams.forEach(stream =>\n\t\t{\n\t\t\tif (!stream)\n\t\t\t\treturn;\n\n\t\t\tlet obj = document.getElementById('3t_remote' + stream.getId());\n\t\t\tif (obj)\n\t\t\t{\n\t\t\t\tobj.remove();\n\t\t\t}\n\n\t\t\t// remove stream from map\n\t\t\tremote_stream.delete(stream.getId());\n\n\t\t\tstream.close();\n\t\t});\n\t});\n\n\tclient.on('rtmp-success', (evt) =>\n\t{\n\t\tconsole.log(`<demo> - event [rtmp-success] - ${JSON.stringify(evt)}`);\n\t});\n\n\tclient.on('onTokenPrivilegeWillExpire', (evt) =>\n\t{\n\t\tconsole.log(`<demo> - event [onTokenPrivilegeWillExpire] - ${JSON.stringify(evt)}`);\n\t});\n\n\tclient.on('stream-published', (evt) =>\n\t{\n\t\tconst { stream } = evt;\n\t\tconsole.log(`<demo> - event [stream-published] - streamId: ${ !stream ? 'invalide-stream' : stream.getId() }`);\n\t});\n\n\tclient.on('stream-unpublished', (evt) =>\n\t{\n\t\tconst { stream } = evt;\n\t\tconsole.log(`<demo> - event [stream-unpublished] - streamId: ${ !stream ? 'invalide-stream' : stream.getId() }`);\n\t});\n\n\tclient.on('screen-published', (evt) =>\n\t{\n\t\tconst { stream } = evt;\n\t\tconsole.log(`<demo> - event [screen-published] - streamId: ${ !stream ? 'invalide-stream' : stream.getId() }`);\n\t});\n\n\tclient.on('screen-unpublished', (evt) =>\n\t{\n\t\tconst { stream } = evt;\n\t\tconsole.log(`<demo> - event [screen-unpublished] - streamId: ${ !stream ? 'invalide-stream' : stream.getId() }`);\n\t});\n\n\tclient.on('audio-added', (evt) =>\n\t{\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\tconsole.log(`<demo> - event [audio-added] streamId: ${evt.stream.getId()}`);\n\n\t\tremote_stream.set(stream.getId(), stream);\n\t\t\n\t\tlet in_stream = remote_stream.get(stream.getId());\n\t\tclient.subscribe(in_stream, (event) =>\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe audio ${evt.stream.getId()} succ` + '\\n';\n\t\t\t// successful doing someting, like play remote video or audio.\n\t\t}, (err) =>\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe audio ${evt.stream.getId()} fail - ${err}` + '\\n';\n\t\t\t// info.val(info.val() + 'Subscribe stream failed' + err + '\\n');\n\t\t});\n\t});\n\n\tclient.on('audio-removed', (evt) =>\n\t{\n\t\tconst streamId = evt.streamId;\n\n\t\tconsole.log(`<demo> - event [audio-removed] streamId: ${streamId}`);\n\t});\n\n\tclient.on('video-added', (evt) =>\n\t{\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\tconsole.log(`<demo> - event [video-added] streamId: ${stream.getId()} videoType: ${stream.videoType}`);\n\n\t\tremote_stream.set(stream.getId(), stream);\n\t\t// \n\t\tlet in_stream = remote_stream.get(stream.getId());\n\t\tclient.subscribe(in_stream, (event) =>\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe video ${evt.stream.getId()} succ` + '\\n';\n\t\t\t// successful doing someting, like play remote video or audio.\n\t\t}, (err) =>\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe video ${evt.stream.getId()} fail - ${err}` + '\\n';\n\t\t\t// info.val(info.val() + 'Subscribe stream failed' + err + '\\n');\n\t\t});\n\n\t\t// \n\t\tsetLiveMixerLayout();\n\t})\n\n\tclient.on('video-removed', (evt) =>\n\t{\n\t\tconst { streamId, stream } = evt;\n\n\t\tconsole.log(`<demo> - event [video-removed] streamId: ${streamId} videoType: ${stream.videoType}`);\n\n\t\t/*\n\t\tlet in_stream = remote_stream.get(streamId);\n\t\tif (!!in_stream)\n\t\t\tin_stream.close();\n\t\t// \n\n\t\t// remove stream from map\n\t\tremote_stream.delete(streamId);\n\t\t*/\n\n\t\t// \n\t\tlet obj = document.getElementById('3t_remote' + streamId);\n\t\tif (obj)\n\t\t{\n\t\t\tobj.remove();\n\t\t}\n\t})\n\n\tclient.on('video-update', (evt) =>\n\t{\n\t\tconst { userId, streamId, videoType } = evt;\n\n\t\tconsole.log(`<demo> - event [video-update] userId: ${userId} streamId: ${streamId} videoType: ${videoType}`);\n\t})\n\n\tclient.on('stream-subscribed', (evt) =>\n\t{\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\tconsole.log(`<demo> - event [stream-subscribed] streamId: ${stream.getId()} stream.videoType: ${stream.videoType}`);\n\n\t\tif (stream.hasAudio())\n\t\t{\n\t\t\tstream.on('volume-change', e =>\n\t\t\t{\n\t\t\t\t; // console.log(`<AUDIO-VOLUME> - volume-change -- userID: ${e.userID} volume: ${e.volume}`);\n\t\t\t});\n\t\t\t\n\t\t\tstream.play();\n\t\t}\n\n\t\tif (stream.hasVideo())\n\t\t{\n\t\t\tvar videoId = '3t_remote' + stream.getId();\n\t\t\tif (!!videoEle && !document.getElementById(videoId))\n\t\t\t{\n\t\t\t\tlet video = document.createElement('video');\n\t\t\t\tvideo.id = videoId;\n\t\t\t\tvideo.muted = false;\n\t\t\t\tvideo.autoplay = true;\n\t\t\t\tvideo.controls = true;\n\t\t\t\tvideo.setAttribute('playsinline', '');\n\t\t\t\tvideo.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;';\n\t\t\t\tvideoEle.append(video);\n\t\t\t}\n\n\t\t\tstream.play('3t_remote' + stream.getId(), true);\n\t\t}\n\t});\n\n\tclient.on('stream-unsubscribed', (evt) =>\n\t{\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\tconsole.log(`<demo> - event [stream-unsubscribed] streamId: ${stream.getId()} stream.videoType: ${stream.videoType}`);\n\t});\n\n\tclient.on('video-mute', (evt) =>\n\t{\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\tconsole.log(`<demo> - event [video-mute] streamId: ${stream.getId()}`);\n\n\t\tstream._video.style.backgroundColor = 'transparent';\n\t\t// stream._video.srcObject = null;\n\t\tstream._video.poster = 'https://www.3ttech.cn/res/tpl/default/img/logo-white.png';\n\n\t\t// visibility: hidden\n\n\t});\n\n\tclient.on('video-unmute', (evt) =>\n\t{\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\tconsole.log(`<demo> - event [video-unmute] streamId: ${stream.getId()}`);\n\n\t\tstream._video.style.backgroundColor = '#000';\n\t\tstream._video.srcObject = stream._streamObj;\n\t\tstream._video.poster = '';\n\t});\n\n\tclient.on('audio-mute', (evt) =>\n\t{\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\tconsole.log(`<demo> - event [audio-mute] streamId: ${stream.getId()}`);\n\t});\n\t\n\tclient.on('audio-unmute', (evt) =>\n\t{\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\tconsole.log(`<demo> - event [audio-unmute] streamId: ${stream.getId()}`);\n\t});\n}\n\nfunction _printStats()\n{\n\t// stream_net_info.value = `${JSON.stringify(client.getNetState())}`;\n\t// \n\tconst rAudioStats = client.remoteAudioStats();\n\trAudioStats.forEach((value, key) =>\n\t{\n\t\t; // console.log(`<demo> <STAT> audioDownStat -- streamId: ${key} ${JSON.stringify(value)}`);\n\t});\n\n\t// \n\tconst rVideoStats = client.remoteVideoStats();\n\trVideoStats.forEach((value, key) =>\n\t{\n\t\t; // console.log(`<demo> <STAT> videoDownStat -- streamId: ${key} ${JSON.stringify(value)}`);\n\t});\n\n\t// \n\tconst lAudioStats = client.localAudioStats();\n\tlAudioStats.forEach((value, key) =>\n\t{\n\t\t; // console.log(`<demo> <STAT> audioUpStat -- streamId: ${key} ${JSON.stringify(value)}`);\n\t});\n\n\t// \n\tconst lVideoStats = client.localVideoStats();\n\tlVideoStats.forEach((value, key) =>\n\t{\n\t\t; // console.log(`<demo> <STAT> videoUpStat -- streamId: ${key} ${JSON.stringify(value)}`);\n\t});\n\n\t// \n\tconst rtcStats = client.getStats();\n\t; // console.log(`<demo> <STAT> rtcStats -- ${JSON.stringify(rtcStats)}`);\n\n\t// for volume\n\tif (!!gStream)\n\t{\n\t\tconst vol = gStream.getAudioLevel();\n\t\t;// console.log(`<demo> <AUDIO-VOLUME> - local audio: ${vol}`);\n\n\t\t// \n\t\tremote_stream.forEach((item) =>\n\t\t{\n\t\t\tif (!!item)\n\t\t\t{\n\t\t\t\t// \n\t\t\t\tconst rVol = item.getAudioLevel();\n\t\t\t\t;// console.log(`<demo> <AUDIO-VOLUME> - remote audio: ${rVol}`);\n\t\t\t}\n\t\t});\n\t}\n}\n\n// 退出\nlet leaveChanEle = document.getElementById('leaveChan');\nif (!!leaveChanEle)\n{\n\tleaveChanEle.addEventListener('click', () =>\n\t{\n\t\tleaveChan();\n\t})\n}\n\nfunction leaveChan()\n{\n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + 'leaveChan while tttStatus is not 1?' + '\\n';\n\t\treturn;\n\t}\n\n\t_onClose();\n\n\tif (client)\n\t{\n\t\tclient.leave(() => { }, () => { });\n\t\tclient.close();\n\t}\n\n\ttext_info.value = text_info.value + 'leaveChan OK' + '\\n';\n}\n\n// 设置 RTMP 推流 URL\nlet setRtmpUrlEle = document.getElementById('setRtmpUrl');\nif (!!setRtmpUrlEle)\n{\n\tsetRtmpUrlEle.addEventListener('click', () =>\n\t{\n\t\tif (!!rtmpUrlEle)\n\t\t{\n\t\t\tconst cdnUrl = rtmpUrlEle.value;\n\t\t\tsetRtmpUrl(cdnUrl);\n\t\t}\n\t})\n}\n\nfunction setRtmpUrl(url)\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> setRtmpUrl - 请先[加入房间]' + '\\n';\n\n\t\treturn;\n\t}\n\n\tif (!client)\n\t{\n\t\treturn;\n\t}\n\n\t// \n\tconst pureAudioEle = document.getElementById('pureAudio');\n\n\tclient.setRtmpUrl({ url, avMode: pureAudioEle.checked ? 'audio' : 'av' });\n}\n\nfunction _onClose()\n{\n\t// \n\tremote_stream.forEach((item) =>\n\t{\n\t\tif (!!item)\n\t\t{\n\t\t\t// \n\t\t\tlet obj = document.getElementById('3t_remote' + item.getId());\n\t\t\tif (obj)\n\t\t\t{\n\t\t\t\tobj.remove();\n\t\t\t}\n\t\t\t// \n\t\t\titem.close();\n\t\t}\n\t});\n\tremote_stream.clear();\n\n\t// \n\tunpublishVideoStream({});\n\tunpublishScreenStream({});\n\tunpublishScreenCDNStream({});\n\tunpublishMediaSourceStream({});\n\n\t// \n\tif (intv !== null)\n\t{\n\t\tclearInterval(intv);\n\t\tintv = null;\n\t}\n\n\t// \n\t{\n\t\tlet obj = document.getElementById('3t_local_screen');\n\t\tif (obj)\n\t\t{\n\t\t\tobj.remove();\n\t\t}\n\n\t\t// \n\t\tif (!!gScreenStream)\n\t\t{\n\t\t\tstreams.delete(gScreenStream.getId());\n\n\t\t\tgScreenStream.close();\n\t\t\tgScreenStream = null;\n\t\t}\n\t}\n\n\t// \n\t{\n\t\tlet obj = document.getElementById('3t_local');\n\t\tif (obj)\n\t\t{\n\t\t\tobj.remove();\n\t\t}\n\n\t\t// \n\t\tif (!!gStream)\n\t\t{\n\t\t\tstreams.delete(gStream.getId());\n\n\t\t\tgStream.close();\n\t\t\tgStream = null;\n\t\t}\n\t}\n\t// \n\n\ttttStatus = 0;\n\n\t// \n\tdocument.getElementById('loginStatus').innerHTML = '<font color=\"red\">未登录</font>';\n\tdocument.getElementById('loginInfo').innerHTML = '';\n}\n\nconst splitWnd1 = [{ x: 0, y: 0 }];\nconst splitWnd4 = [{ x: 0, y: 0 }, { x: 0.5, y: 0 }, { x: 0, y: 0.5 }, { x: 0.5, y: 0.5 }];\nconst splitWnd9 = [{ x: 0, y: 0 }, { x: 0.33, y: 0 }, { x: 0.66, y: 0 }, { x: 0, y: 0.33 }, { x: 0.33, y: 0.33 }, { x: 0.66, y: 0.33 }, { x: 0, y: 0.66 }, { x: 0.33, y: 0.66 }, { x: 0.66, y: 0.66 }];\n\nfunction setLiveMixerLayout()\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> setLiveMixerLayout - 请先[加入房间]' + '\\n';\n\n\t\treturn;\n\t}\n\n\tif (!client)\n\t{\n\t\treturn;\n\t}\n\n\t// \n\tlet liveMixerLayout = {\n\t\tbackgroundColor: 0x000000,\n\t\twidth: 640,\n\t\theight: 360,\n\t\tusers: []\n\t}\n\n\tlet nCnt = remote_stream.size;\n\n\tif (!!gStream)\n\t{\n\t\tnCnt++;\n\t}\n\n\tif (!!gScreenStream)\n\t{\n\t\tnCnt++;\n\t}\n\n\tif (!!gScreenCDNStream)\n\t{\n\t\tnCnt++;\n\t}\n\n\tlet wh = 1;\n\tlet splitWnd = [];\n\tif (nCnt <= 1)\n\t{\n\t\twh = 1;\n\t\tsplitWnd = splitWnd1;\n\t}\n\telse if (nCnt <= 4)\n\t{\n\t\twh = 0.5\n\t\tsplitWnd = splitWnd4;\n\t}\n\telse if (nCnt <= 9)\n\t{\n\t\twh = 0.33\n\t\tsplitWnd = splitWnd9;\n\t}\n\telse\n\t\t; // TODO : \n\n\tlet nIndex = 0;\n\tif (!!gStream)\n\t{\n\t\tlet user = {};\n\n\t\tuser.userId = gStream.userId;\n\t\tuser.streamId = gStream.getId();\n\t\tuser.x = splitWnd[nIndex].x;\n\t\tuser.y = splitWnd[nIndex].y;\n\t\tuser.w = wh;\n\t\tuser.h = wh;\n\t\tuser.z = 0;\n\t\tuser.renderMode = 'scale';\n\n\t\tliveMixerLayout.users.push(user);\n\n\t\tnIndex++;\n\t}\n\n\tif (!!gScreenStream)\n\t{\n\t\tlet user = {};\n\n\t\tuser.userId = gScreenStream.userId;\n\t\tuser.streamId = gScreenStream.getId();\n\t\tuser.x = splitWnd[nIndex].x;\n\t\tuser.y = splitWnd[nIndex].y;\n\t\tuser.w = wh;\n\t\tuser.h = wh;\n\t\tuser.z = 0;\n\t\tuser.renderMode = 'scale';\n\n\t\tliveMixerLayout.users.push(user);\n\n\t\tnIndex++;\n\t}\n\n\tif (!!gScreenCDNStream)\n\t{\n\t\tlet user = {};\n\n\t\tuser.userId = gScreenCDNStream.userId;\n\t\tuser.streamId = `${userId}:screen`;\n\t\tuser.x = splitWnd[nIndex].x;\n\t\tuser.y = splitWnd[nIndex].y;\n\t\tuser.w = wh;\n\t\tuser.h = wh;\n\t\tuser.z = 0;\n\t\tuser.renderMode = 'scale';\n\n\t\tliveMixerLayout.users.push(user);\n\n\t\tnIndex++;\n\t}\n\n\t// \n\tif (!!remote_stream)\n\t{\n\t\tremote_stream.forEach((item) =>\n\t\t{\n\t\t\tif (Boolean(item))\n\t\t\t{\n\t\t\t\tlet user = {};\n\t\t\t\t// \n\t\t\t\tuser.userId = item.userId;\n\t\t\t\tuser.streamId = item.getId();\n\t\t\t\tuser.x = splitWnd[nIndex].x;\n\t\t\t\tuser.y = splitWnd[nIndex].y;\n\t\t\t\tuser.w = wh;\n\t\t\t\tuser.h = wh;\n\t\t\t\tuser.z = 0;\n\t\t\t\tuser.renderMode = 'scale';\n\n\t\t\t\tliveMixerLayout.users.push(user);\n\n\t\t\t\tnIndex++;\n\t\t\t}\n\t\t});\n\t}\n\n\ttext_info.value = text_info.value + `<demo> setLiveMixerLayout ...liveMixerLayout: ${JSON.stringify(liveMixerLayout)}` + '\\n';\n\n\tclient.setLiveMixerLayout(liveMixerLayout, () => { }, () => { });\n}\n\nfunction setVideoProfile(prof)\n{\n\tif (gStream === null)\n\t{\n\t\treturn;\n\t}\n\n\t// set video profile\n\tgStream.setVideoProfile(prof, (msg) =>\n\t{\n\t\ttext_info.value = text_info.value + `<demo> setVideoProfile - gStream.setVideoProfile succ. ${prof}` + '\\n';\n\t\tconsole.log(`<demo> setVideoProfile - gStream.setVideoProfile succ: ${prof}`);\n\t}, (e) =>\n\t{\n\t\ttext_info.value = text_info.value + `<demo> setVideoProfile - gStream.setVideoProfile fail - ${e}` + '\\n';\n\t\tconsole.log('<demo> setVideoProfile - gStream.setVideoProfile - error: ' + e);\n\t});\n}\n\n//\n/******************* for previewLocal */\n//\nlet previewLocalEle = document.getElementById('previewLocal');\nif (!!previewLocalEle)\n{\n\tpreviewLocalEle.addEventListener('click', () =>\n\t{\n\t\tpreviewLocalStream({\n\t\t\tuserid: userIdEle.value\n\t\t});\n\t})\n}\n\nfunction previewLocalStream(opts)\n{\n\tif (RTCObj === null)\n\t{\n\t\tRTCObj = new _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a();\n\t}\n\n\tconst {\n\t\tuserid\n\t} = opts;\n\n\tif (gStream === null)\n\t{\n\t\tlet resolutionEle = document.getElementById('resolution');\n\t\tlet specRes = (!!resolutionEle) ? resolutionEle.value : '480p';\n\t\tlet resolution = specRes;\n\n\t\tlet codecOptions = undefined;\n\t\tlet videoBitrate = 0;\n\t\tconst videoBitrateEle = document.getElementById('videoBitrate');\n\t\tif (!!videoBitrateEle)\n\t\t{\n\t\t\tvideoBitrate = videoBitrateEle.value;\n\t\t}\n\t\tvideoBitrate = +videoBitrate;\n\t\tif (videoBitrate > 0)\n\t\t{\n\t\t\tif (videoBitrate < 150)\n\t\t\t\tvideoBitrate = 150;\n\n\t\t\tcodecOptions = {\n\t\t\t\tstartBitrate: videoBitrate / 2,\n\t\t\t\tmaxBitrate: videoBitrate,\n\t\t\t\tminBitrate: 20\n\t\t\t};\n\t\t}\n\n\t\tconsole.log(`<demo> previewLocalStream() userid: ${userid} cameraDevId: ${cameraDevId} micDevId: ${micDevId} resolution: ${resolution}`);\n\n\t\tgStream = RTCObj.createStream({\n\t\t\tuserId: +userid,\n\t\t\taudio: true,\n\t\t\tvideo: true,\n\t\t\tcameraId: cameraDevId === 'default' ? null : cameraDevId,\n\t\t\tmicrophoneId: micDevId === 'default' ? null : micDevId,\n\t\t\tattributes: { videoProfile: resolution },\n\t\t\tcodecOptions,\n\t\t\topenAudioCtx: true\n\t\t});\n\n\t\tif (!gStream)\n\t\t\treturn;\n\n\t\t// \n\t\tif (audioProfile !== 'default')\n\t\t{\n\t\t\tgStream.setAudioProfile(audioProfile);\n\t\t}\n\n\t\tgStream.init(() =>\n\t\t{\n\t\t\t{\n\t\t\t\tconst videoId = '3t_local';\n\t\t\t\tlet videoE = document.createElement('video');\n\t\t\t\tvideoE.id = videoId;\n\t\t\t\tvideoE.muted = true;\n\t\t\t\tvideoE.autoplay = true;\n\t\t\t\tvideoE.controls = true;\n\t\t\t\tvideoE.setAttribute('playsinline', '');\n\t\t\t\tvideoE.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;'\n\n\t\t\t\tif (!!videoEle)\n\t\t\t\t{\n\t\t\t\t\tvideoEle.append(videoE);\n\t\t\t\t}\n\n\t\t\t\tgStream.play(videoId, true);\n\t\t\t}\n\t\t\t// \n\n\t\t\tstreams.set(gStream.getId(), gStream);\n\t\t\t// \n\t\t}, (evt) =>\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> previewLocalStream - Stream.init fail - ${evt}` + '\\n';\n\t\t\tconsole.log(`<demo> previewLocalStream - Stream.init fail - ${evt}`);\n\t\t});\n\t}\n\telse\n\t{\n\t\tconst videoId = '3t_local';\n\t\tgStream.play(videoId, true);\n\t}\n}\n\n//\n/******************* for Audio/Video Stream */\n//\nlet publishAudioStreamEle = document.getElementById('publishAudioStream');\nif (!!publishAudioStreamEle)\n{\n\tpublishAudioStreamEle.addEventListener('click', () =>\n\t{\n\t\tpublishStream({\n\t\t\tuserid: userIdEle.value,\n\t\t\taudio: true,\n\t\t\tvideo: false\n\t\t});\n\t})\n}\n\n// \nlet publishStreamEle = document.getElementById('publishStream');\nif (!!publishStreamEle)\n{\n\tpublishStreamEle.addEventListener('click', () =>\n\t{\n\t\tpublishStream({\n\t\t\tuserid: userIdEle.value,\n\t\t\taudio: true,\n\t\t\tvideo: true\n\t\t});\n\t})\n}\n\nlet unpublishStreamEle = document.getElementById('unpublishStream');\nif (!!unpublishStreamEle)\n{\n\tunpublishStreamEle.addEventListener('click', () =>\n\t{\n\t\tunpublishVideoStream({});\n\t})\n}\n\n// \nfunction publishStream(opts)\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> publishStream - 请先[加入房间]' + '\\n';\n\t\treturn;\n\t}\n\n\tconst {\n\t\tuserid,\n\t\taudio,\n\t\tvideo\n\t} = opts;\n\n\tif (gStream === null)\n\t{\n\t\tlet resolutionEle = document.getElementById('resolution');\n\t\tlet specRes = (!!resolutionEle) ? resolutionEle.value : '480p';\n\t\tlet resolution = specRes;\n\n\t\tlet codecOptions = undefined;\n\n\t\tlet videoBitrate = 0;\n\t\tconst videoBitrateEle = document.getElementById('videoBitrate');\n\t\tif (!!videoBitrateEle)\n\t\t{\n\t\t\tvideoBitrate = videoBitrateEle.value;\n\t\t}\n\t\tvideoBitrate = +videoBitrate;\n\t\tif (videoBitrate > 0)\n\t\t{\n\t\t\tif (videoBitrate < 150)\n\t\t\t\tvideoBitrate = 150;\n\n\t\t\tcodecOptions = {\n\t\t\t\tstartBitrate: videoBitrate / 2,\n\t\t\t\tmaxBitrate: videoBitrate,\n\t\t\t\tminBitrate: 20\n\t\t\t};\n\t\t}\n\n\t\tconsole.log(`<demo> publishStream() userid: ${userid} video: ${video} cameraDevId: ${cameraDevId} audio: ${audio} micDevId: ${micDevId} resolution: ${resolution}`);\n\n\t\tgStream = RTCObj.createStream({\n\t\t\tuserId: +userid,\n\t\t\taudio: Boolean(audio),\n\t\t\tvideo: Boolean(video),\n\t\t\tcameraId: cameraDevId === 'default' ? null : cameraDevId,\n\t\t\tmicrophoneId: micDevId === 'default' ? null : micDevId,\n\t\t\tattributes: { videoProfile: resolution },\n\t\t\tcodecOptions,\n\t\t\topenAudioCtx: true\n\t\t});\n\n\t\tif (!gStream)\n\t\t\treturn;\n\n\t\t// \n\t\tif (audioProfile !== 'default')\n\t\t{\n\t\t\tgStream.setAudioProfile(audioProfile);\n\t\t}\n\n\t\tgStream.init(() =>\n\t\t{\n\t\t\tlet micPlayback = false;\n\t\t\tlet micPlaybackEle = document.getElementById('micPlayback');\n\t\t\tif (!!micPlaybackEle)\n\t\t\t{\n\t\t\t\tmicPlayback = micPlaybackEle.checked;\n\t\t\t}\n\n\t\t\t// \n\t\t\tif (Boolean(video))\n\t\t\t{\n\t\t\t\tconst videoId = '3t_local';\n\t\t\t\tlet videoE = document.createElement('video');\n\t\t\t\tvideoE.id = videoId;\n\t\t\t\tvideoE.muted = true;\n\t\t\t\tvideoE.autoplay = true;\n\t\t\t\tvideoE.controls = true;\n\t\t\t\tvideoE.setAttribute('playsinline', '');\n\t\t\t\tvideoE.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;'\n\n\t\t\t\tif (!!videoEle)\n\t\t\t\t{\n\t\t\t\t\tvideoEle.append(videoE);\n\t\t\t\t}\n\n\t\t\t\tgStream.play(videoId, true, micPlayback);\n\t\t\t}\n\t\t\t//\n\n\t\t\tstreams.set(gStream.getId(), gStream);\n\t\t\t\n\t\t\t_publishStream(userid, gStream, () => {\n\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t}, () => {\n\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\n\t\t\t\t// \n\t\t\t\tgStream.close();\n\t\t\t\tgStream = null;\n\t\t\t});\n\t\t\t// \n\t\t}, (evt) =>\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> publishStream - Stream.init fail - ${evt}` + '\\n';\n\t\t\tconsole.log(`<demo> publishStream - Stream.init fail - ${evt}`);\n\t\t\t\n\t\t\t// \n\t\t\tgStream.close();\n\t\t\tgStream = null;\n\t\t});\n\t}\n\telse\n\t{\n\t\t// \n\t\t_publishStream(userid, gStream, () => {\n\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t}, () => {\n\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\n\t\t\t// \n\t\t\tgStream.close();\n\t\t\tgStream = null;\n\t\t});\n\t}\n\t// \n}\n\n// \nfunction unpublishVideoStream(opts)\n{\n\tconst { trackClosed } = opts;\n\n\tclient.unpublish(gStream, () =>\n\t{\n\t\ttext_info.value = text_info.value + `<demo> unpublishVideoStream - client.unpublish local stream ${gStream.getId()} success.` + '\\n';\n\t\tconsole.log(`<demo> unpublishVideoStream - client.unpublish local stream ${gStream.getId()} success.`);\n\t}, () =>\n\t{\n\t\ttext_info.value = text_info.value + '<demo> unpublishVideoStream - client.unpublish local stream failed' + '\\n';\n\t\tconsole.log('<demo> unpublishVideoStream - client.unpublish local stream failed');\n\t}, false/*true*/);\n\n\t// \n\tif (!!trackClosed)\n\t{\n\t\tgStream.close();\n\n\t\tconst videoId = '3t_local';\n\t\tlet obj = document.getElementById(videoId);\n\t\tif (obj)\n\t\t{\n\t\t\tconsole.log('<demo> unpublishVideoStream - obj.remove -- 3t_local');\n\t\t\tobj.remove();\n\t\t}\n\n\t\tgStream = null;\n\t}\n\n\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n}\n\n// \n/******************* for ScreenCDN Stream */\n// \nlet publishScreenCDNEle = document.getElementById('publishScreenCDN');\nif (!!publishScreenCDNEle)\n{\n\tpublishScreenCDNEle.addEventListener('click', () =>\n\t{\n\t\tpublishScreenCDNStream();\n\t})\n}\n\nlet unpublishScreenCDNEle = document.getElementById('unpublishScreenCDN');\nif (!!unpublishScreenCDNEle)\n{\n\tunpublishScreenCDNEle.addEventListener('click', () =>\n\t{\n\t\tunpublishScreenCDNStream();\n\t})\n}\n\nfunction publishScreenCDNStream()\n{\n\t// \n\tif (!gScreenCDNStream)\n\t{\n\t\tconst userId = +(userIdEle.value);\n\t\tgScreenCDNStream = RTCObj.createStream({\n\t\t\tuserId,\n\t\t\taudio: true,\n\t\t\tscreen: true\n\t\t});\n\n\t\tif (!gScreenCDNStream)\n\t\t\treturn;\n\n\t\tgScreenCDNStream.init(() =>\n\t\t{\n\t\t\tgScreenCDNStream.on('screen-close', (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> event [screen-close] - ${e.streamId}`);\n\t\t\t\tunpublishScreenCDNStream();\n\t\t\t});\n\t\t\t//\n\n\t\t\t// \n\t\t\tconst videoId = '3t_local_screen_cdn';\n\t\t\tlet videoE = document.createElement('screenRec');\n\t\t\tvideoE.id = videoId;\n\t\t\tvideoE.muted = true;\n\t\t\tvideoE.autoplay = true;\n\t\t\tvideoE.controls = true;\n\t\t\tvideoE.setAttribute('playsinline', '');\n\t\t\tvideoE.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;'\n\n\t\t\tif (!!screenRecEle)\n\t\t\t{\n\t\t\t\tscreenRecEle.append(videoE);\n\t\t\t}\n\n\t\t\tgScreenCDNStream.play(videoId, true, false);\n\n\t\t\tstreams.set(gScreenCDNStream.getId(), gScreenCDNStream);\n\n\t\t\t// \n\t\t\tclient.publishScreen(gScreenCDNStream, () =>\n\t\t\t{\n\t\t\t\t// \n\t\t\t\ttext_info.value = text_info.value + `<demo> publishScreenCDNStream - client.publishScreen succ. gScreenCDNStream: ${gScreenCDNStream.getId()}` + '\\n';\n\t\t\t\tconsole.log(`<demo> publishScreenCDNStream - client.publishScreen succ. gScreenCDNStream: ${gScreenCDNStream.getId()}`);\n\n\t\t\t\t// \n\t\t\t\tlet url = rtmpUrlEle.value.trim();\n\t\t\t\tif (url !== '')\n\t\t\t\t{\n\t\t\t\t\t// url = `rtmp://push.3ttest.cn/sdk2/${roomIdEle.value.trim()}-screen-cdn`;\n\t\t\t\t\tclient.setRtmpUrl({ url, avMode: 'av' });\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\tsetLiveMixerLayout();\n\t\t\t\t\n\t\t\t\t//\n\t\t\t\tlet publishScreenCDNStatusEle = document.getElementById('publishScreenCDNStatus');\n\t\t\t\tif (!!publishScreenCDNStatusEle)\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishScreenCDNStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t\t}\n\t\t\t}, (evt) =>\n\t\t\t{\n\t\t\t\ttext_info.value = text_info.value + `publishScreenCDNStream - client.publishScreen fail - ${evt}` + '\\n';\n\t\t\t\tconsole.log(`<demo> publishScreenCDNStream - client.publishScreen fail - ${evt}`);\n\t\t\t\t\n\t\t\t\t//\n\t\t\t\tlet publishScreenCDNStatusEle = document.getElementById('publishScreenCDNStatus');\n\t\t\t\tif (!!publishScreenCDNStatusEle)\n\t\t\t\t{\n\t\t\t\t\tpublishScreenCDNStatusEle.innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t\t\t}\n\n\t\t\t\t// \n\t\t\t\tgScreenCDNStream.close();\n\t\t\t\tgScreenCDNStream = null;\n\t\t\t});\n\t\t}, (evt) =>\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> publishScreenCDNStream - Stream.init fail - ${evt}` + '\\n';\n\t\t\tconsole.log(`<demo> publishScreenCDNStream - Stream.init fail - ${evt}`);\n\n\t\t\t// \n\t\t\tgScreenCDNStream.close();\n\t\t\tgScreenCDNStream = null;\n\t\t});\n\t}\n}\n\nfunction unpublishScreenCDNStream()\n{\n\tclient.unpublishScreen(gScreenCDNStream, () =>\n\t{\n\t\ttext_info.value = text_info.value + `<demo> unpublishScreenCDNStream - client.unpublish local stream ${gScreenCDNStream.getId()} success.` + '\\n';\n\t\tconsole.log(`<demo> unpublishScreenCDNStream - client.unpublish local stream ${gScreenCDNStream.getId()} success.`);\n\t}, () =>\n\t{\n\t\ttext_info.value = text_info.value + '<demo> unpublishScreenCDNStream - client.unpublish local stream failed' + '\\n';\n\t\tconsole.log('<demo> unpublishScreenCDNStream - client.unpublish local stream failed');\n\t}, false/*true*/);\n\n\t// \n\tlet publishScreenCDNStatusEle = document.getElementById('publishScreenCDNStatus');\n\tif (!!publishScreenCDNStatusEle)\n\t{\n\t\tpublishScreenCDNStatusEle.innerHTML = `<font color=\"black\">未推流</font>`;\n\t}\n\n\tconst videoId = '3t_local_screen_cdn';\n\tlet obj = document.getElementById(videoId);\n\tif (obj)\n\t{\n\t\tconsole.log('<demo> unpublishScreenStream - obj.remove -- 3t_local_screen_cdn');\n\t\tobj.remove();\n\t}\n\n\tif (!!gScreenCDNStream)\n\t{\n\t\tgScreenCDNStream.close();\n\t\tgScreenCDNStream = null;\n\t}\n}\n\n// \n/******************* for Screen Stream */\n// \nlet publishScreenEle = document.getElementById('publishScreen');\nif (!!publishScreenEle)\n{\n\tpublishScreenEle.addEventListener('click', () =>\n\t{\n\t\tpublishScreenStream({\n\t\t\tuserid: userIdEle.value,\n\t\t\taudio: false\n\t\t});\n\t})\n}\n\nlet unpublishScreenEle = document.getElementById('unpublishScreen');\nif (!!unpublishScreenEle)\n{\n\tunpublishScreenEle.addEventListener('click', () =>\n\t{\n\t\tunpublishScreenStream({});\n\t})\n}\n\n// \nfunction publishScreenStream(opts)\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> publishScreenStream - 请先[加入房间]' + '\\n';\n\t\treturn;\n\t}\n\n\tconst {\n\t\tuserid,\n\t\taudio\n\t} = opts;\n\n\tif (gScreenStream === null)\n\t{\n\t\tlet resolution = '1080p';\n\n\t\tconsole.log(`<demo> publishScreenStream() userid: ${userid} audio: ${audio} resolution: ${resolution}`);\n\n\t\tgScreenStream = RTCObj.createStream({\n\t\t\tuserId: +userid,\n\t\t\taudio: Boolean(audio),\n\t\t\tscreen: true,\n\t\t\tattributes: { videoProfile: resolution }\n\t\t});\n\n\t\tif (!gScreenStream)\n\t\t\treturn;\n\n\t\t// \n\t\tif (audioProfile !== 'default')\n\t\t{\n\t\t\tgScreenStream.setAudioProfile(audioProfile);\n\t\t}\n\n\t\tgScreenStream.init(() =>\n\t\t{\n\t\t\tgScreenStream.on('screen-close', (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> event [screen-close] - ${e.streamId}`);\n\t\t\t\tunpublishScreenStream({ trackClosed: true });\n\t\t\t});\n\t\t\t//\n\n\t\t\t// \n\t\t\t{\n\t\t\t\tconst videoId = '3t_local_screen';\n\t\t\t\tlet videoE = document.createElement('video');\n\t\t\t\tvideoE.id = videoId;\n\t\t\t\tvideoE.muted = true;\n\t\t\t\tvideoE.autoplay = true;\n\t\t\t\tvideoE.controls = true;\n\t\t\t\tvideoE.setAttribute('playsinline', '');\n\t\t\t\tvideoE.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;'\n\n\t\t\t\tif (!!screenEle)\n\t\t\t\t{\n\t\t\t\t\tscreenEle.append(videoE);\n\t\t\t\t}\n\n\t\t\t\tgScreenStream.play(videoId, true, false);\n\t\t\t}\n\t\t\t//\n\t\t\tstreams.set(gScreenStream.getId(), gScreenStream);\n\n\t\t\t_publishStream(userid, gScreenStream, () =>\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t}, () =>\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\n\t\t\t\t// \n\t\t\t\tgScreenStream.close();\n\t\t\t\tgScreenStream = null;\n\t\t\t});\n\t\t\t// \n\t\t}, (evt) =>\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> publishScreenStream - Stream.init fail - ${evt}` + '\\n';\n\t\t\tconsole.log(`<demo> publishScreenStream - Stream.init fail - ${evt}`);\n\n\t\t\t// \n\t\t\tgScreenStream.close();\n\t\t\tgScreenStream = null;\n\t\t});\n\t}\n\telse\n\t{\n\t\t// \n\t\t_publishStream(userid, gScreenStream, () =>\n\t\t{\n\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t}, () =>\n\t\t{\n\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t\t\n\t\t\t// \n\t\t\tgScreenStream.close();\n\t\t\tgScreenStream = null;\n\t\t});\n\t}\n\t// \n}\n\n// \nfunction unpublishScreenStream(opts)\n{\n\tconst { trackClosed } = opts;\n\n\tif (gScreenStream === null)\n\t{\n\t\ttext_info.value = text_info.value + 'unpublishScreenStream - 当前尚未创建 gScreenStream' + '\\n';\n\t\tconsole.log('<demo> 当前尚未创建 gScreenStream');\n\n\t\treturn;\n\t}\n\n\tclient.unpublish(gScreenStream, () =>\n\t{\n\t\ttext_info.value = text_info.value + `<demo> unpublishScreenStream - client.unpublish local stream ${gScreenStream.getId()} success.` + '\\n';\n\t\tconsole.log(`<demo> unpublishScreenStream - client.unpublish local stream ${gScreenStream.getId()} success.`);\n\t}, () =>\n\t{\n\t\ttext_info.value = text_info.value + '<demo> unpublishScreenStream - client.unpublish local stream failed' + '\\n';\n\t\tconsole.log('<demo> unpublishScreenStream - client.unpublish local stream failed');\n\t}, false/*true*/);\n\n\t// \n\tif (!!trackClosed)\n\t{\n\t\tgScreenStream.close();\n\n\t\tconst videoId = '3t_local_screen';\n\t\tlet obj = document.getElementById(videoId);\n\t\tif (obj)\n\t\t{\n\t\t\tconsole.log('<demo> unpublishScreenStream - obj.remove -- 3t_local_screen');\n\t\t\tobj.remove();\n\t\t}\n\t\t\n\t\tgScreenStream = null;\n\t}\n\n\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n}\n\n/******************* for MediaSource Stream */\n// \nlet publishMediaSourceEle = document.getElementById('publishMediaSource');\nif (!!publishMediaSourceEle)\n{\n\tpublishMediaSourceEle.addEventListener('click', () =>\n\t{\n\t\tpublishMediaSourceStream({\n\t\t\tuserid: userIdEle.value\n\t\t});\n\t})\n}\n\nlet unpublishMediaSourceEle = document.getElementById('unpublishMediaSource');\nif (!!unpublishMediaSourceEle)\n{\n\tunpublishMediaSourceEle.addEventListener('click', () =>\n\t{\n\t\tunpublishMediaSourceStream({});\n\t})\n}\n\nfunction createMediaSourceStream()\n{\n\tif (!!sourceMediaStream)\n\t{\n\t\treturn;\n\t}\n\n\t//\n\tconst mediaSource = document.getElementById('mediaSource');\n\tif (!mediaSource)\n\t{\n\t\treturn;\n\t}\n\n\tif (mediaSource.captureStream)\n\t{\n\t\tsourceMediaStream = mediaSource.captureStream();\n\t\tconsole.log('Captured sourceMediaStream from mediaSource with captureStream', sourceMediaStream);\n\t}\n\telse if (mediaSource.mozCaptureStream)\n\t{\n\t\tsourceMediaStream = mediaSource.mozCaptureStream();\n\t\tconsole.log('Captured sourceMediaStream from mediaSource with mozCaptureStream()', sourceMediaStream);\n\t}\n\telse\n\t{\n\t\tconsole.log('captureStream() not supported');\n\t}\n}\n\n// \nfunction publishMediaSourceStream(opts)\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> publishMediaSourceStream - 请先[加入房间]' + '\\n';\n\t\treturn;\n\t}\n\n\tconst {\n\t\tuserid\n\t} = opts;\n\n\tif (gMediaSourceStream === null)\n\t{\n\t\tconsole.log(`<demo> publishMediaSourceStream() userid: ${userid}`);\n\n\t\t// \n\t\t// \n\t\tlet audioSource = null;\n\t\tlet videoSource = null;\n\t\tif (gMediaSourceStream)\n\t\t{\n\t\t\tcreateMediaSourceStream();\n\n\t\t\tif (!!sourceMediaStream)\n\t\t\t{\n\t\t\t\tconst audioTracks = sourceMediaStream.getVideoTracks();\n\t\t\t\tif (audioTracks.length > 0)\n\t\t\t\t\taudioSource = audioTracks[0];\n\t\t\t\tconst videoTracks = sourceMediaStream.getAudioTracks();\n\t\t\t\tif (videoTracks.length > 0)\n\t\t\t\t\tvideoSource = videoTracks[0];\n\t\t\t}\n\t\t}\n\n\t\tgMediaSourceStream = RTCObj.createStream({\n\t\t\tuserId: +userid,\n\t\t\tmediasource: true,\n\t\t\taudioSource,\n\t\t\tvideoSource\n\t\t});\n\n\t\tif (!gMediaSourceStream)\n\t\t\treturn;\n\n\t\tgMediaSourceStream.init(() =>\n\t\t{\n\t\t\tstreams.set(gMediaSourceStream.getId(), gMediaSourceStream);\n\n\t\t\t_publishStream(userid, gMediaSourceStream, () =>\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t\t}, () =>\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t\t});\n\t\t\t// \n\t\t}, (evt) =>\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> publishMediaSourceStream - Stream.init fail - ${evt}` + '\\n';\n\t\t\tconsole.log(`<demo> publishMediaSourceStream - Stream.init fail - ${evt}`);\n\t\t});\n\t}\n\telse\n\t{\n\t\t// \n\t\t_publishStream(userid, gMediaSourceStream, () =>\n\t\t{\n\t\t\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"green\">已推流</font>`;\n\t\t}, () =>\n\t\t{\n\t\t\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n\t\t});\n\t}\n\t// \n}\n\n// \nfunction unpublishMediaSourceStream(opts)\n{\n\tconst { trackClosed } = opts;\n\n\tif (gMediaSourceStream === null)\n\t{\n\t\ttext_info.value = text_info.value + 'unpublishMediaSourceStream - 当前尚未创建 gMediaSourceStream' + '\\n';\n\t\tconsole.log('<demo> 当前尚未创建 gMediaSourceStream');\n\n\t\treturn;\n\t}\n\n\tclient.unpublish(gMediaSourceStream, () =>\n\t{\n\t\ttext_info.value = text_info.value + `<demo> unpublishMediaSourceStream - client.unpublish local stream ${gMediaSourceStream.getId()} success.` + '\\n';\n\t\tconsole.log(`<demo> unpublishMediaSourceStream - client.unpublish local stream ${gMediaSourceStream.getId()} success.`);\n\t}, () =>\n\t{\n\t\ttext_info.value = text_info.value + '<demo> unpublishMediaSourceStream - client.unpublish local stream failed' + '\\n';\n\t\tconsole.log('<demo> unpublishMediaSourceStream - client.unpublish local stream failed');\n\t}, false/*true*/);\n\n\t// \n\tif (!!trackClosed)\n\t{\n\t\tgMediaSourceStream.close();\n\n\t\tconst videoId = 'mediaSource';\n\t\tlet obj = document.getElementById(videoId);\n\t\tif (obj)\n\t\t{\n\t\t\tconsole.log('<demo> unpublishMediaSourceStream - obj.remove -- mediaSource');\n\t\t\tobj.remove();\n\t\t}\n\n\t\tgMediaSourceStream = null;\n\t}\n\n\t//\n\tdocument.getElementById('publishMediaSourceStatus').innerHTML = `<font color=\"black\">未推流</font>`;\n}\n\nfunction _publishStream(userid, mediaStream, onSuccess, onFailure)\n{\n\t// \n\tclient.publish(mediaStream, () =>\n\t{\n\t\t// \n\t\ttext_info.value = text_info.value + `<demo> _publishStream - client.publish succ. mediaStream: ${mediaStream.getId()}` + '\\n';\n\t\tconsole.log(`<demo> _publishStream - client.publish succ. mediaStream: ${mediaStream.getId()}`);\n\n\t\t// \n\t\tonSuccess && onSuccess();\n\n\t\t// \n\t\tlet url = rtmpUrlEle.value.trim();\n\t\tif (url !== '')\n\t\t{\n\t\t\t// url = `rtmp://push.3ttest.cn/sdk2/${roomIdEle.value.trim()}`;\n\t\t\tclient.setRtmpUrl({ url, avMode: 'av' });\n\t\t}\n\n\t\t// \n\t\tsetLiveMixerLayout();\n\n\t\t// \n\t\tif (mediaStream.hasAudio())\n\t\t{\n\t\t\tmediaStream.on('volume-change', e =>\n\t\t\t{\n\t\t\t\tif (!!audioVolumeProgressEle)\n\t\t\t\t\taudioVolumeProgressEle.value = e.volume;\n\t\t\t\tif (!!audioVolumeValueEle)\n\t\t\t\t\taudioVolumeValueEle.innerHTML = e.volume;\n\t\t\t\t; // console.log(`<AUDIO-VOLUME> - volume-change -- userID: ${e.userID} volume: ${e.volume}`);\n\t\t\t});\n\t\t}\n\t}, (evt) =>\n\t{\n\t\ttext_info.value = text_info.value + `_publishStream - client.publish fail - ${evt}` + '\\n';\n\t\tconsole.log(`<demo> _publishStream - client.publish fail - ${evt}`);\n\n\t\tonFailure && onFailure();\n\t});\n}\n\n/******************* for audio / video control */\n//\nlet micPlaybackEle = document.getElementById('micPlayback');\nif (!!micPlaybackEle)\n{\n\tmicPlaybackEle.addEventListener('click', () =>\n\t{\n\t\tlet micPlayback = document.getElementById('micPlayback').checked;\n\t\tif (Boolean(micPlayback))\n\t\t{\n\t\t\tgStream.play('3t_local', true, true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgStream.stopPlay();\n\t\t}\n\t});\n}\n\nlet isVideoPaused = false;\nlet pauseVideoEle = document.getElementById('pauseVideo');\nif (!!pauseVideoEle)\n{\n\tpauseVideoEle.addEventListener('click', () =>\n\t{\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isVideoPaused)\n\t\t{\n\t\t\tclient.resumeWebcam(gStream, () =>\n\t\t\t{\n\t\t\t\tconsole.log('<demo> client.resumeWebcam succ.');\n\t\t\t}, (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> client.resumeWebcam fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclient.pauseWebcam(gStream, false, () =>\n\t\t\t{\n\t\t\t\tconsole.log('<demo> client.pauseWebcam succ.');\n\t\t\t}, (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> client.pauseWebcam fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\n\t\tisVideoPaused = !isVideoPaused;\n\n\t\tpauseVideoEle.innerHTML = isVideoPaused ? 'resumeVideo' : 'pauseVideo';\n\t})\n}\n\nlet isAudioPaused = false;\nlet pauseAudioEle = document.getElementById('pauseAudio');\nif (!!pauseAudioEle)\n{\n\tpauseAudioEle.addEventListener('click', () =>\n\t{\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isAudioPaused)\n\t\t{\n\t\t\tclient.resumeMic(gStream, () =>\n\t\t\t{\n\t\t\t\tconsole.log('<demo> client.resumeMic succ.');\n\t\t\t}, (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> client.resumeMic fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclient.pauseMic(gStream, () =>\n\t\t\t{\n\t\t\t\tconsole.log('<demo> client.pauseMic succ.');\n\t\t\t}, (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> client.pauseMic fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\n\t\tisAudioPaused = !isAudioPaused;\n\n\t\tpauseAudioEle.innerHTML = isAudioPaused ? 'resumeAudio' : 'pauseAudio';\n\t})\n}\n\n// \nlet isVideoDisabled = false;\nlet disableVideoEle = document.getElementById('disableVideo');\nif (!!disableVideoEle)\n{\n\tdisableVideoEle.addEventListener('click', () =>\n\t{\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isVideoDisabled)\n\t\t{\n\t\t\tgStream.enableVideo();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgStream.disableVideo();\n\t\t}\n\n\t\tisVideoDisabled = !isVideoDisabled;\n\n\t\tdisableVideoEle.innerHTML = isVideoDisabled ? 'enableVideo' : 'disableVideo';\n\t})\n}\n\n// \nlet isAudioDisabled = false;\nlet disableAudioEle = document.getElementById('disableAudio');\nif (!!disableAudioEle)\n{\n\tdisableAudioEle.addEventListener('click', () =>\n\t{\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isAudioDisabled)\n\t\t{\n\t\t\tgStream.enableAudio();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgStream.disableAudio();\n\t\t}\n\n\t\tisAudioDisabled = !isAudioDisabled;\n\n\t\tdisableAudioEle.innerHTML = isAudioDisabled ? 'enableAudio' : 'disableAudio';\n\t})\n}\n\nlet resolutionEle = document.getElementById('resolution');\nif (!!resolutionEle)\n{\n\tresolutionEle.addEventListener('change', () =>\n\t{\n\t\tlet prof = resolutionEle.value;\n\n\t\tsetVideoProfile(prof);\n\t})\n}\n\nlet micVolumeSliderEle = document.getElementById('micVolumeSlider');\nif (!!micVolumeSliderEle)\n{\n\tmicVolumeSliderEle.addEventListener('change', () =>\n\t{\n\t\tvar value = (micVolumeSliderEle.value) / 10;\n\t\tlet micVolumeSliderValueEle = document.getElementById('micVolumeSliderValue');\n\t\tif (!!micVolumeSliderValueEle)\n\t\t{\n\t\t\tmicVolumeSliderValueEle.innerHTML = (value);\n\t\t}\n\n\t\tif (!!gStream)\n\t\t{\n\t\t\tgStream.setInputVolume(+value);\n\t\t}\n\n\t\t// \n\t\tremote_stream.forEach((item) =>\n\t\t{\n\t\t\tif (!!item)\n\t\t\t{\n\t\t\t\t// \n\t\t\t\titem.setAudioVolume(+value);\n\t\t\t}\n\t\t});\n\t})\n}\n\n/******************* for list Devices */\n// \nlet refreshDevicesEle = document.getElementById('refreshDevices');\nif (!!refreshDevicesEle)\n{\n\trefreshDevicesEle.addEventListener('click', () =>\n\t{\n\t\tgetDevices();\n\t})\n}\n\nfunction getDevices()\n{\n\tlet message = '';\n\n\t// 首先\n\tfor (let index = 0; index < audioInputSelect.childNodes.length; index++)\n\t{\n\t\taudioInputSelect.removeChild(audioInputSelect.options[0]);\n\t\taudioInputSelect.remove(0);\n\t\taudioInputSelect.options[0] = null;\n\t}\n\n\t// \n\tfor (let index = 0; index < audioOutputSelect.childNodes.length; index++)\n\t{\n\t\taudioOutputSelect.removeChild(audioOutputSelect.options[0]);\n\t\taudioOutputSelect.remove(0);\n\t\taudioOutputSelect.options[0] = null;\n\t}\n\n\t// \n\tfor (let index = 0; index < videoSelect.childNodes.length; index++)\n\t{\n\t\tvideoSelect.removeChild(videoSelect.options[0]);\n\t\tvideoSelect.remove(0);\n\t\tvideoSelect.options[0] = null;\n\t}\n\n\t_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.listDevices((devices) =>\n\t{\n\t\t// \n\t\tdevices.forEach((deviceInfo) =>\n\t\t{\n\t\t\tmessage = '<demo> getDevices - ' + deviceInfo.kind + ': ' + deviceInfo.label + ' id: ' + deviceInfo.deviceId + '\\n';\n\t\t\ttext_info.value = text_info.value + message;\n\t\t\tconsole.log(message);\n\n\t\t\tlet option = document.createElement('option');\n\t\t\toption.value = deviceInfo.deviceId;\n\t\t\tif (deviceInfo.kind === 'audioinput')\n\t\t\t{\n\t\t\t\tif (!!audioInputSelect)\n\t\t\t\t{\n\t\t\t\t\toption.text = deviceInfo.label || `microphone ${audioInputSelect.length + 1}`;\n\t\t\t\t\taudioInputSelect.appendChild(option);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (deviceInfo.kind === 'audiooutput')\n\t\t\t{\n\t\t\t\tif (!!audioOutputSelect)\n\t\t\t\t{\n\t\t\t\t\toption.text = deviceInfo.label || `speaker ${audioOutputSelect.length + 1}`;\n\t\t\t\t\taudioOutputSelect.appendChild(option);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (deviceInfo.kind === 'videoinput')\n\t\t\t{\n\t\t\t\tif (!!videoSelect)\n\t\t\t\t{\n\t\t\t\t\toption.text = deviceInfo.label || `camera ${videoSelect.length + 1}`;\n\t\t\t\t\tvideoSelect.appendChild(option);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.log('<demo> Some other kind of source/device: ', deviceInfo);\n\t\t\t}\n\t\t});\n\t}, (err) =>\n\t{\n\t\tconst errMsg = err.name + err.message + '\\n';\n\t\ttext_info.value = text_info.value + errMsg;\n\t});\n}\n\n/******************* for switchDevices */\n// \nif (!!videoSelect)\n{\n\tvideoSelect.addEventListener('change', () =>\n\t{\n\t\tlet index = videoSelect.selectedIndex;\n\n\t\tcameraDevId = videoSelect.options[index].value;\n\n\t\tconsole.log(`<demo> cameraDev change - cameraDevId: ${cameraDevId}`);\n\n\t\t// switch device for Stream\n\t\tif (!!gStream)\n\t\t{\n\t\t\tgStream.switchDevice('video', cameraDevId, () =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> switchDevice succ - deviceId: ${cameraDevId}`);\n\t\t\t}, (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> switchDevice fail - deviceId: ${cameraDevId} - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t})\n}\n\n// \nif (!!audioInputSelect)\n{\n\taudioInputSelect.addEventListener('change', () =>\n\t{\n\t\tlet index = audioInputSelect.selectedIndex;\n\n\t\tmicDevId = audioInputSelect.options[index].value;\n\n\t\tconsole.log(`<demo> micDev change - micDevId: ${micDevId}`);\n\n\t\t// switch device for Stream\n\t\tif (!!gStream)\n\t\t{\n\t\t\tgStream.switchDevice('audio', micDevId, () =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> switchDevice succ - deviceId: ${micDevId}`);\n\t\t\t}, (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> switchDevice fail - deviceId: ${micDevId} - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t})\n}\n\n// \nif (!!audioOutputSelect)\n{\n\taudioOutputSelect.addEventListener('change', () =>\n\t{\n\t\tlet index = audioOutputSelect.selectedIndex;\n\n\t\tspeakerDevId = audioOutputSelect.options[index].value;\n\n\t\t// \n\t\tremote_stream.forEach((item) =>\n\t\t{\n\t\t\tif (!!item)\n\t\t\t{\n\t\t\t\t// \n\t\t\t\titem.setAudioOutput(speakerDevId, (e) =>\n\t\t\t\t{\n\t\t\t\t\ttext_info.value = text_info.value + `<demo> switch speaker - Stream.setAudioOutput succc - ${e}` + '\\n';\n\t\t\t\t\tconsole.log('<demo> switch speaker - Stream.setAudioOutput succc. - ' + e);\n\t\t\t\t}, (e) =>\n\t\t\t\t{\n\t\t\t\t\ttext_info.value = text_info.value + `<demo> switch speaker - Stream.setAudioOutput fail - ${e}` + '\\n';\n\t\t\t\t\tconsole.log('<demo> switch speaker - Stream.setAudioOutput fail. - ' + e);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconsole.log(`<demo> speakerDev change - speakerDevId: ${speakerDevId}`);\n\t})\n}\n/********************/\n\n// \nlet audioCodecEle = document.getElementById('audioCodec');\nif (!!audioCodecEle)\n{\n\taudioCodecEle.addEventListener('change', () =>\n\t{\n\t\tlet index = audioCodecEle.selectedIndex;\n\n\t\taudioCodec = audioCodecEle.options[index].value;\n\n\t\tconsole.log(`<demo> audioCodec change - audioCodec: ${audioCodec}`);\n\t})\n}\n// \nlet audioProfileEle = document.getElementById('audioProfile');\nif (!!audioProfileEle)\n{\n\taudioProfileEle.addEventListener('change', () =>\n\t{\n\t\tlet index = audioProfileEle.selectedIndex;\n\n\t\taudioProfile = audioProfileEle.options[index].value;\n\n\t\tconsole.log(`<demo> audioProfile change - audioProfile: ${audioProfile}`);\n\t})\n}\n\nlet userRoleEle = document.getElementById('userRole');\nif (!!userRoleEle)\n{\n\tuserRoleEle.addEventListener('change', () =>\n\t{\n\t\tlet index = userRoleSelect.selectedIndex;\n\n\t\tuserRole = userRoleSelect.options[index].value;\n\n\t\tconsole.log(`<demo> userRole change - userRole: ${userRole}`);\n\n\t\t// \n\t\tif (!!client)\n\t\t{\n\t\t\tclient.setUserRole(userRole, () =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> setUserRole() succ. - role: ${userRole}`);\n\t\t\t}, (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(`<demo> setUserRole() fail - ${e.toString()}`);\n\t\t\t});\n\t\t}\n\t})\n}\n\n// \nlet submitLogEle = document.getElementById('submitLog');\nif (!!submitLogEle)\n{\n\tsubmitLogEle.addEventListener('click', () =>\n\t{\n\t\tconst isSubmitLog = submitLogEle.checked;\n\t\t_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a.setLogSubmit(isSubmitLog);\n\t\tconsole.log(`<demo> submitLog: ${isSubmitLog}`);\n\t})\n}\n\n\n//# sourceURL=webpack:///./src/js/websdkdemo.js?");

/***/ })

/******/ });