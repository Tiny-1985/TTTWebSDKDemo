!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("tttwebsdk",[],t):"object"==typeof exports?exports.tttwebsdk=t():e.tttwebsdk=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=119)}([function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,r){"use strict";t.__esModule=!0;var n,i=r(139),a=(n=i)&&n.__esModule?n:{default:n};t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,a.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},function(e,t,r){e.exports={default:r(137),__esModule:!0}},function(e,t,r){"use strict";t.__esModule=!0;var n,i=r(26),a=(n=i)&&n.__esModule?n:{default:n};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,a.default)(t))&&"function"!=typeof t?e:t}},function(e,t,r){"use strict";t.__esModule=!0;var n=o(r(151)),i=o(r(155)),a=o(r(26));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,a.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(0)),i=o(r(1)),a=o(r(109));function o(e){return e&&e.__esModule?e:{default:e}}var s="mediasoup-client",c=function(){function e(t){(0,n.default)(this,e),t?(this._debug=(0,a.default)(s+":"+t),this._warn=(0,a.default)(s+":WARN:"+t),this._error=(0,a.default)(s+":ERROR:"+t)):(this._debug=(0,a.default)(s),this._warn=(0,a.default)(s+":WARN"),this._error=(0,a.default)(s+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return(0,i.default)(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}();t.default=c},function(e,t,r){e.exports={default:r(122),__esModule:!0}},function(e,t){var r=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=r)},function(e,t,r){e.exports={default:r(158),__esModule:!0}},function(e,t,r){e.exports={default:r(173),__esModule:!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(18));function i(e){return e&&e.__esModule?e:{default:e}}t.randomNumber=function(){return a()},t.clone=function(e){return JSON.parse((0,n.default)(e))};var a=i(r(115)).default.generator({min:1e7,max:99999999,integer:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(6)),i=l(r(2)),a=l(r(0)),o=l(r(1)),s=l(r(3)),c=l(r(4)),d=r(29),u=l(r(5));function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){(0,a.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.setMaxListeners(1/0),r._logger=e||new u.default("<EnhancedEventEmitter>"),r}return(0,c.default)(t,e),(0,o.default)(t,[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:function(e){for(var t=this,r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return new n.default((function(r,n){t.safeEmit.apply(t,[e].concat(i,[function(e){r(e)},function(r){t._logger.error("safeEmitAsPromise() | errback called [event:%s]:%o",e,r),n(r)}]))}))}}]),t}(d.EventEmitter);t.default=p},function(e,t,r){var n=r(14),i=r(7),a=r(27),o=r(28),s=r(33),c=function(e,t,r){var d,u,l,p=e&c.F,f=e&c.G,m=e&c.S,h=e&c.P,v=e&c.B,_=e&c.W,g=f?i:i[t]||(i[t]={}),y=g.prototype,b=f?n:m?n[t]:(n[t]||{}).prototype;for(d in f&&(r=t),r)(u=!p&&b&&void 0!==b[d])&&s(g,d)||(l=u?b[d]:r[d],g[d]=f&&"function"!=typeof b[d]?r[d]:v&&u?a(l,n):_&&b[d]==l?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):h&&"function"==typeof l?a(Function.call,l):l,h&&((g.virtual||(g.virtual={}))[d]=l,e&c.R&&y&&!y[d]&&o(y,d,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){"use strict";var n=r(193),i=r(194);t.write=i,t.parse=n.parse,t.parseFmtpConfig=n.parseFmtpConfig,t.parseParams=n.parseParams,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){var n=r(73)("wks"),i=r(57),a=r(14).Symbol,o="function"==typeof a;(e.exports=function(e){return n[e]||(n[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(9),a=(n=i)&&n.__esModule?n:{default:n};function o(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,c=function(){var e=s.value,n=(t.rtcpFeedback||[]).find((function(t){return t.type===e.type&&t.parameter===e.parameter}));n&&r.push(n)},d=(0,a.default)(e.rtcpFeedback||[]);!(n=(s=d.next()).done);n=!0)c()}catch(e){i=!0,o=e}finally{try{!n&&d.return&&d.return()}finally{if(i)throw o}}return r}t.getExtendedRtpCapabilities=function(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=!0,i=!1,s=void 0;try{for(var c,d=function(){var t=c.value;if("rtx"===t.name)return"continue";var n=(e.codecs||[]).find((function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if("video/h264"===r){var i=(e.parameters||{})["packetization-mode"]||0,a=(t.parameters||{})["packetization-mode"]||0;if(i!==a)return!1}return!0}(e,t)}));if(n){var i={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:n.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:o(n,t),parameters:t.parameters};i.channels||delete i.channels,r.codecs.push(i)}},u=(0,a.default)(t.codecs||[]);!(n=(c=u.next()).done);n=!0)d()}catch(e){i=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw s}}var l=!0,p=!1,f=void 0;try{for(var m,h=function(){var r=m.value,n=(e.codecs||[]).find((function(e){return"rtx"===e.name&&e.parameters.apt===r.sendPayloadType})),i=(t.codecs||[]).find((function(e){return"rtx"===e.name&&e.parameters.apt===r.recvPayloadType}));n&&i&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=i.preferredPayloadType)},v=(0,a.default)(r.codecs||[]);!(l=(m=v.next()).done);l=!0)h()}catch(e){p=!0,f=e}finally{try{!l&&v.return&&v.return()}finally{if(p)throw f}}var _=!0,g=!1,y=void 0;try{for(var b,I=function(){var t=b.value,n=(e.headerExtensions||[]).find((function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n}));if(n){var i={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(i)}},k=(0,a.default)(t.headerExtensions||[]);!(_=(b=k.next()).done);_=!0)I()}catch(e){g=!0,y=e}finally{try{!_&&k.return&&k.return()}finally{if(g)throw y}}return r},t.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,i=void 0;try{for(var o,s=(0,a.default)(e.codecs);!(r=(o=s.next()).done);r=!0){var c=o.value,d={name:c.name,mimeType:c.mimeType,kind:c.kind,clockRate:c.clockRate,preferredPayloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(d.channels||delete d.channels,t.codecs.push(d),c.recvRtxPayloadType){var u={name:"rtx",mimeType:c.kind+"/rtx",kind:c.kind,clockRate:c.clockRate,preferredPayloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}var l=!0,p=!1,f=void 0;try{for(var m,h=(0,a.default)(e.headerExtensions);!(l=(m=h.next()).done);l=!0){var v=m.value,_={kind:v.kind,uri:v.uri,preferredId:v.recvId};t.headerExtensions.push(_)}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return t.fecMechanisms=e.fecMechanisms,t},t.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],i=e.codecs,o=r.codecs,s=!0,c=!1,d=void 0;try{for(var u,l=function(){var e=u.value;if(!o.some((function(t){return t.recvPayloadType===e}))){var t=i.find((function(t){return t.preferredPayloadType===e}));if(!t)throw new Error("mandatory codec PT "+e+" not found in remote codecs");n.push(t)}},p=(0,a.default)(t);!(s=(u=p.next()).done);s=!0)l()}catch(e){c=!0,d=e}finally{try{!s&&p.return&&p.return()}finally{if(c)throw d}}return n},t.canSend=function(e,t){return t.codecs.some((function(t){return t.kind===e}))},t.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some((function(e){return e.recvPayloadType===r.payloadType}))},t.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,i=!1,o=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(n=(s=c.next()).done);n=!0){var d=s.value;if(d.kind===e){var u={name:d.name,mimeType:d.mimeType,clockRate:d.clockRate,payloadType:d.sendPayloadType,channels:d.channels,rtcpFeedback:d.rtcpFeedback,parameters:d.parameters};if(u.channels||delete u.channels,r.codecs.push(u),d.sendRtxPayloadType){var l={name:"rtx",mimeType:d.kind+"/rtx",clockRate:d.clockRate,payloadType:d.sendRtxPayloadType,parameters:{apt:d.sendPayloadType}};r.codecs.push(l)}}}}catch(e){i=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,a.default)(t.headerExtensions);!(p=(h=v.next()).done);p=!0){var _=h.value;if(!_.kind||_.kind===e){var g={uri:_.uri,id:_.sendId};r.headerExtensions.push(g)}}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}return r},t.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,i=!1,o=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(n=(s=c.next()).done);n=!0){var d=s.value;if(d.kind===e){var u={name:d.name,mimeType:d.mimeType,clockRate:d.clockRate,payloadType:d.recvPayloadType,channels:d.channels,rtcpFeedback:d.rtcpFeedback,parameters:d.parameters};if(u.channels||delete u.channels,r.codecs.push(u),d.recvRtxPayloadType){var l={name:"rtx",mimeType:d.kind+"/rtx",clockRate:d.clockRate,payloadType:d.recvRtxPayloadType,parameters:{apt:d.recvPayloadType}};r.codecs.push(l)}}}}catch(e){i=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,a.default)(t.headerExtensions);!(p=(h=v.next()).done);p=!0){var _=h.value;if(!_.kind||_.kind===e){var g={uri:_.uri,id:_.recvId};r.headerExtensions.push(g)}}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}return r}},function(e,t,r){e.exports={default:r(185),__esModule:!0}},function(e,t,r){e.exports={default:r(136),__esModule:!0}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){e.exports={default:r(188),__esModule:!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(9)),i=s(r(17)),a=s(r(8));t.extractRtpCapabilities=function(e){var t=new a.default,r=[],s=!1,c=!1,d=!0,u=!1,l=void 0;try{for(var p,f=(0,n.default)(e.media);!(d=(p=f.next()).done);d=!0){var m=p.value,h=m.type;switch(h){case"audio":if(s)continue;s=!0;break;case"video":if(c)continue;c=!0;break;default:continue}var v=!0,_=!1,g=void 0;try{for(var y,b=(0,n.default)(m.rtp);!(v=(y=b.next()).done);v=!0){var I=y.value,k={name:I.codec,mimeType:h+"/"+I.codec,kind:h,clockRate:I.rate,preferredPayloadType:I.payload,channels:I.encoding,rtcpFeedback:[],parameters:{}};"audio"!==k.kind?delete k.channels:k.channels||(k.channels=1),t.set(k.preferredPayloadType,k)}}catch(e){_=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(_)throw g}}var P=!0,S=!1,w=void 0;try{for(var T,A=(0,n.default)(m.fmtp||[]);!(P=(T=A.next()).done);P=!0){var E=T.value,R=o.default.parseFmtpConfig(E.config),C=t.get(E.payload);C&&(C.parameters=R)}}catch(e){S=!0,w=e}finally{try{!P&&A.return&&A.return()}finally{if(S)throw w}}var O=!0,x=!1,D=void 0;try{for(var N,L=(0,n.default)(m.rtcpFb||[]);!(O=(N=L.next()).done);O=!0){var M=N.value,B=t.get(M.payload);if(B){var V={type:M.type,parameter:M.subtype};V.parameter||delete V.parameter,B.rtcpFeedback.push(V)}}}catch(e){x=!0,D=e}finally{try{!O&&L.return&&L.return()}finally{if(x)throw D}}var j=!0,F=!1,U=void 0;try{for(var H,G=(0,n.default)(m.ext||[]);!(j=(H=G.next()).done);j=!0){var K=H.value,W={kind:h,uri:K.uri,preferredId:K.value};r.push(W)}}catch(e){F=!0,U=e}finally{try{!j&&G.return&&G.return()}finally{if(F)throw U}}}}catch(e){u=!0,l=e}finally{try{!d&&f.return&&f.return()}finally{if(u)throw l}}return{codecs:(0,i.default)(t.values()),headerExtensions:r,fecMechanisms:[]}},t.extractDtlsParameters=function(e){var t=function(e){return(e.media||[]).find((function(e){return e.iceUfrag&&0!==e.port}))}(e),r=t.fingerprint||e.fingerprint,n=void 0;switch(t.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}};var o=s(r(13));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){var n=r(25),i=r(87),a=r(70),o=Object.defineProperty;t.f=r(23)?Object.defineProperty:function(e,t,r){if(n(e),t=a(t,!0),n(r),i)try{return o(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!r(32)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(5)),i=a(r(13));function a(e){return e&&e.__esModule?e:{default:e}}new n.default("<BandwidthHandler>");function o(e,t,r){return s(e,0,-1,t,r)}function s(e,t,r,n,i){for(var a=-1!==r?r:e.length,o=t;o<a;++o)if(0===e[o].indexOf(n)&&(!i||-1!==e[o].toLowerCase().indexOf(i.toLowerCase())))return o;return null}function c(e){var t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null}t.default={setBAS:function(e,t,r){return navigator.mozGetUserMedia||!t||(r&&(t.screen?t.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),t.screen&&r&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video||t.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(r?t.screen:t.video)+"\r\n"))),e},setVideoBitrates:function(e,t){if(null==t)return e;if(void 0===t.videoGoogleMinBitrate||void 0===t.videoGoogleMaxBitrate)return e;var r,n=(t=t||{}).videoGoogleMinBitrate,i=t.videoGoogleMaxBitrate,a=t.videoGoogleStartBitrate,d=e.split("\r\n"),u=o(d,"a=rtpmap","H264/90000");if(u&&(r=c(d[u])),!r)return e;for(var l="",p=void 0,f=0;null!==f&&(null!==(f=s(d,f,-1,"a=fmtp","profile-level-id=42001f"))&&(l="",-1===d[f].indexOf("x-google-min-bitrate=")?l+=";x-google-min-bitrate="+(n||"228"):(p=new RegExp("x-google-min-bitrate=(\\d+)"),d[f]=d[f].replace(p,"x-google-min-bitrate="+(n||"228"))),-1===d[f].indexOf("x-google-max-bitrate=")?l+=";x-google-max-bitrate="+(i||"228"):(p=new RegExp("x-google-max-bitrate=(\\d+)"),d[f]=d[f].replace(p,"x-google-max-bitrate="+(i||"228"))),-1===d[f].indexOf("x-google-start-bitrate=")?l+=";x-google-start-bitrate="+(a||"228"):(p=new RegExp("x-google-start-bitrate=(\\d+)"),d[f]=d[f].replace(p,"x-google-start-bitrate="+(a||"228"))),d[f]=d[f].concat(l),e=d.join("\r\n")),null!==f);)f+=1;for(f=0;null!==f&&(null!==(f=s(d,f,-1,"a=fmtp","profile-level-id=42e01f"))&&(l="",-1===d[f].indexOf("x-google-min-bitrate=")?l+=";x-google-min-bitrate="+(n||"228"):(p=new RegExp("x-google-min-bitrate=(\\d+)"),d[f]=d[f].replace(p,"x-google-min-bitrate="+(n||"228"))),-1===d[f].indexOf("x-google-max-bitrate=")?l+=";x-google-max-bitrate="+(i||"228"):(p=new RegExp("x-google-max-bitrate=(\\d+)"),d[f]=d[f].replace(p,"x-google-max-bitrate="+(i||"228"))),-1===d[f].indexOf("x-google-start-bitrate=")?l+=";x-google-start-bitrate="+(a||"228"):(p=new RegExp("x-google-start-bitrate=(\\d+)"),d[f]=d[f].replace(p,"x-google-start-bitrate="+(a||"228"))),d[f]=d[f].concat(l),e=d.join("\r\n")),null!==f);)f+=1;return e},setOpusAttributes:function(e,t){t=t||{};var r,n=e.split("\r\n"),i=o(n,"a=rtpmap","opus/48000");if(i&&(r=c(n[i])),!r)return e;var a=o(n,"a=fmtp:"+r.toString());if(null===a)return e;var s="",d=void 0;return void 0!==t.stereo&&(-1===n[a].indexOf("stereo=")?s+=";stereo="+t.stereo:(d=new RegExp("stereo=(\\d)"),n[a]=n[a].replace(d,"stereo="+t.stereo))),void 0!==t["sprop-stereo"]&&(-1===n[a].indexOf("sprop-stereo=")?s+=";sprop-stereo="+t["sprop-stereo"]:(d=new RegExp("sprop-stereo=(\\d)"),n[a]=n[a].replace(d,"sprop-stereo="+t["sprop-stereo"]))),void 0!==t.maxaveragebitrate&&(-1==n[a].indexOf("maxaveragebitrate=")?s+=";maxaveragebitrate="+(t.maxaveragebitrate||1048576):(d=new RegExp("maxaveragebitrate=(\\d+)"),n[a]=n[a].replace(d,"maxaveragebitrate="+(t.maxaveragebitrate||1048576)))),void 0!==t.maxplaybackrate&&(-1===n[a].indexOf("maxplaybackrate=")?s+=";maxplaybackrate="+(t.maxplaybackrate||48e3):(d=new RegExp("maxplaybackrate=(\\d+)"),n[a]=n[a].replace(d,"maxplaybackrate="+(t.maxplaybackrate||48e3)))),void 0!==t.cbr&&(-1===n[a].indexOf("cbr=")?s+=";cbr="+t.cbr:(d=new RegExp("cbr=(\\d+)"),n[a]=n[a].replace(d,"cbr="+t.cbr))),void 0!==t.useinbandfec&&(-1===n[a].indexOf("useinbandfec=")?s+=";useinbandfec="+t.useinbandfec:(d=new RegExp("useinbandfec=(\\d)"),n[a]=n[a].replace(d,"useinbandfec="+t.useinbandfec))),void 0!==t.usedtx&&(-1===n[a].indexOf("usedtx=")?s+=";usedtx="+t.usedtx:(d=new RegExp("usedtx=(\\d)"),n[a]=n[a].replace(d,"usedtx="+t.usedtx))),void 0!==t.maxptime&&(s+="\r\na=maxptime:"+t.maxptime),n[a]=n[a].concat(s),e=n.join("\r\n")},setSpecialAudioCodec:function(e,t){var r=i.default.parse(e);return r?(r.media.forEach((function(e,n){if("audio"===e.type&&e.rtp){r.media[n].rtp=e.rtp.filter((function(e){return e.codec.toLowerCase()==t||"CN"==e.codec||"telephone-event"==e.codec}));var i=-1;e.rtp.forEach((function(e,r){e.codec==t&&(i=e.payload)})),r.media[n].payloads=e.rtp.map((function(e){return e.payload})).join(" "),e.fmtp&&(r.media[n].fmtp=e.fmtp.filter((function(e){return e.payload==i}))),e.rtcpFb&&(r.media[n].rtcpFb=e.rtcpFb.filter((function(e){return e.payload==i})))}})),e=i.default.write(r)):e}}},function(e,t,r){var n=r(19);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){"use strict";t.__esModule=!0;var n=o(r(142)),i=o(r(144)),a="function"==typeof i.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof i.default&&"symbol"===a(n.default)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":a(e)}},function(e,t,r){var n=r(47);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(22),i=r(48);e.exports=r(23)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function d(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var i,a,o,s;if(d(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,s=c,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=p.bind(n);return i.listener=r,n.wrapFn=i,i}function m(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):v(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,t);else{var d=c.length,u=v(c,d);for(r=0;r<d;++r)a(u[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return d(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,a,o;if(d(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return m(this,e,!0)},s.prototype.rawListeners=function(e){return m(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(18)),i=d(r(26)),a=d(r(0)),o=d(r(1)),s=d(r(109)),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(42));function d(e){return e&&e.__esModule?e:{default:e}}var u=r(84),l=c.logLevel,p="tttwebsdk",f=l.LOG_TRACE,m=!0,h=!1,v=function(){function t(e){(0,a.default)(this,t),this._userAgent=navigator.userAgent,this._isMobile=/mobile/i.test(this._userAgent),e?(this._prefix="tttwebsdk "+e,this._debug=(0,s.default)("tttwebsdk:"+e),this._warn=(0,s.default)("tttwebsdk:WARN:"+e),this._error=(0,s.default)("tttwebsdk:ERROR:"+e)):(this._prefix="tttwebsdk",this._debug=(0,s.default)(p),this._warn=(0,s.default)("tttwebsdk:WARN"),this._error=(0,s.default)("tttwebsdk:ERROR")),this._debug=this._log_debug.bind(this),this._warn=this._log_warn.bind(this),this._error=this._log_error.bind(this)}return(0,o.default)(t,[{key:"setLoggerLevel",value:function(e){t.logLevel=e}},{key:"_log_debug",value:function(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.logLevel<=l.LOG_INFO){var o="["+this._prefix+"]";[].slice.apply(r).forEach((function(e){"object"===(void 0===e?"undefined":(0,i.default)(e))?o+=" "+(0,n.default)(e):o+=" "+e})),console.log(o)}this._log.apply(this,r)}},{key:"_log_error",value:function(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.logLevel<=l.LOG_ERROR){var o="["+this._prefix+"]";[].slice.apply(r).forEach((function(e){"object"===(void 0===e?"undefined":(0,i.default)(e))?o+=" "+(0,n.default)(e):o+=" "+e})),console.error(o)}this._log.apply(this,r)}},{key:"_log_warn",value:function(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.logLevel<=l.LOG_WARN){var o="["+this._prefix+"]";[].slice.apply(r).forEach((function(e){"object"===(void 0===e?"undefined":(0,i.default)(e))?o+=" "+(0,n.default)(e):o+=" "+e})),console.warn(o)}this._log.apply(this,r)}},{key:"_log",value:function(){if(t.logSubmit){for(var r=this._isMobile?"web_mobile":"web",a="appid="+e.g_appid+", roomid="+e.g_roomid+", userid="+e.g_userid+", connectId="+e.g_connectId+", sessionId="+e.g_sessionId+" server="+e.g_server+" dev="+r+"-"+u.version+"_"+u.buildDate+" ua="+this._userAgent+" time="+new Date,o=arguments.length,s=Array(o),d=0;d<o;d++)s[d]=arguments[d];[].slice.apply(s).forEach((function(e){"object"===(void 0===e?"undefined":(0,i.default)(e))?a+=" "+(0,n.default)(e):a+=" "+e})),fetch(c.logserver_url,{method:"POST",mode:"no-cors",cache:"no-cache",headers:{"Content-Type":"text/plain; charset=utf-8"},redirect:"follow",referrer:"no-referrer",body:"event="+this._prefix+" "+a}).catch((function(e){return console.warn("Error:",e)})).then((function(e){return(0,n.default)(e)}))}}},{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}],[{key:"privateCloud",get:function(){return h},set:function(e){h=Boolean(e)}},{key:"logSubmit",get:function(){return m},set:function(e){m=Boolean(e)}},{key:"logLevel",get:function(){return f},set:function(e){switch(e){case"LOG_NONE":f=l.LOG_NONE;break;case"LOG_ERROR":f=l.LOG_ERROR;break;case"LOG_WARN":f=l.LOG_WARN;break;case"LOG_INFO":f=l.LOG_INFO;break;case"LOG_DEBUG":f=l.LOG_DEBUG;break;case"LOG_TRACE":f=l.LOG_TRACE;break;default:throw TypeError("parameter error. must be: LOG_NONE, LOG_ERROR, LOG_WARN, LOG_INFO, LOG_DEBUG, LOG_TRACE")}}}]),t}();t.default=v}).call(this,r(38))},function(e,t,r){"use strict";var n=r(123)(!0);r(68)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})}))},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(67);e.exports=function(e){return Object(n(e))}},function(e,t,r){var n;n=function(){var e=!0;function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||""}function n(e){var r=t.match(e);return r&&r.length>1&&r[2]||""}var i,o=r(/(ipod|iphone|ipad)/i).toLowerCase(),s=!/like android/i.test(t)&&/android/i.test(t),c=/nexus\s*[0-6]\s*/i.test(t),d=!c&&/nexus\s*[0-9]+/i.test(t),u=/CrOS/.test(t),l=/silk/i.test(t),p=/sailfish/i.test(t),f=/tizen/i.test(t),m=/(web|hpw)(o|0)s/i.test(t),h=/windows phone/i.test(t),v=(/SamsungBrowser/i.test(t),!h&&/windows/i.test(t)),_=!o&&!l&&/macintosh/i.test(t),g=!s&&!p&&!f&&!m&&/linux/i.test(t),y=n(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),b=r(/version\/(\d+(\.\d+)?)/i),I=/tablet/i.test(t)&&!/tablet pc/i.test(t),k=!I&&/[^-]mobi/i.test(t),P=/xbox/i.test(t);/opera/i.test(t)?i={name:"Opera",opera:e,version:b||r(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?i={name:"Opera",opera:e,version:r(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||b}:/SamsungBrowser/i.test(t)?i={name:"Samsung Internet for Android",samsungBrowser:e,version:b||r(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(t)?i={name:"NAVER Whale browser",whale:e,version:r(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(t)?i={name:"MZ Browser",mzbrowser:e,version:r(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(t)?i={name:"Opera Coast",coast:e,version:b||r(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(t)?i={name:"Focus",focus:e,version:r(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(t)?i={name:"Yandex Browser",yandexbrowser:e,version:b||r(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?i={name:"UC Browser",ucbrowser:e,version:r(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?i={name:"Maxthon",maxthon:e,version:r(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?i={name:"Epiphany",epiphany:e,version:r(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?i={name:"Puffin",puffin:e,version:r(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?i={name:"Sleipnir",sleipnir:e,version:r(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?i={name:"K-Meleon",kMeleon:e,version:r(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:h?(i={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},y?(i.msedge=e,i.version=y):(i.msie=e,i.version=r(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?i={name:"Internet Explorer",msie:e,version:r(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?i={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?i={name:"Microsoft Edge",msedge:e,version:y}:/vivaldi/i.test(t)?i={name:"Vivaldi",vivaldi:e,version:r(/vivaldi\/(\d+(\.\d+)?)/i)||b}:p?i={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:r(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?i={name:"SeaMonkey",seamonkey:e,version:r(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(i={name:"Firefox",firefox:e,version:r(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(i.firefoxos=e,i.osname="Firefox OS")):l?i={name:"Amazon Silk",silk:e,version:r(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?i={name:"PhantomJS",phantom:e,version:r(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?i={name:"SlimerJS",slimer:e,version:r(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?i={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:b||r(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:m?(i={name:"WebOS",osname:"WebOS",webos:e,version:b||r(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(i.touchpad=e)):/bada/i.test(t)?i={name:"Bada",osname:"Bada",bada:e,version:r(/dolfin\/(\d+(\.\d+)?)/i)}:f?i={name:"Tizen",osname:"Tizen",tizen:e,version:r(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||b}:/qupzilla/i.test(t)?i={name:"QupZilla",qupzilla:e,version:r(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||b}:/chromium/i.test(t)?i={name:"Chromium",chromium:e,version:r(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||b}:/chrome|crios|crmo/i.test(t)?i={name:"Chrome",chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:s?i={name:"Android",version:b}:/safari|applewebkit/i.test(t)?(i={name:"Safari",safari:e},b&&(i.version=b)):o?(i={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},b&&(i.version=b)):i=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:r(/googlebot\/(\d+(\.\d+))/i)||b}:{name:r(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(i.name=i.name||"Blink",i.blink=e):(i.name=i.name||"Webkit",i.webkit=e),!i.version&&b&&(i.version=b)):!i.opera&&/gecko\//i.test(t)&&(i.name=i.name||"Gecko",i.gecko=e,i.version=i.version||r(/gecko\/(\d+(\.\d+)?)/i)),i.windowsphone||!s&&!i.silk?!i.windowsphone&&o?(i[o]=e,i.ios=e,i.osname="iOS"):_?(i.mac=e,i.osname="macOS"):P?(i.xbox=e,i.osname="Xbox"):v?(i.windows=e,i.osname="Windows"):g&&(i.linux=e,i.osname="Linux"):(i.android=e,i.osname="Android");var S="";i.windows?S=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(r(/Windows ((NT|XP)( \d\d?.\d)?)/i)):i.windowsphone?S=r(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i.mac?S=(S=r(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):o?S=(S=r(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):s?S=r(/android[ \/-](\d+(\.\d+)*)/i):i.webos?S=r(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?S=r(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?S=r(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(S=r(/tizen[\/\s](\d+(\.\d+)*)/i)),S&&(i.osversion=S);var w=!i.windows&&S.split(".")[0];return I||d||"ipad"==o||s&&(3==w||w>=4&&!k)||i.silk?i.tablet=e:(k||"iphone"==o||"ipod"==o||s||c||i.blackberry||i.webos||i.bada)&&(i.mobile=e),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.vivaldi&&i.version>=1||i.chrome&&i.version>=20||i.samsungBrowser&&i.version>=4||i.whale&&1===a([i.version,"1.0"])||i.mzbrowser&&1===a([i.version,"6.0"])||i.focus&&1===a([i.version,"1.0"])||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1||i.chromium&&i.version>=20?i.a=e:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6||i.chromium&&i.version<20?i.c=e:i.x=e,i}var r=t("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function i(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function a(e){for(var t=Math.max(n(e[0]),n(e[1])),r=i(e,(function(e){var r=t-n(e);return i((e+=new Array(r+1).join(".0")).split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));--t>=0;){if(r[0][t]>r[1][t])return 1;if(r[0][t]!==r[1][t])return-1;if(0===t)return 0}}function o(e,n,i){var o=r;"string"==typeof n&&(i=n,n=void 0),void 0===n&&(n=!1),i&&(o=t(i));var s=""+o.version;for(var c in e)if(e.hasOwnProperty(c)&&o[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return a([s,e[c]])<0}return n}return r.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in r)return!0}return!1},r.isUnsupportedBrowser=o,r.compareVersions=a,r.check=function(e,t,r){return!o(e,t,r)},r._detect=t,r.detect=t,r},e.exports?e.exports=n():r(181)("bowser",n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(61)),i=s(r(8)),a=s(r(20)),o=s(r(9));function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t,r){var n=void 0;if(null!=r){if(r=String(r),!(n=(e.media||[]).find((function(e){return String(e.mid)===r}))))throw new Error("SDP section with mid="+r+" not found")}else if(!(n=(e.media||[]).find((function(e){return e.type===t.kind&&e.msid&&e.msid.split(" ")[1]===t.id}))))throw new Error("SDP section with a=msid containing track.id="+t.id+" not found");return n}t.fillRtpParametersForTrack=function(e,t,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},d=s.mid,u=void 0===d?null:d,l=s.planBSimulcast,p=void 0!==l&&l,f=c(t,r,u);null!=u&&(e.muxId=String(u));e.rtcp={cname:null,reducedSize:!0,mux:!0};var m=(f.ssrcs||[]).find((function(e){return"cname"===e.attribute}));if(!m)throw new Error("CNAME value not found");if(e.rtcp.cname=m.value,p){var h=void 0,v=new a.default,_=!0,g=!1,y=void 0;try{for(var b,I=(0,o.default)(f.ssrcs||[]);!(_=(b=I.next()).done);_=!0){var k=b.value;if("msid"===k.attribute){var P=k.id;v.add(P),h||(h=P)}}}catch(e){g=!0,y=e}finally{try{!_&&I.return&&I.return()}finally{if(g)throw y}}if(0===v.size)throw new Error("no a=ssrc lines found");var S=new i.default,w=!0,T=!1,A=void 0;try{for(var E,R=(0,o.default)(f.ssrcGroups||[]);!(w=(E=R.next()).done);w=!0){var C=E.value;if("FID"===C.semantics){var O=C.ssrcs.split(/\s+/),x=(0,n.default)(O,2),D=x[0],N=x[1];D=Number(D),N=Number(N),v.has(D)&&(v.delete(D),v.delete(N),S.set(D,N))}}}catch(e){T=!0,A=e}finally{try{!w&&R.return&&R.return()}finally{if(T)throw A}}var L=!0,M=!1,B=void 0;try{for(var V,j=(0,o.default)(v);!(L=(V=j.next()).done);L=!0){var F=V.value;S.set(F,null)}}catch(e){M=!0,B=e}finally{try{!L&&j.return&&j.return()}finally{if(M)throw B}}e.encodings=[];var U=S.size>1,H=["low","medium","high"],G=!0,K=!1,W=void 0;try{for(var z,q=(0,o.default)(S);!(G=(z=q.next()).done);G=!0){var X=(0,n.default)(z.value,2),J=X[0],Y=(N=X[1],{ssrc:J});N&&(Y.rtx={ssrc:N}),U&&(Y.profile=H.shift()),e.encodings.push(Y)}}catch(e){K=!0,W=e}finally{try{!G&&q.return&&q.return()}finally{if(K)throw W}}}else{var Q=m.id,$=[],Z=!0,ee=!1,te=void 0;try{for(var re,ne=(0,o.default)(f.rids||[]);!(Z=(re=ne.next()).done);Z=!0){var ie=re.value;"send"===ie.direction&&(/^low/.test(ie.id)?$.push({rid:ie.id,profile:"low"}):/^medium/.test(ie.id)&&$.push({rid:ie.id,profile:"medium"}),/^high/.test(ie.id)&&$.push({rid:ie.id,profile:"high"}))}}catch(e){ee=!0,te=e}finally{try{!Z&&ne.return&&ne.return()}finally{if(ee)throw te}}if(e.encodings=[],0===$.length){var ae={ssrc:Q};e.encodings.push(ae)}else{var oe=!0,se=!1,ce=void 0;try{for(var de,ue=(0,o.default)($);!(oe=(de=ue.next()).done);oe=!0){var le=de.value,pe={encodingId:le.rid,profile:le.profile};e.encodings.push(pe)}}catch(e){se=!0,ce=e}finally{try{!oe&&ue.return&&ue.return()}finally{if(se)throw ce}}}}},t.addPlanBSimulcast=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.mid,i=void 0===n?null:n,a=c(e,t,i),o=(a.ssrcs||[]).find((function(e){return"msid"===e.attribute}));if(!o)throw new Error("a=ssrc line with msid information not found");var s=o.id,d=o.value.split(" ")[0],u=void 0;(a.ssrcGroups||[]).some((function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===s?(u=Number(t[1]),!0):void 0}}));var l=a.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===s}));if(!l)throw new Error("CNAME line not found");var p=l.value,f=s+1,m=s+2;if(a.ssrcGroups=[],a.ssrcs=[],a.ssrcGroups.push({semantics:"SIM",ssrcs:s+" "+f+" "+m}),a.ssrcs.push({id:s,attribute:"cname",value:p}),a.ssrcs.push({id:s,attribute:"msid",value:d+" "+t.id}),a.ssrcs.push({id:f,attribute:"cname",value:p}),a.ssrcs.push({id:f,attribute:"msid",value:d+" "+t.id}),a.ssrcs.push({id:m,attribute:"cname",value:p}),a.ssrcs.push({id:m,attribute:"msid",value:d+" "+t.id}),u){var h=u+1,v=u+2;a.ssrcGroups.push({semantics:"FID",ssrcs:s+" "+u}),a.ssrcs.push({id:u,attribute:"cname",value:p}),a.ssrcs.push({id:u,attribute:"msid",value:d+" "+t.id}),a.ssrcGroups.push({semantics:"FID",ssrcs:f+" "+h}),a.ssrcs.push({id:h,attribute:"cname",value:p}),a.ssrcs.push({id:h,attribute:"msid",value:d+" "+t.id}),a.ssrcGroups.push({semantics:"FID",ssrcs:m+" "+v}),a.ssrcs.push({id:v,attribute:"cname",value:p}),a.ssrcs.push({id:v,attribute:"msid",value:d+" "+t.id})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(43)),i=f(r(9)),a=f(r(2)),o=f(r(3)),s=f(r(4)),c=f(r(0)),d=f(r(1)),u=f(r(13)),l=f(r(5)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default("<RemoteUnifiedPlanSdp>"),h=function(){function e(t){(0,c.default)(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:p.randomNumber(),version:0}}return(0,d.default)(e,[{key:"setTransportLocalParameters",value:function(e){m.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){m.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){m.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:"createAnswerSdp",value:function(e){if(m.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,o={},s=(e.media||[]).filter((function(e){return e.hasOwnProperty("mid")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},s.length>0&&(o.groups=[{type:"BUNDLE",mids:s.join(" ")}]),o.media=[];var c=a.fingerprints.length;o.fingerprint={type:a.fingerprints[c-1].algorithm,hash:a.fingerprints[c-1].value};var d=!0,l=!1,p=void 0;try{for(var f,h=(0,i.default)(e.media||[]);!(d=(f=h.next()).done);d=!0){var v=f.value,_="inactive"===v.direction,g=v.type,y=this._rtpParametersByKind[g].codecs,b=this._rtpParametersByKind[g].headerExtensions,I={};I.type=v.type,I.port=7,I.protocol="RTP/SAVPF",I.connection={ip:"127.0.0.1",version:4},I.mid=v.mid,I.iceUfrag=t.usernameFragment,I.icePwd=t.password,I.candidates=[];var k=!0,P=!1,S=void 0;try{for(var w,T=(0,i.default)(r);!(k=(w=T.next()).done);k=!0){var A=w.value,E={component:1};E.foundation=A.foundation,E.ip=A.ip,E.port=A.port,E.priority=A.priority,E.transport=A.protocol,E.type=A.type,A.tcpType&&(E.tcptype=A.tcpType),I.candidates.push(E)}}catch(e){P=!0,S=e}finally{try{!k&&T.return&&T.return()}finally{if(P)throw S}}switch(I.endOfCandidates="end-of-candidates",I.iceOptions="renomination",a.role){case"client":I.setup="active";break;case"server":I.setup="passive"}switch(v.direction){case"sendrecv":case"sendonly":I.direction="recvonly";break;case"recvonly":case"inactive":I.direction="inactive"}I.rtp=[],I.rtcpFb=[],I.fmtp=[];var R=!0,C=!1,O=void 0;try{for(var x,D=(0,i.default)(y);!(R=(x=D.next()).done);R=!0){var N=x.value,L={payload:N.payloadType,codec:N.name,rate:N.clockRate};if(N.channels>1&&(L.encoding=N.channels),I.rtp.push(L),N.parameters){var M={payload:N.payloadType,config:""},B=!0,V=!1,j=void 0;try{for(var F,U=(0,i.default)((0,n.default)(N.parameters));!(B=(F=U.next()).done);B=!0){var H=F.value;M.config&&(M.config+=";"),M.config+=H+"="+N.parameters[H]}}catch(e){V=!0,j=e}finally{try{!B&&U.return&&U.return()}finally{if(V)throw j}}M.config&&I.fmtp.push(M)}if(N.rtcpFeedback){var G=!0,K=!1,W=void 0;try{for(var z,q=(0,i.default)(N.rtcpFeedback);!(G=(z=q.next()).done);G=!0){var X=z.value;I.rtcpFb.push({payload:N.payloadType,type:X.type,subtype:X.parameter||""})}}catch(e){K=!0,W=e}finally{try{!G&&q.return&&q.return()}finally{if(K)throw W}}}}}catch(e){C=!0,O=e}finally{try{!R&&D.return&&D.return()}finally{if(C)throw O}}if(I.payloads=y.map((function(e){return e.payloadType})).join(" "),!_){I.ext=[];var J=!0,Y=!1,Q=void 0;try{for(var $,Z=function(){var e=$.value;if(!(v.ext||[]).find((function(t){return t.uri===e.uri})))return"continue";I.ext.push({uri:e.uri,value:e.id})},ee=(0,i.default)(b);!(J=($=ee.next()).done);J=!0)Z()}catch(e){Y=!0,Q=e}finally{try{!J&&ee.return&&ee.return()}finally{if(Y)throw Q}}}if(v.simulcast){I.simulcast={dir1:"recv",list1:v.simulcast.list1},I.rids=[];var te=!0,re=!1,ne=void 0;try{for(var ie,ae=(0,i.default)(v.rids||[]);!(te=(ie=ae.next()).done);te=!0){var oe=ie.value;"send"===oe.direction&&I.rids.push({id:oe.id,direction:"recv"})}}catch(e){re=!0,ne=e}finally{try{!te&&ae.return&&ae.return()}finally{if(re)throw ne}}}else if(v.simulcast_03){I.simulcast_03={value:v.simulcast_03.value.replace(/send/g,"recv")},I.rids=[];var se=!0,ce=!1,de=void 0;try{for(var ue,le=(0,i.default)(v.rids||[]);!(se=(ue=le.next()).done);se=!0){var pe=ue.value;"send"===pe.direction&&I.rids.push({id:pe.id,direction:"recv"})}}catch(e){ce=!0,de=e}finally{try{!se&&le.return&&le.return()}finally{if(ce)throw de}}}I.rtcpMux="rtcp-mux",I.rtcpRsize="rtcp-rsize",o.media.push(I)}}catch(e){l=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(l)throw p}}return u.default.write(o)}}]),t}(h),_=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:"createOfferSdp",value:function(e){if(m.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,o={},s=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},s.length>0&&(o.groups=[{type:"BUNDLE",mids:s.join(" ")}]),o.media=[];var c=a.fingerprints.length;o.fingerprint={type:a.fingerprints[c-1].algorithm,hash:a.fingerprints[c-1].value};var d=!0,l=!1,p=void 0;try{for(var f,h=(0,i.default)(e);!(d=(f=h.next()).done);d=!0){var v=f.value,_=v.closed,g=v.kind,y=void 0,b=void 0;"application"!==v.kind&&(y=this._rtpParametersByKind[g].codecs,b=this._rtpParametersByKind[g].headerExtensions);var I={};"application"!==v.kind?(I.type=g,I.port=7,I.protocol="RTP/SAVPF",I.connection={ip:"127.0.0.1",version:4},I.mid=v.mid,I.msid=v.streamId+" "+v.trackId):(I.type=g,I.port=9,I.protocol="DTLS/SCTP",I.connection={ip:"127.0.0.1",version:4},I.mid=v.mid),I.iceUfrag=t.usernameFragment,I.icePwd=t.password,I.candidates=[];var k=!0,P=!1,S=void 0;try{for(var w,T=(0,i.default)(r);!(k=(w=T.next()).done);k=!0){var A=w.value,E={component:1};E.foundation=A.foundation,E.ip=A.ip,E.port=A.port,E.priority=A.priority,E.transport=A.protocol,E.type=A.type,A.tcpType&&(E.tcptype=A.tcpType),I.candidates.push(E)}}catch(e){P=!0,S=e}finally{try{!k&&T.return&&T.return()}finally{if(P)throw S}}if(I.endOfCandidates="end-of-candidates",I.iceOptions="renomination",I.setup="actpass","application"!==v.kind){I.direction=_?"inactive":"sendonly",I.rtp=[],I.rtcpFb=[],I.fmtp=[];var R=!0,C=!1,O=void 0;try{for(var x,D=(0,i.default)(y);!(R=(x=D.next()).done);R=!0){var N=x.value,L={payload:N.payloadType,codec:N.name,rate:N.clockRate};if(N.channels>1&&(L.encoding=N.channels),I.rtp.push(L),N.parameters){var M={payload:N.payloadType,config:""},B=!0,V=!1,j=void 0;try{for(var F,U=(0,i.default)((0,n.default)(N.parameters));!(B=(F=U.next()).done);B=!0){var H=F.value;M.config&&(M.config+=";"),M.config+=H+"="+N.parameters[H]}}catch(e){V=!0,j=e}finally{try{!B&&U.return&&U.return()}finally{if(V)throw j}}M.config&&I.fmtp.push(M)}if(N.rtcpFeedback){var G=!0,K=!1,W=void 0;try{for(var z,q=(0,i.default)(N.rtcpFeedback);!(G=(z=q.next()).done);G=!0){var X=z.value;I.rtcpFb.push({payload:N.payloadType,type:X.type,subtype:X.parameter||""})}}catch(e){K=!0,W=e}finally{try{!G&&q.return&&q.return()}finally{if(K)throw W}}}}}catch(e){C=!0,O=e}finally{try{!R&&D.return&&D.return()}finally{if(C)throw O}}if(I.payloads=y.map((function(e){return e.payloadType})).join(" "),!_){I.ext=[];var J=!0,Y=!1,Q=void 0;try{for(var $,Z=(0,i.default)(b);!(J=($=Z.next()).done);J=!0){var ee=$.value;"urn:ietf:params:rtp-hdrext:sdes:mid"!==ee.uri&&I.ext.push({uri:ee.uri,value:ee.id})}}catch(e){Y=!0,Q=e}finally{try{!J&&Z.return&&Z.return()}finally{if(Y)throw Q}}}I.rtcpMux="rtcp-mux",I.rtcpRsize="rtcp-rsize",_||(I.ssrcs=[],I.ssrcGroups=[],I.ssrcs.push({id:v.ssrc,attribute:"cname",value:v.cname}),v.rtxSsrc&&(I.ssrcs.push({id:v.rtxSsrc,attribute:"cname",value:v.cname}),I.ssrcGroups.push({semantics:"FID",ssrcs:v.ssrc+" "+v.rtxSsrc})))}else I.payloads=5e3,I.sctpmap={app:"webrtc-datachannel",maxMessageSize:256,sctpmapNumber:5e3};o.media.push(I)}}catch(e){l=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(l)throw p}}return u.default.write(o)}}]),t}(h);t.default=function e(t,r){switch((0,c.default)(this,e),m.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new v(r);case"recv":return new _(r)}}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports={}},function(e,t,r){var n=r(71),i=r(67);e.exports=function(e){return n(i(e))}},function(e,t,r){r(128);for(var n=r(14),i=r(28),a=r(39),o=r(15)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var d=s[c],u=n[d],l=u&&u.prototype;l&&!l[o]&&i(l,o,d),a[d]=a.Array}},function(e,t,r){"use strict";var n,i=r(8),a=(n=i)&&n.__esModule?n:{default:n};var o=new a.default([[1,{code:"TTT_SUCCESS",reason:"success"}],[2,{code:"TTT_FAIL",reason:"auth lock dog - noresource"}],[4,{code:"TTT_FAIL",reason:"already in channel"}],[5,{code:"TTT_FAIL",reason:"param invalid"}],[6,{code:"TTT_NO_SERVER_AVAILABLE",reason:"no server available"}],[9,{code:"TTT_FAIL",reason:"already login"}],[10,{code:"TTT_OVERMAX",reason:"overmax"}],[11,{code:"TTT_AUDIO_TIMEOUT",reason:"audio timeout"}],[12,{code:"TTT_VIDEO_TIMEOUT",reason:"video timeout"}],[13,{code:"TTT_LIVE_NOT_START",reason:"live not start"}],[14,{code:"TTT_TIMEOUT",reason:"timeout"}],[15,{code:"TTT_FAIL",reason:"update user media message"}],[16,{code:"TTT_NO_CHAIR",reason:"no-chair"}],[17,{code:"TTT_USER_NON_EXIST",reason:"user non-exist"}],[18,{code:"TTT_RECORD_ERROR",reason:"record error"}],[19,{code:"TTT_AUDIOMIXER_ERROR",reason:"audiomixer error"}],[20,{code:"TTT_DBOPER_ERROR",reason:"dboper error"}],[21,{code:"TTT_CHAIR_PASSWORD_ERROR",reason:"chair password error"}],[22,{code:"TTT_PASSWORD_ERROR",reason:"password error"}],[23,{code:"TTT_NO_PASSWORD",reason:"no password"}],[24,{code:"TTT_CHANNEL_NON_EXIST",reason:"channel is not exist"}],[25,{code:"INVALID_APPID",reason:"invalid appid"}],[26,{code:"TTT_RTMP_CONNECT",reason:"rtmp connect"}],[27,{code:"TTT_AUTHENTICATION",reason:"authentication"}],[30,{code:"TTT_CONNECT_TIMEOUT",reason:"connect timeout"}]]),s=new a.default([["80p",{width:110,height:80,bps:{ideal:55e3,min:3e4,max:7e4}}],["120p",{width:160,height:120,bps:{ideal:65e3,min:4e4,max:8e4}}],["120p_3",{width:120,height:120,bps:{ideal:5e4,min:4e4,max:7e4}}],["160p",{width:210,height:160,bps:{ideal:12e4,min:5e4,max:15e4}}],["180p",{width:320,height:180,bps:{ideal:14e4,min:6e4,max:2e5}}],["180p_3",{width:180,height:180,bps:{ideal:1e5,min:6e4,max:16e4}}],["180p_4",{width:240,height:180,bps:{ideal:12e4,min:6e4,max:16e4}}],["200p",{width:270,height:200,bps:{ideal:14e4,min:6e4,max:2e5}}],["240p",{width:320,height:240,bps:{ideal:2e5,min:6e4,max:26e4}}],["320p",{width:420,height:320,bps:{ideal:25e4,min:8e4,max:3e5}}],["360p",{width:480,height:360,bps:{ideal:25e4,min:8e4,max:36e4}}],["360p_1",{width:640,height:360,bps:{ideal:3e5,min:8e4,max:4e5}}],["480p",{width:640,height:480,bps:{ideal:4e5,min:12e4,max:45e4}}],["480p_8",{width:848,height:480,bps:{ideal:5e5,min:12e4,max:45e4}}],["540p",{width:720,height:540,bps:{ideal:6e5,min:2e5,max:7e5}}],["720p",{width:1280,height:720,bps:{ideal:113e4,min:5e5,max:2e6}}],["720p_5",{width:960,height:720,bps:{ideal:8e5,min:5e5,max:16e5}}],["720p_6",{width:960,height:720,bps:{ideal:1e6,min:8e5,max:2e6}}],["1080p",{width:1920,height:1080,bps:{ideal:16e5,min:8e5,max:24e5}}],["2k",{width:2560,height:1440,bps:{ideal:12e5,min:8e5,max:3e6}}],["4k",{width:3840,height:2160,bps:{ideal:2e6,min:1e6,max:8e6}}],["8k",{width:7680,height:4320,bps:{ideal:4e6,min:2e6,max:1e7}}]]),c=new a.default([["80p",{width:110,height:80,bps:{ideal:99e3,min:54e3,max:112e3}}],["120p",{width:160,height:120,bps:{ideal:117e3,min:72e3,max:128e3}}],["120p_3",{width:120,height:120,bps:{ideal:9e4,min:72e3,max:112e3}}],["160p",{width:210,height:160,bps:{ideal:216e3,min:9e4,max:24e4}}],["180p",{width:320,height:180,bps:{ideal:252e3,min:108e3,max:32e4}}],["180p_3",{width:180,height:180,bps:{ideal:18e4,min:108e3,max:256e3}}],["180p_4",{width:240,height:180,bps:{ideal:216e3,min:108e3,max:256e3}}],["200p",{width:270,height:200,bps:{ideal:252e3,min:108e3,max:32e4}}],["240p",{width:320,height:240,bps:{ideal:36e4,min:108e3,max:416e3}}],["320p",{width:420,height:320,bps:{ideal:45e4,min:144e3,max:48e4}}],["360p",{width:480,height:360,bps:{ideal:45e4,min:144e3,max:576e3}}],["360p_1",{width:640,height:360,bps:{ideal:54e4,min:144e3,max:64e4}}],["480p",{width:640,height:480,bps:{ideal:72e4,min:216e3,max:72e4}}],["480p_8",{width:848,height:480,bps:{ideal:9e5,min:216e3,max:72e4}}],["540p",{width:720,height:540,bps:{ideal:108e4,min:36e4,max:112e4}}],["720p",{width:1280,height:720,bps:{ideal:2034e3,min:9e5,max:32e5}}],["720p_5",{width:960,height:720,bps:{ideal:144e4,min:9e5,max:256e4}}],["720p_6",{width:960,height:720,bps:{ideal:18e5,min:144e4,max:32e5}}],["1080p",{width:1920,height:1080,bps:{ideal:288e4,min:144e4,max:384e4}}],["2k",{width:2560,height:1440,bps:{ideal:216e4,min:144e4,max:48e5}}],["4k",{width:3840,height:2160,bps:{ideal:36e5,min:18e5,max:128e5}}],["8k",{width:7680,height:4320,bps:{ideal:72e5,min:36e5,max:16e6}}]]),d=new a.default([["720p",{width:1280,height:720,bps:{ideal:6e5,min:3e5,max:15e5}}],["1080p",{width:1920,height:1080,bps:{ideal:8e5,min:4e5,max:2e6}}],["2k",{width:2560,height:1440,bps:{ideal:8e5,min:6e5,max:24e5}}],["4k",{width:3840,height:2160,bps:{ideal:12e5,min:8e5,max:3e6}}],["8k",{width:7680,height:4320,bps:{ideal:15e5,min:1e6,max:4e6}}]]),u=new a.default([["720p",{width:1280,height:720,bps:{ideal:9e5,min:45e4,max:225e4}}],["1080p",{width:1920,height:1080,bps:{ideal:12e5,min:6e5,max:3e6}}],["2k",{width:2560,height:1440,bps:{ideal:12e5,min:9e5,max:36e5}}],["4k",{width:3840,height:2160,bps:{ideal:18e5,min:12e5,max:45e5}}],["8k",{width:7680,height:4320,bps:{ideal:225e4,min:15e5,max:6e6}}]]),l=new a.default([["isac32",{codec:"isac",maxplaybackrate:32e3,stereo:0,maxaveragebitrate:40960}],["speech_low_quality",{codec:"opus",maxplaybackrate:16e3,stereo:0,maxaveragebitrate:24576}],["speech_standard",{codec:"opus",maxplaybackrate:32e3,stereo:0,maxaveragebitrate:24576}],["music_standard",{codec:"opus",maxplaybackrate:48e3,stereo:0,maxaveragebitrate:40960}],["standard_stereo",{codec:"opus",maxplaybackrate:48e3,stereo:1,maxaveragebitrate:65536}],["high_quality",{codec:"opus",maxplaybackrate:48e3,stereo:0,maxaveragebitrate:131072}],["high_quality_stereo",{codec:"opus",maxplaybackrate:48e3,stereo:1,maxaveragebitrate:196608}]]);e.exports={logLevel:{LOG_NONE:6,LOG_ERROR:5,LOG_WARN:4,LOG_INFO:3,LOG_DEBUG:2,LOG_TRACE:1},audioProfileSpec:l,audioSpec:{sampleRate:{min:4e3,max:48e3,ideal:8e3},channelCount:{min:1,max:2,ideal:1}},videoSpec:{width:{min:80,ideal:640,max:1920},height:{min:60,ideal:480,max:1080},bitrate:{min:80,ideal:400,max:2e3},frameRate:{min:10,ideal:15,max:30},aspectRatio:4/3},mediaServerAddress:"",PUBLISH_STATE:{IDLE:0,PUBLISHING:1,PUBLISHED:2},tttErrCode:{ERROR_UNDEFINED:1e3,IPLOC_FAIL:1001,SERVER_FAIL:1002,INVALID_APPID:1003,INVALID_USERID:1004,INVALID_CHANNELID:1005,INVALID_PARAM:1006,INVALID_PARAM_STREAM:1007,NOT_READY:1008,CLIENT_HAS_ALREADY_INIT:1009,STREAM_HAS_ALREADY_INIT:1010,NONSUPPORT:1099,SYS_EXCEPTION:1100,CALL_IMPROPER:1101,TASK_FAIL:2e3,TASK_PROCEEDING:2001,JOIN_FAIL:2002,CONNECT_BROKEN:2003,NOT_LOGIN:2004,PERMISSION_DENIED:2005,PUBLISH_FAIL:2006,AUDIO_NOPUBLISH:2007,VIDEO_NOPUBLISH:2008,STREAM_HASPUBLISHED:2010,DEVICE_EXCEPTION:2020,AUDIO_PLAY_FAIL:2021,VIDEO_PLAY_FAIL:2022,STREAM_HAS_NOAUDIO:2023,STREAM_HAS_NOVIDEO:2024,STREAM_HAS_NOMEDIA:2025,STREAM_AUDIO_OFF:2026,STREAM_VIDEO_OFF:2027},tttErrMsg:o,logserver_url:"https://logst.3ttech.cn:15200",iplocationAddress:"webdispatch.3ttech.cn",iplocationPort:443,videoResolution:s,videoResolutionH:c,screenResolution:d,screenResolutionH:u,videoAttributes:{sif:[320,240],vga:[640,480],hd720p:[1280,720]}}},function(e,t,r){e.exports={default:r(168),__esModule:!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(61)),i=s(r(9)),a=s(r(8)),o=s(r(20));function s(e){return e&&e.__esModule?e:{default:e}}t.fillRtpParametersForTrack=function(e,t,r){var s=r.kind,c={cname:null,reducedSize:!0,mux:!0},d=(t.media||[]).find((function(e){return e.type===s}));if(!d)throw new Error("m="+s+" section not found");var u=void 0,l=new o.default,p=!0,f=!1,m=void 0;try{for(var h,v=(0,i.default)(d.ssrcs||[]);!(p=(h=v.next()).done);p=!0){var _=h.value;if("msid"===_.attribute)if(_.value.split(" ")[1]===r.id){var g=_.id;l.add(g),u||(u=g)}}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}if(0===l.size)throw new Error("a=ssrc line not found for local track [track.id:"+r.id+"]");var y=new a.default,b=!0,I=!1,k=void 0;try{for(var P,S=(0,i.default)(d.ssrcGroups||[]);!(b=(P=S.next()).done);b=!0){var w=P.value;if("FID"===w.semantics){var T=w.ssrcs.split(/\s+/),A=(0,n.default)(T,2),E=A[0],R=A[1];E=Number(E),R=Number(R),l.has(E)&&(l.delete(E),l.delete(R),y.set(E,R))}}}catch(e){I=!0,k=e}finally{try{!b&&S.return&&S.return()}finally{if(I)throw k}}var C=!0,O=!1,x=void 0;try{for(var D,N=(0,i.default)(l);!(C=(D=N.next()).done);C=!0){var L=D.value;y.set(L,null)}}catch(e){O=!0,x=e}finally{try{!C&&N.return&&N.return()}finally{if(O)throw x}}var M=d.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===u}));M&&(c.cname=M.value);e.rtcp=c,e.encodings=[];var B=y.size>1,V=["low","medium","high"],j=!0,F=!1,U=void 0;try{for(var H,G=(0,i.default)(y);!(j=(H=G.next()).done);j=!0){var K=(0,n.default)(H.value,2),W=K[0],z=(R=K[1],{ssrc:W});R&&(z.rtx={ssrc:R}),B&&(z.profile=V.shift()),e.encodings.push(z)}}catch(e){F=!0,U=e}finally{try{!j&&G.return&&G.return()}finally{if(F)throw U}}},t.addSimulcastForTrack=function(e,t){var r=t.kind,n=(e.media||[]).find((function(e){return e.type===r}));if(!n)throw new Error("m="+r+" section not found");var i=void 0,a=void 0,o=void 0;if(!(n.ssrcs||[]).find((function(e){return"msid"===e.attribute&&(e.value.split(" ")[1]===t.id?(i=e.id,o=e.value.split(" ")[0],!0):void 0)})))throw new Error("a=ssrc line not found for local track [track.id:"+t.id+"]");(n.ssrcGroups||[]).some((function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===i?(a=Number(t[1]),!0):void 0}}));var s=n.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===i}));if(!s)throw new Error("CNAME line not found for local track [track.id:"+t.id+"]");var c=s.value,d=i+1,u=i+2;if(n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.push({semantics:"SIM",ssrcs:i+" "+d+" "+u}),n.ssrcs.push({id:d,attribute:"cname",value:c}),n.ssrcs.push({id:d,attribute:"msid",value:o+" "+t.id}),n.ssrcs.push({id:u,attribute:"cname",value:c}),n.ssrcs.push({id:u,attribute:"msid",value:o+" "+t.id}),a){var l=a+1,p=a+2;n.ssrcGroups.push({semantics:"FID",ssrcs:d+" "+l}),n.ssrcs.push({id:l,attribute:"cname",value:c}),n.ssrcs.push({id:l,attribute:"msid",value:o+" "+t.id}),n.ssrcGroups.push({semantics:"FID",ssrcs:u+" "+p}),n.ssrcs.push({id:p,attribute:"cname",value:c}),n.ssrcs.push({id:p,attribute:"msid",value:o+" "+t.id})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(43)),i=f(r(9)),a=f(r(2)),o=f(r(3)),s=f(r(4)),c=f(r(0)),d=f(r(1)),u=f(r(13)),l=f(r(5)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default("<RemotePlanBSdp>"),h=function(){function e(t){(0,c.default)(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:p.randomNumber(),version:0}}return(0,d.default)(e,[{key:"setTransportLocalParameters",value:function(e){m.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){m.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){m.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:"createAnswerSdp",value:function(e){if(m.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,o={},s=(e.media||[]).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},o.groups=[{type:"BUNDLE",mids:s.join(" ")}],o.media=[];var c=a.fingerprints.length;o.fingerprint={type:a.fingerprints[c-1].algorithm,hash:a.fingerprints[c-1].value};var d=!0,l=!1,p=void 0;try{for(var f,h=(0,i.default)(e.media||[]);!(d=(f=h.next()).done);d=!0){var v=f.value,_=v.type,g=this._rtpParametersByKind[_].codecs,y=this._rtpParametersByKind[_].headerExtensions,b={};b.type=v.type,b.port=7,b.protocol="RTP/SAVPF",b.connection={ip:"127.0.0.1",version:4},b.mid=v.mid,b.iceUfrag=t.usernameFragment,b.icePwd=t.password,b.candidates=[];var I=!0,k=!1,P=void 0;try{for(var S,w=(0,i.default)(r);!(I=(S=w.next()).done);I=!0){var T=S.value,A={component:1};A.foundation=T.foundation,A.ip=T.ip,A.port=T.port,A.priority=T.priority,A.transport=T.protocol,A.type=T.type,T.tcpType&&(A.tcptype=T.tcpType),b.candidates.push(A)}}catch(e){k=!0,P=e}finally{try{!I&&w.return&&w.return()}finally{if(k)throw P}}switch(b.endOfCandidates="end-of-candidates",b.iceOptions="renomination",a.role){case"client":b.setup="active";break;case"server":b.setup="passive"}switch(v.direction){case"sendrecv":case"sendonly":b.direction="recvonly";break;case"recvonly":case"inactive":b.direction="inactive"}"video"===_&&(b.xGoogleFlag="conference"),b.rtp=[],b.rtcpFb=[],b.fmtp=[];var E=!0,R=!1,C=void 0;try{for(var O,x=(0,i.default)(g);!(E=(O=x.next()).done);E=!0){var D=O.value,N={payload:D.payloadType,codec:D.name,rate:D.clockRate};if(D.channels>1&&(N.encoding=D.channels),b.rtp.push(N),D.parameters){var L={payload:D.payloadType,config:""},M=!0,B=!1,V=void 0;try{for(var j,F=(0,i.default)((0,n.default)(D.parameters));!(M=(j=F.next()).done);M=!0){var U=j.value;L.config&&(L.config+=";"),L.config+=U+"="+D.parameters[U]}}catch(e){B=!0,V=e}finally{try{!M&&F.return&&F.return()}finally{if(B)throw V}}L.config&&b.fmtp.push(L)}if(D.rtcpFeedback){var H=!0,G=!1,K=void 0;try{for(var W,z=(0,i.default)(D.rtcpFeedback);!(H=(W=z.next()).done);H=!0){var q=W.value;b.rtcpFb.push({payload:D.payloadType,type:q.type,subtype:q.parameter||""})}}catch(e){G=!0,K=e}finally{try{!H&&z.return&&z.return()}finally{if(G)throw K}}}}}catch(e){R=!0,C=e}finally{try{!E&&x.return&&x.return()}finally{if(R)throw C}}b.payloads=g.map((function(e){return e.payloadType})).join(" "),b.ext=[];var X=!0,J=!1,Y=void 0;try{for(var Q,$=function(){var e=Q.value;if(!(v.ext||[]).find((function(t){return t.uri===e.uri})))return"continue";b.ext.push({uri:e.uri,value:e.id})},Z=(0,i.default)(y);!(X=(Q=Z.next()).done);X=!0)$()}catch(e){J=!0,Y=e}finally{try{!X&&Z.return&&Z.return()}finally{if(J)throw Y}}b.rtcpMux="rtcp-mux",b.rtcpRsize="rtcp-rsize",o.media.push(b)}}catch(e){l=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(l)throw p}}return u.default.write(o)}}]),t}(h),_=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:"createOfferSdp",value:function(e,t){var r=this;if(m.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var a=this._transportRemoteParameters.iceParameters,o=this._transportRemoteParameters.iceCandidates,s=this._transportRemoteParameters.dtlsParameters,c={},d=e;this._sdpGlobalFields.version++,c.version=0,c.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},c.name="-",c.timing={start:0,stop:0},c.icelite=a.iceLite?"ice-lite":null,c.msidSemantic={semantic:"WMS",token:"*"},c.groups=[{type:"BUNDLE",mids:d.join(" ")}],c.media=[];var l=s.fingerprints.length;c.fingerprint={type:s.fingerprints[l-1].algorithm,hash:s.fingerprints[l-1].value};var p=!0,f=!1,h=void 0;try{for(var v,_=function(){var e=v.value,s=r._rtpParametersByKind[e].codecs,d=r._rtpParametersByKind[e].headerExtensions,u={};u.type=e,u.port=7,u.protocol="RTP/SAVPF",u.connection={ip:"127.0.0.1",version:4},u.mid=e,u.iceUfrag=a.usernameFragment,u.icePwd=a.password,u.candidates=[];var l=!0,p=!1,f=void 0;try{for(var m,h=(0,i.default)(o);!(l=(m=h.next()).done);l=!0){var _=m.value,g={component:1};g.foundation=_.foundation,g.ip=_.ip,g.port=_.port,g.priority=_.priority,g.transport=_.protocol,g.type=_.type,_.tcpType&&(g.tcptype=_.tcpType),u.candidates.push(g)}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}u.endOfCandidates="end-of-candidates",u.iceOptions="renomination",u.setup="actpass",t.some((function(t){return t.kind===e}))?u.direction="sendonly":u.direction="inactive",u.rtp=[],u.rtcpFb=[],u.fmtp=[];var y=!0,b=!1,I=void 0;try{for(var k,P=(0,i.default)(s);!(y=(k=P.next()).done);y=!0){var S=k.value,w={payload:S.payloadType,codec:S.name,rate:S.clockRate};if(S.channels>1&&(w.encoding=S.channels),u.rtp.push(w),S.parameters){var T={payload:S.payloadType,config:""},A=!0,E=!1,R=void 0;try{for(var C,O=(0,i.default)((0,n.default)(S.parameters));!(A=(C=O.next()).done);A=!0){var x=C.value;T.config&&(T.config+=";"),T.config+=x+"="+S.parameters[x]}}catch(e){E=!0,R=e}finally{try{!A&&O.return&&O.return()}finally{if(E)throw R}}T.config&&u.fmtp.push(T)}if(S.rtcpFeedback){var D=!0,N=!1,L=void 0;try{for(var M,B=(0,i.default)(S.rtcpFeedback);!(D=(M=B.next()).done);D=!0){var V=M.value;u.rtcpFb.push({payload:S.payloadType,type:V.type,subtype:V.parameter||""})}}catch(e){N=!0,L=e}finally{try{!D&&B.return&&B.return()}finally{if(N)throw L}}}}}catch(e){b=!0,I=e}finally{try{!y&&P.return&&P.return()}finally{if(b)throw I}}u.payloads=s.map((function(e){return e.payloadType})).join(" "),u.ext=[];var j=!0,F=!1,U=void 0;try{for(var H,G=(0,i.default)(d);!(j=(H=G.next()).done);j=!0){var K=H.value;"urn:ietf:params:rtp-hdrext:sdes:mid"!==K.uri&&u.ext.push({uri:K.uri,value:K.id})}}catch(e){F=!0,U=e}finally{try{!j&&G.return&&G.return()}finally{if(F)throw U}}u.rtcpMux="rtcp-mux",u.rtcpRsize="rtcp-rsize",u.ssrcs=[],u.ssrcGroups=[];var W=!0,z=!1,q=void 0;try{for(var X,J=(0,i.default)(t);!(W=(X=J.next()).done);W=!0){var Y=X.value;Y.kind===e&&(u.ssrcs.push({id:Y.ssrc,attribute:"msid",value:Y.streamId+" "+Y.trackId}),u.ssrcs.push({id:Y.ssrc,attribute:"mslabel",value:Y.streamId}),u.ssrcs.push({id:Y.ssrc,attribute:"label",value:Y.trackId}),u.ssrcs.push({id:Y.ssrc,attribute:"cname",value:Y.cname}),Y.rtxSsrc&&(u.ssrcs.push({id:Y.rtxSsrc,attribute:"msid",value:Y.streamId+" "+Y.trackId}),u.ssrcs.push({id:Y.rtxSsrc,attribute:"mslabel",value:Y.streamId}),u.ssrcs.push({id:Y.rtxSsrc,attribute:"label",value:Y.trackId}),u.ssrcs.push({id:Y.rtxSsrc,attribute:"cname",value:Y.cname}),u.ssrcGroups.push({semantics:"FID",ssrcs:Y.ssrc+" "+Y.rtxSsrc})))}}catch(e){z=!0,q=e}finally{try{!W&&J.return&&J.return()}finally{if(z)throw q}}c.media.push(u)},g=(0,i.default)(e);!(p=(v=g.next()).done);p=!0)_()}catch(e){f=!0,h=e}finally{try{!p&&g.return&&g.return()}finally{if(f)throw h}}return u.default.write(c)}}]),t}(h);t.default=function e(t,r){switch((0,c.default)(this,e),m.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new v(r);case"recv":return new _(r)}}},function(e,t){e.exports=!0},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(89),i=r(74);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(22).f,i=r(33),a=r(15)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t,r){var n=r(27),i=r(93),a=r(94),o=r(25),s=r(56),c=r(76),d={},u={};(t=e.exports=function(e,t,r,l,p){var f,m,h,v,_=p?function(){return e}:c(e),g=n(r,l,t?2:1),y=0;if("function"!=typeof _)throw TypeError(e+" is not iterable!");if(a(_)){for(f=s(e.length);f>y;y++)if((v=t?g(o(m=e[y])[0],m[1]):g(e[y]))===d||v===u)return v}else for(h=_.call(e);!(m=h.next()).done;)if((v=i(h,g,m.value,t))===d||v===u)return v}).BREAK=d,t.RETURN=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnsupportedError=t.TimeoutError=t.InvalidStateError=void 0;var n=s(r(2)),i=s(r(0)),a=s(r(3)),o=s(r(4));function s(e){return e&&e.__esModule?e:{default:e}}t.InvalidStateError=function(e){function t(e){(0,i.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,t):r.stack=new Error(e).stack,r}return(0,o.default)(t,e),t}(Error),t.TimeoutError=function(e){function t(e){(0,i.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.name="TimeoutError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,t):r.stack=new Error(e).stack,r}return(0,o.default)(t,e),t}(Error),t.UnsupportedError=function(e){function t(e,r){(0,i.default)(this,t);var o=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return o.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(o,t):o.stack=new Error(e).stack,o.data=r,o}return(0,o.default)(t,e),t}(Error)},function(e,t){},function(e,t,r){var n=r(25),i=r(125),a=r(74),o=r(72)("IE_PROTO"),s=function(){},c=function(){var e,t=r(69)("iframe"),n=a.length;for(t.style.display="none",r(90).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;n--;)delete c.prototype[a[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[o]=e):r=c(),void 0===t?r:i(r,t)}},function(e,t,r){var n=r(66),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(50),i=r(15)("toStringTag"),a="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:a?n(t):"Object"==(o=n(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,r){var n=r(57)("meta"),i=r(19),a=r(33),o=r(22).f,s=0,c=Object.isExtensible||function(){return!0},d=!r(32)((function(){return c(Object.preventExtensions({}))})),u=function(e){o(e,n,{value:{i:"O"+ ++s,w:{}}})},l=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,n)){if(!c(e))return"F";if(!t)return"E";u(e)}return e[n].i},getWeak:function(e,t){if(!a(e,n)){if(!c(e))return!0;if(!t)return!1;u(e)}return e[n].w},onFreeze:function(e){return d&&l.NEED&&c(e)&&!a(e,n)&&u(e),e}}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){"use strict";t.__esModule=!0;var n=a(r(170)),i=a(r(9));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,n.default)(Object(e)))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=(0,i.default)(e);!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(26),a=(n=i)&&n.__esModule?n:{default:n};t.getProtooUrl=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3443,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"isac32",s="";s=""===a.length?"wss://"+n+":"+i+"/?peerName="+e+"&roomId="+t+"_"+r+"&audioPt="+o:"wss://"+n+":"+i+a+"/?peerName="+e+"&roomId="+t+"_"+r+"&audioPt="+o;return s},t.uuid=function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},t.clone=function e(t){if(!t||"object"!==(void 0===t?"undefined":(0,a.default)(t)))return t;if(t instanceof Date){var r=new Date;return r.setTime(t.getTime()),r}if(t instanceof Array){for(var n=[],i=t.length,o=0;o<i;++o)n[o]=e(t[o]);return n}if(t instanceof Object){var s={};for(var c in t)t.hasOwnProperty(c)&&(s[c]=e(t[c]));return s}throw new Error("Unable to copy obj! Its type isn't supported.")}},function(e,t,r){e.exports={default:r(202),__esModule:!0}},function(e,t,r){e.exports=r(120)},function(e,t,r){"use strict";t.__esModule=!0;var n,i=r(6),a=(n=i)&&n.__esModule?n:{default:n};t.default=function(e){return function(){var t=e.apply(this,arguments);return new a.default((function(e,r){return function n(i,o){try{var s=t[i](o),c=s.value}catch(e){return void r(e)}if(!s.done)return a.default.resolve(c).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(c)}("next")}))}}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){"use strict";var n=r(46),i=r(12),a=r(88),o=r(28),s=r(39),c=r(124),d=r(51),u=r(91),l=r(15)("iterator"),p=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,r,m,h,v,_){c(r,t,m);var g,y,b,I=function(e){if(!p&&e in w)return w[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},k=t+" Iterator",P="values"==h,S=!1,w=e.prototype,T=w[l]||w["@@iterator"]||h&&w[h],A=T||I(h),E=h?P?I("entries"):A:void 0,R="Array"==t&&w.entries||T;if(R&&(b=u(R.call(new e)))!==Object.prototype&&b.next&&(d(b,k,!0),n||"function"==typeof b[l]||o(b,l,f)),P&&T&&"values"!==T.name&&(S=!0,A=function(){return T.call(this)}),n&&!_||!p&&!S&&w[l]||o(w,l,A),s[t]=A,s[k]=f,h)if(g={values:P?A:I("values"),keys:v?A:I("keys"),entries:E},_)for(y in g)y in w||a(w,y,g[y]);else i(i.P+i.F*(p||S),t,g);return g}},function(e,t,r){var n=r(19),i=r(14).document,a=n(i)&&n(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,r){var n=r(19);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var n=r(50);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(73)("keys"),i=r(57);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t,r){var n=r(7),i=r(14),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(46)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(58),i=r(15)("iterator"),a=r(39);e.exports=r(7).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||a[n(e)]}},function(e,t,r){"use strict";var n=r(47);function i(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new i(e)}},function(e,t,r){var n=r(28);e.exports=function(e,t,r){for(var i in t)r&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},function(e,t,r){var n=r(12),i=r(7),a=r(32);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],o={};o[e]=t(r),n(n.S+n.F*a((function(){r(1)})),"Object",o)}},function(e,t,r){t.f=r(15)},function(e,t,r){var n=r(14),i=r(7),a=r(46),o=r(80),s=r(22).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(19);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e){e.exports=JSON.parse('{"name":"tttwebsdk","version":"3.4.46","description":"webrtc of 3ttech.cn","buildDate":"Jun__2_2020-2","main":"lib/tttrtcweb.js","scripts":{"start":"webpack-dev-server --open","build:app":"webpack","test":"webpack-dev-server --watch --config tests/webpack.config.js","host":"webpack-dev-server --https --host=0.0.0.0 --open --watch  --config tests/webpack.config.js --inline --mode=development","build:dev":"webpack --config webpack.config/webpack.config.dev.js --mode development","build:prod":"webpack --config webpack.config/webpack.config.js","build:test":"webpack --config tests/webpack.config.js","lint":"eslint -c .eslintrc.js lib/protoo lib/client.js lib/stats.js lib/config.js lib/utils.js lib/stream.js lib/tttrtcweb.js"},"author":"3ttech.cn","license":"ISC","dependencies":{"babel-runtime":"^6.26.0","bowser":"^1.9.3","debug":"^4.1.1","hark":"^1.2.3","random-number":"^0.0.9","retry":"^0.12.0","websocket":"^1.0.28"},"devDependencies":{"babel-core":"^6.26.3","babel-loader":"^7.1.1","babel-plugin-transform-runtime":"^6.23.0","babel-polyfill":"^6.26.0","babel-preset-env":"^1.7.0","babel-preset-es2015":"^6.24.1","babel-preset-stage-0":"^6.24.1","copy-webpack-plugin":"^5.0.4","eslint":"^5.16.0","eslint-plugin-react":"^7.13.0","html-webpack-plugin":"^3.2.0","http-server":"^0.11.1","jest":"^24.9.0","jest-websocket-mock":"^1.5.0","mock-socket":"^9.0.0","sweetalert2":"^8.11.4","webpack":"^4.41.0","webpack-cli":"^3.2.3","webpack-dev-server":"^3.1.14","webpack-jquery-ui":"^2.0.1"},"files":["lib/","screen/","docs/","README.md","CHANGELOG.md"]}')},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=g(r(0)),i=g(r(1)),a=g(r(35)),o=g(r(5)),s=g(r(184)),c=g(r(195)),d=g(r(196)),u=g(r(197)),l=(g(r(198)),g(r(199))),p=g(r(200)),f=g(r(201)),m=g(r(205)),h=g(r(206)),v=g(r(207)),_=g(r(209));function g(e){return e&&e.__esModule?e:{default:e}}var y=new o.default("Device"),b=function(){function t(){(0,n.default)(this,t)}return(0,i.default)(t,null,[{key:"setHandler",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t._detected=!0,t._handlerClass=e,t._flag=r.flag,t._name=r.name,t._version=r.version,t._bowser=r.bowser||{}}},{key:"getFlag",value:function(){return t._detected||t._detect(),t._flag}},{key:"getName",value:function(){return t._detected||t._detect(),t._name}},{key:"getVersion",value:function(){return t._detected||t._detect(),t._version}},{key:"getBowser",value:function(){return t._detected||t._detect(),t._bowser}},{key:"isSupported",value:function(){return t._detected||t._detect(),Boolean(t._handlerClass)}},{key:"_detect",value:function(){if(t._detected=!0,e.navigator&&"ReactNative"===e.navigator.product)t._flag="react-native",t._name="ReactNative",t._version=void 0,t._bowser={},t._handlerClass=_.default;else if(e.navigator&&"string"==typeof e.navigator.userAgent){var r=e.navigator.userAgent,n=a.default.detect(r);if(t._flag=void 0,t._name=n.name||void 0,t._version=n.version||void 0,t._bowser=n,t._handlerClass=null,a.default.check({chrome:"70",chromium:"70"},!0,r))t._flag="chrome",t._handlerClass=s.default;else if(a.default.check({chrome:"69",chromium:"69"},!0,r))t._flag="chrome",t._handlerClass=c.default;else if(a.default.check({chrome:"67",chromium:"67"},!0,r))t._flag="chrome",t._handlerClass=d.default;else if(a.default.check({chrome:"55",chromium:"55"},!0,r))t._flag="chrome",t._handlerClass=u.default;else if(a.default.check({chrome:"49",chromium:"49"},!0,r)&&e.adapter)t._flag="chrome",t._handlerClass=u.default;else if(a.default.check({firefox:"65"},!0,r))t._flag="firefox",t._handlerClass=f.default;else if(a.default.check({firefox:"59"},!0,r))t._flag="firefox",t._handlerClass=m.default;else if(a.default.check({firefox:"50"},!0,r))t._flag="firefox",t._handlerClass=h.default;else if(a.default.check({safari:"12.1"},!0,r)&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))t._flag="safari",t._handlerClass=l.default;else if(a.default.check({safari:"11"},!0,r))t._flag="safari",t._handlerClass=p.default;else if(a.default.check({msedge:"11"},!0,r))t._flag="msedge",t._handlerClass=v.default;else if(a.default.check({opera:"57"},!0,r))t._flag="opera",t._handlerClass=s.default;else if(a.default.check({opera:"44"},!0,r))t._flag="opera",t._handlerClass=u.default;else if(n.chromium||n.blink||n.webkit){y.debug('best effort Chrome based browser detection [name:"%s"]',n.name),t._flag="chrome";var i=r.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(i){var o=Number(i[1]);t._handlerClass=o>=70?s.default:o>=69?c.default:o>=67?d.default:u.default}else t._handlerClass=s.default}t.isSupported()?y.debug('browser supported [flag:%s, name:"%s", version:%s, handler:%s]',t._flag,t._name,t._version,t._handlerClass.tag):y.warn("browser not supported [name:%s, version:%s]",t._name,t._version)}else y.warn("device not supported")}},{key:"Handler",get:function(){return t._detected||t._detect(),t._handlerClass}}]),t}();t.default=b,b._detected=!1,b._flag=void 0,b._name=void 0,b._version=void 0,b._bowser=void 0,b._handlerClass=null}).call(this,r(38))},function(e,t,r){"use strict";t.__esModule=!0;var n,i=r(63),a=(n=i)&&n.__esModule?n:{default:n};t.default=a.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},function(e,t,r){e.exports=!r(23)&&!r(32)((function(){return 7!=Object.defineProperty(r(69)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){e.exports=r(28)},function(e,t,r){var n=r(33),i=r(40),a=r(126)(!1),o=r(72)("IE_PROTO");e.exports=function(e,t){var r,s=i(e),c=0,d=[];for(r in s)r!=o&&n(s,r)&&d.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~a(d,r)||d.push(r));return d}},function(e,t,r){var n=r(14).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(33),i=r(34),a=r(72)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(25);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var a=e.return;throw void 0!==a&&n(a.call(e)),t}}},function(e,t,r){var n=r(39),i=r(15)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[i]===e)}},function(e,t,r){var n=r(25),i=r(47),a=r(15)("species");e.exports=function(e,t){var r,o=n(e).constructor;return void 0===o||null==(r=n(o)[a])?t:i(r)}},function(e,t,r){var n,i,a,o=r(27),s=r(131),c=r(90),d=r(69),u=r(14),l=u.process,p=u.setImmediate,f=u.clearImmediate,m=u.MessageChannel,h=u.Dispatch,v=0,_={},g=function(){var e=+this;if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}},y=function(e){g.call(e.data)};p&&f||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return _[++v]=function(){s("function"==typeof e?e:Function(e),t)},n(v),v},f=function(e){delete _[e]},"process"==r(50)(l)?n=function(e){l.nextTick(o(g,e,1))}:h&&h.now?n=function(e){h.now(o(g,e,1))}:m?(a=(i=new m).port2,i.port1.onmessage=y,n=o(a.postMessage,a,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(n=function(e){u.postMessage(e+"","*")},u.addEventListener("message",y,!1)):n="onreadystatechange"in d("script")?function(e){c.appendChild(d("script")).onreadystatechange=function(){c.removeChild(this),g.call(e)}}:function(e){setTimeout(o(g,e,1),0)}),e.exports={set:p,clear:f}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(25),i=r(19),a=r(77);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=a.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){"use strict";var n=r(14),i=r(7),a=r(22),o=r(23),s=r(15)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:n[e];o&&t&&!t[s]&&a.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(15)("iterator"),i=!1;try{var a=[7][n]();a.return=function(){i=!0},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var a=[7],o=a[n]();o.next=function(){return{done:r=!0}},a[n]=function(){return o},e(a)}catch(e){}return r}},function(e,t,r){var n=r(50);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(89),i=r(74).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=r(60),i=r(48),a=r(40),o=r(70),s=r(33),c=r(87),d=Object.getOwnPropertyDescriptor;t.f=r(23)?d:function(e,t){if(e=a(e),t=o(t,!0),c)try{return d(e,t)}catch(e){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t,r){"use strict";var n=r(22).f,i=r(55),a=r(78),o=r(27),s=r(75),c=r(52),d=r(68),u=r(92),l=r(99),p=r(23),f=r(59).fastKey,m=r(83),h=p?"_s":"size",v=function(e,t){var r,n=f(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,d){var u=e((function(e,n){s(e,u,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[h]=0,null!=n&&c(n,r,e[d],e)}));return a(u.prototype,{clear:function(){for(var e=m(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[h]=0},delete:function(e){var r=m(this,t),n=v(r,e);if(n){var i=n.n,a=n.p;delete r._i[n.i],n.r=!0,a&&(a.n=i),i&&(i.p=a),r._f==n&&(r._f=i),r._l==n&&(r._l=a),r[h]--}return!!n},forEach:function(e){m(this,t);for(var r,n=o(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!v(m(this,t),e)}}),p&&n(u.prototype,"size",{get:function(){return m(this,t)[h]}}),u},def:function(e,t,r){var n,i,a=v(e,t);return a?a.v=r:(e._l=a={i:i=f(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=a),n&&(n.n=a),e[h]++,"F"!==i&&(e._i[i]=a)),e},getEntry:v,setStrong:function(e,t,r){d(e,t,(function(e,r){this._t=m(e,t),this._k=r,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?u(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,u(1))}),r?"entries":"values",!r,!0),l(t)}}},function(e,t,r){"use strict";var n=r(14),i=r(12),a=r(59),o=r(32),s=r(28),c=r(78),d=r(52),u=r(75),l=r(19),p=r(51),f=r(22).f,m=r(160)(0),h=r(23);e.exports=function(e,t,r,v,_,g){var y=n[e],b=y,I=_?"set":"add",k=b&&b.prototype,P={};return h&&"function"==typeof b&&(g||k.forEach&&!o((function(){(new b).entries().next()})))?(b=t((function(t,r){u(t,b,e,"_c"),t._c=new y,null!=r&&d(r,_,t[I],t)})),m("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;e in k&&(!g||"clear"!=e)&&s(b.prototype,e,(function(r,n){if(u(this,b,e),!t&&g&&!l(r))return"get"==e&&void 0;var i=this._c[e](0===r?0:r,n);return t?this:i}))})),g||f(b.prototype,"size",{get:function(){return this._c.size}})):(b=v.getConstructor(t,e,_,I),c(b.prototype,r),a.NEED=!0),p(b,e),P[e]=b,i(i.G+i.W+i.F,P),g||v.setStrong(b,e,_),b}},function(e,t,r){var n=r(58),i=r(164);e.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,r){"use strict";var n=r(12);e.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,r){"use strict";var n=r(12),i=r(47),a=r(27),o=r(52);e.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,s,c=arguments[1];return i(this),(t=void 0!==c)&&i(c),null==e?new this:(r=[],t?(n=0,s=a(c,arguments[2],2),o(e,!1,(function(e){r.push(s(e,n++))}))):o(e,!1,r.push,r),new this(r))}})}},function(e,t,r){(function(n){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))}),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(176)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(175))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(18)),i=m(r(2)),a=m(r(0)),o=m(r(1)),s=m(r(3)),c=m(r(4)),d=r(29),u=f(r(62)),l=m(r(30)),p=f(r(42));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}var h=new l.default("<IPLocation>"),v=null,_=p.iplocationPort,g=p.mediaServerAddress,y=!1,b=r(111),I=b.operation({retries:4,factor:2,minTimeout:1e3,maxTimeout:2e3,randomize:!0}),k=function(e){function t(e,r,n,o){(0,a.default)(this,t);var c=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this)),d="";return""===(d=t.privateCloud?v?v.trim():"":p.iplocationAddress.trim())?(o({code:-1,message:"INVALID iplocation address - need set IplocationAddress"}),(0,s.default)(c)):(c.appId=e,c.connectId=u.uuid(),c._url="wss://"+d+":"+_+"/iplocation/",h.debug("constructor: "+c._url),c._wsjson={eType:1,sSEQID:"111111111",mProtocolMsg:{sVersion:"Test_4.2.0.777",bLoadBalance:!1,bReConnect:!1,bVipUser:!1,sIDentify:"7B4FCDBC0914E7182B8EC357F07498F1",sSecret:"c052cd055acfabc5",sVerifyCode:"abcd",sAppID:e,nUserID:+r,sClientVer:"web_1.0",sConnectID:c.connectId,mIpAddrMsg:{bFec:!1,sIp:d,nPort:0}}},c._ws=null,c._closed=!1,c._successcb=n,c._failcb=o,c.reconnectTimes=1,c.firstConnectTime=Date.now(),c.connectedTime=0,c._hasSolve=!1,c._sendRetry={retry:5,timer:0},c._setWebSocket(),c)}return(0,c.default)(t,e),(0,o.default)(t,[{key:"getIpLocationVar",value:function(){return this.svcHost}},{key:"close",value:function(){this._closed||(h.debug("close()"),this._closed=!0,null!==this._ws&&(this._ws.close(),this._ws=null))}},{key:"_setWebSocket",value:function(){var e=this,t=b.operation(I),r=!1;t.attempt((function(i){e._closed?t.stop():(h.debug("_setWebSocket() connecting... [currentAttempt: "+i),e._ws=new WebSocket(e._url),e._ws&&(e._ws.onopen=function(){e._closed||(r=!0,e.connectedTime=Date.now(),e._ws.send((0,n.default)(e._wsjson)),e._sendRetry.timer=setInterval((function(){if(!e._hasSolve){if(0===e._sendRetry.retry)return e._ws&&e._ws.close(),t.retry(!0),void clearInterval(e._sendRetry.timer);e._ws&&e._ws.send((0,n.default)(e._wsjson)),--e._sendRetry.retry}}),500),h.debug("WebSocket event [open]"))},e._ws.onclose=function(n){if(!e._closed)if(h.warn("WebSocket event [close] -- "),4e3===n.code)e._closed=!0;else{if(r){if(t.stop(),e._closed)return;return void e._setWebSocket()}if(e._closed)return;t.retry(!0)&&++e.reconnectTimes}},e._ws.onerror=function(t){e._closed||h.error("WebSocket event [error] - error "+t.name+" "+t.message+" - nothing todo.")},e._ws.onmessage=function(t){if(!e._closed){var r=JSON.parse(t.data);if(1!==r.eResult)return e._failcb({code:r.eResult,message:""}),void e.close();var n=r.mProtocolMsg.mIpAddrMsg;e.svcHost={ip:n.sIp,domain:n.sDomain,port:n.nPort},""!==g&&(e.svcHost={ip:n.sIp,domain:g,port:n.nPort}),e._sendRetry.timer&&(clearInterval(e._sendRetry.timer),e._sendRetry.timer=0),e._hasSolve=!0,e._successcb(e.svcHost,r.mProtocolMsg.mGWIpAddrMsgList),e.close()}}))}))}},{key:"privateCloud",get:function(){return y},set:function(e){y=Boolean(e)}},{key:"info",get:function(){return{reconnectTimes:this.reconnectTimes,connectedTime:this.connectedTime,firstConnectTime:this.firstConnectTime}}}],[{key:"iplocTimeout",set:function(e){if(e){var t=Number(e);t>0&&t<120&&1e3*t}}},{key:"IplocationAddress",set:function(e){h.debug("set IplocationAddress: "+e),v=e},get:function(){return v}},{key:"IplocationPort",set:function(e){h.debug("set IplocationPort: "+e),/^[1-9][0-9]{2,4}$/.test(e)&&(_=e)},get:function(){return _}},{key:"MediaServerAddress",set:function(e){g=e},get:function(){return g}}]),t}(d.EventEmitter);t.default=k},function(e,t,r){e.exports=r(178)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=y(r(6)),i=y(r(64)),a=y(r(65)),o=y(r(18)),s=y(r(2)),c=y(r(0)),d=y(r(1)),u=y(r(3)),l=y(r(4)),p=y(r(8)),f=y(r(30)),m=r(29),h=g(r(42)),v=g(r(62)),_=g(r(180));function g(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function y(e){return e&&e.__esModule?e:{default:e}}var b=r(35),I=r(182),k=new f.default("<Stream>"),P=!1,S=new p.default;e.screen=_;var w=function(e){function t(e){(0,c.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this)),n="";e.userId?(e.userId=e.userId+"",n=e.userId.trim()):e.userID?(e.userID=e.userID+"",n=e.userID.trim()):n="",e.userId=n;var i="";if(e.streamId?(e.streamId=e.streamId+"",i=e.streamId.trim()):e.streamID?(e.streamID=e.streamID+"",i=e.streamID.trim()):i="",e.streamId=i,r._spec=e,r._videoMode="",Boolean(r._spec.codecOptions)&&"string"==typeof r._spec.codecOptions.videoMode){var a=r._spec.codecOptions.videoMode.trim();"smooth"!==a&&"clear"!==a||(r._videoMode=a)}return Boolean(r._spec.codecOptions)&&"smooth"!==r._videoMode&&"clear"!==r._videoMode&&("number"!=typeof r._spec.codecOptions.minBandwidth||"number"!=typeof r._spec.codecOptions.maxBandwidth||"number"!=typeof r._spec.codecOptions.startBitrate||r._spec.codecOptions.minBandwidth>=r._spec.codecOptions.maxBandwidth)&&(r._spec.codecOptions=null),k.debug("constructor() -- this._spec: "+(0,o.default)(r._spec)+" - browser: "+b.name.toLowerCase()+"-"+b.version),r._streamObj=null,r._streamType="",r._spec.streamType&&(r._streamType=r._spec.streamType),r._appData=e.appData?JSON.parse((0,o.default)(e.appData)):{},r._inited=!1,r._uuid=v.uuid(),r._innerStreamID="",r._customStreamID=r._spec.streamId,r._userId=n,r._volume=0,r._isLocalStream=!1,r._webcamProducer=null,r._micProducer=null,r._isAudioOn=!0,r._isVideoOn=!0,r._isAudioPaused=!1,r._isVideoPaused=!1,r._consumerAudio=!1,r._consumerVideo=!1,r._audioPlaying=!1,r._audioPlayStatus=0,r._audio=null,r._videoPlaying=!1,r._videoPlayStatus=0,r._video=null,r._isMicClosed=!1,r._isVideoTrackClosed=!1,r._mediaSourceAudio=!1,r._mediaSourceVideo=!1,r._audioSource=null,r._spec.audioSource&&(r._audioSource=r._spec.audioSource,r._mediaSourceAudio=!0,r._spec.audio=!1),r._videoSource=null,r._spec.videoSource&&(r._videoSource=r._spec.videoSource,r._mediaSourceVideo=!0,r._spec.video=!1,r._spec.screen=!1),r._consumers=new p.default,r._source=r._spec.source,r._subscribed=!1,r._audioSubscribed=!1,r._videoSubscribed=!1,r._ended=!1,r._closed=!1,r._closing=!1,r._default=!1,r._isSubStream=!!r._spec.subStream&&r._spec.subStream,r._keyResolution="480p",r._isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r._published=!1,r._publishState=h.PUBLISH_STATE.IDLE,r._videoType=-1,void 0!==r._spec.videoType&&(r._videoType=r._spec.videoType),r._needUpdateVideoStreamBitrate=!1,r._updateConstraints={},r._videoSpec=null,r._specialCameraId="",r._specialMicId="",r._audioProfile=null,r._enableAudioCtx=!1,r._audioCtx=null,r._gainNode=null,r}var r,f,m,_,g,y,w,T;return(0,l.default)(t,e),(0,d.default)(t,[{key:"init",value:(T=(0,a.default)(i.default.mark((function e(r,n){var s,c,d,u,l,p,f=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug("API init() >> this._userId: "+this._userId+" this._spec: "+(0,o.default)(this._spec)),"function"==typeof r){e.next=4;break}throw k.warn("API init() error - onSuccess have to be a function."),TypeError("onSuccess have to be a function.");case 4:if("function"==typeof n){e.next=7;break}throw k.warn("API init() error - onFailure have to be a function."),TypeError("onFailure have to be a function.");case 7:if(!this._inited){e.next=11;break}return k.warn("API init() << error - [STREAM_HAS_ALREADY_INIT] - this._inited: "+this._inited+" - Stream is init-ing or inited"),n("STREAM_HAS_ALREADY_INIT",{code:h.tttErrCode.STREAM_HAS_ALREADY_INIT,name:"STREAM_HAS_ALREADY_INIT",origin:"",message:"Stream has Already initialized or init-ing"}),e.abrupt("return");case 11:if(s=Boolean(this._spec.video),c=Boolean(this._spec.screen),!(+s+ +c>1)){e.next=18;break}return k.warn("API init() << error - [INVALID_PARAM] - video/screen: only one can be set as true"),n("INVALID_PARAM",{code:h.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"Param of createStream: video/screen - only one can be set as true"}),e.abrupt("return");case 18:if(!b.mobile||!c){e.next=22;break}return k.warn("API init() << error - [NONSUPPORT] - screen - Nonsupport on mobile"),n("NONSUPPORT",{code:h.tttErrCode.NONSUPPORT,name:"NONSUPPORT",origin:"",message:"screen - Nonsupport on mobile"}),e.abrupt("return");case 22:if(this._inited=!0,this._streamType="producer",(Boolean(this._spec.video)||Boolean(this._spec.screen)||Boolean(this._videoSource))&&(this._enableVideoTrack=!0),this._videoType=-1,this._spec.video?this._videoType=0:this._spec.screen?this._videoType=1:this._mediaSourceVideo&&(this._videoType=2),!P){e.next=38;break}if(!this._enableVideoTrack){e.next=35;break}this._audioSource=null,this._mediaSourceAudio=!1,this._spec.audio=!1,k.warn("API init() -- hasDefaultStreamOn: "+P+" - so Mandatory correction this._spec.audio to false"),e.next=38;break;case 35:return k.warn("API init() << error - [NONSUPPORT] - Only one Audio Producer permissible"),n("NONSUPPORT",{code:h.tttErrCode.NONSUPPORT,name:"NONSUPPORT",origin:"",message:"Only one Audio Producer permissible"}),e.abrupt("return");case 38:if(this._videoSpec={width:{min:h.videoSpec.width.min,ideal:h.videoSpec.width.ideal,max:h.videoSpec.width.max},height:{min:h.videoSpec.height.min,ideal:h.videoSpec.height.ideal,max:h.videoSpec.height.max},frameRate:{min:h.videoSpec.frameRate.min,ideal:h.videoSpec.frameRate.ideal,max:h.videoSpec.frameRate.max}},b.mobile&&(this._videoSpec.facingMode=this._spec.useBackCam?{exact:"environment"}:"user"),this._spec.attributes&&(this._spec.attributes.resolution&&("HD720P"===this._spec.attributes.resolution.toUpperCase()&&(this._videoSpec.width.ideal=h.videoAttributes.hd720p[0],this._videoSpec.height.ideal=h.videoAttributes.hd720p[1]),"VGA"===this._spec.attributes.resolution.toUpperCase()&&(this._videoSpec.width.ideal=h.videoAttributes.vga[0],this._videoSpec.height.ideal=h.videoAttributes.vga[1]),"SIF"===this._spec.attributes.resolution.toUpperCase()&&(this._videoSpec.width.ideal=h.videoAttributes.sif[0],this._videoSpec.height.ideal=h.videoAttributes.sif[1]),void 0!==this._spec.attributes.width&&void 0!==this._spec.attributes.height&&(this._videoSpec.width.ideal=this._spec.attributes.width,this._videoSpec.height.ideal=this._spec.attributes.height)),this._spec.attributes.minFrameRate&&this._spec.attributes.maxFrameRate&&(this._videoSpec.frameRate.min=this._spec.attributes.minFrameRate,this._videoSpec.frameRate.max=this._spec.attributes.maxFrameRate,void 0!==this._spec.attributes.idealFrameRate?this._videoSpec.frameRate.ideal=this._spec.attributes.idealFrameRate:this._videoSpec.frameRate.ideal=Math.floor((this._spec.attributes.maxFrameRate-this._spec.attributes.minFrameRate)/2+this._spec.attributes.minFrameRate)),this._spec.attributes.videoProfile&&(d=this._getResolutionByVideoProfile(this._spec.attributes.videoProfile),this._videoSpec.width.ideal=d.width,this._videoSpec.height.ideal=d.height)),u=null,!this._spec.video||!this._spec.audio){e.next=48;break}u={video:this._videoSpec},this._spec.microphoneId&&""!==this._spec.microphoneId.trim()?(u.audio={deviceId:{exact:this._spec.microphoneId.trim()},sampleRate:h.audioSpec.sampleRate,channelCount:h.audioSpec.channelCount},this._specialMicId=this._spec.microphoneId.trim()):u.audio=!0,this._spec.cameraId&&""!==this._spec.cameraId.trim()&&(u.video.deviceId={exact:this._spec.cameraId.trim()},this._specialCameraId=this._spec.cameraId.trim()),e.next=68;break;case 48:if(!this._spec.audio||this._spec.screen||this._spec.video){e.next=53;break}u={video:!1},this._spec.microphoneId&&""!==this._spec.microphoneId.trim()?(u.audio={deviceId:{exact:this._spec.microphoneId.trim()},sampleRate:h.audioSpec.sampleRate,channelCount:h.audioSpec.channelCount},this._specialMicId=this._spec.microphoneId.trim()):u.audio=!0,e.next=68;break;case 53:if(!this._spec.video||this._spec.audio||this._spec.screen){e.next=58;break}u={audio:!1,video:this._videoSpec},this._spec.cameraId&&""!==this._spec.cameraId.trim()&&(u.video.deviceId={exact:this._spec.cameraId.trim()},this._specialCameraId=this._spec.cameraId.trim()),e.next=68;break;case 58:if(!this._spec.screen){e.next=68;break}if(l=!0,"chrome"===b.name.toLowerCase()&&parseInt(b.version,10)<72&&(l=!1),!l){e.next=66;break}return e.next=64,this._startScreenCapture().then(function(){var e=(0,a.default)(i.default.mark((function e(a){var o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f._isLocalStream=!0,f.streamObj=a,f._onEventScreenStreamEnded(a),!Boolean(f._spec.audio)||P){e.next=16;break}return e.prev=4,e.next=7,f._createAudioTrack(f._spec.microphoneId);case 7:o=e.sent,f.audioTracks=o,e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(4),k.warn("API init() << fail - [DEVICE_EXCEPTION] - _startScreenCapture() error - _createAudioTrack fail - "+e.t0.name+" "+e.t0.message),n("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+e.t0.name,message:e.t0.name+" "+e.t0.message}),e.abrupt("return");case 16:return f._innerStreamID=t._genStreamId(!f.hasAudio(),f.userId,f.userId+":"+f.userId+"_0",0,f,f._isSubStream),P||(P=""+f.getId()==""+f.userId),k.debug("API init() _startScreenCapture() << success - this.userID: "+f.userID+" this._innerStreamID: "+f._innerStreamID),r(),e.abrupt("return");case 21:case"end":return e.stop()}}),e,f,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){k.warn("API init() _startScreenCapture() << error - [DEVICE_EXCEPTION] - "+e.name+" "+e.message),n("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+e.name,message:e.name+" "+e.message})}));case 64:e.next=67;break;case 66:window.getScreenId?window.getScreenId((function(e,s,c){if(k.debug("API init() getScreenId() - sourceId: "+s+" screen_constraints: "+(0,o.default)(c)),"firefox"!==s){if(c={video:{mandatory:{chromeMediaSource:"screen",maxWidth:1920,maxHeight:1080,minAspectRatio:1.77}}},"permission-denied"===e)return k.debug("API init() getScreenId() << fail - [PERMISSION_DENIED] - Permission is denied"),void n("PERMISSION_DENIED",{code:h.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:e,message:"getScreen - Permission is denied"});if("not-chrome"===e)return k.debug("API init() getScreenId() << fail - [NONSUPPORT] - Please use chrome"),void n("NONSUPPORT",{code:h.tttErrCode.NONSUPPORT,name:"NONSUPPORT",origin:e,message:"Please use chrome"});!e&&s&&(c.video.mandatory.chromeMediaSource="desktop",c.video.mandatory.chromeMediaSourceId=s)}var d;navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia(c,(d=(0,a.default)(i.default.mark((function e(a){var s;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f._isLocalStream=!0,f.streamObj=a,f._onEventScreenStreamEnded(a),!Boolean(f._spec.audio)||P){e.next=16;break}return e.prev=4,e.next=7,f._createAudioTrack(f._spec.microphoneId);case 7:s=e.sent,f.audioTracks=s,e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(4),k.warn("API init() getScreenId() << error - [DEVICE_EXCEPTION] - "+e.t0.name+" "+e.t0.messsage),n("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+e.t0.name,message:e.t0.name+" "+e.t0.message}),e.abrupt("return");case 16:return f._innerStreamID=t._genStreamId(!f.hasAudio(),f.userId,f.userId+":"+f.userId+"_0",0,f,f._isSubStream),P||(P=""+f.getId()==""+f.userId),k.debug("API init() getScreenId() << success - this.userID: "+f.userID+" this._innerStreamID: "+f._innerStreamID+" screen_constraints: "+(0,o.default)(c)),r(),e.abrupt("return");case 21:case"end":return e.stop()}}),e,f,[[4,11]])}))),function(e){return d.apply(this,arguments)}),(function(e){k.warn("API init() getScreenId() << fail - [DEVICE_EXCEPTION] - "+e.name+" "+e.message+" -- constraints: "+(0,o.default)(c)),n("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+e.name,message:e.name+" "+e.message})}))}),this._spec.audio):k.warn("API init() << fail - getScreenId is undefined");case 67:return e.abrupt("return");case 68:if(!this._spec.video&&!this._spec.audio){e.next=74;break}return k.debug("API init() this.userID: "+this.userID+" this._innerStreamID: "+this._innerStreamID+" this._videoType: "+this._videoType+" constraints: "+(0,o.default)(u)),navigator.mediaDevices.getUserMedia(u).then((function(e){if(f._isLocalStream=!0,f._enableAudioCtx&&!f._isSafari){var n=e.getVideoTracks();if(e.getAudioTracks().length>0){if(!f._audioCtx){var i=window.AudioContext||window.webkitAudioContext;f._audioCtx=new i}if(f._audioCtx&&!f._gainNode&&(f._gainNode=f._audioCtx.createGain(),f._gainNode.gain.value=1),f._audioCtx&&f._gainNode){var a=f._audioCtx.createMediaStreamSource(e);f.target=f._audioCtx.createMediaStreamDestination(),a.connect(f._gainNode),f._gainNode.connect(f.target),n.length>0&&f.target.stream.addTrack(n[0]),f.streamObj=f.target.stream}else f.streamObj=e}else f.streamObj=e}else f.streamObj=e;f._onEventStreamEnded(f.streamObj),f._innerStreamID=t._genStreamId(!f.hasAudio(),f.userId,f.userId+":"+f.userId+"_0",0,f,f._isSubStream),P||(P=""+f.getId()==""+f.userId),k.debug("API init() getUserMedia() << success - this.userID: "+f.userID+" this._innerStreamID: "+f._innerStreamID+" constraints: "+(0,o.default)(u)),r()})).catch((function(e){k.warn("API init() getUserMedia << fail - [DEVICE_EXCEPTION] - "+e.name+" "+e.message+" -- constraints: "+(0,o.default)(u)),n("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+e.name,message:e.name+" "+e.message})})),e.abrupt("return");case 74:if(!this._mediaSourceAudio&&!this._mediaSourceVideo){e.next=78;break}return p={audio:!0,video:!1},navigator.mediaDevices.getUserMedia(p).then((function(e){f._isLocalStream=!0,f._onEventStreamEnded(e);var n=e.getAudioTracks(),i=null;n.length>0&&(i=n[0])&&(i.onended=null,i.stop(),e.removeTrack(i)),f._audioSource&&e.addTrack(f._audioSource),f._videoSource&&e.addTrack(f._videoSource),f.streamObj=e,f._innerStreamID=t._genStreamId(!f.hasAudio(),f.userId,f.userId+":"+f.userId+"_0",0,f,f._isSubStream),P||(P=""+f.getId()==""+f.userId),k.debug("API init() getUserMedia() for [mediasource] << success - this.userID: "+f.userID+" this._innerStreamID: "+f._innerStreamID+" constraints: "+(0,o.default)(p)),r()})).catch((function(e){k.warn("API init() getUserMedia() for [mediasource] << fail - [DEVICE_EXCEPTION] - getUserMedia fail - "+e.name+" "+e.message+" -- constraints: "+(0,o.default)(p)),n("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+e.name,message:e.name+" "+e.message})})),e.abrupt("return");case 78:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"_createAudioTrack",value:function(e){var t=this;if(!this._isLocalStream)return n.default.reject(new Error("_createAudioTrack - non-localStream"));var r={video:!1};return e&&""!==e.trim()?(this._spec.microphoneId=e.trim(),r.audio={deviceId:{exact:this._spec.microphoneId},sampleRate:h.audioSpec.sampleRate,channelCount:h.audioSpec.channelCount},this._specialMicId=this._spec.microphoneId):r.audio=!0,navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,new n.default((function(e,n){navigator.mediaDevices.getUserMedia(r).then((function(r){if(t._enableAudioCtx&&!t._isSafari){if(!t._audioCtx){var n=window.AudioContext||window.webkitAudioContext;t._audioCtx=new n}if(t._audioCtx&&!t._gainNode&&(t._gainNode=t._audioCtx.createGain(),t._gainNode.gain.value=1),t._audioCtx&&t._gainNode){var i=t._audioCtx.createMediaStreamSource(r);t.target=t._audioCtx.createMediaStreamDestination(),i.connect(t._gainNode),t._gainNode.connect(t.target);var a=t.target.stream.getAudioTracks()[0];e(a)}else{var o=r.getAudioTracks()[0];e(o)}}else{var s=r.getAudioTracks()[0];e(s)}})).catch((function(e){n(e)}))}))}},{key:"_createCameraVideoTrack",value:function(e){var t=this;if(!this._isLocalStream)return n.default.reject(new Error("non-localStream"));var r={audio:!1,video:this._videoSpec};return e&&""!==e.trim()&&(this._spec.cameraId=e.trim(),r.video.deviceId={exact:this._spec.cameraId},this._specialCameraId=this._spec.cameraId),navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,new n.default((function(e,n){navigator.mediaDevices.getUserMedia(r).then((function(r){var i=r.getVideoTracks();if(i&&i.length>0){var a=i[0];a?(t._onEventStreamEnded(r),e(a)):n(new Error("no video track"))}else n(new Error("no video track"))})).catch((function(e){n(e)}))}))}},{key:"_createScreenVideoTrack",value:function(){var e,t=this,r=!0;return"chrome"===b.name.toLowerCase()&&parseInt(b.version,10)<72&&(r=!1),r?this._startScreenCapture().then((e=(0,a.default)(i.default.mark((function e(r){var a,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((a=r.getVideoTracks())&&a.length>0)){e.next=11;break}if(!(o=a[0])){e.next=8;break}return t._onEventScreenStreamEnded(r),e.abrupt("return",n.default.resolve(o));case 8:return e.abrupt("return",n.default.reject(new Error("no video track")));case 9:e.next=12;break;case 11:return e.abrupt("return",n.default.reject(new Error("no video track")));case 12:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)})).catch((function(e){return n.default.reject(new Error("_createScreenVideoTrack() error - "+e.name+" "+e.message))})):new n.default((function(e,r){if(!window.getScreenId)return r(new Error("_createScreenVideoTrack() getScreenId is undefined"));window.getScreenId((function(n,s,c){if(k.debug("_createScreenVideoTrack() - sourceId: "+s+" screen_constraints: "+(0,o.default)(c)),"firefox"!==s){if(c={video:{mandatory:{chromeMediaSource:"screen",maxWidth:1920,maxHeight:1080,minAspectRatio:1.77}}},"permission-denied"===n)return r(new Error("_createScreenVideoTrack() - Permission is denied"));if("not-chrome"===n)return r(new Error("_createScreenVideoTrack() - Please use chrome"));!n&&s&&(c.video.mandatory.chromeMediaSource="desktop",c.video.mandatory.chromeMediaSourceId=s)}var d;navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia(c,(d=(0,a.default)(i.default.mark((function n(a){var o,s;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((o=a.getVideoTracks())&&o.length>0)){n.next=11;break}if(!(s=o[0])){n.next=8;break}return t._onEventScreenStreamEnded(a),n.abrupt("return",e(s));case 8:return n.abrupt("return",r(new Error("no video track")));case 9:n.next=12;break;case 11:return n.abrupt("return",r(new Error("no video track")));case 12:case"end":return n.stop()}}),n,t)}))),function(e){return d.apply(this,arguments)}),(function(e){return r(e)}))}),!1)}))}},{key:"_speechEvents",value:function(e){var t=this;if(!this._audioCtx){var r=window.AudioContext||window.webkitAudioContext;this._audioCtx=new r}this._audioCtx&&(this._speach=new I(e,{threshold:-65,audioContext:this._audioCtx}),this._speach.on("volume_change",(function(e,r){e<r?t._volume=0:(t._volume=Math.round(-100*(e-r)/r),t._volume>100&&(t._volume=100)),t.emit("volume-change",{userID:t.userID,volume:t._volume})})),this._speach.on("speaking",(function(){t.emit("speaking",{userID:t.userID})})),this._speach.on("stopped_speaking",(function(){t._volume=0,t.emit("stopped-speaking",{userID:t.userID})})))}},{key:"getId",value:function(){return this._isLocalStream?this._innerStreamID:this._customStreamID}},{key:"attachAudioConsumer",value:function(e){e&&(this._consumerAudio=!0,this._consumers.set(e.id,e))}},{key:"detachAudioConsumer",value:function(e){e&&(this._audioPlaying=!1,this._audioPlayStatus=0,this._consumerAudio=!1,this._consumers.delete(e.id))}},{key:"attachVideoConsumer",value:function(e){e&&(this._consumerVideo=!0,this._consumers.set(e.id,e))}},{key:"detachVideoConsumer",value:function(e){e&&(this._videoPlaying=!1,this._videoPlayStatus=0,this._consumerVideo=!1,this._consumers.delete(e.id))}},{key:"consumerMedia",value:function(e,t,r){"video"===e?this._consumerVideo=t:"audio"===e&&(this._consumerAudio=t),r&&(t?this._consumers.set(r.id,r):this._consumers.delete(r.id))}},{key:"getAttributes",value:function(){}},{key:"getAudioLevel",value:function(){return this._volume}},{key:"hasVideo",value:function(){return!!this._streamObj&&this._streamObj.getVideoTracks().length>0}},{key:"hasAudio",value:function(){return!!this._streamObj&&this._streamObj.getAudioTracks().length>0}},{key:"attachVideoProducer",value:function(e){this._isLocalStream?this._webcamProducer=e:k.warn("API attachVideoProducer() error - this is not local stream")}},{key:"detachVideoProducer",value:function(){this._isLocalStream?this._webcamProducer=null:k.warn("API detachVideoProducer() error - this is not local stream")}},{key:"attachAudioProducer",value:function(e){this._isLocalStream?this._micProducer=e:k.warn("API attachAudioProducer() error - this is not local stream")}},{key:"detachAudioProducer",value:function(){this._isLocalStream?this._micProducer=null:k.warn("API detachAudioProducer() error - this is not local stream")}},{key:"switchDevice",value:function(e,t,r,n){var i=this;if(k.debug("API switchDevice() >> type: "+e+" deviceId: "+t),"function"!=typeof r)throw k.warn("API switchDevice() << error - onSuccess have to be a function."),TypeError("onSuccess have to be a function.");if("function"!=typeof n)throw k.warn("API switchDevice() << error - onFailure have to be a function."),TypeError("onFailure have to be a function.");if(!this._isLocalStream)return k.warn("API switchDevice() << error - [NONSUPPORT] - this is not local stream"),void n("NONSUPPORT",{code:h.tttErrCode.NONSUPPORT,name:"NONSUPPORT",origin:"",message:"This is not localStream"});if(!t||""==t.trim())return k.warn("API switchDevice() << error - [INVALID_PARAM] - deviceId is invalid"),void n("INVALID_PARAM",{code:h.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [deviceId] is invalid"});if("audio"!==e&&"video"!==e)return k.warn("API switchDevice() << error - [INVALID_PARAM] - type must be [audio|video]"),void n("INVALID_PARAM",{code:h.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [type] is invalid - must be : audio or video"});var a=t.trim();"audio"!==e?"video"!==e||this._closeVideo().then((function(){return i._openVideo(a)})).then((function(){k.debug("API switchDevice() << succ - type: "+e+" devId: "+a),r()})).catch((function(t){k.warn("API switchDevice() << fail - [DEVICE_EXCEPTION] - type: "+e+" devId: "+a+" - "+t.name+" "+t.message),n("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+t.name,message:t.name+" "+t.message})})):this._closeMic().then((function(){return i._openMic(a)})).then((function(){k.debug("API switchDevice() << succ - type: "+e+" devId: "+a),r()})).catch((function(t){k.warn("API switchDevice() << fail - [DEVICE_EXCEPTION] - type: "+e+" devId: "+a+" - "+t.name+" "+t.message),n("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+t.name,message:t.name+" "+t.message})}))}},{key:"_openVideo",value:function(e){var t=this;return this.isVideoTrackClosed?this._isLocalStream?n.default.resolve().then((0,a.default)(i.default.mark((function r(){var a;return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=null,0!==t.videoType){r.next=7;break}return r.next=4,t._createCameraVideoTrack(e&&""!==e.trim()?e:t._spec.cameraId);case 4:a=r.sent,r.next=14;break;case 7:if(1!==t.videoType){r.next=13;break}return r.next=10,t._createScreenVideoTrack();case 10:a=r.sent,r.next=14;break;case 13:return r.abrupt("return",n.default.resolve());case 14:if(t.videoTracks=a,t._isVideoTrackClosed=!1,!t._webcamProducer){r.next=19;break}return r.next=19,t._webcamProducer.replaceTrack(a);case 19:return r.abrupt("return",n.default.resolve());case 20:case"end":return r.stop()}}),r,t)})))).catch((function(e){return n.default.reject(e)})):n.default.reject(new Error("non-localStream")):n.default.resolve()}},{key:"_closeVideo",value:function(){var e=this;return this._isLocalStream?this._streamObj?n.default.resolve().then((function(){return 0!==e.videoType&&1!==e.videoType||(e._streamObj&&e._streamObj.getVideoTracks().forEach((function(t){t.onended=null,t.stop(),e._streamObj.removeTrack(t)})),e._isVideoTrackClosed=!0,e._webcamProducer&&e._webcamProducer.stopTrack()),n.default.resolve()})).catch((function(e){return n.default.reject(e)})):n.default.reject(new Error("stream._streamObj is null")):n.default.reject(new Error("non-localStream"))}},{key:"_openMic",value:function(e){var t=this;return this._spec.audio?this.isMicClosed?this._isLocalStream?n.default.resolve().then((0,a.default)(i.default.mark((function r(){var a;return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._createAudioTrack(e&&""!==e.trim()?e:t._spec.microphoneId);case 2:if(a=r.sent,t.audioTracks=a,t._isMicClosed=!1,!t._micProducer){r.next=14;break}return r.prev=6,r.next=9,t._micProducer.replaceTrack(a);case 9:r.next=14;break;case 11:return r.prev=11,r.t0=r.catch(6),r.abrupt("return",n.default.reject(r.t0));case 14:return r.abrupt("return",n.default.resolve(a));case 15:case"end":return r.stop()}}),r,t,[[6,11]])})))).catch((function(e){return n.default.reject(e)})):n.default.reject(new Error("non-localStream")):n.default.reject(new Error("lack the conditions")):n.default.reject(new Error("not mic stream"))}},{key:"_closeMic",value:function(){var e=this;return this._spec.audio?this._isLocalStream?this._streamObj?n.default.resolve().then((function(){return e._streamObj&&e._streamObj.getAudioTracks().forEach((function(t){t.onended=null,t.stop(),e._streamObj.removeTrack(t)})),e._isMicClosed=!0,e._micProducer&&e._micProducer.stopTrack(),n.default.resolve()})).catch((function(e){return n.default.reject(e)})):n.default.reject(new Error("stream._streamObj is null")):n.default.reject(new Error("non-localStream")):n.default.reject(new Error("not mic stream"))}},{key:"enableVideo",value:(w=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug("API enableVideo() >> this._userId: "+this._userId+" streamId: "+this.getId()),this._isLocalStream){e.next=4;break}return k.warn("API enableVideo() << error - non-localStream"),e.abrupt("return");case 4:if(this._isVideoOn=!0,this._published&&this.emit("resume-video",{stream:this}),!this._video){e.next=15;break}return e.prev=7,e.next=10,this._video.play();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),k.warn("API enableVideo() << fail - this._video.play() error - "+e.t0.name+" "+e.t0.message+" - this._userId: "+this._userId+" streamId: "+this.getId());case 15:case"end":return e.stop()}}),e,this,[[7,12]])}))),function(){return w.apply(this,arguments)})},{key:"disableVideo",value:function(){k.debug("API disableVideo() >> this._userId: "+this._userId+" streamId: "+this.getId()),this._isLocalStream?(this._video&&this._video.pause(),this._isVideoOn=!1,this._published&&(this.emit("pause-video",{stream:this}),k.debug("API disableVideo() << success this._userId: "+this._userId+" streamId: "+this.getId()))):k.warn("API disableVideo() << error - non-localStream")}},{key:"enableAudio",value:function(){k.debug("API enableAudio() >> this._userId: "+this._userId+" streamId: "+this.getId()),this._isLocalStream?(this._isAudioOn=!0,this._published&&this.emit("resume-audio",{stream:this})):k.warn("API enableAudio() << error - non-localStream")}},{key:"disableAudio",value:function(){k.debug("API disableAudio() >> this._userId: "+this._userId+" streamId: "+this.getId()+" this._published: "+this._published),this._isLocalStream?(this._isAudioOn=!1,this._published&&this.emit("pause-audio",{stream:this})):k.warn("API disableAudio() << error - non-localStream")}},{key:"enableVideoAndAudio",value:(y=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug("API enableVideoAndAudio() >> this._userId: "+this._userId+" streamId: "+this.getId()),this._isLocalStream){e.next=4;break}return k.warn("API enableVideoAndAudio() << error - non-localStream"),e.abrupt("return");case 4:if(this._isAudioOn=!0,this._isVideoOn=!0,!this._video){e.next=15;break}return e.prev=7,e.next=10,this._video.play();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),k.warn("API enableVideoAndAudio() << fail - this._video.play() error - "+e.t0.name+" "+e.t0.message+" - this._userId: "+this._userId+" streamId: "+this.getId());case 15:this._published&&(this.emit("resume-audio",{stream:this}),this.emit("resume-video",{stream:this}));case 16:case"end":return e.stop()}}),e,this,[[7,12]])}))),function(){return y.apply(this,arguments)})},{key:"disableVideoAndAudio",value:function(){k.debug("API disableVideoAndAudio() >> this._userId: "+this._userId+" streamId: "+this.getId()),this._isLocalStream?(this._isAudioOn=!1,this._isVideoOn=!1,this._video&&this._video.pause(),this._published&&(this.emit("pause-audio",{stream:this}),this.emit("pause-video",{stream:this}))):k.warn("API disableVideoAndAudio() << error - non-localStream")}},{key:"setAudioProfile",value:function(e){var t=/mobile/i.test(navigator.userAgent),r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);(t||r)&&"isac32"===e&&(e="music_standard");var n=h.audioProfileSpec.get(e);this._audioProfile=n||null,k.debug("API setAudioProfile() profile: "+e+" "+(0,o.default)(this._audioProfile))}},{key:"getAudioProfile",value:function(){return this._audioProfile}},{key:"setVideoProfile",value:function(e,t,r){var n=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if("function"!=typeof t)throw k.warn("API setVideoProfile() error - onSuccess have to be a function."),TypeError("onSuccess have to be a function.");if("function"!=typeof r)throw k.warn("API setVideoProfile() error - onFailure have to be a function."),TypeError("onFailure have to be a function.");if(k.debug("API setVideoProfile() >> this._userId: "+this._userId+" videoProfile: "+e+" streamId: "+this.getId()),!this._isLocalStream)return k.warn("API setVideoProfile() << error - [NONSUPPORT] - non-localStream"),void r("NONSUPPORT",{code:h.tttErrCode.NONSUPPORT,name:"NONSUPPORT",origin:"",message:"only local stream can set video profile"});if(!this._streamObj)return k.warn("API setVideoProfile() << error - [NOT_READY] - stream is null, please init it at first"),void r("NOT_READY",{code:h.tttErrCode.NOT_READY,name:"NOT_READY",origin:"",message:"stream is null, please init it at first"});var c=this._streamObj.getVideoTracks();if(c.length<=0||!c[0])return k.warn("API setVideoProfile() << error - [NONSUPPORT] - no video track."),void r("NONSUPPORT",{code:h.tttErrCode.NONSUPPORT,name:"NONSUPPORT",origin:"",message:"there is no video track"});var d=c[0],u=void 0,l=this._getResolutionByVideoProfile(e),p=l.width,f=l.height;if(u={width:p,height:f},s){if(this._videoMode="",Boolean(this._spec.codecOptions)&&"string"==typeof this._spec.codecOptions.videoMode){var m=this._spec.codecOptions.videoMode.trim();"smooth"!==m&&"clear"!==m||(this._videoMode=m)}var v=!1;if(v="number"==typeof s.minBandwidth&&"number"==typeof s.maxBandwidth&&"number"==typeof s.startBitrate&&!(s.minBandwidth>=s.maxBandwidth),"smooth"!==this._videoMode&&"clear"!==this._videoMode&&!v)return k.warn("API setVideoProfile() << error - [INVALID_PARAM] - codecOptions parameters invalid"),void r("INVALID_PARAM",{code:h.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [codecOptions] is invalid - minBandwidth > = maxBandwidth"});v?(this._spec.codecOptions.minBitrate=s.minBitrate,this._spec.codecOptions.startBitrate=s.startBitrate,this._spec.codecOptions.maxBitrate=s.maxBitrate):(this._spec.codecOptions.minBitrate=0,this._spec.codecOptions.startBitrate=0,this._spec.codecOptions.maxBitrate=0)}d.applyConstraints(u).then((0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n._videoSetting=d.getSettings(),n._getVideoActualResolution(n._videoSetting),!n._published){e.next=8;break}if(!n._webcamProducer){e.next=6;break}return e.next=6,n._webcamProducer.updateTrack(d,u,{idealBandwidth:n.idealBandwidth,maxBandwidth:n.maxBandwidth,minBandwidth:n.minBandwidth});case 6:e.next=10;break;case 8:n._updateConstraints=u,n._needUpdateVideoStreamBitrate=!0;case 10:return k.debug("API setVideoProfile() << success - track.applyConstraints ok -- constraints: "+(0,o.default)(u)),t("applyConstraint success"),e.abrupt("return");case 13:case"end":return e.stop()}}),e,n)})))).catch((function(e){k.warn("API setVideoProfile() << error - [DEVICE_EXCEPTION] - track.applyConstraints fail - "+e.name+" "+e.message),r("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+e.name,message:e.name+" "+e.message})}))}},{key:"getVideoProfile",value:function(){return this.videoResolution}},{key:"setScreenProfile",value:function(){}},{key:"setAudioOutput",value:function(e,t,r){if(k.debug("API setAudioOutput() deviceId: "+e),"function"!=typeof t)throw k.warn("API setAudioOutput() error - onSuccess have to be a function."),TypeError("onSuccess have to be a function.");if("function"!=typeof r)throw k.warn("API setAudioOutput() error - onFailure have to be a function."),TypeError("onFailure have to be a function.");if(!e||""==e.trim())return k.debug("API setAudioOutput() fail - [INVALID_PARAM] - no audio tag"),void r("INVALID_PARAM",{code:h.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"parameter [deviceId] is invalid"});if(!this._audio)return k.debug("API setAudioOutput() fail - [NONSUPPORT] - no audio tag"),void r("NONSUPPORT",{code:h.tttErrCode.NONSUPPORT,name:"NONSUPPORT",origin:"",message:"there is no audio tag"});var n=e.trim();this._audio&&this._audio.setSinkId(n).then((function(){k.debug("Audio output device attached: "+n),t("Audio output device attached: "+n)})).catch((function(e){k.debug("Audio output device attached fail - [DEVICE_EXCEPTION] - "+e.name+" "+e.message),r("DEVICE_EXCEPTION",{code:h.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+e.name,message:e.name+" "+e.message})}))}},{key:"play",value:(g=(0,a.default)(i.default.mark((function e(t,r,n,a){var s,c,d,u=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug("API play() >> elementID: "+t+" opts: "+(0,o.default)(r)+" this._userId: "+this._userId+" streamId: "+this.getId()+" this._isLocalStream: "+this._isLocalStream+" this.hasAudio: "+this.hasAudio()+" this.hasVideo: "+this.hasVideo()),this._streamObj){e.next=5;break}return k.warn("API play() << error - [INVALID_PARAM] - this._streamObj is NULL."),"function"==typeof a&&a("INVALID_PARAM",{code:h.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"parameter [stream._streamObj] is invalid"}),e.abrupt("return");case 5:this.hasVideo()&&((s=document.getElementById(t))?(this._video!==s&&(this._video=s,k.debug("API play() - play Video - this._userId: "+this._userId+" streamId: "+this.getId()+" this._videoPlaying: "+this._videoPlaying),this._video.autoplay=!0,this._video.muted=!0,this._video.controls=!!r&&!!r.isControls,this._video.playsinline=!0,this._video.srcObject=this._streamObj,this._videoPlaying=!1),Boolean(this._video.paused)&&!this._videoPlaying&&(this._videoPlaying=!0,void 0!==(c=this._video.play())&&c.then((function(){u._videoPlayStatus=1,k.debug("API play() - play Video succ - this._video.paused: "+u._video.paused)})).catch((function(e){u._videoPlayStatus=0,u._videoPlaying=!1,k.debug("API play() - play Video fail - "+e.name+" "+e.message)})))):k.warn("API play() - play Video error - elementID: "+t+" not found")),Boolean(this._consumerAudio)&&this.hasAudio()&&!this._isLocalStream&&(k.debug("API play() - play Audio - this._userId: "+this._userId+" streamId: "+this.getId()+" this._audioPlaying: "+this._audioPlaying),this._audio||(this._audio=new Audio,this._audio&&(this._audio.srcObject=this._streamObj,this._audio.muted=!1,this._audio.autoplay=!0)),this._audio&&Boolean(this._audio.paused)&&!this._audioPlaying&&(this._audioPlaying=!0,void 0!==(d=this._audio.play())&&d.then((function(){u._audioPlayStatus=1,k.debug("API play() - play Audio succ - this._audio.paused: "+u._audio.paused)})).catch((function(e){u._audioPlayStatus=0,u._audioPlaying=!1,k.warn("API play() << error - [AUDIO_PLAY_FAIL] - play Audio error - "+e.name+" "+e.message),"function"==typeof a&&a("AUDIO_PLAY_FAIL",{code:h.tttErrCode.AUDIO_PLAY_FAIL,name:"AUDIO_PLAY_FAIL",origin:""+e.name,message:"_audio.play error - "+e.name+" "+e.message})})))),k.debug("API play() << end - streamId: "+this.getId()),"function"==typeof n&&n();case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return g.apply(this,arguments)})},{key:"resume",value:function(){if(k.debug("API resume()"),this._video)try{this._video.play()}catch(e){}if(this._audio)try{this._audio.play()}catch(e){}}},{key:"resumeLocalVideo",value:function(){if(this._isLocalStream&&Boolean(this._video)&&Boolean(this._video.paused))try{this._video.play()}catch(e){}}},{key:"resumeAudioPlay",value:function(){if(k.debug("API resumeAudioPlay() streamId: "+this.getId()),!this._isLocalStream&&Boolean(this._audio)&&Boolean(this._audio.paused)){this._audio.muted=!1;try{this._audio.play()}catch(e){}}}},{key:"resumeVideoPlay",value:function(){if(k.debug("API resumeVideoPlay() streamId: "+this.getId()),!this._isLocalStream&&Boolean(this._video)&&Boolean(this._video.paused)){this._video.muted=!0;try{this._video.play()}catch(e){}}}},{key:"pauseAudioPlay",value:function(){k.debug("API pauseAudioPlay() streamId: "+this.getId()),this._isLocalStream||Boolean(this._audio)&&!this._audio.paused&&(this._audio.muted=!0,this._audio.pause())}},{key:"pauseVideoPlay",value:function(){k.debug("API pauseVideoPlay() streamId: "+this.getId()),this._isLocalStream||Boolean(this._video)&&!this._video.paused&&(this._video.muted=!0,this._video.pause())}},{key:"close",value:(_=(0,a.default)(i.default.mark((function e(t,r){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug("API close() >> this._userId: "+this._userId+" streamId: "+this.getId()),!this._closed&&!this._closing){e.next=4;break}return"function"==typeof r&&t(),e.abrupt("return");case 4:if(this._isLocalStream){e.next=8;break}return k.warn("API close() << error - [NONSUPPORT] - This is not localStream"),"function"==typeof r&&r("NONSUPPORT",{code:h.tttErrCode.NONSUPPORT,name:"NONSUPPORT",origin:"",message:"Stream.close() is nonsupport on remote stream"}),e.abrupt("return");case 8:""+this.getId()==""+this.userId&&(P=!1),S.delete(this.getId()),this._closing=!0,this.emit("@close",this._isLocalStream,{streamId:this.getId(),stream:this,audioProducerId:this.audioProducerId,videoProducerId:this.videoProducerId}),this._streamObj&&this._streamObj.getTracks().forEach((function(e){return e.stop()})),this._streamObj=null,k.debug("API close() track.onended - streamId: "+this.getId()+" - Emit [stream-close]"),this.emit("stream-close",{streamId:this.streamID,stream:this}),this._video&&(this._video.srcObject=null),this._audio&&(this._audio.srcObject=null),this._gainNode=null,this._closed=!0,this._closing=!1,this.removeAllListeners(),k.debug("API close() << success"),"function"==typeof r&&t();case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"_startScreenCapture",value:function(){var e={video:{aspectRatio:1.77,frameRate:15,width:1920,height:1080,resizeMode:"crop-and-scale",cursor:"always"}};return navigator.getDisplayMedia?navigator.getDisplayMedia(e):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(e):navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"}}):(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.getUserMedia,new n.default((function(e,t){navigator.getUserMedia?navigator.getUserMedia({video:{mandatory:{chromeMediaSource:"screen"}}},(function(t){e(t)}),(function(e){t(e)})):t(new Error("unsupported navigator.getUserMedia"))})))}},{key:"_onEventStreamEnded",value:(m=(0,a.default)(i.default.mark((function e(t){var r,n,a=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if((r=t.getVideoTracks())&&!(r.length<=0)){e.next=5;break}return e.abrupt("return");case 5:if(n=r[0]){e.next=8;break}return e.abrupt("return");case 8:n.onended=function(e){k.debug("_onEventStreamEnded() track.onended - streamId: "+a.getId()+" "+e.name+" "+e.message+" - Emit [stream-close]"),a._isVideoTrackClosed=!0,a._ended=!0,setTimeout((function(){a.emit("stream-close",{streamId:a.streamID,stream:a})}))};case 9:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"_onEventScreenStreamEnded",value:(f=(0,a.default)(i.default.mark((function e(t){var r,n,a=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if((r=t.getVideoTracks())&&!(r.length<=0)){e.next=5;break}return e.abrupt("return");case 5:if(n=r[0]){e.next=8;break}return e.abrupt("return");case 8:n.onended=function(e){k.debug("_onEventScreenStreamEnded() track.onended - streamId: "+a.getId()+" "+e.name+" "+e.message+" - Emit [stream-close]"),a._isVideoTrackClosed=!0,a._ended=!0,setTimeout((function(){a.emit("stream-close",{streamId:a.streamID,stream:a}),a.emit("screen-close",{streamId:a.streamID,stream:a})}))};case 9:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"capture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).toISOString().replace(/[-:TZ.]/g,"")+this._customStreamID,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Function;if(k.debug("API capture() - this._userId: "+this._userId+" streamId: "+this.getId()),!this._streamObj)throw k.warn("API capture() error - this._streamObj is NULL."),Error("stream is null, please init it at first.");if(!this._video)throw k.warn("API capture() error - this._video is NULL."),Error("this stream has not be played: "+this._streamObj);var n=document.createElement("canvas");n.width=this._video.videoWidth,n.height=this._video.videoHeight;var i=n.getContext("2d");i.drawImage(this._video,0,0,n.width,n.height),"file"===e?n.toBlob((function(e){r(new File([e],t+".jpeg",{type:"image/jpeg"}))})):r(n.toDataURL("image/jpeg"))}},{key:"setAudioVolume",value:function(e){"number"==typeof e?this._gainNode?(e<0?e=0:e>1.5&&(e=1.5),this._gainNode.gain.value=e,k.debug("API setAudioVolume() success - volume: "+e)):k.warn("API setAudioVolume() error - no gainNode existed."):k.warn("API setAudioVolume() TypeError - volume: "+e)}},{key:"setInputVolume",value:function(e){"number"==typeof e?this._gainNode?(e<0?e=0:e>1.5&&(e=1.5),this._gainNode.gain.value=e,k.debug("API setInputVolume() success - volume: "+e)):k.warn("API setInputVolume() error - no gainNode existed."):k.warn("API setInputVolume() TypeError - volume: "+e)}},{key:"addTrack",value:function(e){}},{key:"removeTrack",value:function(e){}},{key:"replaceTrack",value:(r=(0,a.default)(i.default.mark((function e(t,r,n){var a,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw k.warn("API replaceTrack() error - onSuccess have to be a function."),TypeError("onSuccess have to be a function.");case 3:if("function"==typeof n){e.next=6;break}throw k.warn("API replaceTrack() error - onFailure have to be a function."),TypeError("onFailure have to be a function.");case 6:if(k.debug("API replaceTrack() >> this._userId: "+this._userId+" streamId: "+this.getId()),this._isLocalStream){e.next=11;break}return k.warn("API replaceTrack() << error - [NONSUPPORT] - This is not localStream"),"function"==typeof n&&n("NONSUPPORT",{code:h.tttErrCode.NONSUPPORT,name:"NONSUPPORT",origin:"",message:"Stream.replaceTrack() is nonsupport on remote stream"}),e.abrupt("return");case 11:if(t){e.next=15;break}return k.warn("API replaceTrack() << error - [INVALID_PARAM] - parameter [track] is INVALID"),n("INVALID_PARAM",{code:h.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"parameter [track] is INVALID"}),e.abrupt("return");case 15:a=null,o=null,e.t0=t.kind,e.next="video"===e.t0?20:"audio"===e.t0?34:48;break;case 20:if(e.prev=20,(a=this._streamObj.getVideoTracks())&&a.length>0&&((o=a[0])&&(o.onended=null,o.stop(),this._streamObj.removeTrack(o)),this.videoTracks=t,this._videoSetting=t.getSettings(),this._getVideoActualResolution(this._videoSetting)),!this._webcamProducer){e.next=26;break}return e.next=26,this._webcamProducer.replaceTrack(t);case 26:e.next=33;break;case 28:return e.prev=28,e.t1=e.catch(20),k.warn("API replaceTrack() << error - [SYS_EXCEPTION] - "+e.t1.name+" "+e.t1.message),n("SYS_EXCEPTION",{code:h.tttErrCode.SYS_EXCEPTION,name:"SYS_EXCEPTION",origin:""+e.t1.name,message:e.t1.name+" "+e.t1.message}),e.abrupt("return");case 33:return e.abrupt("break",51);case 34:if(e.prev=34,(a=this._streamObj.getAudioTracks())&&a.length>0&&((o=a[0])&&(o.onended=null,o.stop(),this._streamObj.removeTrack(o)),this.audioTracks=t),!this._micProducer){e.next=40;break}return e.next=40,this._micProducer.replaceTrack(t);case 40:e.next=47;break;case 42:return e.prev=42,e.t2=e.catch(34),k.warn("API replaceTrack() << error - [SYS_EXCEPTION] - "+e.t2.name+" "+e.t2.message),n("SYS_EXCEPTION",{code:h.tttErrCode.SYS_EXCEPTION,name:"SYS_EXCEPTION",origin:""+e.t2.name,message:e.t2.name+" "+e.t2.message}),e.abrupt("return");case 47:return e.abrupt("break",51);case 48:return k.warn("API replaceTrack() << error - invalid track type"),n("INVALID_PARAM",{code:h.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"invalid track type"}),e.abrupt("return");case 51:k.debug("API replaceTrack() << succ - this._userId: "+this._userId+" streamId: "+this.getId());case 52:case"end":return e.stop()}}),e,this,[[20,28],[34,42]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getVideoTrackSettings",value:function(){return this._videoSetting}},{key:"getAudioTrackSetting",value:function(){return this._audioSetting}},{key:"_getVideoActualResolution",value:function(e){e?e.height<=80?this._keyResolution="80p":e.height>80&&e.height<=120?this._keyResolution="120p":e.height>120&&e.height<=160?this._keyResolution="160p":e.height>160&&e.height<=200?this._keyResolution="200p":e.height>200&&e.height<=240?this._keyResolution="240p":e.height>240&&e.height<=320?this._keyResolution="320p":e.height>320&&e.height<=360?this._keyResolution="360p":e.height>360&&e.height<=480?this._keyResolution="480p":e.height>480&&e.height<=540?this._keyResolution="540p":e.height>480&&e.height<=720?this._keyResolution="720p":e.height>720&&e.height<=1080?this._keyResolution="1080p":e.width>1920&&e.width<=2560?this._keyResolution="2k":e.width>2560&&e.width<=3840?this._keyResolution="4k":e.width>3840?this._keyResolution="8k":this._keyResolution="480p":this._keyResolution="480p"}},{key:"_getResolutionByVideoProfile",value:function(e){var t={width:640,height:480};if(!e||"string"!=typeof e)return t;var r=e.toLowerCase(),n=h.videoResolution.get(r);return n&&(t.width=n.width,t.height=n.height),t}},{key:"streamObj",set:function(e){if(this._streamObj=e,e){if(this._isLocalStream){var t=this.videoTracks;if(t&&t.length>0){var r=t[0];this._videoSetting=r.getSettings(),this._getVideoActualResolution(this._videoSetting)}if((t=this.audioTracks)&&t.length>0){var n=t[0];this._audioSetting=n.getSettings()}}e.getAudioTracks().length>0&&this._speechEvents(e)}},get:function(){return this._streamObj}},{key:"isLocalStream",get:function(){return this._isLocalStream}},{key:"isAudioOn",get:function(){return this._isAudioOn}},{key:"isVideoOn",get:function(){return this._isVideoOn}},{key:"isAudioPaused",get:function(){return this._isAudioPaused},set:function(e){this._isAudioPaused=e}},{key:"isVideoPaused",get:function(){return this._isVideoPaused},set:function(e){this._isVideoPaused=e}},{key:"streamType",get:function(){return this._streamType}},{key:"specialCameraId",get:function(){return this._specialCameraId}},{key:"specialMicId",get:function(){return this._specialMicId}},{key:"appData",get:function(){return this._appData}},{key:"uuid",get:function(){return this._uuid}},{key:"closed",get:function(){return this._closed}},{key:"default",get:function(){return this._default},set:function(e){this._isLocalStream&&this.hasVideo()||(this._default=!1),this._default=e}},{key:"streamID",set:function(e){this._customStreamID=e},get:function(){return this._isLocalStream?this._innerStreamID:this._customStreamID}},{key:"streamId",get:function(){return this._isLocalStream?this._innerStreamID:this._customStreamID}},{key:"userID",set:function(e){this._userId=e},get:function(){return this._userId}},{key:"userId",get:function(){return this._userId}},{key:"trackEnded",get:function(){return this._ended}},{key:"consumers",get:function(){return this._consumers}},{key:"isConsumerMedia",get:function(){return this._consumerAudio||this._consumerVideo}},{key:"audioTracks",set:function(e){if(!e)throw new TypeError("parameter [track] is invalid");if("audio"!==e.kind)throw new TypeError("[track] is not audio");if(!this._streamObj)throw new Error("stream._streamObj is null.");var t=this._streamObj.getAudioTracks();if(t&&t.length>0){var r=t[0];r&&(r.onended=null,r.stop(),this._streamObj.removeTrack(r))}this._streamObj.addTrack(e),this._speechEvents(this._streamObj),!this._isLocalStream&&this._audio&&(this._audio.srcObject=this._streamObj)},get:function(){return this._streamObj?this._streamObj.getAudioTracks():null}},{key:"audioTrackStatus",get:function(){if(!this._streamObj)return{};var e=this._streamObj.getAudioTracks();if(e&&e.length>0){var t="";return Boolean(this._audio)&&Boolean(this._audio.error)&&(t=this._audio.error.code+" "+this._audio.error.message),{local:Boolean(this._isLocalStream),id:e[0].id,label:e[0].label,enabled:e[0].enabled,muted:e[0].muted,readyState:e[0].readyState,audioEle:Boolean(this._isLocalStream)?{}:{autoplay:this._audio?this._audio.autoplay:"non-audio",ended:this._audio?this._audio.ended:"non-audio",paused:this._audio?this._audio.paused:"non-audio",muted:this._audio?this._audio.muted:"non-audio",readyState:this._audio?this._audio._readyState:"non-audio",error:t,playStatus:this._audioPlayStatus,volume:this._volume}}}return{}}},{key:"videoTracks",set:function(e){if(!e)throw new TypeError("parameter [track] is invalid");if("video"!==e.kind)throw new TypeError("[track] is not video");if(!this._streamObj)throw new Error("stream._streamObj is null.");var t=this._streamObj.getVideoTracks();if(t&&t.length>0){var r=t[0];r&&(r.onended=null,r.stop(),this._streamObj.removeTrack(r))}this._streamObj.addTrack(e),this._video&&(this._video.srcObject=this._streamObj)},get:function(){return this._streamObj?this._streamObj.getVideoTracks():null}},{key:"videoTrackStatus",get:function(){if(!this._streamObj)return{};var e=this._streamObj.getVideoTracks();if(e&&e.length>0){var t="";return Boolean(this._video)&&Boolean(this._video.error)&&(t=this._video.error.code+" "+this._video.error.message),{local:Boolean(this._isLocalStream),id:e[0].id,label:e[0].label,enabled:e[0].enabled,muted:e[0].muted,readyState:e[0].readyState,videoEle:{autoplay:this._video?this._video.autoplay:"non-video",ended:this._video?this._video.ended:"non-video",paused:this._video?this._video.paused:"non-video",muted:this._video?this._video.muted:"non-video",error:t,playStatus:this._videoPlayStatus,width:this._video?this._video.width:"non-video",height:this._video?this._video.height:"non-video"}}}return{}}},{key:"tracks",get:function(){return this._streamObj?this._streamObj.getTracks():null}},{key:"trackNumber",get:function(){return this._streamObj?this._streamObj.getTracks().length:0}},{key:"audioSubscribed",set:function(e){this._audioSubscribed=e},get:function(){return this._audioSubscribed}},{key:"videoSubscribed",set:function(e){this._videoSubscribed=e},get:function(){return this._videoSubscribed}},{key:"subscribed",set:function(e){this._subscribed=e},get:function(){return this._subscribed}},{key:"type",get:function(){return 1===this.trackNumber&&this.audioTracks&&this.audioTracks.length>0?"audio":"video"}},{key:"published",get:function(){return this._published},set:function(e){return this._published=e}},{key:"publishState",set:function(e){this._publishState=e}},{key:"videoType",set:function(e){this._videoType=+e},get:function(){return this._videoType}},{key:"videoProducerId",get:function(){if(this._isLocalStream&&this._webcamProducer)return this._webcamProducer.id}},{key:"audioProducerId",get:function(){if(this._isLocalStream&&this._micProducer)return this._micProducer.id}},{key:"isMicClosed",get:function(){return this._isMicClosed}},{key:"isVideoTrackClosed",get:function(){return this._isVideoTrackClosed}},{key:"videoResolution",get:function(){if(!this._streamObj)return{};var e=this._streamObj.getVideoTracks();if(e.length<=0)return{};var t=e[0].getSettings();return{width:Number(t.width),height:Number(t.height)}}},{key:"idealBandwidth",get:function(){if(this._spec.codecOptions&&this._spec.codecOptions.startBitrate)return k.debug("API <BW> idealBandwidth - idealKbps: "+this._spec.codecOptions.startBitrate),this._spec.codecOptions.startBitrate;var e=null,t=400;return(e="clear"===this._videoMode?1===this._videoType?h.screenResolutionH.get(this._keyResolution):h.videoResolutionH.get(this._keyResolution):1===this._videoType?h.screenResolution.get(this._keyResolution):h.videoResolution.get(this._keyResolution))&&e.bps&&(t=e.bps.ideal/1e3),k.debug("API <BW> idealBandwidth - idealKbps: "+t),t>0?t:400}},{key:"minBandwidth",get:function(){if(this._spec.codecOptions&&this._spec.codecOptions.minBitrate)return k.debug("API <BW> minBandwidth - minKbps: "+this._spec.codecOptions.minBitrate),this._spec.codecOptions.minBitrate;var e=null,t=300;return(e="clear"===this._videoMode?1===this._videoType?h.screenResolutionH.get(this._keyResolution):h.videoResolutionH.get(this._keyResolution):1===this._videoType?h.screenResolution.get(this._keyResolution):h.videoResolution.get(this._keyResolution))&&e.bps&&(t=e.bps.min/1e3),k.debug("API <BW> minBandwidth - minKbps: "+t),t>0?t:300}},{key:"maxBandwidth",get:function(){if(this._spec.codecOptions&&this._spec.codecOptions.maxBitrate)return k.debug("API <BW> maxBandwidth - maxKbps: "+this._spec.codecOptions.maxBitrate),this._spec.codecOptions.maxBitrate;var e=null,t=500;return(e="clear"===this._videoMode?1===this._videoType?h.screenResolutionH.get(this._keyResolution):h.videoResolutionH.get(this._keyResolution):1===this._videoType?h.screenResolution.get(this._keyResolution):h.videoResolution.get(this._keyResolution))&&e.bps&&(t=e.bps.max/1e3),k.debug("API <BW> maxBandwidth - maxKbps: "+t),t>0?t:500}}],[{key:"clearStreamIdMap",value:function(){S&&S.clear()}},{key:"_genStreamId",value:function(e,r,n,i,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(""===r)return"";if(!e)return r;var s=S.get(""+n);return!s||s.closed?(S.set(""+n,a),n):o?0===i?t._genStreamId(e,r,r+":"+r+"_low",i+1,a):t._genStreamId(e,r,r+":"+r+"_"+i+"_low",i+1,a):t._genStreamId(e,r,r+":"+r+"_"+(i+1),i+1,a)}}]),t}(m.EventEmitter);t.default=w}).call(this,r(38))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.internals=t.Room=void 0;var n=d(r(6));t.setDeviceHandler=function(e,t){a.default.setHandler(e,t)},t.isDeviceSupported=function(){return a.default.isSupported()},t.getDeviceInfo=function(){return{flag:a.default.getFlag(),name:a.default.getName(),version:a.default.getVersion(),bowser:a.default.getBowser()}},t.checkCapabilitiesForRoom=function(e){return a.default.isSupported()?a.default.Handler.getNativeRtpCapabilities().then((function(t){var r=i.getExtendedRtpCapabilities(t,e);return{audio:i.canSend("audio",r),video:i.canSend("video",r)}})):n.default.reject(new Error("current browser/device not supported"))};var i=c(r(16)),a=d(r(85)),o=d(r(210)),s=c(r(216));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}t.Room=o.default,t.internals=s},function(e,t,r){"use strict";var n,i=r(43),a=(n=i)&&n.__esModule?n:{default:n};var o=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]};(0,a.default)(o).forEach((function(e){o[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},function(e,t){!function(t){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error("invalid options, max must be >= min");return{min:t,max:r,integer:n}}function n(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}e.exports=n,e.exports.generator=function(e){return e=r(e),function(t,r,i){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=i?i:e.integer,n(e)}},e.exports.defaults=r}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(26)),i=c(r(0)),a=c(r(1)),o=c(r(30)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(117));function c(e){return e&&e.__esModule?e:{default:e}}var d=new o.default("<protooMessage>"),u=function(){function e(){(0,i.default)(this,e)}return(0,a.default)(e,null,[{key:"parse",value:function(e){var t=void 0,r={};try{t=JSON.parse(e)}catch(e){return void d.error("parse() | invalid JSON: %s",e)}if("object"===(void 0===t?"undefined":(0,n.default)(t))&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void d.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void d.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void d.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void d.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void d.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}return r}d.error("parse() | not an object")}},{key:"requestFactory",value:function(e,t){return{request:!0,id:s.randomNumberGenerator(),method:e,data:t||{}}}},{key:"successResponseFactory",value:function(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}},{key:"errorResponseFactory",value:function(e,t,r){return{response:!0,id:e.id,errorCode:t,errorReason:r}}},{key:"notificationFactory",value:function(e,t){return{notification:!0,method:e,data:t||{}}}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(115);t.randomNumberGenerator=n.generator({min:1e6,max:9999999,integer:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(18)),i=f(r(6)),a=f(r(2)),o=f(r(0)),s=f(r(1)),c=f(r(3)),d=f(r(4)),u=r(29),l=f(r(30)),p=f(r(116));function f(e){return e&&e.__esModule?e:{default:e}}var m=r(221).w3cwebsocket,h=r(111),v=new l.default("<protooWebSocketTransport>"),_={retries:10,factor:2,minTimeout:1e3,maxTimeout:4e3},g=function(e){function t(e,r){(0,o.default)(this,t),v.debug("constructor() - url: "+e);var n=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));n.setMaxListeners(1/0);var i=Date.parse(new Date),s=Math.round(1e9*Math.random());return n._origUrl=e+"&sid="+i+"-"+s,n._url=n._origUrl,n._options=r||{},n._ws=null,n._closed=!1,n._connected=!1,n._operation=null,n._setWebSocket(),n}return(0,d.default)(t,e),(0,s.default)(t,[{key:"reconnect",value:function(e){this.emit("@conn-interrupt",e)}},{key:"send",value:function(e){if(this._closed||!this._ws)return i.default.reject(new Error("transport closed"));try{return this._ws.send((0,n.default)(e)),i.default.resolve()}catch(t){return v.warn("send() messge: "+(0,n.default)(e)+" error - "+t.name+" "+t.message),i.default.reject(t)}}},{key:"close",value:function(){if(v.debug("close()"),!this._closed){this._operation&&this._operation.stop(),this._closed=!0,this.emit("close",{code:1e3,reason:"Normal close"});try{if(!this._ws)throw new Error("this._ws is null");this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close(1e3,"Abnormal close from client")}catch(e){v.warn("close() error - closing the WebSocket: "+e.name+" "+e.message)}}}},{key:"_setWebSocket",value:function(){var e=this;this.removeAllListeners("@conn-interrupt"),this.on("@conn-interrupt",(function(t){v.warn("event - [@conn-interrupt] code: "+t.code+" reason: "+t.reason),e._handleConnInterrupt(t)}));var t=this._options;this._operation=h.operation(this._options.retry||_),this._connected=!1,this._operation.attempt((function(r){if(e._closed)e._operation.stop();else{e._ws&&(e._ws.onopen=null,e._ws.onclose=null,e._ws.onerror=null,e._ws.onmessage=null,e._ws.close(4006,"Clean up the left rubbish"),e._ws=null),v.debug("_setWebSocket() - currentAttempt: "+r);try{if(e._ws=new m(e._url,"protoo",t.origin,t.headers,t.requestOptions,t.clientConfig),!e._ws)return void v.warn("_setWebSocket() - new W3CWebSocket except - this._ws is null")}catch(e){return void v.warn("_setWebSocket() - new W3CWebSocket except - "+e.name+" "+e.message)}e.emit("connecting",r),e._ws.onopen=function(t){if(!e._closed){e._connected=!0;-1!==e._url.indexOf("retry=true",e._url.length-"retry=true".length)?e.emit("conn-reconn",t):e.emit("open",t)}},e._ws.onclose=function(t){e._closed||e.emit("@conn-interrupt",t)},e._ws.onerror=function(t){e._closed||(v.warn("WebSocket event [error] - "+(0,n.default)(t)+" - nothing todo"),e.emit("conn-error",t))},e._ws.onmessage=function(t){if(!e._closed){var r=p.default.parse(t.data);r&&(0!==e.listenerCount("message")?e.emit("message",r):v.warn("no listeners for WebSocket event [message] - ignoring received message"))}}}}))}},{key:"_handleConnInterrupt",value:function(e){if(this.emit("conn-interrupt",e),4e3!==e.code){var t=3003===e.code;if(this._connected||t){if(this._operation.stop(),this._closed)return;return void(t?this.emit("close",e):(this._url=this._origUrl+"&timestamp="+ +new Date+"&retry=true",this._setWebSocket()))}if(this._closed)return;if(this._operation.retry(!0))return;this._operation.stop(),this.emit("close",e)}else this._url=this._origUrl+"&timestamp="+ +new Date,this._closed=!0,this.emit("close",e)}},{key:"connected",get:function(){return this._connected}},{key:"closed",get:function(){return this._closed}}]),t}(u.EventEmitter);t.default=g},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=y(r(64)),i=y(r(65)),a=y(r(18)),o=y(r(2)),s=y(r(0)),c=y(r(1)),d=y(r(3)),u=y(r(4)),l=r(29),p=g(r(42)),f=y(r(167)),m=y(r(112)),h=y(r(30)),v=y(r(110)),_=g(r(113));function g(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function y(e){return e&&e.__esModule?e:{default:e}}var b=r(35),I=r(84),k=new h.default("<TTTRtcWeb>");e.g_client=null;var P=function(t){function r(){(0,s.default)(this,r);var t=(0,d.default)(this,(r.__proto__||(0,o.default)(r)).call(this));k.debug("constructor() - browser: "+b.name+"-"+b.version+" os: "+b.osname+"-"+b.osversion+" bowser.mobile: "+!!b.mobile+" "),m.default.clearStreamIdMap();try{r.listDevices((function(e){k.debug("TTTRtcWeb.listDevices - devices: "+(0,a.default)(e))}),(function(e){var t=e.name+e.message+"\n";k.warn("TTTRtcWeb.listDevices error - "+t)})),k.debug("constructor succ.")}catch(e){k.warn("constructor() fail - "+e.name+" "+e.message)}return e.g_tttRtcWeb=t,t._client=null,t}var l,g;return(0,u.default)(r,t),(0,c.default)(r,[{key:"checkSystemRequirements",value:function(){var e=_.isDeviceSupported();return!!RTCPeerConnection&&!!navigator.mediaDevices.getUserMedia&&!!e}},{key:"getDevices",value:(g=(0,i.default)(n.default.mark((function e(t,r){var i,a;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof t){e.next=3;break}return k.error("API getDevices() error - parameter: onSuccess invalid"),e.abrupt("return");case 3:if("function"==typeof r){e.next=6;break}return k.error("API getDevices() error - parameter: onFailure invalid"),e.abrupt("return");case 6:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=9;break}return k.error("API getDevices() error - enumerateDevices() not supported"),e.abrupt("return");case 9:return e.prev=9,e.next=12,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 12:i=e.sent,(a=i.getTracks())&&a.forEach((function(e){e.stop()})),e.next=19;break;case 17:e.prev=17,e.t0=e.catch(9);case 19:navigator.mediaDevices.enumerateDevices().then((function(e){t(e)})).catch((function(e){r("DEVICE_EXCEPTION",{code:p.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:"",message:"getDevices fail - "+e.name+" "+e.message})}));case 20:case"end":return e.stop()}}),e,this,[[9,17]])}))),function(e,t){return g.apply(this,arguments)})},{key:"createStream",value:function(e){if(!r.isSystemSupported())return k.warn("createStream() - isSystemSupported not supported."),null;if(this._client&&!this._client.isLocalStreamAllowed)return k.warn("createStream() - Client.isLocalStreamAllowed is false"),null;k.debug("createStream() - spec: "+(0,a.default)(e));var t=new m.default(e);return t||null}},{key:"createClient",value:function(t){return r.isSystemSupported()?(e.g_client&&(e.g_client.close(),e.g_client=null),this._client=new f.default(t),e.g_client=this._client,k.debug("createClient() succ - config: "+(0,a.default)(t)),this._client):(k.error("createClient() - isSystemSupported not supported."),null)}},{key:"getStats",value:function(){return null==this._client?{}:this._client.getNetState()}},{key:"version",get:function(){return I.version+"-"+I.buildDate}}],[{key:"isSystemSupported",value:function(){var e=_.isDeviceSupported();return!!RTCPeerConnection&&!!navigator.mediaDevices.getUserMedia&&!!e}},{key:"listDevices",value:(l=(0,i.default)(n.default.mark((function e(t,r){var i,a;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof t){e.next=3;break}return k.error("API listDevices() error - parameter: onSuccess invalid"),e.abrupt("return");case 3:if("function"==typeof r){e.next=6;break}return k.error("API listDevices() error - parameter: onFailure invalid"),e.abrupt("return");case 6:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=9;break}return k.error("API listDevices() error - enumerateDevices() not supported"),e.abrupt("return");case 9:return e.prev=9,e.next=12,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 12:i=e.sent,(a=i.getTracks())&&a.forEach((function(e){e.stop()})),e.next=19;break;case 17:e.prev=17,e.t0=e.catch(9);case 19:navigator.mediaDevices.enumerateDevices().then((function(e){t(e)})).catch((function(e){r("DEVICE_EXCEPTION",{code:p.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:"",message:"listDevices fail - "+e.name+" "+e.message})}));case 20:case"end":return e.stop()}}),e,this,[[9,17]])}))),function(e,t){return l.apply(this,arguments)})},{key:"setSignalTimeout",value:function(e){e&&(v.default.iplocTimeout=e,f.default.signalTimeout=e)}},{key:"setLogLevel",value:function(e){h.default.logLevel=e}},{key:"setLogSubmit",value:function(e){h.default.logSubmit=Boolean(e)}},{key:"setLogStat",value:function(e){f.default.logStat=Boolean(e)}},{key:"setPrivate",value:function(e){h.default.privateCloud=e,v.default.privateCloud=e}},{key:"getVersion",value:function(){return I.version+"-"+I.buildDate}},{key:"setServerUrl",value:function(e){e&&""!==e.trim()?v.default.MediaServerAddress=e.trim():v.default.MediaServerAddress="",k.debug("setServerUrl() - IPLocation.MediaServerAddress: "+v.default.MediaServerAddress)}},{key:"setIpLocationAddress",value:function(e){e&&""!==e.trim()&&(k.debug("setIpLocationAddress() - iplocation: "+e),v.default.IplocationAddress=e)}},{key:"setIpLocationPort",value:function(e){k.debug("setIpLocationPort() - port: "+e),v.default.IplocationPort=e}},{key:"setTurnServers",value:function(e){f.default.TurnConf=e}}]),r}(l.EventEmitter);t.default=P}).call(this,r(38))},function(e,t,r){var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,a=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(121),i)n.regeneratorRuntime=a;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag",c="object"==typeof e,d=t.regeneratorRuntime;if(d)c&&(e.exports=d);else{(d=t.regeneratorRuntime=c?e.exports:{}).wrap=h;var u={},l={};l[a]=function(){return this};var p=Object.getPrototypeOf,f=p&&p(p(T([])));f&&f!==r&&n.call(f,a)&&(l=f);var m=y.prototype=_.prototype=Object.create(l);g.prototype=m.constructor=y,y.constructor=g,y[s]=g.displayName="GeneratorFunction",d.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},d.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(m),e},d.awrap=function(e){return{__await:e}},b(I.prototype),I.prototype[o]=function(){return this},d.AsyncIterator=I,d.async=function(e,t,r,n){var i=new I(h(e,t,r,n));return d.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(m),m[s]="Generator",m[a]=function(){return this},m.toString=function(){return"[object Generator]"},d.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},d.values=T,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}}}function h(e,t,r,n){var i=t&&t.prototype instanceof _?t:_,a=Object.create(i.prototype),o=new w(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return A()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=k(o,r);if(s){if(s===u)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=v(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,o),a}function v(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function _(){}function g(){}function y(){}function b(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function I(e){var t;this._invoke=function(r,i){function a(){return new Promise((function(t,a){!function t(r,i,a,o){var s=v(e[r],e,i);if("throw"!==s.type){var c=s.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?Promise.resolve(d.__await).then((function(e){t("next",e,a,o)}),(function(e){t("throw",e,a,o)})):Promise.resolve(d).then((function(e){c.value=e,a(c)}),o)}o(s.arg)}(r,i,t,a)}))}return t=t?t.then(a,a):a()}}function k(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=v(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,u;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function T(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,r){r(54),r(31),r(41),r(130),r(134),r(135),e.exports=r(7).Promise},function(e,t,r){var n=r(66),i=r(67);e.exports=function(e){return function(t,r){var a,o,s=String(i(t)),c=n(r),d=s.length;return c<0||c>=d?e?"":void 0:(a=s.charCodeAt(c))<55296||a>56319||c+1===d||(o=s.charCodeAt(c+1))<56320||o>57343?e?s.charAt(c):a:e?s.slice(c,c+2):o-56320+(a-55296<<10)+65536}}},function(e,t,r){"use strict";var n=r(55),i=r(48),a=r(51),o={};r(28)(o,r(15)("iterator"),(function(){return this})),e.exports=function(e,t,r){e.prototype=n(o,{next:i(1,r)}),a(e,t+" Iterator")}},function(e,t,r){var n=r(22),i=r(25),a=r(49);e.exports=r(23)?Object.defineProperties:function(e,t){i(e);for(var r,o=a(t),s=o.length,c=0;s>c;)n.f(e,r=o[c++],t[r]);return e}},function(e,t,r){var n=r(40),i=r(56),a=r(127);e.exports=function(e){return function(t,r,o){var s,c=n(t),d=i(c.length),u=a(o,d);if(e&&r!=r){for(;d>u;)if((s=c[u++])!=s)return!0}else for(;d>u;u++)if((e||u in c)&&c[u]===r)return e||u||0;return!e&&-1}}},function(e,t,r){var n=r(66),i=Math.max,a=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):a(e,t)}},function(e,t,r){"use strict";var n=r(129),i=r(92),a=r(39),o=r(40);e.exports=r(68)(Array,"Array",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])}),"values"),a.Arguments=a.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){}},function(e,t,r){"use strict";var n,i,a,o,s=r(46),c=r(14),d=r(27),u=r(58),l=r(12),p=r(19),f=r(47),m=r(75),h=r(52),v=r(95),_=r(96).set,g=r(132)(),y=r(77),b=r(97),I=r(133),k=r(98),P=c.TypeError,S=c.process,w=S&&S.versions,T=w&&w.v8||"",A=c.Promise,E="process"==u(S),R=function(){},C=i=y.f,O=!!function(){try{var e=A.resolve(1),t=(e.constructor={})[r(15)("species")]=function(e){e(R,R)};return(E||"function"==typeof PromiseRejectionEvent)&&e.then(R)instanceof t&&0!==T.indexOf("6.6")&&-1===I.indexOf("Chrome/66")}catch(e){}}(),x=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},D=function(e,t){if(!e._n){e._n=!0;var r=e._c;g((function(){for(var n=e._v,i=1==e._s,a=0,o=function(t){var r,a,o,s=i?t.ok:t.fail,c=t.resolve,d=t.reject,u=t.domain;try{s?(i||(2==e._h&&M(e),e._h=1),!0===s?r=n:(u&&u.enter(),r=s(n),u&&(u.exit(),o=!0)),r===t.promise?d(P("Promise-chain cycle")):(a=x(r))?a.call(r,c,d):c(r)):d(n)}catch(e){u&&!o&&u.exit(),d(e)}};r.length>a;)o(r[a++]);e._c=[],e._n=!1,t&&!e._h&&N(e)}))}},N=function(e){_.call(c,(function(){var t,r,n,i=e._v,a=L(e);if(a&&(t=b((function(){E?S.emit("unhandledRejection",i,e):(r=c.onunhandledrejection)?r({promise:e,reason:i}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=E||L(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},M=function(e){_.call(c,(function(){var t;E?S.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},B=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),D(t,!0))},V=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw P("Promise can't be resolved itself");(t=x(e))?g((function(){var n={_w:r,_d:!1};try{t.call(e,d(V,n,1),d(B,n,1))}catch(e){B.call(n,e)}})):(r._v=e,r._s=1,D(r,!1))}catch(e){B.call({_w:r,_d:!1},e)}}};O||(A=function(e){m(this,A,"Promise","_h"),f(e),n.call(this);try{e(d(V,this,1),d(B,this,1))}catch(e){B.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(78)(A.prototype,{then:function(e,t){var r=C(v(this,A));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=E?S.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&D(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new n;this.promise=e,this.resolve=d(V,e,1),this.reject=d(B,e,1)},y.f=C=function(e){return e===A||e===o?new a(e):i(e)}),l(l.G+l.W+l.F*!O,{Promise:A}),r(51)(A,"Promise"),r(99)("Promise"),o=r(7).Promise,l(l.S+l.F*!O,"Promise",{reject:function(e){var t=C(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!O),"Promise",{resolve:function(e){return k(s&&this===o?A:this,e)}}),l(l.S+l.F*!(O&&r(100)((function(e){A.all(e).catch(R)}))),"Promise",{all:function(e){var t=this,r=C(t),n=r.resolve,i=r.reject,a=b((function(){var r=[],a=0,o=1;h(e,!1,(function(e){var s=a++,c=!1;r.push(void 0),o++,t.resolve(e).then((function(e){c||(c=!0,r[s]=e,--o||n(r))}),i)})),--o||n(r)}));return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=C(t),n=r.reject,i=b((function(){h(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}})},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(14),i=r(96).set,a=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,c="process"==r(50)(o);e.exports=function(){var e,t,r,d=function(){var n,i;for(c&&(n=o.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){o.nextTick(d)};else if(!a||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var u=s.resolve(void 0);r=function(){u.then(d)}}else r=function(){i.call(n,d)};else{var l=!0,p=document.createTextNode("");new a(d).observe(p,{characterData:!0}),r=function(){p.data=l=!l}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){var n=r(14).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){"use strict";var n=r(12),i=r(7),a=r(14),o=r(95),s=r(98);n(n.P+n.R,"Promise",{finally:function(e){var t=o(this,i.Promise||a.Promise),r="function"==typeof e;return this.then(r?function(r){return s(t,e()).then((function(){return r}))}:e,r?function(r){return s(t,e()).then((function(){throw r}))}:e)}})},function(e,t,r){"use strict";var n=r(12),i=r(77),a=r(97);n(n.S,"Promise",{try:function(e){var t=i.f(this),r=a(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t,r){var n=r(7),i=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,r){r(138),e.exports=r(7).Object.getPrototypeOf},function(e,t,r){var n=r(34),i=r(91);r(79)("getPrototypeOf",(function(){return function(e){return i(n(e))}}))},function(e,t,r){e.exports={default:r(140),__esModule:!0}},function(e,t,r){r(141);var n=r(7).Object;e.exports=function(e,t,r){return n.defineProperty(e,t,r)}},function(e,t,r){var n=r(12);n(n.S+n.F*!r(23),"Object",{defineProperty:r(22).f})},function(e,t,r){e.exports={default:r(143),__esModule:!0}},function(e,t,r){r(31),r(41),e.exports=r(80).f("iterator")},function(e,t,r){e.exports={default:r(145),__esModule:!0}},function(e,t,r){r(146),r(54),r(149),r(150),e.exports=r(7).Symbol},function(e,t,r){"use strict";var n=r(14),i=r(33),a=r(23),o=r(12),s=r(88),c=r(59).KEY,d=r(32),u=r(73),l=r(51),p=r(57),f=r(15),m=r(80),h=r(81),v=r(147),_=r(101),g=r(25),y=r(19),b=r(34),I=r(40),k=r(70),P=r(48),S=r(55),w=r(148),T=r(103),A=r(82),E=r(22),R=r(49),C=T.f,O=E.f,x=w.f,D=n.Symbol,N=n.JSON,L=N&&N.stringify,M=f("_hidden"),B=f("toPrimitive"),V={}.propertyIsEnumerable,j=u("symbol-registry"),F=u("symbols"),U=u("op-symbols"),H=Object.prototype,G="function"==typeof D&&!!A.f,K=n.QObject,W=!K||!K.prototype||!K.prototype.findChild,z=a&&d((function(){return 7!=S(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=C(H,t);n&&delete H[t],O(e,t,r),n&&e!==H&&O(H,t,n)}:O,q=function(e){var t=F[e]=S(D.prototype);return t._k=e,t},X=G&&"symbol"==typeof D.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof D},J=function(e,t,r){return e===H&&J(U,t,r),g(e),t=k(t,!0),g(r),i(F,t)?(r.enumerable?(i(e,M)&&e[M][t]&&(e[M][t]=!1),r=S(r,{enumerable:P(0,!1)})):(i(e,M)||O(e,M,P(1,{})),e[M][t]=!0),z(e,t,r)):O(e,t,r)},Y=function(e,t){g(e);for(var r,n=v(t=I(t)),i=0,a=n.length;a>i;)J(e,r=n[i++],t[r]);return e},Q=function(e){var t=V.call(this,e=k(e,!0));return!(this===H&&i(F,e)&&!i(U,e))&&(!(t||!i(this,e)||!i(F,e)||i(this,M)&&this[M][e])||t)},$=function(e,t){if(e=I(e),t=k(t,!0),e!==H||!i(F,t)||i(U,t)){var r=C(e,t);return!r||!i(F,t)||i(e,M)&&e[M][t]||(r.enumerable=!0),r}},Z=function(e){for(var t,r=x(I(e)),n=[],a=0;r.length>a;)i(F,t=r[a++])||t==M||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===H,n=x(r?U:I(e)),a=[],o=0;n.length>o;)!i(F,t=n[o++])||r&&!i(H,t)||a.push(F[t]);return a};G||(s((D=function(){if(this instanceof D)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===H&&t.call(U,r),i(this,M)&&i(this[M],e)&&(this[M][e]=!1),z(this,e,P(1,r))};return a&&W&&z(H,e,{configurable:!0,set:t}),q(e)}).prototype,"toString",(function(){return this._k})),T.f=$,E.f=J,r(102).f=w.f=Z,r(60).f=Q,A.f=ee,a&&!r(46)&&s(H,"propertyIsEnumerable",Q,!0),m.f=function(e){return q(f(e))}),o(o.G+o.W+o.F*!G,{Symbol:D});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)f(te[re++]);for(var ne=R(f.store),ie=0;ne.length>ie;)h(ne[ie++]);o(o.S+o.F*!G,"Symbol",{for:function(e){return i(j,e+="")?j[e]:j[e]=D(e)},keyFor:function(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in j)if(j[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),o(o.S+o.F*!G,"Object",{create:function(e,t){return void 0===t?S(e):Y(S(e),t)},defineProperty:J,defineProperties:Y,getOwnPropertyDescriptor:$,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});var ae=d((function(){A.f(1)}));o(o.S+o.F*ae,"Object",{getOwnPropertySymbols:function(e){return A.f(b(e))}}),N&&o(o.S+o.F*(!G||d((function(){var e=D();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))}))),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(y(t)||void 0!==e)&&!X(e))return _(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!X(t))return t}),n[1]=t,L.apply(N,n)}}),D.prototype[B]||r(28)(D.prototype,B,D.prototype.valueOf),l(D,"Symbol"),l(Math,"Math",!0),l(n.JSON,"JSON",!0)},function(e,t,r){var n=r(49),i=r(82),a=r(60);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var o,s=r(e),c=a.f,d=0;s.length>d;)c.call(e,o=s[d++])&&t.push(o);return t}},function(e,t,r){var n=r(40),i=r(102).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?function(e){try{return i(e)}catch(e){return o.slice()}}(e):i(n(e))}},function(e,t,r){r(81)("asyncIterator")},function(e,t,r){r(81)("observable")},function(e,t,r){e.exports={default:r(152),__esModule:!0}},function(e,t,r){r(153),e.exports=r(7).Object.setPrototypeOf},function(e,t,r){var n=r(12);n(n.S,"Object",{setPrototypeOf:r(154).set})},function(e,t,r){var n=r(19),i=r(25),a=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=r(27)(Function.call,r(103).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return a(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:a}},function(e,t,r){e.exports={default:r(156),__esModule:!0}},function(e,t,r){r(157);var n=r(7).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){var n=r(12);n(n.S,"Object",{create:r(55)})},function(e,t,r){r(54),r(31),r(41),r(159),r(163),r(165),r(166),e.exports=r(7).Map},function(e,t,r){"use strict";var n=r(104),i=r(83);e.exports=r(105)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},function(e,t,r){var n=r(27),i=r(71),a=r(34),o=r(56),s=r(161);e.exports=function(e,t){var r=1==e,c=2==e,d=3==e,u=4==e,l=6==e,p=5==e||l,f=t||s;return function(t,s,m){for(var h,v,_=a(t),g=i(_),y=n(s,m,3),b=o(g.length),I=0,k=r?f(t,b):c?f(t,0):void 0;b>I;I++)if((p||I in g)&&(v=y(h=g[I],I,_),e))if(r)k[I]=v;else if(v)switch(e){case 3:return!0;case 5:return h;case 6:return I;case 2:k.push(h)}else if(u)return!1;return l?-1:d||u?u:k}}},function(e,t,r){var n=r(162);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(19),i=r(101),a=r(15)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(12);n(n.P+n.R,"Map",{toJSON:r(106)("Map")})},function(e,t,r){var n=r(52);e.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},function(e,t,r){r(107)("Map")},function(e,t,r){r(108)("Map")},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=E(r(43)),i=E(r(26)),a=E(r(6)),o=E(r(61)),s=E(r(64)),c=E(r(65)),d=E(r(9)),u=E(r(18)),l=E(r(8)),p=E(r(2)),f=E(r(0)),m=E(r(1)),h=E(r(3)),v=E(r(4)),_=E(r(30)),g=E(r(110)),y=A(r(62)),b=E(r(112)),I=A(r(113)),k=r(29),P=A(r(42)),S=A(r(219)),w=A(r(117)),T=E(r(225));function A(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function E(e){return e&&e.__esModule?e:{default:e}}var R=r(229),C=new _.default("<Client>"),O={},x=!0,D="DISCONNECTED",N="CONNECTING",L="CONNECTED",M="DISCONNECTING",B=function(t){function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,f.default)(this,r);var n=(0,h.default)(this,(r.__proto__||(0,p.default)(r)).call(this));n._spy=!1,n._devices=null,n._mapVideoProducers=new l.default,n._audioProducer=null,n._mapVideoSendTransports=new l.default,n._sendTransport=null,n._recvTransport=null,n._publishStreams=new l.default,n._remoteStreams=new l.default,n._remoteAudios=new l.default,n._remoteVideos=new l.default,n._publishs=new l.default,n._subscribes=new l.default,n._protooTransportStat=!1,n._protooSessionId="",n._protooPeer=null,n._room=null,n._screenProducer=null,n._screenTransport=null,n._iceSendDisconnectedCnt=0,n._iceRecvDisconnectedCnt=0,n._peers=new l.default,n._stats=new T.default,n._interval=3e3,n._hostPath="",n._ip="",n._port=3443,n._path="",n._token=null,n._spec=JSON.parse((0,u.default)(t)),n._useSimulcast=!1,n._tryJoin=0,n._joinTimer=null,n._ipLocation=null,n._iplocTimer=null,n._iplocResoved=!1,n._hasInit=!1,n._closed=!1,n._closing=!1,n._connState=D,n._joined=!1,n._appId="",n._uid="",n._roomId="",e.g_appid="",e.g_userid="",e.g_roomid="",e.g_server="",e.g_connectId="",e.g_sessionId="";var i=/mobile/i.test(navigator.userAgent),a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=/Firefox/i.test(navigator.userAgent),s="string"==typeof t.audioCodec&&""!==t.audioCodec.trim()?t.audioCodec.trim():"isac";if(n._audioCodec=a||i||o?"opus":s,n._h264ProfileLevelId="string"==typeof t.h264ProfileLevelId&&""!==t.h264ProfileLevelId.trim()?t.h264ProfileLevelId.trim():"42e01f",n._disableRtmpVideo=Boolean(t.disableRtmpVideo),n._liveMixerLayout=null,n._timesOfLinkGW=1,n._linkGWTime=0,n._sendGWTime=void 0,n._sendEnterTime=void 0,n._defaultRtmpUrl="",n._valid_rtmp_url="","string"==typeof t.rtmpUrl&&(n._valid_rtmp_url=t.rtmpUrl.trim()),"string"==typeof t.videoMixerBGIUrl&&""!==t.videoMixerBGIUrl.trim()?n._videoMixerBGIUrl=t.videoMixerBGIUrl.trim():(t.videoMixerBGIUrl="http://3ttech.cn/res/tpl/default/images/bk.png",n._videoMixerBGIUrl=t.videoMixerBGIUrl),!/^[123]$/.test(t.role))throw C.warn("API createClient() error - spec: role must be set as 1: master, 2: vice 3: audience."),new TypeError("role must be set as 1: master, 2: vice 3: audience");return n._role=t.role+"",n._statsInterval=null,n._networkQualityInterval=null,n}var _,k,A,E,B,V,j,F,U,H,G,K,W,z,q,X,J,Y,Q,$,Z,ee,te;return(0,v.default)(r,t),(0,m.default)(r,[{key:"getServer",value:function(){return this._hostPath}},{key:"_startNetworkQualityInterval",value:function(){var e=this;this._stopNetworkQualityInterval(),this._networkQualityInterval=setInterval((function(){e._NetworkQuality()}),2e3)}},{key:"_stopNetworkQualityInterval",value:function(){this._networkQualityInterval&&(clearInterval(this._networkQualityInterval),this._networkQualityInterval=null)}},{key:"_startStatInterval",value:function(){var e=this;this._statsInterval=setInterval((function(){if(x){var t=[];e._publishs.forEach((function(e,r){if(e){var n=e.stream?e.stream.audioTrackStatus:{},i=e.stream?e.stream.videoTrackStatus:{},a={streamId:e.streamId,published:e.published,audioTrackStatus:n,videoTrackStatus:i,status:e.status};t.push(a)}}));var r=[];e._subscribes.forEach((function(e,t){if(e){var n=e.stream?e.stream.audioTrackStatus:{},i=e.stream?e.stream.videoTrackStatus:{},a={userId:e.userId,streamId:e.streamId,audioSubscribed:e.audioSubscribed,audioTrackStatus:n,videoSubscribed:e.videoSubscribed,videoTrackStatus:i};r.push(a)}}));var n=[];e._remoteAudios.forEach((function(e,t){n.push(e)}));var i=[];e._remoteVideos.forEach((function(e,t){i.push(e)}));var a={host:e._ip,appId:e._appId,userId:e._uid,role:e._role,roomId:e._roomId,connState:e._connState,joined:e._joined,iceSendTransport:{state:e._sendTransport?e._sendTransport.connectionState:"idle",retryTimeTotal:e._sendTransport?e._sendTransport.retryTimeTotal:0,disconnCnt:e._iceSendDisconnectedCnt},iceRecvTransport:{state:e._recvTransport?e._recvTransport.connectionState:"idle",retryTimeTotal:e._recvTransport?e._recvTransport.retryTimeTotal:0,disconnCnt:e._iceRecvDisconnectedCnt},audioCodec:e._audioCodec,publishs:t,subscribes:r,remoteAudios:n,remoteVideos:i};C.debug("<CLIENT_STAT> "+(0,u.default)(a));var o=e.getNetState();C.debug("<NET_STAT> client NetState: "+(0,u.default)(o));var s=e.localAudioStats();C.debug("<MEDIA_STAT> localAudioStats: "+(0,u.default)(s));var c=e.remoteAudioStats();C.debug("<MEDIA_STAT> remoteAudioStats: "+(0,u.default)(c));var d=e.localVideoStats();C.debug("<MEDIA_STAT> localVideoStats: "+(0,u.default)(d));var l=e.remoteVideoStats();C.debug("<MEDIA_STAT> remoteVideoStats: "+(0,u.default)(l))}}),15e3)}},{key:"_stopStatInterval",value:function(){null!==this._statsInterval&&(clearInterval(this._statsInterval),this._statsInterval=null)}},{key:"init",value:function(t,r,n,i){var a=this;if("function"!=typeof n)throw C.error("API init() error - parameter: onSuccess invalid"),new TypeError("onSuccess parameter must be a function.");if("function"!=typeof i)throw C.error("API init() error - parameter: onFailure invalid"),new TypeError("onFailure parameter must be a function.");if(this._hasInit)return C.error("API init() error - [CLIENT_HAS_ALREADY_INIT] - Client has Already initialized"),void i("CLIENT_HAS_ALREADY_INIT",{code:P.tttErrCode.CLIENT_HAS_ALREADY_INIT,name:"CLIENT_HAS_ALREADY_INIT",origin:"",message:"Client has Already initialized - please client.close() at first"});if(!t||""===(""+t).trim())return C.warn("API init() error - [INVALID_APPID] - parameter: appId invalid"),void i("INVALID_APPID",{code:P.tttErrCode.INVALID_APPID,name:"INVALID_APPID",origin:"",message:"invalid appId"});if(!/^[1-9][0-9]{0,18}$/.test(r))return C.warn("API init() error - [INVALID_USERID] - parameter: userId invalid - uid: "+r),void i("INVALID_USERID",{code:P.tttErrCode.INVALID_USERID,name:"INVALID_USERID",origin:"",message:"userId must be valid number - [1 ~ 9007199254740991]"});if(r>Math.pow(2,53)-1)return C.warn("API init() error - [INVALID_USERID] - parameter: userId number is out of range - [1 ~ 9007199254740991]"),void i("INVALID_USERID",{code:P.tttErrCode.INVALID_USERID,name:"INVALID_USERID",origin:"",message:"userId must be valid number - [1 ~ 9007199254740991]"});this._uid=""+r,e.g_appid=t,e.g_userid=this._uid,this._appId=t,this._stats.setAppid(t),C.debug("API init() appId: "+t+" uid: "+r+" this._spec: "+(0,u.default)(this._spec)),this._startStatInterval();var o=g.default.MediaServerAddress;if(o&&""!==o.trim())return o=o.trim(),this._hostPath=o,this._parseMsHost(o),this._ip&&""!==this._ip?(this._stats.setDomain(this._ip),C.debug("API init() success - special media server: "+this._hostPath),this._watchDeviceChange(),this._hasInit=!0,n()):i("IPLOC_FAIL",{code:P.tttErrCode.IPLOC_FAIL,name:"IPLOC_FAIL",origin:"",message:"iplocation error - msHost: "+o});this._iplocResoved=!1,this._iplocTimer=setTimeout((function(){a._iplocTimer&&(clearTimeout(a._iplocTimer),a._iplocTimer=null),a._ipLocation&&(a._ipLocation.close(),a._ipLocation=null),a._closed=!0,a._iplocResoved||i("IPLOC_FAIL",{code:P.tttErrCode.IPLOC_FAIL,name:"IPLOC_FAIL",origin:"",message:"iplocation error - TIMEOUT"})}),4e3),this._ipLocation=new g.default(t,+r,(function(e,t){return C.debug("API init() success - iplocation alloc server: "+e.domain),a._hostPath=e.domain,a._parseMsHost(e.domain),a._stats.setDomain(a._ip),a._stats.setGWInfo(t),a._stats.setIPlocationInfo(a._ipLocation.info),a._watchDeviceChange(),a._iplocResoved=!0,a._hasInit=!0,a._iplocTimer&&(clearTimeout(a._iplocTimer),a._iplocTimer=null),a._ipLocation&&(a._ipLocation.close(),a._ipLocation=null),n()}),(function(e){a._stopStatInterval(),a._iplocTimer&&(clearTimeout(a._iplocTimer),a._iplocTimer=null),a._ipLocation&&(a._ipLocation.close(),a._ipLocation=null),a._closed||(C.warn("API init() fail - [IPLOC_FAIL] - iplocation error - "+e.code+" "+e.message),i("IPLOC_FAIL",{code:e.code,name:"IPLOC_FAIL",origin:""+e.code,message:"iplocation error - "+e.message+"}"}))}))}},{key:"_parseMsHost",value:function(e){var t=/^(wss?:\/\/)?([0-9a-z.\-_]+)(:[0-9]+)?([/0-9a-z.\-_]+)?(\?[0-9a-z&=]+)?(#[0-9-a-z]+)?/i.exec(e);if(t&&t[2]){var r=t[2];this._ip=r.trim()}if(t&&t[3]){var n=t[3],i=parseInt(n.slice(1));i&&(this._port=i)}else this._port=3443;if(t&&t[4]){var a=t[4];this._path=a.trim()}C.debug("_parseHost msHost: "+e+" this._ip: "+this._ip+" this._port: "+this._port+" this._path: "+this._path)}},{key:"_watchDeviceChange",value:function(){var e=this;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then((function(t){e._devices=JSON.parse((0,u.default)(t));var r=!1;navigator.mediaDevices.ondevicechange=function(t){setTimeout((function(){r||(r=!0,navigator.mediaDevices.enumerateDevices().then((function(t){C.debug("_watchDeviceChange() ondevicechange -- updated-devices: "+(0,u.default)(t)+" - this._devices: "+(0,u.default)(e._devices));var r=[];e._devices.forEach((function(e,n){var i=!1;t.forEach((function(t,r){e.deviceId==t.deviceId&&e.kind==t.kind&&e.label==t.label&&e.groupId==t.groupId&&(i=!0)})),i||"communications"!==e.deviceId&&"default"!==e.deviceId&&r.push(JSON.parse((0,u.default)(e)))}));var n=[];if(t.forEach((function(t,r){var i=!1;e._devices.forEach((function(e,r){t.deviceId==e.deviceId&&t.kind==e.kind&&t.label==e.label&&t.groupId==e.groupId&&(i=!0)})),i||"communications"!==t.deviceId&&"default"!==t.deviceId&&n.push(JSON.parse((0,u.default)(t)))})),e._devices=JSON.parse((0,u.default)(t)),n.length>0||r.length>0){var i={plugDevices:n,pullDevices:r};C.debug("_watchDeviceChange() - Emit [device-hot-plug] to APP - "+(0,u.default)(i)),e.emit("device-hot-plug",i)}})).catch((function(e){C.warn("_watchDeviceChange() fail - "+e.name+" "+e.message)})).finally((function(){r=!1})))}),500)},C.debug("_watchDeviceChange() -- devices: "+(0,u.default)(e._devices))})).catch((function(e){C.warn("_watchDeviceChange() fail - "+e.name+" "+e.message)}))}},{key:"_onClientClose",value:function(e){this._protooTransportStat=!1,C.warn("_onClientClose() - "+e.code+" "+e.reason+" -- call this.close()"),this.close(e)}},{key:"_NetworkQuality",value:function(){var e=0,t=0;if(this._stats){var r=0,n=this._stats.summarize.rtt;n<0||n>1e3?r=5:n<=100?r=1:n<=200?r=2:n<=500?r=3:n<=1e3&&(r=4);var i=0,a=this._stats.summarize.upFractionLost;a>.2?i=5:a<=.02?i=1:a<=.05?i=2:a<=.1?i=3:a<=.2&&(i=4),e=i>r?i:r;var o=0,s=this._stats.summarize.downFractionLost;s>.2?o=5:s<=.02?o=1:s<=.05?o=2:s<=.1?o=3:s<=.2&&(o=4),t=o>r?o:r}var c="failed"===this._sendTransport.connectionState||"disconnected"===this._sendTransport.connectionState,d={downlinkNetworkQuality:"failed"===this._recvTransport.connectionState||"disconnected"===this._recvTransport.connectionState?"6":""+t,uplinkNetworkQuality:c?"6":""+e};this.emit("network-quality",d)}},{key:"_ChangeConnStat",value:function(e){var t=e.event,r=e.state,n=this._connState;this._connState=r;var i={prevState:n,curState:this._connState,description:""+t};C.debug("_ChangeConnStat() event: "+t+" - Emit [connection-state-change] "+(0,u.default)(i)+" to APP"),this.emit("connection-state-change",i)}},{key:"join",value:function(t,r,n,i){var a=this;if("function"!=typeof n)throw C.error("API join() error - parameter: onSuccess invalid"),new TypeError("onSuccess parameter must be a function.");if("function"!=typeof i)throw C.error("API join() error - parameter: onFailure invalid"),new TypeError("onFailure parameter must be a function.");if(this._connState===N)return C.warn("clientConnState.CONNECTING - [TASK_PROCEEDING] - join is running..."),i("TASK_PROCEEDING",{code:P.tttErrCode.TASK_PROCEEDING,name:"TASK_PROCEEDING",origin:"",message:"clientConnState.CONNECTING - join is running..."});if(!/^[1-9][0-9]{0,18}$/.test(r))return C.warn("API join() error - [INVALID_CHANNELID] - parameter: roomId invalid - roomId: "+r),i("INVALID_CHANNELID",{code:P.tttErrCode.INVALID_CHANNELID,name:"INVALID_CHANNELID",origin:"",message:"roomId number is out of range - [1 ~ 9007199254740991]"});if(r>Math.pow(2,53)-1)return C.warn("API join() error - [INVALID_CHANNELID] - parameter: roomId number is out of range - [1 ~ 9007199254740991]"),i("INVALID_CHANNELID",{code:P.tttErrCode.INVALID_CHANNELID,name:"INVALID_CHANNELID",origin:"",message:"roomId number is out of range - [1 ~ 9007199254740991]"});e.g_roomid=r,e.g_server=this._hostPath,C.debug("API join() >> this._hostPath: "+this._hostPath+" - params roomId: "+r+" role: "+this._role+" - tryJoin: "+this._tryJoin),this._token="string"==typeof t&&""!==t?t:null,r+="",this._roomId=r,this._stats.setRoomId(r),this._stats.setUserId(this._uid),this._stats.setRoleType(+this._role);I.getDeviceInfo();var o=y.getProtooUrl(this._uid,r,this._appId,this._ip,this._port,this._path);if(this._linkGWTime=Date.now(),this._protooSessionId=w.randomNumberGenerator(),this._protooPeer&&this._protooPeer.close(),this._protooPeer=new S.Peer(o,this._protooSessionId,this._spec.retries),!this._protooPeer)return this._innerClose({code:4009,reason:"protoo[except]"}),C.warn("API join() << error - [OBJECT_FAIL] - new protooClient.Peer fail"),void i("OBJECT_FAIL",{code:P.tttErrCode.OBJECT_FAIL,name:"OBJECT_FAIL",origin:"",message:"create protooClient.Peer fail"});this.removeAllListeners("@join-success"),this.on("@join-success",(function(e){C.debug("API join() << succ - [@join-success] - connectId: "+e.connectId+" -- Emit [enter] to APP"),a.emit("enter"),a._startNetworkQualityInterval(),n("You are join the room")})),this.removeAllListeners("@join-failure"),this.on("@join-failure",(function(e){C.warn("API join() << fail - [JOIN_FAIL] - "+e),i("JOIN_FAIL",{code:P.tttErrCode.JOIN_FAIL,name:"JOIN_FAIL",origin:"",message:"join-failure: "+e})})),this._joinTimer=setTimeout((function(){if(a._joined)return a._joinTimer&&clearTimeout(a._joinTimer),void(a._joinTimer=null);a._tryJoin++,C.warn("_joinTimer - this._tryJoin: "+a._tryJoin),+a._tryJoin<3?(a._innerClose({code:4007,reason:"join timeout"}),a._room=null,a._protooPeer&&(a._protooPeer.close(),a._protooPeer=null),setTimeout((function(){a.join(a._token,a._roomId,n,i)}))):(C.warn("API join() << fail - [JOIN_FAIL] - join room timeout"),a._joinTimer=null,a._tryJoin=0,a.close({code:5e3,reason:"join timeout"}),a._stats.sendTimeOutLog(a._timesOfLinkGW,12e3),i("JOIN_FAIL",{code:P.tttErrCode.JOIN_FAIL,name:"JOIN_FAIL",origin:"",message:"join timeout"}))}),4e3),this._handleProtooEvent(),this._ChangeConnStat({event:"joining",state:N})}},{key:"_joinRoom",value:function(){var e=this;C.debug("_joinRoom() try to join room...");this._room=new I.Room({requestTimeout:3e4,transportOptions:{udp:!0,tcp:Boolean(!1)},spy:this._spy,iceTransportPolicy:O.iceTransportPolicy||"all",enableTurn:!!O.enableTurn,h264ProfileLevelId:this._h264ProfileLevelId,turnServers:O.iceServers||[]}),this._room.removeAllListeners(),this._room.removeAllListeners("close"),this._room.on("close",(function(t,r){"remote"===t&&(C.warn("room event -- [close] mediasoup Peer/Room remotely closed -- appData: "+(0,u.default)(r)),e._stats.stopHeartBeat())})),this._room.removeAllListeners("request"),this._room.on("request",(function(t,r,n){C.debug("room event -- [request:"+t.method+"] sending to mediasoup "),e._protooPeer&&e._protooPeer.send("mediasoup-request",t).then(r).catch(n)})),this._room.removeAllListeners("notify"),this._room.on("notify",(function(t){e._closed||e._protooPeer&&e._protooPeer.send("mediasoup-notification",t).catch((function(e){C.warn("Send mediasoup notification fail - "+e.name+" "+e.message)}))})),this._room.removeAllListeners("newpeer"),this._room.on("newpeer",(function(t){C.debug("room event -- [newpeer] peerName: "+t.name),e._peers.set(""+t.name,t),e._handlePeer(t)}));var t={displayName:this._uid,device:"webcam",role:this._role,audioCodec:this._audioCodec};"string"==typeof this._token&&""!==this._token&&(t.token=this._token),1==+this._role&&(""===this._valid_rtmp_url&&(this._defaultRtmpUrl="rtmp://"+this._ip+":11936/sdk/"+this._appId+"-"+this._roomId+"-"+this._uid+"-"+y.uuid(),this._valid_rtmp_url=this._defaultRtmpUrl),""!==this._valid_rtmp_url&&(t.rtmpUrl=this._valid_rtmp_url,t.disableRtmpVideo=this._disableRtmpVideo),t.videoMixerBGIUrl=this._videoMixerBGIUrl),C.debug("_joinRoom() - _room.join: "+(0,u.default)(t)),this._room.join(this._uid,t).then((function(){e._spy||(e._sendTransport=e._room.createTransport("send",{media:"SEND_MIC_WEBCAM"}),e._sendTransport.removeAllListeners("close"),e._sendTransport.on("close",(function(e){C.debug("_sendTransport event -- [close] originator: "+(0,u.default)(e))})),e._sendTransport.removeAllListeners("restart-ice-trying"),e._sendTransport.on("restart-ice-trying",(function(e){C.debug("_sendTransport event -- [restart-ice-trying] - "+(0,u.default)(e))})),e._sendTransport.removeAllListeners("restart-ice-fail"),e._sendTransport.on("restart-ice-fail",(function(t){C.debug("_sendTransport event -- [restart-ice-fail] - "+(0,u.default)(t)),e._onClientClose({code:94003,reason:"_sendTransport event [restart-ice-fail]"})})),e._sendTransport.removeAllListeners("icegatheringstatechange"),e._sendTransport.on("icegatheringstatechange",(function(e){C.debug("_sendTransport event -- [icegatheringstatechange] "+(0,u.default)(e))})),e._sendTransport.removeAllListeners("icecandidate"),e._sendTransport.on("icecandidate",(function(e){C.debug("_sendTransport event -- [icecandidate] "+(0,u.default)(e))})),e._sendTransport.removeAllListeners("icecandidateerror"),e._sendTransport.on("icecandidateerror",(function(e){C.debug("_sendTransport event -- [icecandidateerror] "+(0,u.default)(e))})),e._sendTransport.removeAllListeners("connectionstatechange"),e._sendTransport.on("connectionstatechange",(function(t){C.debug("_sendTransport event -- [connectionstatechange] connectionstat: "+t),"disconnected"===t?(e._iceSendDisconnectedCnt++,C.warn("_sendTransport event -- [connectionstatechange:disconnected] - will restart ice after 500ms"),setTimeout((function(){e._sendTransport.attemptRestartIce()}),500)):"failed"===t?(C.warn("_sendTransport event -- [connectionstatechange:failed] - will restart ice"),e._sendTransport.attemptRestartIce()):"connected"===t&&(C.debug("_sendTransport event -- [connectionstatechange:connected]"),R(e._sendTransport._handler._pc,(function(t){e._stats.setWebrtcInternalSendStats(e._sendTransport.id,t)}),1e3,"send"))}))),e._recvTransport=e._room.createTransport("recv",{media:"RECV"}),e._recvTransport.removeAllListeners("close"),e._recvTransport.on("close",(function(e){C.debug("_recvTransport event -- [close] originator: "+(0,u.default)(e))})),e._recvTransport.removeAllListeners("restart-ice-trying"),e._recvTransport.on("restart-ice-trying",(function(e){C.debug("_recvTransport event -- [restart-ice-trying] - "+(0,u.default)(e))})),e._recvTransport.removeAllListeners("restart-ice-fail"),e._recvTransport.on("restart-ice-fail",(function(t){C.debug("_recvTransport event -- [restart-ice-fail] - "+(0,u.default)(t)),e._onClientClose({code:94004,reason:"recvTransport event [restart-ice-fail]"})})),e._recvTransport.removeAllListeners("icegatheringstatechange"),e._recvTransport.on("icegatheringstatechange",(function(e){C.debug("_recvTransport event -- [icegatheringstatechange] "+(0,u.default)(e))})),e._recvTransport.removeAllListeners("icecandidate"),e._recvTransport.on("icecandidate",(function(e){C.debug("_recvTransport event -- [icecandidate] "+(0,u.default)(e))})),e._recvTransport.removeAllListeners("icecandidateerror"),e._recvTransport.on("icecandidateerror",(function(e){C.debug("_recvTransport event -- [icecandidateerror] "+(0,u.default)(e))})),e._recvTransport.removeAllListeners("connectionstatechange"),e._recvTransport.on("connectionstatechange",(function(t){C.debug("_recvTransport event -- [connectionstatechange] connectionstate: "+t),"disconnected"===t?(e._iceRecvDisconnectedCnt++,C.warn("_recvTransport event -- [connectionstatechange:disconnected] - will restart ice after 500ms"),setTimeout((function(){e._recvTransport.attemptRestartIce()}),500)):"failed"===t?(C.warn("_recvTransport event -- [connectionstatechange:failed] - will restart ice"),e._recvTransport.attemptRestartIce()):"connected"===t&&(C.debug("_recvTransport event -- [connectionstatechange:connected]"),R(e._recvTransport._handler._pc,(function(t){e._stats.setWebrtcInternalRecvStats(t)}),1e3,"recv"))}))})).then((function(){C.debug("_room.join() mediasoup response.");var t=e._room.peers,r=!0,n=!1,i=void 0;try{for(var a,o=(0,d.default)(t);!(r=(a=o.next()).done);r=!0){var s=a.value;e._handlePeer(s,{notify:!1})}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}e._stats.startHeartBeat()})).catch((function(e){C.warn("_room.join() fail - "+e.name+" "+e.message)}))}},{key:"_handleProtooEvent",value:function(){var t=this;this._protooPeer&&(this._protooPeer.removeAllListeners("open"),this._protooPeer.on("open",(function(e){e.sid===t._protooSessionId&&(C.debug("protooPeer event -- [open] - sid: "+e.sid+" - "+e.code+" "+e.reason+" - will _joinRoom..."),t._protooTransportStat=!0,t._sendGWTime=Date.now(),t._linkGWTime=t._sendGWTime-t._linkGWTime,t._joinRoom())})),this._protooPeer.removeAllListeners("conn-reconn"),this._protooPeer.on("conn-reconn",(function(e){e.sid===t._protooSessionId&&(C.debug("protooPeer event -- [conn-reconn] - sid: "+e.sid+" - "+e.code+" "+e.reason),t._protooTransportStat=!0,t._ChangeConnStat({event:"protoo[conn-reconn]",state:L}))})),this._protooPeer.removeAllListeners("conn-interrupt"),this._protooPeer.on("conn-interrupt",(function(e){e.sid===t._protooSessionId&&(C.warn("protooPeer event -- [conn-interrupt] - sid: "+e.sid+" - "+e.code+" "+e.reason),t._protooTransportStat=!1)})),this._protooPeer.removeAllListeners("conn-error"),this._protooPeer.on("conn-error",(function(e){C.warn("protooPeer event -- [conn-error] - sid: "+e.sid+" - "+e.code+" "+e.reason)})),this._protooPeer.removeAllListeners("reinit"),this._protooPeer.on("reinit",(function(e){e.sid===t._protooSessionId&&(C.warn("protooPeer event -- [reinit] - sid: "+e.sid+" - "+e.code+" "+e.reason),t._onClientClose({code:e.code,reason:"protoo event [reinit] - "+e.reason}))})),this._protooPeer.removeAllListeners("connecting"),this._protooPeer.on("connecting",(function(e){e.sid===t._protooSessionId&&(C.warn("protooPeer event -- [connecting] - sid: "+e.sid+" - "+e.code+" "+e.reason),t._ChangeConnStat({event:"protoo[connecting]",state:N}))})),this._protooPeer.removeAllListeners("close"),this._protooPeer.on("close",(function(e){e.sid===t._protooSessionId&&(C.warn("protooPeer event -- [close] - sid: "+e.sid+" - "+e.code+" "+e.reason),t._onClientClose({code:e.code,reason:"protoo event [close] - "+e.reason}))})),this._protooPeer.removeAllListeners("request"),this._protooPeer.on("request",(function(e,r,n,i){if(e.sid===t._protooSessionId)switch(r.method){case"mediasoup-notification":n();var a=r.data;null!==t._room&&t._room.receiveNotification(a);break;case"display-name-changed":n();break;case"3T_applySpeak":n(),t._protooPeer.send("approveSpeak",r.data);break;case"active-speaker":n();break;default:C.warn("protoo.requst event -- ["+r.method+"] unknown protoo method"),i(404,"unknown method")}})),this._protooPeer.removeAllListeners("notification"),this._protooPeer.on("notification",(function(r,n){if(r.sid===t._protooSessionId)switch(n.method){case"3T_sessionid":var i=n.data.sessionId;C.debug("protooPeer event -- [notification:3T_sessionid] - "+i),t._stats.setSessionId(i),e.g_sessionId=i;break;case"3T_connectid":var a=n.data.connectId;t._stats.setConnectionId(a),e.g_connectId=a,C.debug("protooPeer event -- [notification:3T_connectid] - "+a),t._joined=!0,t._joinTimer&&(clearTimeout(t._joinTimer),t._joinTimer=null),t._ChangeConnStat({event:"join-success",state:L}),t.emit("@join-success",{connectId:a});break;case"3T_kickout":C.debug("API protooPeer event -- [notification:3T_kickout] - Emit [kickout] to APP - "+(0,u.default)(n.data)),t.close({code:93001,reason:(0,u.default)(n.data)});break;case"3T_CDN_URL":var o=n.data.CDN_url;C.debug("API protooPeer event -- [notification:3T_CDN_URL] url: "+o+" - Emit [CDN_url] to APP"),t.emit({CDN_url:o});break;case"active-speaker":n.data.peerName;break;case"3T_audiencevisible":var s=n.data.peerId;C.warn("API protooPeer event -- [notification:3T_audiencevisible] peerId: "+s+" - Nothing to do");break;case"3T_changerole":var c=n.data,d=c.peerId,l=c.role;C.debug("API protooPeer event -- [notification:3T_changerole] peerId: "+d+" - role: "+l);var p=t._peers.get(""+d);p.appData.role=l.toString(),p&&("2"===p.appData.role?(C.debug("API protooPeer event -- [notification:3T_changerole] peerId: "+d+" role: "+l+" - Emit [peer-join] to APP"),t.emit("peer-join",{userId:d,userID:d,peer:p})):"3"===p.appData.role&&(C.debug("API protooPeer event -- [notification:3T_changerole] peerId: "+d+" role: "+l+" - Emit [peer-leave] to APP"),t._removeStatsInfo(d),t.emit("peer-leave",{userId:d,userID:d,streams:[]})));break;case"3T_rtmpfailure":var f=n.data,m=f.roomId,h=f.url;C.debug("API protooPeer event -- [notification:3T_rtmpfailure] url: "+h+" - Emit [rtmp-failure] to APP"),t.emit("rtmp-failure",{url:h,channelId:m});break;case"3T_rtmpsuccess":var v=n.data,_=v.roomId,g=v.url;C.debug("API protooPeer event -- [notification:3T_rtmpsuccess] url: "+g+" - Emit [rtmp-success] to APP"),t.emit("rtmp-success",{url:g,channelId:_});break;case"3T_updatevideostatus":var y=n.data,b=y.peerId,I=y.devId,k=y.videoType;C.debug("API protooPeer event -- [notification:3T_updatevideostatus] peerId: "+b+" devId: "+I+" videoType: "+k+" - Emit [video-update] to APP"),t.emit("video-update",{userId:b,streamId:I,videoType:k});break;case"3T_needrefreshtoken":C.debug("API protooPeer event -- [notification:3T_needrefreshtoken] - Emit [onTokenPrivilegeWillExpire] to APP"),t.emit("onTokenPrivilegeWillExpire");break;default:C.warn("protoo.requst event -- ["+n.method+"] unknown protoo method")}})))}},{key:"leave",value:(te=(0,c.default)(s.default.mark((function e(t,r){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof t){e.next=3;break}throw C.error("API leave() error - parameter: onSuccess invalid"),TypeError("onSuccess is not a fucntion.");case 3:if("function"==typeof r){e.next=6;break}throw C.error("API leave() error - parameter: onFailure invalid"),TypeError("onFailure is not a fucntion.");case 6:this._protooTransportStat||C.warn("API leave() error - protooTransport broken");try{this.close({code:1e3,reason:"Normal exit"}),C.debug("API leave() success")}catch(e){C.warn("API leave() error - "+e.name+" "+e.message)}finally{C.debug("API leave() finish."),t()}case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return te.apply(this,arguments)})},{key:"_removeStatsInfo",value:function(e){var t=this;this._subscribes.forEach((function(r,n){r&&""+r.userId==""+e&&t._subscribes.delete(n)})),this._remoteStreams.forEach((function(r,n){r&&""+r.userId==""+e&&t._remoteStreams.delete(n)})),this._remoteVideos.forEach((function(r,n){r&&""+r.userId==""+e&&t._remoteVideos.delete(n)})),this._remoteAudios.forEach((function(r,n){r&&""+r.userId==""+e&&t._remoteAudios.delete(n)}))}},{key:"publish",value:(ee=(0,c.default)(s.default.mark((function e(t,r,n){var i,a,o,c,d,u,l,p,f,m,h=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API publish() error - parameter: onSuccess invalid"),new TypeError("onSuccess parameter must be a function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API publish() error - parameter: onFailure invalid"),new TypeError("onFailure parameter must be a function.");case 6:if(t){e.next=10;break}return C.warn("API publish() error - [INVALID_PARAM_STREAM] - stream is null"),n("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}),e.abrupt("return");case 10:if(t.streamObj){e.next=14;break}return C.warn("API publish() error - [INVALID_PARAM_STREAM] - stream.streamObj is null"),n("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}),e.abrupt("return");case 14:if(!t.closed){e.next=18;break}return C.debug("API publish() error - [INVALID_PARAM_STREAM] - Stream is closed"),n("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] stream is closed"}),e.abrupt("return");case 18:if(i=!!this._room&&this._room.canSend("video"),a=!!this._room&&this._room.canSend("audio"),o=t.hasVideo(),c=t.hasAudio(),d=t.isVideoTrackClosed,u=t.isMicClosed,C.debug("API publish() >> streamId: "+t.getId()+" stream.isVideoTrackClosed: "+d+" stream.hasVideo: "+o+" canSendVideo: "+i+" stream.isMicClosed: "+u+" stream.hasAudio: "+c+" canSendAudio: "+a),t.hasAudio()||t.hasVideo()){e.next=29;break}return C.debug("API publish() << error - [INVALID_PARAM_STREAM] - audioTrack or videoTrack non-exist."),n("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] - has no audio or video"}),e.abrupt("return");case 29:if(this._protooTransportStat){e.next=33;break}return C.warn("API publish() << error - [CONNECT_BROKEN] - protooTransport is broken"),n("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 33:if(this._joined){e.next=37;break}return C.warn("API publish() << error - [NOT_LOGIN] - non-joined"),n("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"}),e.abrupt("return");case 37:if(!this._spy){e.next=41;break}return C.warn("API publish() << error - [PERMISSION_DENIED] - forbidden: user is _spy"),n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied"}),e.abrupt("return");case 41:if(3!=+this._role){e.next=45;break}return C.warn("API publish() << error - [PERMISSION_DENIED] - forbidden: Audience No permission"),n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied - Audience Not allowed publish"}),e.abrupt("return");case 45:if(!t.published){e.next=49;break}return C.warn("API publish() << error - [STREAM_HASPUBLISHED] - stream.published is true - nothing to do"),n("STREAM_HASPUBLISHED",{code:P.tttErrCode.STREAM_HASPUBLISHED,name:"STREAM_HASPUBLISHED",origin:"",message:"stream has been published"}),e.abrupt("return");case 49:if(t.publishState!==P.PUBLISH_STATE.PUBLISHING){e.next=53;break}return C.warn("API publish() << error - [TASK_PROCEEDING] - config.PUBLISH_STATE.PUBLISHING - publish is running..."),n("TASK_PROCEEDING",{code:P.tttErrCode.TASK_PROCEEDING,name:"TASK_PROCEEDING",origin:"",message:"publish is proceeding..."}),e.abrupt("return");case 53:if(t.publishState=P.PUBLISH_STATE.PUBLISHING,t.userID=this._uid,l=!1,!t.hasAudio()||!this._room.canSend("audio")){e.next=92;break}if(!this._audioProducer){e.next=76;break}if(this._audioProducer.resume({method:"publish"}),e.prev=59,!((p=t.audioTracks)&&p.length>0)){e.next=64;break}return e.next=64,this._audioProducer.replaceTrack(p[0]);case 64:l=!0,e.next=74;break;case 67:return e.prev=67,e.t0=e.catch(59),l=!1,t.publishState=P.PUBLISH_STATE.IDLE,C.warn("API publish() << fail - [PUBLISH_FAIL] - this._audioProducer.replaceTrack except - "+e.t0.name+" "+e.t0.message),n("PUBLISH_FAIL",{code:P.tttErrCode.PUBLISH_FAIL,name:"PUBLISH_FAIL",origin:""+e.t0.name,message:"publish fail - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 74:e.next=90;break;case 76:return e.prev=76,e.next=79,this._setMicProducer(t);case 79:this._stats.audioOpen=!0,l=!0,e.next=90;break;case 83:return e.prev=83,e.t1=e.catch(76),l=!1,t.publishState=P.PUBLISH_STATE.IDLE,C.warn("API publish() << fail - [PUBLISH_FAIL] - _setMicProducer() except - "+e.t1.name+" "+e.t1.message),n("PUBLISH_FAIL",{code:P.tttErrCode.PUBLISH_FAIL,name:"PUBLISH_FAIL",origin:""+e.t1.name,message:"publish fail - "+e.t1.name+" "+e.t1.message}),e.abrupt("return");case 90:e.next=93;break;case 92:l=!0;case 93:return e.prev=93,e.next=96,t._openVideo();case 96:e.next=100;break;case 98:e.prev=98,e.t2=e.catch(93);case 100:if(f=!1,!t.hasVideo()||!this._room.canSend("video")){e.next=136;break}if(!(m=this._mapVideoProducers.get(t.videoProducerId))){e.next=119;break}e.prev=104,m.resume({method:"publish"}),t._needUpdateVideoStreamBitrate&&(this._updateVideoTrack(t,t.videoTracks,t._updateConstraints),t._needUpdateVideoStreamBitrate=!1),f=!0,e.next=117;break;case 110:return e.prev=110,e.t3=e.catch(104),f=!1,t.publishState=P.PUBLISH_STATE.IDLE,C.warn("API publish() << fail - [PUBLISH_FAIL] - stream._openVideo() error - "+e.t3.name+" "+e.t3.message),n("PUBLISH_FAIL",{code:P.tttErrCode.PUBLISH_FAIL,name:"PUBLISH_FAIL",origin:""+e.t3.name,message:"publish fail - "+e.t3.name+" "+e.t3.message}),e.abrupt("return");case 117:e.next=133;break;case 119:return e.prev=119,e.next=122,this._setWebcamProducer(t);case 122:this._stats.videoOpen=!0,f=!0,e.next=133;break;case 126:return e.prev=126,e.t4=e.catch(119),f=!1,t.publishState=P.PUBLISH_STATE.IDLE,C.warn("API publish() << fail - [PUBLISH_FAIL] - _setWebcamProducer() error - "+e.t4.name+" "+e.t4.message),n("PUBLISH_FAIL",{code:P.tttErrCode.PUBLISH_FAIL,name:"PUBLISH_FAIL",origin:""+e.t4.name,message:"publish fail - "+e.t4.name+" "+e.t4.message}),e.abrupt("return");case 133:t.resumeLocalVideo(),e.next=137;break;case 136:f=!0;case 137:if(t.removeAllListeners("@close"),t.on("@close",(function(e,t){t&&(e?(C.debug("stream.on('@close') - streamId: "+t.streamId),h.unpublish(t.stream,(function(){}),(function(){}))):C.debug("stream.on('@close') - streamId: "+t.streamId+" -- isLocal: "+e+" is impossible here. WHAT HAPPENED??"))})),t.removeAllListeners("pause-video"),t.on("pause-video",(function(e){if(e){var t=e.stream;h.pauseWebcam(t)}})),t.removeAllListeners("pause-audio"),t.on("pause-audio",(function(e){if(e){var t=e.stream;h.pauseMic(t)}})),t.removeAllListeners("resume-audio"),t.on("resume-audio",(function(e){if(e){var t=e.stream;h.resumeMic(t)}})),t.removeAllListeners("resume-video"),t.on("resume-video",(function(e){if(e){var t=e.stream;h.resumeWebcam(t)}})),!l||!f){e.next=155;break}return t.published=!0,t.publishState=P.PUBLISH_STATE.PUBLISHED,this._publishs.set(t.uuid,{streamId:t.getId(),stream:t}),C.debug("API publish() << success - streamId: "+t.getId()+" - Emit [stream-published] to APP"),this.emit("stream-published",{streamId:t.getId(),stream:t}),r(),e.abrupt("return");case 155:return e.abrupt("return");case 156:case"end":return e.stop()}}),e,this,[[59,67],[76,83],[93,98],[104,110],[119,126]])}))),function(e,t,r){return ee.apply(this,arguments)})},{key:"_unpublishAudio",value:(Z=(0,c.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(t.hasAudio()){e.next=4;break}return e.abrupt("return");case 4:this._audioProducer&&this._audioProducer.pause({method:"unpublish"}),this._stats.audioOpen=!1;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return Z.apply(this,arguments)})},{key:"_unpublishVideo",value:($=(0,c.default)(s.default.mark((function e(t,r){var n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(t.hasVideo()){e.next=4;break}return e.abrupt("return");case 4:if(!(n=this._mapVideoProducers.get(t.videoProducerId))){e.next=25;break}return t.detachVideoProducer(),this._mapVideoProducers.delete(t.videoProducerId),e.prev=8,e.next=11,n.close();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),C.warn("_unpublishVideo() except: "+e.t0.name+" "+e.t0.message);case 16:if(!r){e.next=25;break}return e.prev=17,e.next=20,t._closeVideo();case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(17),C.warn("_unpublishVideo() stream._closeVideo - except: "+e.t1.name+" "+e.t1.message);case 25:this._stats.videoOpen=!1;case 26:case"end":return e.stop()}}),e,this,[[8,13],[17,22]])}))),function(e,t){return $.apply(this,arguments)})},{key:"unpublish",value:(Q=(0,c.default)(s.default.mark((function e(t,r,n,i){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API unpublish() error - parameter: onSuccess invalid"),new TypeError("onSuccess parameter must be a function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API unpublish() error - parameter: onFailure invalid"),new TypeError("onFailure parameter must be a function.");case 6:if(t){e.next=10;break}return C.warn("API unpublish() error - [INVALID_PARAM_STREAM] - stream is null"),n("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}),e.abrupt("return");case 10:if(C.debug("API unpublish() >> streamId: "+t.getId()),this._protooTransportStat){e.next=15;break}return C.warn("API unpublish() << error - [CONNECT_BROKEN] - protooTransport is broken"),n("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 15:if(t.published){e.next=19;break}return C.warn("API unpublish() << error - stream.published is false - nothing to do - onSuccess"),r("stream.published is false - nothing to do"),e.abrupt("return");case 19:t.removeAllListeners("@close"),t.removeAllListeners("pause-video"),t.removeAllListeners("pause-audio"),t.removeAllListeners("resume-audio"),t.removeAllListeners("resume-video"),this._unpublishAudio(t),this._unpublishVideo(t,i),t.published=!1,t.publishState=P.PUBLISH_STATE.IDLE,this._publishs.delete(t.uuid),C.debug("API unpublish() << success - streamId: "+t.getId()+" - Emit [stream-unpublished] to APP"),this.emit("stream-unpublished",{streamId:t.getId(),stream:t}),r();case 32:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return Q.apply(this,arguments)})},{key:"publishScreen",value:(Y=(0,c.default)(s.default.mark((function e(t,r,n){var i=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API publishScreen() error - parameter: onSuccess invalid"),new TypeError("onSuccess is not function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API publishScreen() error - parameter: onFailure invalid"),new TypeError("onFailure is not function.");case 6:if(t){e.next=10;break}return C.warn("API publishScreen() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid"),n("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}),e.abrupt("return");case 10:if(C.debug("API publishScreen() >> streamId: "+t.getId()),t.streamObj){e.next=15;break}return C.warn("API publishScreen() << error - [INVALID_PARAM_STREAM] - parameter: stream.streamObj is invalid"),n("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}),e.abrupt("return");case 15:if(!t.published){e.next=19;break}return C.warn("API publishScreen() << error - [STREAM_HASPUBLISHED] - stream.published is true - nothing to do"),n("STREAM_HASPUBLISHED",{code:P.tttErrCode.STREAM_HASPUBLISHED,name:"STREAM_HASPUBLISHED",origin:"",message:"stream has been published"}),e.abrupt("return");case 19:if(!t.closed){e.next=23;break}return C.debug("API publishScreen() << error - [INVALID_PARAM_STREAM] - Stream is closed"),n("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] stream is closed"}),e.abrupt("return");case 23:if(this._protooTransportStat){e.next=27;break}return C.warn("API publishScreen() << error - [CONNECT_BROKEN] - protooTransport broken"),n("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 27:if(this._joined){e.next=31;break}return C.warn("API publishScreen() << error - [NOT_LOGIN] - non-joined"),n("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"}),e.abrupt("return");case 31:if(!this._spy){e.next=35;break}return C.warn("API publishScreen() << error - [PERMISSION_DENIED] - user is _spy"),n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied"}),e.abrupt("return");case 35:if(1==+this._role){e.next=39;break}return C.warn("API publishScreen() << error - [PERMISSION_DENIED] - Only for Master"),n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied - Must be Master(role=1)"}),e.abrupt("return");case 39:if(t.userID=this._uid,!this._screenProducer){e.next=46;break}return this.resumeScreen(),C.debug("API publishScreen() << success - streamId: "+t.getId()+" - Emit [screen-published] to APP"),this.emit("screen-published",{streamId:t.getId(),stream:t}),r(),e.abrupt("return");case 46:if(this._room.canSend("video")){e.next=50;break}return C.warn("API publishScreen() << error - video cannot Send"),n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied - video cannot Send"}),e.abrupt("return");case 50:return t.removeAllListeners("@close"),t.on("@close",(function(e,t){t&&(e?(C.debug("stream.on('@close') - streamId: "+t.streamId),i.unpublishScreen(t.stream,(function(){}),(function(){}))):C.debug("stream.on('@close') - streamId: "+t.streamId+" -- isLocal: "+e+" is impossible here. WHAT HAPPENED??"))})),e.prev=52,e.next=55,this._setScreenProducer(t);case 55:return t.published=!0,t.publishState=P.PUBLISH_STATE.PUBLISHED,this._publishs.set(t.uuid,{streamId:t.getId(),stream:t}),C.debug("API publishScreen() << success - streamId: "+t.getId()+" - Emit [screen-published] to APP"),this.emit("screen-published",{streamId:t.getId(),stream:t}),r(),e.abrupt("return");case 64:return e.prev=64,e.t0=e.catch(52),C.warn("API publishScreen() << fail - [PUBLISH_FAIL] - _setScreenProducer() error - "+e.t0.name+" "+e.t0.message),n("PUBLISH_FAIL",{code:P.tttErrCode.PUBLISH_FAIL,name:"PUBLISH_FAIL",origin:""+e.t0.name,message:"publishScreen fail - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 69:case"end":return e.stop()}}),e,this,[[52,64]])}))),function(e,t,r){return Y.apply(this,arguments)})},{key:"unpublishScreen",value:(J=(0,c.default)(s.default.mark((function e(t,r,n){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API unpublishScreen() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API unpublishScreen() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");case 6:if(t){e.next=10;break}return C.warn("API unpublishScreen() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid"),n("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}),e.abrupt("return");case 10:if(C.debug("API unpublishScreen() >> streamId: "+t.getId()),this._protooTransportStat){e.next=15;break}return C.warn("API unpublishScreen() << error - [CONNECT_BROKEN] - protooTransport broken"),n("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 15:if(t.published){e.next=19;break}return C.warn("API unpublishScreen() << error - stream.published is false - nothing to do - onSuccess"),r("stream.published is false - nothing to do"),e.abrupt("return");case 19:if(t.removeAllListeners("@close"),!this._screenProducer){e.next=28;break}return e.prev=21,e.next=24,this._screenProducer.close();case 24:e.next=28;break;case 26:e.prev=26,e.t0=e.catch(21);case 28:this._screenProducer=null,t.published=!1,t.publishState=P.PUBLISH_STATE.IDLE,this._publishs.delete(t.uuid),C.debug("API unpublishScreen() << success - streamId: "+t.getId()+" - Emit [screen-unpublished] to APP"),this.emit("screen-unpublished",{streamId:t.getId(),stream:t}),r();case 35:case"end":return e.stop()}}),e,this,[[21,26]])}))),function(e,t,r){return J.apply(this,arguments)})},{key:"subscribeAudio",value:function(e,t,r){if("function"!=typeof t)throw C.error("API subscribeAudio() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");if("function"!=typeof r)throw C.error("API subscribeAudio() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");if(!e)return C.warn("API subscribeAudio() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid"),void r("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"});if(C.debug("API subscribeAudio() >> streamId: "+e.getId()),!this._protooTransportStat)return C.warn("API subscribeAudio() << error - [CONNECT_BROKEN] - protooTransport broken"),void r("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"});if(!this._joined)return C.warn("API subscribeAudio() << error - [NOT_LOGIN] - non-joined"),void r("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"});var n=!1,i=!0,a=!1,s=void 0;try{for(var c,u=(0,d.default)(e.consumers);!(i=(c=u.next()).done);i=!0){var l=(0,o.default)(c.value,2),p=(l[0],l[1]);p&&"audio"===p.kind&&(p.resume(),e.audioSubscribed=!0,n=!0)}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return n?(C.debug("API subscribeAudio() << success - streamId: "+e.getId()+" - Emit [stream-audio-subscribed] to APP"),this.emit("stream-audio-subscribed",{stream:e}),void t(e)):(C.warn("API subscribeAudio() << error - [STREAM_HAS_NOAUDIO] - STREAM_HAS_NOAUDIO"),void r("STREAM_HAS_NOAUDIO",{code:P.tttErrCode.STREAM_HAS_NOAUDIO,name:"STREAM_HAS_NOAUDIO",origin:"",message:"stream has non-audio"}))}},{key:"unsubscribeAudio",value:function(e,t,r){if("function"!=typeof t)throw C.error("API unsubscribeAudio() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");if("function"!=typeof r)throw C.error("API unsubscribeAudio() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");if(!e)return C.warn("API unsubscribeAudio() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid"),void r("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"});if(C.debug("API unsubscribeAudio() >> streamId: "+e.getId()),!this._protooTransportStat)return C.warn("API unsubscribeAudio() << error - [CONNECT_BROKEN] - protooTransport broken"),void r("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"});var n=!1,i=!0,a=!1,s=void 0;try{for(var c,u=(0,d.default)(e.consumers);!(i=(c=u.next()).done);i=!0){var l=(0,o.default)(c.value,2),p=(l[0],l[1]);p&&"audio"===p.kind&&(p.pause(),e.audioSubscribed=!1,n=!0)}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return n?(C.debug("API unsubscribeAudio() << success - streamId: "+e.getId()+" - Emit [stream-audio-unsubscribed] to APP"),this.emit("stream-audio-unsubscribed",{stream:e}),void t(e)):(C.warn("API unsubscribeAudio() << error - [STREAM_HAS_NOAUDIO] - STREAM_HAS_NOAUDIO"),void r("STREAM_HAS_NOAUDIO",{code:P.tttErrCode.STREAM_HAS_NOAUDIO,name:"STREAM_HAS_NOAUDIO",origin:"",message:"stream has non-audio"}))}},{key:"subscribeVideo",value:function(e,t,r){if("function"!=typeof t)throw C.error("API subscribeVideo() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");if("function"!=typeof r)throw C.error("API subscribeVideo() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");if(!e)return C.warn("API subscribeVideo() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid"),void r("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"});if(C.debug("API subscribeVideo() >> streamId: "+e.getId()),!this._protooTransportStat)return C.warn("API subscribeVideo() << error - [CONNECT_BROKEN] - protooTransport broken"),void r("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"});if(!this._joined)return C.warn("API subscribeVideo() << error - [NOT_LOGIN] - non-joined"),void r("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"});var n=!1,i=!0,a=!1,s=void 0;try{for(var c,u=(0,d.default)(e.consumers);!(i=(c=u.next()).done);i=!0){var l=(0,o.default)(c.value,2),p=(l[0],l[1]);p&&"video"===p.kind&&(p.resume(),e.videoSubscribed=!0,n=!0)}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return n?(C.debug("API subscribeVideo() << success - streamId: "+e.getId()+" - Emit [stream-video-subscribed] to APP"),this.emit("stream-video-subscribed",{stream:e}),void t(e)):(C.warn("API subscribeVideo() << error - [STREAM_HAS_NOVIDEO] - STREAM_HAS_NOVIDEO"),void r("STREAM_HAS_NOVIDEO",{code:P.tttErrCode.STREAM_HAS_NOVIDEO,name:"STREAM_HAS_NOVIDEO",origin:"",message:"stream has non-video"}))}},{key:"unsubscribeVideo",value:function(e,t,r){if("function"!=typeof t)throw C.error("API unsubscribeVideo() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");if("function"!=typeof r)throw C.error("API unsubscribeVideo() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");if(!e)return C.warn("API unsubscribeVideo() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid"),void r("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"});if(C.debug("API unsubscribeVideo() >> streamId: "+e.getId()),!this._protooTransportStat)return C.warn("API unsubscribeVideo() << error - [CONNECT_BROKEN] - protooTransport broken"),void r("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"});var n=!1,i=!0,a=!1,s=void 0;try{for(var c,u=(0,d.default)(e.consumers);!(i=(c=u.next()).done);i=!0){var l=(0,o.default)(c.value,2),p=(l[0],l[1]);p&&"video"===p.kind&&(p.pause(),e.videoSubscribed=!1,n=!0)}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return n?(C.debug("API unsubscribeVideo() << success - streamId: "+e.getId()+" - Emit [stream-video-unsubscribed] to APP"),this.emit("stream-video-unsubscribed",{stream:e}),void t(e)):(C.warn("API unsubscribeVideo() << error - [STREAM_HAS_NOVIDEO] - STREAM_HAS_NOVIDEO"),void r("STREAM_HAS_NOVIDEO",{code:P.tttErrCode.STREAM_HAS_NOVIDEO,name:"STREAM_HAS_NOVIDEO",origin:"",message:"stream has non-video"}))}},{key:"subscribe",value:function(e,t,r){if("function"!=typeof t)throw C.error("API subscribe() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");if("function"!=typeof r)throw C.error("API subscribe() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");if(!e)return C.warn("API subscribe() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid"),void r("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"});if(C.debug("API subscribe() >> streamId: "+e.getId()),!this._protooTransportStat)return C.warn("API subscribe() << error - [CONNECT_BROKEN] - protooTransport broken"),void r("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"});if(!this._joined)return C.warn("API subscribe() << error - [NOT_LOGIN] - non-joined"),void r("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"});var n=!1,i=!0,a=!1,s=void 0;try{for(var c,u=(0,d.default)(e.consumers);!(i=(c=u.next()).done);i=!0){var l=(0,o.default)(c.value,2),p=(l[0],l[1]);if(p){if("video"===p.kind)e.videoSubscribed=!0;else{if("audio"!==p.kind)continue;e.audioSubscribed=!0}p.resume(),n=!0}}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return n?(e.subscribed=!0,this._subscribes.set(e.uuid,{userId:e.userID,streamId:e.getId(),stream:e}),C.debug("API subscribe() << success - streamId: "+e.getId()+" - Emit [stream-subscribed] to APP"),this.emit("stream-subscribed",{stream:e}),void t(e)):(C.warn("API subscribe() << error - [STREAM_HAS_NOMEDIA] - STREAM_HAS_NOMEDIA"),void r("STREAM_HAS_NOMEDIA",{code:P.tttErrCode.STREAM_HAS_NOMEDIA,name:"STREAM_HAS_NOMEDIA",origin:"",message:"stream has non-media(audio | video)"}))}},{key:"unsubscribe",value:function(e,t,r){if("function"!=typeof t)throw C.error("API unsubscribe() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");if("function"!=typeof r)throw C.error("API unsubscribe() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");if(!e)return C.warn("API unsubscribe() error - [INVALID_PARAM_STREAM] - parameter: stream is invalid"),void r("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"});if(C.debug("API unsubscribe() >> streamId: "+e.getId()),!this._protooTransportStat)return C.warn("API unsubscribe() << error - [CONNECT_BROKEN] - protooTransport broken"),void r("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"});var n=!1,i=!0,a=!1,s=void 0;try{for(var c,u=(0,d.default)(e.consumers);!(i=(c=u.next()).done);i=!0){var l=(0,o.default)(c.value,2),p=(l[0],l[1]);if(p){if("video"===p.kind)e.videoSubscribed=!1;else{if("audio"!==p.kind)continue;e.audioSubscribed=!1}p.pause(),n=!0}}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return n?(this._subscribes.delete(e.uuid),e.subscribed=!1,C.debug("API unsubscribe() << success - streamId: "+e.getId()+" - Emit [stream-unsubscribed] to APP"),this.emit("stream-unsubscribed",{stream:e}),void t(e)):(C.warn("API unsubscribe() << error - [STREAM_HAS_NOMEDIA] - STREAM_HAS_NOMEDIA"),void r("STREAM_HAS_NOMEDIA",{code:P.tttErrCode.STREAM_HAS_NOMEDIA,name:"STREAM_HAS_NOMEDIA",origin:"",message:"stream has non-media(audio | video)"}))}},{key:"pauseMic",value:function(e,t,r){if(!e)return C.warn("API pauseMic() error - [INVALID_PARAM_STREAM] - Param: invalid stream"),void("function"==typeof r&&r("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}));if(C.debug("API pauseMic() >> streamId: "+e.getId()),!e.published)return C.warn("API pauseMic() << error - [AUDIO_NOPUBLISH] - no-published"),void("function"==typeof r&&r("AUDIO_NOPUBLISH",{code:P.tttErrCode.AUDIO_NOPUBLISH,name:"AUDIO_NOPUBLISH",origin:"",message:"audio no-published"}));var n=this._audioProducer;if(!n)return C.warn("API pauseMic() << fail - [AUDIO_NOPUBLISH] - non mic producer."),void("function"==typeof r&&r("AUDIO_NOPUBLISH",{code:P.tttErrCode.AUDIO_NOPUBLISH,name:"AUDIO_NOPUBLISH",origin:"",message:"non mic producer"}));C.debug("API pauseMic() << sucess - streamId: "+e.getId()),n.pause({method:"pause"}),e.isAudioPaused=!0,"function"==typeof t&&t()}},{key:"resumeMic",value:function(e,t,r){if(!e)return C.warn("API resumeMic() error - [INVALID_PARAM_STREAM] - Param: invalid stream"),void("function"==typeof r&&r("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}));if(C.debug("API resumeMic() >> streamId: "+e.getId()),!e.published)return C.warn("API resumeMic() << error - [AUDIO_NOPUBLISH] - no-published"),void("function"==typeof r&&r("AUDIO_NOPUBLISH",{code:P.tttErrCode.AUDIO_NOPUBLISH,name:"AUDIO_NOPUBLISH",origin:"",message:"audio no-published"}));var n=this._audioProducer;if(!n)return C.warn("API resumeMic() << fail - [AUDIO_NOPUBLISH] - non mic producer"),void("function"==typeof r&&r("AUDIO_NOPUBLISH",{code:P.tttErrCode.AUDIO_NOPUBLISH,name:"AUDIO_NOPUBLISH",origin:"",message:"non mic producer"}));C.debug("API resumeMic() << sucess - streamId: "+e.getId()),n.resume({method:"resume"}),e.isAudioPaused=!1,"function"==typeof t&&t()}},{key:"pauseWebcam",value:(X=(0,c.default)(s.default.mark((function e(t,r,n,i){var a;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return C.warn("API pauseWebcam() error - [INVALID_PARAM_STREAM] - Param: invalid stream"),"function"==typeof i&&i("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}),e.abrupt("return");case 4:if(C.debug("API pauseWebcam() >> streamId: "+t.getId()),t.published){e.next=9;break}return C.warn("API pauseWebcam() << fail - [VIDEO_NOPUBLISH] - no-published"),"function"==typeof i&&i("VIDEO_NOPUBLISH",{code:P.tttErrCode.VIDEO_NOPUBLISH,name:"VIDEO_NOPUBLISH",origin:"",message:"video no-published"}),e.abrupt("return");case 9:if(a=this._mapVideoProducers.get(t.videoProducerId)){e.next=16;break}return C.warn("API pauseWebcam() << fail - [VIDEO_NOPUBLISH] - non webcam producer."),"function"==typeof i&&i("VIDEO_NOPUBLISH",{code:P.tttErrCode.VIDEO_NOPUBLISH,name:"VIDEO_NOPUBLISH",origin:"",message:"non webcam producer"}),e.abrupt("return");case 16:try{a.pause({method:"pause"}),C.debug("API pauseWebcam() << success - streamId: "+t.getId())}catch(e){C.warn("APi pauseWebcam() << fail - "+e.name+" "+e.message)}if(t.isVideoPaused=!0,!r){e.next=21;break}return e.next=21,t._closeVideo();case 21:"function"==typeof n&&n();case 22:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return X.apply(this,arguments)})},{key:"resumeWebcam",value:function(e,t,r){if(!e)return C.warn("API resumeWebcam() error - [INVALID_PARAM_STREAM] - Param: invalid stream"),void("function"==typeof r&&r("INVALID_PARAM_STREAM",{code:P.tttErrCode.INVALID_PARAM_STREAM,name:"INVALID_PARAM_STREAM",origin:"",message:"param [stream] is invalid"}));if(C.debug("API resumeWebcam() >> streamId: "+e.getId()),!e.published)return C.warn("API resumeWebcam() << fail - [VIDEO_NOPUBLISH] - no-published"),void("function"==typeof r&&r("VIDEO_NOPUBLISH",{code:P.tttErrCode.VIDEO_NOPUBLISH,name:"VIDEO_NOPUBLISH",origin:"",message:"video no-published"}));var n=this._mapVideoProducers.get(e.videoProducerId);if(!n)return C.warn("API resumeWebcam() << fail - [VIDEO_NOPUBLISH] - non webcam producer"),void("function"==typeof r&&r("VIDEO_NOPUBLISH",{code:P.tttErrCode.VIDEO_NOPUBLISH,name:"VIDEO_NOPUBLISH",origin:"",message:"non webcam producer"}));e._openVideo().then((function(){try{n.resume({method:"resume"}),C.debug("API resumeWebcam() << success - stream._openVideo() - streamId: "+e.getId())}catch(e){C.warn("API resumeWebcam() except - "+e.name+" "+e.message)}e.isVideoPaused=!1,"function"==typeof t&&t()})).catch((function(e){C.warn("API resumeWebcam() << fail - [DEVICE_EXCEPTION] - stream._openVideo() error - "+e.name+" "+e.message),"function"==typeof r&&r("DEVICE_EXCEPTION",{code:P.tttErrCode.DEVICE_EXCEPTION,name:"DEVICE_EXCEPTION",origin:""+e.name,message:"stream._openVideo fail - "+e.name+" "+e.message})}))}},{key:"pauseScreen",value:function(){C.debug("API pauseScreen() >> "),this._screenProducer&&this._screenProducer.pause(),C.debug("API pauseScreen() << success ")}},{key:"resumeScreen",value:function(){C.debug("API resumeScreen() >> "),this._screenProducer&&this._screenProducer.resume(),C.debug("API resumeScreen() << success ")}},{key:"_updateVideoTrack",value:(q=(0,c.default)(s.default.mark((function e(t,r,n){var i;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(i=this._mapVideoProducers.get(t.videoProducerId)){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,i.updateTrack(r,n,{idealBandwidth:t.idealBandwidth,maxBandwidth:t.maxBandwidth,minBandwidth:t.minBandwidth});case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(5);case 12:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(e,t,r){return q.apply(this,arguments)})},{key:"_replaceTrack",value:(z=(0,c.default)(s.default.mark((function e(t,r){var n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(n=this._mapVideoProducers.get(t.videoProducerId)){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,n.replaceTrack(r);case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(5);case 12:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(e,t){return z.apply(this,arguments)})},{key:"renewChannelKey",value:function(e,t,r){}},{key:"enableDualStream",value:function(){}},{key:"setRemoteVideoStreamType",value:function(e,t){}},{key:"setLowStreamParameter",value:function(){}},{key:"disableDualStream",value:function(e,t){}},{key:"setProxyServer",value:function(e){}},{key:"setEncryptionSecret",value:function(){}},{key:"setEncryptionMode",value:function(){}},{key:"closeStream",value:(W=(0,c.default)(s.default.mark((function e(t){var r,n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return C.warn("API closeStream() error - parameter [stream] is INVALID."),e.abrupt("return");case 3:if(C.debug("API closeStream() >> streamId: "+t.getId()),!(r=this._audioProducer)){e.next=14;break}return e.prev=6,e.next=9,r.close();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),C.warn("API closeStream() << except - close micProducer error - "+e.t0.name+" "+e.t0.message);case 14:if(!(n=this._mapVideoProducers.get(t.videoProducerId))){e.next=24;break}return e.prev=16,e.next=19,n.close();case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(16),C.warn("API closeStream() << except - close webcamProducer error - "+e.t1.name+" "+e.t1.message);case 24:C.debug("API closeStream() << success - streamId: "+t.getId());case 25:case"end":return e.stop()}}),e,this,[[6,11],[16,21]])}))),function(e){return W.apply(this,arguments)})},{key:"_innerClose",value:(K=(0,c.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connState!==M){e.next=2;break}return e.abrupt("return");case 2:if(this._joined=!1,this._ChangeConnStat({event:t.code+" "+t.reason,state:M}),e.prev=4,!this._room){e.next=10;break}return e.next=8,this._room.leave();case 8:this._room&&this._room.removeAllListeners(),this._room=null;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4);case 15:this._joinTimer&&(clearTimeout(this._joinTimer),this._joinTimer=null),this._stopStatInterval(),this._stopNetworkQualityInterval(),this._remoteAudios.clear(),this._remoteVideos.clear(),this._publishs.clear(),this._subscribes.clear(),this._audioProducer&&this._audioProducer.close(),this._mapVideoProducers.forEach((function(e,t){e&&e.close()})),this._mapVideoProducers.clear(),null!=this._sendTransport&&(this._sendTransport.close(),this._sendTransport=null),this._screenTransport&&(this._screenTransport.close(),this._screenTransport=null),this._screenProducer&&(this._screenProducer.close(),this._screenProducer=null),this._mapVideoSendTransports.forEach((function(e,t){e&&e.close()})),this._mapVideoSendTransports.clear(),this._recvTransport&&(this._recvTransport.close(),this._recvTransport=null),this._peers.clear();case 32:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(e){return K.apply(this,arguments)})},{key:"close",value:function(e){if(!this._closed&&!this._closing){this._iplocTimer&&(clearTimeout(this._iplocTimer),this._iplocTimer=null),this._ipLocation&&(this._ipLocation.close(),this._ipLocation=null),this._closing=!0;var t=e?"API close() - "+e.reason:"API close()";C.debug(t),this._innerClose({code:e?e.code:1e3,reason:t}),this._hasInit=!1,this._liveMixerLayout=null,this._ChangeConnStat({event:t,state:D}),this._joined=!1,this._protooPeer&&(this._protooPeer.close(),this._protooPeer=null),navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=null),this._stats.stopHeartBeat(),this._closed=!0,this._closing=!1,e&&93001===e.code&&(C.debug("API close() - Emit [kickout] to APP"),this.emit("kickout",e.reason)),C.debug("API close() - Emit [disconnected] to APP"),this.emit("disconnected",{code:e?e.code:1e3}),this.removeAllListeners(),C.debug("API close() << end")}}},{key:"_handlePeer",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.notify;C.debug("close() - Emit [peer-join] to APP"),this.emit("peer-join",{userId:e.name,userID:e.name,peer:e}),this._peers.set(""+e.name,e);var n=!0,i=!1,a=void 0;try{for(var o,s=(0,d.default)(e.consumers);!(n=(o=s.next()).done);n=!0){var c=o.value;this._handleConsumer(c)}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}e.on("close",(function(r){t._peers.delete(""+e.name),t._closed||(t._removeStatsInfo(e.name),C.debug("peer event -- [close] - userID: "+e.name+" - Emit [peer-leave] to APP"),t.emit("peer-leave",{userId:e.name,userID:e.name,peer:e}))})),e.on("newconsumer",(function(e){t._handleConsumer(e)}))}},{key:"_handleConsumer",value:(G=(0,c.default)(s.default.mark((function e(t){var r,n,i=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.appData){e.next=2;break}return e.abrupt("return");case 2:if("screen"!==t.appData.source){e.next=4;break}return e.abrupt("return");case 4:t.on("close",(function(e){t.disableStats(),i._stats.removeStreamById("consumer_"+t.id);var r=t.appData?t.appData.streamID:t.peer.name,n=i._remoteStreams.get(""+r);n&&(n.isConsumerMedia||i._remoteStreams.delete(""+r),"video"===t.kind?(n.detachVideoConsumer(t),i._remoteVideos.delete(n.uuid),C.debug("consumer event -- [close] - streamId: "+n.getId()+" - Emit [video-removed] to APP"),i.emit("video-removed",{streamId:r,stream:n})):"audio"===t.kind&&(n.detachAudioConsumer(t),C.debug("consumer event -- [close] - streamId: "+n.getId()+" - Emit [audio-removed] to APP"),i.emit("audio-removed",{streamId:r,stream:n})))})),t.on("pause",(function(e){i._stats.actStreamSSRCPairs("consumer_"+t.id,!1);var r="audio-mute";if("audio"===t.kind?r="audio-mute":"video"===t.kind&&(r="video-mute"),"remote"===e){var n=i._remoteStreams.get(""+t.appData.streamID);n?(C.debug("consumer event -- [pause] - streamId: "+n.getId()+" - Emit ["+r+"] to APP"),i.emit(r,{stream:n})):C.warn("EXCEPT - consumer event -- [pause] - consumerId: "+t.id+" - non-stream")}})),t.on("resume",(function(e){i._stats.actStreamSSRCPairs("consumer_"+t.id,!0);var r="";if("audio"===t.kind?r="audio-unmute":"video"===t.kind&&(r="video-unmute"),"remote"===e){var n=t.appData?i._remoteStreams.get(""+t.appData.streamID):null;n?("video-unmute"!==r||i._remoteVideos.has(n.uuid)?"audio-unmute"!==r||i._remoteAudios.has(n.uuid)||(C.debug("consumer event -- [resume] - uuid: "+n.uuid+" streamId: "+n.getId()+" - Emit [audio-added] to APP"),i.emit("audio-added",{stream:n}),i._remoteAudios.set(n.uuid,{userId:t.peer.name,streamId:n.getId()})):(C.debug("consumer event -- [resume] - uuid: "+n.uuid+" streamId: "+n.getId()+" - Emit [video-added] to APP"),i.emit("video-added",{stream:n}),i._remoteVideos.set(n.uuid,{userId:t.peer.name,streamId:n.getId()})),n.subscribed||t.pause(),C.debug("consumer event -- [resume] - uuid: "+n.uuid+" streamId: "+n.getId()+" - Emit ["+r+"] to APP"),i.emit(r,{stream:n})):C.warn("EXCEPT - consumer event -- [resume] - consumerId: "+t.id+" - non-stream")}})),t.on("stats",(function(e){t.getStats().then((function(r){var n={};if(t.track&&"video"===t.track.kind&&(n=i._extractResolution(r)),t.peer){var a=t.appData?t.appData.streamID:t.peer.name;i._stats.setConsumeStats(e,n,t.peer.name,t.id,a)}})).catch((function(e){}))})),t.on("internalStats",(function(e){if(t.peer){var r=i._internalStats("receiverStats",e,t.peer.name,t.id);i._stats.pushLoggerToServer(null,r)}})),t.supported?(r=t.appData?t.appData.streamID:t.peer.name,(n=this._remoteStreams.get(""+r))||((n=new b.default({userId:t.peer.name,source:t.appData.source,streamId:r,videoType:t.appData.videoType,streamType:"consumer",openAudioCtx:!0})).streamObj=new MediaStream,this._remoteStreams.set(""+r,n),n.on("@close",(function(e,t){e?C.debug("stream.on('@close') - streamId: "+t.streamId+" -- isLocal: "+e+" is impossible here. WHAT HAPPENED??"):C.debug("stream.on('@close') - streamId: "+t.streamId)}))),n&&"video"===t.kind&&void 0!==t.appData.videoType&&(n.videoType=t.appData.videoType),t.receive(this._recvTransport).then((function(e){if("audio"===e.kind)try{n.audioTracks=e,n.attachAudioConsumer(t),C.debug("consumer stream.uuid: "+n.uuid+" streamId: "+n.getId()+" - Emit [audio-added] to APP"),i.emit("audio-added",{stream:n}),i._remoteAudios.set(n.uuid,{userId:t.peer.name,streamId:n.getId()})}catch(e){C.debug("consumer [audio] stream.uuid: "+n.uuid+" streamId: "+n.getId()+" - execpt: "+e.name+" "+e.message)}else if("video"===e.kind)try{n.videoTracks=e,n.attachVideoConsumer(t),t.remotelyPaused||(C.debug("consumer stream.uuid: "+n.uuid+" streamId: "+n.getId()+" - Emit [video-added] to APP"),i.emit("video-added",{stream:n}),i.emit("video-update",{userId:t.peer.name,streamId:n.getId(),videoType:n.videoType}),i._remoteVideos.set(n.uuid,{userId:t.peer.name,streamId:n.getId()}))}catch(e){C.debug("consumer [video] stream.uuid: "+n.uuid+" streamId: "+n.getId()+" - execpt: "+e.name+" "+e.message)}i._stats.setStreamSSRCPairs("consumer_"+t.id,t.kind,0,n,!0),1===n.trackNumber&&(C.debug("consumer stream.type: "+n.type+" streamId: "+n.getId()+" - Emit [stream-added] to APP"),i.emit("stream-added",{stream:n,type:n.type})),t.transport.handler._pc.getStats(e).then((function(e){e.forEach((function(e){"inbound-rtp"===e.type&&(C.debug("<WEBRTC-STAT> consumer kind: "+t.kind+" - "+(0,u.default)(e)),i._stats.updateStreamSSRCPairs("consumer_"+t.id,e.ssrc))}))}))})).catch((function(e){C.warn("_handleConsumer() error - unexpected error while receiving a new Consumer: "+e.name+" "+e.message)})),n.subscribed||t.pause(),t.enableStats(this._interval)):C.warn("_handleConsumer() error - consumer.peer.name: "+t.peer.name+" consumer.supported: "+t.supported);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"_setMicProducer",value:function(e){var t=this;if(!e)return a.default.reject(new Error("INVALID parameter [stream]"));if(!this._room.canSend("audio"))return a.default.reject(new Error("cannot send audio"));var r=null;return a.default.resolve().then((function(){var n=e.streamObj.getAudioTracks();if(n.length<=0)return a.default.reject(new Error("Audio track non-exist"));var i=n[0],o=t._audioCodec.toLowerCase(),s=e.getAudioProfile();(s?s.codec.toLowerCase():"")!==o&&e.setAudioProfile("opus"===o?"music_standard":"isac32");var c=e.getAudioProfile();return(r=t._room.createProducer(i,{audioProfile:c},{source:"mic_"+e.streamID,streamID:e.getId(),userID:e.userID})).send(t._sendTransport)})).then((function(){e.attachAudioProducer(r),t._audioProducer=r,r.enableStats(t._interval),r.on("close",(function(n){C.debug("micProducer event -- [close] - [originator:"+n+"]"),"remote"===n&&C.debug("producer close"),t._audioProducer=null,e.detachAudioProducer(),r.disableStats()})),r.on("pause",(function(e){C.debug("micProducer event -- [pause] - [originator:"+e+"]")})),r.on("resume",(function(e){C.debug("micProducer event -- [resume] - [originator:"+e+"]")})),r.on("internalStats",(function(e){var r=t._internalStats("senderStats",e);t._stats.pushLoggerToServer(null,r)}))})).catch((function(n){throw r&&(t._audioProducer=null,e.detachAudioProducer(),r.close()),n}))}},{key:"_setWebcamProducer",value:function(e){var t=this;if(!e)return a.default.reject(new Error("INVALID parameter [stream]"));if(!this._room.canSend("video"))return a.default.reject(new Error("cannot send video"));var r=void 0;return a.default.resolve().then((0,c.default)(s.default.mark((function n(){var i,o,c,d,u,l;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((i=e.streamObj.getVideoTracks()).length<=0)){n.next=5;break}return n.abrupt("return",a.default.reject(new Error("Video track non-exist")));case 5:if(o=i[0],c=t._audioCodec.toLowerCase(),d=e.getAudioProfile(),(d?d.codec.toLowerCase():"")!==c&&e.setAudioProfile("opus"===c?"music_standard":"isac32"),u=e.getAudioProfile(),r=t._room.createProducer(o,{simulcast:t._useSimulcast,audioProfile:u,codecOptions:{videoGoogleStartBitrate:e.idealBandwidth,videoGoogleMaxBitrate:e.maxBandwidth,videoGoogleMinBitrate:e.minBandwidth}},{source:"webcam_"+e.streamID,streamID:e.getId(),userID:e.userID,videoType:e.videoType,defaultDev:e.isDefault})){n.next=16;break}return n.abrupt("return",a.default.reject(new Error("createProducer fail")));case 16:if(l=void 0,!t._sendTransport.hasVideoProducer){n.next=24;break}return n.next=20,t._newTransport("send","web_cam");case 20:l=n.sent,t._mapVideoSendTransports.set(e._innerStreamID,l),n.next=25;break;case 24:l=t._sendTransport;case 25:return n.abrupt("return",r.send(l));case 26:case"end":return n.stop()}}),n,t)})))).then((function(){t._mapVideoProducers.set(r.id,r),e.attachVideoProducer(r),r.enableStats(t._interval),r.on("close",(function(n){t._stats.removeStreamById("producer_"+r.id),C.debug("webcamProducer event -- [close] - [originator:"+n+"]"),r.disableStats(),t._mapVideoProducers.delete(r.id),e.detachVideoProducer();var i=t._mapVideoSendTransports.get(e._innerStreamID);void 0!==i&&(i.close(),i.removeAllListeners(),t._mapVideoSendTransports.delete(e._innerStreamID))})),r.on("pause",(function(e){t._stats.actStreamSSRCPairs("producer_"+r.id,!1),C.debug("webcamProducer event -- [pause] - [originator:"+e+"]")})),r.on("resume",(function(e){t._stats.actStreamSSRCPairs("producer_"+r.id,!0),C.debug("webcamProducer event -- [resume] [originator:"+e+"]")})),r.on("internalStats",(function(e){var r=t._internalStats("senderStats",e);t._stats.pushLoggerToServer(null,r)}))})).then((function(){t._stats.setStreamSSRCPairs("producer_"+r.id,r.kind,0,e,!0),r.transport.handler._pc.getStats(r.track).then((function(e){e.forEach((function(e){"outbound-rtp"===e.type&&(C.debug("<WEBRTC-STAT> producer kind: "+r.kind+" - "+(0,u.default)(e)),t._stats.updateStreamSSRCPairs("producer_"+r.id,e.ssrc))}))}))})).catch((function(n){throw r&&(t._mapVideoProducers.delete(r.id),e.detachVideoProducer(),r.close()),n}))}},{key:"_setScreenProducer",value:function(e){var t=this;if(!e)return a.default.reject(new Error("INVALID parameter [stream]"));if(!this._room.canSend("video"))return a.default.reject(new Error("cannot send video"));if(this._screenProducer)return a.default.reject(new Error("screen Producer already exists"));var r=void 0;return a.default.resolve().then((0,c.default)(s.default.mark((function n(){var i;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.streamObj.getVideoTracks()[0],r=t._room.createProducer(i,{simulcast:t._useSimulcast},{source:"screen",streamID:e.getId(),mode:"only-cdn"}),n.next=4,t._newTransport("send","screen");case 4:return t._screenTransport=n.sent,n.abrupt("return",r.send(t._screenTransport));case 6:case"end":return n.stop()}}),n,t)})))).then((function(){t._screenProducer=r,t._screenProducer.enableStats(t._interval),r.on("close",(function(e){t._stats.removeStreamById("producer_"+r.id),C.debug("screenProducer event -- [close] - [originator:"+e+"]"),t._screenProducer=null,t._screenTransport.close(),t._screenTransport.removeAllListeners(),t._screenTransport=null,r.disableStats()})),r.on("pause",(function(e){t._stats.actStreamSSRCPairs("producer_"+r.id,!1),C.debug("screenProducer event -- [pause] - [originator:"+e+"]")})),r.on("resume",(function(e){t._stats.actStreamSSRCPairs("producer_"+r.id,!0),C.debug("screenProducer event -- [resume] - [originator:"+e+"]")})),r.on("internalStats",(function(e){var r=t._internalStats("senderStats",e);t._stats.pushLoggerToServer(null,r)}))})).then((function(){t._stats.setStreamSSRCPairs("producer_"+r.id,r.kind,0,e,!0),r.transport.handler._pc.getStats(r.track).then((function(e){e.forEach((function(e){"outbound-rtp"===e.type&&(C.debug("<WEBRTC-STAT> producer kind: "+r.kind+" - "+(0,u.default)(e)),t._stats.updateStreamSSRCPairs("producer_"+r.id,e.ssrc))}))}))})).catch((function(e){throw r&&(r.close(),t._screenProducer=null),e}))}},{key:"_delay",value:function(e){var t,r,n=new a.default((function(n,i){t=setTimeout(n,e),r=i}));return n.cancel=function(){clearTimeout(t),r(Error("Cancelled"))},n}},{key:"getStats",value:function(){return this.getNetState()}},{key:"getNetState",value:function(){return{iceSendTransport:this._sendTransport?this._sendTransport.connectionState:"fault",iceRecvTransport:this._recvTransport?this._recvTransport.connectionState:"fault",websocketTransport:this._protooPeer&&this._protooPeer._transport?this._protooPeer._transport.connected?"online":"offline":"fault",loginStatus:this._joined?"online":"offline",stats:this._stats?this._stats.summarize:{}}}},{key:"getRemoteAudioStats",value:function(e){if("function"!=typeof e)throw C.warn("API getRemoteAudioStats() error - parameter: callback invalid"),new TypeError("callback is not function.");e(this._stats.audioDownStat)}},{key:"remoteAudioStats",value:function(){return this._stats.audioDownStat}},{key:"getRemoteVideoStats",value:function(e){if("function"!=typeof e)throw C.warn("API getRemoteVideoStats() error - parameter: callback invalid"),new TypeError("callback is not function.");e(this._stats.videoDownStat)}},{key:"remoteVideoStats",value:function(){return this._stats.videoDownStat}},{key:"getLocalAudioStats",value:function(e){if("function"!=typeof e)throw C.warn("API getLocalAudioStats() error - parameter: callback invalid"),new TypeError("callback is not function.");e(this._stats.audioUpStat)}},{key:"localAudioStats",value:function(){return this._stats.audioUpStat}},{key:"getLocalVideoStats",value:function(e){if("function"!=typeof e)throw C.warn("API getLocalVideoStats() error - parameter: callback invalid"),new TypeError("callback is not function.");e(this._stats.videoUpStat)}},{key:"localVideoStats",value:function(){return this._stats.videoUpStat}},{key:"setLiveMixerLayout",value:(H=(0,c.default)(s.default.mark((function e(t,r,n){var a,o,c,d,l,p,f,m,h,v,_,g,b,I,k,S;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API setLiveMixerLayout() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API setLiveMixerLayout() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");case 6:if(t&&t.users){e.next=10;break}return C.warn("API setLiveMixerLayout() error - [INVALID_PARAM] - param [liveMixerLayout] invalid"),n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [liveMixerLayout] - liveMixerLayout invalid"}),e.abrupt("return");case 10:if(C.debug("API setLiveMixerLayout() >> liveMixerLayout: "+(0,u.default)(t)),this._protooTransportStat&&this._protooPeer){e.next=15;break}return C.warn("API setLiveMixerLayout() << fail - [CONNECT_BROKEN] - protooTransport broken"),n("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 15:if(this._joined){e.next=19;break}return C.warn("API setLiveMixerLayout() << fail - [NOT_LOGIN] - non-joined"),n("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"}),e.abrupt("return");case 19:if(1==+this._role){e.next=23;break}return C.warn("API setLiveMixerLayout() << fail - [PERMISSION_DENIED] - Must be master - this._role: "+this._role),n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied - Must be Master(role=1)"}),e.abrupt("return");case 23:if(a=[],this._liveMixerLayout&&this._liveMixerLayout.users)for(o=0;o<t.users.length;o++)for(c=0;c<this._liveMixerLayout.users.length;c++)this._liveMixerLayout.users[c].streamId===t.users[o].streamId&&a.push(this._liveMixerLayout.users[c]);d=[],this._liveMixerLayout&&this._liveMixerLayout.users&&(d=this._liveMixerLayout.users.filter((function(e){return!a.find((function(t){return e.streamId===t.streamId}))}))),l=t.users.filter((function(e){return!a.find((function(t){return e.streamId===t.streamId}))})),C.debug("API setLiveMixerLayout() - liveMixerLayout: "+(0,u.default)(t)+" - this._liveMixerLayout: "+(0,u.default)(this._liveMixerLayout)+" - addUser: "+(0,u.default)(l)+" delUser: "+(0,u.default)(d)),e.prev=29,p="",f=0,f=0;case 33:if(!(f<d.length)){e.next=42;break}if(!d[f]){e.next=39;break}return m={type:"del",peerId:""+d[f].userId,devId:""+d[f].streamId||""},p=p+" - "+(0,u.default)(m),e.next=39,this._protooPeer.send("setMixer",m);case 39:f++,e.next=33;break;case 42:""!==p&&C.debug("API setLiveMixerLayout() - type: del - setMixer: "+p),p="",f=0;case 45:if(!(f<l.length)){e.next=54;break}if(!l[f]){e.next=51;break}return h={type:"add",peerId:""+l[f].userId,devId:""+l[f].streamId||""},p=p+" - "+(0,u.default)(h),e.next=51,this._protooPeer.send("setMixer",h);case 51:f++,e.next=45;break;case 54:return""!==p&&C.debug("API setLiveMixerLayout() - type: add - setMixer: "+p),v=232,_=230,g=232,b=t.backgroundColor?t.backgroundColor.toString(16):"00000000",(I=b.length)<=2?g=parseInt("0x"+b.slice(0)):I<=4?(g=parseInt("0x"+b.slice(I-2)),_=parseInt("0x"+b.slice(0,I-2))):(g=parseInt("0x"+b.slice(I-2)),_=parseInt("0x"+b.slice(I-4,I-2)),v=parseInt("0x"+b.slice(0,I-4))),k=(new Date).getTime(),S={ts:""+k,ver:"20161227",canvas:{bgrad:[v,_,g],h:t.height?t.height:480,w:t.width?t.width:640},mid:""+this._uid,pos:[]},t.users.forEach((function(e){if(e&&"object"===(void 0===e?"undefined":(0,i.default)(e))){var t={};t.id=""+e.streamId,t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t.z=e.z,t.renderMode=e.renderMode,S.pos.push(t)}})),e.next=66,this._protooPeer.send("setSEI",{sei:S});case 66:return this._liveMixerLayout=y.clone(t),C.debug("API setLiveMixerLayout() << success - sei: "+(0,u.default)(S)+" - this._liveMixerLayout: "+(0,u.default)(this._liveMixerLayout)),r(),e.abrupt("return");case 72:return e.prev=72,e.t0=e.catch(29),C.warn("API setLiveMixerLayout() << fail - [TASK_FAIL] - "+e.t0.name+" "+e.t0.message),n("TASK_FAIL",{code:P.tttErrCode.TASK_FAIL,name:"TASK_FAIL",origin:""+e.t0.name,message:"setLiveMixerLayout fail - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 77:case"end":return e.stop()}}),e,this,[[29,72]])}))),function(e,t,r){return H.apply(this,arguments)})},{key:"setSEI",value:(U=(0,c.default)(s.default.mark((function e(t,r,n,i,a,o,c){var d,l;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._protooTransportStat&&this._protooPeer){e.next=4;break}return C.warn("API setSEI() error - [CONNECT_BROKEN] - protooTransport broken"),"function"==typeof c&&c("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 4:if(this._joined){e.next=8;break}return C.warn("API setSEI() error - [NOT_LOGIN] - non-joined"),"function"==typeof c&&c("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"}),e.abrupt("return");case 8:if(1==+this._role){e.next=12;break}return C.warn("API setSEI() error - [PERMISSION_DENIED] - Must be master - this._role: "+this._role),"function"==typeof c&&c("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied - Must be master"}),e.abrupt("return");case 12:if(d="","add"===r.toLocaleLowerCase()?d="add":"del"===r.toLocaleLowerCase()&&(d="del"),""!==d){e.next=18;break}return C.warn("setSEI() error - [INVALID_PARAM] - parameter [type] type: "+r+" is INVALID"),"function"==typeof c&&c("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [type] is invalid"}),e.abrupt("return");case 18:return l={type:d,peerId:""+t,devId:a||""},n&&(l.devId=t+":screen",i.pos=i.pos.map((function(e){return e.id===a&&(e.id=t+":screen"),e}))),C.debug("API setSEI() - uid: "+t+" type: "+r+" isScreen: "+n+" sType: "+(0,u.default)(l)+" sei: "+(0,u.default)(i)+" devId: "+a),e.prev=21,e.next=24,this._protooPeer.send("setMixer",l);case 24:return e.next=26,this._protooPeer.send("setSEI",{sei:i});case 26:return C.debug("API setSEI() success"),"function"==typeof o&&o(),e.abrupt("return");case 31:return e.prev=31,e.t0=e.catch(21),C.warn("API setSEI() fail - [ERROR_UNDEFINED] - this._protooPeer.send - "+e.t0.name+" "+e.t0.message),"function"==typeof c&&c("ERROR_UNDEFINED",{code:P.tttErrCode.ERROR_UNDEFINED,name:"ERROR_UNDEFINED",origin:""+e.t0.name,message:"setSEI fail - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 36:case"end":return e.stop()}}),e,this,[[21,31]])}))),function(e,t,r,n,i,a,o){return U.apply(this,arguments)})},{key:"subscribeOtherRoom",value:(F=(0,c.default)(s.default.mark((function e(t,r,n){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API subscribeOtherRoom() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API subscribeOtherRoom() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");case 6:if(t){e.next=10;break}return C.warn("API subscribeOtherRoom() error - [INVALID_PARAM] - parameter: subscribeRoomId invalid"),n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [subscribeRoomId] is invalid"}),e.abrupt("return");case 10:if(C.warn("API subscribeOtherRoom() >> subscribeRoomId: "+t),this._protooTransportStat&&this._protooPeer){e.next=15;break}return C.warn("API subscribeOtherRoom() << fail - [CONNECT_BROKEN] - protooTransport broken"),n("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 15:if(this._joined){e.next=19;break}return C.warn("API subscribeOtherRoom() << fail - [NOT_LOGIN] - non-joined"),n("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"}),e.abrupt("return");case 19:if(1==+this._role){e.next=23;break}return C.warn("API subscribeOtherRoom() << fail - [PERMISSION_DENIED] - Must be master - this._role: "+this._role),n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied - Must be Master(role=1)"}),e.abrupt("return");case 23:return e.prev=23,e.next=26,this._protooPeer.send("subscribeOtherRoom",{subscribeRoomId:t});case 26:return C.warn("API subscribeOtherRoom() << success - subscribeRoomId: "+t),r(),e.abrupt("return");case 31:return e.prev=31,e.t0=e.catch(23),C.warn("API subscribeOtherRoom() << fail - [TASK_FAIL] - subscribeRoomId: "+t),n("TASK_FAIL",{code:P.tttErrCode.TASK_FAIL,name:"TASK_FAIL",origin:"",message:"subscribeOtherRoom except - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 36:case"end":return e.stop()}}),e,this,[[23,31]])}))),function(e,t,r){return F.apply(this,arguments)})},{key:"unsubscribeOtherRoom",value:(j=(0,c.default)(s.default.mark((function e(t,r,n){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API unsubscribeOtherRoom() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API unsubscribeOtherRoom() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");case 6:if(t){e.next=10;break}return C.warn("API unsubscribeOtherRoom() error - [INVALID_PARAM] - parameter: unsubscribeRoomId invalid"),n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [unsubscribeRoomId] is invalid"}),e.abrupt("return");case 10:if(C.warn("API unsubscribeOtherRoom() >> unsubscribeRoomId: "+t),this._protooTransportStat&&this._protooPeer){e.next=15;break}return C.warn("API unsubscribeOtherRoom() << fail - [CONNECT_BROKEN] - protooTransport broken"),n("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 15:if(this._joined){e.next=19;break}return C.warn("API unsubscribeOtherRoom() << fail - [NOT_LOGIN] - non-joined"),n("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"}),e.abrupt("return");case 19:if(1==+this._role){e.next=23;break}return C.warn("API unsubscribeOtherRoom() << fail - [PERMISSION_DENIED] - Must be master - this._role: "+this._role),n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied - Must be Master(role=1)"}),e.abrupt("return");case 23:return e.prev=23,e.next=26,this._protooPeer.send("unsubscribeOtherRoom",{unsubscribeRoomId:t});case 26:C.warn("API unsubscribeOtherRoom() >> success - subscribeRoomId: "+t),r(),e.next=35;break;case 30:return e.prev=30,e.t0=e.catch(23),C.warn("API unsubscribeOtherRoom() >> fail - [TASK_FAIL] - subscribeRoomId: "+t),n("TASK_FAIL",{code:P.tttErrCode.TASK_FAIL,name:"TASK_FAIL",origin:""+e.t0.name,message:"unsubscribeOtherRoom except - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 35:case"end":return e.stop()}}),e,this,[[23,30]])}))),function(e,t,r){return j.apply(this,arguments)})},{key:"setUserRole",value:(V=(0,c.default)(s.default.mark((function e(t,r,n){var i;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API setUserRole() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API setUserRole() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");case 6:if(t){e.next=10;break}return C.warn("API setUserRole() error - [INVALID_PARAM] - parameter [role] is INVALID."),n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [role] is invalid"}),e.abrupt("return");case 10:if(i=+t,!this._joined){e.next=48;break}if(this._protooTransportStat){e.next=16;break}return C.warn("API setUserRole() error - [CONNECT_BROKEN] - protooTransport broken"),n("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 16:if(3!==i||!this.isPublish){e.next=20;break}return C.warn("API setUserRole() error - [ERROR_UNDEFINED] - unpublish all the stream before setUserRole"),n("ERROR_UNDEFINED",{code:P.tttErrCode.ERROR_UNDEFINED,name:"ERROR_UNDEFINED",origin:"",message:"Please unpublish all stream"}),e.abrupt("return");case 20:if(+this._role!==i){e.next=23;break}return r(),e.abrupt("return");case 23:if(2===i||3===i){e.next=27;break}return C.warn("API setUserRole() error - [CONNECT_BROKEN] - Role: Only allowed between 2 | 3"),n("INVALID_PARAM",{code:P.tttErrCode.CONNECT_BROKEN,name:"INVALID_PARAM",origin:"",message:"param [role] is invalid - Role: Only allowed between 2 | 3"}),e.abrupt("return");case 27:if(1!=+this._role){e.next=31;break}return C.warn("API setUserRole() error - [CONNECT_BROKEN] - Role: Only allowed between 2 | 3"),n("INVALID_PARAM",{code:P.tttErrCode.CONNECT_BROKEN,name:"INVALID_PARAM",origin:"",message:"param [role] is invalid - Role: Only allowed between 2 | 3"}),e.abrupt("return");case 31:return C.debug("API setUserRole() - role: "+i),e.prev=32,e.next=35,this._protooPeer.send("changeRole",{role:i});case 35:return C.debug("API setUserRole() success"),this._role=i+"",r(),e.abrupt("return");case 41:return e.prev=41,e.t0=e.catch(32),C.warn("API setUserRole() fail - [TASK_FAIL] - "+e.t0.name+" "+e.t0.message),n("TASK_FAIL",{code:P.tttErrCode.TASK_FAIL,name:"TASK_FAIL",origin:""+e.t0.name,message:"setUserRole except - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 46:e.next=55;break;case 48:if(!(i>3||i<1)){e.next=52;break}return C.warn("API setUserRole() error - [INVALID_PARAM] - parameter [role] is INVALID."),n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [role] is invalid - Role: Only allowed between 1 | 2 | 3"}),e.abrupt("return");case 52:C.debug("API setUserRole() - role: "+t),this._role=t+"",r();case 55:case"end":return e.stop()}}),e,this,[[32,41]])}))),function(e,t,r){return V.apply(this,arguments)})},{key:"setVideoMixerBGIUrl",value:(B=(0,c.default)(s.default.mark((function e(t,r,n){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API setVideoMixerBGIUrl() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API setVideoMixerBGIUrl() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");case 6:if("string"==typeof t){e.next=10;break}return C.warn("API setVideoMixerBGIUrl() error - [INVALID_PARAM] - url: "+(void 0===t?"undefined":(0,i.default)(t))),n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [url] is invalid"}),e.abrupt("return");case 10:this._videoMixerBGIUrl=t.trim(),r();case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return B.apply(this,arguments)})},{key:"setRtmpUrl",value:(E=(0,c.default)(s.default.mark((function e(t,r,n){var i,a,o;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return C.warn("API setRtmpUrl() error - [INVALID_PARAM] - opts"),"function"==typeof n&&n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"Param [opts] is invalid"}),e.abrupt("return");case 4:if(i="string"==typeof t.url?t.url.trim():"",a=t.avMode,o=0,o=void 0!==a&&"audio"===a?1:2,1==+this._role){e.next=12;break}return C.warn("API setRtmpUrl() error - [PERMISSION_DENIED] - Must be master - this._role: "+this._role),"function"==typeof n&&n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied - Must be master"}),e.abrupt("return");case 12:if("default"===i&&(i=this._defaultRtmpUrl),this._valid_rtmp_url=i.trim(),!this._joined){e.next=26;break}return e.prev=15,e.next=18,this._protooPeer.send("updateRtmpUrl",{roomId:this._roomId,url:i,mediaType:o});case 18:C.debug("API setRtmpUrl() success - "+i+" mediaType: "+o),e.next=26;break;case 21:return e.prev=21,e.t0=e.catch(15),C.warn("API setRtmpUrl() exept - [SYS_EXCEPTION] - "+e.t0.name+" "+e.t0.message),"function"==typeof n&&n("SYS_EXCEPTION",{code:P.tttErrCode.SYS_EXCEPTION,name:"SYS_EXCEPTION",origin:""+e.t0.name,message:"setRtmpUrl except - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 26:"function"==typeof r&&r();case 27:case"end":return e.stop()}}),e,this,[[15,21]])}))),function(e,t,r){return E.apply(this,arguments)})},{key:"renewToken",value:(A=(0,c.default)(s.default.mark((function e(t,r,n){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=3;break}throw C.error("API renewToken() error - parameter: onSuccess invalid"),TypeError("onSuccess is not function.");case 3:if("function"==typeof n){e.next=6;break}throw C.error("API renewToken() error - parameter: onFailure invalid"),TypeError("onFailure is not function.");case 6:if(this._joined){e.next=10;break}return C.warn("you should join room first - [NOT_LOGIN]"),n("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"}),e.abrupt("return");case 10:if("string"!=typeof t){e.next=23;break}return e.prev=11,e.next=14,this._protooPeer.send("refreshToken",{token:t});case 14:C.debug("API renewToken() success"),e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(11),n("SYS_EXCEPTION",{code:P.tttErrCode.SYS_EXCEPTION,name:"SYS_EXCEPTION",origin:""+e.t0.name,message:"except - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 21:e.next=26;break;case 23:return C.debug("API renewToken() error - [INVALID_PARAM] - Param error - token is invalid"),n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"Param [token] is invalid"}),e.abrupt("return");case 26:case"end":return e.stop()}}),e,this,[[11,17]])}))),function(e,t,r){return A.apply(this,arguments)})},{key:"kickOut",value:(k=(0,c.default)(s.default.mark((function e(t,r,n){var i;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._protooTransportStat){e.next=4;break}return C.warn("API kickOut() error - [CONNECT_BROKEN] - protooTransport broken"),"function"==typeof n&&n("CONNECT_BROKEN",{code:P.tttErrCode.CONNECT_BROKEN,name:"CONNECT_BROKEN",origin:"",message:"protooTransport is broken"}),e.abrupt("return");case 4:if(this._joined){e.next=8;break}return C.warn("API kickOut() error - [NOT_LOGIN] - non-joined"),"function"==typeof n&&n("NOT_LOGIN",{code:P.tttErrCode.NOT_LOGIN,name:"NOT_LOGIN",origin:"",message:"client is not login"}),e.abrupt("return");case 8:if(t){e.next=12;break}return C.warn("API kickOut() error - [INVALID_PARAM] - parameter [userId] is INVALID."),"function"==typeof n&&n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [userId] is invalid"}),e.abrupt("return");case 12:if(""!==(i=(i=t+"").trim())){e.next=18;break}return C.warn("API kickOut() error - [INVALID_PARAM] - parameter [userId] is INVALID."),"function"==typeof n&&n("INVALID_PARAM",{code:P.tttErrCode.INVALID_PARAM,name:"INVALID_PARAM",origin:"",message:"param [userId] is invalid"}),e.abrupt("return");case 18:if(1==+this._role){e.next=22;break}return C.warn("API kickOut() error - [PERMISSION_DENIED] - Must be master - this._role: "+this._role),"function"==typeof n&&n("PERMISSION_DENIED",{code:P.tttErrCode.PERMISSION_DENIED,name:"PERMISSION_DENIED",origin:"",message:"Permission denied - Must be master"}),e.abrupt("return");case 22:if(this._peers.get(""+i)){e.next=26;break}return C.warn("API kickOut() error - [ERROR_UNDEFINED] - userId: "+i+" not found."),"function"==typeof n&&n("ERROR_UNDEFINED",{code:P.tttErrCode.ERROR_UNDEFINED,name:"ERROR_UNDEFINED",origin:"",message:"peer: "+i+" not found"}),e.abrupt("return");case 26:return e.prev=26,e.next=29,this._protooPeer.send("kickout",{peerId:i});case 29:return C.debug("API kickOut() sucess - userId: "+i),"function"==typeof r&&r(),e.abrupt("return");case 34:return e.prev=34,e.t0=e.catch(26),C.warn("API kickOut() fail - [SYS_EXCEPTION] - "+e.t0.name+" "+e.t0.message),n("SYS_EXCEPTION",{code:P.tttErrCode.SYS_EXCEPTION,name:"SYS_EXCEPTION",origin:""+e.t0.name,message:"kickOut except - "+e.t0.name+" "+e.t0.message}),e.abrupt("return");case 39:case"end":return e.stop()}}),e,this,[[26,34]])}))),function(e,t,r){return k.apply(this,arguments)})},{key:"getTransportStatus",value:function(){return{iceSendTransport:this._sendTransport?this._sendTransport.connectionState:"fault",iceRecvTransport:this._recvTransport?this._recvTransport.connectionState:"fault",websocketTransport:this._protooPeer&&this._protooPeer._transport?this._protooPeer._transport.connected:"fault",loginStatus:this._joined?"online":"offline"}}},{key:"_extractResolution",value:function(e){var t={frameHeight:0,frameWidth:0},r={};return e.forEach((function(e){(0,n.default)(e).forEach((function(r){"frameheight"===r.toLocaleLowerCase()&&(t.frameHeight=e[r]),"framewidth"===r.toLocaleLowerCase()&&(t.frameWidth=e[r])}));try{if(0!==t.frameWidth)throw r}catch(e){if(e!==r)throw e}})),t}},{key:"_newTransport",value:(_=(0,c.default)(s.default.mark((function e(t,r){var n,i,a=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="",t){e.next=3;break}return e.abrupt("return");case 3:if("send"===t||"recv"===t){e.next=5;break}return e.abrupt("return");case 5:n=r&&""!==r?r:"SEND_MIC_WEBCAM",i=null,e.prev=7,i=this._room.createTransport("send",{media:n}),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(7),C.warn("_newTransport() this._room.createTransport fail - "+e.t0.name+" "+e.t0.message),e.abrupt("return");case 15:return C.debug("_newTransport() createTransport succ"),i.on("close",(function(e){C.debug("sendTransport event -- [close] - [originator: "+e+"]")})),i.on("connectionstatechange",function(){var e=(0,c.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"disconnected"===t?(a._iceSendDisconnectedCnt++,C.warn("sendTransport event -- [connectionstatechange:disconnected] will retryRestartIce after 500ms"),setTimeout((function(){i.attemptRestartIce()}),500)):"failed"===t?(C.warn("sendTransport event -- [connectionstatechange:failed] will retryRestartIce..."),i.attemptRestartIce()):"connected"===t&&R(i._handler._pc,(function(e){a._stats.setWebrtcInternalSendStats(i.id,e)}),1e3,"send"),C.debug("sendTransport connectionstatechange: "+t);case 2:case"end":return e.stop()}}),e,a)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",i);case 19:case"end":return e.stop()}}),e,this,[[7,11]])}))),function(e,t){return _.apply(this,arguments)})},{key:"_internalStats",value:function(e,t,r,n){var i={appId:this._appId,userId:this._uid,roomId:this._roomId,stats:"internalStats",direction:e,"media-source":[],certificate:[],codec:[],"candidate-pair":[],"local-candidate":[],"remote-candidate":[],"inbound-rtp":[],"outbound-rtp":[],"remote-inbound-rtp":[],track:[],stream:[],"peer-connection":[],transport:[]};return t.forEach((function(e){e.type,"codec"===e.type&&i.codec.push(e),"candidate-pair"===e.type&&i["candidate-pair"].push(e),"local-candidate"===e.type&&i["local-candidate"].push(e),"inbound-rtp"===e.type&&i["inbound-rtp"].push(e),"track"===e.type&&i.track.push(e),"stream"===e.type&&i.stream.push(e),"peer-connection"===e.type&&i["peer-connection"].push(e),"transport"===e.type&&i.transport.push(e),"media-source"===e.type&&i["media-source"].push(e),"transport"===e.type&&i.transport.push(e)})),"receiverStats"===e&&(i.consumerPeerId=r,i.consumer=n),i}},{key:"producerStreams",get:function(){var e=[];return this._publishStreams.forEach((function(t,r){if(t){var n={streamId:t.streamID,type:t.streamType,userId:t.userID,specialCameraId:t.specialCameraId,specialMicId:t.specialMicId,hasVideo:t.hasVideo(),hasAudio:t.hasAudio()};e.push(n)}})),e}},{key:"consumerStreams",get:function(){var e=[];return this._peers.forEach((function(t,r){t.streams&&t.streams.forEach((function(t,r){if(t){var n={streamId:t.streamID,type:t.streamType,userId:t.userID,specialCameraId:t.specialCameraId,specialMicId:t.specialMicId,hasVideo:t.hasVideo(),hasAudio:t.hasAudio()};e.push(n)}}))})),e}},{key:"micProducers",get:function(){var e=[];return this._audioProducer&&e.push({id:this._audioProducer.id,appData:this._audioProducer.appData}),e}},{key:"webcamProducers",get:function(){var e=[];return this._mapVideoProducers.forEach((function(t,r){var n={id:r,appData:t.appData};e.push(n)})),e}},{key:"screenProducers",get:function(){var e=[];if(null!=this._screenProducer){var t={streamId:"x_screen",appData:this._screenProducer.appData};e.push(t)}return e}},{key:"isLocalStreamAllowed",get:function(){var e=+this._role;return 1===e||2===e}},{key:"isPublish",get:function(){return!!this._publishs&&this._publishs.size>0}},{key:"closed",get:function(){return this._closed}}],[{key:"signalTimeout",set:function(e){if(e){var t=Number(e);t>0&&t<120&&1e3*t}}},{key:"logStat",set:function(e){x=e}},{key:"TurnConf",set:function(e){if(!e)throw new TypeError("Invalid parameter");try{O=JSON.parse((0,u.default)(e))}catch(e){throw e}}}]),r}(k.EventEmitter);t.default=B}).call(this,r(38))},function(e,t,r){r(169),e.exports=r(7).Object.keys},function(e,t,r){var n=r(34),i=r(49);r(79)("keys",(function(){return function(e){return i(n(e))}}))},function(e,t,r){e.exports={default:r(171),__esModule:!0}},function(e,t,r){r(41),r(31),e.exports=r(172)},function(e,t,r){var n=r(58),i=r(15)("iterator"),a=r(39);e.exports=r(7).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||a.hasOwnProperty(n(t))}},function(e,t,r){r(41),r(31),e.exports=r(174)},function(e,t,r){var n=r(25),i=r(76);e.exports=r(7).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c,d=[],u=!1,l=-1;function p(){u&&c&&(u=!1,c.length?d=c.concat(d):l=-1,d.length&&f())}function f(){if(!u){var e=s(p);u=!0;for(var t=d.length;t;){for(c=d,d=[];++l<t;)c&&c[l].run();l=-1,t=d.length}c=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new m(e,t)),1!==d.length||u||s(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){e.exports=function(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let r;function o(...e){if(!o.enabled)return;const t=o,i=Number(new Date),a=i-(r||i);t.diff=a,t.prev=r,t.curr=i,r=i,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,i)=>{if("%%"===r)return r;s++;const a=n.formatters[i];if("function"==typeof a){const n=e[s];r=a.call(t,n),e.splice(s,1),s--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return o.namespace=e,o.enabled=n.enabled(e),o.useColors=n.useColors(),o.color=t(e),o.destroy=i,o.extend=a,"function"==typeof n.init&&n.init(o),n.instances.push(o),o}function i(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function a(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(o),...n.skips.map(o).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(t=0;t<i;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=r(177),Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n}},function(e,t){var r=1e3,n=6e4,i=36e5,a=24*i;function o(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*a;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=a)return o(e,t,a,"day");if(t>=i)return o(e,t,i,"hour");if(t>=n)return o(e,t,n,"minute");if(t>=r)return o(e,t,r,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=a)return Math.round(e/a)+"d";if(t>=i)return Math.round(e/i)+"h";if(t>=n)return Math.round(e/n)+"m";if(t>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){var n=r(179);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],e)"function"==typeof e[i]&&n.push(i);for(var a=0;a<n.length;a++){var o=n[a],s=e[o];e[o]=function(n){var i=t.operation(r),a=Array.prototype.slice.call(arguments,1),o=a.pop();a.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),o.apply(this,arguments))})),i.attempt((function(){n.apply(e,a)}))}.bind(e,s),e[o].options=r}}},function(e,t){function r(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,i=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&i.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],a=i.message,o=(e[a]||0)+1;e[a]=o,o>=r&&(t=i,r=o)}return t}},function(e,t,r){"use strict";!function(){function e(e,t,r){var n={audio:!1,video:{mandatory:{chromeMediaSource:e?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return r&&(n.audio={mandatory:{chromeMediaSource:e?"screen":"desktop"},optional:[]}),t&&(n.video.mandatory.chromeMediaSourceId=t,n.audio&&n.audio.mandatory&&(n.audio.mandatory.chromeMediaSourceId=t)),n}function t(e){r?r.isLoaded?e?e.forEach?r.contentWindow.postMessage({captureCustomSourceId:e},"*"):r.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):r.contentWindow.postMessage({captureSourceId:!0},"*"):setTimeout((function(){t(e)}),100):n((function(){t(e)}))}var r;function n(e){r?e():((r=document.createElement("iframe")).onload=function(){r.isLoaded=!0,e()},r.src="https://www.webrtc-experiment.com/getSourceId/",r.style.display="none",(document.body||document.documentElement).appendChild(r))}function i(){r?r.isLoaded?r.contentWindow.postMessage({getChromeExtensionStatus:!0},"*"):setTimeout(i,100):n(i)}window.getScreenId=function(r,n){-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob?navigator.mozGetUserMedia?r(null,"firefox",{video:{mozMediaSource:"window",mediaSource:"window"}}):(window.addEventListener("message",(function t(n){if(!n.data)return;n.data.chromeMediaSourceId&&("PermissionDeniedError"===n.data.chromeMediaSourceId?r("permission-denied"):r(null,n.data.chromeMediaSourceId,e(null,n.data.chromeMediaSourceId,n.data.canRequestAudioTrack)),window.removeEventListener("message",t));n.data.chromeExtensionStatus&&(r(n.data.chromeExtensionStatus,null,e(n.data.chromeExtensionStatus)),window.removeEventListener("message",t))})),n?setTimeout((function(){t(n)}),100):setTimeout(t,100)):r({video:!0})},window.getScreenConstraints=function(e){n((function(){getScreenId((function(t,r,n){n||(n={video:!0}),e(t,n.video)}))}))},window.getChromeExtensionStatus=function(e){navigator.mozGetUserMedia?e("installed-enabled"):(window.addEventListener("message",(function t(r){if(!r.data)return;r.data.chromeExtensionStatus&&(e(r.data.chromeExtensionStatus),window.removeEventListener("message",t))})),setTimeout(i,100))}}()},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,r){var n,i=r(183);"undefined"!=typeof window&&(n=window.AudioContext||window.webkitAudioContext);var a=null;e.exports=function(e,t){var r=new i;if(!n)return r;var o,s,c,d=(t=t||{}).smoothing||.1,u=t.interval||50,l=t.threshold,p=t.play,f=t.history||10,m=!0;a=t.audioContext||a||new n,(c=a.createAnalyser()).fftSize=512,c.smoothingTimeConstant=d,s=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(o=a.createMediaElementSource(e),void 0===p&&(p=!0),l=l||-50):(o=a.createMediaStreamSource(e),l=l||-50),o.connect(c),p&&c.connect(a.destination),r.speaking=!1,r.suspend=function(){return a.suspend()},r.resume=function(){return a.resume()},Object.defineProperty(r,"state",{get:function(){return a.state}}),a.onstatechange=function(){r.emit("state_change",a.state)},r.setThreshold=function(e){l=e},r.setInterval=function(e){u=e},r.stop=function(){m=!1,r.emit("volume_change",-100,l),r.speaking&&(r.speaking=!1,r.emit("stopped_speaking")),c.disconnect(),o.disconnect()},r.speakingHistory=[];for(var h=0;h<f;h++)r.speakingHistory.push(0);var v=function(){setTimeout((function(){if(m){var e=function(e,t){var r=-1/0;e.getFloatFrequencyData(t);for(var n=4,i=t.length;n<i;n++)t[n]>r&&t[n]<0&&(r=t[n]);return r}(c,s);r.emit("volume_change",e,l);var t=0;if(e>l&&!r.speaking){for(var n=r.speakingHistory.length-3;n<r.speakingHistory.length;n++)t+=r.speakingHistory[n];t>=2&&(r.speaking=!0,r.emit("speaking"))}else if(e<l&&r.speaking){for(n=0;n<r.speakingHistory.length;n++)t+=r.speakingHistory[n];0==t&&(r.speaking=!1,r.emit("stopped_speaking"))}r.speakingHistory.shift(),r.speakingHistory.push(0+(e>l)),v()}}),u)};return v(),r}},function(e,t){function r(){}e.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,r){this.callbacks=this.callbacks||{};var n=3===arguments.length,i=n?arguments[1]:void 0,a=n?arguments[2]:arguments[1];return a._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(a),this},t.once=function(e,t,r){var n=this,i=3===arguments.length,a=i?arguments[1]:void 0,o=i?arguments[2]:arguments[1];function s(){n.off(e,s),o.apply(this,arguments)}return this.on(e,a,s),this},t.releaseGroup=function(e){var t,r,n,i;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(r=0,n=(i=this.callbacks[t]).length;r<n;r++)i[r]._groupName===e&&(i.splice(r,1),r--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(-1!==(r=n.indexOf(t))&&(n.splice(r,1),0===n.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,r,n,i=[].slice.call(arguments,1),a=this.callbacks[e],o=this.getWildcardCallbacks(e);if(a)for(t=0,r=(n=a.slice()).length;t<r&&n[t];++t)n[t].apply(this,i);if(o)for(r=o.length,t=0,r=(n=o.slice()).length;t<r&&n[t];++t)n[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,r,n=[];for(t in this.callbacks)r=t.split("*"),("*"===t||2===r.length&&e.slice(0,r[0].length)===r[0])&&(n=n.concat(this.callbacks[t]));return n}},r.mixin(r)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=P(r(17)),i=P(r(8)),a=P(r(6)),o=P(r(20)),s=P(r(18)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(36)),b=P(r(37)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}r(35);var S=new m.default("Chrome70"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),S.debug("Handler::constructor() direction: "+e+" settings: "+(0,s.default)(n)+" configure: "+(0,s.default)(a)),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener("icecandidate",(function(e){var t={candidate:"",type:""};Boolean(e)&&Boolean(e.candidate)&&(t.candidate=e.candidate.candidate,t.type=e.candidate.type),i.emit("@icecandidate",t)})),i._pc.addEventListener("icecandidateerror",(function(e){i.emit("@icecandidateerror","icecandidateerror")})),i._pc.addEventListener("icegatheringstatechange",(function(e){i.emit("@icegatheringstatechange",{iceGatheringState:i._pc.iceGatheringState})})),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:"close",value:function(){S.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){S.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._trackIds=new o.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(S.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._trackIds.has(r.id))return a.default.reject(new Error("track already added"));var n="isac";e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(S.debug("addProducer() [id:%s, kind:%s, trackId:%s] producer.audioProfile: %o",e.id,e.kind,r.id,e.audioProfile),n=e.audioProfile.codec.toLowerCase());var i=void 0,o=void 0;return this._trackIds.add(r.id),a.default.resolve().then((function(){if(i=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&"inactive"===e.direction})))return S.debug("addProducer() | reusing an inactive transceiver"),i.direction="sendonly",i.sender.replaceTrack(r);i=t._pc.addTransceiver(r,{direction:"sendonly"})})).then((function(){return t._pc.createOffer()})).then((function(a){if(a.sdp=I.default.setVideoBitrates(a.sdp,e.videoBitrateOptions),a.sdp=I.default.setOpusAttributes(a.sdp,e.audioProfile),a.sdp=I.default.setSpecialAudioCodec(a.sdp,n),e.simulcast){S.debug("addProducer() | enabling simulcast");var o=f.default.parse(a.sdp);y.addPlanBSimulcast(o,r,{mid:i.mid}),a={type:"offer",sdp:f.default.write(o)}}return S.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",a),t._pc.setLocalDescription(a)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){o=f.default.parse(t._pc.localDescription.sdp),S.debug("addProducer() | this._pc.localDescription.sdp: ",o," - producer.videoBitrateOptions: ",e.videoBitrateOptions);var r=t._remoteSdp.createAnswerSdp(o);r=I.default.setVideoBitrates(r,e.videoBitrateOptions),r=I.default.setOpusAttributes(r,e.audioProfile);var i={type:"answer",sdp:r=I.default.setSpecialAudioCodec(r,n)};return S.debug("addProducer() | calling pc.setRemoteDescription() remoteSdp: ",r),t._pc.setRemoteDescription(i)})).then((function(){var a=v.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+n&&a.codecs.splice(t,1)})),S.debug("addProducer() _rtpParametersByKind: %o - rtpParameters: %o",t._rtpParametersByKind[e.kind],a)),y.fillRtpParametersForTrack(a,o,r,{mid:i.mid,planBSimulcast:!0}),a})).catch((function(e){try{i.direction="inactive"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return a.default.reject(new Error("track not found"));var n="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),S.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),a.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){var r=f.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=I.default.setVideoBitrates(i,e.videoBitrateOptions),i=I.default.setOpusAttributes(i,e.audioProfile);var a={type:"answer",sdp:i=I.default.setSpecialAudioCodec(i,n)};return S.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",a),t._pc.setRemoteDescription(a)}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;S.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return a.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:"updateTrack",value:function(e,t){var r,n,i=this;S.debug("update Track() [trackId:%s]",t.id);var o="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(o=e.audioProfile.codec.toLowerCase()),a.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,o),e.simulcast){S.debug("updateTrack() | enabling simulcast");var a=f.default.parse(r.sdp);y.addPlanBSimulcast(a,t,{mid:n.mid}),r={type:"offer",sdp:f.default.write(a)}}return S.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),i._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r);t=I.default.setVideoBitrates(t,e.videoBitrateOptions),t=I.default.setOpusAttributes(t,e.audioProfile);var n={type:"answer",sdp:t=I.default.setSpecialAudioCodec(t,o)};return S.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",n),i._pc.setRemoteDescription(n)})).then((function(){var a=v.clone(i._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+o&&a.codecs.splice(t,1)})),S.debug("updateTrack() _rtpParametersByKind: %o - rtpParameters: %o",i._rtpParametersByKind[e.kind],a)),y.fillRtpParametersForTrack(a,r,t,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new i.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(S.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error("Consumer already added - consumer.id: "+e.id+" consumer.kind: "+e.kind+" consumer.appData: "+(0,s.default)(e.appData)));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,o={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var r={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return S.debug("addConsumer() | calling pc.setRemoteDescription() kind:%s [offer:%o]",e.kind,r),t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(r){return S.debug("addConsumer() | calling pc.setLocalDescription() kind:%s [answer:%o]",e.kind,r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error("remote track not found");return e.receiver.track}))}},{key:"removeConsumer",value:function(e){var t=this;S.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,a.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return S.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error("Consumer not found - consumer.id: "+e.id+" consumer.kind: "+e.kind+" consumer.appData: "+(0,s.default)(e.appData)))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),a.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){S.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(w),E=function(){function e(t,r,n){(0,d.default)(this,e),S.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var i=void 0;switch(t){case"send":return i={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)},new T(i,n);case"recv":return i={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)},new A(i,n)}}return(0,u.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){S.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=f.default.parse(t.sdp);return g.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Chrome70"}}]),e}();t.default=E},function(e,t,r){r(31),r(186),e.exports=r(7).Array.from},function(e,t,r){"use strict";var n=r(27),i=r(12),a=r(34),o=r(93),s=r(94),c=r(56),d=r(187),u=r(76);i(i.S+i.F*!r(100)((function(e){Array.from(e)})),"Array",{from:function(e){var t,r,i,l,p=a(e),f="function"==typeof this?this:Array,m=arguments.length,h=m>1?arguments[1]:void 0,v=void 0!==h,_=0,g=u(p);if(v&&(h=n(h,m>2?arguments[2]:void 0,2)),null==g||f==Array&&s(g))for(r=new f(t=c(p.length));t>_;_++)d(r,_,v?h(p[_],_):p[_]);else for(l=g.call(p),r=new f;!(i=l.next()).done;_++)d(r,_,v?o(l,h,[i.value,_],!0):i.value);return r.length=_,r}})},function(e,t,r){"use strict";var n=r(22),i=r(48);e.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},function(e,t,r){r(54),r(31),r(41),r(189),r(190),r(191),r(192),e.exports=r(7).Set},function(e,t,r){"use strict";var n=r(104),i=r(83);e.exports=r(105)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},function(e,t,r){var n=r(12);n(n.P+n.R,"Set",{toJSON:r(106)("Set")})},function(e,t,r){r(107)("Set")},function(e,t,r){r(108)("Set")},function(e,t,r){"use strict";var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))}(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=r(114),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(o))return i(c,n,o)}})),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){"use strict";var n=r(114),i=/%[sdv%]/g,a=function(e){var t=1,r=arguments,n=r.length;return e.replace(i,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return a.apply(null,n)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||s,i=t.innerOrder||c,a=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(o(t,r,e))}))}))})),e.media.forEach((function(e){a.push(o("m",n.m[0],e)),i.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(o(t,r,e))}))}))}))})),a.join("\r\n")+"\r\n"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=k(r(17)),i=k(r(8)),a=k(r(20)),o=k(r(6)),s=k(r(2)),c=k(r(0)),d=k(r(1)),u=k(r(3)),l=k(r(4)),p=k(r(13)),f=k(r(5)),m=k(r(11)),h=I(r(10)),v=I(r(16)),_=I(r(21)),g=I(r(44)),y=k(r(45)),b=k(r(24));function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function k(e){return e&&e.__esModule?e:{default:e}}r(35);var P=new f.default("Chrome69"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new y.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){P.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),w=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error("track already added"));var n="isac";e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,a=void 0;return o.default.resolve().then((function(){return t._stream.addTrack(r),i=t._pc.addTrack(r,t._stream),t._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug("addProducer() | enabling simulcast");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,r),i={type:"offer",sdp:p.default.write(a)}}return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var i={type:"answer",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",i),t._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+n&&i.codecs.splice(t,1)})),P.debug("addProducer() _rtpParametersByKind: %o - rtpParameters: %o",t._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,a,r),i})).catch((function(e){try{t._pc.removeTrack(i)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track,n="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),o.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn("removeProducer() | ignoring expected error due no sending tracks - "+e.name+" "+e.message)})).then((function(){if("stable"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=b.default.setVideoBitrates(i,e.videoBitrateOptions),i=b.default.setOpusAttributes(i,e.audioProfile);var a={type:"answer",sdp:i=b.default.setSpecialAudioCodec(i,n)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",a),t._pc.setRemoteDescription(a)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),i=_.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:"updateTrack",value:function(e,t){var r,n=this;P.debug("update Track() [trackId:%s]",t.id);var i="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug("updateTrack() | enabling simulcast");var a=p.default.parse(r.sdp);g.addSimulcastForTrack(a,t),r={type:"offer",sdp:p.default.write(a)}}return P.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var a={type:"answer",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",a),n._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(n._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+i&&a.codecs.splice(t,1)})),P.debug("updateTrack() _rtpParametersByKind: %o - rtpParameters: %o",n._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,r,t),a})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new i.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===a.trackId}));if(!e)throw new Error("remote track not found");return e.track}))}},{key:"removeConsumer",value:function(e){var t=this;return P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),o.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),A=function(){function e(t,r,n){(0,c.default)(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var i=void 0;switch(t){case"send":return i={audio:v.getSendingRtpParameters("audio",r),video:v.getSendingRtpParameters("video",r)},new w(i,n);case"recv":return i={audio:v.getReceivingFullRtpParameters("audio",r),video:v.getReceivingFullRtpParameters("video",r)},new T(i,n)}}return(0,d.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Chrome69"}}]),e}();t.default=A},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=k(r(17)),i=k(r(8)),a=k(r(20)),o=k(r(6)),s=k(r(2)),c=k(r(0)),d=k(r(1)),u=k(r(3)),l=k(r(4)),p=k(r(13)),f=k(r(5)),m=k(r(11)),h=I(r(10)),v=I(r(16)),_=I(r(21)),g=I(r(44)),y=k(r(45)),b=k(r(24));function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function k(e){return e&&e.__esModule?e:{default:e}}r(35);var P=new f.default("Chrome67"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new y.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){P.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),w=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error("track already added"));var n="isac";e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0;return o.default.resolve().then((function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug("addProducer() | enabling simulcast");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,r),i={type:"offer",sdp:p.default.write(a)}}return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var a={type:"answer",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",a),t._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+n&&a.codecs.splice(t,1)})),P.debug("addProducer() _rtpParametersByKind: %o - rtpParameters: %o",t._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,i,r),a})).catch((function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id);var n="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn("removeProducer() | ignoring expected error due no sending tracks - "+e.name+" "+e.message)})).then((function(){if("stable"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=b.default.setVideoBitrates(i,e.videoBitrateOptions),i=b.default.setOpusAttributes(i,e.audioProfile);var a={type:"answer",sdp:i=b.default.setSpecialAudioCodec(i,n)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",a),t._pc.setRemoteDescription(a)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),i=_.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:"updateTrack",value:function(e,t){var r,n=this;P.debug("update Track() [trackId:%s]",t.id);var i="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug("updateTrack() | enabling simulcast");var a=p.default.parse(r.sdp);g.addSimulcastForTrack(a,t),r={type:"offer",sdp:p.default.write(a)}}return P.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var a={type:"answer",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",a),n._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(n._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+i&&a.codecs.splice(t,1)})),P.debug("updateTrack() _rtpParametersByKind: %o - rtpParameters: %o",n._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,r,t),a})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new i.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===a.streamId})).getTrackById(a.trackId);if(!e)throw new Error("remote track not found");return e}))}},{key:"removeConsumer",value:function(e){var t=this;return P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),o.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),A=function(){function e(t,r,n){(0,c.default)(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var i=void 0;switch(t){case"send":return i={audio:v.getSendingRtpParameters("audio",r),video:v.getSendingRtpParameters("video",r)},new w(i,n);case"recv":return i={audio:v.getReceivingFullRtpParameters("audio",r),video:v.getReceivingFullRtpParameters("video",r)},new T(i,n)}}return(0,d.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Chrome67"}}]),e}();t.default=A},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=k(r(17)),i=k(r(8)),a=k(r(20)),o=k(r(6)),s=k(r(2)),c=k(r(0)),d=k(r(1)),u=k(r(3)),l=k(r(4)),p=k(r(13)),f=k(r(5)),m=k(r(11)),h=I(r(10)),v=I(r(16)),_=I(r(21)),g=I(r(44)),y=k(r(45)),b=k(r(24));function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function k(e){return e&&e.__esModule?e:{default:e}}r(35);var P=new f.default("Chrome55"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new y.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){P.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),w=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error("track already added"));var n="isac";e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0;return o.default.resolve().then((function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug("addProducer() | enabling simulcast");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,r),i={type:"offer",sdp:p.default.write(a)}}return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var a={type:"answer",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",a),t._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+n&&a.codecs.splice(t,1)})),P.debug("addProducer() _rtpParametersByKind: %o - rtpParameters: %o",t._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,i,r),a})).catch((function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id);var n="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn("removeProducer() | ignoring expected error due no sending tracks - "+e.name+" "+e.message)})).then((function(){if("stable"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=b.default.setVideoBitrates(i,e.videoBitrateOptions),i=b.default.setOpusAttributes(i,e.audioProfile);var a={type:"answer",sdp:i=b.default.setSpecialAudioCodec(i,n)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",a),t._pc.setRemoteDescription(a)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n="isac";e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=e.track,a=void 0;return o.default.resolve().then((function(){return r._stream.removeTrack(i),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug("addProducer() | enabling simulcast");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,t),i={type:"offer",sdp:p.default.write(a)}}return P.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",i),r._pc.setLocalDescription(i)})).then((function(){a=p.default.parse(r._pc.localDescription.sdp);var t=r._remoteSdp.createAnswerSdp(a);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var i={type:"answer",sdp:t=b.default.setSpecialAudioCodec(t,n)};return P.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",i),r._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(r._rtpParametersByKind[e.kind]);i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+n&&i.codecs.splice(t,1)})),P.debug("replaceProducerTrack() _rtpParametersByKind: %o - rtpParameters: %o",r._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,a,t),r.safeEmit("@needupdateproducer",e,i)})).catch((function(e){throw r._stream.removeTrack(t),r._stream.addTrack(i),r._pc.addStream(r._stream),e}))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),i=_.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:"updateTrack",value:function(e,t){var r,n=this;P.debug("update Track() [trackId:%s]",t.id);var i="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug("updateTrack() | enabling simulcast");var a=p.default.parse(r.sdp);g.addSimulcastForTrack(a,t),r={type:"offer",sdp:p.default.write(a)}}return P.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var a={type:"answer",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",a),n._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(n._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+i&&a.codecs.splice(t,1)})),P.debug("updateTrack() _rtpParametersByKind: %o - rtpParameters: %o",n._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,r,t),a})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new i.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===a.streamId})).getTrackById(a.trackId);if(!e)throw new Error("remote track not found");return e}))}},{key:"removeConsumer",value:function(e){var t=this;return P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),o.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),A=function(){function e(t,r,n){(0,c.default)(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var i=void 0;switch(t){case"send":return i={audio:v.getSendingRtpParameters("audio",r),video:v.getSendingRtpParameters("video",r)},new w(i,n);case"recv":return i={audio:v.getReceivingFullRtpParameters("audio",r),video:v.getReceivingFullRtpParameters("video",r)},new T(i,n)}}return(0,d.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Chrome55"}}]),e}();t.default=A},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=S(r(9)),i=S(r(17)),a=S(r(18)),o=S(r(8)),s=S(r(6)),c=S(r(20)),d=S(r(2)),u=S(r(0)),l=S(r(1)),p=S(r(3)),f=S(r(4)),m=S(r(13)),h=S(r(5)),v=S(r(11)),_=P(r(10)),g=P(r(16)),y=P(r(21)),b=P(r(36)),I=S(r(37)),k=S(r(24));function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}var w=new h.default("Safari13"),T=function(e){function t(e,r,n){(0,u.default)(this,t);var i=(0,p.default)(this,(t.__proto__||(0,d.default)(t)).call(this,w)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new I.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,f.default)(t,e),(0,l.default)(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(v.default),A=function(e){function t(e,r){(0,u.default)(this,t);var n=(0,p.default)(this,(t.__proto__||(0,d.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._trackIds=new c.default,n}return(0,f.default)(t,e),(0,l.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._trackIds.has(r.id))return s.default.reject(new Error("track already added"));var n=void 0,i=void 0;return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),this._trackIds.add(r.id),s.default.resolve().then((function(){if(n=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&"inactive"===e.direction})))return w.debug("addProducer() | reusing an inactive transceiver"),n.direction="sendonly",n.sender.replaceTrack(r);n=t._pc.addTransceiver(r,{direction:"sendonly"})})).then((function(){return t._pc.createOffer()})).then((function(i){if(i.sdp=k.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),e.simulcast){w.debug("addProducer() | enabling simulcast");var a=m.default.parse(i.sdp);b.addPlanBSimulcast(a,r,{mid:n.mid}),i={type:"offer",sdp:m.default.write(a)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=m.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i),n={type:"answer",sdp:r=k.default.setVideoBitrates(r,e.videoBitrateOptions)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})).then((function(){var a=_.clone(t._rtpParametersByKind[e.kind]);return b.fillRtpParametersForTrack(a,i,r,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){try{n.direction="inactive"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return s.default.reject(new Error("track not found"));w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id);return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=k.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){var r=m.default.parse(t._pc.localDescription.sdp),n=t._remoteSdp.createAnswerSdp(r),i={type:"answer",sdp:n=k.default.setVideoBitrates(n,e.videoBitrateOptions)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",i),t._pc.setRemoteDescription(i)}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return s.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=m.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),s.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=m.default.parse(r),i=y.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:"updateTrack",value:function(e,t){var r,n,i=this;w.debug("update Track() [trackId:%s]",t.id);return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=k.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),e.simulcast){w.debug("updateTrack() | enabling simulcast");var a=m.default.parse(r.sdp);b.addPlanBSimulcast(a,t,{mid:n.mid}),r={type:"offer",sdp:m.default.write(a)}}return w.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),i._pc.setLocalDescription(r)})).then((function(){r=m.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r),n={type:"answer",sdp:t=k.default.setVideoBitrates(t,e.videoBitrateOptions)};return w.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",n),i._pc.setRemoteDescription(n)})).then((function(){var a=_.clone(i._rtpParametersByKind[e.kind]);return b.fillRtpParametersForTrack(a,r,t,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){throw e}))}}]),t}(T),E=function(e){function t(e,r){(0,u.default)(this,t);var n=(0,p.default)(this,(t.__proto__||(0,d.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new o.default,n}return(0,f.default)(t,e),(0,l.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return s.default.reject(new Error("Consumer already added - consumer.id: "+e.id+" consumer.kind: "+e.kind+" consumer.appData: "+(0,a.default)(e.appData)));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),s.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error("remote track not found");return e.receiver.track}))}},{key:"removeConsumer",value:function(e){var t=this;w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,s.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):s.default.reject(new Error("Consumer not found - consumer.id: "+e.id+" consumer.kind: "+e.kind+" consumer.appData: "+(0,a.default)(e.appData)))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),s.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=m.default.parse(e),r={dtlsParameters:y.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(T),R=function(){function e(t,r,i){(0,u.default)(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var a=void 0;switch(t){case"send":if(!(a={audio:g.getSendingRtpParameters("audio",r),video:g.getSendingRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var o=!0,s=!1,c=void 0;try{for(var d,l=(0,n.default)(a.video.codecs);!(o=(d=l.next()).done);o=!0){var p=d.value;"video/H264"===p.mimeType&&"42001f"===p.parameters["profile-level-id"]&&(p.parameters["profile-level-id"]="42e01f")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new A(a,i);case"recv":if(!(a={audio:g.getReceivingFullRtpParameters("audio",r),video:g.getReceivingFullRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var f=!0,m=!1,h=void 0;try{for(var v,_=(0,n.default)(a.video.codecs);!(f=(v=_.next()).done);f=!0){var y=v.value;"video/H264"===y.mimeType&&"42001f"===y.parameters["profile-level-id"]&&(y.parameters["profile-level-id"]="42e01f")}}catch(e){m=!0,h=e}finally{try{!f&&_.return&&_.return()}finally{if(m)throw h}}}return new E(a,i)}}return(0,l.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=m.default.parse(t.sdp);return y.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Safari13"}}]),e}();t.default=R},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=P(r(9)),i=P(r(17)),a=P(r(8)),o=P(r(6)),s=P(r(20)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(36)),b=P(r(37)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default("Safari12"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:"close",value:function(){S.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){S.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._trackIds=new s.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(S.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._trackIds.has(r.id))return o.default.reject(new Error("track already added"));var n=void 0,i=void 0;return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),this._trackIds.add(r.id),o.default.resolve().then((function(){if(n=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&"inactive"===e.direction})))return S.debug("addProducer() | reusing an inactive transceiver"),n.direction="sendonly",n.sender.replaceTrack(r);n=t._pc.addTransceiver(r,{direction:"sendonly"})})).then((function(){return t._pc.createOffer()})).then((function(i){if(i.sdp=I.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),e.simulcast){S.debug("addProducer() | enabling simulcast");var a=f.default.parse(i.sdp);y.addPlanBSimulcast(a,r,{mid:n.mid}),i={type:"offer",sdp:f.default.write(a)}}return S.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=f.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i),n={type:"answer",sdp:r=I.default.setVideoBitrates(r,e.videoBitrateOptions)};return S.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})).then((function(){var a=v.clone(t._rtpParametersByKind[e.kind]);return y.fillRtpParametersForTrack(a,i,r,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){try{n.direction="inactive"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return o.default.reject(new Error("track not found"));S.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id);return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),o.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),S.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){var r=f.default.parse(t._pc.localDescription.sdp),n=t._remoteSdp.createAnswerSdp(r),i={type:"answer",sdp:n=I.default.setVideoBitrates(n,e.videoBitrateOptions)};return S.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",i),t._pc.setRemoteDescription(i)}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;S.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:"updateTrack",value:function(e,t){var r,n,i=this;S.debug("update Track() [trackId:%s]",t.id);return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),o.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),e.simulcast){S.debug("updateTrack() | enabling simulcast");var a=f.default.parse(r.sdp);y.addPlanBSimulcast(a,t,{mid:n.mid}),r={type:"offer",sdp:f.default.write(a)}}return S.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),i._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r),n={type:"answer",sdp:t=I.default.setVideoBitrates(t,e.videoBitrateOptions)};return S.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",n),i._pc.setRemoteDescription(n)})).then((function(){var a=v.clone(i._rtpParametersByKind[e.kind]);return y.fillRtpParametersForTrack(a,r,t,{mid:n.mid,planBSimulcast:!0}),a})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(S.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,a={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===a.mid}));if(!e)throw new Error("remote track not found");return e.receiver.track}))}},{key:"removeConsumer",value:function(e){var t=this;S.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,o.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),o.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){S.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(w),E=function(){function e(t,r,i){(0,d.default)(this,e),S.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var a=void 0;switch(t){case"send":if(!(a={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var o=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(a.video.codecs);!(o=(u=l.next()).done);o=!0){var p=u.value;"video/H264"===p.mimeType&&"42001f"===p.parameters["profile-level-id"]&&(p.parameters["profile-level-id"]="42e01f")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new T(a,i);case"recv":if(!(a={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var f=!0,m=!1,h=void 0;try{for(var v,g=(0,n.default)(a.video.codecs);!(f=(v=g.next()).done);f=!0){var y=v.value;"video/H264"===y.mimeType&&"42001f"===y.parameters["profile-level-id"]&&(y.parameters["profile-level-id"]="42e01f")}}catch(e){m=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}}return new A(a,i)}}return(0,u.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){S.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=f.default.parse(t.sdp);return g.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Safari12"}}]),e}();t.default=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=P(r(9)),i=P(r(17)),a=P(r(8)),o=P(r(20)),s=P(r(6)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(44)),b=P(r(45)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default("Safari11"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:"close",value:function(){S.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){S.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(S.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return s.default.reject(new Error("track already added"));var n=void 0,i=void 0;return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){return t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),S.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=f.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i),n={type:"answer",sdp:r=I.default.setVideoBitrates(r,e.videoBitrateOptions)};return S.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",n),t._pc.setRemoteDescription(n)})).then((function(){var n=v.clone(t._rtpParametersByKind[e.kind]);return y.fillRtpParametersForTrack(n,i,r),n})).catch((function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;S.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id);return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),S.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;S.warn("removeProducer() | ignoring expected error due no sending tracks - "+e.name+" "+e.message)})).then((function(){if("stable"!==t._pc.signalingState){var r=f.default.parse(t._pc.localDescription.sdp),n=t._remoteSdp.createAnswerSdp(r),i={type:"answer",sdp:n=I.default.setVideoBitrates(n,e.videoBitrateOptions)};return S.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",i),t._pc.setRemoteDescription(i)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;S.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return s.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),s.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:"updateTrack",value:function(e,t){var r,n=this;S.debug("update Track() [trackId:%s]",t.id);return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),s.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),e.simulcast){S.debug("updateTrack() | enabling simulcast");var i=f.default.parse(r.sdp);y.addSimulcastForTrack(i,t),r={type:"offer",sdp:f.default.write(i)}}return S.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),n._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r),i={type:"answer",sdp:t=I.default.setVideoBitrates(t,e.videoBitrateOptions)};return S.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",i),n._pc.setRemoteDescription(i)})).then((function(){var i=v.clone(n._rtpParametersByKind[e.kind]);return y.fillRtpParametersForTrack(i,r,t),i})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new o.default,n._consumerInfos=new a.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(S.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return s.default.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),s.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._kinds),(0,i.default)(t._consumerInfos.values()))};return S.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===a.trackId}));if(!e)throw new Error("remote track not found");return e.track}))}},{key:"removeConsumer",value:function(e){var t=this;return S.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),s.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._kinds),(0,i.default)(t._consumerInfos.values()))};return S.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):s.default.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._kinds),(0,i.default)(t._consumerInfos.values()))};return S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),s.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){S.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}},{key:"getPCStats",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(w),E=function(){function e(t,r,i){(0,d.default)(this,e),S.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var a=void 0;switch(t){case"send":if(!(a={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var o=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(a.video.codecs);!(o=(u=l.next()).done);o=!0){var p=u.value;"video/H264"===p.mimeType&&"42001f"===p.parameters["profile-level-id"]&&(p.parameters["profile-level-id"]="42e01f")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new T(a,i);case"recv":if(!(a={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var f=!0,m=!1,h=void 0;try{for(var v,g=(0,n.default)(a.video.codecs);!(f=(v=g.next()).done);f=!0){var y=v.value;"video/H264"===y.mimeType&&"42001f"===y.parameters["profile-level-id"]&&(y.parameters["profile-level-id"]="42e01f")}}catch(e){m=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}}return new A(a,i)}}return(0,u.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){S.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=f.default.parse(t.sdp);return g.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Safari11"}}]),e}();t.default=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=w(r(9)),i=w(r(17)),a=w(r(18)),o=w(r(8)),s=w(r(86)),c=w(r(6)),d=w(r(20)),u=w(r(2)),l=w(r(0)),p=w(r(1)),f=w(r(3)),m=w(r(4)),h=w(r(13)),v=w(r(5)),_=w(r(11)),g=S(r(10)),y=S(r(16)),b=S(r(21)),I=S(r(36)),k=w(r(37)),P=w(r(24));function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var T=new v.default("Firefox65"),A=function(e){function t(e,r,n){(0,l.default)(this,t);var i=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,T)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new k.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,m.default)(t,e),(0,p.default)(t,[{key:"close",value:function(){T.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){T.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(_.default),E=function(e){function t(e,r){(0,l.default)(this,t);var n=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._trackIds=new d.default,n._nextRid=1,n}return(0,m.default)(t,e),(0,p.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(T.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._trackIds.has(r.id))return c.default.reject(new Error("track already added"));var n="isac";e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,a=void 0;return this._trackIds.add(r.id),c.default.resolve().then((function(){if(i=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&"inactive"===e.direction})))return T.debug("addProducer() | reusing an inactive transceiver"),i.direction="sendonly",i.sender.replaceTrack(r);i=t._pc.addTransceiver(r,{direction:"sendonly"})})).then((function(){var r=i.sender,n=[];e.simulcast&&(T.debug("addProducer() | enabling simulcast"),e.simulcast.high&&n.push({rid:"high"+t._nextRid,active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&n.push({rid:"medium"+t._nextRid,active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&n.push({rid:"low"+t._nextRid,active:!0,priority:"high",maxBitrate:e.simulcast.low}),t._nextRid++);var a=r.getParameters();return r.setParameters((0,s.default)({},a,{encodings:n}))})).then((function(){return t._pc.createOffer()})).then((function(r){return r.sdp=P.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=P.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=P.default.setSpecialAudioCodec(r.sdp,n),T.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=h.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=P.default.setVideoBitrates(r,e.videoBitrateOptions),r=P.default.setOpusAttributes(r,e.audioProfile);var i={type:"answer",sdp:r=P.default.setSpecialAudioCodec(r,n)};return T.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",i),t._pc.setRemoteDescription(i)})).then((function(){var o=g.clone(t._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+n&&o.codecs.splice(t,1)})),T.debug("addProducer() _rtpParametersByKind: %o - rtpParameters: %o",t._rtpParametersByKind[e.kind],o)),I.fillRtpParametersForTrack(o,a,r,{mid:i.mid}),o})).catch((function(e){try{i.direction="inactive"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return c.default.reject(new Error("track not found"));T.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id);var n="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),c.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=P.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=P.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=P.default.setSpecialAudioCodec(r.sdp,n),T.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){var r=h.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=P.default.setVideoBitrates(i,e.videoBitrateOptions),i=P.default.setOpusAttributes(i,e.audioProfile);var a={type:"answer",sdp:i=P.default.setSpecialAudioCodec(i,n)};return T.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",a),t._pc.setRemoteDescription(a)}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;T.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return c.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:"restartIce",value:function(e){var t=this;return T.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),c.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return T.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=h.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return T.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return T.debug("_setupTransport()"),c.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=h.default.parse(r),i=b.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"updateTrack",value:function(e,t){var r,n,i=this;T.debug("update Track() [trackId:%s]",t.id);var a="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),c.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=P.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=P.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=P.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){T.debug("updateTrack() | enabling simulcast");var o=h.default.parse(r.sdp);I.addPlanBSimulcast(o,t,{mid:n.mid}),r={type:"offer",sdp:h.default.write(o)}}return T.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),i._pc.setLocalDescription(r)})).then((function(){r=h.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r);t=P.default.setVideoBitrates(t,e.videoBitrateOptions),t=P.default.setOpusAttributes(t,e.audioProfile);var n={type:"answer",sdp:t=P.default.setSpecialAudioCodec(t,a)};return T.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",n),i._pc.setRemoteDescription(n)})).then((function(){var o=g.clone(i._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+a&&o.codecs.splice(t,1)})),T.debug("updateTrack() _rtpParametersByKind: %o - rtpParameters: %o",i._rtpParametersByKind[e.kind],o)),I.fillRtpParametersForTrack(o,r,t,{mid:n.mid,planBSimulcast:!0}),o})).catch((function(e){throw e}))}}]),t}(A),R=function(e){function t(e,r){(0,l.default)(this,t);var n=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new o.default,n}return(0,m.default)(t,e),(0,p.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(T.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return c.default.reject(new Error("Consumer already added - consumer.id: "+e.id+" consumer.kind: "+e.kind+" consumer.appData: "+(0,a.default)(e.appData)));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),c.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return T.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return T.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error("remote track not found");return e.receiver.track}))}},{key:"removeConsumer",value:function(e){var t=this;T.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,c.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return T.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return T.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):c.default.reject(new Error("Consumer not found - consumer.id: "+e.id+" consumer.kind: "+e.kind+" consumer.appData: "+(0,a.default)(e.appData)))}},{key:"restartIce",value:function(e){var t=this;return T.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),c.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return T.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return T.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return T.debug("_setupTransport()"),c.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){T.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=h.default.parse(e),r={dtlsParameters:b.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(A),C=function(){function e(t,r,i){(0,l.default)(this,e),T.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var a=void 0;switch(t){case"send":if(!(a={audio:y.getSendingRtpParameters("audio",r),video:y.getSendingRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var o=!0,s=!1,c=void 0;try{for(var d,u=(0,n.default)(a.video.codecs);!(o=(d=u.next()).done);o=!0){var p=d.value;"video/H264"===p.mimeType&&"42001f"===p.parameters["profile-level-id"]&&(p.parameters["profile-level-id"]="42e01f")}}catch(e){s=!0,c=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw c}}}return new E(a,i);case"recv":if(!(a={audio:y.getReceivingFullRtpParameters("audio",r),video:y.getReceivingFullRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var f=!0,m=!1,h=void 0;try{for(var v,_=(0,n.default)(a.video.codecs);!(f=(v=_.next()).done);f=!0){var g=v.value;"video/H264"===g.mimeType&&"42001f"===g.parameters["profile-level-id"]&&(g.parameters["profile-level-id"]="42e01f")}}catch(e){m=!0,h=e}finally{try{!f&&_.return&&_.return()}finally{if(m)throw h}}}return new R(a,i)}}return(0,p.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){T.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var i=h.default.parse(r.sdp);return b.extractRtpCapabilities(i)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:"tag",get:function(){return"Firefox65"}}]),e}();t.default=C},function(e,t,r){r(203),e.exports=r(7).Object.assign},function(e,t,r){var n=r(12);n(n.S+n.F,"Object",{assign:r(204)})},function(e,t,r){"use strict";var n=r(23),i=r(49),a=r(82),o=r(60),s=r(34),c=r(71),d=Object.assign;e.exports=!d||r(32)((function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=d({},e)[r]||Object.keys(d({},t)).join("")!=n}))?function(e,t){for(var r=s(e),d=arguments.length,u=1,l=a.f,p=o.f;d>u;)for(var f,m=c(arguments[u++]),h=l?i(m).concat(l(m)):i(m),v=h.length,_=0;v>_;)f=h[_++],n&&!p.call(m,f)||(r[f]=m[f]);return r}:d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=P(r(9)),i=P(r(17)),a=P(r(8)),o=P(r(86)),s=P(r(6)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(36)),b=P(r(37)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default("Firefox59"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:"close",value:function(){S.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){S.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(S.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return s.default.reject(new Error("track already added"));var n="isac";e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,a=void 0;return s.default.resolve().then((function(){t._stream.addTrack(r),i=t._pc.addTrack(r,t._stream)})).then((function(){var r=[];e.simulcast&&(S.debug("addProducer() | enabling simulcast"),e.simulcast.high&&r.push({rid:"high"+t._nextRid,active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium"+t._nextRid,active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low"+t._nextRid,active:!0,priority:"high",maxBitrate:e.simulcast.low}),t._nextRid++);var n=i.getParameters();return i.setParameters((0,o.default)({},n,{encodings:r}))})).then((function(){return t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=f.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=I.default.setVideoBitrates(r,e.videoBitrateOptions),r=I.default.setOpusAttributes(r,e.audioProfile);var i={type:"answer",sdp:r=I.default.setSpecialAudioCodec(r,n)};return S.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",i),t._pc.setRemoteDescription(i)})).then((function(){var i=v.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+n&&i.codecs.splice(t,1)})),S.debug("addProducer() _rtpParametersByKind: %o - rtpParameters: %o",t._rtpParametersByKind[e.kind],i)),y.fillRtpParametersForTrack(i,a,r),i})).catch((function(e){try{t._pc.removeTrack(i)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;S.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id);var n="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),s.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){var r=f.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=I.default.setVideoBitrates(i,e.videoBitrateOptions),i=I.default.setOpusAttributes(i,e.audioProfile);var a={type:"answer",sdp:i=I.default.setSpecialAudioCodec(i,n)};return S.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",a),t._pc.setRemoteDescription(a)}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;S.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return s.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),s.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"updateTrack",value:function(e,t){var r,n,i=this;S.debug("update Track() [trackId:%s]",t.id);var a="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),s.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){S.debug("updateTrack() | enabling simulcast");var o=f.default.parse(r.sdp);y.addPlanBSimulcast(o,t,{mid:n.mid}),r={type:"offer",sdp:f.default.write(o)}}return S.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),i._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r);t=I.default.setVideoBitrates(t,e.videoBitrateOptions),t=I.default.setOpusAttributes(t,e.audioProfile);var n={type:"answer",sdp:t=I.default.setSpecialAudioCodec(t,a)};return S.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",n),i._pc.setRemoteDescription(n)})).then((function(){var o=v.clone(i._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+a&&o.codecs.splice(t,1)})),S.debug("updateTrack() _rtpParametersByKind: %o - rtpParameters: %o",i._rtpParametersByKind[e.kind],o)),y.fillRtpParametersForTrack(o,r,t,{mid:n.mid,planBSimulcast:!0}),o})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(S.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return s.default.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,a={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),s.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){var t=e.receiver;return!!t&&(!!t.track&&e.mid===a.mid)}));if(!e)throw new Error("remote track not found");return e.receiver.track}))}},{key:"removeConsumer",value:function(e){var t=this;S.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,s.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):s.default.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),s.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){S.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(w),E=function(){function e(t,r,i){(0,d.default)(this,e),S.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var a=void 0;switch(t){case"send":if(!(a={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var o=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(a.video.codecs);!(o=(u=l.next()).done);o=!0){var p=u.value;"video/H264"===p.mimeType&&"42001f"===p.parameters["profile-level-id"]&&(p.parameters["profile-level-id"]="42e01f")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new T(a,i);case"recv":if(!(a={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var f=!0,m=!1,h=void 0;try{for(var v,g=(0,n.default)(a.video.codecs);!(f=(v=g.next()).done);f=!0){var y=v.value;"video/H264"===y.mimeType&&"42001f"===y.parameters["profile-level-id"]&&(y.parameters["profile-level-id"]="42e01f")}}catch(e){m=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}}return new A(a,i)}}return(0,u.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){S.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var i=f.default.parse(r.sdp);return g.extractRtpCapabilities(i)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:"tag",get:function(){return"Firefox59"}}]),e}();t.default=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=P(r(9)),i=P(r(17)),a=P(r(8)),o=P(r(86)),s=P(r(6)),c=P(r(2)),d=P(r(0)),u=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(13)),m=P(r(5)),h=P(r(11)),v=k(r(10)),_=k(r(16)),g=k(r(21)),y=k(r(36)),b=P(r(37)),I=P(r(24));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default("Firefox50"),w=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new b.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,p.default)(t,e),(0,u.default)(t,[{key:"close",value:function(){S.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){S.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(S.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return s.default.reject(new Error("track already added"));var n="isac";e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,a=void 0;return s.default.resolve().then((function(){t._stream.addTrack(r),i=t._pc.addTrack(r,t._stream)})).then((function(){var r=[];e.simulcast&&(S.debug("addProducer() | enabling simulcast"),e.simulcast.high&&r.push({rid:"high"+t._nextRid,active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium"+t._nextRid,active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low"+t._nextRid,active:!0,priority:"high",maxBitrate:e.simulcast.low}),t._nextRid++);var n=i.getParameters();return i.setParameters((0,o.default)({},n,{encodings:r}))})).then((function(){return t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=f.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=I.default.setVideoBitrates(r,e.videoBitrateOptions),r=I.default.setOpusAttributes(r,e.audioProfile);var i={type:"answer",sdp:r=I.default.setSpecialAudioCodec(r,n)};return S.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",i),t._pc.setRemoteDescription(i)})).then((function(){var i=v.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+n&&i.codecs.splice(t,1)})),S.debug("addProducer() _rtpParametersByKind: %o - rtpParameters: %o",t._rtpParametersByKind[e.kind],i)),y.fillRtpParametersForTrack(i,a,r),i})).catch((function(e){try{t._pc.removeTrack(i)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;S.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id);var n="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),s.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,n),S.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).then((function(){var r=f.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=I.default.setVideoBitrates(i,e.videoBitrateOptions),i=I.default.setOpusAttributes(i,e.audioProfile);var a={type:"answer",sdp:i=I.default.setSpecialAudioCodec(i,n)};return S.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",a),t._pc.setRemoteDescription(a)}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;S.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return s.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),s.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),i=g.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"updateTrack",value:function(e,t){var r,n,i=this;S.debug("update Track() [trackId:%s]",t.id);var a="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),s.default.resolve().then((function(){n=i._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return i._pc.createOffer()})).then((function(r){if(r.sdp=I.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=I.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=I.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){S.debug("updateTrack() | enabling simulcast");var o=f.default.parse(r.sdp);y.addPlanBSimulcast(o,t,{mid:n.mid}),r={type:"offer",sdp:f.default.write(o)}}return S.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),i._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(i._pc.localDescription.sdp);var t=i._remoteSdp.createAnswerSdp(r);t=I.default.setVideoBitrates(t,e.videoBitrateOptions),t=I.default.setOpusAttributes(t,e.audioProfile);var n={type:"answer",sdp:t=I.default.setSpecialAudioCodec(t,a)};return S.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",n),i._pc.setRemoteDescription(n)})).then((function(){var o=v.clone(i._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+a&&o.codecs.splice(t,1)})),S.debug("updateTrack() _rtpParametersByKind: %o - rtpParameters: %o",i._rtpParametersByKind[e.kind],o)),y.fillRtpParametersForTrack(o,r,t,{mid:n.mid,planBSimulcast:!0}),o})).catch((function(e){throw e}))}}]),t}(w),A=function(e){function t(e,r){(0,d.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,"recv",e,r));n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default;return n._consumerInfos.set(555,{mid:"fake-dc",kind:"application",closed:!1,cname:null}),n}return(0,p.default)(t,e),(0,u.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(S.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return s.default.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,a={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),s.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===a.trackId}));if(!e)throw new Error("remote track not found");return e.track}))}},{key:"removeConsumer",value:function(e){var t=this;S.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,s.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):s.default.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),s.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,i.default)(t._consumerInfos.values()))};return S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),s.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){S.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(w),E=function(){function e(t,r,i){(0,d.default)(this,e),S.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var a=void 0;switch(t){case"send":if(!(a={audio:_.getSendingRtpParameters("audio",r),video:_.getSendingRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var o=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(a.video.codecs);!(o=(u=l.next()).done);o=!0){var p=u.value;"video/H264"===p.mimeType&&"42001f"===p.parameters["profile-level-id"]&&(p.parameters["profile-level-id"]="42e01f")}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}}return new T(a,i);case"recv":if(!(a={audio:_.getReceivingFullRtpParameters("audio",r),video:_.getReceivingFullRtpParameters("video",r)}).video.codecs.find((function(e){return"42e01f"===e.parameters["profile-level-id"]}))){var f=!0,m=!1,h=void 0;try{for(var v,g=(0,n.default)(a.video.codecs);!(f=(v=g.next()).done);f=!0){var y=v.value;"video/H264"===y.mimeType&&"42001f"===y.parameters["profile-level-id"]&&(y.parameters["profile-level-id"]="42e01f")}}catch(e){m=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}}return new A(a,i)}}return(0,u.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){S.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var i=f.default.parse(r.sdp);return g.extractRtpCapabilities(i)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:"tag",get:function(){return"Firefox50"}}]),e}();t.default=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=_(r(9)),i=_(r(8)),a=_(r(2)),o=_(r(6)),s=_(r(0)),c=_(r(3)),d=_(r(1)),u=_(r(4)),l=_(r(5)),p=_(r(11)),f=v(r(10)),m=v(r(16)),h=v(r(208));function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _(e){return e&&e.__esModule?e:{default:e}}var g="CNAME-EDGE-"+f.randomNumber(),y=new l.default("Edge11"),b=function(e){function t(e,r,n){(0,s.default)(this,t);var o=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this,y));return y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),o._rtpParametersByKind={audio:m.getSendingRtpParameters("audio",r),video:m.getSendingRtpParameters("video",r)},o._transportReady=!1,o._iceGatherer=null,o._iceTransport=null,o._dtlsTransport=null,o._rtpSenders=new i.default,o._rtpReceivers=new i.default,o._transportRemoteParameters=null,o._setIceGatherer(n),o._setIceTransport(),o._setDtlsTransport(),o}return(0,u.default)(t,e),(0,d.default)(t,null,[{key:"getNativeRtpCapabilities",value:function(){return y.debug("getNativeRtpCapabilities()"),o.default.resolve(h.getCapabilities())}},{key:"tag",get:function(){return"Edge11"}}]),(0,d.default)(t,[{key:"close",value:function(){y.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var i,a=(0,n.default)(this._rtpSenders.values());!(e=(i=a.next()).done);e=!0){var o=i.value;try{o.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw r}}var s=!0,c=!1,d=void 0;try{for(var u,l=(0,n.default)(this._rtpReceivers.values());!(s=(u=l.next()).done);s=!0){var p=u.value;try{p.stop()}catch(e){}}}catch(e){c=!0,d=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw d}}}},{key:"remoteClosed",value:function(){y.debug("remoteClosed()"),this._transportReady=!1}},{key:"addProducer",value:function(e){var t=this,r=e.track;return y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?o.default.reject(new Error("Producer already added")):o.default.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){y.debug("addProducer() | calling new RTCRtpSender()");var n=new RTCRtpSender(r,t._dtlsTransport),i=f.clone(t._rtpParametersByKind[e.kind]),a={ssrc:f.randomNumber()};i.codecs.some((function(e){return"rtx"===e.name}))&&(a.rtx={ssrc:f.randomNumber()}),i.encodings.push(a),i.rtcp={cname:g,reducedSize:!0,mux:!0};var o=h.mangleRtpParameters(i);return y.debug("addProducer() | calling rtpSender.send() [params:%o]",o),n.send(o),t._rtpSenders.set(e.id,n),i}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),o.default.resolve().then((function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error("RTCRtpSender not found");t._rtpSenders.delete(e.id);try{y.debug("removeProducer() | calling rtpSender.stop()"),r.stop()}catch(e){y.warn("rtpSender.stop() failed:%o",e)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;return y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),o.default.resolve().then((function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error("RTCRtpSender not found");n.setTrack(t)}))}},{key:"addConsumer",value:function(e){var t=this;return y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._rtpReceivers.has(e.id)?o.default.reject(new Error("Consumer already added")):o.default.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){y.debug("addConsumer() | calling new RTCRtpReceiver()");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener("error",(function(e){y.error('iceGatherer "error" event [event:%o]',e)}));var n=h.mangleRtpParameters(e.rtpParameters);return n.headerExtensions=n.headerExtensions.filter((function(e){return"urn:ietf:params:rtp-hdrext:sdes:mid"!==e.uri})),y.debug("addConsumer() | calling rtpReceiver.receive() [params:%o]",n),r.receive(n),t._rtpReceivers.set(e.id,r),r.track}))}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),o.default.resolve().then((function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error("RTCRtpReceiver not found");t._rtpReceivers.delete(e.id);try{y.debug("removeConsumer() | calling rtpReceiver.stop()"),r.stop()}catch(e){y.warn("rtpReceiver.stop() failed:%o",e)}}))}},{key:"restartIce",value:function(e){var t=this;y.debug("restartIce()"),o.default.resolve().then((function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;y.debug("restartIce() | calling iceTransport.start()"),t._iceTransport.start(t._iceGatherer,e,"controlling");var i=!0,a=!1,o=void 0;try{for(var s,c=(0,n.default)(r);!(i=(s=c.next()).done);i=!0){var d=s.value;t._iceTransport.addRemoteCandidate(d)}}catch(e){a=!0,o=e}finally{try{!i&&c.return&&c.return()}finally{if(a)throw o}}t._iceTransport.addRemoteCandidate({})}))}},{key:"_setIceGatherer",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:e.iceTransportPolicy});t.addEventListener("error",(function(e){y.error('iceGatherer "error" event [event:%o]',e)}));try{t.gather()}catch(e){y.debug("iceGatherer.gather() failed - "+e.name+" "+e.message)}this._iceGatherer=t}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("icestatechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("candidatepairchange",(function(e){y.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener("statechange",(function(){y.debug('dtlsTransport "statechange" event [state:%s]',t.state)})),t.addEventListener("dtlsstatechange",(function(){y.debug('dtlsTransport "dtlsstatechange" event [state:%s]',t.state),"closed"===t.state&&e.emit("@connectionstatechange","closed")})),t.addEventListener("error",(function(e){y.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=t}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),o.default.resolve().then((function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role="server",t.dtlsParameters=r,e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._transportRemoteParameters=t;var r=t.iceParameters,i=t.iceCandidates,a=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,"controlling");var o=!0,s=!1,c=void 0;try{for(var d,u=(0,n.default)(i);!(o=(d=u.next()).done);o=!0){var l=d.value;e._iceTransport.addRemoteCandidate(l)}}catch(e){s=!0,c=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw c}}e._iceTransport.addRemoteCandidate({}),a.fingerprints=a.fingerprints.filter((function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm})),e._dtlsTransport.start(a),e._transportReady=!0}))}}]),t}(p.default);t.default=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(9),a=(n=i)&&n.__esModule?n:{default:n};t.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=o.clone(e),r=!0,n=!1,i=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(r=(s=c.next()).done);r=!0){var d=s.value;if(d.channels=d.numChannels,delete d.numChannels,"audio"!==d.kind?delete d.channels:d.channels||(d.channels=1),d.mimeType=d.kind+"/"+d.name,d.parameters){var u=d.parameters;u.apt&&(u.apt=Number(u.apt)),u["packetization-mode"]&&(u["packetization-mode"]=Number(u["packetization-mode"]))}var l=!0,p=!1,f=void 0;try{for(var m,h=(0,a.default)(d.rtcpFeedback||[]);!(l=(m=h.next()).done);l=!0){var v=m.value;v.parameter||delete v.parameter}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}}}catch(e){n=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw i}}return t},t.mangleRtpParameters=function(e){var t=o.clone(e),r=!0,n=!1,i=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(r=(s=c.next()).done);r=!0){var d=s.value;d.channels&&(d.numChannels=d.channels,delete d.channels),delete d.mimeType}}catch(e){n=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw i}}return t};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=k(r(17)),i=k(r(8)),a=k(r(6)),o=k(r(20)),s=k(r(2)),c=k(r(0)),d=k(r(1)),u=k(r(3)),l=k(r(4)),p=k(r(13)),f=k(r(5)),m=k(r(11)),h=I(r(10)),v=I(r(16)),_=I(r(21)),g=I(r(44)),y=k(r(45)),b=k(r(24));function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function k(e){return e&&e.__esModule?e:{default:e}}var P=new f.default("ReactNative"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P)),a={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};return n.enableTurn&&(a.iceServers=n.turnServers||[],a.iceTransportPolicy=n.iceTransportPolicy),i._pc=new RTCPeerConnection(a),i._rtpParametersByKind=r,i._remoteSdp=new y.default(e,r),i._pc.addEventListener("iceconnectionstatechange",(function(){switch(i._pc.iceConnectionState){case"checking":i.emit("@connectionstatechange","connecting");break;case"connected":case"completed":i.emit("@connectionstatechange","connected");break;case"failed":i.emit("@connectionstatechange","failed");break;case"disconnected":i.emit("@connectionstatechange","disconnected");break;case"closed":i.emit("@connectionstatechange","closed")}})),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){P.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),w=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"send",e,r));return n._transportReady=!1,n._tracks=new o.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._tracks.has(r))return a.default.reject(new Error("track already added"));if(!r.streamReactTag)return a.default.reject(new Error("no track.streamReactTag property"));var n="isac";e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var i=void 0,o=void 0;return a.default.resolve().then((function(){return t._tracks.add(r),(i=new MediaStream(r.streamReactTag)).addTrack(r),t._pc.addStream(i),t._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug("addProducer() | enabling simulcast");var a=p.default.parse(i.sdp);g.addSimulcastForTrack(a,r),i={type:"offer",sdp:p.default.write(a)}}P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",i);var o=new RTCSessionDescription(i);return t._pc.setLocalDescription(o)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){o=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(o);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var i={type:"answer",sdp:r=b.default.setSpecialAudioCodec(r,n)};P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",i);var a=new RTCSessionDescription(i);return t._pc.setRemoteDescription(a)})).then((function(){var i=h.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+n&&i.codecs.splice(t,1)})),P.debug("addProducer() _rtpParametersByKind: %o - rtpParameters: %o",t._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,o,r),i})).catch((function(e){throw t._tracks.delete(r),i.removeTrack(r),t._pc.removeStream(i),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;if(P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),!r.streamReactTag)return a.default.reject(new Error("no track.streamReactTag property"));var n="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),a.default.resolve().then((function(){t._tracks.delete(r);var e=new MediaStream(r.streamReactTag);return e.addTrack(r),t._pc.removeStream(e),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._tracks.size)throw e;P.warn("removeProducer() | ignoring expected error due no sending tracks - "+e.name+" "+e.message)})).then((function(){if("stable"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),i=t._remoteSdp.createAnswerSdp(r);i=b.default.setVideoBitrates(i,e.videoBitrateOptions),i=b.default.setOpusAttributes(i,e.audioProfile);var a={type:"answer",sdp:i=b.default.setSpecialAudioCodec(i,n)};P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",a);var o=new RTCSessionDescription(a);return t._pc.setRemoteDescription(o)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;if(P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),!t.streamReactTag)return a.default.reject(new Error("no track.streamReactTag property"));var n=e.track,i=void 0,o=void 0,s="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(s=e.audioProfile.codec.toLowerCase()),a.default.resolve().then((function(){return r._tracks.add(t),r._tracks.delete(n),(i=new MediaStream(t.streamReactTag)).addTrack(t),i.removeTrack(n),r._pc.addStream(i),r._pc.createOffer()})).then((function(n){if(n.sdp=b.default.setVideoBitrates(n.sdp,e.videoBitrateOptions),n.sdp=b.default.setOpusAttributes(n.sdp,e.audioProfile),n.sdp=b.default.setSpecialAudioCodec(n.sdp,s),e.simulcast){P.debug("addProducer() | enabling simulcast");var i=p.default.parse(n.sdp);g.addSimulcastForTrack(i,t),n={type:"offer",sdp:p.default.write(i)}}P.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",n);var a=new RTCSessionDescription(n);return r._pc.setLocalDescription(a)})).then((function(){o=p.default.parse(r._pc.localDescription.sdp);var t=r._remoteSdp.createAnswerSdp(o);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var n={type:"answer",sdp:t=b.default.setSpecialAudioCodec(t,s)};P.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",n);var i=new RTCSessionDescription(n);return r._pc.setRemoteDescription(i)})).then((function(){var n=h.clone(r._rtpParametersByKind[e.kind]);n&&n.codecs&&(n.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+s&&n.codecs.splice(t,1)})),P.debug("replaceProducerTrack() _rtpParametersByKind: %o - rtpParameters: %o",r._rtpParametersByKind[e.kind],n)),g.fillRtpParametersForTrack(n,o,t),r.safeEmit("@needupdateproducer",e,n)})).catch((function(e){throw r._tracks.delete(t),i.removeTrack(t),r._pc.addStream(i),e}))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}))}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),i=_.extractDtlsParameters(n);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:"updateTrack",value:function(e,t){var r,n=this;P.debug("update Track() [trackId:%s]",t.id);var i="isac";return e.audioProfile&&e.audioProfile.codec&&""!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),a.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug("updateTrack() | enabling simulcast");var a=p.default.parse(r.sdp);g.addSimulcastForTrack(a,t),r={type:"offer",sdp:p.default.write(a)}}return P.debug("updateTrack() | calling pc.setLocalDescription() [offer:%o]",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var a={type:"answer",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug("updateTrack() | calling pc.setRemoteDescription() [answer:%o]",a),n._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(n._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf("audio")&&e.mimeType.toLowerCase()!=="audio/"+i&&a.codecs.splice(t,1)})),P.debug("updateTrack() _rtpParametersByKind: %o - rtpParameters: %o",n._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,r,t),a})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new o.default,n._consumerInfos=new i.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],i=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:i};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===o.streamId})),r=e.getTrackById(o.trackId);if(r.streamReactTag=e.reactTag,!r)throw new Error("remote track not found");return r}))}},{key:"removeConsumer",value:function(e){var t=this;return P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),a.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),a.default.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(S),A=function(){function e(t,r,n){(0,c.default)(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var i=void 0;switch(t){case"send":return i={audio:v.getSendingRtpParameters("audio",r),video:v.getSendingRtpParameters("video",r)},new w(i,n);case"recv":return i={audio:v.getReceivingFullRtpParameters("audio",r),video:v.getReceivingFullRtpParameters("video",r)},new T(i,n)}}return(0,d.default)(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"ReactNative"}}]),e}();t.default=A},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=P(r(17)),i=P(r(63)),a=P(r(26)),o=P(r(9)),s=P(r(6)),c=P(r(8)),d=P(r(2)),u=P(r(0)),l=P(r(1)),p=P(r(3)),f=P(r(4)),m=P(r(5)),h=P(r(11)),v=r(53),_=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(16)),g=P(r(85)),y=P(r(211)),b=P(r(213)),I=P(r(214)),k=P(r(215));function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default("<Room>"),w="new",T="joining",A="joined",E="closed",R=function(e){function t(e){(0,u.default)(this,t);var r=(0,p.default)(this,(t.__proto__||(0,d.default)(t)).call(this,S));if(S.debug("constructor() [options:%o]",e),!g.default.isSupported())throw new Error("current browser/device not supported");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||3e4,transportOptions:e.transportOptions||{},enableTurn:e.enableTurn,h264ProfileLevelId:e.h264ProfileLevelId,turnServers:e.turnServers||[],iceTransportPolicy:e.iceTransportPolicy||"all",spy:Boolean(e.spy)},r._state=w,r._peerName=null,r._transports=new c.default,r._producers=new c.default,r._peers=new c.default,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}return(0,f.default)(t,e),(0,l.default)(t,[{key:"getTransportById",value:function(e){return this._transports.get(e)}},{key:"getProducerById",value:function(e){return this._producers.get(e)}},{key:"getPeerByName",value:function(e){return this._peers.get(e)}},{key:"join",value:function(e,t){var r=this;if("string"!=typeof e)return s.default.reject(new TypeError("Room.join - invalid peerName"));if(S.debug('join() [peerName:"%s"]',e),this._state!==w&&this._state!==E)return s.default.reject(new v.InvalidStateError('Room.join - invalid state "'+this._state+'"'));this._peerName=e,this._state=T;var n=void 0;return s.default.resolve().then((function(){return r._settings.roomSettings?void(n=r._settings.roomSettings):r._sendRequest("queryRoom",{target:"room"}).then((function(e){n=e,S.debug("join() | got Room settings:%o",n)}))})).then((function(){return g.default.Handler.getNativeRtpCapabilities()})).then((function(e){S.debug("join() | native RTP capabilities:%o",e),r._extendedRtpCapabilities=_.getExtendedRtpCapabilities(e,n.rtpCapabilities),S.debug("join() | extended RTP capabilities:%o",r._extendedRtpCapabilities);var i=_.getUnsupportedCodecs(n.rtpCapabilities,n.mandatoryCodecPayloadTypes,r._extendedRtpCapabilities);if(i.length>0)throw S.error("%s mandatory room codecs not supported:%o",i.length,i),new v.UnsupportedError("mandatory room codecs not supported",i);r._canSendByKind.audio=_.canSend("audio",r._extendedRtpCapabilities),r._canSendByKind.video=_.canSend("video",r._extendedRtpCapabilities);var a=_.getRtpCapabilities(r._extendedRtpCapabilities);S.debug("join() | effective local RTP capabilities for receiving:%o",a);var o={target:"room",peerName:r._peerName,rtpCapabilities:a,spy:r._settings.spy,appData:t};return r._sendRequest("join",o).then((function(e){return e.peers}))})).then((function(e){var t=!0,n=!1,i=void 0;try{for(var a,s=(0,o.default)(e||[]);!(t=(a=s.next()).done);t=!0){var c=a.value;try{r._handlePeerData(c)}catch(e){S.error("join() | error handling Peer:%o",e)}}}catch(e){n=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw i}}return r._state=A,S.debug("join() | joined the Room"),r.peers})).catch((function(e){throw r._state=w,e}))}},{key:"leave",value:function(e){if(S.debug("leave()"),!this.closed){this._sendNotification("leave",{appData:e}),this._state=E,this.safeEmit("close","local",e);var t=!0,r=!1,n=void 0;try{for(var i,a=(0,o.default)(this._transports.values());!(t=(i=a.next()).done);t=!0){i.value.close()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var s=!0,c=!1,d=void 0;try{for(var u,l=(0,o.default)(this._producers.values());!(s=(u=l.next()).done);s=!0){u.value.close()}}catch(e){c=!0,d=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw d}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,o.default)(this._peers.values());!(p=(h=v.next()).done);p=!0){h.value.close()}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}}}},{key:"remoteClose",value:function(e){if(S.debug("remoteClose()"),!this.closed){this._state=E,this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var i,a=(0,o.default)(this._transports.values());!(t=(i=a.next()).done);t=!0){i.value.remoteClose(null,{destroy:!0})}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var s=!0,c=!1,d=void 0;try{for(var u,l=(0,o.default)(this._producers.values());!(s=(u=l.next()).done);s=!0){u.value.remoteClose()}}catch(e){c=!0,d=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw d}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,o.default)(this._peers.values());!(p=(h=v.next()).done);p=!0){h.value.remoteClose()}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}}}},{key:"canSend",value:function(e){if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'+e+'"');return!(!this.joined||this._settings.spy)&&this._canSendByKind[e]}},{key:"createTransport",value:function(e,t){var r=this;if(S.debug("createTransport() [direction:%s]",e),!this.joined)throw new v.InvalidStateError('invalid state "'+this._state+'"');if("send"!==e&&"recv"!==e)throw new TypeError('invalid direction "'+e+'"');if("send"===e&&this._settings.spy)throw new TypeError("a spy peer cannot send media to the room");var n=new y.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on("@request",(function(e,t,n,i){r._sendRequest(e,t).then(n).catch(i)})),n.on("@notify",(function(e,t){r._sendNotification(e,t)})),n.on("@close",(function(){r._transports.delete(n.id)})),n}},{key:"createProducer",value:function(e,t,r){var n=this;if(S.debug("createProducer() [track:%o, options:%o]",e,t),!this.joined)throw new v.InvalidStateError('invalid state "'+this._state+'"');if(this._settings.spy)throw new Error("a spy peer cannot send media to the room");if(!e)throw new TypeError("no track given");if(!this._canSendByKind[e.kind])throw new Error("cannot send "+e.kind);if("ended"===e.readyState)throw new Error('track.readyState is "ended"');t=t||{};var i=new b.default(e,t,r);return this._producers.set(i.id,i),i.on("@close",(function(){n._producers.delete(i.id)})),i}},{key:"restartIce",value:function(e,t){if(this.joined){var r=!0,n=!1,i=void 0;try{for(var a,s=(0,o.default)(this._transports.values());!(r=(a=s.next()).done);r=!0){a.value.restartIce(e,t)}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}}else S.warn('restartIce() | invalid state "'+this._state+'"')}},{key:"receiveNotification",value:function(e){var t=this;if(this.closed)return s.default.reject(new v.InvalidStateError("Room closed"));if("object"!==(void 0===e?"undefined":(0,a.default)(e)))return s.default.reject(new TypeError("wrong notification Object"));if(!0!==e.notification)return s.default.reject(new TypeError("not a notification"));if("string"!=typeof e.method)return s.default.reject(new TypeError("wrong/missing notification method"));var r=e.method;return"producerStats"!==r&&"consumerStats"!==r&&S.debug("receiveNotification() [method:%s, notification:%o]",r,e),s.default.resolve().then((function(){switch(r){case"closed":var n=e.appData;t.remoteClose(n);break;case"transportClosed":var i=e.id,a=e.appData,o=t._transports.get(i);if(!o)throw new Error('Transport not found [id:"'+i+'"]');o.remoteClose(a,{destroy:!1});break;case"transportStats":var s=e.id,c=e.stats,d=t._transports.get(s);if(!d)throw new Error("Transport not found [id:"+s+"]");d.remoteStats(c);break;case"newPeer":var u=e.name;if(t._peers.has(u))throw new Error('Peer already exists [name:"'+u+'"]');var l=e;t._handlePeerData(l);break;case"peerClosed":var p=e.name,f=e.appData,m=t._peers.get(p);if(!m)throw new Error('no Peer found [name:"'+p+'"]');m.remoteClose(f);break;case"producerPaused":var h=e.id,v=e.appData,_=t._producers.get(h);if(!_)throw new Error("Producer not found [id:"+h+"]");_.remotePause(v);break;case"producerResumed":var g=e.id,y=e.appData,b=t._producers.get(g);if(!b)throw new Error("Producer not found [id:"+g+"]");b.remoteResume(y);break;case"producerClosed":var I=e.id,k=e.appData,P=t._producers.get(I);if(!P)throw new Error("Producer not found [id:"+I+"]");P.remoteClose(k);break;case"producerStats":var S=e.id,w=e.stats,T=t._producers.get(S);if(!T)throw new Error("Producer not found [id:"+S+"]");T.remoteStats(w);break;case"newConsumer":var A=e.peerName,E=t._peers.get(A);if(!E)throw new Error('no Peer found [name:"'+A+'"]');var R=e;t._handleConsumerData(R,E);break;case"consumerClosed":var C=e.id,O=e.peerName,x=e.appData,D=t._peers.get(O);if(!D)throw new Error('no Peer found [name:"'+O+'"]');var N=D.getConsumerById(C);if(!N)throw new Error("Consumer not found [id:"+C+"]");N.remoteClose(x);break;case"consumerPaused":var L=e.id,M=e.peerName,B=e.appData,V=t._peers.get(M);if(!V)throw new Error('no Peer found [name:"'+M+'"]');var j=V.getConsumerById(L);if(!j)throw new Error("Consumer not found [id:"+L+"]");j.remotePause(B);break;case"consumerResumed":var F=e.id,U=e.peerName,H=e.appData,G=t._peers.get(U);if(!G)throw new Error('no Peer found [name:"'+U+'"]');var K=G.getConsumerById(F);if(!K)throw new Error("Consumer not found [id:"+F+"]");K.remoteResume(H);break;case"consumerPreferredProfileSet":var W=e.id,z=e.peerName,q=e.profile,X=t._peers.get(z);if(!X)throw new Error('no Peer found [name:"'+z+'"]');var J=X.getConsumerById(W);if(!J)throw new Error("Consumer not found [id:"+W+"]");J.remoteSetPreferredProfile(q);break;case"consumerEffectiveProfileChanged":var Y=e.id,Q=e.peerName,$=e.profile,Z=t._peers.get(Q);if(!Z)throw new Error('no Peer found [name:"'+Q+'"]');var ee=Z.getConsumerById(Y);if(!ee)throw new Error("Consumer not found [id:"+Y+"]");ee.remoteEffectiveProfileChanged($);break;case"consumerStats":var te=e.id,re=e.peerName,ne=e.stats,ie=t._peers.get(re);if(!ie)throw new Error('no Peer found [name:"'+re+'"]');var ae=ie.getConsumerById(te);if(!ae)throw new Error("Consumer not found [id:"+te+"]");ae.remoteStats(ne);break;default:throw new Error('unknown notification method "'+r+'"')}})).catch((function(t){S.error("receiveNotification() failed [notification:%o]: %s",e,t)}))}},{key:"_sendRequest",value:function(e,t){var r=this,n=(0,i.default)({method:e,target:"peer"},t);return this.closed?(S.error("_sendRequest() | Room closed [method:%s, request:%o]",e,n),s.default.reject(new v.InvalidStateError("Room closed"))):(S.debug("_sendRequest() [method:%s, request:%o]",e,n),new s.default((function(t,i){var a=!1,o=setTimeout((function(){S.error("request failed [method:%s]: timeout",e),a=!0,i(new v.TimeoutError("timeout"))}),r._settings.requestTimeout);r.safeEmit("request",n,(function(n){if(!a){if(a=!0,clearTimeout(o),r.closed)return S.error("request failed [method:%s]: Room closed",e),void i(new Error("Room closed"));S.debug("request succeeded [method:%s, response:%o]",e,n),t(n)}}),(function(t){if(!a){if(a=!0,clearTimeout(o),r.closed)return S.error("request failed [method:%s]: Room closed",e),void i(new Error("Room closed"));t instanceof Error||(t=new Error(String(t))),S.error("request failed [method:%s]:%o",e,t),i(t)}}))})))}},{key:"_sendNotification",value:function(e,t){if(!this.closed){var r=(0,i.default)({method:e,target:"peer",notification:!0},t);S.debug("_sendNotification() [method:%s, notification:%o]",e,r),this.safeEmit("notify",r)}}},{key:"_handlePeerData",value:function(e){var t=this,r=e.name,n=e.consumers,i=e.appData,a=this._peers.get(r);a?a.appData=i:a=new I.default(r,i),this._peers.set(a.name,a),a.on("@close",(function(){t._peers.delete(a.name)}));var s=!0,c=!1,d=void 0;try{for(var u,l=(0,o.default)(n);!(s=(u=l.next()).done);s=!0){var p=u.value;try{this._handleConsumerData(p,a)}catch(e){S.error("error handling existing Consumer in Peer:%o",e)}}}catch(e){c=!0,d=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw d}}this.joined&&this.safeEmit("newpeer",a)}},{key:"_handleConsumerData",value:function(e,t){var r=e.id,n=e.kind,i=e.rtpParameters,a=e.paused,o=e.appData,s=new k.default(r,n,i,t,o);_.canReceive(s.rtpParameters,this._extendedRtpCapabilities)&&s.setSupported(!0),a&&s.remotePause(),t.addConsumer(s)}},{key:"joined",get:function(){return this._state===A}},{key:"closed",get:function(){return this._state===E}},{key:"peerName",get:function(){return this._peerName}},{key:"transports",get:function(){return(0,n.default)(this._transports.values())}},{key:"producers",get:function(){return(0,n.default)(this._producers.values())}},{key:"peers",get:function(){return(0,n.default)(this._peers.values())}}]),t}(h.default);t.default=R},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=g(r(61)),i=g(r(9)),a=g(r(6)),o=g(r(8)),s=g(r(2)),c=g(r(0)),d=g(r(1)),u=g(r(3)),l=g(r(4)),p=g(r(5)),f=g(r(11)),m=r(53),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10)),v=g(r(85)),_=g(r(212));function g(e){return e&&e.__esModule?e:{default:e}}var y=new p.default("<Transport>"),b=function(e){function t(e,r,n,i){(0,c.default)(this,t);var a=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,y));return y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),a._id=h.randomNumber(),a._closed=!1,a._direction=e,a._settings=n,a._appData=i,a._statsEnabled=!1,a._commandQueue=new _.default,a._handler=new v.default.Handler(e,r,n),a._retryTimeTotal=0,a._retryTime=0,a._iceRestartInterval=null,a._connectionState="new",a._producers=new o.default,a._commandQueue.on("exec",a._execCommand.bind(a)),a._handleHandler(),a}return(0,l.default)(t,e),(0,d.default)(t,[{key:"close",value:function(e){y.debug("close()"),this._closed||(this._retryTime=0,this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit("@notify","closeTransport",{id:this._id,appData:e}),this.emit("@close"),this.safeEmit("close","local",e),this._destroy())}},{key:"remoteClose",value:function(e,t){var r=t.destroy;y.debug("remoteClose() [destroy:%s]",r),this._closed||(r?(this._retryTime=0,this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e),this._destroy()):this._handler.remoteClosed())}},{key:"_destroy",value:function(){this._closeRestartIce(),this._commandQueue.close(),this._handler.close()}},{key:"_closeRestartIce",value:function(){this._iceRestartInterval&&clearInterval(this._iceRestartInterval),this._iceRestartInterval=null}},{key:"attemptRestartIce",value:function(){var e=this;"connected"!==this.connectionState&&(this.closed||(this._closeRestartIce(),this._retryTime=0,this._iceRestartInterval=setInterval((function(){return Boolean(e.closed)||"connected"===e.connectionState?(e._closeRestartIce(),void y.debug("attemptRestartIce() - id: "+e.id+" [FIN-END] _retryTime: "+e._retryTime+" closed: "+e.closed+" connectionState: "+e.connectionState)):(e._retryTimeTotal++,++e._retryTime>=15?(e._closeRestartIce(),y.debug("attemptRestartIce() - id: "+e.id+" [FIN-END] _retryTime: "+e._retryTime+" closed: "+e.closed+" connectionState: "+e.connectionState),void e.safeEmit("restart-ice-fail",{retryTime:e._retryTime})):(y.debug("attemptRestartIce() - retrying ... id: "+e.id+" _retryTime: "+e._retryTime),void e.restartIce(null,(function(t){y.warn("attemptRestartIce() fail - id: "+e.id+" error - "+t.name+" "+t.message)}))))}),3e3)))}},{key:"restartIce",value:function(e,t){var r=this;y.debug("restartIce()"),this._closed||"new"!==this._connectionState&&a.default.resolve().then((function(){r.safeEmit("restart-ice-trying",{retryTime:r._retryTime,error:""});var e={id:r._id};return r.safeEmitAsPromise("@request","restartTransport",e)})).then((function(e){var t=e.iceParameters;return r._commandQueue.push("restartIce",{remoteIceParameters:t})})).catch((function(e){t&&t(e),r.safeEmit("restart-ice-trying",{retryTime:r._retryTime,error:e.name+" "+e.message}),y.warn("restartIce() | fail - "+e.name+" "+e.message)}))}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;y.debug("enableStats() [interval:%s]",e),("number"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit("@notify","enableTransportStats",t)}},{key:"disableStats",value:function(){y.debug("disableStats()"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit("@notify","disableTransportStats",e)}},{key:"_handleHandler",value:function(){var e=this,t=this._handler;t.on("@icegatheringstatechange",(function(t){e._closed||e.safeEmit("icegatheringstatechange",t)})),t.on("@icecandidate",(function(t){e._closed||e.safeEmit("icecandidate",t)})),t.on("@icecandidateerror",(function(t){e._closed||e.safeEmit("icecandidateerror",t)})),t.on("@connectionstatechange",(function(t){"connected"===t&&(e._retryTime=0),e._connectionState!==t&&(y.debug("Transport connection state changed to ["+t+"]"),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))})),t.on("@needcreatetransport",(function(t,r,n){var i={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(t.dtlsParameters?i.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(i.plainRtpParameters=t.plainRtpParameters)),e.safeEmit("@request","createTransport",i,r,n)})),t.on("@needupdatetransport",(function(t){var r={id:e._id};t&&(t.dtlsParameters?r.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(r.plainRtpParameters=t.plainRtpParameters)),e.safeEmit("@notify","updateTransport",r)})),t.on("@needupdateproducer",(function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit("@notify","updateProducer",n)}))}},{key:"addProducer",value:function(e){return y.debug("addProducer() [producer:%o]",e),this._closed?a.default.reject(new m.InvalidStateError("Transport closed")):"send"!==this._direction?a.default.reject(new Error("not a sending Transport")):(this._producers.set(e.id,e),this._commandQueue.push("addProducer",{producer:e}))}},{key:"removeProducer",value:function(e,t,r){y.debug("removeProducer() [producer:%o]",e),this._producers.delete(e.id),this._closed||this._commandQueue.push("removeProducer",{producer:e}).catch((function(t){y.warn("removeProducer() [producer: "+e.id+"] fail - "+t.name+" "+t.message)})),"local"===t&&this.safeEmit("@notify","closeProducer",{id:e.id,appData:r})}},{key:"pauseProducer",value:function(e,t){y.debug("pauseProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseProducer",r)}},{key:"resumeProducer",value:function(e,t){y.debug("resumeProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeProducer",r)}},{key:"replaceProducerTrack",value:function(e,t){return y.debug("replaceProducerTrack() [producer:%o]",e),this._commandQueue.push("replaceProducerTrack",{producer:e,track:t})}},{key:"enableProducerStats",value:function(e,t){y.debug("enableProducerStats() [producer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableProducerStats",r)}},{key:"disableProducerStats",value:function(e){y.debug("disableProducerStats() [producer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableProducerStats",t)}},{key:"addConsumer",value:function(e){return y.debug("addConsumer() [consumer:%o]",e),this._closed?a.default.reject(new m.InvalidStateError("Transport closed")):"recv"!==this._direction?a.default.reject(new Error("not a receiving Transport")):this._commandQueue.push("addConsumer",{consumer:e})}},{key:"removeConsumer",value:function(e){y.debug("removeConsumer() [consumer:%o]",e),this._commandQueue.push("removeConsumer",{consumer:e}).catch((function(t){y.warn("removeConsumer() [consumer: "+e.id+"] fail - "+t.name+" "+t.message)}))}},{key:"pauseConsumer",value:function(e,t){y.debug("pauseConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseConsumer",r)}},{key:"resumeConsumer",value:function(e,t){y.debug("resumeConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeConsumer",r)}},{key:"setConsumerPreferredProfile",value:function(e,t){y.debug("setConsumerPreferredProfile() [consumer:%o]",e);var r={id:e.id,profile:t};this.safeEmit("@notify","setConsumerPreferredProfile",r)}},{key:"enableConsumerStats",value:function(e,t){y.debug("enableConsumerStats() [consumer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableConsumerStats",r)}},{key:"disableConsumerStats",value:function(e){y.debug("disableConsumerStats() [consumer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableConsumerStats",t)}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"getStats",value:function(e){return this._handler.getPCStats(e)}},{key:"removeTrack",value:function(e){return this._handler.removeTrack(e)}},{key:"updateTrack",value:function(e,t){return this._handler.updateTrack(e,t)}},{key:"_execCommand",value:function(e,t){var r=void 0;try{switch(e.method){case"addProducer":var n=e.producer;r=this._execAddProducer(n);break;case"removeProducer":var i=e.producer;r=this._execRemoveProducer(i);break;case"replaceProducerTrack":var o=e.producer,s=e.track;r=this._execReplaceProducerTrack(o,s);break;case"addConsumer":var c=e.consumer;r=this._execAddConsumer(c);break;case"removeConsumer":var d=e.consumer;r=this._execRemoveConsumer(d);break;case"restartIce":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=a.default.reject(new Error('unknown command method "'+e.method+'"'))}}catch(e){r=a.default.reject(e)}t.promise=r}},{key:"_execAddProducer",value:function(e){var t=this;y.debug("_execAddProducer()");var r=void 0;return a.default.resolve().then((function(){return t._handler.addProducer(e)})).then((function(n){r=n;var i={id:e.id,kind:e.kind,transportId:t._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return t.safeEmitAsPromise("@request","createProducer",i)})).then((function(){e.setRtpParameters(r)}))}},{key:"_execRemoveProducer",value:function(e){return y.debug("_execRemoveProducer()"),this._handler.removeProducer(e)}},{key:"_execReplaceProducerTrack",value:function(e,t){return y.debug("_execReplaceProducerTrack()"),this._handler.replaceProducerTrack(e,t)}},{key:"_execAddConsumer",value:function(e){var t=this;y.debug("_execAddConsumer()");var r=void 0;return a.default.resolve().then((function(){return t._handler.addConsumer(e)})).then((function(n){r=n;var i={id:e.id,transportId:t.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return t.safeEmitAsPromise("@request","enableConsumer",i)})).then((function(t){var n=t.paused,i=t.preferredProfile,a=t.effectiveProfile;return n&&e.remotePause(),i&&e.remoteSetPreferredProfile(i),a&&e.remoteEffectiveProfileChanged(a),r}))}},{key:"_execRemoveConsumer",value:function(e){return y.debug("_execRemoveConsumer()"),this._handler.removeConsumer(e)}},{key:"_execRestartIce",value:function(e){return y.debug("_execRestartIce()"),this._handler.restartIce(e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"appData",get:function(){return this._appData}},{key:"connectionState",get:function(){return this._connectionState}},{key:"retryTimeTotal",get:function(){return this._retryTimeTotal}},{key:"handler",get:function(){return this._handler}},{key:"hasAudioProducer",get:function(){if(!this._producers)return!1;var e=!0,t=!1,r=void 0;try{for(var a,o=(0,i.default)(this._producers);!(e=(a=o.next()).done);e=!0){var s=(0,n.default)(a.value,2);s[0];if("audio"===s[1].kind)return!0}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}return!1}},{key:"hasVideoProducer",get:function(){if(!this._producers)return!1;var e=!0,t=!1,r=void 0;try{for(var a,o=(0,i.default)(this._producers);!(e=(a=o.next()).done);e=!0){var s=(0,n.default)(a.value,2);s[0];if("video"===s[1].kind)return!0}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}return!1}}]),t}(f.default);t.default=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(6)),i=f(r(63)),a=f(r(2)),o=f(r(0)),s=f(r(1)),c=f(r(3)),d=f(r(4)),u=r(29),l=f(r(5)),p=r(53);function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default("<CommandQueue>"),h=function(e){function t(){(0,o.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return e.setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}return(0,d.default)(t,e),(0,s.default)(t,[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var r=this,a=(0,i.default)({method:e},t);return m.debug("push() [method:%s]",e),new n.default((function(e,t){var n=r._queue;a.resolve=e,a.reject=t,n.push(a),r._handlePendingCommands()}))}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then((function(){e._busy=!1,t.shift(),e._handlePendingCommands()})))}}},{key:"_handleCommand",value:function(e){var t=this;if(m.debug("_handleCommand() [method:%s]",e.method),this._closed)return e.reject(new p.InvalidStateError("closed")),n.default.resolve();var r={promise:null};return this.emit("exec",e,r),n.default.resolve().then((function(){return r.promise})).then((function(r){m.debug("_handleCommand() | command succeeded [method:%s]",e.method),t._closed?e.reject(new p.InvalidStateError("closed")):e.resolve(r)})).catch((function(t){m.warn("_handleCommand() | command failed [method:%s]: %o",e.method,t),e.reject(t)}))}}]),t}(u.EventEmitter);t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=v(r(18)),i=v(r(6)),a=v(r(63)),o=v(r(26)),s=v(r(2)),c=v(r(0)),d=v(r(1)),u=v(r(3)),l=v(r(4)),p=v(r(5)),f=v(r(11)),m=r(53),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10));function v(e){return e&&e.__esModule?e:{default:e}}var _={low:1e5,medium:3e5,high:15e5},g=new p.default("<Producer>"),y=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,g));i._id=h.randomNumber(),i._closed=!1,i._originalTrack=e;try{i._track=e.clone()}catch(t){i._track=e}return i._appData=n,i._simulcast=!1,"object"===(0,o.default)(r.simulcast)?i._simulcast=(0,a.default)({},_,r.simulcast):!0===r.simulcast&&(i._simulcast=(0,a.default)({},_)),i._audioProfile=null,"object"==(0,o.default)(r.audioProfile)&&(i._audioProfile=r.audioProfile),i._videoBitrateOptions=null,"object"===(0,o.default)(r.codecOptions)&&(i._videoBitrateOptions=r.codecOptions),i._transport=null,i._rtpParameters=null,i._locallyPaused=!i._track.enabled,i._remotelyPaused=!1,i._statsEnabled=!1,i._statsInterval=1e3,i._handleTrack(),i}return(0,l.default)(t,e),(0,d.default)(t,[{key:"close",value:function(e){g.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,"local",e),this._destroy(),this.emit("@close","local",e),this.safeEmit("close","local",e))}},{key:"remoteClose",value:function(e){g.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,"remote",e),this._destroy(),this.emit("@close","remote",e),this.safeEmit("close","remote",e))}},{key:"_destroy",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:"send",value:function(e){var t=this;return g.debug("send() [transport:%o]",e),this._closed?i.default.reject(new m.InvalidStateError("Producer closed")):this._transport?i.default.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":(0,o.default)(e))?i.default.reject(new TypeError("invalid Transport")):(this._transport=e,e.addProducer(this).then((function(){e.once("@close",(function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,"local"),t._transport=null,t._rtpParameters=null,t.safeEmit("unhandled"))})),t.safeEmit("handled"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)})).catch((function(e){throw t._transport=null,e})))}},{key:"pause",value:function(e){return g.debug("pause()"),!this._closed&&(!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit("pause","local",e),this.paused))}},{key:"remotePause",value:function(e){g.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return g.debug("resume()"),!this._closed&&(!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit("resume","local",e),!this.paused))}},{key:"remoteResume",value:function(e){g.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"stopTrack",value:function(){g.debug("stopTrack() ");try{this._track.onended=null,this._track.stop()}catch(e){g.debug("stopTrack() fail - "+e.name+" "+e.message)}}},{key:"replaceTrack",value:function(e){var t=this;if(g.debug("replaceTrack() [track:%o]",e),this._closed)return i.default.reject(new m.InvalidStateError("Producer closed"));if(!e)return i.default.reject(new TypeError("no track given"));if("ended"===e.readyState)return i.default.reject(new Error("track.readyState is [ended]"));var r=void 0;try{r=e.clone()}catch(t){r=e}return i.default.resolve().then((function(){if(t._transport)return t._transport.replaceProducerTrack(t,r)})).then((function(){try{t._track.onended=null,t._track.stop()}catch(e){g.debug("replaceTrack() fail - "+e.name+" "+e.message)}return t.paused?r.enabled=!1:r.enabled=!0,t._originalTrack=e,t._track=r,t._handleTrack(),t._track}))}},{key:"updateTrack",value:function(e,t,r){var i=this;this._track.applyConstraints(t).then((function(){g.debug("updateTrack() track.applyConstraints ok -- constraints: "+(0,n.default)(t)),i.setCodecOption(r),i._transport.updateTrack(i,e)})).catch((function(e){g.warn("updateTrack() error - track.applyConstraints failed - "+e.name+" "+e.message)}))}},{key:"setCodecOption",value:function(e){this._videoBitrateOptions={videoGoogleStartBitrate:e.idealBandwidth,videoGoogleMaxBitrate:e.maxBandwidth,videoGoogleMinBitrate:e.minBandwidth}}},{key:"setRtpParameters",value:function(e){this._rtpParameters=e}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;g.debug("enableStats() [interval:%s]",e),this._closed||this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){this._closed||this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:"enableInternalStats",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;g.debug("enableInternalStats() [interval:%s]",t),this._closed||this._internalStatsEnabled||("number"!=typeof t||t<1e3?this._interanlStatsInterval=1e3:this._statsInterval=t,this._internalStatsEnabled=!0,this._transport&&(this._internalTimer=setInterval((function(){return e.getStats().then((function(t){e.emit("internalStats",t)}))}),t)))}},{key:"disableInternalStats",value:function(){this._internalStatsEnabled&&clearInterval(this._internalTimer),this._internalTimer=null,this._internalStatsEnabled=!1}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"getStats",value:function(){return this.transport.getStats(this.track)}},{key:"_handleTrack",value:function(){var e=this;this._track.onended=function(){e._closed||(g.warn('track "ended" event'),e.safeEmit("trackended"))}}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"track",get:function(){return this._track}},{key:"originalTrack",get:function(){return this._originalTrack}},{key:"simulcast",get:function(){return this._simulcast}},{key:"appData",get:function(){return this._appData}},{key:"transport",get:function(){return this._transport}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"videoBitrateOptions",get:function(){return this._videoBitrateOptions}},{key:"audioProfile",get:function(){return this._audioProfile}}]),t}(f.default);t.default=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(17)),i=m(r(9)),a=m(r(8)),o=m(r(18)),s=m(r(2)),c=m(r(0)),d=m(r(1)),u=m(r(3)),l=m(r(4)),p=m(r(5)),f=m(r(11));function m(e){return e&&e.__esModule?e:{default:e}}var h=new p.default("<Peer>"),v=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this,h));return n._name=e,n._closed=!1,n._appData=JSON.parse((0,o.default)(r)),n._consumers=new a.default,n}return(0,l.default)(t,e),(0,d.default)(t,[{key:"close",value:function(){if(h.debug("close()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","local");var e=!0,t=!1,r=void 0;try{for(var n,a=(0,i.default)(this._consumers.values());!(e=(n=a.next()).done);e=!0){n.value.close()}}catch(e){t=!0,r=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw r}}}}},{key:"remoteClose",value:function(e){if(h.debug("remoteClose()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var a,o=(0,i.default)(this._consumers.values());!(t=(a=o.next()).done);t=!0){a.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}}}},{key:"getConsumerById",value:function(e){return this._consumers.get(e)}},{key:"addConsumer",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error("Consumer already exists [id:"+e.id+"]");this._consumers.set(e.id,e),e.on("@close",(function(){t._consumers.delete(e.id)})),this.safeEmit("newconsumer",e)}},{key:"name",get:function(){return this._name}},{key:"closed",get:function(){return this._closed}},{key:"appData",get:function(){return this._appData},set:function(e){e&&(this._appData=JSON.parse((0,o.default)(e)))}},{key:"consumers",get:function(){return(0,n.default)(this._consumers.values())}}]),t}(f.default);t.default=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(26)),i=m(r(6)),a=m(r(2)),o=m(r(0)),s=m(r(1)),c=m(r(3)),d=m(r(4)),u=m(r(20)),l=m(r(5)),p=m(r(11)),f=r(53);function m(e){return e&&e.__esModule?e:{default:e}}var h=new u.default(["default","low","medium","high"]),v=new l.default("Consumer"),_=function(e){function t(e,r,n,i,s){(0,o.default)(this,t);var d=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this,v));return d._id=e,d._closed=!1,d._kind=r,d._rtpParameters=n,d._peer=i,d._appData=s,d._supported=!1,d._transport=null,d._track=null,d._locallyPaused=!1,d._remotelyPaused=!1,d._statsEnabled=!1,d._statsInterval=1e3,d._preferredProfile="default",d._effectiveProfile=null,d}return(0,d.default)(t,e),(0,s.default)(t,[{key:"close",value:function(){v.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit("@close"),this.safeEmit("close","local"),this._destroy())}},{key:"remoteClose",value:function(){v.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit("@close"),this.safeEmit("close","remote"))}},{key:"_destroy",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:"receive",value:function(e){var t=this;return v.debug("receive() [transport:%o]",e),this._closed?i.default.reject(new f.InvalidStateError("Consumer closed")):this._supported?this._transport?i.default.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":(0,n.default)(e))?i.default.reject(new TypeError("invalid Transport")):(this._transport=e,e.addConsumer(this).then((function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once("@close",(function(){if(!t._closed&&t._transport===e){t._transport=null;try{t._track.stop()}catch(e){}t._track=null,t.safeEmit("unhandled")}})),t.safeEmit("handled"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r})).catch((function(e){throw t._transport=null,e}))):i.default.reject(new Error("unsupported codecs"))}},{key:"pause",value:function(e){return v.debug("pause()"),!this._closed&&(!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit("pause","local",e),this.paused))}},{key:"remotePause",value:function(e){v.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return v.debug("resume()"),!this._closed&&(!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit("resume","local",e),!this.paused))}},{key:"remoteResume",value:function(e){v.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"setPreferredProfile",value:function(e){v.debug("setPreferredProfile() [profile:%s]",e),this._closed?v.warn("setPreferredProfile() | Consumer closed"):e!==this._preferredProfile&&(h.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):v.error('setPreferredProfile() | invalid profile "%s"',e))}},{key:"remoteSetPreferredProfile",value:function(e){v.debug("remoteSetPreferredProfile() [profile:%s]",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:"remoteEffectiveProfileChanged",value:function(e){v.debug("remoteEffectiveProfileChanged() [profile:%s]",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit("effectiveprofilechange",this._effectiveProfile))}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;v.debug("enableStats() [interval:%s]",e),this._closed||this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){this._closed||this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:"setSupported",value:function(e){this._supported=e}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"getStats",value:function(e){return this.transport.getStats(e)}},{key:"enableInternalStats",value:function(e){var t=this,r=e>0&&void 0!==e?e:1e3;this._closed||this._internalStatsEnabled||(this._interanlStatsInterval="number"!=typeof r||r<1e3?1e3:r,this._internalStatsEnabled=!0,this._transport&&(this._internalTimer=setInterval((function(){return t.getStats().then((function(e){t.emit("internalStats",e)}))}),r)))}},{key:"disableInternalStats",value:function(){this._internalStatsEnabled&&clearInterval(this._internalTimer),this._internalTimer=null,this._internalStatsEnabled=!1}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"peer",get:function(){return this._peer}},{key:"appData",get:function(){return this._appData}},{key:"supported",get:function(){return this._supported}},{key:"transport",get:function(){return this._transport}},{key:"track",get:function(){return this._track}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"preferredProfile",get:function(){return this._preferredProfile}},{key:"effectiveProfile",get:function(){return this._effectiveProfile}}]),t}(p.default);t.default=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemotePlainRtpSdp=t.RemotePlanBSdp=t.RemoteUnifiedPlanSdp=t.sdpPlainRtpUtils=t.sdpPlanBUtils=t.sdpUnifiedPlanUtils=t.sdpCommonUtils=t.ortc=t.utils=t.EnhancedEventEmitter=t.Logger=void 0;var n=h(r(5)),i=h(r(11)),a=m(r(10)),o=m(r(16)),s=m(r(21)),c=m(r(36)),d=m(r(44)),u=m(r(217)),l=h(r(37)),p=h(r(45)),f=h(r(218));function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function h(e){return e&&e.__esModule?e:{default:e}}t.Logger=n.default,t.EnhancedEventEmitter=i.default,t.utils=a,t.ortc=o,t.sdpCommonUtils=s,t.sdpUnifiedPlanUtils=c,t.sdpPlanBUtils=d,t.sdpPlainRtpUtils=u,t.RemoteUnifiedPlanSdp=l.default,t.RemotePlanBSdp=p.default,t.RemotePlainRtpSdp=f.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractPlainRtpParametersByKind=function(e,t){var r=(e.media||[]).find((function(e){return e.type===t}));if(!r)throw new Error("m="+t+" section not found");return{ip:e.connection.ip,port:r.port}},t.fillRtpParametersForKind=function(e,t,r){var n={cname:null,reducedSize:!0,mux:!0},i=(t.media||[]).find((function(e){return e.type===r}));if(!i)throw new Error("m="+r+" section not found");var a=(i.ssrcs||[]).find((function(e){return"cname"===e.attribute})),o=void 0;a&&(o=a.id,n.cname=a.value);e.rtcp=n,e.encodings=[];var s={ssrc:o};e.encodings.push(s)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(43)),i=f(r(9)),a=f(r(2)),o=f(r(3)),s=f(r(4)),c=f(r(0)),d=f(r(1)),u=f(r(13)),l=f(r(5)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(10));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default("<RemotePlainRtpSdp>"),h=function(){function e(t){(0,c.default)(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:p.randomNumber(),version:0}}return(0,d.default)(e,[{key:"setTransportLocalParameters",value:function(e){m.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){m.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}}]),e}(),v=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:"createAnswerSdp",value:function(e){if(m.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.plainRtpParameters,r={},a=(e.media||[]).filter((function(e){return e.hasOwnProperty("mid")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},r.name="-",r.timing={start:0,stop:0},r.msidSemantic={semantic:"WMS",token:"*"},a.length>0&&(r.groups=[{type:"BUNDLE",mids:a.join(" ")}]),r.media=[];var o=!0,s=!1,c=void 0;try{for(var d,l=(0,i.default)(e.media||[]);!(o=(d=l.next()).done);o=!0){var p=d.value,f="inactive"===p.direction,h=p.type,v=this._rtpParametersByKind[h].codecs,_=this._rtpParametersByKind[h].headerExtensions,g={};switch(g.type=p.type,g.port=t.port,g.protocol="RTP/AVP",g.connection={ip:t.ip,version:t.version},g.mid=p.mid,p.direction){case"sendrecv":case"sendonly":g.direction="recvonly";break;case"recvonly":case"inactive":g.direction="inactive"}g.rtp=[],g.rtcpFb=[],g.fmtp=[];var y=!0,b=!1,I=void 0;try{for(var k,P=(0,i.default)(v);!(y=(k=P.next()).done);y=!0){var S=k.value,w={payload:S.payloadType,codec:S.name,rate:S.clockRate};if(S.channels>1&&(w.encoding=S.channels),g.rtp.push(w),S.parameters){var T={payload:S.payloadType,config:""},A=!0,E=!1,R=void 0;try{for(var C,O=(0,i.default)((0,n.default)(S.parameters));!(A=(C=O.next()).done);A=!0){var x=C.value;T.config&&(T.config+=";"),T.config+=x+"="+S.parameters[x]}}catch(e){E=!0,R=e}finally{try{!A&&O.return&&O.return()}finally{if(E)throw R}}T.config&&g.fmtp.push(T)}if(S.rtcpFeedback){var D=!0,N=!1,L=void 0;try{for(var M,B=(0,i.default)(S.rtcpFeedback);!(D=(M=B.next()).done);D=!0){var V=M.value;g.rtcpFb.push({payload:S.payloadType,type:V.type,subtype:V.parameter||""})}}catch(e){N=!0,L=e}finally{try{!D&&B.return&&B.return()}finally{if(N)throw L}}}}}catch(e){b=!0,I=e}finally{try{!y&&P.return&&P.return()}finally{if(b)throw I}}if(g.payloads=v.map((function(e){return e.payloadType})).join(" "),!f){g.ext=[];var j=!0,F=!1,U=void 0;try{for(var H,G=function(){var e=H.value;if(!(p.ext||[]).find((function(t){return t.uri===e.uri})))return"continue";g.ext.push({uri:e.uri,value:e.id})},K=(0,i.default)(_);!(j=(H=K.next()).done);j=!0)G()}catch(e){F=!0,U=e}finally{try{!j&&K.return&&K.return()}finally{if(F)throw U}}}if(p.simulcast_03){g.simulcast_03={value:p.simulcast_03.value.replace(/send/g,"recv")},g.rids=[];var W=!0,z=!1,q=void 0;try{for(var X,J=(0,i.default)(p.rids||[]);!(W=(X=J.next()).done);W=!0){var Y=X.value;"send"===Y.direction&&g.rids.push({id:Y.id,direction:"recv"})}}catch(e){z=!0,q=e}finally{try{!W&&J.return&&J.return()}finally{if(z)throw q}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",r.media.push(g)}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}return u.default.write(r)}}]),t}(h),_=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,d.default)(t,[{key:"createOfferSdp",value:function(e){if(m.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.plainRtpParameters,r={},a=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},r.name="-",r.timing={start:0,stop:0},r.msidSemantic={semantic:"WMS",token:"*"},a.length>0&&(r.groups=[{type:"BUNDLE",mids:a.join(" ")}]),r.media=[];var o=!0,s=!1,c=void 0;try{for(var d,l=(0,i.default)(e);!(o=(d=l.next()).done);o=!0){var p=d.value,f=p.closed,h=p.kind,v=this._rtpParametersByKind[h].codecs,_=this._rtpParametersByKind[h].headerExtensions,g={};g.type=h,g.mid=p.mid,g.msid=p.streamId+" "+p.trackId,g.port=t.port,g.protocol="RTP/AVP",g.connection={ip:t.ip,version:t.version},g.direction=f?"inactive":"sendonly",g.rtp=[],g.rtcpFb=[],g.fmtp=[];var y=!0,b=!1,I=void 0;try{for(var k,P=(0,i.default)(v);!(y=(k=P.next()).done);y=!0){var S=k.value,w={payload:S.payloadType,codec:S.name,rate:S.clockRate};if(S.channels>1&&(w.encoding=S.channels),g.rtp.push(w),S.parameters){var T={payload:S.payloadType,config:""},A=!0,E=!1,R=void 0;try{for(var C,O=(0,i.default)((0,n.default)(S.parameters));!(A=(C=O.next()).done);A=!0){var x=C.value;T.config&&(T.config+=";"),T.config+=x+"="+S.parameters[x]}}catch(e){E=!0,R=e}finally{try{!A&&O.return&&O.return()}finally{if(E)throw R}}T.config&&g.fmtp.push(T)}if(S.rtcpFeedback){var D=!0,N=!1,L=void 0;try{for(var M,B=(0,i.default)(S.rtcpFeedback);!(D=(M=B.next()).done);D=!0){var V=M.value;g.rtcpFb.push({payload:S.payloadType,type:V.type,subtype:V.parameter||""})}}catch(e){N=!0,L=e}finally{try{!D&&B.return&&B.return()}finally{if(N)throw L}}}}}catch(e){b=!0,I=e}finally{try{!y&&P.return&&P.return()}finally{if(b)throw I}}if(g.payloads=v.map((function(e){return e.payloadType})).join(" "),!f){g.ext=[];var j=!0,F=!1,U=void 0;try{for(var H,G=(0,i.default)(_);!(j=(H=G.next()).done);j=!0){var K=H.value;"urn:ietf:params:rtp-hdrext:sdes:mid"!==K.uri&&g.ext.push({uri:K.uri,value:K.id})}}catch(e){F=!0,U=e}finally{try{!j&&G.return&&G.return()}finally{if(F)throw U}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",f||(g.ssrcs=[],g.ssrcGroups=[],g.ssrcs.push({id:p.ssrc,attribute:"cname",value:p.cname}),p.rtxSsrc&&(g.ssrcs.push({id:p.rtxSsrc,attribute:"cname",value:p.cname}),g.ssrcGroups.push({semantics:"FID",ssrcs:p.ssrc+" "+p.rtxSsrc}))),r.media.push(g)}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}return u.default.write(r)}}]),t}(h);t.default=function e(t,r){switch((0,c.default)(this,e),m.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new v(r);case"recv":return new _(r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketTransport=t.Peer=void 0;var n=a(r(220)),i=a(r(118));function a(e){return e&&e.__esModule?e:{default:e}}t.Peer=n.default,t.WebSocketTransport=i.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(6)),i=m(r(8)),a=m(r(1)),o=m(r(2)),s=m(r(0)),c=m(r(3)),d=m(r(4)),u=r(29),l=m(r(30)),p=m(r(116)),f=m(r(118));function m(e){return e&&e.__esModule?e:{default:e}}var h=new l.default("<protooPeer>"),v=function(e){function t(e,r){(0,s.default)(this,t);var n=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return n.cause=r,n.name="TimeoutError",n}return(0,d.default)(t,e),t}(Error),_=function(e){function t(e,r,n){(0,s.default)(this,t),h.debug("constructor() protooUrl: "+e);var a=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));a.setMaxListeners(1/0),a._sessionId=r,a._protooUrl=e;var d={retries:n||10,factor:2,minTimeout:1e3,maxTimeout:4e3};return a._transport=new f.default(e,{retry:d}),a._pingInterval=null,a._lastPongTick=0,a._closed=!1,a._connected=!1,a._data={},a._requestHandlers=new i.default,a._handleTransport(),a}return(0,d.default)(t,e),(0,a.default)(t,[{key:"_startPingInterval",value:function(){var e=this,t=new Date;this._lastPongTick=t.getTime(),this._stopPingInterval(),this._pingInterval=setInterval((function(){e.send("ping",{appData:""}).then((function(t){var r=new Date;e._lastPongTick=r.getTime()})).catch((function(t){var r=(new Date).getTime();"TimeoutError"===t.name&&r-e._lastPongTick>6e3&&(e._lastPongTick=r,h.debug("_pingInterval - some error occur: "+t.name+" "+t.code+" - curTS: "+r+" this._lastPongTick: "+e._lastPongTick),setTimeout((function(){e._stopPingInterval(),e._transport.reconnect({code:4001,reason:"Heartbeat timeout"})})))}))}),2e3)}},{key:"_stopPingInterval",value:function(){this._pingInterval&&clearInterval(this._pingInterval),this._pingInterval=null}},{key:"send",value:function(e,t){var r=this;if(this.connected){var i=p.default.requestFactory(e,t);return this._transport.send(i).then((function(){return new n.default((function(e,t){var n={resolve:function(t){r._requestHandlers.delete(i.id)&&(n.timer&&clearTimeout(n.timer),n.timer=null,e(t))},reject:function(e){r._requestHandlers.delete(i.id)&&(n.timer&&clearTimeout(n.timer),n.timer=null,t(e))},timer:setTimeout((function(){r._requestHandlers.delete(i.id)&&(r.closed||(n.timer&&clearTimeout(n.timer),n.timer=null,t(new v("request timeout"))))}),5e3),close:function(){n.timer&&clearTimeout(n.timer),n.timer=null}};r._requestHandlers.set(i.id,n)}))}))}}},{key:"notify",value:function(e,t){if(this.connected){var r=p.default.notificationFactory(e,t);return this._transport.send(r)}}},{key:"close",value:function(){h.debug("close()"),this._closed||(this._stopPingInterval(),this._closed=!0,this._transport.close(),this._requestHandlers.forEach((function(e){return e.close()})),this.emit("close",{code:1e3,reason:"Normal close",sid:this._sessionId}))}},{key:"_handleTransport",value:function(){var e=this;if(this._transport.closed)return this._closed=!0,void setTimeout((function(){e.emit("close",{code:1e3,reason:"Normal close",sid:e._sessionId})}));this._transport.removeAllListeners("connecting"),this._transport.on("connecting",(function(t){e.emit("connecting",{sid:e._sessionId,currentAttempt:t})})),this._transport.removeAllListeners("open"),this._transport.on("open",(function(t){e._closed||(e._connected=!0,e._startPingInterval(),e.emit("open",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners("conn-reconn"),this._transport.on("conn-reconn",(function(t){e._closed||(e._connected=!0,e._startPingInterval(),e.emit("conn-reconn",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners("conn-interrupt"),this._transport.on("conn-interrupt",(function(t){e._closed||(e._stopPingInterval(),e._connected=!1,e.emit("conn-interrupt",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners("conn-error"),this._transport.on("conn-error",(function(t){e._closed||(e._stopPingInterval(),e.emit("conn-error",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners("reinit"),this._transport.on("reinit",(function(t){e._closed||(e._connected=!0,e.emit("reinit",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners("close"),this._transport.on("close",(function(t){e._closed||(e._stopPingInterval(),e._closed=!0,e._connected=!1,e.emit("close",{code:t.code,reason:t.reason,sid:e._sessionId}))})),this._transport.removeAllListeners("message"),this._transport.on("message",(function(t){e.closed||(t.request?e._handleRequest(t):t.response?e._handleResponse(t):t.notification&&e._handleNotification(t))}))}},{key:"_handleRequest",value:function(e){var t=this;this.emit("request",{sid:this._sessionId},e,(function(r){var n=p.default.successResponseFactory(e,r);t._transport.send(n).catch((function(e){h.warn("_handleRequest() accept() _transport.send error - "+e.name+" "+e.message)}))}),(function(r,n){r instanceof Error?(n=r.toString(),r=500):"number"==typeof r&&n instanceof Error&&(n=n.toString());var i=p.default.errorResponseFactory(e,r,n);t._transport.send(i).catch((function(e){h.warn("_handleRequest() reject() error - "+e.name+" "+e.message)}))}))}},{key:"_handleResponse",value:function(e){var t=this._requestHandlers.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else h.error("_handleResponse() received response does not match any sent request")}},{key:"_handleNotification",value:function(e){this.emit("notification",{sid:this._sessionId},e)}},{key:"data",get:function(){return this._data},set:function(e){this._data=e||{}}},{key:"closed",get:function(){return this._closed}},{key:"connected",get:function(){return this._connected}}]),t}(u.EventEmitter);t.default=_},function(e,t,r){var n;try{n=r(222)}catch(e){}finally{if(n||"undefined"==typeof window||(n=window),!n)throw new Error("Could not determine global this")}var i=n.WebSocket||n.MozWebSocket,a=r(223);function o(e,t){return t?new i(e,t):new i(e)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(o,e,{get:function(){return i[e]}})})),e.exports={w3cwebsocket:i?o:null,version:a}},function(e,t){var r=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return r()}try{return __global__||r()}finally{delete Object.prototype.__global__}}()},function(e,t,r){e.exports=r(224).version},function(e){e.exports=JSON.parse('{"name":"websocket","description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"author":"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)","contributors":["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],"version":"1.0.31","repository":{"type":"git","url":"https://github.com/theturtle32/WebSocket-Node.git"},"homepage":"https://github.com/theturtle32/WebSocket-Node","engines":{"node":">=0.10.0"},"dependencies":{"debug":"^2.2.0","es5-ext":"^0.10.50","nan":"^2.14.0","typedarray-to-buffer":"^3.1.5","yaeti":"^0.0.6"},"devDependencies":{"buffer-equal":"^1.0.0","faucet":"^0.0.1","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1","jshint":"^2.0.0","tape":"^4.9.1"},"config":{"verbose":false},"scripts":{"install":"(node-gyp rebuild 2> builderror.log) || (exit 0)","test":"faucet test/unit","gulp":"gulp"},"main":"index","directories":{"lib":"./lib"},"browser":"lib/browser.js","license":"Apache-2.0","__npminstall_done":"Fri Feb 28 2020 14:40:09 GMT+0800 (GMT+08:00)","_from":"websocket@1.0.31","_resolved":"https://registry.npm.taobao.org/websocket/download/websocket-1.0.31.tgz"}')},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(18)),i=p(r(8)),a=p(r(0)),o=p(r(1)),s=p(r(226)),c=p(r(30)),d=l(r(42)),u=l(r(62));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}var f=r(84),m=(0,s.default)({HEART_BEAT:"event=sdkHeartbeat",ENTER_FAIL:"event=ENTER_FAIL",ENTER_TIMEOUT:"event=ENTER_TIMEOUT"}),h=new c.default("Stats"),v=function(){function e(){(0,a.default)(this,e),this._appId="",this._roomId="",this._sessionId="",this._userId="",this._connectionId="",this._roleType="",this._domain="",this._signalReconnectTimes=0,this._netType="",this._isMobile=/mobile/i.test(navigator.userAgent),this._outputAdjustVolume=1,this._micAdjustVolume=1,this._presetAudioBitrate=0,this._isAudioOpen=!1,this._isVideoOpen=!1,this._webrtcInternalSendStats=new i.default,this._webrtcInternalRecvStats=new Array,this._reportInterval=null,this._webrtcStats=[],this._audioRecvStats=new i.default,this._videoRecvStats=new i.default,this._audioSendStats=new i.default,this._videoSendStats=new i.default,this._sendRTT=0,this._recvRTT=0,this._upStatHelper=new i.default,this._summarizeUpLostHelper=new Array,this._summarizeDownLostHelper=new Array,this._summarize={rtt:0,networkType:"",upSpeed:0,upFractionLost:0,downSpeed:0,downFractionLost:0},this._cstat={peerId:"",appId:"",connectionId:"",roomId:"",consumer:"",stat:[]},this.streamSsrcPairs=new i.default,this.STATS_INTERVAL=4e3,this.STATS_INTERVAL_S=2e3,this._gwInfo={},this._iplocationInfo={},this.setNetworkType()}return(0,o.default)(e,[{key:"stop",value:function(){this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=null),this._webrtcInternalSendStats.clear(),this._webrtcInternalRecvStats.clear()}},{key:"getAudioUpStat",value:function(e){return this._audioSendStats?this._audioSendStats.get(e):null}},{key:"getVideoUpStat",value:function(e){return this._videoSendStats?this._videoSendStats.get(e):null}},{key:"getAudioDownStat",value:function(e){return this._audioRecvStats?this._audioRecvStats.get(e):null}},{key:"getVideoDownStat",value:function(e){return this._videoRecvStats?this._videoRecvStats.get(e):null}},{key:"updateStreamSSRCPairs",value:function(e,t){var r=this.streamSsrcPairs.get(e);h.debug("updateStreamSSRCPairs - id: "+e+" ssrc: "+t),r&&(r.ssrc=Number(t))}},{key:"setStreamSSRCPairs",value:function(e,t,r,n,i){var a={ssrc:Number(r),type:""+t,active:""+i,stream:n};this.streamSsrcPairs.set(e,a)}},{key:"actStreamSSRCPairs",value:function(e,t){var r=this.streamSsrcPairs.get(e);r&&(r.active=t)}},{key:"isActStreamSSRCPairs",value:function(e){var t=this.streamSsrcPairs.get(e);return!!t&&t.active}},{key:"getStreamPropertyBySSRC",value:function(e,t){var r="",n=!1,i="";return this.streamSsrcPairs.forEach((function(a,o){!n&&a&&a.ssrc===Number(e)&&(r=o,i=a.stream[t],n=!0)})),{id:r,value:i}}},{key:"removeStreamById",value:function(e){this.streamSsrcPairs.delete(e)}},{key:"setAppid",value:function(e){this._appId=e,this._cstat.appId=e}},{key:"setRoomId",value:function(e){this._roomId=e,this._cstat.roomId=e}},{key:"setSessionId",value:function(e){this._sessionId=e}},{key:"setUserId",value:function(e){this._userId=e,this._cstat.peerId=e}},{key:"setConnectionId",value:function(e){this._connectionId=e,this._cstat.connectionId=e}},{key:"setRoleType",value:function(e){this._roleType=""+e}},{key:"setOutputAdjustVolume",value:function(e){this._outputAdjustVolume=e}},{key:"setMicAdjustVolume",value:function(e){this._micAdjustVolume=e}},{key:"setPresetAudioBitrate",value:function(e){this._presetAudioBitrate=e}},{key:"setSignalReconnectTimes",value:function(e){this._signalReconnectTimes=e}},{key:"setDomain",value:function(e){this._domain=e}},{key:"setGWInfo",value:function(e){this._gwInfo=e[0]}},{key:"setIPlocationInfo",value:function(e){this._iplocationInfo=JSON.parse((0,n.default)(e))}},{key:"setNetworkType",value:function(){try{switch((navigator.connection||navigator.mozConnection||navigator.webkitConnection).type){case"wifi":this._netType="0";break;case"ethernet":default:this._netType="4"}}catch(e){}}},{key:"_reportWebrtcStats",value:function(){var e=this;if(this._webrtcInternalSendStats||this._webrtcInternalRecvStats){var t=0;this._webrtcInternalSendStats.forEach((function(e){Boolean(e)&&e.length>t&&(t=e.length)}));var r=this._webrtcInternalRecvStats.length,n=Math.min(Math.max(t,r),10);this._webrtcStats=[];for(var i=function(t){var r={};r.appId=""+e._appId,r.roomId=""+e._roomId,r.sessionId=""+e._sessionId,r.userId=""+e._userId,r.connectionId=""+e._connectionId,r.roleType=""+e._roleType,r.signalReconnectTimes=e._signalReconnectTimes,r.equipInfo={sdkVersion:f.version+"_"+f.buildDate,netType:""+e._netType,equipModel:e._isMobile?"web_mobile":"web",inBackground:0,systemVersion:"web",publicVersion:"3T_Web_SDK_V"+f.version+"_"+f.buildDate},r.audioInfo={},r.audioInfo.A_SENT={},r.audioInfo.A_RECV=[],r.videoInfo={},r.videoInfo.V_SENT=[],r.videoInfo.V_RECV=[];var n="",i=0,a=0;e._webrtcInternalSendStats.forEach((function(t){if(t){var o=t.shift();if(o){o.connectionType&&o.connectionType.remote&&(n=o.connectionType.remote.ipAddress,i=o.connectionType.remote.portNumber),r.logTime=o.statTimeTick;var s=o.bandwidth.rtt;o.audio.ssrc.forEach((function(t){var n=t;if(o.audio&&o.audio[n]){var i=o.audio[n].upSpeedKBPS?o.audio[n].upSpeedKBPS:0;r.audioInfo.A_SENT.A_BR=parseInt(i,10),r.audioInfo.A_SENT.A_SSRC=n,r.audioInfo.A_SENT.A_RTT=s,r.audioInfo.A_SENT.A_MUTED=e._isAudioOpen?0:1;var a=o.audio[n].helper?o.audio[n].helper.fractionLost:0;r.audioInfo.A_SENT.A_FRACTIONLOST=parseFloat(a.toFixed(2)),r.audioInfo.A_SENT.A_RECV=0,r.audioInfo.A_SENT.A_SENT=o.audio[n].bytesSent?o.audio[n].bytesSent:0,r.audioInfo.A_SENT.A_RECONNECT={},r.audioInfo.A_SENT.A_LEVELSUM=1,r.audioInfo.A_SENT.A_PRELEVELSUM=1,r.audioInfo.A_SENT.A_MIC_VOL=e._micAdjustVolume,r.audioInfo.A_SENT.A_CAP_STAT=1,r.audioInfo.A_SENT.A_SPEAKING=1,r.audioInfo.A_SENT.A_BITRATE=e._presetAudioBitrate}})),o.video.ssrc.forEach((function(t){var n,i=t,c=e.getStreamPropertyBySSRC(i,"streamId"),d=c.id,u=c.value;if(e.isActStreamSSRCPairs(d)&&(n=u,o.video&&o.video[i])){r.videoInfo.V_SENT[a]={},r.videoInfo.V_SENT[a].DEVID=""+n,r.videoInfo.V_SENT[a].V_SSRC=+i;var l=o.video[i].upSpeedKBPS?o.video[i].upSpeedKBPS:0;r.videoInfo.V_SENT[a].V_VBR=parseInt(l,10),r.videoInfo.V_SENT[a].V_FPS=15,r.videoInfo.V_SENT[a].V_SENDBYTES=o.video[i].bytesSent?o.video[i].bytesSent:0,r.videoInfo.V_SENT[a].V_SENDCOUNT=o.video[i].packetsSentTotal?o.video[i].packetsSentTotal:0;var p=o.video[i].helper?o.video[i].helper.fractionLost:0;r.videoInfo.V_SENT[a].V_SENDFRACTIONLOST=parseFloat(p.toFixed(2)),r.videoInfo.V_SENT[a].V_RTT=s,r.videoInfo.V_SENT[a].V_RECV=0,r.videoInfo.V_SENT[a].V_SEND=o.video[i].bytesSent?o.video[i].bytesSent:0,r.videoInfo.V_SENT[a].V_LOSS=0,r.videoInfo.V_SENT[a].V_RECONNECT={},r.videoInfo.V_SENT[a].V_MUTED=e._isVideoOpen?0:1,r.videoInfo.V_SENT[a].V_QP=36,r.videoInfo.V_SENT[a].V_SFPS=15,a++}}))}}}));var o=e._webrtcInternalRecvStats.shift();if(o){o.connectionType&&o.connectionType.remote&&(n=o.connectionType.remote.ipAddress,i=o.connectionType.remote.portNumber),r.logTime=o.statTimeTick;var s=0,c=0,d=o.bandwidth.rtt;o.audio.ssrc.forEach((function(t){var n=t,i=e.getStreamPropertyBySSRC(n,"userId"),a=i.id,s=i.value;if(e.isActStreamSSRCPairs(a)){var u=s;if(""!==u&&o.audio&&o.audio[n]){r.audioInfo.A_RECV[c]={},r.audioInfo.A_RECV[c].RECVUID=u,r.audioInfo.A_RECV[c].A_SSRC=n;var l=o.audio[n].downSpeedKBPS?o.audio[n].downSpeedKBPS:0;r.audioInfo.A_RECV[c].A_RECVBR=parseInt(l,10),r.audioInfo.A_RECV[c].A_RECVBYTES=o.audio[n].bytesReceived;var p=parseInt(o.audio[n].packetsLost?o.audio[n].packetsLost:0,10),f=o.audio[n].helper?o.audio[n].helper.fractionLost:0;r.audioInfo.A_RECV[c].A_LOSTRATE=parseFloat(f.toFixed(2)),r.audioInfo.A_RECV[c].A_BUFFERDURATION=o.audio[n].jitterBufferMs,r.audioInfo.A_RECV[c].A_RECVFRACTIONLOST=parseFloat(f.toFixed(2)),r.audioInfo.A_RECV[c].A_RTT=d,r.audioInfo.A_RECV[c].A_DELAY=parseInt(o.audio[n].latency?o.audio[n].latency:0,10),r.audioInfo.A_RECV[c].A_AVJMS=0,r.audioInfo.A_RECV[c].A_MAXJMS=0,r.audioInfo.A_RECV[c].A_DISCARDEDPKTS=p,r.audioInfo.A_RECV[c].A_VOLUME=e._outputAdjustVolume,r.audioInfo.A_RECV[c].A_LEVELSUM=1,r.audioInfo.A_RECV[c].A_MUTE=0,c++}}})),o.video.ssrc.forEach((function(t){var n,i=t,a=e.getStreamPropertyBySSRC(i,"userId"),c=a.id,u=a.value;if(e.isActStreamSSRCPairs(c)&&""!==(n=u)){var l,p=e.getStreamPropertyBySSRC(i,"streamId");p.id;if(l=p.value,o.video&&o.video[i]){r.videoInfo.V_RECV[s]={},r.videoInfo.V_RECV[s].RECVUID=""+n,r.videoInfo.V_RECV[s].RECVID=""+l,r.videoInfo.V_RECV[s].V_SSRC=+i,r.videoInfo.V_RECV[s].V_FPS=15;var f=o.video[i].recv.resolutions?o.video[i].recv.resolutions.width:0,m=o.video[i].recv.resolutions?o.video[i].recv.resolutions.height:0;r.videoInfo.V_RECV[s].V_WIDTH=f,r.videoInfo.V_RECV[s].V_HEIGHT=m;var h=o.video[i].downSpeedKBPS?o.video[i].downSpeedKBPS:0;r.videoInfo.V_RECV[s].V_RECVBR=parseInt(h,10),r.videoInfo.V_RECV[s].V_RECVBYTES=o.video[i].bytesReceived,r.videoInfo.V_RECV[s].V_RECVCOUNT=o.video[i].packetsReceivedTotal;var v=o.video[i].helper?o.video[i].helper.fractionLost:0;r.videoInfo.V_RECV[s].V_LOSTRATE=parseFloat(v.toFixed(2)),r.videoInfo.V_RECV[s].V_RTT=d,r.videoInfo.V_RECV[s].V_JITTER=o.video[i].jitterBufferMs,r.videoInfo.V_RECV[s].V_RECVFRAMECOUNT=o.video[i].framesDecoded;var _=o.video[i].latency?o.video[i].latency:0;r.videoInfo.V_RECV[s].V_DELAY=parseInt(_,10),r.videoInfo.V_RECV[s].V_FRACTIONLOST=parseFloat(v.toFixed(2)),r.videoInfo.V_RECV[s].V_MUTED=1,r.videoInfo.V_RECV[s].V_TARGETVBR=parseInt(h,10),s++}}}))}r.mediaServerInfo={aIp:n,audio_port:i,aSid:"",vIp:n,vPort:i,vSid:""},e._webrtcStats.push(r)},a=0;a<n;a++)i();n>0&&this.pushLoggerToServer(m.HEART_BEAT,this._webrtcStats),Math.max(t,r)>10&&this._reportWebrtcStats()}}},{key:"setWebrtcInternalSendStats",value:function(e,t){var r=this,i=(new Date).getTime(),a=JSON.parse((0,n.default)(t));this._sendRTT=a.bandwidth?Number(a.bandwidth.rtt):0,this._summarize.rtt=this._sendRTT?this._sendRTT:0,this._summarize.networkType=a.connectionType.local.networkType;var o=0;a.audio&&a.audio.ssrc&&a.audio.ssrc.length>0&&(a.audio.ssrc.forEach((function(e,t){i-a.audio[e].statTS>3e3&&delete a.audio.ssrc[t]})),a.audio.ssrc=a.audio.ssrc.filter((function(e,t,r){return!!e})),a.audio.ssrc.forEach((function(e,t){var n=e;if(a.audio[n]){var s=""+r._userId,c={};c.statTS=i,c.streamId=s,c.ssrc=n,c.timestamp=i,c.bitrate=a.audio[n].upSpeedKBPS?Number(a.audio[n].upSpeedKBPS):0,c.packetCount=a.audio[n].packetsSent?Number(a.audio[n].packetsSent):0,c.packetLost=a.audio[n].packetsLost?Number(a.audio[n].packetsLost):0;var d=c.packetCount>0?c.packetLost/c.packetCount:0;a.audio[n].helper||(a.audio[n].helper={},a.audio[n].helper.his=[]);var u=1,l=d>1?1:d;a.audio[n].helper.his.forEach((function(e){e&&(l+=e,u++)})),a.audio[n].helper.his.push(d),a.audio[n].helper.his.length>5&&a.audio[n].helper.his.shift();var p=l/u;a.audio[n].helper.fractionLost=p,c.fractionLost=p?parseFloat(p.toFixed(2)):0,c.rtt=r._sendRTT?Number(r._sendRTT):0,c.availableSendBandwidth=a.bandwidth.availableSendBandwidth,r._audioSendStats.set(s,c),o=c.fractionLost}})));var s=0;a.video&&a.video.ssrc&&a.video.ssrc.length>0&&(a.video.ssrc.forEach((function(e,t){i-a.video[e].statTS>3e3&&delete a.video.ssrc[t]})),a.video.ssrc=a.video.ssrc.filter((function(e,t,r){return!!e})),a.video.ssrc.forEach((function(e,t){var n=e,o=r.getStreamPropertyBySSRC(n,"streamId"),c=o.id,d=o.value;if(r.isActStreamSSRCPairs(c)&&Boolean(a.video[n])){var u=""+d,l={};l.statTS=i,l.streamId=u,l.ssrc=n,l.timestamp=i,l.bitrate=a.video[n].upSpeedKBPS?Number(a.video[n].upSpeedKBPS):0,l.packetCount=a.video[n].packetsSent?Number(a.video[n].packetsSent):0,l.packetLost=a.video[n].packetsLost?Number(a.video[n].packetsLost):0;var p=l.packetCount>0?l.packetLost/l.packetCount:0;a.video[n].helper||(a.video[n].helper={},a.video[n].helper.his=[]);var f=1,m=p>1?1:p;a.video[n].helper.his.forEach((function(e){e&&(m+=e,f++)})),a.video[n].helper.his.push(p),a.video[n].helper.his.length>5&&a.video[n].helper.his.shift();var h=m/f;a.video[n].helper.fractionLost=h,l.fractionLost=h?parseFloat(h.toFixed(2)):0,l.rtt=r._sendRTT?Number(r._sendRTT):0,l.availableSendBandwidth=a.bandwidth.availableSendBandwidth,r._videoSendStats.set(u,l),s=l.fractionLost}})));var c=s>o?s:o,d=1,u=c;this._summarizeUpLostHelper.forEach((function(e){e&&(u+=e,d++)})),this._summarizeUpLostHelper.push(c),this._summarizeUpLostHelper.length>3&&this._summarizeUpLostHelper.shift();var l=a.bandwidth?Number(a.bandwidth.upSpeed):0,p=this._upStatHelper.get(e);if(p?(p.statTS=i,p.upSpeed=l,p.upFractionLost=u/d):this._upStatHelper.set(e,{statTS:i,upSpeed:l,upFractionLost:u/d}),this._webrtcInternalSendStats){a.statTimeTick=i;var f=this._webrtcInternalSendStats.get(e);f||(f=new Array,this._webrtcInternalSendStats.set(e,f)),f&&f.push(a)}}},{key:"setWebrtcInternalRecvStats",value:function(e){var t=this,r=JSON.parse((0,n.default)(e));this._recvRTT=r.bandwidth?Number(r.bandwidth.rtt):0,this._summarize.rtt=this._recvRTT?this._recvRTT:0,this._summarize.downSpeed=r.bandwidth?Number(r.bandwidth.downSpeed):0,this._summarize.networkType=r.connectionType.local.networkType;var i=0,a=(new Date).getTime();r.audio&&r.audio.ssrc&&r.audio.ssrc.length>0&&(r.audio.ssrc.forEach((function(e,t){a-r.audio[e].statTS>3e3&&delete r.audio.ssrc[t]})),r.audio.ssrc=r.audio.ssrc.filter((function(e,t,r){return!!e})),r.audio.ssrc.forEach((function(e,n){var o=e,s=(t.streamSsrcPairs,t.getStreamPropertyBySSRC(o,"userId")),c=s.id,d=s.value;if(t.isActStreamSSRCPairs(c)&&Boolean(r.audio[o])){var u=""+d,l={};l.statTS=a,l.streamId=u,l.ssrc=o,l.timestamp=a,l.bitrate=r.audio[o].downSpeedKBPS?Number(r.audio[o].downSpeedKBPS):0,l.packetCount=r.audio[o].packetsReceived?Number(r.audio[o].packetsReceived):0,l.packetLost=r.audio[o].packetsLost?Number(r.audio[o].packetsLost):0;var p=l.packetCount>0?l.packetLost/(l.packetCount+l.packetLost):0;r.audio[o].helper||(r.audio[o].helper={},r.audio[o].helper.his=[]);var f=1,m=p>1?1:p;r.audio[o].helper.his.forEach((function(e){e&&(m+=e,f++)})),r.audio[o].helper.his.push(p),r.audio[o].helper.his.length>5&&r.audio[o].helper.his.shift();var h=m/f;r.audio[o].helper.fractionLost=h,l.fractionLost=h?parseFloat(h.toFixed(2)):0,l.latency=r.audio[o].latency?Number(r.audio[o].latency):0,l.rtt=t._recvRTT?Number(t._recvRTT):0,l.availableRecvBandwidth=r.bandwidth.availableRecvBandwidth,t._audioRecvStats.set(u,l),i=l.fractionLost}})));var o=0;r.video&&r.video.ssrc&&r.video.ssrc.length>0&&(r.video.ssrc.forEach((function(e,t){a-r.video[e].statTS>3e3&&delete r.video.ssrc[t]})),r.video.ssrc=r.video.ssrc.filter((function(e,t,r){return!!e})),r.video.ssrc.forEach((function(e,n){var i=e,s=(t.streamSsrcPairs,t.getStreamPropertyBySSRC(i,"streamId")),c=s.id,d=s.value;if(t.isActStreamSSRCPairs(c)&&Boolean(r.video[i])){var u=""+d,l={};l.statTS=a,l.streamId=u,l.ssrc=i,l.timestamp=a,l.bitrate=r.video[i].downSpeedKBPS?Number(r.video[i].downSpeedKBPS):0,l.packetCount=r.video[i].packetsReceived?Number(r.video[i].packetsReceived):0,l.packetLost=r.video[i].packetsLost?Number(r.video[i].packetsLost):0;var p=l.packetCount>0?l.packetLost/(l.packetCount+l.packetLost):0;r.video[i].helper||(r.video[i].helper={},r.video[i].helper.his=[]);var f=1,m=p>1?1:p;r.video[i].helper.his.forEach((function(e){e&&(m+=e,f++)})),r.video[i].helper.his.push(p),r.video[i].helper.his.length>5&&r.video[i].helper.his.shift();var h=m/f;r.video[i].helper.fractionLost=h,l.fractionLost=h?parseFloat(h.toFixed(2)):0,l.latency=r.video[i].latency?Number(r.video[i].latency):0,l.rtt=t._recvRTT?Number(t._recvRTT):0,l.availableRecvBandwidth=r.bandwidth.availableRecvBandwidth,t._videoRecvStats.set(u,l),o=l.fractionLost}})));var s=o>i?o:i,c=1,d=s;this._summarizeDownLostHelper.forEach((function(e){e&&(d+=e,c++)})),this._summarizeDownLostHelper.push(s),this._summarizeDownLostHelper.length>3&&this._summarizeDownLostHelper.shift(),this._summarize.downFractionLost=d/c,this._webrtcInternalRecvStats&&(r.statTimeTick=a,this._webrtcInternalRecvStats.push(r))}},{key:"setConsumeStats",value:function(e,t,r,n,i){this._cstat.consumer=n,this._cstat.stat=e,this._cstat.stat.forEach((function(e){"video"===e.kind&&"outbound-rtp"===e.type&&(e.resolution=t)})),this.consumerState(this._cstat)}},{key:"startHeartBeat",value:function(){var e=this;this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=null),this._reportInterval=setInterval((function(){e._reportWebrtcStats()}),1e4)}},{key:"stopHeartBeat",value:function(){this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=null)}},{key:"pushLoggerToServer",value:function(e,t){if(c.default.logSubmit){var r="";r=e?e+" "+(0,n.default)(t):(0,n.default)(t),fetch(d.logserver_url,{method:"POST",mode:"no-cors",cache:"no-cache",headers:{"Content-Type":"text/plain; charset=utf-8"},redirect:"follow",referrer:"no-referrer",body:r}).catch((function(e){})).then((function(e){}))}}},{key:"consumerState",value:function(e){c.default.privateCloud||fetch("https://"+this._domain+"/stats/",{method:"POST",mode:"no-cors",cache:"no-cache",headers:{Accept:"application/json","Content-Type":"application/json"},redirect:"follow",referrer:"no-referrer",body:(0,n.default)(e)}).catch((function(e){})).then((function(e){}))}},{key:"sendTimeOutLog",value:function(e){var t=e.timesOfLinkGW,r=e.linkGWTime,n=e.sendGWTime,i=e.sendEnterTime,a={glbId:u.uuid(),appId:this._appId,userId:this._userId,roomId:this._roomId,connectId:this._connectionId,os:"WEB",logTime:(new Date).toISOString().replace(/a-z/gi," "),timesOfLinkIplocal:this._iplocationInfo.reconnectTimes,timesOfLinkGW:t,linkIplocalTime:this._iplocationInfo.connectedTime-this._iplocationInfo.firstConnectTime,sendIplocalTime:this._iplocationInfo.connectedTime,linkGWTime:r,sendGWTime:n,sendEnterTime:i,gwIp:this._gwInfo.sIp};this.pushLoggerToServer(m.ENTER_TIMEOUT,a)}},{key:"sendFailLog",value:function(e){var t=e.timesOfLinkGW,r=e.linkGWTime,n=e.sendGWTime,i=e.sendEnterTime,a=e.role,o=e.result,s={glbId:u.uuid(),appId:this._appId,userId:this._userId,roomId:this._roomId,connectId:this._connectionId,os:"WEB",role:a,result:o,logTime:(new Date).toISOString().replace(/a-z/gi," "),timesOfLinkIplocal:this._iplocationInfo.reconnectTimes,timesOfLinkGW:t,linkIplocalTime:this._iplocationInfo.connectedTime-this._iplocationInfo.firstConnectTime,sendIplocalTime:this._iplocationInfo.connectedTime,linkGWTime:r,sendGWTime:n,sendEnterTime:i,innerDiff:0,totalDiff:0,gwIp:this._gwInfo.sIp};this.pushLoggerToServer(m.ENTER_FAIL,s)}},{key:"audioUpStat",get:function(){var e=this,t=(new Date).getTime();return this._audioSendStats.forEach((function(r,n){t-r.statTS>3e3&&e._audioSendStats.delete(n)})),this._audioSendStats}},{key:"videoUpStat",get:function(){var e=this,t=(new Date).getTime();return this._videoSendStats.forEach((function(r,n){t-r.statTS>3e3&&e._videoSendStats.delete(n)})),this._videoSendStats}},{key:"audioDownStat",get:function(){var e=this,t=(new Date).getTime();return this._audioRecvStats.forEach((function(r,n){t-r.statTS>3e3&&e._audioRecvStats.delete(n)})),this._audioRecvStats}},{key:"videoDownStat",get:function(){var e=this,t=(new Date).getTime();return this._videoRecvStats.forEach((function(r,n){t-r.statTS>3e3&&e._videoRecvStats.delete(n)})),this._videoRecvStats}},{key:"summarize",get:function(){var e=this,t=0,r=0,n=(new Date).getTime();return this._upStatHelper.forEach((function(i,a){n-i.statTS>2e3?e._upStatHelper.delete(a):(t+=i.upSpeed,r=r>i.upFractionLost?r:i.upFractionLost)})),this._summarize.upSpeed=t?Number(t):0,this._summarize.upFractionLost=r||0,this._summarize}},{key:"audioOpen",set:function(e){this._isAudioOpen=e}},{key:"videoOpen",set:function(e){this._isVideoOpen=e}}]),e}();t.default=v},function(e,t,r){e.exports={default:r(227),__esModule:!0}},function(e,t,r){r(228),e.exports=r(7).Object.freeze},function(e,t,r){var n=r(19),i=r(59).onFreeze;r(79)("freeze",(function(e){return function(t){return e&&n(t)?e(i(t)):t}}))},function(e,t,r){"use strict";(function(n){var i,a=s(r(26)),o=s(r(43));function s(e){return e&&e.__esModule?e:{default:e}}var c=0,d=function(e,t,r,i){var s,d="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(s=void 0!==n?n:null)&&"undefined"==typeof window&&void 0!==n&&(n.navigator={userAgent:d,getUserMedia:function(){}},n.console||(n.console={}),void 0!==n.console.log&&void 0!==n.console.error||(n.console.error=n.console.log=n.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(s.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},s.HTMLVideoElement=function(){}),"undefined"==typeof location&&(s.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(s.screen={width:0,height:0}),"undefined"==typeof URL&&(s.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),"undefined"==typeof MediaStreamTrack&&(s.MediaStreamTrack=function(){}),void 0===u&&(s.RTCPeerConnection=function(){}),s.window=n);var u=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"==typeof MediaStreamTrack&&(MediaStreamTrack={});var l=((navigator.connection||{}).type||"unknown").toString().toLowerCase(),p={isSafari:!1,encryption:"sha-256",audio:{ssrc:[]},video:{ssrc:[]},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{prevBytesReceived:0,prevBytesSent:0},upSpeed:0,downSpeed:0,rtt:0},results:{},connectionType:{systemNetworkType:l,local:{candidateType:"",transport:"",ipAddress:"",portNumber:"",networkType:""},remote:{candidateType:"",transport:"",ipAddress:"",portNumber:""}},internal:{activeConnection:{localCandidate:"",remoteCandidate:""},audio:{},video:{},candidates:[]},nomore:function(){v=!0}},f={checkIfOfferer:function(e){"googLibjingleSession"===e.type&&(p.isOfferer=e.googInitiator)}},m=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);p.isSafari=m;var h=this;if(!(arguments[0]instanceof u))throw"1st argument is not instance of RTCPeerConnection.";h=arguments[0],arguments[1]instanceof MediaStreamTrack&&(e=arguments[1],t=arguments[2],r=arguments[3]),+r<1e3&&(r=1e3),c=r;var v=!1;function _(){g((function(e){if(e&&e.forEach){e.forEach((function(e){(0,o.default)(f).forEach((function(t){if("function"==typeof f[t])try{e.tttdir=i,f[t](e)}catch(e){console.warn(e.message,e.stack,e)}}))}));try{-1!==h.iceConnectionState.search(/failed|closed|disconnected/gi)&&(v=!0)}catch(e){v=!0}!0===v&&(p.datachannel&&(p.datachannel.state="close"),p.ended=!0),p.internal.candidates.forEach((function(e){e&&(e.id===p.internal.activeConnection.localCandidate?(p.connectionType.local.candidateType=e.candidateType,p.connectionType.local.ipAddress=e.ipAddress,p.connectionType.local.portNumber=e.portNumber,p.connectionType.local.networkType=e.networkType,p.connectionType.local.transport=e.transport):e.id===p.internal.activeConnection.remoteCandidate&&(p.connectionType.remote.candidateType=e.candidateType,p.connectionType.remote.ipAddress=e.ipAddress,p.connectionType.remote.portNumber=e.portNumber,p.connectionType.remote.transport=e.transport))})),p.results=e,p.audio.ssrc.forEach((function(e){})),p.video.ssrc.forEach((function(e){})),t(p),v||null!=(void 0===r?"undefined":(0,a.default)(r))&&r&&setTimeout(_,r||1e3)}}))}function g(e){void 0!==window.InstallTrigger||m?h.getStats(window.mediaStreamTrack||null).then((function(t){var r=[];t.forEach((function(e){r.push(e)})),e(r)})).catch(e):h.getStats((function(t){var r=[];t.result().forEach((function(e){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)})),e(r)}))}f.datachannel=function(e){"datachannel"===e.type&&(p.datachannel={state:e.state})},f.googCertificate=function(e){"googCertificate"==e.type&&(p.encryption=e.googFingerprintAlgorithm),"certificate"==e.type&&(p.encryption=e.fingerprintAlgorithm)},f.checkAudioTracks=function(e){if("ssrc"===e.type&&"audio"===e.mediaType){var t=e.ssrc,r=e.id.split("_").pop();if(!0===e.isRemote?r="recv":!1===e.isRemote&&(r="send"),r){-1===p.audio.ssrc.indexOf(""+t)&&p.audio.ssrc.push(""+t),p.audio[t]||(p.audio[t]={},p.audio[t][r]={},p.audio[t][r].codecs=[],p.audio[t][r].tracks=[]),e.googCodecName&&""!==e.googCodecName&&-1===p.audio[t][r].codecs.indexOf(e.googCodecName)&&p.audio[t][r].codecs.push(e.googCodecName);var n=(new Date).getTime();p.audio[t].statTS=n,p.internal.audio[t]||(p.internal.audio[t]={}),p.internal.audio[t][r]||(p.internal.audio[t][r]={});var i=0,a=0;"send"===r&&void 0!==e.bytesSent&&(p.internal.audio[t][r].prevBytesSent||(p.internal.audio[t][r].prevBytesSent=0),i=e.bytesSent-p.internal.audio[t][r].prevBytesSent,p.internal.audio[t][r].prevBytesSent=e.bytesSent,a=8*i/1024,p.audio[t][r].availableBandwidth=parseInt(a,10),p.audio[t].upSpeedKBPS=parseInt(a,10),p.audio[t].bytesSent=e.bytesSent),"recv"===r&&void 0!==e.bytesReceived&&(p.internal.audio[t][r].prevBytesReceived||(p.internal.audio[t][r].prevBytesReceived=0),i=e.bytesReceived-p.internal.audio[t][r].prevBytesReceived,p.internal.audio[t][r].prevBytesReceived=e.bytesReceived,a=8*i/1024,p.audio[t].downSpeedKBPS=parseInt(a,10),p.audio[t].bytesReceived=e.bytesReceived),void 0!==e.googJitterBufferMs&&(p.audio[t].jitterBufferMs=e.googJitterBufferMs),e.googTrackId&&-1===p.audio[t][r].tracks.indexOf(e.googTrackId)&&p.audio[t][r].tracks.push(e.googTrackId),void 0!==e.googCurrentDelayMs&&(p.internal.audio[t].googCurrentDelayMs=e.googCurrentDelayMs,p.audio[t].latency=parseInt(e.googCurrentDelayMs,10),p.audio[t].latency<0&&(p.audio[t].latency=0));var o=0;if("recv"===r&&void 0!==e.packetsReceived&&(p.internal.audio[t].prevPacketsReceived||(p.internal.audio[t].prevPacketsReceived=0),o=e.packetsReceived-p.internal.audio[t].prevPacketsReceived,p.internal.audio[t].prevPacketsReceived=e.packetsReceived,p.audio[t].packetsReceived=parseInt(o,10),p.audio[t].packetsReceivedTotal=e.packetsReceived,p.audio[t].packetsReceived<0&&(p.audio[t].packetsReceived=0)),"send"===r&&void 0!==e.packetsSent&&(p.internal.audio[t].prevPacketsSent||(p.internal.audio[t].prevPacketsSent=0),o=e.packetsSent-p.internal.audio[t].prevPacketsSent,p.internal.audio[t].prevPacketsSent=e.packetsSent,p.audio[t].packetsSent=parseInt(o,10),p.audio[t].packetsSentTotal=e.packetsSent,p.audio[t].packetsSent<0&&(p.audio[t].packetsSent=0)),void 0!==e.packetsLost){p.internal.audio[t].prevPacketsLost||(p.internal.audio[t].prevPacketsLost=0);var s=e.packetsLost-p.internal.audio[t].prevPacketsLost;p.internal.audio[t].prevPacketsLost=e.packetsLost,p.audio[t].packetsLost=parseInt(s,10),p.audio[t].packetsLost<0&&(p.audio[t].packetsLost=0)}}}},f.checkVideoTracks=function(e){if("ssrc"===e.type&&"video"===e.mediaType){var t=e.ssrc,r=e.id.split("_").pop();if(!0===e.isRemote?r="recv":!1===e.isRemote&&(r="send"),r){-1===p.video.ssrc.indexOf(""+t)&&p.video.ssrc.push(""+t),p.video[t]||(p.video[t]={},p.video[t][r]={},p.video[t][r].codecs=[],p.video[t][r].tracks=[],p.video[t][r].resolutions={}),-1===p.video[t][r].codecs.indexOf(e.googCodecName||"VP8")&&p.video[t][r].codecs.push(e.googCodecName||"VP8");var n=(new Date).getTime();p.video[t].statTS=n,p.internal.video[t]||(p.internal.video[t]={},p.internal.video[t][r]={}),p.internal.video[t][r]||(p.internal.video[t][r]={});var i=0,a=0;"send"===r&&void 0!==e.bytesSent&&(p.internal.video[t][r].prevBytesSent||(p.internal.video[t][r].prevBytesSent=0),i=e.bytesSent-p.internal.video[t][r].prevBytesSent,p.internal.video[t][r].prevBytesSent=e.bytesSent,a=8*i/1024,p.video[t][r].availableBandwidth=parseInt(a,10),p.video[t].upSpeedKBPS=parseInt(a,10),p.video[t].bytesSent=e.bytesSent),"recv"===r&&void 0!==e.bytesReceived&&(p.internal.video[t][r].prevBytesReceived||(p.internal.video[t][r].prevBytesReceived=0),i=e.bytesReceived-p.internal.video[t][r].prevBytesReceived,p.internal.video[t][r].prevBytesReceived=e.bytesReceived,a=8*i/1024,p.video[t].downSpeedKBPS=parseInt(a,10),p.video[t].bytesReceived=e.bytesReceived),void 0!==e.framesDecoded&&(p.video[t].framesDecoded=e.framesDecoded),void 0!==e.googJitterBufferMs&&(p.video[t].jitterBufferMs=e.googJitterBufferMs),e.googFrameHeightReceived&&e.googFrameWidthReceived&&(p.video[t][r].resolutions.width=e.googFrameWidthReceived,p.video[t][r].resolutions.height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(p.video[t][r].resolutions.width=e.googFrameWidthSent,p.video[t][r].resolutions.height=e.googFrameHeightSent),e.googTrackId&&-1===p.video[t][r].tracks.indexOf(e.googTrackId)&&p.video[t][r].tracks.push(e.googTrackId),void 0!==e.googCurrentDelayMs&&(p.internal.video[t].googCurrentDelayMs=e.googCurrentDelayMs,p.video[t].latency=Boolean(e.googCurrentDelayMs)?parseInt(e.googCurrentDelayMs,10):0,p.video[t].latency<0&&(p.video[t].latency=0));var o=0;if("recv"===r&&void 0!==e.packetsReceived&&(p.internal.video[t].prevPacketsReceived||(p.internal.video[t].prevPacketsReceived=0),o=e.packetsReceived-p.internal.video[t].prevPacketsReceived,p.internal.video[t].prevPacketsReceived=e.packetsReceived,p.video[t].packetsReceived=parseInt(o,10),p.video[t].packetsReceivedTotal=e.packetsReceived,p.video[t].packetsReceived<0&&(p.video[t].packetsReceived=0)),"send"===r&&void 0!==e.packetsSent&&(p.internal.video[t].prevPacketsSent||(p.internal.video[t].prevPacketsSent=0),o=e.packetsSent-p.internal.video[t].prevPacketsSent,p.internal.video[t].prevPacketsSent=e.packetsSent,p.video[t].packetsSent=parseInt(o,10),p.video[t].packetsSentTotal=e.packetsSent,p.video[t].packetsSent<0&&(p.video[t].packetsSent=0)),void 0!==e.packetsLost){p.internal.video[t].prevPacketsLost||(p.internal.video[t].prevPacketsLost=0);var s=e.packetsLost-p.internal.video[t].prevPacketsLost;p.internal.video[t].prevPacketsLost=e.packetsLost,p.video[t].packetsLost=parseInt(s,10),p.video[t].packetsLost<0&&(p.video[t].packetsLost=0)}}}},f.bweforvideo=function(e){"VideoBwe"===e.type&&(p.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,p.bandwidth.availableRecvBandwidth=e.googAvailableReceiveBandwidth,p.bandwidth.googActualEncBitrate=e.googActualEncBitrate,p.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,p.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,p.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,p.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,p.bandwidth.googBucketDelay=e.googBucketDelay,p.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},f.candidatePair=function(e){if("googCandidatePair"===e.type||"candidate-pair"===e.type||"local-candidate"===e.type||"remote-candidate"===e.type)if(m){if("candidate-pair"!==e.type||!0!==e.nominated||"succeeded"!==e.state)return;var t="";if("recv"===e.tttdir?t="recv":"send"===e.tttdir&&(t="send"),p.internal.activeConnection.remoteCandidate=e.remoteCandidateId,p.internal.activeConnection.localCandidate=e.localCandidateId,p.bandwidth.rtt=1e3*e.currentRoundTripTime,"send"===t&&void 0!==e.bytesSent){var r=1e3*(e.bytesSent-p.bandwidth.helper.prevBytesSent)*8/c;p.bandwidth.helper.prevBytesSent=e.bytesSent,r=r>0?r/1024:0,p.bandwidth.upSpeed=parseInt(r,10)}else if("recv"===t&&void 0!==e.bytesReceived){var n=1e3*(e.bytesReceived-p.bandwidth.helper.prevBytesReceived)*8/c;p.bandwidth.helper.prevBytesReceived=e.bytesReceived,n=n>0?n/1024:0,p.bandwidth.downSpeed=parseInt(n,10)}"send"===t&&void 0!==e.availableOutgoingBitrate?p.bandwidth.availableSendBandwidth=e.availableOutgoingBitrate:"recv"===t&&void 0!==e.availableIncomingBitrate&&(p.bandwidth.availableRecvBandwidth=e.availableIncomingBitrate)}else{if("true"==e.googActiveConnection){p.internal.activeConnection.remoteCandidate=e.remoteCandidateId,p.internal.activeConnection.localCandidate=e.localCandidateId,p.connectionType.transport=e.googTransportType,p.bandwidth.rtt=e.googRtt;var i=1e3*(e.bytesReceived-p.bandwidth.helper.prevBytesReceived)*8/c,a=1e3*(e.bytesSent-p.bandwidth.helper.prevBytesSent)*8/c;p.bandwidth.helper.prevBytesReceived=e.bytesReceived,p.bandwidth.helper.prevBytesSent=e.bytesSent,a=a>0?a/1024:0,i=i>0?i/1024:0,p.bandwidth.upSpeed=parseInt(a,10),p.bandwidth.downSpeed=parseInt(i,10)}if("candidate-pair"===e.type&&!0===e.selected&&!0===e.nominated&&"succeeded"===e.state)p.internal.candidates[e.remoteCandidateId],p.internal.candidates[e.remoteCandidateId]}},f.localcandidate=function(e){if(("localcandidate"===e.type||"local-candidate"===e.type)&&e.id){var t={candidateType:e.candidateType,ipAddress:e.ipAddress,portNumber:e.portNumber,networkType:e.networkType,priority:e.priority,transport:e.transport,timestamp:e.timestamp,id:e.id,type:e.type};p.internal.candidates.push(t)}},f.remotecandidate=function(e){if(("remotecandidate"===e.type||"remote-candidate"===e.type)&&e.id){var t={candidateType:e.candidateType,ipAddress:e.ipAddress,portNumber:e.portNumber,networkType:e.networkType,priority:e.priority,transport:e.transport,timestamp:e.timestamp,id:e.id,type:e.type};p.internal.candidates.push(t)}},f.inboundrtp=function(e){if(m&&"inbound-rtp"===e.type){var t=e.mediaType||"";0;var r=e.ssrc;-1===p[t].ssrc.indexOf(""+r)&&p[t].ssrc.push(""+r),p[t][r]||(p[t][r]={},p[t][r].recv={},p[t][r].recv.resolutions={});var n=(new Date).getTime();if(p[t][r].statTS=n,p.internal[t][r]||(p.internal[t][r]={},p.internal[t][r].recv={}),p.internal[t][r].recv||(p.internal[t][r].recv={}),void 0!==e.bytesReceived){var i;p.internal[t][r].recv.prevBytesReceived||(p.internal[t][r].recv.prevBytesReceived=0);var a=e.bytesReceived-p.internal[t][r].recv.prevBytesReceived;p.internal[t][r].recv.prevBytesReceived=e.bytesReceived,i=8*a/1024,p[t][r].downSpeedKBPS=parseInt(i,10),p[t][r].bytesReceived=e.bytesReceived}void 0!==e.framesDecoded&&(p[t][r].framesDecoded=e.framesDecoded),void 0!==e.jitter&&(p[t][r].jitterBufferMs=e.jitter,p.internal[t][r].jitter=e.jitter,p[t][r].latency=Boolean(e.jitter)?parseInt(e.jitter,10):0,p[t][r].latency+=Number(p.bandwidth.rtt),p[t][r].latency<0&&(p[t][r].latency=0)),void 0!==e.trackId&&(p[t][r].trackId=e.trackId);var o=0;if(void 0!==e.packetsReceived&&(p.internal[t][r].prevPacketsReceived||(p.internal[t][r].prevPacketsReceived=0),o=e.packetsReceived-p.internal[t][r].prevPacketsReceived,p.internal[t][r].prevPacketsReceived=e.packetsReceived,p[t][r].packetsReceived=parseInt(o,10),p[t][r].packetsReceivedTotal=e.packetsReceived,p[t][r].packetsReceived<0&&(p[t][r].packetsReceived=0)),void 0!==e.packetsLost){p.internal[t][r].prevPacketsLost||(p.internal[t][r].prevPacketsLost=0);var s=e.packetsLost-p.internal[t][r].prevPacketsLost;p.internal[t][r].prevPacketsLost=e.packetsLost,p[t][r].packetsLost=parseInt(s,10),p[t][r].packetsLost<0&&(p[t][r].packetsLost=0)}}},f.outboundrtp=function(e){if(m&&"outbound-rtp"===e.type){var t=e.mediaType||"";0;var r=e.ssrc;-1===p[t].ssrc.indexOf(""+r)&&p[t].ssrc.push(""+r),p[t][r]||(p[t][r]={},p[t][r].send={},p[t][r].send.resolutions={});var n=(new Date).getTime();if(p[t][r].statTS=n,p.internal[t][r]||(p.internal[t][r]={},p.internal[t][r].send={}),p.internal[t][r].send||(p.internal[t][r].send={}),void 0!==e.bytesSent){var i;p.internal[t][r].send.prevBytesSent||(p.internal[t][r].send.prevBytesSent=0);var a=e.bytesSent-p.internal[t][r].send.prevBytesSent;p.internal[t][r].send.prevBytesSent=e.bytesSent,i=8*a/1024,p[t][r].send.availableBandwidth=parseInt(i,10),p[t][r].upSpeedKBPS=parseInt(i,10),p[t][r].bytesSent=e.bytesSent}var o=0;if(void 0!==e.packetsSent&&(p.internal[t][r].prevPacketsSent||(p.internal[t][r].prevPacketsSent=0),o=e.packetsSent-p.internal[t][r].prevPacketsSent,p.internal[t][r].prevPacketsSent=e.packetsSent,p[t][r].packetsSent=parseInt(o,10),p[t][r].packetsSentTotal=e.packetsSent,p[t][r].packetsSent<0&&(p[t][r].packetsSent=0)),void 0!==e.packetsLost){p.internal[t][r].prevPacketsLost||(p.internal[t][r].prevPacketsLost=0);var s=e.packetsLost-p.internal[t][r].prevPacketsLost;p.internal[t][r].prevPacketsLost=e.packetsLost,p[t][r].packetsLost=parseInt(s,10),p[t][r].packetsLost<0&&(p[t][r].packetsLost=0)}}},f.track=function(e){if(m&&"track"===e.type&&void 0!==e.frameHeight&&void 0!==e.frameWidth){var t=!0===e.remoteSource?"send":"recv";p.video.ssrc.forEach((function(r){var n=r;p.video[n]&&p.video[n].trackId===e.id&&(p.video[n][t]||(p.video[n][t]={},p.video[n][t].resolutions={}),p.video[n][t].resolutions||(p.video[n][t].resolutions={}),p.video[n][t].resolutions.width=e.frameWidth,p.video[n][t].resolutions.height=e.frameHeight)}))}};var y={audio:{send:[],recv:[]},video:{send:[],recv:[]}};f.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();-1===y[e.mediaType][t].indexOf(e.ssrc)&&y[e.mediaType][t].push(e.ssrc)}},_()};e.exports=d,void 0===(i=function(){return d}.apply(t,[]))||(e.exports=i)}).call(this,r(38))}])}));
//# sourceMappingURL=tttwebsdk.js.map